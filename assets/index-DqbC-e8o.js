var FE=Object.defineProperty;var BE=(r,e,t)=>e in r?FE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var M=(r,e,t)=>BE(r,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const P_=!1;var nl=Array.isArray,zE=Array.prototype.indexOf,Pm=Array.from,S0=Object.defineProperty,es=Object.getOwnPropertyDescriptor,P0=Object.getOwnPropertyDescriptors,UE=Object.prototype,qE=Array.prototype,Em=Object.getPrototypeOf,E_=Object.isExtensible;function pa(r){return typeof r=="function"}const Ai=()=>{};function WE(r){return r()}function mp(r){for(var e=0;e<r.length;e++)r[e]()}const _n=2,E0=4,Ku=8,Am=16,Ir=32,Gi=64,iu=128,sn=256,au=512,Rt=1024,rr=2048,ms=4096,Ar=8192,Xu=16384,HE=32768,Yu=65536,A0=1<<17,VE=1<<19,O0=1<<20,gp=1<<21,tr=Symbol("$state"),T0=Symbol("legacy props"),ZE=Symbol("");function R0(r){return r===this.v}function C0(r,e){return r!=r?e==e:r!==e||r!==null&&typeof r=="object"||typeof r=="function"}function Om(r){return!C0(r,this.v)}function GE(r){throw new Error("https://svelte.dev/e/effect_in_teardown")}function JE(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function KE(r){throw new Error("https://svelte.dev/e/effect_orphan")}function XE(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function YE(r){throw new Error("https://svelte.dev/e/lifecycle_legacy_only")}function QE(r){throw new Error("https://svelte.dev/e/props_invalid_value")}function eA(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function tA(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function nA(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let Ji=!1,rA=!1;function sA(){Ji=!0}const Tm=1,Rm=2,I0=4,iA=8,aA=16,oA=1,lA=2,$0=4,cA=8,uA=16,dA=1,hA=2,Ft=Symbol(),fA="http://www.w3.org/1999/xhtml",pA="http://www.w3.org/2000/svg";function Qu(r){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let ke=null;function A_(r){ke=r}function M0(r){return N0().get(r)}function mA(r,e){return N0().set(r,e),e}function $t(r,e=!1,t){var n=ke={p:ke,c:null,d:!1,e:null,m:!1,s:r,x:null,l:null};Ji&&!e&&(ke.l={s:null,u:null,r1:[],r2:ji(!1)}),Cm(()=>{n.d=!0})}function Mt(r){const e=ke;if(e!==null){const a=e.e;if(a!==null){var t=Ne,n=Ae;e.e=null;try{for(var s=0;s<a.length;s++){var i=a[s];ss(i.effect),ir(i.reaction),il(i.fn)}}finally{ss(t),ir(n)}}ke=e.p,e.m=!0}return{}}function rl(){return!Ji||ke!==null&&ke.l===null}function N0(r){return ke===null&&Qu(),ke.c??(ke.c=new Map(gA(ke)||void 0))}function gA(r){let e=r.p;for(;e!==null;){const t=e.c;if(t!==null)return t;e=e.p}return null}function Hr(r){if(typeof r!="object"||r===null||tr in r)return r;const e=Em(r);if(e!==UE&&e!==qE)return r;var t=new Map,n=nl(r),s=pn(0),i=Ae,a=o=>{var l=Ae;ir(i);var c=o();return ir(l),c};return n&&t.set("length",pn(r.length)),new Proxy(r,{defineProperty(o,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&eA();var u=t.get(l);return u===void 0?(u=a(()=>pn(c.value)),t.set(l,u)):se(u,a(()=>Hr(c.value))),!0},deleteProperty(o,l){var c=t.get(l);if(c===void 0)l in o&&t.set(l,a(()=>pn(Ft)));else{if(n&&typeof l=="string"){var u=t.get("length"),d=Number(l);Number.isInteger(d)&&d<u.v&&se(u,d)}se(c,Ft),O_(s)}return!0},get(o,l,c){var f;if(l===tr)return r;var u=t.get(l),d=l in o;if(u===void 0&&(!d||(f=es(o,l))!=null&&f.writable)&&(u=a(()=>pn(Hr(d?o[l]:Ft))),t.set(l,u)),u!==void 0){var h=P(u);return h===Ft?void 0:h}return Reflect.get(o,l,c)},getOwnPropertyDescriptor(o,l){var c=Reflect.getOwnPropertyDescriptor(o,l);if(c&&"value"in c){var u=t.get(l);u&&(c.value=P(u))}else if(c===void 0){var d=t.get(l),h=d==null?void 0:d.v;if(d!==void 0&&h!==Ft)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return c},has(o,l){var h;if(l===tr)return!0;var c=t.get(l),u=c!==void 0&&c.v!==Ft||Reflect.has(o,l);if(c!==void 0||Ne!==null&&(!u||(h=es(o,l))!=null&&h.writable)){c===void 0&&(c=a(()=>pn(u?Hr(o[l]):Ft)),t.set(l,c));var d=P(c);if(d===Ft)return!1}return u},set(o,l,c,u){var y;var d=t.get(l),h=l in o;if(n&&l==="length")for(var f=c;f<d.v;f+=1){var p=t.get(f+"");p!==void 0?se(p,Ft):f in o&&(p=a(()=>pn(Ft)),t.set(f+"",p))}d===void 0?(!h||(y=es(o,l))!=null&&y.writable)&&(d=a(()=>pn(void 0)),se(d,a(()=>Hr(c))),t.set(l,d)):(h=d.v!==Ft,se(d,a(()=>Hr(c))));var m=Reflect.getOwnPropertyDescriptor(o,l);if(m!=null&&m.set&&m.set.call(u,c),!h){if(n&&typeof l=="string"){var g=t.get("length"),_=Number(l);Number.isInteger(_)&&_>=g.v&&se(g,_+1)}O_(s)}return!0},ownKeys(o){P(s);var l=Reflect.ownKeys(o).filter(d=>{var h=t.get(d);return h===void 0||h.v!==Ft});for(var[c,u]of t)u.v!==Ft&&!(c in o)&&l.push(c);return l},setPrototypeOf(){tA()}})}function O_(r,e=1){se(r,r.v+e)}function T_(r){try{if(r!==null&&typeof r=="object"&&tr in r)return r[tr]}catch{}return r}function _A(r,e){return Object.is(T_(r),T_(e))}function Li(r){var e=_n|rr,t=Ae!==null&&(Ae.f&_n)!==0?Ae:null;return Ne===null||t!==null&&(t.f&sn)!==0?e|=sn:Ne.f|=O0,{ctx:ke,deps:null,effects:null,equals:R0,f:e,fn:r,reactions:null,rv:0,v:null,wv:0,parent:t??Ne}}function _p(r){const e=Li(r);return J0(e),e}function yn(r){const e=Li(r);return e.equals=Om,e}function L0(r){var e=r.effects;if(e!==null){r.effects=null;for(var t=0;t<e.length;t+=1)sr(e[t])}}function bA(r){for(var e=r.parent;e!==null;){if((e.f&_n)===0)return e;e=e.parent}return null}function j0(r){var e,t=Ne;ss(bA(r));try{L0(r),e=Q0(r)}finally{ss(t)}return e}function D0(r){var e=j0(r),t=(Jr||(r.f&sn)!==0)&&r.deps!==null?ms:Rt;bn(r,t),r.equals(e)||(r.v=e,r.wv=X0())}const wo=new Map;function ji(r,e){var t={f:0,v:r,reactions:null,equals:R0,rv:0,wv:0};return t}function pn(r,e){const t=ji(r);return J0(t),t}function ze(r,e=!1){var n;const t=ji(r);return e||(t.equals=Om),Ji&&ke!==null&&ke.l!==null&&((n=ke.l).s??(n.s=[])).push(t),t}function se(r,e,t=!1){Ae!==null&&!Yn&&rl()&&(Ae.f&(_n|Am))!==0&&!(Tt!=null&&Tt.includes(r))&&nA();let n=t?Hr(e):e;return vo(r,n)}function vo(r,e){if(!r.equals(e)){var t=r.v;ll?wo.set(r,e):wo.set(r,t),r.v=e,(r.f&_n)!==0&&((r.f&rr)!==0&&j0(r),bn(r,(r.f&sn)===0?Rt:ms)),r.wv=X0(),F0(r,rr),rl()&&Ne!==null&&(Ne.f&Rt)!==0&&(Ne.f&(Ir|Gi))===0&&(fn===null?AA([r]):fn.push(r))}return e}function R_(r,e=1){var t=P(r),n=e===1?t++:t--;return se(r,t),n}function F0(r,e){var t=r.reactions;if(t!==null)for(var n=rl(),s=t.length,i=0;i<s;i++){var a=t[i],o=a.f;(o&rr)===0&&(!n&&a===Ne||(bn(a,e),(o&(Rt|sn))!==0&&((o&_n)!==0?F0(a,ms):ad(a))))}}let yA=!1;var C_,B0,z0,U0;function wA(){if(C_===void 0){C_=window,B0=/Firefox/.test(navigator.userAgent);var r=Element.prototype,e=Node.prototype,t=Text.prototype;z0=es(e,"firstChild").get,U0=es(e,"nextSibling").get,E_(r)&&(r.__click=void 0,r.__className=void 0,r.__attributes=null,r.__style=void 0,r.__e=void 0),E_(t)&&(t.__t=void 0)}}function sl(r=""){return document.createTextNode(r)}function Us(r){return z0.call(r)}function ed(r){return U0.call(r)}function L(r,e){return Us(r)}function bt(r,e){{var t=Us(r);return t instanceof Comment&&t.data===""?ed(t):t}}function B(r,e=1,t=!1){let n=r;for(;e--;)n=ed(n);return n}function vA(r){r.textContent=""}function q0(r){Ne===null&&Ae===null&&KE(),Ae!==null&&(Ae.f&sn)!==0&&Ne===null&&JE(),ll&&GE()}function xA(r,e){var t=e.last;t===null?e.last=e.first=r:(t.next=r,r.prev=t,e.last=r)}function Ki(r,e,t,n=!0){var s=Ne,i={ctx:ke,deps:null,nodes_start:null,nodes_end:null,f:r|rr,first:null,fn:e,last:null,next:null,parent:s,prev:null,teardown:null,transitions:null,wv:0};if(t)try{id(i),i.f|=HE}catch(l){throw sr(i),l}else e!==null&&ad(i);var a=t&&i.deps===null&&i.first===null&&i.nodes_start===null&&i.teardown===null&&(i.f&(O0|iu))===0;if(!a&&n&&(s!==null&&xA(i,s),Ae!==null&&(Ae.f&_n)!==0)){var o=Ae;(o.effects??(o.effects=[])).push(i)}return i}function Cm(r){const e=Ki(Ku,null,!1);return bn(e,Rt),e.teardown=r,e}function xo(r){q0();var e=Ne!==null&&(Ne.f&Ir)!==0&&ke!==null&&!ke.m;if(e){var t=ke;(t.e??(t.e=[])).push({fn:r,effect:Ne,reaction:Ae})}else{var n=il(r);return n}}function kA(r){return q0(),al(r)}function SA(r){const e=Ki(Gi,r,!0);return(t={})=>new Promise(n=>{t.outro?ko(e,()=>{sr(e),n(void 0)}):(sr(e),n(void 0))})}function il(r){return Ki(E0,r,!1)}function td(r,e){var t=ke,n={effect:null,ran:!1};t.l.r1.push(n),n.effect=al(()=>{r(),!n.ran&&(n.ran=!0,se(t.l.r2,!0),ar(e))})}function nd(){var r=ke;al(()=>{if(P(r.l.r2)){for(var e of r.l.r1){var t=e.effect;(t.f&Rt)!==0&&bn(t,ms),Xi(t)&&id(t),e.ran=!1}r.l.r2.v=!1}})}function al(r){return Ki(Ku,r,!0)}function De(r,e=[],t=Li){const n=e.map(t);return ol(()=>r(...n.map(P)))}function ol(r,e=0){return Ki(Ku|Am|e,r,!0)}function qs(r,e=!0){return Ki(Ku|Ir,r,!0,e)}function W0(r){var e=r.teardown;if(e!==null){const t=ll,n=Ae;I_(!0),ir(null);try{e.call(null)}finally{I_(t),ir(n)}}}function H0(r,e=!1){var t=r.first;for(r.first=r.last=null;t!==null;){var n=t.next;(t.f&Gi)!==0?t.parent=null:sr(t,e),t=n}}function PA(r){for(var e=r.first;e!==null;){var t=e.next;(e.f&Ir)===0&&sr(e),e=t}}function sr(r,e=!0){var t=!1;if((e||(r.f&VE)!==0)&&r.nodes_start!==null){for(var n=r.nodes_start,s=r.nodes_end;n!==null;){var i=n===s?null:ed(n);n.remove(),n=i}t=!0}H0(r,e&&!t),uu(r,0),bn(r,Xu);var a=r.transitions;if(a!==null)for(const l of a)l.stop();W0(r);var o=r.parent;o!==null&&o.first!==null&&V0(r),r.next=r.prev=r.teardown=r.ctx=r.deps=r.fn=r.nodes_start=r.nodes_end=null}function V0(r){var e=r.parent,t=r.prev,n=r.next;t!==null&&(t.next=n),n!==null&&(n.prev=t),e!==null&&(e.first===r&&(e.first=n),e.last===r&&(e.last=t))}function ko(r,e){var t=[];Im(r,t,!0),Z0(t,()=>{sr(r),e&&e()})}function Z0(r,e){var t=r.length;if(t>0){var n=()=>--t||e();for(var s of r)s.out(n)}else e()}function Im(r,e,t){if((r.f&Ar)===0){if(r.f^=Ar,r.transitions!==null)for(const a of r.transitions)(a.is_global||t)&&e.push(a);for(var n=r.first;n!==null;){var s=n.next,i=(n.f&Yu)!==0||(n.f&Ir)!==0;Im(n,e,i?t:!1),n=s}}}function So(r){G0(r,!0)}function G0(r,e){if((r.f&Ar)!==0){r.f^=Ar,(r.f&Rt)===0&&(r.f^=Rt),Xi(r)&&(bn(r,rr),ad(r));for(var t=r.first;t!==null;){var n=t.next,s=(t.f&Yu)!==0||(t.f&Ir)!==0;G0(t,s?e:!1),t=n}if(r.transitions!==null)for(const i of r.transitions)(i.is_global||e)&&i.in()}}let ou=[];function EA(){var r=ou;ou=[],mp(r)}function rd(r){ou.length===0&&queueMicrotask(EA),ou.push(r)}let Bc=!1,bp=!1,lu=null,Ls=!1,ll=!1;function I_(r){ll=r}let zc=[];let Ae=null,Yn=!1;function ir(r){Ae=r}let Ne=null;function ss(r){Ne=r}let Tt=null;function J0(r){Ae!==null&&Ae.f&gp&&(Tt===null?Tt=[r]:Tt.push(r))}let Et=null,Qt=0,fn=null;function AA(r){fn=r}let K0=1,cu=0,Jr=!1,Vr=null;function X0(){return++K0}function Xi(r){var d;var e=r.f;if((e&rr)!==0)return!0;if((e&ms)!==0){var t=r.deps,n=(e&sn)!==0;if(t!==null){var s,i,a=(e&au)!==0,o=n&&Ne!==null&&!Jr,l=t.length;if(a||o){var c=r,u=c.parent;for(s=0;s<l;s++)i=t[s],(a||!((d=i==null?void 0:i.reactions)!=null&&d.includes(c)))&&(i.reactions??(i.reactions=[])).push(c);a&&(c.f^=au),o&&u!==null&&(u.f&sn)===0&&(c.f^=sn)}for(s=0;s<l;s++)if(i=t[s],Xi(i)&&D0(i),i.wv>r.wv)return!0}(!n||Ne!==null&&!Jr)&&bn(r,Rt)}return!1}function OA(r,e){for(var t=e;t!==null;){if((t.f&iu)!==0)try{t.fn(r);return}catch{t.f^=iu}t=t.parent}throw Bc=!1,r}function TA(r){return(r.f&Xu)===0&&(r.parent===null||(r.parent.f&iu)===0)}function sd(r,e,t,n){if(Bc){if(t===null&&(Bc=!1),TA(e))throw r;return}t!==null&&(Bc=!0);{OA(r,e);return}}function Y0(r,e,t=!0){var n=r.reactions;if(n!==null)for(var s=0;s<n.length;s++){var i=n[s];Tt!=null&&Tt.includes(r)||((i.f&_n)!==0?Y0(i,e,!1):e===i&&(t?bn(i,rr):(i.f&Rt)!==0&&bn(i,ms),ad(i)))}}function Q0(r){var f;var e=Et,t=Qt,n=fn,s=Ae,i=Jr,a=Tt,o=ke,l=Yn,c=r.f;Et=null,Qt=0,fn=null,Jr=(c&sn)!==0&&(Yn||!Ls||Ae===null),Ae=(c&(Ir|Gi))===0?r:null,Tt=null,A_(r.ctx),Yn=!1,cu++,r.f|=gp;try{var u=(0,r.fn)(),d=r.deps;if(Et!==null){var h;if(uu(r,Qt),d!==null&&Qt>0)for(d.length=Qt+Et.length,h=0;h<Et.length;h++)d[Qt+h]=Et[h];else r.deps=d=Et;if(!Jr)for(h=Qt;h<d.length;h++)((f=d[h]).reactions??(f.reactions=[])).push(r)}else d!==null&&Qt<d.length&&(uu(r,Qt),d.length=Qt);if(rl()&&fn!==null&&!Yn&&d!==null&&(r.f&(_n|ms|rr))===0)for(h=0;h<fn.length;h++)Y0(fn[h],r);return s!==r&&(cu++,fn!==null&&(n===null?n=fn:n.push(...fn))),u}finally{Et=e,Qt=t,fn=n,Ae=s,Jr=i,Tt=a,A_(o),Yn=l,r.f^=gp}}function RA(r,e){let t=e.reactions;if(t!==null){var n=zE.call(t,r);if(n!==-1){var s=t.length-1;s===0?t=e.reactions=null:(t[n]=t[s],t.pop())}}t===null&&(e.f&_n)!==0&&(Et===null||!Et.includes(e))&&(bn(e,ms),(e.f&(sn|au))===0&&(e.f^=au),L0(e),uu(e,0))}function uu(r,e){var t=r.deps;if(t!==null)for(var n=e;n<t.length;n++)RA(r,t[n])}function id(r){var e=r.f;if((e&Xu)===0){bn(r,Rt);var t=Ne,n=ke,s=Ls;Ne=r,Ls=!0;try{(e&Am)!==0?PA(r):H0(r),W0(r);var i=Q0(r);r.teardown=typeof i=="function"?i:null,r.wv=K0;var a=r.deps,o;P_&&rA&&r.f&rr}catch(l){sd(l,r,t,n||r.ctx)}finally{Ls=s,Ne=t}}}function CA(){try{XE()}catch(r){if(lu!==null)sd(r,lu,null);else throw r}}function IA(){var r=Ls;try{var e=0;for(Ls=!0;zc.length>0;){e++>1e3&&CA();var t=zc,n=t.length;zc=[];for(var s=0;s<n;s++){var i=MA(t[s]);$A(i)}wo.clear()}}finally{bp=!1,Ls=r,lu=null}}function $A(r){var e=r.length;if(e!==0)for(var t=0;t<e;t++){var n=r[t];if((n.f&(Xu|Ar))===0)try{Xi(n)&&(id(n),n.deps===null&&n.first===null&&n.nodes_start===null&&(n.teardown===null?V0(n):n.fn=null))}catch(s){sd(s,n,null,n.ctx)}}}function ad(r){bp||(bp=!0,queueMicrotask(IA));for(var e=lu=r;e.parent!==null;){e=e.parent;var t=e.f;if((t&(Gi|Ir))!==0){if((t&Rt)===0)return;e.f^=Rt}}zc.push(e)}function MA(r){for(var e=[],t=r;t!==null;){var n=t.f,s=(n&(Ir|Gi))!==0,i=s&&(n&Rt)!==0;if(!i&&(n&Ar)===0){if((n&E0)!==0)e.push(t);else if(s)t.f^=Rt;else{var a=Ae;try{Ae=t,Xi(t)&&id(t)}catch(c){sd(c,t,null,t.ctx)}finally{Ae=a}}var o=t.first;if(o!==null){t=o;continue}}var l=t.parent;for(t=t.next;t===null&&l!==null;)t=l.next,l=l.parent}return e}function P(r){var e=r.f,t=(e&_n)!==0;if(Vr!==null&&Vr.add(r),Ae!==null&&!Yn){if(!(Tt!=null&&Tt.includes(r))){var n=Ae.deps;r.rv<cu&&(r.rv=cu,Et===null&&n!==null&&n[Qt]===r?Qt++:Et===null?Et=[r]:(!Jr||!Et.includes(r))&&Et.push(r))}}else if(t&&r.deps===null&&r.effects===null){var s=r,i=s.parent;i!==null&&(i.f&sn)===0&&(s.f^=sn)}return t&&(s=r,Xi(s)&&D0(s)),ll&&wo.has(r)?wo.get(r):r.v}function NA(r){var e=Vr;Vr=new Set;var t=Vr,n;try{if(ar(r),e!==null)for(n of Vr)e.add(n)}finally{Vr=e}return t}function yp(r){var e=NA(()=>ar(r));for(var t of e)if((t.f&A0)!==0)for(const n of t.deps||[])(n.f&_n)===0&&vo(n,n.v);else vo(t,t.v)}function ar(r){var e=Yn;try{return Yn=!0,r()}finally{Yn=e}}const LA=-7169;function bn(r,e){r.f=r.f&LA|e}function cl(r){if(!(typeof r!="object"||!r||r instanceof EventTarget)){if(tr in r)wp(r);else if(!Array.isArray(r))for(let e in r){const t=r[e];typeof t=="object"&&t&&tr in t&&wp(t)}}}function wp(r,e=new Set){if(typeof r=="object"&&r!==null&&!(r instanceof EventTarget)&&!e.has(r)){e.add(r),r instanceof Date&&r.getTime();for(let n in r)try{wp(r[n],e)}catch{}const t=Em(r);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const n=P0(t);for(let s in n){const i=n[s].get;if(i)try{i.call(r)}catch{}}}}}function jA(r){return r.endsWith("capture")&&r!=="gotpointercapture"&&r!=="lostpointercapture"}const DA=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function FA(r){return DA.includes(r)}const BA={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function zA(r){return r=r.toLowerCase(),BA[r]??r}const UA=["touchstart","touchmove"];function qA(r){return UA.includes(r)}function WA(r,e){if(e){const t=document.body;r.autofocus=!0,rd(()=>{document.activeElement===t&&r.focus()})}}let $_=!1;function HA(){$_||($_=!0,document.addEventListener("reset",r=>{Promise.resolve().then(()=>{var e;if(!r.defaultPrevented)for(const t of r.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function ex(r){var e=Ae,t=Ne;ir(null),ss(null);try{return r()}finally{ir(e),ss(t)}}function tx(r,e,t,n=t){r.addEventListener(e,()=>ex(t));const s=r.__on_r;s?r.__on_r=()=>{s(),n(!0)}:r.__on_r=()=>n(!0),HA()}const nx=new Set,vp=new Set;function rx(r,e,t,n={}){function s(i){if(n.capture||Fa.call(e,i),!i.cancelBubble)return ex(()=>t==null?void 0:t.call(this,i))}return r.startsWith("pointer")||r.startsWith("touch")||r==="wheel"?rd(()=>{e.addEventListener(r,s,n)}):e.addEventListener(r,s,n),s}function an(r,e,t,n,s){var i={capture:n,passive:s},a=rx(r,e,t,i);(e===document.body||e===window||e===document)&&Cm(()=>{e.removeEventListener(r,a,i)})}function sx(r){for(var e=0;e<r.length;e++)nx.add(r[e]);for(var t of vp)t(r)}function Fa(r){var y;var e=this,t=e.ownerDocument,n=r.type,s=((y=r.composedPath)==null?void 0:y.call(r))||[],i=s[0]||r.target,a=0,o=r.__root;if(o){var l=s.indexOf(o);if(l!==-1&&(e===document||e===window)){r.__root=e;return}var c=s.indexOf(e);if(c===-1)return;l<=c&&(a=l)}if(i=s[a]||r.target,i!==e){S0(r,"currentTarget",{configurable:!0,get(){return i||t}});var u=Ae,d=Ne;ir(null),ss(null);try{for(var h,f=[];i!==null;){var p=i.assignedSlot||i.parentNode||i.host||null;try{var m=i["__"+n];if(m!=null&&(!i.disabled||r.target===i))if(nl(m)){var[g,..._]=m;g.apply(i,[r,..._])}else m.call(i,r)}catch(b){h?f.push(b):h=b}if(r.cancelBubble||p===e||p===null)break;i=p}if(h){for(let b of f)queueMicrotask(()=>{throw b});throw h}}finally{r.__root=e,delete r.currentTarget,ir(u),ss(d)}}}function $m(r){var e=document.createElement("template");return e.innerHTML=r,e.content}function Ws(r,e){var t=Ne;t.nodes_start===null&&(t.nodes_start=r,t.nodes_end=e)}function ie(r,e){var t=(e&dA)!==0,n=(e&hA)!==0,s,i=!r.startsWith("<!>");return()=>{s===void 0&&(s=$m(i?r:"<!>"+r),t||(s=Us(s)));var a=n||B0?document.importNode(s,!0):s.cloneNode(!0);if(t){var o=Us(a),l=a.lastChild;Ws(o,l)}else Ws(a,a);return a}}function VA(r,e,t="svg"){var n=!r.startsWith("<!>"),s=`<${t}>${n?r:"<!>"+r}</${t}>`,i;return()=>{if(!i){var a=$m(s),o=Us(a);i=Us(o)}var l=i.cloneNode(!0);return Ws(l,l),l}}function Is(r=""){{var e=sl(r+"");return Ws(e,e),e}}function kr(){var r=document.createDocumentFragment(),e=document.createComment(""),t=sl();return r.append(e,t),Ws(e,t),r}function Z(r,e){r!==null&&r.before(e)}function nt(r,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(r.__t??(r.__t=r.nodeValue))&&(r.__t=t,r.nodeValue=t+"")}function ZA(r,e){return GA(r,e)}const si=new Map;function GA(r,{target:e,anchor:t,props:n={},events:s,context:i,intro:a=!0}){wA();var o=new Set,l=d=>{for(var h=0;h<d.length;h++){var f=d[h];if(!o.has(f)){o.add(f);var p=qA(f);e.addEventListener(f,Fa,{passive:p});var m=si.get(f);m===void 0?(document.addEventListener(f,Fa,{passive:p}),si.set(f,1)):si.set(f,m+1)}}};l(Pm(nx)),vp.add(l);var c=void 0,u=SA(()=>{var d=t??e.appendChild(sl());return qs(()=>{if(i){$t({});var h=ke;h.c=i}s&&(n.$$events=s),c=r(d,n)||{},i&&Mt()}),()=>{var p;for(var h of o){e.removeEventListener(h,Fa);var f=si.get(h);--f===0?(document.removeEventListener(h,Fa),si.delete(h)):si.set(h,f)}vp.delete(l),d!==t&&((p=d.parentNode)==null||p.removeChild(d))}});return JA.set(c,u),c}let JA=new WeakMap;function zt(r,e,[t,n]=[0,0]){var s=r,i=null,a=null,o=Ft,l=t>0?Yu:0,c=!1;const u=(h,f=!0)=>{c=!0,d(f,h)},d=(h,f)=>{o!==(o=h)&&(o?(i?So(i):f&&(i=qs(()=>f(s))),a&&ko(a,()=>{a=null})):(a?So(a):f&&(a=qs(()=>f(s,[t+1,n]))),i&&ko(i,()=>{i=null})))};ol(()=>{c=!1,e(u),c||d(null,null)},l)}function Tr(r,e){return e}function KA(r,e,t,n){for(var s=[],i=e.length,a=0;a<i;a++)Im(e[a].e,s,!0);var o=i>0&&s.length===0&&t!==null;if(o){var l=t.parentNode;vA(l),l.append(t),n.clear(),qr(r,e[0].prev,e[i-1].next)}Z0(s,()=>{for(var c=0;c<i;c++){var u=e[c];o||(n.delete(u.k),qr(r,u.prev,u.next)),sr(u.e,!o)}})}function Tn(r,e,t,n,s,i=null){var a=r,o={flags:e,items:new Map,first:null},l=(e&I0)!==0;if(l){var c=r;a=c.appendChild(sl())}var u=null,d=!1,h=yn(()=>{var f=t();return nl(f)?f:f==null?[]:Pm(f)});ol(()=>{var f=P(h),p=f.length;d&&p===0||(d=p===0,XA(f,o,a,s,e,n,t),i!==null&&(p===0?u?So(u):u=qs(()=>i(a)):u!==null&&ko(u,()=>{u=null})),P(h))})}function XA(r,e,t,n,s,i,a){var O,E,$,N;var o=(s&iA)!==0,l=(s&(Tm|Rm))!==0,c=r.length,u=e.items,d=e.first,h=d,f,p=null,m,g=[],_=[],y,b,w,v;if(o)for(v=0;v<c;v+=1)y=r[v],b=i(y,v),w=u.get(b),w!==void 0&&((O=w.a)==null||O.measure(),(m??(m=new Set)).add(w));for(v=0;v<c;v+=1){if(y=r[v],b=i(y,v),w=u.get(b),w===void 0){var S=h?h.e.nodes_start:t;p=QA(S,e,p,p===null?e.first:p.next,y,b,v,n,s,a),u.set(b,p),g=[],_=[],h=p.next;continue}if(l&&YA(w,y,v,s),(w.e.f&Ar)!==0&&(So(w.e),o&&((E=w.a)==null||E.unfix(),(m??(m=new Set)).delete(w))),w!==h){if(f!==void 0&&f.has(w)){if(g.length<_.length){var k=_[0],x;p=k.prev;var A=g[0],C=g[g.length-1];for(x=0;x<g.length;x+=1)M_(g[x],k,t);for(x=0;x<_.length;x+=1)f.delete(_[x]);qr(e,A.prev,C.next),qr(e,p,A),qr(e,C,k),h=k,p=C,v-=1,g=[],_=[]}else f.delete(w),M_(w,h,t),qr(e,w.prev,w.next),qr(e,w,p===null?e.first:p.next),qr(e,p,w),p=w;continue}for(g=[],_=[];h!==null&&h.k!==b;)(h.e.f&Ar)===0&&(f??(f=new Set)).add(h),_.push(h),h=h.next;if(h===null)continue;w=h}g.push(w),p=w,h=w.next}if(h!==null||f!==void 0){for(var I=f===void 0?[]:Pm(f);h!==null;)(h.e.f&Ar)===0&&I.push(h),h=h.next;var D=I.length;if(D>0){var Y=(s&I0)!==0&&c===0?t:null;if(o){for(v=0;v<D;v+=1)($=I[v].a)==null||$.measure();for(v=0;v<D;v+=1)(N=I[v].a)==null||N.fix()}KA(e,I,Y,u)}}o&&rd(()=>{var R;if(m!==void 0)for(w of m)(R=w.a)==null||R.apply()}),Ne.first=e.first&&e.first.e,Ne.last=p&&p.e}function YA(r,e,t,n){(n&Tm)!==0&&vo(r.v,e),(n&Rm)!==0?vo(r.i,t):r.i=t}function QA(r,e,t,n,s,i,a,o,l,c){var u=(l&Tm)!==0,d=(l&aA)===0,h=u?d?ze(s):ji(s):s,f=(l&Rm)===0?a:ji(a),p={i:f,v:h,k:i,a:null,e:null,prev:t,next:n};try{return p.e=qs(()=>o(r,h,f,c),yA),p.e.prev=t&&t.e,p.e.next=n&&n.e,t===null?e.first=p:(t.next=p,t.e.next=p.e),n!==null&&(n.prev=p,n.e.prev=p.e),p}finally{}}function M_(r,e,t){for(var n=r.next?r.next.e.nodes_start:t,s=e?e.e.nodes_start:t,i=r.e.nodes_start;i!==n;){var a=ed(i);s.before(i),i=a}}function qr(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function e1(r,e,t,n,s){var i=r,a="",o;ol(()=>{a!==(a=e()??"")&&(o!==void 0&&(sr(o),o=void 0),a!==""&&(o=qs(()=>{var l=a+"",c=$m(l);Ws(Us(c),c.lastChild),i.before(c)})))})}function Vt(r,e,t,n,s){var o;var i=(o=e.$$slots)==null?void 0:o[t],a=!1;i===!0&&(i=e[t==="default"?"children":t],a=!0),i===void 0||i(r,a?()=>n:n)}function t1(r,e,t,n,s,i){var a,o,l=null,c=r,u;ol(()=>{const d=e()||null;var h=pA;d!==a&&(u&&(d===null?ko(u,()=>{u=null,o=null}):d===o?So(u):sr(u)),d&&d!==o&&(u=qs(()=>{if(l=document.createElementNS(h,d),Ws(l,l),n){var f=l.appendChild(sl());n(l,f)}Ne.nodes_end=l,c.before(l)})),a=d,a&&(o=a))},Yu)}function ix(r){var e,t,n="";if(typeof r=="string"||typeof r=="number")n+=r;else if(typeof r=="object")if(Array.isArray(r)){var s=r.length;for(e=0;e<s;e++)r[e]&&(t=ix(r[e]))&&(n&&(n+=" "),n+=t)}else for(t in r)r[t]&&(n&&(n+=" "),n+=t);return n}function Mm(){for(var r,e,t=0,n="",s=arguments.length;t<s;t++)(r=arguments[t])&&(e=ix(r))&&(n&&(n+=" "),n+=e);return n}function n1(r){return typeof r=="object"?Mm(r):r??""}const N_=[...` 	
\r\fÂ \v\uFEFF`];function r1(r,e,t){var n=r==null?"":""+r;if(t){for(var s in t)if(t[s])n=n?n+" "+s:s;else if(n.length)for(var i=s.length,a=0;(a=n.indexOf(s,a))>=0;){var o=a+i;(a===0||N_.includes(n[a-1]))&&(o===n.length||N_.includes(n[o]))?n=(a===0?"":n.substring(0,a))+n.substring(o+1):a=o}}return n===""?null:n}function L_(r,e=!1){var t=e?" !important;":";",n="";for(var s in r){var i=r[s];i!=null&&i!==""&&(n+=" "+s+": "+i+t)}return n}function eh(r){return r[0]!=="-"||r[1]!=="-"?r.toLowerCase():r}function s1(r,e){if(e){var t="",n,s;if(Array.isArray(e)?(n=e[0],s=e[1]):n=e,r){r=String(r).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var i=!1,a=0,o=!1,l=[];n&&l.push(...Object.keys(n).map(eh)),s&&l.push(...Object.keys(s).map(eh));var c=0,u=-1;const m=r.length;for(var d=0;d<m;d++){var h=r[d];if(o?h==="/"&&r[d-1]==="*"&&(o=!1):i?i===h&&(i=!1):h==="/"&&r[d+1]==="*"?o=!0:h==='"'||h==="'"?i=h:h==="("?a++:h===")"&&a--,!o&&i===!1&&a===0){if(h===":"&&u===-1)u=d;else if(h===";"||d===m-1){if(u!==-1){var f=eh(r.substring(c,u).trim());if(!l.includes(f)){h!==";"&&d++;var p=r.substring(c,d).trim();t+=" "+p+";"}}c=d+1,u=-1}}}}return n&&(t+=L_(n)),s&&(t+=L_(s,!0)),t=t.trim(),t===""?null:t}return r==null?null:String(r)}function ax(r,e,t,n,s,i){var a=r.__className;if(a!==t||a===void 0){var o=r1(t,n,i);o==null?r.removeAttribute("class"):e?r.className=o:r.setAttribute("class",o),r.__className=t}else if(i&&s!==i)for(var l in i){var c=!!i[l];(s==null||c!==!!s[l])&&r.classList.toggle(l,c)}return i}function th(r,e={},t,n){for(var s in t){var i=t[s];e[s]!==i&&(t[s]==null?r.style.removeProperty(s):r.style.setProperty(s,i,n))}}function Nm(r,e,t,n){var s=r.__style;if(s!==e){var i=s1(e,n);i==null?r.removeAttribute("style"):r.style.cssText=i,r.__style=e}else n&&(Array.isArray(n)?(th(r,t==null?void 0:t[0],n[0]),th(r,t==null?void 0:t[1],n[1],"important")):th(r,t,n));return n}const ma=Symbol("class"),ga=Symbol("style"),ox=Symbol("is custom element"),lx=Symbol("is html");function i1(r,e){e?r.hasAttribute("selected")||r.setAttribute("selected",""):r.removeAttribute("selected")}function Oi(r,e,t,n){var s=cx(r);s[e]!==(s[e]=t)&&(e==="loading"&&(r[ZE]=t),t==null?r.removeAttribute(e):typeof t!="string"&&ux(r).includes(e)?r[e]=t:r.setAttribute(e,t))}function Rr(r,e,t,n,s=!1){var i=cx(r),a=i[ox],o=!i[lx],l=e||{},c=r.tagName==="OPTION";for(var u in e)u in t||(t[u]=null);t.class?t.class=n1(t.class):t[ma]&&(t.class=null),t[ga]&&(t.style??(t.style=null));var d=ux(r);for(const b in t){let w=t[b];if(c&&b==="value"&&w==null){r.value=r.__value="",l[b]=w;continue}if(b==="class"){var h=r.namespaceURI==="http://www.w3.org/1999/xhtml";ax(r,h,w,n,e==null?void 0:e[ma],t[ma]),l[b]=w,l[ma]=t[ma];continue}if(b==="style"){Nm(r,w,e==null?void 0:e[ga],t[ga]),l[b]=w,l[ga]=t[ga];continue}var f=l[b];if(w!==f){l[b]=w;var p=b[0]+b[1];if(p!=="$$")if(p==="on"){const v={},S="$$"+b;let k=b.slice(2);var m=FA(k);if(jA(k)&&(k=k.slice(0,-7),v.capture=!0),!m&&f){if(w!=null)continue;r.removeEventListener(k,l[S],v),l[S]=null}if(w!=null)if(m)r[`__${k}`]=w,sx([k]);else{let x=function(A){l[b].call(this,A)};var y=x;l[S]=rx(k,r,x,v)}else m&&(r[`__${k}`]=void 0)}else if(b==="style")Oi(r,b,w);else if(b==="autofocus")WA(r,!!w);else if(!a&&(b==="__value"||b==="value"&&w!=null))r.value=r.__value=w;else if(b==="selected"&&c)i1(r,w);else{var g=b;o||(g=zA(g));var _=g==="defaultValue"||g==="defaultChecked";if(w==null&&!a&&!_)if(i[b]=null,g==="value"||g==="checked"){let v=r;const S=e===void 0;if(g==="value"){let k=v.defaultValue;v.removeAttribute(g),v.defaultValue=k,v.value=v.__value=S?k:null}else{let k=v.defaultChecked;v.removeAttribute(g),v.defaultChecked=k,v.checked=S?k:!1}}else r.removeAttribute(b);else _||d.includes(g)&&(a||typeof w!="string")?r[g]=w:typeof w!="function"&&Oi(r,g,w)}}}return l}function cx(r){return r.__attributes??(r.__attributes={[ox]:r.nodeName.includes("-"),[lx]:r.namespaceURI===fA})}var j_=new Map;function ux(r){var e=j_.get(r.nodeName);if(e)return e;j_.set(r.nodeName,e=[]);for(var t,n=r,s=Element.prototype;s!==n;){t=P0(n);for(var i in t)t[i].set&&e.push(i);n=Em(n)}return e}function ht(r,e,t=e){var n=rl();tx(r,"input",s=>{var i=s?r.defaultValue:r.value;if(i=nh(r)?rh(i):i,t(i),n&&i!==(i=e())){var a=r.selectionStart,o=r.selectionEnd;r.value=i??"",o!==null&&(r.selectionStart=a,r.selectionEnd=Math.min(o,r.value.length))}}),ar(e)==null&&r.value&&t(nh(r)?rh(r.value):r.value),al(()=>{var s=e();nh(r)&&s===rh(r.value)||r.type==="date"&&!s&&!r.value||s!==r.value&&(r.value=s??"")})}function nh(r){var e=r.type;return e==="number"||e==="range"}function rh(r){return r===""?null:+r}function dx(r,e,t){if(r.multiple)return o1(r,e);for(var n of r.options){var s=ro(n);if(_A(s,e)){n.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function a1(r,e){il(()=>{var t=new MutationObserver(()=>{var n=r.__value;dx(r,n)});return t.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{t.disconnect()}})}function Po(r,e,t=e){var n=!0;tx(r,"change",s=>{var i=s?"[selected]":":checked",a;if(r.multiple)a=[].map.call(r.querySelectorAll(i),ro);else{var o=r.querySelector(i)??r.querySelector("option:not([disabled])");a=o&&ro(o)}t(a)}),il(()=>{var s=e();if(dx(r,s,n),n&&s===void 0){var i=r.querySelector(":checked");i!==null&&(s=ro(i),t(s))}r.__value=s,n=!1}),a1(r)}function o1(r,e){for(var t of r.options)t.selected=~e.indexOf(ro(t))}function ro(r){return"__value"in r?r.__value:r.value}function D_(r,e){return r===e||(r==null?void 0:r[tr])===e}function Ba(r={},e,t,n){return il(()=>{var s,i;return al(()=>{s=i,i=[],ar(()=>{r!==t(...i)&&(e(r,...i),s&&D_(t(...s),r)&&e(null,...s))})}),()=>{rd(()=>{i&&D_(t(...i),r)&&e(null,...i)})}}),r}function Lm(r){return function(...e){var t=e[0];return t.preventDefault(),r==null?void 0:r.apply(this,e)}}function wn(r=!1){const e=ke,t=e.l.u;if(!t)return;let n=()=>cl(e.s);if(r){let s=0,i={};const a=Li(()=>{let o=!1;const l=e.s;for(const c in l)l[c]!==i[c]&&(i[c]=l[c],o=!0);return o&&s++,s});n=()=>P(a)}t.b.length&&kA(()=>{F_(e,n),mp(t.b)}),xo(()=>{const s=ar(()=>t.m.map(WE));return()=>{for(const i of s)typeof i=="function"&&i()}}),t.a.length&&xo(()=>{F_(e,n),mp(t.a)})}function F_(r,e){if(r.l.s)for(const t of r.l.s)P(t);e()}function B_(r,e){var i;var t=(i=r.$$events)==null?void 0:i[e.type],n=nl(t)?t.slice():t==null?[]:[t];for(var s of n)s.call(this,e)}function hx(r,e,t){if(r==null)return e(void 0),Ai;const n=ar(()=>r.subscribe(e,t));return n.unsubscribe?()=>n.unsubscribe():n}const ii=[];function od(r,e=Ai){let t=null;const n=new Set;function s(o){if(C0(r,o)&&(r=o,t)){const l=!ii.length;for(const c of n)c[1](),ii.push(c,r);if(l){for(let c=0;c<ii.length;c+=2)ii[c][0](ii[c+1]);ii.length=0}}}function i(o){s(o(r))}function a(o,l=Ai){const c=[o,l];return n.add(c),n.size===1&&(t=e(s,i)||Ai),o(r),()=>{n.delete(c),n.size===0&&t&&(t(),t=null)}}return{set:s,update:i,subscribe:a}}function fx(r){let e;return hx(r,t=>e=t)(),e}let Nl=!1,xp=Symbol();function ul(r,e,t){const n=t[e]??(t[e]={store:null,source:ze(void 0),unsubscribe:Ai});if(n.store!==r&&!(xp in t))if(n.unsubscribe(),n.store=r??null,r==null)n.source.v=void 0,n.unsubscribe=Ai;else{var s=!0;n.unsubscribe=hx(r,i=>{s?n.source.v=i:se(n.source,i)}),s=!1}return r&&xp in t?fx(r):P(n.source)}function px(r,e){return r.set(e),e}function Yi(){const r={};function e(){Cm(()=>{for(var t in r)r[t].unsubscribe();S0(r,xp,{enumerable:!1,value:!0})})}return[r,e]}function l1(r){var e=Nl;try{return Nl=!1,[r(),Nl]}finally{Nl=e}}const c1={get(r,e){if(!r.exclude.includes(e))return P(r.version),e in r.special?r.special[e]():r.props[e]},set(r,e,t){return e in r.special||(r.special[e]=$e({get[e](){return r.props[e]}},e,$0)),r.special[e](t),R_(r.version),!0},getOwnPropertyDescriptor(r,e){if(!r.exclude.includes(e)&&e in r.props)return{enumerable:!0,configurable:!0,value:r.props[e]}},deleteProperty(r,e){return r.exclude.includes(e)||(r.exclude.push(e),R_(r.version)),!0},has(r,e){return r.exclude.includes(e)?!1:e in r.props},ownKeys(r){return Reflect.ownKeys(r.props).filter(e=>!r.exclude.includes(e))}};function Ye(r,e){return new Proxy({props:r,exclude:e,special:{},version:ji(0)},c1)}const u1={get(r,e){let t=r.props.length;for(;t--;){let n=r.props[t];if(pa(n)&&(n=n()),typeof n=="object"&&n!==null&&e in n)return n[e]}},set(r,e,t){let n=r.props.length;for(;n--;){let s=r.props[n];pa(s)&&(s=s());const i=es(s,e);if(i&&i.set)return i.set(t),!0}return!1},getOwnPropertyDescriptor(r,e){let t=r.props.length;for(;t--;){let n=r.props[t];if(pa(n)&&(n=n()),typeof n=="object"&&n!==null&&e in n){const s=es(n,e);return s&&!s.configurable&&(s.configurable=!0),s}}},has(r,e){if(e===tr||e===T0)return!1;for(let t of r.props)if(pa(t)&&(t=t()),t!=null&&e in t)return!0;return!1},ownKeys(r){const e=[];for(let t of r.props){pa(t)&&(t=t());for(const n in t)e.includes(n)||e.push(n)}return e}};function ld(...r){return new Proxy({props:r},u1)}function z_(r){var e;return((e=r.ctx)==null?void 0:e.d)??!1}function $e(r,e,t,n){var k;var s=(t&oA)!==0,i=!Ji||(t&lA)!==0,a=(t&cA)!==0,o=(t&uA)!==0,l=!1,c;a?[c,l]=l1(()=>r[e]):c=r[e];var u=tr in r||T0 in r,d=a&&(((k=es(r,e))==null?void 0:k.set)??(u&&e in r&&(x=>r[e]=x)))||void 0,h=n,f=!0,p=!1,m=()=>(p=!0,f&&(f=!1,o?h=ar(n):h=n),h);c===void 0&&n!==void 0&&(d&&i&&QE(),c=m(),d&&d(c));var g;if(i)g=()=>{var x=r[e];return x===void 0?m():(f=!0,p=!1,x)};else{var _=(s?Li:yn)(()=>r[e]);_.f|=A0,g=()=>{var x=P(_);return x!==void 0&&(h=void 0),x===void 0?h:x}}if((t&$0)===0)return g;if(d){var y=r.$$legacy;return function(x,A){return arguments.length>0?((!i||!A||y||l)&&d(A?g():x),x):g()}}var b=!1,w=!1,v=ze(c),S=Li(()=>{var x=g(),A=P(v);return b?(b=!1,w=!0,A):(w=!1,v.v=x)});return a&&P(S),s||(S.equals=Om),function(x,A){if(Vr!==null&&(b=w,g(),P(v)),arguments.length>0){const C=A?P(S):i&&a?Hr(x):x;if(!S.equals(C)){if(b=!0,se(v,C),p&&h!==void 0&&(h=C),z_(S))return x;ar(()=>P(S))}return x}return z_(S)?S.v:P(S)}}function mx(r){ke===null&&Qu(),Ji&&ke.l!==null?_x(ke).m.push(r):xo(()=>{const e=ar(r);if(typeof e=="function")return e})}function d1(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}function gx(){const r=ke;return r===null&&Qu(),(e,t,n)=>{var i;const s=(i=r.s.$$events)==null?void 0:i[e];if(s){const a=nl(s)?s.slice():[s],o=d1(e,t,n);for(const l of a)l.call(r.x,o);return!o.defaultPrevented}return!0}}function h1(r){ke===null&&Qu(),ke.l===null&&YE(),_x(ke).a.push(r)}function _x(r){var e=r.l;return e.u??(e.u={a:[],b:[],m:[]})}const f1="5";var k0;typeof window<"u"&&((k0=window.__svelte??(window.__svelte={})).v??(k0.v=new Set)).add(f1);sA();class p1{constructor(e,t=[],n=1e3){this.id=crypto.randomUUID(),this.name=e,this.data=t,this.sampleRate=n,this.createdAt=new Date,this.updatedAt=new Date,this.sourceChannelIds=[],this.processingMethod=null}getStats(){if(this.data.length===0)return{length:0,min:0,max:0,mean:0,rms:0,duration:0};const e=Math.min(...this.data),t=Math.max(...this.data),s=this.data.reduce((l,c)=>l+c,0)/this.data.length,i=this.data.reduce((l,c)=>l+c*c,0),a=Math.sqrt(i/this.data.length),o=this.data.length/this.sampleRate;return{length:this.data.length,min:e,max:t,mean:s,rms:a,duration:o}}updateData(e,t=null,n=[]){this.data=e,this.updatedAt=new Date,t&&(this.processingMethod=t),n.length>0&&(this.sourceChannelIds=n)}}const dl=od([]);function bx(r,e=[],t=1e3){const n=new p1(r,e,t);return dl.update(s=>[...s,n]),n}function m1(r){let e=null;return dl.subscribe(t=>{e=t.find(n=>n.id===r)})(),e}function g1(r){let e=!1;return dl.update(t=>{const n=t.length,s=t.filter(i=>i.id!==r);return e=s.length<n,s}),e}function _1(r,e,t,n={}){const s=m1(r);if(!s)return null;const i=e(s.data,...Object.values(n)),a=bx(t,i,s.sampleRate);return a.processingMethod=e.name,a.sourceChannelIds=[r],a}function U_(r,e,t=1,n=1e3,s=0){const i=[];for(let a=0;a<r;a++){const o=a/n;i.push(t*Math.sin(2*Math.PI*e*o+s))}return i}function q_(r,e,t=1,n=1e3,s=.5){const i=[],a=n/e;for(let o=0;o<r;o++){const l=o%a;i.push(l<a*s?t:-t)}return i}function W_(r,e,t=1,n=1e3){const s=[],i=n/e;for(let a=0;a<r;a++){const l=a%i/i;let c;l<.5?c=2*l:c=2*(1-l),s.push(t*(2*c-1))}return s}function H_(r,e,t=1,n=1e3){const s=[],i=n/e;for(let a=0;a<r;a++){const l=a%i/i;s.push(t*(2*l-1))}return s}function V_(r,e=1){const t=[];for(let n=0;n<r;n++)t.push(e*(2*Math.random()-1));return t}function Z_(r,e,t=1,n=1){const s=new Array(r).fill(0);for(let i=0;i<t;i++){const a=e+i;a>=0&&a<r&&(s[a]=n)}return s}const G_=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,J_=Mm,b1=(r,e)=>t=>{var n;if((e==null?void 0:e.variants)==null)return J_(r,t==null?void 0:t.class,t==null?void 0:t.className);const{variants:s,defaultVariants:i}=e,a=Object.keys(s).map(c=>{const u=t==null?void 0:t[c],d=i==null?void 0:i[c];if(u===null)return null;const h=G_(u)||G_(d);return s[c][h]}),o=t&&Object.entries(t).reduce((c,u)=>{let[d,h]=u;return h===void 0||(c[d]=h),c},{}),l=e==null||(n=e.compoundVariants)===null||n===void 0?void 0:n.reduce((c,u)=>{let{class:d,className:h,...f}=u;return Object.entries(f).every(p=>{let[m,g]=p;return Array.isArray(g)?g.includes({...i,...o}[m]):{...i,...o}[m]===g})?[...c,d,h]:c},[]);return J_(r,a,l,t==null?void 0:t.class,t==null?void 0:t.className)},jm="-",y1=r=>{const e=v1(r),{conflictingClassGroups:t,conflictingClassGroupModifiers:n}=r;return{getClassGroupId:a=>{const o=a.split(jm);return o[0]===""&&o.length!==1&&o.shift(),yx(o,e)||w1(a)},getConflictingClassGroupIds:(a,o)=>{const l=t[a]||[];return o&&n[a]?[...l,...n[a]]:l}}},yx=(r,e)=>{var a;if(r.length===0)return e.classGroupId;const t=r[0],n=e.nextPart.get(t),s=n?yx(r.slice(1),n):void 0;if(s)return s;if(e.validators.length===0)return;const i=r.join(jm);return(a=e.validators.find(({validator:o})=>o(i)))==null?void 0:a.classGroupId},K_=/^\[(.+)\]$/,w1=r=>{if(K_.test(r)){const e=K_.exec(r)[1],t=e==null?void 0:e.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},v1=r=>{const{theme:e,classGroups:t}=r,n={nextPart:new Map,validators:[]};for(const s in t)kp(t[s],n,s,e);return n},kp=(r,e,t,n)=>{r.forEach(s=>{if(typeof s=="string"){const i=s===""?e:X_(e,s);i.classGroupId=t;return}if(typeof s=="function"){if(x1(s)){kp(s(n),e,t,n);return}e.validators.push({validator:s,classGroupId:t});return}Object.entries(s).forEach(([i,a])=>{kp(a,X_(e,i),t,n)})})},X_=(r,e)=>{let t=r;return e.split(jm).forEach(n=>{t.nextPart.has(n)||t.nextPart.set(n,{nextPart:new Map,validators:[]}),t=t.nextPart.get(n)}),t},x1=r=>r.isThemeGetter,k1=r=>{if(r<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,n=new Map;const s=(i,a)=>{t.set(i,a),e++,e>r&&(e=0,n=t,t=new Map)};return{get(i){let a=t.get(i);if(a!==void 0)return a;if((a=n.get(i))!==void 0)return s(i,a),a},set(i,a){t.has(i)?t.set(i,a):s(i,a)}}},Sp="!",Pp=":",S1=Pp.length,P1=r=>{const{prefix:e,experimentalParseClassName:t}=r;let n=s=>{const i=[];let a=0,o=0,l=0,c;for(let p=0;p<s.length;p++){let m=s[p];if(a===0&&o===0){if(m===Pp){i.push(s.slice(l,p)),l=p+S1;continue}if(m==="/"){c=p;continue}}m==="["?a++:m==="]"?a--:m==="("?o++:m===")"&&o--}const u=i.length===0?s:s.substring(l),d=E1(u),h=d!==u,f=c&&c>l?c-l:void 0;return{modifiers:i,hasImportantModifier:h,baseClassName:d,maybePostfixModifierPosition:f}};if(e){const s=e+Pp,i=n;n=a=>a.startsWith(s)?i(a.substring(s.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:a,maybePostfixModifierPosition:void 0}}if(t){const s=n;n=i=>t({className:i,parseClassName:s})}return n},E1=r=>r.endsWith(Sp)?r.substring(0,r.length-1):r.startsWith(Sp)?r.substring(1):r,A1=r=>{const e=Object.fromEntries(r.orderSensitiveModifiers.map(n=>[n,!0]));return n=>{if(n.length<=1)return n;const s=[];let i=[];return n.forEach(a=>{a[0]==="["||e[a]?(s.push(...i.sort(),a),i=[]):i.push(a)}),s.push(...i.sort()),s}},O1=r=>({cache:k1(r.cacheSize),parseClassName:P1(r),sortModifiers:A1(r),...y1(r)}),T1=/\s+/,R1=(r,e)=>{const{parseClassName:t,getClassGroupId:n,getConflictingClassGroupIds:s,sortModifiers:i}=e,a=[],o=r.trim().split(T1);let l="";for(let c=o.length-1;c>=0;c-=1){const u=o[c],{isExternal:d,modifiers:h,hasImportantModifier:f,baseClassName:p,maybePostfixModifierPosition:m}=t(u);if(d){l=u+(l.length>0?" "+l:l);continue}let g=!!m,_=n(g?p.substring(0,m):p);if(!_){if(!g){l=u+(l.length>0?" "+l:l);continue}if(_=n(p),!_){l=u+(l.length>0?" "+l:l);continue}g=!1}const y=i(h).join(":"),b=f?y+Sp:y,w=b+_;if(a.includes(w))continue;a.push(w);const v=s(_,g);for(let S=0;S<v.length;++S){const k=v[S];a.push(b+k)}l=u+(l.length>0?" "+l:l)}return l};function C1(){let r=0,e,t,n="";for(;r<arguments.length;)(e=arguments[r++])&&(t=wx(e))&&(n&&(n+=" "),n+=t);return n}const wx=r=>{if(typeof r=="string")return r;let e,t="";for(let n=0;n<r.length;n++)r[n]&&(e=wx(r[n]))&&(t&&(t+=" "),t+=e);return t};function I1(r,...e){let t,n,s,i=a;function a(l){const c=e.reduce((u,d)=>d(u),r());return t=O1(c),n=t.cache.get,s=t.cache.set,i=o,o(l)}function o(l){const c=n(l);if(c)return c;const u=R1(l,t);return s(l,u),u}return function(){return i(C1.apply(null,arguments))}}const Qe=r=>{const e=t=>t[r]||[];return e.isThemeGetter=!0,e},vx=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,xx=/^\((?:(\w[\w-]*):)?(.+)\)$/i,$1=/^\d+\/\d+$/,M1=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,N1=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,L1=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,j1=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,D1=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,ai=r=>$1.test(r),_e=r=>!!r&&!Number.isNaN(Number(r)),Nr=r=>!!r&&Number.isInteger(Number(r)),sh=r=>r.endsWith("%")&&_e(r.slice(0,-1)),ur=r=>M1.test(r),F1=()=>!0,B1=r=>N1.test(r)&&!L1.test(r),kx=()=>!1,z1=r=>j1.test(r),U1=r=>D1.test(r),q1=r=>!W(r)&&!H(r),W1=r=>Qi(r,Ex,kx),W=r=>vx.test(r),vs=r=>Qi(r,Ax,B1),ih=r=>Qi(r,J1,_e),Y_=r=>Qi(r,Sx,kx),H1=r=>Qi(r,Px,U1),Ll=r=>Qi(r,Ox,z1),H=r=>xx.test(r),_a=r=>ea(r,Ax),V1=r=>ea(r,K1),Q_=r=>ea(r,Sx),Z1=r=>ea(r,Ex),G1=r=>ea(r,Px),jl=r=>ea(r,Ox,!0),Qi=(r,e,t)=>{const n=vx.exec(r);return n?n[1]?e(n[1]):t(n[2]):!1},ea=(r,e,t=!1)=>{const n=xx.exec(r);return n?n[1]?e(n[1]):t:!1},Sx=r=>r==="position"||r==="percentage",Px=r=>r==="image"||r==="url",Ex=r=>r==="length"||r==="size"||r==="bg-size",Ax=r=>r==="length",J1=r=>r==="number",K1=r=>r==="family-name",Ox=r=>r==="shadow",X1=()=>{const r=Qe("color"),e=Qe("font"),t=Qe("text"),n=Qe("font-weight"),s=Qe("tracking"),i=Qe("leading"),a=Qe("breakpoint"),o=Qe("container"),l=Qe("spacing"),c=Qe("radius"),u=Qe("shadow"),d=Qe("inset-shadow"),h=Qe("text-shadow"),f=Qe("drop-shadow"),p=Qe("blur"),m=Qe("perspective"),g=Qe("aspect"),_=Qe("ease"),y=Qe("animate"),b=()=>["auto","avoid","all","avoid-page","page","left","right","column"],w=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],v=()=>[...w(),H,W],S=()=>["auto","hidden","clip","visible","scroll"],k=()=>["auto","contain","none"],x=()=>[H,W,l],A=()=>[ai,"full","auto",...x()],C=()=>[Nr,"none","subgrid",H,W],I=()=>["auto",{span:["full",Nr,H,W]},Nr,H,W],D=()=>[Nr,"auto",H,W],Y=()=>["auto","min","max","fr",H,W],O=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],E=()=>["start","end","center","stretch","center-safe","end-safe"],$=()=>["auto",...x()],N=()=>[ai,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...x()],R=()=>[r,H,W],F=()=>[...w(),Q_,Y_,{position:[H,W]}],V=()=>["no-repeat",{repeat:["","x","y","space","round"]}],ne=()=>["auto","cover","contain",Z1,W1,{size:[H,W]}],J=()=>[sh,_a,vs],K=()=>["","none","full",c,H,W],z=()=>["",_e,_a,vs],Q=()=>["solid","dashed","dotted","double"],be=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],fe=()=>[_e,sh,Q_,Y_],vn=()=>["","none",p,H,W],Gt=()=>["none",_e,H,W],Lt=()=>["none",_e,H,W],ys=()=>[_e,H,W],ws=()=>[ai,"full",...x()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[ur],breakpoint:[ur],color:[F1],container:[ur],"drop-shadow":[ur],ease:["in","out","in-out"],font:[q1],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[ur],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[ur],shadow:[ur],spacing:["px",_e],text:[ur],"text-shadow":[ur],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",ai,W,H,g]}],container:["container"],columns:[{columns:[_e,W,H,o]}],"break-after":[{"break-after":b()}],"break-before":[{"break-before":b()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:v()}],overflow:[{overflow:S()}],"overflow-x":[{"overflow-x":S()}],"overflow-y":[{"overflow-y":S()}],overscroll:[{overscroll:k()}],"overscroll-x":[{"overscroll-x":k()}],"overscroll-y":[{"overscroll-y":k()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:A()}],"inset-x":[{"inset-x":A()}],"inset-y":[{"inset-y":A()}],start:[{start:A()}],end:[{end:A()}],top:[{top:A()}],right:[{right:A()}],bottom:[{bottom:A()}],left:[{left:A()}],visibility:["visible","invisible","collapse"],z:[{z:[Nr,"auto",H,W]}],basis:[{basis:[ai,"full","auto",o,...x()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[_e,ai,"auto","initial","none",W]}],grow:[{grow:["",_e,H,W]}],shrink:[{shrink:["",_e,H,W]}],order:[{order:[Nr,"first","last","none",H,W]}],"grid-cols":[{"grid-cols":C()}],"col-start-end":[{col:I()}],"col-start":[{"col-start":D()}],"col-end":[{"col-end":D()}],"grid-rows":[{"grid-rows":C()}],"row-start-end":[{row:I()}],"row-start":[{"row-start":D()}],"row-end":[{"row-end":D()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":Y()}],"auto-rows":[{"auto-rows":Y()}],gap:[{gap:x()}],"gap-x":[{"gap-x":x()}],"gap-y":[{"gap-y":x()}],"justify-content":[{justify:[...O(),"normal"]}],"justify-items":[{"justify-items":[...E(),"normal"]}],"justify-self":[{"justify-self":["auto",...E()]}],"align-content":[{content:["normal",...O()]}],"align-items":[{items:[...E(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...E(),{baseline:["","last"]}]}],"place-content":[{"place-content":O()}],"place-items":[{"place-items":[...E(),"baseline"]}],"place-self":[{"place-self":["auto",...E()]}],p:[{p:x()}],px:[{px:x()}],py:[{py:x()}],ps:[{ps:x()}],pe:[{pe:x()}],pt:[{pt:x()}],pr:[{pr:x()}],pb:[{pb:x()}],pl:[{pl:x()}],m:[{m:$()}],mx:[{mx:$()}],my:[{my:$()}],ms:[{ms:$()}],me:[{me:$()}],mt:[{mt:$()}],mr:[{mr:$()}],mb:[{mb:$()}],ml:[{ml:$()}],"space-x":[{"space-x":x()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":x()}],"space-y-reverse":["space-y-reverse"],size:[{size:N()}],w:[{w:[o,"screen",...N()]}],"min-w":[{"min-w":[o,"screen","none",...N()]}],"max-w":[{"max-w":[o,"screen","none","prose",{screen:[a]},...N()]}],h:[{h:["screen",...N()]}],"min-h":[{"min-h":["screen","none",...N()]}],"max-h":[{"max-h":["screen",...N()]}],"font-size":[{text:["base",t,_a,vs]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[n,H,ih]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",sh,W]}],"font-family":[{font:[V1,W,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[s,H,W]}],"line-clamp":[{"line-clamp":[_e,"none",H,ih]}],leading:[{leading:[i,...x()]}],"list-image":[{"list-image":["none",H,W]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",H,W]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:R()}],"text-color":[{text:R()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Q(),"wavy"]}],"text-decoration-thickness":[{decoration:[_e,"from-font","auto",H,vs]}],"text-decoration-color":[{decoration:R()}],"underline-offset":[{"underline-offset":[_e,"auto",H,W]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:x()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",H,W]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",H,W]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:F()}],"bg-repeat":[{bg:V()}],"bg-size":[{bg:ne()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Nr,H,W],radial:["",H,W],conic:[Nr,H,W]},G1,H1]}],"bg-color":[{bg:R()}],"gradient-from-pos":[{from:J()}],"gradient-via-pos":[{via:J()}],"gradient-to-pos":[{to:J()}],"gradient-from":[{from:R()}],"gradient-via":[{via:R()}],"gradient-to":[{to:R()}],rounded:[{rounded:K()}],"rounded-s":[{"rounded-s":K()}],"rounded-e":[{"rounded-e":K()}],"rounded-t":[{"rounded-t":K()}],"rounded-r":[{"rounded-r":K()}],"rounded-b":[{"rounded-b":K()}],"rounded-l":[{"rounded-l":K()}],"rounded-ss":[{"rounded-ss":K()}],"rounded-se":[{"rounded-se":K()}],"rounded-ee":[{"rounded-ee":K()}],"rounded-es":[{"rounded-es":K()}],"rounded-tl":[{"rounded-tl":K()}],"rounded-tr":[{"rounded-tr":K()}],"rounded-br":[{"rounded-br":K()}],"rounded-bl":[{"rounded-bl":K()}],"border-w":[{border:z()}],"border-w-x":[{"border-x":z()}],"border-w-y":[{"border-y":z()}],"border-w-s":[{"border-s":z()}],"border-w-e":[{"border-e":z()}],"border-w-t":[{"border-t":z()}],"border-w-r":[{"border-r":z()}],"border-w-b":[{"border-b":z()}],"border-w-l":[{"border-l":z()}],"divide-x":[{"divide-x":z()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":z()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...Q(),"hidden","none"]}],"divide-style":[{divide:[...Q(),"hidden","none"]}],"border-color":[{border:R()}],"border-color-x":[{"border-x":R()}],"border-color-y":[{"border-y":R()}],"border-color-s":[{"border-s":R()}],"border-color-e":[{"border-e":R()}],"border-color-t":[{"border-t":R()}],"border-color-r":[{"border-r":R()}],"border-color-b":[{"border-b":R()}],"border-color-l":[{"border-l":R()}],"divide-color":[{divide:R()}],"outline-style":[{outline:[...Q(),"none","hidden"]}],"outline-offset":[{"outline-offset":[_e,H,W]}],"outline-w":[{outline:["",_e,_a,vs]}],"outline-color":[{outline:R()}],shadow:[{shadow:["","none",u,jl,Ll]}],"shadow-color":[{shadow:R()}],"inset-shadow":[{"inset-shadow":["none",d,jl,Ll]}],"inset-shadow-color":[{"inset-shadow":R()}],"ring-w":[{ring:z()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:R()}],"ring-offset-w":[{"ring-offset":[_e,vs]}],"ring-offset-color":[{"ring-offset":R()}],"inset-ring-w":[{"inset-ring":z()}],"inset-ring-color":[{"inset-ring":R()}],"text-shadow":[{"text-shadow":["none",h,jl,Ll]}],"text-shadow-color":[{"text-shadow":R()}],opacity:[{opacity:[_e,H,W]}],"mix-blend":[{"mix-blend":[...be(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":be()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[_e]}],"mask-image-linear-from-pos":[{"mask-linear-from":fe()}],"mask-image-linear-to-pos":[{"mask-linear-to":fe()}],"mask-image-linear-from-color":[{"mask-linear-from":R()}],"mask-image-linear-to-color":[{"mask-linear-to":R()}],"mask-image-t-from-pos":[{"mask-t-from":fe()}],"mask-image-t-to-pos":[{"mask-t-to":fe()}],"mask-image-t-from-color":[{"mask-t-from":R()}],"mask-image-t-to-color":[{"mask-t-to":R()}],"mask-image-r-from-pos":[{"mask-r-from":fe()}],"mask-image-r-to-pos":[{"mask-r-to":fe()}],"mask-image-r-from-color":[{"mask-r-from":R()}],"mask-image-r-to-color":[{"mask-r-to":R()}],"mask-image-b-from-pos":[{"mask-b-from":fe()}],"mask-image-b-to-pos":[{"mask-b-to":fe()}],"mask-image-b-from-color":[{"mask-b-from":R()}],"mask-image-b-to-color":[{"mask-b-to":R()}],"mask-image-l-from-pos":[{"mask-l-from":fe()}],"mask-image-l-to-pos":[{"mask-l-to":fe()}],"mask-image-l-from-color":[{"mask-l-from":R()}],"mask-image-l-to-color":[{"mask-l-to":R()}],"mask-image-x-from-pos":[{"mask-x-from":fe()}],"mask-image-x-to-pos":[{"mask-x-to":fe()}],"mask-image-x-from-color":[{"mask-x-from":R()}],"mask-image-x-to-color":[{"mask-x-to":R()}],"mask-image-y-from-pos":[{"mask-y-from":fe()}],"mask-image-y-to-pos":[{"mask-y-to":fe()}],"mask-image-y-from-color":[{"mask-y-from":R()}],"mask-image-y-to-color":[{"mask-y-to":R()}],"mask-image-radial":[{"mask-radial":[H,W]}],"mask-image-radial-from-pos":[{"mask-radial-from":fe()}],"mask-image-radial-to-pos":[{"mask-radial-to":fe()}],"mask-image-radial-from-color":[{"mask-radial-from":R()}],"mask-image-radial-to-color":[{"mask-radial-to":R()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":w()}],"mask-image-conic-pos":[{"mask-conic":[_e]}],"mask-image-conic-from-pos":[{"mask-conic-from":fe()}],"mask-image-conic-to-pos":[{"mask-conic-to":fe()}],"mask-image-conic-from-color":[{"mask-conic-from":R()}],"mask-image-conic-to-color":[{"mask-conic-to":R()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:F()}],"mask-repeat":[{mask:V()}],"mask-size":[{mask:ne()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",H,W]}],filter:[{filter:["","none",H,W]}],blur:[{blur:vn()}],brightness:[{brightness:[_e,H,W]}],contrast:[{contrast:[_e,H,W]}],"drop-shadow":[{"drop-shadow":["","none",f,jl,Ll]}],"drop-shadow-color":[{"drop-shadow":R()}],grayscale:[{grayscale:["",_e,H,W]}],"hue-rotate":[{"hue-rotate":[_e,H,W]}],invert:[{invert:["",_e,H,W]}],saturate:[{saturate:[_e,H,W]}],sepia:[{sepia:["",_e,H,W]}],"backdrop-filter":[{"backdrop-filter":["","none",H,W]}],"backdrop-blur":[{"backdrop-blur":vn()}],"backdrop-brightness":[{"backdrop-brightness":[_e,H,W]}],"backdrop-contrast":[{"backdrop-contrast":[_e,H,W]}],"backdrop-grayscale":[{"backdrop-grayscale":["",_e,H,W]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[_e,H,W]}],"backdrop-invert":[{"backdrop-invert":["",_e,H,W]}],"backdrop-opacity":[{"backdrop-opacity":[_e,H,W]}],"backdrop-saturate":[{"backdrop-saturate":[_e,H,W]}],"backdrop-sepia":[{"backdrop-sepia":["",_e,H,W]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":x()}],"border-spacing-x":[{"border-spacing-x":x()}],"border-spacing-y":[{"border-spacing-y":x()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",H,W]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[_e,"initial",H,W]}],ease:[{ease:["linear","initial",_,H,W]}],delay:[{delay:[_e,H,W]}],animate:[{animate:["none",y,H,W]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[m,H,W]}],"perspective-origin":[{"perspective-origin":v()}],rotate:[{rotate:Gt()}],"rotate-x":[{"rotate-x":Gt()}],"rotate-y":[{"rotate-y":Gt()}],"rotate-z":[{"rotate-z":Gt()}],scale:[{scale:Lt()}],"scale-x":[{"scale-x":Lt()}],"scale-y":[{"scale-y":Lt()}],"scale-z":[{"scale-z":Lt()}],"scale-3d":["scale-3d"],skew:[{skew:ys()}],"skew-x":[{"skew-x":ys()}],"skew-y":[{"skew-y":ys()}],transform:[{transform:[H,W,"","none","gpu","cpu"]}],"transform-origin":[{origin:v()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:ws()}],"translate-x":[{"translate-x":ws()}],"translate-y":[{"translate-y":ws()}],"translate-z":[{"translate-z":ws()}],"translate-none":["translate-none"],accent:[{accent:R()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:R()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",H,W]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":x()}],"scroll-mx":[{"scroll-mx":x()}],"scroll-my":[{"scroll-my":x()}],"scroll-ms":[{"scroll-ms":x()}],"scroll-me":[{"scroll-me":x()}],"scroll-mt":[{"scroll-mt":x()}],"scroll-mr":[{"scroll-mr":x()}],"scroll-mb":[{"scroll-mb":x()}],"scroll-ml":[{"scroll-ml":x()}],"scroll-p":[{"scroll-p":x()}],"scroll-px":[{"scroll-px":x()}],"scroll-py":[{"scroll-py":x()}],"scroll-ps":[{"scroll-ps":x()}],"scroll-pe":[{"scroll-pe":x()}],"scroll-pt":[{"scroll-pt":x()}],"scroll-pr":[{"scroll-pr":x()}],"scroll-pb":[{"scroll-pb":x()}],"scroll-pl":[{"scroll-pl":x()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",H,W]}],fill:[{fill:["none",...R()]}],"stroke-w":[{stroke:[_e,_a,vs,ih]}],stroke:[{stroke:["none",...R()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},Y1=I1(X1);function Qs(...r){return Y1(Mm(r))}var Q1=ie("<button><!></button>");function Eo(r,e){const t=Ye(e,["children","$$slots","$$events","$$legacy"]),n=Ye(t,["class","variant","size","disabled","type"]);$t(e,!1);let s=$e(e,"class",8,""),i=$e(e,"variant",8,"default"),a=$e(e,"size",8,"default"),o=$e(e,"disabled",8,!1),l=$e(e,"type",8,"button");wn();var c=Q1();let u;var d=L(c);Vt(d,e,"default",{}),De(h=>u=Rr(c,u,{type:l(),class:h,disabled:o(),...n}),[()=>Qs(eO({variant:i(),size:a(),className:s()}))],yn),an("click",c,function(h){B_.call(this,e,h)}),an("keydown",c,function(h){B_.call(this,e,h)}),Z(r,c),Mt()}const eO=b1("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}});var tO=ie("<option> </option>"),nO=ie('<div class="space-y-2"><label for="frequency" class="text-sm font-medium">é¢ç (Hz)</label> <input id="frequency" type="number" min="0.1" step="0.1" required class="w-full px-3 py-2 border rounded-md border-input bg-background"></div>'),rO=ie('<div class="space-y-2"><label for="phase" class="text-sm font-medium">ç¸ä½ (å¼§åº¦)</label> <input id="phase" type="number" step="0.1" class="w-full px-3 py-2 border rounded-md border-input bg-background"></div>'),sO=ie('<div class="space-y-2"><label for="dutyCycle" class="text-sm font-medium">å ç©ºæ¯ (0-1)</label> <input id="dutyCycle" type="number" min="0" max="1" step="0.1" required class="w-full px-3 py-2 border rounded-md border-input bg-background"></div>'),iO=ie('<div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="space-y-2"><label for="pulsePosition" class="text-sm font-medium">èå² Position (sample)</label> <input id="pulsePosition" type="number" min="0" required class="w-full px-3 py-2 border rounded-md border-input bg-background"></div> <div class="space-y-2"><label for="pulseWidth" class="text-sm font-medium">èå² Width (samples)</label> <input id="pulseWidth" type="number" min="1" required class="w-full px-3 py-2 border rounded-md border-input bg-background"></div></div>'),aO=ie('<div class="space-y-4 py-4"><form class="space-y-4"><div class="grid gap-4"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="space-y-2"><label for="channelName" class="text-sm font-medium">ééåç§°</label> <input id="channelName" type="text" required class="w-full px-3 py-2 border rounded-md border-input bg-background"></div> <div class="space-y-2"><label for="signalType" class="text-sm font-medium">ä¿¡å·ç±»å</label> <select id="signalType" class="w-full px-3 py-2 border rounded-md border-input bg-background"></select></div></div> <div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div class="space-y-2"><label for="sampleRate" class="text-sm font-medium">éæ ·ç (Hz)</label> <input id="sampleRate" type="number" min="1" required class="w-full px-3 py-2 border rounded-md border-input bg-background"></div> <div class="space-y-2"><label for="length" class="text-sm font-medium">é¿åº¦ (æ ·æ¬æ°)</label> <input id="length" type="number" min="1" required class="w-full px-3 py-2 border rounded-md border-input bg-background"></div> <div class="space-y-2"><label for="amplitude" class="text-sm font-medium">å¹åº¦</label> <input id="amplitude" type="number" step="0.1" required class="w-full px-3 py-2 border rounded-md border-input bg-background"></div></div> <!> <!> <!> <!></div> <!></form></div>');function oO(r,e){$t(e,!1);const t=[{id:"sine",name:"æ­£å¼¦æ³¢",generator:U_},{id:"square",name:"æ¹æ³¢",generator:q_},{id:"triangle",name:"ä¸è§æ³¢",generator:W_},{id:"sawtooth",name:"é¯é½¿æ³¢",generator:H_},{id:"noise",name:"ç½åªå£°",generator:V_},{id:"pulse",name:"èå²",generator:Z_}];let n=1;function s(){return"ä¿¡å· "+n++}let i=ze(t[0]),a=ze(s()),o=ze(1e3),l=ze(1e3),c=ze(10),u=ze(1),d=ze(.5),h=ze(500),f=ze(10),p=ze(0);function m(){let z;switch(P(i).id){case"sine":z=U_(P(l),P(c),P(u),P(o),P(p));break;case"square":z=q_(P(l),P(c),P(u),P(o),P(d));break;case"triangle":z=W_(P(l),P(c),P(u),P(o));break;case"sawtooth":z=H_(P(l),P(c),P(u),P(o));break;case"noise":z=V_(P(l),P(u));break;case"pulse":z=Z_(P(l),P(h),P(f),P(u));break;default:z=[]}bx(P(a),z,P(o)),se(a,s())}wn();var g=aO(),_=L(g),y=L(_),b=L(y),w=L(b),v=B(L(w),2),S=B(w,2),k=B(L(S),2);De(()=>{P(i),yp(()=>{})}),Tn(k,5,()=>t,Tr,(z,Q)=>{var be=tO(),fe={},vn=L(be);De(()=>{fe!==(fe=P(Q))&&(be.value=(be.__value=P(Q))??""),nt(vn,P(Q).name)}),Z(z,be)});var x=B(b,2),A=L(x),C=B(L(A),2),I=B(A,2),D=B(L(I),2),Y=B(I,2),O=B(L(Y),2),E=B(x,2);{var $=z=>{var Q=nO(),be=B(L(Q),2);ht(be,()=>P(c),fe=>se(c,fe)),Z(z,Q)};zt(E,z=>{(P(i).id==="sine"||P(i).id==="square"||P(i).id==="triangle"||P(i).id==="sawtooth")&&z($)})}var N=B(E,2);{var R=z=>{var Q=rO(),be=B(L(Q),2);ht(be,()=>P(p),fe=>se(p,fe)),Z(z,Q)};zt(N,z=>{P(i).id==="sine"&&z(R)})}var F=B(N,2);{var V=z=>{var Q=sO(),be=B(L(Q),2);ht(be,()=>P(d),fe=>se(d,fe)),Z(z,Q)};zt(F,z=>{P(i).id==="square"&&z(V)})}var ne=B(F,2);{var J=z=>{var Q=iO(),be=L(Q),fe=B(L(be),2),vn=B(be,2),Gt=B(L(vn),2);De(()=>Oi(fe,"max",P(l)-1)),ht(fe,()=>P(h),Lt=>se(h,Lt)),ht(Gt,()=>P(f),Lt=>se(f,Lt)),Z(z,Q)};zt(ne,z=>{P(i).id==="pulse"&&z(J)})}var K=B(y,2);Eo(K,{type:"submit",class:"w-full",children:(z,Q)=>{var be=Is("çæä¿¡å·");Z(z,be)},$$slots:{default:!0}}),ht(v,()=>P(a),z=>se(a,z)),Po(k,()=>P(i),z=>se(i,z)),ht(C,()=>P(o),z=>se(o,z)),ht(D,()=>P(l),z=>se(l,z)),ht(O,()=>P(u),z=>se(u,z)),an("submit",_,Lm(m)),Z(r,g),Mt()}function ta(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var ah,eb;function Dm(){if(eb)return ah;eb=1;var r=function(s,i){return[s[0]+i[0],s[1]+i[1]]},e=function(s,i){return[s[0]-i[0],s[1]-i[1]]},t=function(s,i){return[s[0]*i[0]-s[1]*i[1],s[0]*i[1]+s[1]*i[0]]},n=function(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])};return ah={add:r,subtract:e,multiply:t,magnitude:n},ah}var oh,tb;function Fm(){if(tb)return oh;tb=1;var r=Dm(),e={},t=function(i,a){var o=-2*Math.PI*(i/a);return e[a]=e[a]||{},e[a][i]=e[a][i]||[Math.cos(o),Math.sin(o)],e[a][i]},n=function(i){var a=i.map(r.magnitude);return a.slice(0,a.length/2)},s=function(i,a){var o=a/i.length,l=i.slice(0,i.length/2);return l.map(function(c,u){return u*o})};return oh={fftMag:n,fftFreq:s,exponent:t},oh}var We={},nb;function lO(){if(nb)return We;nb=1;var r=32;We.INT_BITS=r,We.INT_MAX=2147483647,We.INT_MIN=-1<<r-1,We.sign=function(n){return(n>0)-(n<0)},We.abs=function(n){var s=n>>r-1;return(n^s)-s},We.min=function(n,s){return s^(n^s)&-(n<s)},We.max=function(n,s){return n^(n^s)&-(n<s)},We.isPow2=function(n){return!(n&n-1)&&!!n},We.log2=function(n){var s,i;return s=(n>65535)<<4,n>>>=s,i=(n>255)<<3,n>>>=i,s|=i,i=(n>15)<<2,n>>>=i,s|=i,i=(n>3)<<1,n>>>=i,s|=i,s|n>>1},We.log10=function(n){return n>=1e9?9:n>=1e8?8:n>=1e7?7:n>=1e6?6:n>=1e5?5:n>=1e4?4:n>=1e3?3:n>=100?2:n>=10?1:0},We.popCount=function(n){return n=n-(n>>>1&1431655765),n=(n&858993459)+(n>>>2&858993459),(n+(n>>>4)&252645135)*16843009>>>24};function e(n){var s=32;return n&=-n,n&&s--,n&65535&&(s-=16),n&16711935&&(s-=8),n&252645135&&(s-=4),n&858993459&&(s-=2),n&1431655765&&(s-=1),s}We.countTrailingZeros=e,We.nextPow2=function(n){return n+=n===0,--n,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n+1},We.prevPow2=function(n){return n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n-(n>>>1)},We.parity=function(n){return n^=n>>>16,n^=n>>>8,n^=n>>>4,n&=15,27030>>>n&1};var t=new Array(256);return function(n){for(var s=0;s<256;++s){var i=s,a=s,o=7;for(i>>>=1;i;i>>>=1)a<<=1,a|=i&1,--o;n[s]=a<<o&255}}(t),We.reverse=function(n){return t[n&255]<<24|t[n>>>8&255]<<16|t[n>>>16&255]<<8|t[n>>>24&255]},We.interleave2=function(n,s){return n&=65535,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,s&=65535,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,n|s<<1},We.deinterleave2=function(n,s){return n=n>>>s&1431655765,n=(n|n>>>1)&858993459,n=(n|n>>>2)&252645135,n=(n|n>>>4)&16711935,n=(n|n>>>16)&65535,n<<16>>16},We.interleave3=function(n,s,i){return n&=1023,n=(n|n<<16)&4278190335,n=(n|n<<8)&251719695,n=(n|n<<4)&3272356035,n=(n|n<<2)&1227133513,s&=1023,s=(s|s<<16)&4278190335,s=(s|s<<8)&251719695,s=(s|s<<4)&3272356035,s=(s|s<<2)&1227133513,n|=s<<1,i&=1023,i=(i|i<<16)&4278190335,i=(i|i<<8)&251719695,i=(i|i<<4)&3272356035,i=(i|i<<2)&1227133513,n|i<<2},We.deinterleave3=function(n,s){return n=n>>>s&1227133513,n=(n|n>>>2)&3272356035,n=(n|n>>>4)&251719695,n=(n|n>>>8)&4278190335,n=(n|n>>>16)&1023,n<<22>>22},We.nextCombination=function(n){var s=n|n-1;return s+1|(~s&-~s)-1>>>e(n)+1},We}var lh,rb;function Ep(){if(rb)return lh;rb=1;var r=Dm(),e=Fm(),t=lO();return lh={fft:function n(s){var i=[],a=s.length;if(a==1)return Array.isArray(s[0])?[[s[0][0],s[0][1]]]:[[s[0],0]];for(var o=n(s.filter(h)),l=n(s.filter(f)),c=0;c<a/2;c++){var u=o[c],d=r.multiply(e.exponent(c,a),l[c]);i[c]=r.add(u,d),i[c+a/2]=r.subtract(u,d)}function h(p,m){return m%2==0}function f(p,m){return m%2==1}return i},fftInPlace:function(n){for(var s=n.length,i=t.countTrailingZeros(s),a=0;a<s;a++){var o=t.reverse(a)>>>t.INT_BITS-i;if(o>a){var l=[n[a],0];n[a]=n[o],n[o]=l}else n[o]=[n[o],0]}for(var c=2;c<=s;c+=c)for(var u=0;u<c/2;u++)for(var d=e.exponent(u,c),h=0;h<s/c;h++){var f=r.multiply(d,n[h*c+u+c/2]);n[h*c+u+c/2]=r.subtract(n[h*c+u],f),n[h*c+u]=r.add(n[h*c+u],f)}}},lh}var ch,sb;function cO(){if(sb)return ch;sb=1;var r=Ep().fft;return ch={ifft:function(t){for(var n=[],s=0;s<t.length;s++)n[s]=[t[s][1],t[s][0]];for(var i=r(n),a=[],o=0;o<i.length;o++)a[o]=[i[o][1]/i.length,i[o][0]/i.length];return a}},ch}var uh,ib;function Tx(){if(ib)return uh;ib=1;var r=Dm(),e=Fm(),t=function(n){for(var s=[],i=n.length,a=0;a<i;a++){s[a]=[0,0];for(var o=0;o<i;o++){var l=e.exponent(a*o,i),c;Array.isArray(n[o])?c=r.multiply(n[o],l):c=r.multiply([n[o],0],l),s[a]=r.add(s[a],c)}}return s};return uh=t,uh}var dh,ab;function uO(){if(ab)return dh;ab=1;var r=Tx();function e(t){for(var n=[],s=0;s<t.length;s++)n[s]=[t[s][1],t[s][0]];for(var i=r(n),a=[],o=0;o<i.length;o++)a[o]=[i[o][1]/i.length,i[o][0]/i.length];return a}return dh=e,dh}var hh,ob;function dO(){return ob||(ob=1,hh={fft:Ep().fft,ifft:cO().ifft,fftInPlace:Ep().fftInPlace,util:Fm(),dft:Tx(),idft:uO()}),hh}var hO=dO();const lb=ta(hO);function fO(r,e){if(e<=1||e>r.length)return[...r];const t=[];let n=0;for(let s=0;s<e;s++)s<r.length&&(n+=r[s]);for(let s=0;s<r.length;s++)s>=e&&(n=n-r[s-e]+r[s]),t.push(n/Math.min(e,s+1));return t}function pO(r,e,t){const n=1/t,s=1/(2*Math.PI*e),i=n/(s+n),a=[];let o=r[0]||0;for(let l=0;l<r.length;l++)o=o+i*(r[l]-o),a.push(o);return a}function mO(r,e,t){const n=1/t,s=1/(2*Math.PI*e),i=s/(s+n),a=[];let o=0,l=r[0]||0;for(let c=0;c<r.length;c++){const u=r[c],d=i*(o+u-l);a.push(d),o=d,l=u}return a}function Rx(r){const e=Math.pow(2,Math.ceil(Math.log2(r.length))),t=[...r];for(;t.length<e;)t.push(0);const n=lb.fft(t),s=lb.util.fftMag(n);return s.slice(0,Math.floor(s.length/2))}function gO(r,e){const t=Rx(r),n=t.length,s=Array.from({length:n},(a,o)=>o*e/(2*n)),i=t.map(a=>a*a);return{frequencies:s,powerSpectrum:i}}function _O(r,e){if(r.length<=1)return new Array(r.length).fill(0);const t=[],n=1/e;t.push((r[1]-r[0])/n);for(let s=1;s<r.length-1;s++)t.push((r[s+1]-r[s-1])/(2*n));return t.push((r[r.length-1]-r[r.length-2])/n),t}function bO(r,e){const t=[],n=1/e;let s=0;for(let i=0;i<r.length;i++)s+=r[i]*n,t.push(s);return t}var yO=ie("<option> </option>"),wO=ie("<option> </option>"),vO=ie('<div class="space-y-2"><label for="windowSize" class="text-sm font-medium">çªå£å¤§å°</label> <input id="windowSize" type="number" min="1" required class="w-full px-3 py-2 border rounded-md border-input bg-background"></div>'),xO=ie('<div class="space-y-2"><label for="cutoffFrequency" class="text-sm font-medium">æªæ­¢é¢ç (Hz)</label> <input id="cutoffFrequency" type="number" min="0.1" step="0.1" required class="w-full px-3 py-2 border rounded-md border-input bg-background"></div>'),kO=ie('<div class="space-y-4 py-4"><form class="space-y-4"><div class="grid gap-4"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="space-y-2"><label for="sourceChannel" class="text-sm font-medium">æºéé</label> <select id="sourceChannel" required class="w-full px-3 py-2 border rounded-md border-input bg-background"><option>éæ©ä¸ä¸ªéé</option><!></select></div> <div class="space-y-2"><label for="processingMethod" class="text-sm font-medium">å¤çæ¹æ³</label> <select id="processingMethod" class="w-full px-3 py-2 border rounded-md border-input bg-background"></select></div></div> <div class="space-y-2"><label for="newChannelName" class="text-sm font-medium">æ°ééåç§°</label> <input id="newChannelName" type="text" required class="w-full px-3 py-2 border rounded-md border-input bg-background"></div> <!> <!></div> <!></form></div>');function SO(r,e){$t(e,!1);const[t,n]=Yi(),s=()=>ul(dl,"$channels",t),i=[{id:"movingAverage",name:"ç§»å¨å¹³å",processor:fO,params:["windowSize"]},{id:"lowPass",name:"ä½éæ»¤æ³¢å¨",processor:pO,params:["cutoffFrequency","sampleRate"]},{id:"highPass",name:"é«éæ»¤æ³¢å¨",processor:mO,params:["cutoffFrequency","sampleRate"]},{id:"fft",name:"FFT",processor:Rx,params:[]},{id:"powerSpectrum",name:"åçè°±",processor:gO,params:["sampleRate"]},{id:"differentiate",name:"å¾®å",processor:_O,params:["sampleRate"]},{id:"integrate",name:"ç§¯å",processor:bO,params:["sampleRate"]}];let a=ze(i[0]),o=$e(e,"selectedChannelId",12,""),l=ze(""),c=ze(10),u=ze(100);function d(){if(!o()||!P(l))return;const O=s().find($=>$.id===o());if(!O)return;P(l)||se(l,`${O.name} (${P(a).name})`);const E={};P(a).params.includes("windowSize")&&(E.windowSize=P(c)),P(a).params.includes("cutoffFrequency")&&(E.cutoffFrequency=P(u)),P(a).params.includes("sampleRate")&&(E.sampleRate=O.sampleRate),_1(o(),P(a).processor,P(l),E),se(l,"")}td(()=>(cl(o()),P(a),s()),()=>{if(o()&&P(a)){const O=s().find(E=>E.id===o());O&&se(l,`${O.name} (${P(a).name})`)}}),nd(),wn();var h=kO(),f=L(h),p=L(f),m=L(p),g=L(m),_=B(L(g),2);De(()=>{o(),yp(()=>{s()})});var y=L(_);y.value=y.__value="";var b=B(y);Tn(b,1,s,Tr,(O,E)=>{var $=yO(),N={},R=L($);De(()=>{N!==(N=P(E).id)&&($.value=($.__value=P(E).id)??""),nt(R,P(E).name)}),Z(O,$)});var w=B(g,2),v=B(L(w),2);De(()=>{P(a),yp(()=>{})}),Tn(v,5,()=>i,Tr,(O,E)=>{var $=wO(),N={},R=L($);De(()=>{N!==(N=P(E))&&($.value=($.__value=P(E))??""),nt(R,P(E).name)}),Z(O,$)});var S=B(m,2),k=B(L(S),2),x=B(S,2);{var A=O=>{var E=vO(),$=B(L(E),2);ht($,()=>P(c),N=>se(c,N)),Z(O,E)};zt(x,O=>{P(a)&&P(a).params.includes("windowSize")&&O(A)})}var C=B(x,2);{var I=O=>{var E=xO(),$=B(L(E),2);ht($,()=>P(u),N=>se(u,N)),Z(O,E)};zt(C,O=>{P(a)&&P(a).params.includes("cutoffFrequency")&&O(I)})}var D=B(p,2);const Y=yn(()=>!o());Eo(D,{type:"submit",get disabled(){return P(Y)},class:"w-full",children:(O,E)=>{var $=Is("å¤çä¿¡å·");Z(O,$)},$$slots:{default:!0}}),Po(_,o),Po(v,()=>P(a),O=>se(a,O)),ht(k,()=>P(l),O=>se(l,O)),an("submit",f,Lm(d)),Z(r,h),Mt(),n()}/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function hl(r){return r+.5|0}const Kr=(r,e,t)=>Math.max(Math.min(r,t),e);function za(r){return Kr(hl(r*2.55),0,255)}function ts(r){return Kr(hl(r*255),0,255)}function wr(r){return Kr(hl(r/2.55)/100,0,1)}function cb(r){return Kr(hl(r*100),0,100)}const cn={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Ap=[..."0123456789ABCDEF"],PO=r=>Ap[r&15],EO=r=>Ap[(r&240)>>4]+Ap[r&15],Dl=r=>(r&240)>>4===(r&15),AO=r=>Dl(r.r)&&Dl(r.g)&&Dl(r.b)&&Dl(r.a);function OO(r){var e=r.length,t;return r[0]==="#"&&(e===4||e===5?t={r:255&cn[r[1]]*17,g:255&cn[r[2]]*17,b:255&cn[r[3]]*17,a:e===5?cn[r[4]]*17:255}:(e===7||e===9)&&(t={r:cn[r[1]]<<4|cn[r[2]],g:cn[r[3]]<<4|cn[r[4]],b:cn[r[5]]<<4|cn[r[6]],a:e===9?cn[r[7]]<<4|cn[r[8]]:255})),t}const TO=(r,e)=>r<255?e(r):"";function RO(r){var e=AO(r)?PO:EO;return r?"#"+e(r.r)+e(r.g)+e(r.b)+TO(r.a,e):void 0}const CO=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Cx(r,e,t){const n=e*Math.min(t,1-t),s=(i,a=(i+r/30)%12)=>t-n*Math.max(Math.min(a-3,9-a,1),-1);return[s(0),s(8),s(4)]}function IO(r,e,t){const n=(s,i=(s+r/60)%6)=>t-t*e*Math.max(Math.min(i,4-i,1),0);return[n(5),n(3),n(1)]}function $O(r,e,t){const n=Cx(r,1,.5);let s;for(e+t>1&&(s=1/(e+t),e*=s,t*=s),s=0;s<3;s++)n[s]*=1-e-t,n[s]+=e;return n}function MO(r,e,t,n,s){return r===s?(e-t)/n+(e<t?6:0):e===s?(t-r)/n+2:(r-e)/n+4}function Bm(r){const t=r.r/255,n=r.g/255,s=r.b/255,i=Math.max(t,n,s),a=Math.min(t,n,s),o=(i+a)/2;let l,c,u;return i!==a&&(u=i-a,c=o>.5?u/(2-i-a):u/(i+a),l=MO(t,n,s,u,i),l=l*60+.5),[l|0,c||0,o]}function zm(r,e,t,n){return(Array.isArray(e)?r(e[0],e[1],e[2]):r(e,t,n)).map(ts)}function Um(r,e,t){return zm(Cx,r,e,t)}function NO(r,e,t){return zm($O,r,e,t)}function LO(r,e,t){return zm(IO,r,e,t)}function Ix(r){return(r%360+360)%360}function jO(r){const e=CO.exec(r);let t=255,n;if(!e)return;e[5]!==n&&(t=e[6]?za(+e[5]):ts(+e[5]));const s=Ix(+e[2]),i=+e[3]/100,a=+e[4]/100;return e[1]==="hwb"?n=NO(s,i,a):e[1]==="hsv"?n=LO(s,i,a):n=Um(s,i,a),{r:n[0],g:n[1],b:n[2],a:t}}function DO(r,e){var t=Bm(r);t[0]=Ix(t[0]+e),t=Um(t),r.r=t[0],r.g=t[1],r.b=t[2]}function FO(r){if(!r)return;const e=Bm(r),t=e[0],n=cb(e[1]),s=cb(e[2]);return r.a<255?`hsla(${t}, ${n}%, ${s}%, ${wr(r.a)})`:`hsl(${t}, ${n}%, ${s}%)`}const ub={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},db={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function BO(){const r={},e=Object.keys(db),t=Object.keys(ub);let n,s,i,a,o;for(n=0;n<e.length;n++){for(a=o=e[n],s=0;s<t.length;s++)i=t[s],o=o.replace(i,ub[i]);i=parseInt(db[a],16),r[o]=[i>>16&255,i>>8&255,i&255]}return r}let Fl;function zO(r){Fl||(Fl=BO(),Fl.transparent=[0,0,0,0]);const e=Fl[r.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const UO=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function qO(r){const e=UO.exec(r);let t=255,n,s,i;if(e){if(e[7]!==n){const a=+e[7];t=e[8]?za(a):Kr(a*255,0,255)}return n=+e[1],s=+e[3],i=+e[5],n=255&(e[2]?za(n):Kr(n,0,255)),s=255&(e[4]?za(s):Kr(s,0,255)),i=255&(e[6]?za(i):Kr(i,0,255)),{r:n,g:s,b:i,a:t}}}function WO(r){return r&&(r.a<255?`rgba(${r.r}, ${r.g}, ${r.b}, ${wr(r.a)})`:`rgb(${r.r}, ${r.g}, ${r.b})`)}const fh=r=>r<=.0031308?r*12.92:Math.pow(r,1/2.4)*1.055-.055,oi=r=>r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4);function HO(r,e,t){const n=oi(wr(r.r)),s=oi(wr(r.g)),i=oi(wr(r.b));return{r:ts(fh(n+t*(oi(wr(e.r))-n))),g:ts(fh(s+t*(oi(wr(e.g))-s))),b:ts(fh(i+t*(oi(wr(e.b))-i))),a:r.a+t*(e.a-r.a)}}function Bl(r,e,t){if(r){let n=Bm(r);n[e]=Math.max(0,Math.min(n[e]+n[e]*t,e===0?360:1)),n=Um(n),r.r=n[0],r.g=n[1],r.b=n[2]}}function $x(r,e){return r&&Object.assign(e||{},r)}function hb(r){var e={r:0,g:0,b:0,a:255};return Array.isArray(r)?r.length>=3&&(e={r:r[0],g:r[1],b:r[2],a:255},r.length>3&&(e.a=ts(r[3]))):(e=$x(r,{r:0,g:0,b:0,a:1}),e.a=ts(e.a)),e}function VO(r){return r.charAt(0)==="r"?qO(r):jO(r)}class Ao{constructor(e){if(e instanceof Ao)return e;const t=typeof e;let n;t==="object"?n=hb(e):t==="string"&&(n=OO(e)||zO(e)||VO(e)),this._rgb=n,this._valid=!!n}get valid(){return this._valid}get rgb(){var e=$x(this._rgb);return e&&(e.a=wr(e.a)),e}set rgb(e){this._rgb=hb(e)}rgbString(){return this._valid?WO(this._rgb):void 0}hexString(){return this._valid?RO(this._rgb):void 0}hslString(){return this._valid?FO(this._rgb):void 0}mix(e,t){if(e){const n=this.rgb,s=e.rgb;let i;const a=t===i?.5:t,o=2*a-1,l=n.a-s.a,c=((o*l===-1?o:(o+l)/(1+o*l))+1)/2;i=1-c,n.r=255&c*n.r+i*s.r+.5,n.g=255&c*n.g+i*s.g+.5,n.b=255&c*n.b+i*s.b+.5,n.a=a*n.a+(1-a)*s.a,this.rgb=n}return this}interpolate(e,t){return e&&(this._rgb=HO(this._rgb,e._rgb,t)),this}clone(){return new Ao(this.rgb)}alpha(e){return this._rgb.a=ts(e),this}clearer(e){const t=this._rgb;return t.a*=1-e,this}greyscale(){const e=this._rgb,t=hl(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=t,this}opaquer(e){const t=this._rgb;return t.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return Bl(this._rgb,2,e),this}darken(e){return Bl(this._rgb,2,-e),this}saturate(e){return Bl(this._rgb,1,e),this}desaturate(e){return Bl(this._rgb,1,-e),this}rotate(e){return DO(this._rgb,e),this}}/*!
 * Chart.js v4.4.9
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function dr(){}const ZO=(()=>{let r=0;return()=>r++})();function ye(r){return r==null}function Ue(r){if(Array.isArray&&Array.isArray(r))return!0;const e=Object.prototype.toString.call(r);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function we(r){return r!==null&&Object.prototype.toString.call(r)==="[object Object]"}function Ge(r){return(typeof r=="number"||r instanceof Number)&&isFinite(+r)}function tn(r,e){return Ge(r)?r:e}function ae(r,e){return typeof r>"u"?e:r}const GO=(r,e)=>typeof r=="string"&&r.endsWith("%")?parseFloat(r)/100:+r/e,Mx=(r,e)=>typeof r=="string"&&r.endsWith("%")?parseFloat(r)/100*e:+r;function je(r,e,t){if(r&&typeof r.call=="function")return r.apply(t,e)}function Re(r,e,t,n){let s,i,a;if(Ue(r))for(i=r.length,s=0;s<i;s++)e.call(t,r[s],s);else if(we(r))for(a=Object.keys(r),i=a.length,s=0;s<i;s++)e.call(t,r[a[s]],a[s])}function du(r,e){let t,n,s,i;if(!r||!e||r.length!==e.length)return!1;for(t=0,n=r.length;t<n;++t)if(s=r[t],i=e[t],s.datasetIndex!==i.datasetIndex||s.index!==i.index)return!1;return!0}function hu(r){if(Ue(r))return r.map(hu);if(we(r)){const e=Object.create(null),t=Object.keys(r),n=t.length;let s=0;for(;s<n;++s)e[t[s]]=hu(r[t[s]]);return e}return r}function Nx(r){return["__proto__","prototype","constructor"].indexOf(r)===-1}function JO(r,e,t,n){if(!Nx(r))return;const s=e[r],i=t[r];we(s)&&we(i)?Oo(s,i,n):e[r]=hu(i)}function Oo(r,e,t){const n=Ue(e)?e:[e],s=n.length;if(!we(r))return r;t=t||{};const i=t.merger||JO;let a;for(let o=0;o<s;++o){if(a=n[o],!we(a))continue;const l=Object.keys(a);for(let c=0,u=l.length;c<u;++c)i(l[c],r,a,t)}return r}function so(r,e){return Oo(r,e,{merger:KO})}function KO(r,e,t){if(!Nx(r))return;const n=e[r],s=t[r];we(n)&&we(s)?so(n,s):Object.prototype.hasOwnProperty.call(e,r)||(e[r]=hu(s))}const fb={"":r=>r,x:r=>r.x,y:r=>r.y};function XO(r){const e=r.split("."),t=[];let n="";for(const s of e)n+=s,n.endsWith("\\")?n=n.slice(0,-1)+".":(t.push(n),n="");return t}function YO(r){const e=XO(r);return t=>{for(const n of e){if(n==="")break;t=t&&t[n]}return t}}function is(r,e){return(fb[e]||(fb[e]=YO(e)))(r)}function qm(r){return r.charAt(0).toUpperCase()+r.slice(1)}const To=r=>typeof r<"u",as=r=>typeof r=="function",pb=(r,e)=>{if(r.size!==e.size)return!1;for(const t of r)if(!e.has(t))return!1;return!0};function QO(r){return r.type==="mouseup"||r.type==="click"||r.type==="contextmenu"}const Be=Math.PI,Fe=2*Be,eT=Fe+Be,fu=Number.POSITIVE_INFINITY,tT=Be/180,Ke=Be/2,xs=Be/4,mb=Be*2/3,Xr=Math.log10,nr=Math.sign;function io(r,e,t){return Math.abs(r-e)<t}function gb(r){const e=Math.round(r);r=io(r,e,r/1e3)?e:r;const t=Math.pow(10,Math.floor(Xr(r))),n=r/t;return(n<=1?1:n<=2?2:n<=5?5:10)*t}function nT(r){const e=[],t=Math.sqrt(r);let n;for(n=1;n<t;n++)r%n===0&&(e.push(n),e.push(r/n));return t===(t|0)&&e.push(t),e.sort((s,i)=>s-i).pop(),e}function rT(r){return typeof r=="symbol"||typeof r=="object"&&r!==null&&!(Symbol.toPrimitive in r||"toString"in r||"valueOf"in r)}function Di(r){return!rT(r)&&!isNaN(parseFloat(r))&&isFinite(r)}function sT(r,e){const t=Math.round(r);return t-e<=r&&t+e>=r}function Lx(r,e,t){let n,s,i;for(n=0,s=r.length;n<s;n++)i=r[n][t],isNaN(i)||(e.min=Math.min(e.min,i),e.max=Math.max(e.max,i))}function Rn(r){return r*(Be/180)}function Wm(r){return r*(180/Be)}function _b(r){if(!Ge(r))return;let e=1,t=0;for(;Math.round(r*e)/e!==r;)e*=10,t++;return t}function jx(r,e){const t=e.x-r.x,n=e.y-r.y,s=Math.sqrt(t*t+n*n);let i=Math.atan2(n,t);return i<-.5*Be&&(i+=Fe),{angle:i,distance:s}}function Op(r,e){return Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2))}function iT(r,e){return(r-e+eT)%Fe-Be}function rn(r){return(r%Fe+Fe)%Fe}function Ro(r,e,t,n){const s=rn(r),i=rn(e),a=rn(t),o=rn(i-s),l=rn(a-s),c=rn(s-i),u=rn(s-a);return s===i||s===a||n&&i===a||o>l&&c<u}function lt(r,e,t){return Math.max(e,Math.min(t,r))}function aT(r){return lt(r,-32768,32767)}function Sr(r,e,t,n=1e-6){return r>=Math.min(e,t)-n&&r<=Math.max(e,t)+n}function Hm(r,e,t){t=t||(a=>r[a]<e);let n=r.length-1,s=0,i;for(;n-s>1;)i=s+n>>1,t(i)?s=i:n=i;return{lo:s,hi:n}}const Pr=(r,e,t,n)=>Hm(r,t,n?s=>{const i=r[s][e];return i<t||i===t&&r[s+1][e]===t}:s=>r[s][e]<t),oT=(r,e,t)=>Hm(r,t,n=>r[n][e]>=t);function lT(r,e,t){let n=0,s=r.length;for(;n<s&&r[n]<e;)n++;for(;s>n&&r[s-1]>t;)s--;return n>0||s<r.length?r.slice(n,s):r}const Dx=["push","pop","shift","splice","unshift"];function cT(r,e){if(r._chartjs){r._chartjs.listeners.push(e);return}Object.defineProperty(r,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),Dx.forEach(t=>{const n="_onData"+qm(t),s=r[t];Object.defineProperty(r,t,{configurable:!0,enumerable:!1,value(...i){const a=s.apply(this,i);return r._chartjs.listeners.forEach(o=>{typeof o[n]=="function"&&o[n](...i)}),a}})})}function bb(r,e){const t=r._chartjs;if(!t)return;const n=t.listeners,s=n.indexOf(e);s!==-1&&n.splice(s,1),!(n.length>0)&&(Dx.forEach(i=>{delete r[i]}),delete r._chartjs)}function Fx(r){const e=new Set(r);return e.size===r.length?r:Array.from(e)}const Bx=function(){return typeof window>"u"?function(r){return r()}:window.requestAnimationFrame}();function zx(r,e){let t=[],n=!1;return function(...s){t=s,n||(n=!0,Bx.call(window,()=>{n=!1,r.apply(e,t)}))}}function uT(r,e){let t;return function(...n){return e?(clearTimeout(t),t=setTimeout(r,e,n)):r.apply(this,n),e}}const Vm=r=>r==="start"?"left":r==="end"?"right":"center",_t=(r,e,t)=>r==="start"?e:r==="end"?t:(e+t)/2,dT=(r,e,t,n)=>r===(n?"left":"right")?t:r==="center"?(e+t)/2:e;function Ux(r,e,t){const n=e.length;let s=0,i=n;if(r._sorted){const{iScale:a,vScale:o,_parsed:l}=r,c=r.dataset&&r.dataset.options?r.dataset.options.spanGaps:null,u=a.axis,{min:d,max:h,minDefined:f,maxDefined:p}=a.getUserBounds();if(f){if(s=Math.min(Pr(l,u,d).lo,t?n:Pr(e,u,a.getPixelForValue(d)).lo),c){const m=l.slice(0,s+1).reverse().findIndex(g=>!ye(g[o.axis]));s-=Math.max(0,m)}s=lt(s,0,n-1)}if(p){let m=Math.max(Pr(l,a.axis,h,!0).hi+1,t?0:Pr(e,u,a.getPixelForValue(h),!0).hi+1);if(c){const g=l.slice(m-1).findIndex(_=>!ye(_[o.axis]));m+=Math.max(0,g)}i=lt(m,s,n)-s}else i=n-s}return{start:s,count:i}}function qx(r){const{xScale:e,yScale:t,_scaleRanges:n}=r,s={xmin:e.min,xmax:e.max,ymin:t.min,ymax:t.max};if(!n)return r._scaleRanges=s,!0;const i=n.xmin!==e.min||n.xmax!==e.max||n.ymin!==t.min||n.ymax!==t.max;return Object.assign(n,s),i}const zl=r=>r===0||r===1,yb=(r,e,t)=>-(Math.pow(2,10*(r-=1))*Math.sin((r-e)*Fe/t)),wb=(r,e,t)=>Math.pow(2,-10*r)*Math.sin((r-e)*Fe/t)+1,ao={linear:r=>r,easeInQuad:r=>r*r,easeOutQuad:r=>-r*(r-2),easeInOutQuad:r=>(r/=.5)<1?.5*r*r:-.5*(--r*(r-2)-1),easeInCubic:r=>r*r*r,easeOutCubic:r=>(r-=1)*r*r+1,easeInOutCubic:r=>(r/=.5)<1?.5*r*r*r:.5*((r-=2)*r*r+2),easeInQuart:r=>r*r*r*r,easeOutQuart:r=>-((r-=1)*r*r*r-1),easeInOutQuart:r=>(r/=.5)<1?.5*r*r*r*r:-.5*((r-=2)*r*r*r-2),easeInQuint:r=>r*r*r*r*r,easeOutQuint:r=>(r-=1)*r*r*r*r+1,easeInOutQuint:r=>(r/=.5)<1?.5*r*r*r*r*r:.5*((r-=2)*r*r*r*r+2),easeInSine:r=>-Math.cos(r*Ke)+1,easeOutSine:r=>Math.sin(r*Ke),easeInOutSine:r=>-.5*(Math.cos(Be*r)-1),easeInExpo:r=>r===0?0:Math.pow(2,10*(r-1)),easeOutExpo:r=>r===1?1:-Math.pow(2,-10*r)+1,easeInOutExpo:r=>zl(r)?r:r<.5?.5*Math.pow(2,10*(r*2-1)):.5*(-Math.pow(2,-10*(r*2-1))+2),easeInCirc:r=>r>=1?r:-(Math.sqrt(1-r*r)-1),easeOutCirc:r=>Math.sqrt(1-(r-=1)*r),easeInOutCirc:r=>(r/=.5)<1?-.5*(Math.sqrt(1-r*r)-1):.5*(Math.sqrt(1-(r-=2)*r)+1),easeInElastic:r=>zl(r)?r:yb(r,.075,.3),easeOutElastic:r=>zl(r)?r:wb(r,.075,.3),easeInOutElastic(r){return zl(r)?r:r<.5?.5*yb(r*2,.1125,.45):.5+.5*wb(r*2-1,.1125,.45)},easeInBack(r){return r*r*((1.70158+1)*r-1.70158)},easeOutBack(r){return(r-=1)*r*((1.70158+1)*r+1.70158)+1},easeInOutBack(r){let e=1.70158;return(r/=.5)<1?.5*(r*r*(((e*=1.525)+1)*r-e)):.5*((r-=2)*r*(((e*=1.525)+1)*r+e)+2)},easeInBounce:r=>1-ao.easeOutBounce(1-r),easeOutBounce(r){return r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375},easeInOutBounce:r=>r<.5?ao.easeInBounce(r*2)*.5:ao.easeOutBounce(r*2-1)*.5+.5};function Zm(r){if(r&&typeof r=="object"){const e=r.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function vb(r){return Zm(r)?r:new Ao(r)}function ph(r){return Zm(r)?r:new Ao(r).saturate(.5).darken(.1).hexString()}const hT=["x","y","borderWidth","radius","tension"],fT=["color","borderColor","backgroundColor"];function pT(r){r.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),r.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),r.set("animations",{colors:{type:"color",properties:fT},numbers:{type:"number",properties:hT}}),r.describe("animations",{_fallback:"animation"}),r.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function mT(r){r.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const xb=new Map;function gT(r,e){e=e||{};const t=r+JSON.stringify(e);let n=xb.get(t);return n||(n=new Intl.NumberFormat(r,e),xb.set(t,n)),n}function fl(r,e,t){return gT(e,t).format(r)}const Wx={values(r){return Ue(r)?r:""+r},numeric(r,e,t){if(r===0)return"0";const n=this.chart.options.locale;let s,i=r;if(t.length>1){const c=Math.max(Math.abs(t[0].value),Math.abs(t[t.length-1].value));(c<1e-4||c>1e15)&&(s="scientific"),i=_T(r,t)}const a=Xr(Math.abs(i)),o=isNaN(a)?1:Math.max(Math.min(-1*Math.floor(a),20),0),l={notation:s,minimumFractionDigits:o,maximumFractionDigits:o};return Object.assign(l,this.options.ticks.format),fl(r,n,l)},logarithmic(r,e,t){if(r===0)return"0";const n=t[e].significand||r/Math.pow(10,Math.floor(Xr(r)));return[1,2,3,5,10,15].includes(n)||e>.8*t.length?Wx.numeric.call(this,r,e,t):""}};function _T(r,e){let t=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(t)>=1&&r!==Math.floor(r)&&(t=r-Math.floor(r)),t}var cd={formatters:Wx};function bT(r){r.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,t)=>t.lineWidth,tickColor:(e,t)=>t.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:cd.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),r.route("scale.ticks","color","","color"),r.route("scale.grid","color","","borderColor"),r.route("scale.border","color","","borderColor"),r.route("scale.title","color","","color"),r.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),r.describe("scales",{_fallback:"scale"}),r.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}const Hs=Object.create(null),Tp=Object.create(null);function oo(r,e){if(!e)return r;const t=e.split(".");for(let n=0,s=t.length;n<s;++n){const i=t[n];r=r[i]||(r[i]=Object.create(null))}return r}function mh(r,e,t){return typeof e=="string"?Oo(oo(r,e),t):Oo(oo(r,""),e)}class yT{constructor(e,t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=n=>n.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(n,s)=>ph(s.backgroundColor),this.hoverBorderColor=(n,s)=>ph(s.borderColor),this.hoverColor=(n,s)=>ph(s.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(t)}set(e,t){return mh(this,e,t)}get(e){return oo(this,e)}describe(e,t){return mh(Tp,e,t)}override(e,t){return mh(Hs,e,t)}route(e,t,n,s){const i=oo(this,e),a=oo(this,n),o="_"+t;Object.defineProperties(i,{[o]:{value:i[t],writable:!0},[t]:{enumerable:!0,get(){const l=this[o],c=a[s];return we(l)?Object.assign({},c,l):ae(l,c)},set(l){this[o]=l}}})}apply(e){e.forEach(t=>t(this))}}var qe=new yT({_scriptable:r=>!r.startsWith("on"),_indexable:r=>r!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[pT,mT,bT]);function wT(r){return!r||ye(r.size)||ye(r.family)?null:(r.style?r.style+" ":"")+(r.weight?r.weight+" ":"")+r.size+"px "+r.family}function pu(r,e,t,n,s){let i=e[s];return i||(i=e[s]=r.measureText(s).width,t.push(s)),i>n&&(n=i),n}function vT(r,e,t,n){n=n||{};let s=n.data=n.data||{},i=n.garbageCollect=n.garbageCollect||[];n.font!==e&&(s=n.data={},i=n.garbageCollect=[],n.font=e),r.save(),r.font=e;let a=0;const o=t.length;let l,c,u,d,h;for(l=0;l<o;l++)if(d=t[l],d!=null&&!Ue(d))a=pu(r,s,i,a,d);else if(Ue(d))for(c=0,u=d.length;c<u;c++)h=d[c],h!=null&&!Ue(h)&&(a=pu(r,s,i,a,h));r.restore();const f=i.length/2;if(f>t.length){for(l=0;l<f;l++)delete s[i[l]];i.splice(0,f)}return a}function ks(r,e,t){const n=r.currentDevicePixelRatio,s=t!==0?Math.max(t/2,.5):0;return Math.round((e-s)*n)/n+s}function kb(r,e){!e&&!r||(e=e||r.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,r.width,r.height),e.restore())}function Rp(r,e,t,n){Hx(r,e,t,n,null)}function Hx(r,e,t,n,s){let i,a,o,l,c,u,d,h;const f=e.pointStyle,p=e.rotation,m=e.radius;let g=(p||0)*tT;if(f&&typeof f=="object"&&(i=f.toString(),i==="[object HTMLImageElement]"||i==="[object HTMLCanvasElement]")){r.save(),r.translate(t,n),r.rotate(g),r.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),r.restore();return}if(!(isNaN(m)||m<=0)){switch(r.beginPath(),f){default:s?r.ellipse(t,n,s/2,m,0,0,Fe):r.arc(t,n,m,0,Fe),r.closePath();break;case"triangle":u=s?s/2:m,r.moveTo(t+Math.sin(g)*u,n-Math.cos(g)*m),g+=mb,r.lineTo(t+Math.sin(g)*u,n-Math.cos(g)*m),g+=mb,r.lineTo(t+Math.sin(g)*u,n-Math.cos(g)*m),r.closePath();break;case"rectRounded":c=m*.516,l=m-c,a=Math.cos(g+xs)*l,d=Math.cos(g+xs)*(s?s/2-c:l),o=Math.sin(g+xs)*l,h=Math.sin(g+xs)*(s?s/2-c:l),r.arc(t-d,n-o,c,g-Be,g-Ke),r.arc(t+h,n-a,c,g-Ke,g),r.arc(t+d,n+o,c,g,g+Ke),r.arc(t-h,n+a,c,g+Ke,g+Be),r.closePath();break;case"rect":if(!p){l=Math.SQRT1_2*m,u=s?s/2:l,r.rect(t-u,n-l,2*u,2*l);break}g+=xs;case"rectRot":d=Math.cos(g)*(s?s/2:m),a=Math.cos(g)*m,o=Math.sin(g)*m,h=Math.sin(g)*(s?s/2:m),r.moveTo(t-d,n-o),r.lineTo(t+h,n-a),r.lineTo(t+d,n+o),r.lineTo(t-h,n+a),r.closePath();break;case"crossRot":g+=xs;case"cross":d=Math.cos(g)*(s?s/2:m),a=Math.cos(g)*m,o=Math.sin(g)*m,h=Math.sin(g)*(s?s/2:m),r.moveTo(t-d,n-o),r.lineTo(t+d,n+o),r.moveTo(t+h,n-a),r.lineTo(t-h,n+a);break;case"star":d=Math.cos(g)*(s?s/2:m),a=Math.cos(g)*m,o=Math.sin(g)*m,h=Math.sin(g)*(s?s/2:m),r.moveTo(t-d,n-o),r.lineTo(t+d,n+o),r.moveTo(t+h,n-a),r.lineTo(t-h,n+a),g+=xs,d=Math.cos(g)*(s?s/2:m),a=Math.cos(g)*m,o=Math.sin(g)*m,h=Math.sin(g)*(s?s/2:m),r.moveTo(t-d,n-o),r.lineTo(t+d,n+o),r.moveTo(t+h,n-a),r.lineTo(t-h,n+a);break;case"line":a=s?s/2:Math.cos(g)*m,o=Math.sin(g)*m,r.moveTo(t-a,n-o),r.lineTo(t+a,n+o);break;case"dash":r.moveTo(t,n),r.lineTo(t+Math.cos(g)*(s?s/2:m),n+Math.sin(g)*m);break;case!1:r.closePath();break}r.fill(),e.borderWidth>0&&r.stroke()}}function Er(r,e,t){return t=t||.5,!e||r&&r.x>e.left-t&&r.x<e.right+t&&r.y>e.top-t&&r.y<e.bottom+t}function ud(r,e){r.save(),r.beginPath(),r.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),r.clip()}function dd(r){r.restore()}function xT(r,e,t,n,s){if(!e)return r.lineTo(t.x,t.y);if(s==="middle"){const i=(e.x+t.x)/2;r.lineTo(i,e.y),r.lineTo(i,t.y)}else s==="after"!=!!n?r.lineTo(e.x,t.y):r.lineTo(t.x,e.y);r.lineTo(t.x,t.y)}function kT(r,e,t,n){if(!e)return r.lineTo(t.x,t.y);r.bezierCurveTo(n?e.cp1x:e.cp2x,n?e.cp1y:e.cp2y,n?t.cp2x:t.cp1x,n?t.cp2y:t.cp1y,t.x,t.y)}function ST(r,e){e.translation&&r.translate(e.translation[0],e.translation[1]),ye(e.rotation)||r.rotate(e.rotation),e.color&&(r.fillStyle=e.color),e.textAlign&&(r.textAlign=e.textAlign),e.textBaseline&&(r.textBaseline=e.textBaseline)}function PT(r,e,t,n,s){if(s.strikethrough||s.underline){const i=r.measureText(n),a=e-i.actualBoundingBoxLeft,o=e+i.actualBoundingBoxRight,l=t-i.actualBoundingBoxAscent,c=t+i.actualBoundingBoxDescent,u=s.strikethrough?(l+c)/2:c;r.strokeStyle=r.fillStyle,r.beginPath(),r.lineWidth=s.decorationWidth||2,r.moveTo(a,u),r.lineTo(o,u),r.stroke()}}function ET(r,e){const t=r.fillStyle;r.fillStyle=e.color,r.fillRect(e.left,e.top,e.width,e.height),r.fillStyle=t}function Vs(r,e,t,n,s,i={}){const a=Ue(e)?e:[e],o=i.strokeWidth>0&&i.strokeColor!=="";let l,c;for(r.save(),r.font=s.string,ST(r,i),l=0;l<a.length;++l)c=a[l],i.backdrop&&ET(r,i.backdrop),o&&(i.strokeColor&&(r.strokeStyle=i.strokeColor),ye(i.strokeWidth)||(r.lineWidth=i.strokeWidth),r.strokeText(c,t,n,i.maxWidth)),r.fillText(c,t,n,i.maxWidth),PT(r,t,n,c,i),n+=Number(s.lineHeight);r.restore()}function Co(r,e){const{x:t,y:n,w:s,h:i,radius:a}=e;r.arc(t+a.topLeft,n+a.topLeft,a.topLeft,1.5*Be,Be,!0),r.lineTo(t,n+i-a.bottomLeft),r.arc(t+a.bottomLeft,n+i-a.bottomLeft,a.bottomLeft,Be,Ke,!0),r.lineTo(t+s-a.bottomRight,n+i),r.arc(t+s-a.bottomRight,n+i-a.bottomRight,a.bottomRight,Ke,0,!0),r.lineTo(t+s,n+a.topRight),r.arc(t+s-a.topRight,n+a.topRight,a.topRight,0,-Ke,!0),r.lineTo(t+a.topLeft,n)}const AT=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,OT=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function TT(r,e){const t=(""+r).match(AT);if(!t||t[1]==="normal")return e*1.2;switch(r=+t[2],t[3]){case"px":return r;case"%":r/=100;break}return e*r}const RT=r=>+r||0;function Gm(r,e){const t={},n=we(e),s=n?Object.keys(e):e,i=we(r)?n?a=>ae(r[a],r[e[a]]):a=>r[a]:()=>r;for(const a of s)t[a]=RT(i(a));return t}function Vx(r){return Gm(r,{top:"y",right:"x",bottom:"y",left:"x"})}function js(r){return Gm(r,["topLeft","topRight","bottomLeft","bottomRight"])}function vt(r){const e=Vx(r);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function st(r,e){r=r||{},e=e||qe.font;let t=ae(r.size,e.size);typeof t=="string"&&(t=parseInt(t,10));let n=ae(r.style,e.style);n&&!(""+n).match(OT)&&(console.warn('Invalid font style specified: "'+n+'"'),n=void 0);const s={family:ae(r.family,e.family),lineHeight:TT(ae(r.lineHeight,e.lineHeight),t),size:t,style:n,weight:ae(r.weight,e.weight),string:""};return s.string=wT(s),s}function Ua(r,e,t,n){let s,i,a;for(s=0,i=r.length;s<i;++s)if(a=r[s],a!==void 0&&a!==void 0)return a}function CT(r,e,t){const{min:n,max:s}=r,i=Mx(e,(s-n)/2),a=(o,l)=>t&&o===0?0:o+l;return{min:a(n,-Math.abs(i)),max:a(s,i)}}function gs(r,e){return Object.assign(Object.create(r),e)}function Jm(r,e=[""],t,n,s=()=>r[0]){const i=t||r;typeof n>"u"&&(n=Kx("_fallback",r));const a={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:r,_rootScopes:i,_fallback:n,_getTarget:s,override:o=>Jm([o,...r],e,i,n)};return new Proxy(a,{deleteProperty(o,l){return delete o[l],delete o._keys,delete r[0][l],!0},get(o,l){return Gx(o,l,()=>FT(l,e,r,o))},getOwnPropertyDescriptor(o,l){return Reflect.getOwnPropertyDescriptor(o._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(r[0])},has(o,l){return Pb(o).includes(l)},ownKeys(o){return Pb(o)},set(o,l,c){const u=o._storage||(o._storage=s());return o[l]=u[l]=c,delete o._keys,!0}})}function Fi(r,e,t,n){const s={_cacheable:!1,_proxy:r,_context:e,_subProxy:t,_stack:new Set,_descriptors:Zx(r,n),setContext:i=>Fi(r,i,t,n),override:i=>Fi(r.override(i),e,t,n)};return new Proxy(s,{deleteProperty(i,a){return delete i[a],delete r[a],!0},get(i,a,o){return Gx(i,a,()=>$T(i,a,o))},getOwnPropertyDescriptor(i,a){return i._descriptors.allKeys?Reflect.has(r,a)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(r,a)},getPrototypeOf(){return Reflect.getPrototypeOf(r)},has(i,a){return Reflect.has(r,a)},ownKeys(){return Reflect.ownKeys(r)},set(i,a,o){return r[a]=o,delete i[a],!0}})}function Zx(r,e={scriptable:!0,indexable:!0}){const{_scriptable:t=e.scriptable,_indexable:n=e.indexable,_allKeys:s=e.allKeys}=r;return{allKeys:s,scriptable:t,indexable:n,isScriptable:as(t)?t:()=>t,isIndexable:as(n)?n:()=>n}}const IT=(r,e)=>r?r+qm(e):e,Km=(r,e)=>we(e)&&r!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function Gx(r,e,t){if(Object.prototype.hasOwnProperty.call(r,e)||e==="constructor")return r[e];const n=t();return r[e]=n,n}function $T(r,e,t){const{_proxy:n,_context:s,_subProxy:i,_descriptors:a}=r;let o=n[e];return as(o)&&a.isScriptable(e)&&(o=MT(e,o,r,t)),Ue(o)&&o.length&&(o=NT(e,o,r,a.isIndexable)),Km(e,o)&&(o=Fi(o,s,i&&i[e],a)),o}function MT(r,e,t,n){const{_proxy:s,_context:i,_subProxy:a,_stack:o}=t;if(o.has(r))throw new Error("Recursion detected: "+Array.from(o).join("->")+"->"+r);o.add(r);let l=e(i,a||n);return o.delete(r),Km(r,l)&&(l=Xm(s._scopes,s,r,l)),l}function NT(r,e,t,n){const{_proxy:s,_context:i,_subProxy:a,_descriptors:o}=t;if(typeof i.index<"u"&&n(r))return e[i.index%e.length];if(we(e[0])){const l=e,c=s._scopes.filter(u=>u!==l);e=[];for(const u of l){const d=Xm(c,s,r,u);e.push(Fi(d,i,a&&a[r],o))}}return e}function Jx(r,e,t){return as(r)?r(e,t):r}const LT=(r,e)=>r===!0?e:typeof r=="string"?is(e,r):void 0;function jT(r,e,t,n,s){for(const i of e){const a=LT(t,i);if(a){r.add(a);const o=Jx(a._fallback,t,s);if(typeof o<"u"&&o!==t&&o!==n)return o}else if(a===!1&&typeof n<"u"&&t!==n)return null}return!1}function Xm(r,e,t,n){const s=e._rootScopes,i=Jx(e._fallback,t,n),a=[...r,...s],o=new Set;o.add(n);let l=Sb(o,a,t,i||t,n);return l===null||typeof i<"u"&&i!==t&&(l=Sb(o,a,i,l,n),l===null)?!1:Jm(Array.from(o),[""],s,i,()=>DT(e,t,n))}function Sb(r,e,t,n,s){for(;t;)t=jT(r,e,t,n,s);return t}function DT(r,e,t){const n=r._getTarget();e in n||(n[e]={});const s=n[e];return Ue(s)&&we(t)?t:s||{}}function FT(r,e,t,n){let s;for(const i of e)if(s=Kx(IT(i,r),t),typeof s<"u")return Km(r,s)?Xm(t,n,r,s):s}function Kx(r,e){for(const t of e){if(!t)continue;const n=t[r];if(typeof n<"u")return n}}function Pb(r){let e=r._keys;return e||(e=r._keys=BT(r._scopes)),e}function BT(r){const e=new Set;for(const t of r)for(const n of Object.keys(t).filter(s=>!s.startsWith("_")))e.add(n);return Array.from(e)}function Xx(r,e,t,n){const{iScale:s}=r,{key:i="r"}=this._parsing,a=new Array(n);let o,l,c,u;for(o=0,l=n;o<l;++o)c=o+t,u=e[c],a[o]={r:s.parse(is(u,i),c)};return a}const zT=Number.EPSILON||1e-14,Bi=(r,e)=>e<r.length&&!r[e].skip&&r[e],Yx=r=>r==="x"?"y":"x";function UT(r,e,t,n){const s=r.skip?e:r,i=e,a=t.skip?e:t,o=Op(i,s),l=Op(a,i);let c=o/(o+l),u=l/(o+l);c=isNaN(c)?0:c,u=isNaN(u)?0:u;const d=n*c,h=n*u;return{previous:{x:i.x-d*(a.x-s.x),y:i.y-d*(a.y-s.y)},next:{x:i.x+h*(a.x-s.x),y:i.y+h*(a.y-s.y)}}}function qT(r,e,t){const n=r.length;let s,i,a,o,l,c=Bi(r,0);for(let u=0;u<n-1;++u)if(l=c,c=Bi(r,u+1),!(!l||!c)){if(io(e[u],0,zT)){t[u]=t[u+1]=0;continue}s=t[u]/e[u],i=t[u+1]/e[u],o=Math.pow(s,2)+Math.pow(i,2),!(o<=9)&&(a=3/Math.sqrt(o),t[u]=s*a*e[u],t[u+1]=i*a*e[u])}}function WT(r,e,t="x"){const n=Yx(t),s=r.length;let i,a,o,l=Bi(r,0);for(let c=0;c<s;++c){if(a=o,o=l,l=Bi(r,c+1),!o)continue;const u=o[t],d=o[n];a&&(i=(u-a[t])/3,o[`cp1${t}`]=u-i,o[`cp1${n}`]=d-i*e[c]),l&&(i=(l[t]-u)/3,o[`cp2${t}`]=u+i,o[`cp2${n}`]=d+i*e[c])}}function HT(r,e="x"){const t=Yx(e),n=r.length,s=Array(n).fill(0),i=Array(n);let a,o,l,c=Bi(r,0);for(a=0;a<n;++a)if(o=l,l=c,c=Bi(r,a+1),!!l){if(c){const u=c[e]-l[e];s[a]=u!==0?(c[t]-l[t])/u:0}i[a]=o?c?nr(s[a-1])!==nr(s[a])?0:(s[a-1]+s[a])/2:s[a-1]:s[a]}qT(r,s,i),WT(r,i,e)}function Ul(r,e,t){return Math.max(Math.min(r,t),e)}function VT(r,e){let t,n,s,i,a,o=Er(r[0],e);for(t=0,n=r.length;t<n;++t)a=i,i=o,o=t<n-1&&Er(r[t+1],e),i&&(s=r[t],a&&(s.cp1x=Ul(s.cp1x,e.left,e.right),s.cp1y=Ul(s.cp1y,e.top,e.bottom)),o&&(s.cp2x=Ul(s.cp2x,e.left,e.right),s.cp2y=Ul(s.cp2y,e.top,e.bottom)))}function ZT(r,e,t,n,s){let i,a,o,l;if(e.spanGaps&&(r=r.filter(c=>!c.skip)),e.cubicInterpolationMode==="monotone")HT(r,s);else{let c=n?r[r.length-1]:r[0];for(i=0,a=r.length;i<a;++i)o=r[i],l=UT(c,o,r[Math.min(i+1,a-(n?0:1))%a],e.tension),o.cp1x=l.previous.x,o.cp1y=l.previous.y,o.cp2x=l.next.x,o.cp2y=l.next.y,c=o}e.capBezierPoints&&VT(r,t)}function Ym(){return typeof window<"u"&&typeof document<"u"}function Qm(r){let e=r.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function mu(r,e,t){let n;return typeof r=="string"?(n=parseInt(r,10),r.indexOf("%")!==-1&&(n=n/100*e.parentNode[t])):n=r,n}const hd=r=>r.ownerDocument.defaultView.getComputedStyle(r,null);function GT(r,e){return hd(r).getPropertyValue(e)}const JT=["top","right","bottom","left"];function Ds(r,e,t){const n={};t=t?"-"+t:"";for(let s=0;s<4;s++){const i=JT[s];n[i]=parseFloat(r[e+"-"+i+t])||0}return n.width=n.left+n.right,n.height=n.top+n.bottom,n}const KT=(r,e,t)=>(r>0||e>0)&&(!t||!t.shadowRoot);function XT(r,e){const t=r.touches,n=t&&t.length?t[0]:r,{offsetX:s,offsetY:i}=n;let a=!1,o,l;if(KT(s,i,r.target))o=s,l=i;else{const c=e.getBoundingClientRect();o=n.clientX-c.left,l=n.clientY-c.top,a=!0}return{x:o,y:l,box:a}}function Ts(r,e){if("native"in r)return r;const{canvas:t,currentDevicePixelRatio:n}=e,s=hd(t),i=s.boxSizing==="border-box",a=Ds(s,"padding"),o=Ds(s,"border","width"),{x:l,y:c,box:u}=XT(r,t),d=a.left+(u&&o.left),h=a.top+(u&&o.top);let{width:f,height:p}=e;return i&&(f-=a.width+o.width,p-=a.height+o.height),{x:Math.round((l-d)/f*t.width/n),y:Math.round((c-h)/p*t.height/n)}}function YT(r,e,t){let n,s;if(e===void 0||t===void 0){const i=r&&Qm(r);if(!i)e=r.clientWidth,t=r.clientHeight;else{const a=i.getBoundingClientRect(),o=hd(i),l=Ds(o,"border","width"),c=Ds(o,"padding");e=a.width-c.width-l.width,t=a.height-c.height-l.height,n=mu(o.maxWidth,i,"clientWidth"),s=mu(o.maxHeight,i,"clientHeight")}}return{width:e,height:t,maxWidth:n||fu,maxHeight:s||fu}}const ql=r=>Math.round(r*10)/10;function QT(r,e,t,n){const s=hd(r),i=Ds(s,"margin"),a=mu(s.maxWidth,r,"clientWidth")||fu,o=mu(s.maxHeight,r,"clientHeight")||fu,l=YT(r,e,t);let{width:c,height:u}=l;if(s.boxSizing==="content-box"){const h=Ds(s,"border","width"),f=Ds(s,"padding");c-=f.width+h.width,u-=f.height+h.height}return c=Math.max(0,c-i.width),u=Math.max(0,n?c/n:u-i.height),c=ql(Math.min(c,a,l.maxWidth)),u=ql(Math.min(u,o,l.maxHeight)),c&&!u&&(u=ql(c/2)),(e!==void 0||t!==void 0)&&n&&l.height&&u>l.height&&(u=l.height,c=ql(Math.floor(u*n))),{width:c,height:u}}function Eb(r,e,t){const n=e||1,s=Math.floor(r.height*n),i=Math.floor(r.width*n);r.height=Math.floor(r.height),r.width=Math.floor(r.width);const a=r.canvas;return a.style&&(t||!a.style.height&&!a.style.width)&&(a.style.height=`${r.height}px`,a.style.width=`${r.width}px`),r.currentDevicePixelRatio!==n||a.height!==s||a.width!==i?(r.currentDevicePixelRatio=n,a.height=s,a.width=i,r.ctx.setTransform(n,0,0,n,0,0),!0):!1}const eR=function(){let r=!1;try{const e={get passive(){return r=!0,!1}};Ym()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch{}return r}();function Ab(r,e){const t=GT(r,e),n=t&&t.match(/^(\d+)(\.\d+)?px$/);return n?+n[1]:void 0}function Rs(r,e,t,n){return{x:r.x+t*(e.x-r.x),y:r.y+t*(e.y-r.y)}}function tR(r,e,t,n){return{x:r.x+t*(e.x-r.x),y:n==="middle"?t<.5?r.y:e.y:n==="after"?t<1?r.y:e.y:t>0?e.y:r.y}}function nR(r,e,t,n){const s={x:r.cp2x,y:r.cp2y},i={x:e.cp1x,y:e.cp1y},a=Rs(r,s,t),o=Rs(s,i,t),l=Rs(i,e,t),c=Rs(a,o,t),u=Rs(o,l,t);return Rs(c,u,t)}const rR=function(r,e){return{x(t){return r+r+e-t},setWidth(t){e=t},textAlign(t){return t==="center"?t:t==="right"?"left":"right"},xPlus(t,n){return t-n},leftForLtr(t,n){return t-n}}},sR=function(){return{x(r){return r},setWidth(r){},textAlign(r){return r},xPlus(r,e){return r+e},leftForLtr(r,e){return r}}};function Ti(r,e,t){return r?rR(e,t):sR()}function Qx(r,e){let t,n;(e==="ltr"||e==="rtl")&&(t=r.canvas.style,n=[t.getPropertyValue("direction"),t.getPropertyPriority("direction")],t.setProperty("direction",e,"important"),r.prevTextDirection=n)}function ek(r,e){e!==void 0&&(delete r.prevTextDirection,r.canvas.style.setProperty("direction",e[0],e[1]))}function tk(r){return r==="angle"?{between:Ro,compare:iT,normalize:rn}:{between:Sr,compare:(e,t)=>e-t,normalize:e=>e}}function Ob({start:r,end:e,count:t,loop:n,style:s}){return{start:r%t,end:e%t,loop:n&&(e-r+1)%t===0,style:s}}function iR(r,e,t){const{property:n,start:s,end:i}=t,{between:a,normalize:o}=tk(n),l=e.length;let{start:c,end:u,loop:d}=r,h,f;if(d){for(c+=l,u+=l,h=0,f=l;h<f&&a(o(e[c%l][n]),s,i);++h)c--,u--;c%=l,u%=l}return u<c&&(u+=l),{start:c,end:u,loop:d,style:r.style}}function nk(r,e,t){if(!t)return[r];const{property:n,start:s,end:i}=t,a=e.length,{compare:o,between:l,normalize:c}=tk(n),{start:u,end:d,loop:h,style:f}=iR(r,e,t),p=[];let m=!1,g=null,_,y,b;const w=()=>l(s,b,_)&&o(s,b)!==0,v=()=>o(i,_)===0||l(i,b,_),S=()=>m||w(),k=()=>!m||v();for(let x=u,A=u;x<=d;++x)y=e[x%a],!y.skip&&(_=c(y[n]),_!==b&&(m=l(_,s,i),g===null&&S()&&(g=o(_,s)===0?x:A),g!==null&&k()&&(p.push(Ob({start:g,end:x,loop:h,count:a,style:f})),g=null),A=x,b=_));return g!==null&&p.push(Ob({start:g,end:d,loop:h,count:a,style:f})),p}function rk(r,e){const t=[],n=r.segments;for(let s=0;s<n.length;s++){const i=nk(n[s],r.points,e);i.length&&t.push(...i)}return t}function aR(r,e,t,n){let s=0,i=e-1;if(t&&!n)for(;s<e&&!r[s].skip;)s++;for(;s<e&&r[s].skip;)s++;for(s%=e,t&&(i+=s);i>s&&r[i%e].skip;)i--;return i%=e,{start:s,end:i}}function oR(r,e,t,n){const s=r.length,i=[];let a=e,o=r[e],l;for(l=e+1;l<=t;++l){const c=r[l%s];c.skip||c.stop?o.skip||(n=!1,i.push({start:e%s,end:(l-1)%s,loop:n}),e=a=c.stop?l:null):(a=l,o.skip&&(e=l)),o=c}return a!==null&&i.push({start:e%s,end:a%s,loop:n}),i}function lR(r,e){const t=r.points,n=r.options.spanGaps,s=t.length;if(!s)return[];const i=!!r._loop,{start:a,end:o}=aR(t,s,i,n);if(n===!0)return Tb(r,[{start:a,end:o,loop:i}],t,e);const l=o<a?o+s:o,c=!!r._fullLoop&&a===0&&o===s-1;return Tb(r,oR(t,a,l,c),t,e)}function Tb(r,e,t,n){return!n||!n.setContext||!t?e:cR(r,e,t,n)}function cR(r,e,t,n){const s=r._chart.getContext(),i=Rb(r.options),{_datasetIndex:a,options:{spanGaps:o}}=r,l=t.length,c=[];let u=i,d=e[0].start,h=d;function f(p,m,g,_){const y=o?-1:1;if(p!==m){for(p+=l;t[p%l].skip;)p-=y;for(;t[m%l].skip;)m+=y;p%l!==m%l&&(c.push({start:p%l,end:m%l,loop:g,style:_}),u=_,d=m%l)}}for(const p of e){d=o?d:p.start;let m=t[d%l],g;for(h=d+1;h<=p.end;h++){const _=t[h%l];g=Rb(n.setContext(gs(s,{type:"segment",p0:m,p1:_,p0DataIndex:(h-1)%l,p1DataIndex:h%l,datasetIndex:a}))),uR(g,u)&&f(d,h-1,p.loop,u),m=_,u=g}d<h-1&&f(d,h-1,p.loop,u)}return c}function Rb(r){return{backgroundColor:r.backgroundColor,borderCapStyle:r.borderCapStyle,borderDash:r.borderDash,borderDashOffset:r.borderDashOffset,borderJoinStyle:r.borderJoinStyle,borderWidth:r.borderWidth,borderColor:r.borderColor}}function uR(r,e){if(!e)return!1;const t=[],n=function(s,i){return Zm(i)?(t.includes(i)||t.push(i),t.indexOf(i)):i};return JSON.stringify(r,n)!==JSON.stringify(e,n)}function Wl(r,e,t){return r.options.clip?r[t]:e[t]}function dR(r,e){const{xScale:t,yScale:n}=r;return t&&n?{left:Wl(t,e,"left"),right:Wl(t,e,"right"),top:Wl(n,e,"top"),bottom:Wl(n,e,"bottom")}:e}function sk(r,e){const t=e._clip;if(t.disabled)return!1;const n=dR(e,r.chartArea);return{left:t.left===!1?0:n.left-(t.left===!0?0:t.left),right:t.right===!1?r.width:n.right+(t.right===!0?0:t.right),top:t.top===!1?0:n.top-(t.top===!0?0:t.top),bottom:t.bottom===!1?r.height:n.bottom+(t.bottom===!0?0:t.bottom)}}/*!
 * Chart.js v4.4.9
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class hR{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,n,s){const i=t.listeners[s],a=t.duration;i.forEach(o=>o({chart:e,initial:t.initial,numSteps:a,currentStep:Math.min(n-t.start,a)}))}_refresh(){this._request||(this._running=!0,this._request=Bx.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let t=0;this._charts.forEach((n,s)=>{if(!n.running||!n.items.length)return;const i=n.items;let a=i.length-1,o=!1,l;for(;a>=0;--a)l=i[a],l._active?(l._total>n.duration&&(n.duration=l._total),l.tick(e),o=!0):(i[a]=i[i.length-1],i.pop());o&&(s.draw(),this._notify(s,n,e,"progress")),i.length||(n.running=!1,this._notify(s,n,e,"complete"),n.initial=!1),t+=i.length}),this._lastDate=e,t===0&&(this._running=!1)}_getAnims(e){const t=this._charts;let n=t.get(e);return n||(n={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,n)),n}listen(e,t,n){this._getAnims(e).listeners[t].push(n)}add(e,t){!t||!t.length||this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){const t=this._charts.get(e);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce((n,s)=>Math.max(n,s._duration),0),this._refresh())}running(e){if(!this._running)return!1;const t=this._charts.get(e);return!(!t||!t.running||!t.items.length)}stop(e){const t=this._charts.get(e);if(!t||!t.items.length)return;const n=t.items;let s=n.length-1;for(;s>=0;--s)n[s].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var gr=new hR;const Cb="transparent",fR={boolean(r,e,t){return t>.5?e:r},color(r,e,t){const n=vb(r||Cb),s=n.valid&&vb(e||Cb);return s&&s.valid?s.mix(n,t).hexString():e},number(r,e,t){return r+(e-r)*t}};class pR{constructor(e,t,n,s){const i=t[n];s=Ua([e.to,s,i,e.from]);const a=Ua([e.from,i,s]);this._active=!0,this._fn=e.fn||fR[e.type||typeof a],this._easing=ao[e.easing]||ao.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=n,this._from=a,this._to=s,this._promises=void 0}active(){return this._active}update(e,t,n){if(this._active){this._notify(!1);const s=this._target[this._prop],i=n-this._start,a=this._duration-i;this._start=n,this._duration=Math.floor(Math.max(a,e.duration)),this._total+=i,this._loop=!!e.loop,this._to=Ua([e.to,t,s,e.from]),this._from=Ua([e.from,s,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const t=e-this._start,n=this._duration,s=this._prop,i=this._from,a=this._loop,o=this._to;let l;if(this._active=i!==o&&(a||t<n),!this._active){this._target[s]=o,this._notify(!0);return}if(t<0){this._target[s]=i;return}l=t/n%2,l=a&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[s]=this._fn(i,o,l)}wait(){const e=this._promises||(this._promises=[]);return new Promise((t,n)=>{e.push({res:t,rej:n})})}_notify(e){const t=e?"res":"rej",n=this._promises||[];for(let s=0;s<n.length;s++)n[s][t]()}}class ik{constructor(e,t){this._chart=e,this._properties=new Map,this.configure(t)}configure(e){if(!we(e))return;const t=Object.keys(qe.animation),n=this._properties;Object.getOwnPropertyNames(e).forEach(s=>{const i=e[s];if(!we(i))return;const a={};for(const o of t)a[o]=i[o];(Ue(i.properties)&&i.properties||[s]).forEach(o=>{(o===s||!n.has(o))&&n.set(o,a)})})}_animateOptions(e,t){const n=t.options,s=gR(e,n);if(!s)return[];const i=this._createAnimations(s,n);return n.$shared&&mR(e.options.$animations,n).then(()=>{e.options=n},()=>{}),i}_createAnimations(e,t){const n=this._properties,s=[],i=e.$animations||(e.$animations={}),a=Object.keys(t),o=Date.now();let l;for(l=a.length-1;l>=0;--l){const c=a[l];if(c.charAt(0)==="$")continue;if(c==="options"){s.push(...this._animateOptions(e,t));continue}const u=t[c];let d=i[c];const h=n.get(c);if(d)if(h&&d.active()){d.update(h,u,o);continue}else d.cancel();if(!h||!h.duration){e[c]=u;continue}i[c]=d=new pR(h,e,c,u),s.push(d)}return s}update(e,t){if(this._properties.size===0){Object.assign(e,t);return}const n=this._createAnimations(e,t);if(n.length)return gr.add(this._chart,n),!0}}function mR(r,e){const t=[],n=Object.keys(e);for(let s=0;s<n.length;s++){const i=r[n[s]];i&&i.active()&&t.push(i.wait())}return Promise.all(t)}function gR(r,e){if(!e)return;let t=r.options;if(!t){r.options=e;return}return t.$shared&&(r.options=t=Object.assign({},t,{$shared:!1,$animations:{}})),t}function Ib(r,e){const t=r&&r.options||{},n=t.reverse,s=t.min===void 0?e:0,i=t.max===void 0?e:0;return{start:n?i:s,end:n?s:i}}function _R(r,e,t){if(t===!1)return!1;const n=Ib(r,t),s=Ib(e,t);return{top:s.end,right:n.end,bottom:s.start,left:n.start}}function bR(r){let e,t,n,s;return we(r)?(e=r.top,t=r.right,n=r.bottom,s=r.left):e=t=n=s=r,{top:e,right:t,bottom:n,left:s,disabled:r===!1}}function ak(r,e){const t=[],n=r._getSortedDatasetMetas(e);let s,i;for(s=0,i=n.length;s<i;++s)t.push(n[s].index);return t}function $b(r,e,t,n={}){const s=r.keys,i=n.mode==="single";let a,o,l,c;if(e===null)return;let u=!1;for(a=0,o=s.length;a<o;++a){if(l=+s[a],l===t){if(u=!0,n.all)continue;break}c=r.values[l],Ge(c)&&(i||e===0||nr(e)===nr(c))&&(e+=c)}return!u&&!n.all?0:e}function yR(r,e){const{iScale:t,vScale:n}=e,s=t.axis==="x"?"x":"y",i=n.axis==="x"?"x":"y",a=Object.keys(r),o=new Array(a.length);let l,c,u;for(l=0,c=a.length;l<c;++l)u=a[l],o[l]={[s]:u,[i]:r[u]};return o}function gh(r,e){const t=r&&r.options.stacked;return t||t===void 0&&e.stack!==void 0}function wR(r,e,t){return`${r.id}.${e.id}.${t.stack||t.type}`}function vR(r){const{min:e,max:t,minDefined:n,maxDefined:s}=r.getUserBounds();return{min:n?e:Number.NEGATIVE_INFINITY,max:s?t:Number.POSITIVE_INFINITY}}function xR(r,e,t){const n=r[e]||(r[e]={});return n[t]||(n[t]={})}function Mb(r,e,t,n){for(const s of e.getMatchingVisibleMetas(n).reverse()){const i=r[s.index];if(t&&i>0||!t&&i<0)return s.index}return null}function Nb(r,e){const{chart:t,_cachedMeta:n}=r,s=t._stacks||(t._stacks={}),{iScale:i,vScale:a,index:o}=n,l=i.axis,c=a.axis,u=wR(i,a,n),d=e.length;let h;for(let f=0;f<d;++f){const p=e[f],{[l]:m,[c]:g}=p,_=p._stacks||(p._stacks={});h=_[c]=xR(s,u,m),h[o]=g,h._top=Mb(h,a,!0,n.type),h._bottom=Mb(h,a,!1,n.type);const y=h._visualValues||(h._visualValues={});y[o]=g}}function _h(r,e){const t=r.scales;return Object.keys(t).filter(n=>t[n].axis===e).shift()}function kR(r,e){return gs(r,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function SR(r,e,t){return gs(r,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:t,index:e,mode:"default",type:"data"})}function ba(r,e){const t=r.controller.index,n=r.vScale&&r.vScale.axis;if(n){e=e||r._parsed;for(const s of e){const i=s._stacks;if(!i||i[n]===void 0||i[n][t]===void 0)return;delete i[n][t],i[n]._visualValues!==void 0&&i[n]._visualValues[t]!==void 0&&delete i[n]._visualValues[t]}}}const bh=r=>r==="reset"||r==="none",Lb=(r,e)=>e?r:Object.assign({},r),PR=(r,e,t)=>r&&!e.hidden&&e._stacked&&{keys:ak(t,!0),values:null};class Nn{constructor(e,t){this.chart=e,this._ctx=e.ctx,this.index=t,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=gh(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&ba(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,t=this._cachedMeta,n=this.getDataset(),s=(d,h,f,p)=>d==="x"?h:d==="r"?p:f,i=t.xAxisID=ae(n.xAxisID,_h(e,"x")),a=t.yAxisID=ae(n.yAxisID,_h(e,"y")),o=t.rAxisID=ae(n.rAxisID,_h(e,"r")),l=t.indexAxis,c=t.iAxisID=s(l,i,a,o),u=t.vAxisID=s(l,a,i,o);t.xScale=this.getScaleForId(i),t.yScale=this.getScaleForId(a),t.rScale=this.getScaleForId(o),t.iScale=this.getScaleForId(c),t.vScale=this.getScaleForId(u)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const t=this._cachedMeta;return e===t.iScale?t.vScale:t.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&bb(this._data,this),e._stacked&&ba(e)}_dataCheck(){const e=this.getDataset(),t=e.data||(e.data=[]),n=this._data;if(we(t)){const s=this._cachedMeta;this._data=yR(t,s)}else if(n!==t){if(n){bb(n,this);const s=this._cachedMeta;ba(s),s._parsed=[]}t&&Object.isExtensible(t)&&cT(t,this),this._syncList=[],this._data=t}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const t=this._cachedMeta,n=this.getDataset();let s=!1;this._dataCheck();const i=t._stacked;t._stacked=gh(t.vScale,t),t.stack!==n.stack&&(s=!0,ba(t),t.stack=n.stack),this._resyncElements(e),(s||i!==t._stacked)&&(Nb(this,t._parsed),t._stacked=gh(t.vScale,t))}configure(){const e=this.chart.config,t=e.datasetScopeKeys(this._type),n=e.getOptionScopes(this.getDataset(),t,!0);this.options=e.createResolver(n,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,t){const{_cachedMeta:n,_data:s}=this,{iScale:i,_stacked:a}=n,o=i.axis;let l=e===0&&t===s.length?!0:n._sorted,c=e>0&&n._parsed[e-1],u,d,h;if(this._parsing===!1)n._parsed=s,n._sorted=!0,h=s;else{Ue(s[e])?h=this.parseArrayData(n,s,e,t):we(s[e])?h=this.parseObjectData(n,s,e,t):h=this.parsePrimitiveData(n,s,e,t);const f=()=>d[o]===null||c&&d[o]<c[o];for(u=0;u<t;++u)n._parsed[u+e]=d=h[u],l&&(f()&&(l=!1),c=d);n._sorted=l}a&&Nb(this,h)}parsePrimitiveData(e,t,n,s){const{iScale:i,vScale:a}=e,o=i.axis,l=a.axis,c=i.getLabels(),u=i===a,d=new Array(s);let h,f,p;for(h=0,f=s;h<f;++h)p=h+n,d[h]={[o]:u||i.parse(c[p],p),[l]:a.parse(t[p],p)};return d}parseArrayData(e,t,n,s){const{xScale:i,yScale:a}=e,o=new Array(s);let l,c,u,d;for(l=0,c=s;l<c;++l)u=l+n,d=t[u],o[l]={x:i.parse(d[0],u),y:a.parse(d[1],u)};return o}parseObjectData(e,t,n,s){const{xScale:i,yScale:a}=e,{xAxisKey:o="x",yAxisKey:l="y"}=this._parsing,c=new Array(s);let u,d,h,f;for(u=0,d=s;u<d;++u)h=u+n,f=t[h],c[u]={x:i.parse(is(f,o),h),y:a.parse(is(f,l),h)};return c}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,t,n){const s=this.chart,i=this._cachedMeta,a=t[e.axis],o={keys:ak(s,!0),values:t._stacks[e.axis]._visualValues};return $b(o,a,i.index,{mode:n})}updateRangeFromParsed(e,t,n,s){const i=n[t.axis];let a=i===null?NaN:i;const o=s&&n._stacks[t.axis];s&&o&&(s.values=o,a=$b(s,i,this._cachedMeta.index)),e.min=Math.min(e.min,a),e.max=Math.max(e.max,a)}getMinMax(e,t){const n=this._cachedMeta,s=n._parsed,i=n._sorted&&e===n.iScale,a=s.length,o=this._getOtherScale(e),l=PR(t,n,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:u,max:d}=vR(o);let h,f;function p(){f=s[h];const m=f[o.axis];return!Ge(f[e.axis])||u>m||d<m}for(h=0;h<a&&!(!p()&&(this.updateRangeFromParsed(c,e,f,l),i));++h);if(i){for(h=a-1;h>=0;--h)if(!p()){this.updateRangeFromParsed(c,e,f,l);break}}return c}getAllParsedValues(e){const t=this._cachedMeta._parsed,n=[];let s,i,a;for(s=0,i=t.length;s<i;++s)a=t[s][e.axis],Ge(a)&&n.push(a);return n}getMaxOverflow(){return!1}getLabelAndValue(e){const t=this._cachedMeta,n=t.iScale,s=t.vScale,i=this.getParsed(e);return{label:n?""+n.getLabelForValue(i[n.axis]):"",value:s?""+s.getLabelForValue(i[s.axis]):""}}_update(e){const t=this._cachedMeta;this.update(e||"default"),t._clip=bR(ae(this.options.clip,_R(t.xScale,t.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,t=this.chart,n=this._cachedMeta,s=n.data||[],i=t.chartArea,a=[],o=this._drawStart||0,l=this._drawCount||s.length-o,c=this.options.drawActiveElementsOnTop;let u;for(n.dataset&&n.dataset.draw(e,i,o,l),u=o;u<o+l;++u){const d=s[u];d.hidden||(d.active&&c?a.push(d):d.draw(e,i))}for(u=0;u<a.length;++u)a[u].draw(e,i)}getStyle(e,t){const n=t?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(n):this.resolveDataElementOptions(e||0,n)}getContext(e,t,n){const s=this.getDataset();let i;if(e>=0&&e<this._cachedMeta.data.length){const a=this._cachedMeta.data[e];i=a.$context||(a.$context=SR(this.getContext(),e,a)),i.parsed=this.getParsed(e),i.raw=s.data[e],i.index=i.dataIndex=e}else i=this.$context||(this.$context=kR(this.chart.getContext(),this.index)),i.dataset=s,i.index=i.datasetIndex=this.index;return i.active=!!t,i.mode=n,i}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,t){return this._resolveElementOptions(this.dataElementType.id,t,e)}_resolveElementOptions(e,t="default",n){const s=t==="active",i=this._cachedDataOpts,a=e+"-"+t,o=i[a],l=this.enableOptionSharing&&To(n);if(o)return Lb(o,l);const c=this.chart.config,u=c.datasetElementScopeKeys(this._type,e),d=s?[`${e}Hover`,"hover",e,""]:[e,""],h=c.getOptionScopes(this.getDataset(),u),f=Object.keys(qe.elements[e]),p=()=>this.getContext(n,s,t),m=c.resolveNamedOptions(h,f,p,d);return m.$shared&&(m.$shared=l,i[a]=Object.freeze(Lb(m,l))),m}_resolveAnimations(e,t,n){const s=this.chart,i=this._cachedDataOpts,a=`animation-${t}`,o=i[a];if(o)return o;let l;if(s.options.animation!==!1){const u=this.chart.config,d=u.datasetAnimationScopeKeys(this._type,t),h=u.getOptionScopes(this.getDataset(),d);l=u.createResolver(h,this.getContext(e,n,t))}const c=new ik(s,l&&l.animations);return l&&l._cacheable&&(i[a]=Object.freeze(c)),c}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,t){return!t||bh(e)||this.chart._animationsDisabled}_getSharedOptions(e,t){const n=this.resolveDataElementOptions(e,t),s=this._sharedOptions,i=this.getSharedOptions(n),a=this.includeOptions(t,i)||i!==s;return this.updateSharedOptions(i,t,n),{sharedOptions:i,includeOptions:a}}updateElement(e,t,n,s){bh(s)?Object.assign(e,n):this._resolveAnimations(t,s).update(e,n)}updateSharedOptions(e,t,n){e&&!bh(t)&&this._resolveAnimations(void 0,t).update(e,n)}_setStyle(e,t,n,s){e.active=s;const i=this.getStyle(t,s);this._resolveAnimations(t,n,s).update(e,{options:!s&&this.getSharedOptions(i)||i})}removeHoverStyle(e,t,n){this._setStyle(e,n,"active",!1)}setHoverStyle(e,t,n){this._setStyle(e,n,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const t=this._data,n=this._cachedMeta.data;for(const[o,l,c]of this._syncList)this[o](l,c);this._syncList=[];const s=n.length,i=t.length,a=Math.min(i,s);a&&this.parse(0,a),i>s?this._insertElements(s,i-s,e):i<s&&this._removeElements(i,s-i)}_insertElements(e,t,n=!0){const s=this._cachedMeta,i=s.data,a=e+t;let o;const l=c=>{for(c.length+=t,o=c.length-1;o>=a;o--)c[o]=c[o-t]};for(l(i),o=e;o<a;++o)i[o]=new this.dataElementType;this._parsing&&l(s._parsed),this.parse(e,t),n&&this.updateElements(i,e,t,"reset")}updateElements(e,t,n,s){}_removeElements(e,t){const n=this._cachedMeta;if(this._parsing){const s=n._parsed.splice(e,t);n._stacked&&ba(n,s)}n.data.splice(e,t)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[t,n,s]=e;this[t](n,s)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,t){t&&this._sync(["_removeElements",e,t]);const n=arguments.length-2;n&&this._sync(["_insertElements",e,n])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}M(Nn,"defaults",{}),M(Nn,"datasetElementType",null),M(Nn,"dataElementType",null);function ER(r,e){if(!r._cache.$bar){const t=r.getMatchingVisibleMetas(e);let n=[];for(let s=0,i=t.length;s<i;s++)n=n.concat(t[s].controller.getAllParsedValues(r));r._cache.$bar=Fx(n.sort((s,i)=>s-i))}return r._cache.$bar}function AR(r){const e=r.iScale,t=ER(e,r.type);let n=e._length,s,i,a,o;const l=()=>{a===32767||a===-32768||(To(o)&&(n=Math.min(n,Math.abs(a-o)||n)),o=a)};for(s=0,i=t.length;s<i;++s)a=e.getPixelForValue(t[s]),l();for(o=void 0,s=0,i=e.ticks.length;s<i;++s)a=e.getPixelForTick(s),l();return n}function OR(r,e,t,n){const s=t.barThickness;let i,a;return ye(s)?(i=e.min*t.categoryPercentage,a=t.barPercentage):(i=s*n,a=1),{chunk:i/n,ratio:a,start:e.pixels[r]-i/2}}function TR(r,e,t,n){const s=e.pixels,i=s[r];let a=r>0?s[r-1]:null,o=r<s.length-1?s[r+1]:null;const l=t.categoryPercentage;a===null&&(a=i-(o===null?e.end-e.start:o-i)),o===null&&(o=i+i-a);const c=i-(i-Math.min(a,o))/2*l;return{chunk:Math.abs(o-a)/2*l/n,ratio:t.barPercentage,start:c}}function RR(r,e,t,n){const s=t.parse(r[0],n),i=t.parse(r[1],n),a=Math.min(s,i),o=Math.max(s,i);let l=a,c=o;Math.abs(a)>Math.abs(o)&&(l=o,c=a),e[t.axis]=c,e._custom={barStart:l,barEnd:c,start:s,end:i,min:a,max:o}}function ok(r,e,t,n){return Ue(r)?RR(r,e,t,n):e[t.axis]=t.parse(r,n),e}function jb(r,e,t,n){const s=r.iScale,i=r.vScale,a=s.getLabels(),o=s===i,l=[];let c,u,d,h;for(c=t,u=t+n;c<u;++c)h=e[c],d={},d[s.axis]=o||s.parse(a[c],c),l.push(ok(h,d,i,c));return l}function yh(r){return r&&r.barStart!==void 0&&r.barEnd!==void 0}function CR(r,e,t){return r!==0?nr(r):(e.isHorizontal()?1:-1)*(e.min>=t?1:-1)}function IR(r){let e,t,n,s,i;return r.horizontal?(e=r.base>r.x,t="left",n="right"):(e=r.base<r.y,t="bottom",n="top"),e?(s="end",i="start"):(s="start",i="end"),{start:t,end:n,reverse:e,top:s,bottom:i}}function $R(r,e,t,n){let s=e.borderSkipped;const i={};if(!s){r.borderSkipped=i;return}if(s===!0){r.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:a,end:o,reverse:l,top:c,bottom:u}=IR(r);s==="middle"&&t&&(r.enableBorderRadius=!0,(t._top||0)===n?s=c:(t._bottom||0)===n?s=u:(i[Db(u,a,o,l)]=!0,s=c)),i[Db(s,a,o,l)]=!0,r.borderSkipped=i}function Db(r,e,t,n){return n?(r=MR(r,e,t),r=Fb(r,t,e)):r=Fb(r,e,t),r}function MR(r,e,t){return r===e?t:r===t?e:r}function Fb(r,e,t){return r==="start"?e:r==="end"?t:r}function NR(r,{inflateAmount:e},t){r.inflateAmount=e==="auto"?t===1?.33:0:e}class Uc extends Nn{parsePrimitiveData(e,t,n,s){return jb(e,t,n,s)}parseArrayData(e,t,n,s){return jb(e,t,n,s)}parseObjectData(e,t,n,s){const{iScale:i,vScale:a}=e,{xAxisKey:o="x",yAxisKey:l="y"}=this._parsing,c=i.axis==="x"?o:l,u=a.axis==="x"?o:l,d=[];let h,f,p,m;for(h=n,f=n+s;h<f;++h)m=t[h],p={},p[i.axis]=i.parse(is(m,c),h),d.push(ok(is(m,u),p,a,h));return d}updateRangeFromParsed(e,t,n,s){super.updateRangeFromParsed(e,t,n,s);const i=n._custom;i&&t===this._cachedMeta.vScale&&(e.min=Math.min(e.min,i.min),e.max=Math.max(e.max,i.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const t=this._cachedMeta,{iScale:n,vScale:s}=t,i=this.getParsed(e),a=i._custom,o=yh(a)?"["+a.start+", "+a.end+"]":""+s.getLabelForValue(i[s.axis]);return{label:""+n.getLabelForValue(i[n.axis]),value:o}}initialize(){this.enableOptionSharing=!0,super.initialize();const e=this._cachedMeta;e.stack=this.getDataset().stack}update(e){const t=this._cachedMeta;this.updateElements(t.data,0,t.data.length,e)}updateElements(e,t,n,s){const i=s==="reset",{index:a,_cachedMeta:{vScale:o}}=this,l=o.getBasePixel(),c=o.isHorizontal(),u=this._getRuler(),{sharedOptions:d,includeOptions:h}=this._getSharedOptions(t,s);for(let f=t;f<t+n;f++){const p=this.getParsed(f),m=i||ye(p[o.axis])?{base:l,head:l}:this._calculateBarValuePixels(f),g=this._calculateBarIndexPixels(f,u),_=(p._stacks||{})[o.axis],y={horizontal:c,base:m.base,enableBorderRadius:!_||yh(p._custom)||a===_._top||a===_._bottom,x:c?m.head:g.center,y:c?g.center:m.head,height:c?g.size:Math.abs(m.size),width:c?Math.abs(m.size):g.size};h&&(y.options=d||this.resolveDataElementOptions(f,e[f].active?"active":s));const b=y.options||e[f].options;$R(y,b,_,a),NR(y,b,u.ratio),this.updateElement(e[f],f,y,s)}}_getStacks(e,t){const{iScale:n}=this._cachedMeta,s=n.getMatchingVisibleMetas(this._type).filter(u=>u.controller.options.grouped),i=n.options.stacked,a=[],o=this._cachedMeta.controller.getParsed(t),l=o&&o[n.axis],c=u=>{const d=u._parsed.find(f=>f[n.axis]===l),h=d&&d[u.vScale.axis];if(ye(h)||isNaN(h))return!0};for(const u of s)if(!(t!==void 0&&c(u))&&((i===!1||a.indexOf(u.stack)===-1||i===void 0&&u.stack===void 0)&&a.push(u.stack),u.index===e))break;return a.length||a.push(void 0),a}_getStackCount(e){return this._getStacks(void 0,e).length}_getStackIndex(e,t,n){const s=this._getStacks(e,n),i=t!==void 0?s.indexOf(t):-1;return i===-1?s.length-1:i}_getRuler(){const e=this.options,t=this._cachedMeta,n=t.iScale,s=[];let i,a;for(i=0,a=t.data.length;i<a;++i)s.push(n.getPixelForValue(this.getParsed(i)[n.axis],i));const o=e.barThickness;return{min:o||AR(t),pixels:s,start:n._startPixel,end:n._endPixel,stackCount:this._getStackCount(),scale:n,grouped:e.grouped,ratio:o?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:t,_stacked:n,index:s},options:{base:i,minBarLength:a}}=this,o=i||0,l=this.getParsed(e),c=l._custom,u=yh(c);let d=l[t.axis],h=0,f=n?this.applyStack(t,l,n):d,p,m;f!==d&&(h=f-d,f=d),u&&(d=c.barStart,f=c.barEnd-c.barStart,d!==0&&nr(d)!==nr(c.barEnd)&&(h=0),h+=d);const g=!ye(i)&&!u?i:h;let _=t.getPixelForValue(g);if(this.chart.getDataVisibility(e)?p=t.getPixelForValue(h+f):p=_,m=p-_,Math.abs(m)<a){m=CR(m,t,o)*a,d===o&&(_-=m/2);const y=t.getPixelForDecimal(0),b=t.getPixelForDecimal(1),w=Math.min(y,b),v=Math.max(y,b);_=Math.max(Math.min(_,v),w),p=_+m,n&&!u&&(l._stacks[t.axis]._visualValues[s]=t.getValueForPixel(p)-t.getValueForPixel(_))}if(_===t.getPixelForValue(o)){const y=nr(m)*t.getLineWidthForValue(o)/2;_+=y,m-=y}return{size:m,base:_,head:p,center:p+m/2}}_calculateBarIndexPixels(e,t){const n=t.scale,s=this.options,i=s.skipNull,a=ae(s.maxBarThickness,1/0);let o,l;if(t.grouped){const c=i?this._getStackCount(e):t.stackCount,u=s.barThickness==="flex"?TR(e,t,s,c):OR(e,t,s,c),d=this._getStackIndex(this.index,this._cachedMeta.stack,i?e:void 0);o=u.start+u.chunk*d+u.chunk/2,l=Math.min(a,u.chunk*u.ratio)}else o=n.getPixelForValue(this.getParsed(e)[n.axis],e),l=Math.min(a,t.min*t.ratio);return{base:o-l/2,head:o+l/2,center:o,size:l}}draw(){const e=this._cachedMeta,t=e.vScale,n=e.data,s=n.length;let i=0;for(;i<s;++i)this.getParsed(i)[t.axis]!==null&&!n[i].hidden&&n[i].draw(this._ctx)}}M(Uc,"id","bar"),M(Uc,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),M(Uc,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class qc extends Nn{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(e,t,n,s){const i=super.parsePrimitiveData(e,t,n,s);for(let a=0;a<i.length;a++)i[a]._custom=this.resolveDataElementOptions(a+n).radius;return i}parseArrayData(e,t,n,s){const i=super.parseArrayData(e,t,n,s);for(let a=0;a<i.length;a++){const o=t[n+a];i[a]._custom=ae(o[2],this.resolveDataElementOptions(a+n).radius)}return i}parseObjectData(e,t,n,s){const i=super.parseObjectData(e,t,n,s);for(let a=0;a<i.length;a++){const o=t[n+a];i[a]._custom=ae(o&&o.r&&+o.r,this.resolveDataElementOptions(a+n).radius)}return i}getMaxOverflow(){const e=this._cachedMeta.data;let t=0;for(let n=e.length-1;n>=0;--n)t=Math.max(t,e[n].size(this.resolveDataElementOptions(n))/2);return t>0&&t}getLabelAndValue(e){const t=this._cachedMeta,n=this.chart.data.labels||[],{xScale:s,yScale:i}=t,a=this.getParsed(e),o=s.getLabelForValue(a.x),l=i.getLabelForValue(a.y),c=a._custom;return{label:n[e]||"",value:"("+o+", "+l+(c?", "+c:"")+")"}}update(e){const t=this._cachedMeta.data;this.updateElements(t,0,t.length,e)}updateElements(e,t,n,s){const i=s==="reset",{iScale:a,vScale:o}=this._cachedMeta,{sharedOptions:l,includeOptions:c}=this._getSharedOptions(t,s),u=a.axis,d=o.axis;for(let h=t;h<t+n;h++){const f=e[h],p=!i&&this.getParsed(h),m={},g=m[u]=i?a.getPixelForDecimal(.5):a.getPixelForValue(p[u]),_=m[d]=i?o.getBasePixel():o.getPixelForValue(p[d]);m.skip=isNaN(g)||isNaN(_),c&&(m.options=l||this.resolveDataElementOptions(h,f.active?"active":s),i&&(m.options.radius=0)),this.updateElement(f,h,m,s)}}resolveDataElementOptions(e,t){const n=this.getParsed(e);let s=super.resolveDataElementOptions(e,t);s.$shared&&(s=Object.assign({},s,{$shared:!1}));const i=s.radius;return t!=="active"&&(s.radius=0),s.radius+=ae(n&&n._custom,i),s}}M(qc,"id","bubble"),M(qc,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),M(qc,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function LR(r,e,t){let n=1,s=1,i=0,a=0;if(e<Fe){const o=r,l=o+e,c=Math.cos(o),u=Math.sin(o),d=Math.cos(l),h=Math.sin(l),f=(b,w,v)=>Ro(b,o,l,!0)?1:Math.max(w,w*t,v,v*t),p=(b,w,v)=>Ro(b,o,l,!0)?-1:Math.min(w,w*t,v,v*t),m=f(0,c,d),g=f(Ke,u,h),_=p(Be,c,d),y=p(Be+Ke,u,h);n=(m-_)/2,s=(g-y)/2,i=-(m+_)/2,a=-(g+y)/2}return{ratioX:n,ratioY:s,offsetX:i,offsetY:a}}class $s extends Nn{constructor(e,t){super(e,t),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(e,t){const n=this.getDataset().data,s=this._cachedMeta;if(this._parsing===!1)s._parsed=n;else{let i=l=>+n[l];if(we(n[e])){const{key:l="value"}=this._parsing;i=c=>+is(n[c],l)}let a,o;for(a=e,o=e+t;a<o;++a)s._parsed[a]=i(a)}}_getRotation(){return Rn(this.options.rotation-90)}_getCircumference(){return Rn(this.options.circumference)}_getRotationExtents(){let e=Fe,t=-Fe;for(let n=0;n<this.chart.data.datasets.length;++n)if(this.chart.isDatasetVisible(n)&&this.chart.getDatasetMeta(n).type===this._type){const s=this.chart.getDatasetMeta(n).controller,i=s._getRotation(),a=s._getCircumference();e=Math.min(e,i),t=Math.max(t,i+a)}return{rotation:e,circumference:t-e}}update(e){const t=this.chart,{chartArea:n}=t,s=this._cachedMeta,i=s.data,a=this.getMaxBorderWidth()+this.getMaxOffset(i)+this.options.spacing,o=Math.max((Math.min(n.width,n.height)-a)/2,0),l=Math.min(GO(this.options.cutout,o),1),c=this._getRingWeight(this.index),{circumference:u,rotation:d}=this._getRotationExtents(),{ratioX:h,ratioY:f,offsetX:p,offsetY:m}=LR(d,u,l),g=(n.width-a)/h,_=(n.height-a)/f,y=Math.max(Math.min(g,_)/2,0),b=Mx(this.options.radius,y),w=Math.max(b*l,0),v=(b-w)/this._getVisibleDatasetWeightTotal();this.offsetX=p*b,this.offsetY=m*b,s.total=this.calculateTotal(),this.outerRadius=b-v*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-v*c,0),this.updateElements(i,0,i.length,e)}_circumference(e,t){const n=this.options,s=this._cachedMeta,i=this._getCircumference();return t&&n.animation.animateRotate||!this.chart.getDataVisibility(e)||s._parsed[e]===null||s.data[e].hidden?0:this.calculateCircumference(s._parsed[e]*i/Fe)}updateElements(e,t,n,s){const i=s==="reset",a=this.chart,o=a.chartArea,c=a.options.animation,u=(o.left+o.right)/2,d=(o.top+o.bottom)/2,h=i&&c.animateScale,f=h?0:this.innerRadius,p=h?0:this.outerRadius,{sharedOptions:m,includeOptions:g}=this._getSharedOptions(t,s);let _=this._getRotation(),y;for(y=0;y<t;++y)_+=this._circumference(y,i);for(y=t;y<t+n;++y){const b=this._circumference(y,i),w=e[y],v={x:u+this.offsetX,y:d+this.offsetY,startAngle:_,endAngle:_+b,circumference:b,outerRadius:p,innerRadius:f};g&&(v.options=m||this.resolveDataElementOptions(y,w.active?"active":s)),_+=b,this.updateElement(w,y,v,s)}}calculateTotal(){const e=this._cachedMeta,t=e.data;let n=0,s;for(s=0;s<t.length;s++){const i=e._parsed[s];i!==null&&!isNaN(i)&&this.chart.getDataVisibility(s)&&!t[s].hidden&&(n+=Math.abs(i))}return n}calculateCircumference(e){const t=this._cachedMeta.total;return t>0&&!isNaN(e)?Fe*(Math.abs(e)/t):0}getLabelAndValue(e){const t=this._cachedMeta,n=this.chart,s=n.data.labels||[],i=fl(t._parsed[e],n.options.locale);return{label:s[e]||"",value:i}}getMaxBorderWidth(e){let t=0;const n=this.chart;let s,i,a,o,l;if(!e){for(s=0,i=n.data.datasets.length;s<i;++s)if(n.isDatasetVisible(s)){a=n.getDatasetMeta(s),e=a.data,o=a.controller;break}}if(!e)return 0;for(s=0,i=e.length;s<i;++s)l=o.resolveDataElementOptions(s),l.borderAlign!=="inner"&&(t=Math.max(t,l.borderWidth||0,l.hoverBorderWidth||0));return t}getMaxOffset(e){let t=0;for(let n=0,s=e.length;n<s;++n){const i=this.resolveDataElementOptions(n);t=Math.max(t,i.offset||0,i.hoverOffset||0)}return t}_getRingWeightOffset(e){let t=0;for(let n=0;n<e;++n)this.chart.isDatasetVisible(n)&&(t+=this._getRingWeight(n));return t}_getRingWeight(e){return Math.max(ae(this.chart.data.datasets[e].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}M($s,"id","doughnut"),M($s,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),M($s,"descriptors",{_scriptable:e=>e!=="spacing",_indexable:e=>e!=="spacing"&&!e.startsWith("borderDash")&&!e.startsWith("hoverBorderDash")}),M($s,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:n,color:s}}=e.legend.options;return t.labels.map((i,a)=>{const l=e.getDatasetMeta(0).controller.getStyle(a);return{text:i,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:s,lineWidth:l.borderWidth,pointStyle:n,hidden:!e.getDataVisibility(a),index:a}})}return[]}},onClick(e,t,n){n.chart.toggleDataVisibility(t.index),n.chart.update()}}}});class Wc extends Nn{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const t=this._cachedMeta,{dataset:n,data:s=[],_dataset:i}=t,a=this.chart._animationsDisabled;let{start:o,count:l}=Ux(t,s,a);this._drawStart=o,this._drawCount=l,qx(t)&&(o=0,l=s.length),n._chart=this.chart,n._datasetIndex=this.index,n._decimated=!!i._decimated,n.points=s;const c=this.resolveDatasetElementOptions(e);this.options.showLine||(c.borderWidth=0),c.segment=this.options.segment,this.updateElement(n,void 0,{animated:!a,options:c},e),this.updateElements(s,o,l,e)}updateElements(e,t,n,s){const i=s==="reset",{iScale:a,vScale:o,_stacked:l,_dataset:c}=this._cachedMeta,{sharedOptions:u,includeOptions:d}=this._getSharedOptions(t,s),h=a.axis,f=o.axis,{spanGaps:p,segment:m}=this.options,g=Di(p)?p:Number.POSITIVE_INFINITY,_=this.chart._animationsDisabled||i||s==="none",y=t+n,b=e.length;let w=t>0&&this.getParsed(t-1);for(let v=0;v<b;++v){const S=e[v],k=_?S:{};if(v<t||v>=y){k.skip=!0;continue}const x=this.getParsed(v),A=ye(x[f]),C=k[h]=a.getPixelForValue(x[h],v),I=k[f]=i||A?o.getBasePixel():o.getPixelForValue(l?this.applyStack(o,x,l):x[f],v);k.skip=isNaN(C)||isNaN(I)||A,k.stop=v>0&&Math.abs(x[h]-w[h])>g,m&&(k.parsed=x,k.raw=c.data[v]),d&&(k.options=u||this.resolveDataElementOptions(v,S.active?"active":s)),_||this.updateElement(S,v,k,s),w=x}}getMaxOverflow(){const e=this._cachedMeta,t=e.dataset,n=t.options&&t.options.borderWidth||0,s=e.data||[];if(!s.length)return n;const i=s[0].size(this.resolveDataElementOptions(0)),a=s[s.length-1].size(this.resolveDataElementOptions(s.length-1));return Math.max(n,i,a)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}M(Wc,"id","line"),M(Wc,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),M(Wc,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class lo extends Nn{constructor(e,t){super(e,t),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(e){const t=this._cachedMeta,n=this.chart,s=n.data.labels||[],i=fl(t._parsed[e].r,n.options.locale);return{label:s[e]||"",value:i}}parseObjectData(e,t,n,s){return Xx.bind(this)(e,t,n,s)}update(e){const t=this._cachedMeta.data;this._updateRadius(),this.updateElements(t,0,t.length,e)}getMinMax(){const e=this._cachedMeta,t={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return e.data.forEach((n,s)=>{const i=this.getParsed(s).r;!isNaN(i)&&this.chart.getDataVisibility(s)&&(i<t.min&&(t.min=i),i>t.max&&(t.max=i))}),t}_updateRadius(){const e=this.chart,t=e.chartArea,n=e.options,s=Math.min(t.right-t.left,t.bottom-t.top),i=Math.max(s/2,0),a=Math.max(n.cutoutPercentage?i/100*n.cutoutPercentage:1,0),o=(i-a)/e.getVisibleDatasetCount();this.outerRadius=i-o*this.index,this.innerRadius=this.outerRadius-o}updateElements(e,t,n,s){const i=s==="reset",a=this.chart,l=a.options.animation,c=this._cachedMeta.rScale,u=c.xCenter,d=c.yCenter,h=c.getIndexAngle(0)-.5*Be;let f=h,p;const m=360/this.countVisibleElements();for(p=0;p<t;++p)f+=this._computeAngle(p,s,m);for(p=t;p<t+n;p++){const g=e[p];let _=f,y=f+this._computeAngle(p,s,m),b=a.getDataVisibility(p)?c.getDistanceFromCenterForValue(this.getParsed(p).r):0;f=y,i&&(l.animateScale&&(b=0),l.animateRotate&&(_=y=h));const w={x:u,y:d,innerRadius:0,outerRadius:b,startAngle:_,endAngle:y,options:this.resolveDataElementOptions(p,g.active?"active":s)};this.updateElement(g,p,w,s)}}countVisibleElements(){const e=this._cachedMeta;let t=0;return e.data.forEach((n,s)=>{!isNaN(this.getParsed(s).r)&&this.chart.getDataVisibility(s)&&t++}),t}_computeAngle(e,t,n){return this.chart.getDataVisibility(e)?Rn(this.resolveDataElementOptions(e,t).angle||n):0}}M(lo,"id","polarArea"),M(lo,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),M(lo,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:n,color:s}}=e.legend.options;return t.labels.map((i,a)=>{const l=e.getDatasetMeta(0).controller.getStyle(a);return{text:i,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:s,lineWidth:l.borderWidth,pointStyle:n,hidden:!e.getDataVisibility(a),index:a}})}return[]}},onClick(e,t,n){n.chart.toggleDataVisibility(t.index),n.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class Cp extends $s{}M(Cp,"id","pie"),M(Cp,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class Hc extends Nn{getLabelAndValue(e){const t=this._cachedMeta.vScale,n=this.getParsed(e);return{label:t.getLabels()[e],value:""+t.getLabelForValue(n[t.axis])}}parseObjectData(e,t,n,s){return Xx.bind(this)(e,t,n,s)}update(e){const t=this._cachedMeta,n=t.dataset,s=t.data||[],i=t.iScale.getLabels();if(n.points=s,e!=="resize"){const a=this.resolveDatasetElementOptions(e);this.options.showLine||(a.borderWidth=0);const o={_loop:!0,_fullLoop:i.length===s.length,options:a};this.updateElement(n,void 0,o,e)}this.updateElements(s,0,s.length,e)}updateElements(e,t,n,s){const i=this._cachedMeta.rScale,a=s==="reset";for(let o=t;o<t+n;o++){const l=e[o],c=this.resolveDataElementOptions(o,l.active?"active":s),u=i.getPointPositionForValue(o,this.getParsed(o).r),d=a?i.xCenter:u.x,h=a?i.yCenter:u.y,f={x:d,y:h,angle:u.angle,skip:isNaN(d)||isNaN(h),options:c};this.updateElement(l,o,f,s)}}}M(Hc,"id","radar"),M(Hc,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),M(Hc,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class Vc extends Nn{getLabelAndValue(e){const t=this._cachedMeta,n=this.chart.data.labels||[],{xScale:s,yScale:i}=t,a=this.getParsed(e),o=s.getLabelForValue(a.x),l=i.getLabelForValue(a.y);return{label:n[e]||"",value:"("+o+", "+l+")"}}update(e){const t=this._cachedMeta,{data:n=[]}=t,s=this.chart._animationsDisabled;let{start:i,count:a}=Ux(t,n,s);if(this._drawStart=i,this._drawCount=a,qx(t)&&(i=0,a=n.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:o,_dataset:l}=t;o._chart=this.chart,o._datasetIndex=this.index,o._decimated=!!l._decimated,o.points=n;const c=this.resolveDatasetElementOptions(e);c.segment=this.options.segment,this.updateElement(o,void 0,{animated:!s,options:c},e)}else this.datasetElementType&&(delete t.dataset,this.datasetElementType=!1);this.updateElements(n,i,a,e)}addElements(){const{showLine:e}=this.options;!this.datasetElementType&&e&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(e,t,n,s){const i=s==="reset",{iScale:a,vScale:o,_stacked:l,_dataset:c}=this._cachedMeta,u=this.resolveDataElementOptions(t,s),d=this.getSharedOptions(u),h=this.includeOptions(s,d),f=a.axis,p=o.axis,{spanGaps:m,segment:g}=this.options,_=Di(m)?m:Number.POSITIVE_INFINITY,y=this.chart._animationsDisabled||i||s==="none";let b=t>0&&this.getParsed(t-1);for(let w=t;w<t+n;++w){const v=e[w],S=this.getParsed(w),k=y?v:{},x=ye(S[p]),A=k[f]=a.getPixelForValue(S[f],w),C=k[p]=i||x?o.getBasePixel():o.getPixelForValue(l?this.applyStack(o,S,l):S[p],w);k.skip=isNaN(A)||isNaN(C)||x,k.stop=w>0&&Math.abs(S[f]-b[f])>_,g&&(k.parsed=S,k.raw=c.data[w]),h&&(k.options=d||this.resolveDataElementOptions(w,v.active?"active":s)),y||this.updateElement(v,w,k,s),b=S}this.updateSharedOptions(d,s,u)}getMaxOverflow(){const e=this._cachedMeta,t=e.data||[];if(!this.options.showLine){let o=0;for(let l=t.length-1;l>=0;--l)o=Math.max(o,t[l].size(this.resolveDataElementOptions(l))/2);return o>0&&o}const n=e.dataset,s=n.options&&n.options.borderWidth||0;if(!t.length)return s;const i=t[0].size(this.resolveDataElementOptions(0)),a=t[t.length-1].size(this.resolveDataElementOptions(t.length-1));return Math.max(s,i,a)/2}}M(Vc,"id","scatter"),M(Vc,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),M(Vc,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var jR=Object.freeze({__proto__:null,BarController:Uc,BubbleController:qc,DoughnutController:$s,LineController:Wc,PieController:Cp,PolarAreaController:lo,RadarController:Hc,ScatterController:Vc});function Ss(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class eg{constructor(e){M(this,"options");this.options=e||{}}static override(e){Object.assign(eg.prototype,e)}init(){}formats(){return Ss()}parse(){return Ss()}format(){return Ss()}add(){return Ss()}diff(){return Ss()}startOf(){return Ss()}endOf(){return Ss()}}var DR={_date:eg};function FR(r,e,t,n){const{controller:s,data:i,_sorted:a}=r,o=s._cachedMeta.iScale,l=r.dataset&&r.dataset.options?r.dataset.options.spanGaps:null;if(o&&e===o.axis&&e!=="r"&&a&&i.length){const c=o._reversePixels?oT:Pr;if(n){if(s._sharedOptions){const u=i[0],d=typeof u.getRange=="function"&&u.getRange(e);if(d){const h=c(i,e,t-d),f=c(i,e,t+d);return{lo:h.lo,hi:f.hi}}}}else{const u=c(i,e,t);if(l){const{vScale:d}=s._cachedMeta,{_parsed:h}=r,f=h.slice(0,u.lo+1).reverse().findIndex(m=>!ye(m[d.axis]));u.lo-=Math.max(0,f);const p=h.slice(u.hi).findIndex(m=>!ye(m[d.axis]));u.hi+=Math.max(0,p)}return u}}return{lo:0,hi:i.length-1}}function fd(r,e,t,n,s){const i=r.getSortedVisibleDatasetMetas(),a=t[e];for(let o=0,l=i.length;o<l;++o){const{index:c,data:u}=i[o],{lo:d,hi:h}=FR(i[o],e,a,s);for(let f=d;f<=h;++f){const p=u[f];p.skip||n(p,c,f)}}}function BR(r){const e=r.indexOf("x")!==-1,t=r.indexOf("y")!==-1;return function(n,s){const i=e?Math.abs(n.x-s.x):0,a=t?Math.abs(n.y-s.y):0;return Math.sqrt(Math.pow(i,2)+Math.pow(a,2))}}function wh(r,e,t,n,s){const i=[];return!s&&!r.isPointInArea(e)||fd(r,t,e,function(o,l,c){!s&&!Er(o,r.chartArea,0)||o.inRange(e.x,e.y,n)&&i.push({element:o,datasetIndex:l,index:c})},!0),i}function zR(r,e,t,n){let s=[];function i(a,o,l){const{startAngle:c,endAngle:u}=a.getProps(["startAngle","endAngle"],n),{angle:d}=jx(a,{x:e.x,y:e.y});Ro(d,c,u)&&s.push({element:a,datasetIndex:o,index:l})}return fd(r,t,e,i),s}function UR(r,e,t,n,s,i){let a=[];const o=BR(t);let l=Number.POSITIVE_INFINITY;function c(u,d,h){const f=u.inRange(e.x,e.y,s);if(n&&!f)return;const p=u.getCenterPoint(s);if(!(!!i||r.isPointInArea(p))&&!f)return;const g=o(e,p);g<l?(a=[{element:u,datasetIndex:d,index:h}],l=g):g===l&&a.push({element:u,datasetIndex:d,index:h})}return fd(r,t,e,c),a}function vh(r,e,t,n,s,i){return!i&&!r.isPointInArea(e)?[]:t==="r"&&!n?zR(r,e,t,s):UR(r,e,t,n,s,i)}function Bb(r,e,t,n,s){const i=[],a=t==="x"?"inXRange":"inYRange";let o=!1;return fd(r,t,e,(l,c,u)=>{l[a]&&l[a](e[t],s)&&(i.push({element:l,datasetIndex:c,index:u}),o=o||l.inRange(e.x,e.y,s))}),n&&!o?[]:i}var qR={modes:{index(r,e,t,n){const s=Ts(e,r),i=t.axis||"x",a=t.includeInvisible||!1,o=t.intersect?wh(r,s,i,n,a):vh(r,s,i,!1,n,a),l=[];return o.length?(r.getSortedVisibleDatasetMetas().forEach(c=>{const u=o[0].index,d=c.data[u];d&&!d.skip&&l.push({element:d,datasetIndex:c.index,index:u})}),l):[]},dataset(r,e,t,n){const s=Ts(e,r),i=t.axis||"xy",a=t.includeInvisible||!1;let o=t.intersect?wh(r,s,i,n,a):vh(r,s,i,!1,n,a);if(o.length>0){const l=o[0].datasetIndex,c=r.getDatasetMeta(l).data;o=[];for(let u=0;u<c.length;++u)o.push({element:c[u],datasetIndex:l,index:u})}return o},point(r,e,t,n){const s=Ts(e,r),i=t.axis||"xy",a=t.includeInvisible||!1;return wh(r,s,i,n,a)},nearest(r,e,t,n){const s=Ts(e,r),i=t.axis||"xy",a=t.includeInvisible||!1;return vh(r,s,i,t.intersect,n,a)},x(r,e,t,n){const s=Ts(e,r);return Bb(r,s,"x",t.intersect,n)},y(r,e,t,n){const s=Ts(e,r);return Bb(r,s,"y",t.intersect,n)}}};const lk=["left","top","right","bottom"];function ya(r,e){return r.filter(t=>t.pos===e)}function zb(r,e){return r.filter(t=>lk.indexOf(t.pos)===-1&&t.box.axis===e)}function wa(r,e){return r.sort((t,n)=>{const s=e?n:t,i=e?t:n;return s.weight===i.weight?s.index-i.index:s.weight-i.weight})}function WR(r){const e=[];let t,n,s,i,a,o;for(t=0,n=(r||[]).length;t<n;++t)s=r[t],{position:i,options:{stack:a,stackWeight:o=1}}=s,e.push({index:t,box:s,pos:i,horizontal:s.isHorizontal(),weight:s.weight,stack:a&&i+a,stackWeight:o});return e}function HR(r){const e={};for(const t of r){const{stack:n,pos:s,stackWeight:i}=t;if(!n||!lk.includes(s))continue;const a=e[n]||(e[n]={count:0,placed:0,weight:0,size:0});a.count++,a.weight+=i}return e}function VR(r,e){const t=HR(r),{vBoxMaxWidth:n,hBoxMaxHeight:s}=e;let i,a,o;for(i=0,a=r.length;i<a;++i){o=r[i];const{fullSize:l}=o.box,c=t[o.stack],u=c&&o.stackWeight/c.weight;o.horizontal?(o.width=u?u*n:l&&e.availableWidth,o.height=s):(o.width=n,o.height=u?u*s:l&&e.availableHeight)}return t}function ZR(r){const e=WR(r),t=wa(e.filter(c=>c.box.fullSize),!0),n=wa(ya(e,"left"),!0),s=wa(ya(e,"right")),i=wa(ya(e,"top"),!0),a=wa(ya(e,"bottom")),o=zb(e,"x"),l=zb(e,"y");return{fullSize:t,leftAndTop:n.concat(i),rightAndBottom:s.concat(l).concat(a).concat(o),chartArea:ya(e,"chartArea"),vertical:n.concat(s).concat(l),horizontal:i.concat(a).concat(o)}}function Ub(r,e,t,n){return Math.max(r[t],e[t])+Math.max(r[n],e[n])}function ck(r,e){r.top=Math.max(r.top,e.top),r.left=Math.max(r.left,e.left),r.bottom=Math.max(r.bottom,e.bottom),r.right=Math.max(r.right,e.right)}function GR(r,e,t,n){const{pos:s,box:i}=t,a=r.maxPadding;if(!we(s)){t.size&&(r[s]-=t.size);const d=n[t.stack]||{size:0,count:1};d.size=Math.max(d.size,t.horizontal?i.height:i.width),t.size=d.size/d.count,r[s]+=t.size}i.getPadding&&ck(a,i.getPadding());const o=Math.max(0,e.outerWidth-Ub(a,r,"left","right")),l=Math.max(0,e.outerHeight-Ub(a,r,"top","bottom")),c=o!==r.w,u=l!==r.h;return r.w=o,r.h=l,t.horizontal?{same:c,other:u}:{same:u,other:c}}function JR(r){const e=r.maxPadding;function t(n){const s=Math.max(e[n]-r[n],0);return r[n]+=s,s}r.y+=t("top"),r.x+=t("left"),t("right"),t("bottom")}function KR(r,e){const t=e.maxPadding;function n(s){const i={left:0,top:0,right:0,bottom:0};return s.forEach(a=>{i[a]=Math.max(e[a],t[a])}),i}return n(r?["left","right"]:["top","bottom"])}function qa(r,e,t,n){const s=[];let i,a,o,l,c,u;for(i=0,a=r.length,c=0;i<a;++i){o=r[i],l=o.box,l.update(o.width||e.w,o.height||e.h,KR(o.horizontal,e));const{same:d,other:h}=GR(e,t,o,n);c|=d&&s.length,u=u||h,l.fullSize||s.push(o)}return c&&qa(s,e,t,n)||u}function Hl(r,e,t,n,s){r.top=t,r.left=e,r.right=e+n,r.bottom=t+s,r.width=n,r.height=s}function qb(r,e,t,n){const s=t.padding;let{x:i,y:a}=e;for(const o of r){const l=o.box,c=n[o.stack]||{placed:0,weight:1},u=o.stackWeight/c.weight||1;if(o.horizontal){const d=e.w*u,h=c.size||l.height;To(c.start)&&(a=c.start),l.fullSize?Hl(l,s.left,a,t.outerWidth-s.right-s.left,h):Hl(l,e.left+c.placed,a,d,h),c.start=a,c.placed+=d,a=l.bottom}else{const d=e.h*u,h=c.size||l.width;To(c.start)&&(i=c.start),l.fullSize?Hl(l,i,s.top,h,t.outerHeight-s.bottom-s.top):Hl(l,i,e.top+c.placed,h,d),c.start=i,c.placed+=d,i=l.right}}e.x=i,e.y=a}var wt={addBox(r,e){r.boxes||(r.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},r.boxes.push(e)},removeBox(r,e){const t=r.boxes?r.boxes.indexOf(e):-1;t!==-1&&r.boxes.splice(t,1)},configure(r,e,t){e.fullSize=t.fullSize,e.position=t.position,e.weight=t.weight},update(r,e,t,n){if(!r)return;const s=vt(r.options.layout.padding),i=Math.max(e-s.width,0),a=Math.max(t-s.height,0),o=ZR(r.boxes),l=o.vertical,c=o.horizontal;Re(r.boxes,m=>{typeof m.beforeLayout=="function"&&m.beforeLayout()});const u=l.reduce((m,g)=>g.box.options&&g.box.options.display===!1?m:m+1,0)||1,d=Object.freeze({outerWidth:e,outerHeight:t,padding:s,availableWidth:i,availableHeight:a,vBoxMaxWidth:i/2/u,hBoxMaxHeight:a/2}),h=Object.assign({},s);ck(h,vt(n));const f=Object.assign({maxPadding:h,w:i,h:a,x:s.left,y:s.top},s),p=VR(l.concat(c),d);qa(o.fullSize,f,d,p),qa(l,f,d,p),qa(c,f,d,p)&&qa(l,f,d,p),JR(f),qb(o.leftAndTop,f,d,p),f.x+=f.w,f.y+=f.h,qb(o.rightAndBottom,f,d,p),r.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},Re(o.chartArea,m=>{const g=m.box;Object.assign(g,r.chartArea),g.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})})}};class uk{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,n){}removeEventListener(e,t,n){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,n,s){return t=Math.max(0,t||e.width),n=n||e.height,{width:t,height:Math.max(0,s?Math.floor(t/s):n)}}isAttached(e){return!0}updateConfig(e){}}class XR extends uk{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const Zc="$chartjs",YR={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Wb=r=>r===null||r==="";function QR(r,e){const t=r.style,n=r.getAttribute("height"),s=r.getAttribute("width");if(r[Zc]={initial:{height:n,width:s,style:{display:t.display,height:t.height,width:t.width}}},t.display=t.display||"block",t.boxSizing=t.boxSizing||"border-box",Wb(s)){const i=Ab(r,"width");i!==void 0&&(r.width=i)}if(Wb(n))if(r.style.height==="")r.height=r.width/(e||2);else{const i=Ab(r,"height");i!==void 0&&(r.height=i)}return r}const dk=eR?{passive:!0}:!1;function eC(r,e,t){r&&r.addEventListener(e,t,dk)}function tC(r,e,t){r&&r.canvas&&r.canvas.removeEventListener(e,t,dk)}function nC(r,e){const t=YR[r.type]||r.type,{x:n,y:s}=Ts(r,e);return{type:t,chart:e,native:r,x:n!==void 0?n:null,y:s!==void 0?s:null}}function gu(r,e){for(const t of r)if(t===e||t.contains(e))return!0}function rC(r,e,t){const n=r.canvas,s=new MutationObserver(i=>{let a=!1;for(const o of i)a=a||gu(o.addedNodes,n),a=a&&!gu(o.removedNodes,n);a&&t()});return s.observe(document,{childList:!0,subtree:!0}),s}function sC(r,e,t){const n=r.canvas,s=new MutationObserver(i=>{let a=!1;for(const o of i)a=a||gu(o.removedNodes,n),a=a&&!gu(o.addedNodes,n);a&&t()});return s.observe(document,{childList:!0,subtree:!0}),s}const Io=new Map;let Hb=0;function hk(){const r=window.devicePixelRatio;r!==Hb&&(Hb=r,Io.forEach((e,t)=>{t.currentDevicePixelRatio!==r&&e()}))}function iC(r,e){Io.size||window.addEventListener("resize",hk),Io.set(r,e)}function aC(r){Io.delete(r),Io.size||window.removeEventListener("resize",hk)}function oC(r,e,t){const n=r.canvas,s=n&&Qm(n);if(!s)return;const i=zx((o,l)=>{const c=s.clientWidth;t(o,l),c<s.clientWidth&&t()},window),a=new ResizeObserver(o=>{const l=o[0],c=l.contentRect.width,u=l.contentRect.height;c===0&&u===0||i(c,u)});return a.observe(s),iC(r,i),a}function xh(r,e,t){t&&t.disconnect(),e==="resize"&&aC(r)}function lC(r,e,t){const n=r.canvas,s=zx(i=>{r.ctx!==null&&t(nC(i,r))},r);return eC(n,e,s),s}class cC extends uk{acquireContext(e,t){const n=e&&e.getContext&&e.getContext("2d");return n&&n.canvas===e?(QR(e,t),n):null}releaseContext(e){const t=e.canvas;if(!t[Zc])return!1;const n=t[Zc].initial;["height","width"].forEach(i=>{const a=n[i];ye(a)?t.removeAttribute(i):t.setAttribute(i,a)});const s=n.style||{};return Object.keys(s).forEach(i=>{t.style[i]=s[i]}),t.width=t.width,delete t[Zc],!0}addEventListener(e,t,n){this.removeEventListener(e,t);const s=e.$proxies||(e.$proxies={}),a={attach:rC,detach:sC,resize:oC}[t]||lC;s[t]=a(e,t,n)}removeEventListener(e,t){const n=e.$proxies||(e.$proxies={}),s=n[t];if(!s)return;({attach:xh,detach:xh,resize:xh}[t]||tC)(e,t,s),n[t]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,n,s){return QT(e,t,n,s)}isAttached(e){const t=e&&Qm(e);return!!(t&&t.isConnected)}}function uC(r){return!Ym()||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas?XR:cC}var Fc;let $r=(Fc=class{constructor(){M(this,"x");M(this,"y");M(this,"active",!1);M(this,"options");M(this,"$animations")}tooltipPosition(e){const{x:t,y:n}=this.getProps(["x","y"],e);return{x:t,y:n}}hasValue(){return Di(this.x)&&Di(this.y)}getProps(e,t){const n=this.$animations;if(!t||!n)return this;const s={};return e.forEach(i=>{s[i]=n[i]&&n[i].active()?n[i]._to:this[i]}),s}},M(Fc,"defaults",{}),M(Fc,"defaultRoutes"),Fc);function dC(r,e){const t=r.options.ticks,n=hC(r),s=Math.min(t.maxTicksLimit||n,n),i=t.major.enabled?pC(e):[],a=i.length,o=i[0],l=i[a-1],c=[];if(a>s)return mC(e,c,i,a/s),c;const u=fC(i,e,s);if(a>0){let d,h;const f=a>1?Math.round((l-o)/(a-1)):null;for(Vl(e,c,u,ye(f)?0:o-f,o),d=0,h=a-1;d<h;d++)Vl(e,c,u,i[d],i[d+1]);return Vl(e,c,u,l,ye(f)?e.length:l+f),c}return Vl(e,c,u),c}function hC(r){const e=r.options.offset,t=r._tickSize(),n=r._length/t+(e?0:1),s=r._maxLength/t;return Math.floor(Math.min(n,s))}function fC(r,e,t){const n=gC(r),s=e.length/t;if(!n)return Math.max(s,1);const i=nT(n);for(let a=0,o=i.length-1;a<o;a++){const l=i[a];if(l>s)return l}return Math.max(s,1)}function pC(r){const e=[];let t,n;for(t=0,n=r.length;t<n;t++)r[t].major&&e.push(t);return e}function mC(r,e,t,n){let s=0,i=t[0],a;for(n=Math.ceil(n),a=0;a<r.length;a++)a===i&&(e.push(r[a]),s++,i=t[s*n])}function Vl(r,e,t,n,s){const i=ae(n,0),a=Math.min(ae(s,r.length),r.length);let o=0,l,c,u;for(t=Math.ceil(t),s&&(l=s-n,t=l/Math.floor(l/t)),u=i;u<0;)o++,u=Math.round(i+o*t);for(c=Math.max(i,0);c<a;c++)c===u&&(e.push(r[c]),o++,u=Math.round(i+o*t))}function gC(r){const e=r.length;let t,n;if(e<2)return!1;for(n=r[0],t=1;t<e;++t)if(r[t]-r[t-1]!==n)return!1;return n}const _C=r=>r==="left"?"right":r==="right"?"left":r,Vb=(r,e,t)=>e==="top"||e==="left"?r[e]+t:r[e]-t,Zb=(r,e)=>Math.min(e||r,r);function Gb(r,e){const t=[],n=r.length/e,s=r.length;let i=0;for(;i<s;i+=n)t.push(r[Math.floor(i)]);return t}function bC(r,e,t){const n=r.ticks.length,s=Math.min(e,n-1),i=r._startPixel,a=r._endPixel,o=1e-6;let l=r.getPixelForTick(s),c;if(!(t&&(n===1?c=Math.max(l-i,a-l):e===0?c=(r.getPixelForTick(1)-l)/2:c=(l-r.getPixelForTick(s-1))/2,l+=s<e?c:-c,l<i-o||l>a+o)))return l}function yC(r,e){Re(r,t=>{const n=t.gc,s=n.length/2;let i;if(s>e){for(i=0;i<s;++i)delete t.data[n[i]];n.splice(0,s)}})}function va(r){return r.drawTicks?r.tickLength:0}function Jb(r,e){if(!r.display)return 0;const t=st(r.font,e),n=vt(r.padding);return(Ue(r.text)?r.text.length:1)*t.lineHeight+n.height}function wC(r,e){return gs(r,{scale:e,type:"scale"})}function vC(r,e,t){return gs(r,{tick:t,index:e,type:"tick"})}function xC(r,e,t){let n=Vm(r);return(t&&e!=="right"||!t&&e==="right")&&(n=_C(n)),n}function kC(r,e,t,n){const{top:s,left:i,bottom:a,right:o,chart:l}=r,{chartArea:c,scales:u}=l;let d=0,h,f,p;const m=a-s,g=o-i;if(r.isHorizontal()){if(f=_t(n,i,o),we(t)){const _=Object.keys(t)[0],y=t[_];p=u[_].getPixelForValue(y)+m-e}else t==="center"?p=(c.bottom+c.top)/2+m-e:p=Vb(r,t,e);h=o-i}else{if(we(t)){const _=Object.keys(t)[0],y=t[_];f=u[_].getPixelForValue(y)-g+e}else t==="center"?f=(c.left+c.right)/2-g+e:f=Vb(r,t,e);p=_t(n,a,s),d=t==="left"?-Ke:Ke}return{titleX:f,titleY:p,maxWidth:h,rotation:d}}class ei extends $r{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:n,_suggestedMax:s}=this;return e=tn(e,Number.POSITIVE_INFINITY),t=tn(t,Number.NEGATIVE_INFINITY),n=tn(n,Number.POSITIVE_INFINITY),s=tn(s,Number.NEGATIVE_INFINITY),{min:tn(e,n),max:tn(t,s),minDefined:Ge(e),maxDefined:Ge(t)}}getMinMax(e){let{min:t,max:n,minDefined:s,maxDefined:i}=this.getUserBounds(),a;if(s&&i)return{min:t,max:n};const o=this.getMatchingVisibleMetas();for(let l=0,c=o.length;l<c;++l)a=o[l].controller.getMinMax(this,e),s||(t=Math.min(t,a.min)),i||(n=Math.max(n,a.max));return t=i&&t>n?n:t,n=s&&t>n?t:n,{min:tn(t,tn(n,t)),max:tn(n,tn(t,n))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){je(this.options.beforeUpdate,[this])}update(e,t,n){const{beginAtZero:s,grace:i,ticks:a}=this.options,o=a.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=n=Object.assign({left:0,right:0,top:0,bottom:0},n),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+n.left+n.right:this.height+n.top+n.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=CT(this,i,s),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=o<this.ticks.length;this._convertTicksToLabels(l?Gb(this.ticks,o):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),a.display&&(a.autoSkip||a.source==="auto")&&(this.ticks=dC(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,t,n;this.isHorizontal()?(t=this.left,n=this.right):(t=this.top,n=this.bottom,e=!e),this._startPixel=t,this._endPixel=n,this._reversePixels=e,this._length=n-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){je(this.options.afterUpdate,[this])}beforeSetDimensions(){je(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){je(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),je(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){je(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const t=this.options.ticks;let n,s,i;for(n=0,s=e.length;n<s;n++)i=e[n],i.label=je(t.callback,[i.value,n,e],this)}afterTickToLabelConversion(){je(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){je(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,t=e.ticks,n=Zb(this.ticks.length,e.ticks.maxTicksLimit),s=t.minRotation||0,i=t.maxRotation;let a=s,o,l,c;if(!this._isVisible()||!t.display||s>=i||n<=1||!this.isHorizontal()){this.labelRotation=s;return}const u=this._getLabelSizes(),d=u.widest.width,h=u.highest.height,f=lt(this.chart.width-d,0,this.maxWidth);o=e.offset?this.maxWidth/n:f/(n-1),d+6>o&&(o=f/(n-(e.offset?.5:1)),l=this.maxHeight-va(e.grid)-t.padding-Jb(e.title,this.chart.options.font),c=Math.sqrt(d*d+h*h),a=Wm(Math.min(Math.asin(lt((u.highest.height+6)/o,-1,1)),Math.asin(lt(l/c,-1,1))-Math.asin(lt(h/c,-1,1)))),a=Math.max(s,Math.min(i,a))),this.labelRotation=a}afterCalculateLabelRotation(){je(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){je(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:t,options:{ticks:n,title:s,grid:i}}=this,a=this._isVisible(),o=this.isHorizontal();if(a){const l=Jb(s,t.options.font);if(o?(e.width=this.maxWidth,e.height=va(i)+l):(e.height=this.maxHeight,e.width=va(i)+l),n.display&&this.ticks.length){const{first:c,last:u,widest:d,highest:h}=this._getLabelSizes(),f=n.padding*2,p=Rn(this.labelRotation),m=Math.cos(p),g=Math.sin(p);if(o){const _=n.mirror?0:g*d.width+m*h.height;e.height=Math.min(this.maxHeight,e.height+_+f)}else{const _=n.mirror?0:m*d.width+g*h.height;e.width=Math.min(this.maxWidth,e.width+_+f)}this._calculatePadding(c,u,g,m)}}this._handleMargins(),o?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,n,s){const{ticks:{align:i,padding:a},position:o}=this.options,l=this.labelRotation!==0,c=o!=="top"&&this.axis==="x";if(this.isHorizontal()){const u=this.getPixelForTick(0)-this.left,d=this.right-this.getPixelForTick(this.ticks.length-1);let h=0,f=0;l?c?(h=s*e.width,f=n*t.height):(h=n*e.height,f=s*t.width):i==="start"?f=t.width:i==="end"?h=e.width:i!=="inner"&&(h=e.width/2,f=t.width/2),this.paddingLeft=Math.max((h-u+a)*this.width/(this.width-u),0),this.paddingRight=Math.max((f-d+a)*this.width/(this.width-d),0)}else{let u=t.height/2,d=e.height/2;i==="start"?(u=0,d=e.height):i==="end"&&(u=t.height,d=0),this.paddingTop=u+a,this.paddingBottom=d+a}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){je(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:t}=this.options;return t==="top"||t==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let t,n;for(t=0,n=e.length;t<n;t++)ye(e[t].label)&&(e.splice(t,1),n--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const t=this.options.ticks.sampleSize;let n=this.ticks;t<n.length&&(n=Gb(n,t)),this._labelSizes=e=this._computeLabelSizes(n,n.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,t,n){const{ctx:s,_longestTextCache:i}=this,a=[],o=[],l=Math.floor(t/Zb(t,n));let c=0,u=0,d,h,f,p,m,g,_,y,b,w,v;for(d=0;d<t;d+=l){if(p=e[d].label,m=this._resolveTickFontOptions(d),s.font=g=m.string,_=i[g]=i[g]||{data:{},gc:[]},y=m.lineHeight,b=w=0,!ye(p)&&!Ue(p))b=pu(s,_.data,_.gc,b,p),w=y;else if(Ue(p))for(h=0,f=p.length;h<f;++h)v=p[h],!ye(v)&&!Ue(v)&&(b=pu(s,_.data,_.gc,b,v),w+=y);a.push(b),o.push(w),c=Math.max(b,c),u=Math.max(w,u)}yC(i,t);const S=a.indexOf(c),k=o.indexOf(u),x=A=>({width:a[A]||0,height:o[A]||0});return{first:x(0),last:x(t-1),widest:x(S),highest:x(k),widths:a,heights:o}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const t=this._startPixel+e*this._length;return aT(this._alignToPixels?ks(this.chart,t,0):t)}getDecimalForPixel(e){const t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){const t=this.ticks||[];if(e>=0&&e<t.length){const n=t[e];return n.$context||(n.$context=vC(this.getContext(),e,n))}return this.$context||(this.$context=wC(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,t=Rn(this.labelRotation),n=Math.abs(Math.cos(t)),s=Math.abs(Math.sin(t)),i=this._getLabelSizes(),a=e.autoSkipPadding||0,o=i?i.widest.width+a:0,l=i?i.highest.height+a:0;return this.isHorizontal()?l*n>o*s?o/n:l/s:l*s<o*n?l/n:o/s}_isVisible(){const e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const t=this.axis,n=this.chart,s=this.options,{grid:i,position:a,border:o}=s,l=i.offset,c=this.isHorizontal(),d=this.ticks.length+(l?1:0),h=va(i),f=[],p=o.setContext(this.getContext()),m=p.display?p.width:0,g=m/2,_=function($){return ks(n,$,m)};let y,b,w,v,S,k,x,A,C,I,D,Y;if(a==="top")y=_(this.bottom),k=this.bottom-h,A=y-g,I=_(e.top)+g,Y=e.bottom;else if(a==="bottom")y=_(this.top),I=e.top,Y=_(e.bottom)-g,k=y+g,A=this.top+h;else if(a==="left")y=_(this.right),S=this.right-h,x=y-g,C=_(e.left)+g,D=e.right;else if(a==="right")y=_(this.left),C=e.left,D=_(e.right)-g,S=y+g,x=this.left+h;else if(t==="x"){if(a==="center")y=_((e.top+e.bottom)/2+.5);else if(we(a)){const $=Object.keys(a)[0],N=a[$];y=_(this.chart.scales[$].getPixelForValue(N))}I=e.top,Y=e.bottom,k=y+g,A=k+h}else if(t==="y"){if(a==="center")y=_((e.left+e.right)/2);else if(we(a)){const $=Object.keys(a)[0],N=a[$];y=_(this.chart.scales[$].getPixelForValue(N))}S=y-g,x=S-h,C=e.left,D=e.right}const O=ae(s.ticks.maxTicksLimit,d),E=Math.max(1,Math.ceil(d/O));for(b=0;b<d;b+=E){const $=this.getContext(b),N=i.setContext($),R=o.setContext($),F=N.lineWidth,V=N.color,ne=R.dash||[],J=R.dashOffset,K=N.tickWidth,z=N.tickColor,Q=N.tickBorderDash||[],be=N.tickBorderDashOffset;w=bC(this,b,l),w!==void 0&&(v=ks(n,w,F),c?S=x=C=D=v:k=A=I=Y=v,f.push({tx1:S,ty1:k,tx2:x,ty2:A,x1:C,y1:I,x2:D,y2:Y,width:F,color:V,borderDash:ne,borderDashOffset:J,tickWidth:K,tickColor:z,tickBorderDash:Q,tickBorderDashOffset:be}))}return this._ticksLength=d,this._borderValue=y,f}_computeLabelItems(e){const t=this.axis,n=this.options,{position:s,ticks:i}=n,a=this.isHorizontal(),o=this.ticks,{align:l,crossAlign:c,padding:u,mirror:d}=i,h=va(n.grid),f=h+u,p=d?-u:f,m=-Rn(this.labelRotation),g=[];let _,y,b,w,v,S,k,x,A,C,I,D,Y="middle";if(s==="top")S=this.bottom-p,k=this._getXAxisLabelAlignment();else if(s==="bottom")S=this.top+p,k=this._getXAxisLabelAlignment();else if(s==="left"){const E=this._getYAxisLabelAlignment(h);k=E.textAlign,v=E.x}else if(s==="right"){const E=this._getYAxisLabelAlignment(h);k=E.textAlign,v=E.x}else if(t==="x"){if(s==="center")S=(e.top+e.bottom)/2+f;else if(we(s)){const E=Object.keys(s)[0],$=s[E];S=this.chart.scales[E].getPixelForValue($)+f}k=this._getXAxisLabelAlignment()}else if(t==="y"){if(s==="center")v=(e.left+e.right)/2-f;else if(we(s)){const E=Object.keys(s)[0],$=s[E];v=this.chart.scales[E].getPixelForValue($)}k=this._getYAxisLabelAlignment(h).textAlign}t==="y"&&(l==="start"?Y="top":l==="end"&&(Y="bottom"));const O=this._getLabelSizes();for(_=0,y=o.length;_<y;++_){b=o[_],w=b.label;const E=i.setContext(this.getContext(_));x=this.getPixelForTick(_)+i.labelOffset,A=this._resolveTickFontOptions(_),C=A.lineHeight,I=Ue(w)?w.length:1;const $=I/2,N=E.color,R=E.textStrokeColor,F=E.textStrokeWidth;let V=k;a?(v=x,k==="inner"&&(_===y-1?V=this.options.reverse?"left":"right":_===0?V=this.options.reverse?"right":"left":V="center"),s==="top"?c==="near"||m!==0?D=-I*C+C/2:c==="center"?D=-O.highest.height/2-$*C+C:D=-O.highest.height+C/2:c==="near"||m!==0?D=C/2:c==="center"?D=O.highest.height/2-$*C:D=O.highest.height-I*C,d&&(D*=-1),m!==0&&!E.showLabelBackdrop&&(v+=C/2*Math.sin(m))):(S=x,D=(1-I)*C/2);let ne;if(E.showLabelBackdrop){const J=vt(E.backdropPadding),K=O.heights[_],z=O.widths[_];let Q=D-J.top,be=0-J.left;switch(Y){case"middle":Q-=K/2;break;case"bottom":Q-=K;break}switch(k){case"center":be-=z/2;break;case"right":be-=z;break;case"inner":_===y-1?be-=z:_>0&&(be-=z/2);break}ne={left:be,top:Q,width:z+J.width,height:K+J.height,color:E.backdropColor}}g.push({label:w,font:A,textOffset:D,options:{rotation:m,color:N,strokeColor:R,strokeWidth:F,textAlign:V,textBaseline:Y,translation:[v,S],backdrop:ne}})}return g}_getXAxisLabelAlignment(){const{position:e,ticks:t}=this.options;if(-Rn(this.labelRotation))return e==="top"?"left":"right";let s="center";return t.align==="start"?s="left":t.align==="end"?s="right":t.align==="inner"&&(s="inner"),s}_getYAxisLabelAlignment(e){const{position:t,ticks:{crossAlign:n,mirror:s,padding:i}}=this.options,a=this._getLabelSizes(),o=e+i,l=a.widest.width;let c,u;return t==="left"?s?(u=this.right+i,n==="near"?c="left":n==="center"?(c="center",u+=l/2):(c="right",u+=l)):(u=this.right-o,n==="near"?c="right":n==="center"?(c="center",u-=l/2):(c="left",u=this.left)):t==="right"?s?(u=this.left+i,n==="near"?c="right":n==="center"?(c="center",u-=l/2):(c="left",u-=l)):(u=this.left+o,n==="near"?c="left":n==="center"?(c="center",u+=l/2):(c="right",u=this.right)):c="right",{textAlign:c,x:u}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,t=this.options.position;if(t==="left"||t==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(t==="top"||t==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){const{ctx:e,options:{backgroundColor:t},left:n,top:s,width:i,height:a}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(n,s,i,a),e.restore())}getLineWidthForValue(e){const t=this.options.grid;if(!this._isVisible()||!t.display)return 0;const s=this.ticks.findIndex(i=>i.value===e);return s>=0?t.setContext(this.getContext(s)).lineWidth:0}drawGrid(e){const t=this.options.grid,n=this.ctx,s=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let i,a;const o=(l,c,u)=>{!u.width||!u.color||(n.save(),n.lineWidth=u.width,n.strokeStyle=u.color,n.setLineDash(u.borderDash||[]),n.lineDashOffset=u.borderDashOffset,n.beginPath(),n.moveTo(l.x,l.y),n.lineTo(c.x,c.y),n.stroke(),n.restore())};if(t.display)for(i=0,a=s.length;i<a;++i){const l=s[i];t.drawOnChartArea&&o({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),t.drawTicks&&o({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:t,options:{border:n,grid:s}}=this,i=n.setContext(this.getContext()),a=n.display?i.width:0;if(!a)return;const o=s.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let c,u,d,h;this.isHorizontal()?(c=ks(e,this.left,a)-a/2,u=ks(e,this.right,o)+o/2,d=h=l):(d=ks(e,this.top,a)-a/2,h=ks(e,this.bottom,o)+o/2,c=u=l),t.save(),t.lineWidth=i.width,t.strokeStyle=i.color,t.beginPath(),t.moveTo(c,d),t.lineTo(u,h),t.stroke(),t.restore()}drawLabels(e){if(!this.options.ticks.display)return;const n=this.ctx,s=this._computeLabelArea();s&&ud(n,s);const i=this.getLabelItems(e);for(const a of i){const o=a.options,l=a.font,c=a.label,u=a.textOffset;Vs(n,c,0,u,l,o)}s&&dd(n)}drawTitle(){const{ctx:e,options:{position:t,title:n,reverse:s}}=this;if(!n.display)return;const i=st(n.font),a=vt(n.padding),o=n.align;let l=i.lineHeight/2;t==="bottom"||t==="center"||we(t)?(l+=a.bottom,Ue(n.text)&&(l+=i.lineHeight*(n.text.length-1))):l+=a.top;const{titleX:c,titleY:u,maxWidth:d,rotation:h}=kC(this,l,t,o);Vs(e,n.text,0,0,i,{color:n.color,maxWidth:d,rotation:h,textAlign:xC(o,t,s),textBaseline:"middle",translation:[c,u]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,t=e.ticks&&e.ticks.z||0,n=ae(e.grid&&e.grid.z,-1),s=ae(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==ei.prototype.draw?[{z:t,draw:i=>{this.draw(i)}}]:[{z:n,draw:i=>{this.drawBackground(),this.drawGrid(i),this.drawTitle()}},{z:s,draw:()=>{this.drawBorder()}},{z:t,draw:i=>{this.drawLabels(i)}}]}getMatchingVisibleMetas(e){const t=this.chart.getSortedVisibleDatasetMetas(),n=this.axis+"AxisID",s=[];let i,a;for(i=0,a=t.length;i<a;++i){const o=t[i];o[n]===this.id&&(!e||o.type===e)&&s.push(o)}return s}_resolveTickFontOptions(e){const t=this.options.ticks.setContext(this.getContext(e));return st(t.font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class Zl{constructor(e,t,n){this.type=e,this.scope=t,this.override=n,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const t=Object.getPrototypeOf(e);let n;EC(t)&&(n=this.register(t));const s=this.items,i=e.id,a=this.scope+"."+i;if(!i)throw new Error("class does not have id: "+e);return i in s||(s[i]=e,SC(e,a,n),this.override&&qe.override(e.id,e.overrides)),a}get(e){return this.items[e]}unregister(e){const t=this.items,n=e.id,s=this.scope;n in t&&delete t[n],s&&n in qe[s]&&(delete qe[s][n],this.override&&delete Hs[n])}}function SC(r,e,t){const n=Oo(Object.create(null),[t?qe.get(t):{},qe.get(e),r.defaults]);qe.set(e,n),r.defaultRoutes&&PC(e,r.defaultRoutes),r.descriptors&&qe.describe(e,r.descriptors)}function PC(r,e){Object.keys(e).forEach(t=>{const n=t.split("."),s=n.pop(),i=[r].concat(n).join("."),a=e[t].split("."),o=a.pop(),l=a.join(".");qe.route(i,s,l,o)})}function EC(r){return"id"in r&&"defaults"in r}class AC{constructor(){this.controllers=new Zl(Nn,"datasets",!0),this.elements=new Zl($r,"elements"),this.plugins=new Zl(Object,"plugins"),this.scales=new Zl(ei,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,t,n){[...t].forEach(s=>{const i=n||this._getRegistryForType(s);n||i.isForType(s)||i===this.plugins&&s.id?this._exec(e,i,s):Re(s,a=>{const o=n||this._getRegistryForType(a);this._exec(e,o,a)})})}_exec(e,t,n){const s=qm(e);je(n["before"+s],[],n),t[e](n),je(n["after"+s],[],n)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){const n=this._typedRegistries[t];if(n.isForType(e))return n}return this.plugins}_get(e,t,n){const s=t.get(e);if(s===void 0)throw new Error('"'+e+'" is not a registered '+n+".");return s}}var Gn=new AC;class OC{constructor(){this._init=[]}notify(e,t,n,s){t==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const i=s?this._descriptors(e).filter(s):this._descriptors(e),a=this._notify(i,e,t,n);return t==="afterDestroy"&&(this._notify(i,e,"stop"),this._notify(this._init,e,"uninstall")),a}_notify(e,t,n,s){s=s||{};for(const i of e){const a=i.plugin,o=a[n],l=[t,s,i.options];if(je(o,l,a)===!1&&s.cancelable)return!1}return!0}invalidate(){ye(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){const n=e&&e.config,s=ae(n.options&&n.options.plugins,{}),i=TC(n);return s===!1&&!t?[]:CC(e,i,s,t)}_notifyStateChanges(e){const t=this._oldCache||[],n=this._cache,s=(i,a)=>i.filter(o=>!a.some(l=>o.plugin.id===l.plugin.id));this._notify(s(t,n),e,"stop"),this._notify(s(n,t),e,"start")}}function TC(r){const e={},t=[],n=Object.keys(Gn.plugins.items);for(let i=0;i<n.length;i++)t.push(Gn.getPlugin(n[i]));const s=r.plugins||[];for(let i=0;i<s.length;i++){const a=s[i];t.indexOf(a)===-1&&(t.push(a),e[a.id]=!0)}return{plugins:t,localIds:e}}function RC(r,e){return!e&&r===!1?null:r===!0?{}:r}function CC(r,{plugins:e,localIds:t},n,s){const i=[],a=r.getContext();for(const o of e){const l=o.id,c=RC(n[l],s);c!==null&&i.push({plugin:o,options:IC(r.config,{plugin:o,local:t[l]},c,a)})}return i}function IC(r,{plugin:e,local:t},n,s){const i=r.pluginScopeKeys(e),a=r.getOptionScopes(n,i);return t&&e.defaults&&a.push(e.defaults),r.createResolver(a,s,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Ip(r,e){const t=qe.datasets[r]||{};return((e.datasets||{})[r]||{}).indexAxis||e.indexAxis||t.indexAxis||"x"}function $C(r,e){let t=r;return r==="_index_"?t=e:r==="_value_"&&(t=e==="x"?"y":"x"),t}function MC(r,e){return r===e?"_index_":"_value_"}function Kb(r){if(r==="x"||r==="y"||r==="r")return r}function NC(r){if(r==="top"||r==="bottom")return"x";if(r==="left"||r==="right")return"y"}function $p(r,...e){if(Kb(r))return r;for(const t of e){const n=t.axis||NC(t.position)||r.length>1&&Kb(r[0].toLowerCase());if(n)return n}throw new Error(`Cannot determine type of '${r}' axis. Please provide 'axis' or 'position' option.`)}function Xb(r,e,t){if(t[e+"AxisID"]===r)return{axis:e}}function LC(r,e){if(e.data&&e.data.datasets){const t=e.data.datasets.filter(n=>n.xAxisID===r||n.yAxisID===r);if(t.length)return Xb(r,"x",t[0])||Xb(r,"y",t[0])}return{}}function jC(r,e){const t=Hs[r.type]||{scales:{}},n=e.scales||{},s=Ip(r.type,e),i=Object.create(null);return Object.keys(n).forEach(a=>{const o=n[a];if(!we(o))return console.error(`Invalid scale configuration for scale: ${a}`);if(o._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${a}`);const l=$p(a,o,LC(a,r),qe.scales[o.type]),c=MC(l,s),u=t.scales||{};i[a]=so(Object.create(null),[{axis:l},o,u[l],u[c]])}),r.data.datasets.forEach(a=>{const o=a.type||r.type,l=a.indexAxis||Ip(o,e),u=(Hs[o]||{}).scales||{};Object.keys(u).forEach(d=>{const h=$C(d,l),f=a[h+"AxisID"]||h;i[f]=i[f]||Object.create(null),so(i[f],[{axis:h},n[f],u[d]])})}),Object.keys(i).forEach(a=>{const o=i[a];so(o,[qe.scales[o.type],qe.scale])}),i}function fk(r){const e=r.options||(r.options={});e.plugins=ae(e.plugins,{}),e.scales=jC(r,e)}function pk(r){return r=r||{},r.datasets=r.datasets||[],r.labels=r.labels||[],r}function DC(r){return r=r||{},r.data=pk(r.data),fk(r),r}const Yb=new Map,mk=new Set;function Gl(r,e){let t=Yb.get(r);return t||(t=e(),Yb.set(r,t),mk.add(t)),t}const xa=(r,e,t)=>{const n=is(e,t);n!==void 0&&r.add(n)};class FC{constructor(e){this._config=DC(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=pk(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),fk(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return Gl(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,t){return Gl(`${e}.transition.${t}`,()=>[[`datasets.${e}.transitions.${t}`,`transitions.${t}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,t){return Gl(`${e}-${t}`,()=>[[`datasets.${e}.elements.${t}`,`datasets.${e}`,`elements.${t}`,""]])}pluginScopeKeys(e){const t=e.id,n=this.type;return Gl(`${n}-plugin-${t}`,()=>[[`plugins.${t}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,t){const n=this._scopeCache;let s=n.get(e);return(!s||t)&&(s=new Map,n.set(e,s)),s}getOptionScopes(e,t,n){const{options:s,type:i}=this,a=this._cachedScopes(e,n),o=a.get(t);if(o)return o;const l=new Set;t.forEach(u=>{e&&(l.add(e),u.forEach(d=>xa(l,e,d))),u.forEach(d=>xa(l,s,d)),u.forEach(d=>xa(l,Hs[i]||{},d)),u.forEach(d=>xa(l,qe,d)),u.forEach(d=>xa(l,Tp,d))});const c=Array.from(l);return c.length===0&&c.push(Object.create(null)),mk.has(t)&&a.set(t,c),c}chartOptionScopes(){const{options:e,type:t}=this;return[e,Hs[t]||{},qe.datasets[t]||{},{type:t},qe,Tp]}resolveNamedOptions(e,t,n,s=[""]){const i={$shared:!0},{resolver:a,subPrefixes:o}=Qb(this._resolverCache,e,s);let l=a;if(zC(a,t)){i.$shared=!1,n=as(n)?n():n;const c=this.createResolver(e,n,o);l=Fi(a,n,c)}for(const c of t)i[c]=l[c];return i}createResolver(e,t,n=[""],s){const{resolver:i}=Qb(this._resolverCache,e,n);return we(t)?Fi(i,t,void 0,s):i}}function Qb(r,e,t){let n=r.get(e);n||(n=new Map,r.set(e,n));const s=t.join();let i=n.get(s);return i||(i={resolver:Jm(e,t),subPrefixes:t.filter(o=>!o.toLowerCase().includes("hover"))},n.set(s,i)),i}const BC=r=>we(r)&&Object.getOwnPropertyNames(r).some(e=>as(r[e]));function zC(r,e){const{isScriptable:t,isIndexable:n}=Zx(r);for(const s of e){const i=t(s),a=n(s),o=(a||i)&&r[s];if(i&&(as(o)||BC(o))||a&&Ue(o))return!0}return!1}var UC="4.4.9";const qC=["top","bottom","left","right","chartArea"];function ey(r,e){return r==="top"||r==="bottom"||qC.indexOf(r)===-1&&e==="x"}function ty(r,e){return function(t,n){return t[r]===n[r]?t[e]-n[e]:t[r]-n[r]}}function ny(r){const e=r.chart,t=e.options.animation;e.notifyPlugins("afterRender"),je(t&&t.onComplete,[r],e)}function WC(r){const e=r.chart,t=e.options.animation;je(t&&t.onProgress,[r],e)}function gk(r){return Ym()&&typeof r=="string"?r=document.getElementById(r):r&&r.length&&(r=r[0]),r&&r.canvas&&(r=r.canvas),r}const Gc={},ry=r=>{const e=gk(r);return Object.values(Gc).filter(t=>t.canvas===e).pop()};function HC(r,e,t){const n=Object.keys(r);for(const s of n){const i=+s;if(i>=e){const a=r[s];delete r[s],(t>0||i>e)&&(r[i+t]=a)}}}function VC(r,e,t,n){return!t||r.type==="mouseout"?null:n?e:r}class vr{static register(...e){Gn.add(...e),sy()}static unregister(...e){Gn.remove(...e),sy()}constructor(e,t){const n=this.config=new FC(t),s=gk(e),i=ry(s);if(i)throw new Error("Canvas is already in use. Chart with ID '"+i.id+"' must be destroyed before the canvas with ID '"+i.canvas.id+"' can be reused.");const a=n.createResolver(n.chartOptionScopes(),this.getContext());this.platform=new(n.platform||uC(s)),this.platform.updateConfig(n);const o=this.platform.acquireContext(s,a.aspectRatio),l=o&&o.canvas,c=l&&l.height,u=l&&l.width;if(this.id=ZO(),this.ctx=o,this.canvas=l,this.width=u,this.height=c,this._options=a,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new OC,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=uT(d=>this.update(d),a.resizeDelay||0),this._dataChanges=[],Gc[this.id]=this,!o||!l){console.error("Failed to create chart: can't acquire context from the given item");return}gr.listen(this,"complete",ny),gr.listen(this,"progress",WC),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:t},width:n,height:s,_aspectRatio:i}=this;return ye(e)?t&&i?i:s?n/s:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return Gn}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Eb(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return kb(this.canvas,this.ctx),this}stop(){return gr.stop(this),this}resize(e,t){gr.running(this)?this._resizeBeforeDraw={width:e,height:t}:this._resize(e,t)}_resize(e,t){const n=this.options,s=this.canvas,i=n.maintainAspectRatio&&this.aspectRatio,a=this.platform.getMaximumSize(s,e,t,i),o=n.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=a.width,this.height=a.height,this._aspectRatio=this.aspectRatio,Eb(this,o,!0)&&(this.notifyPlugins("resize",{size:a}),je(n.onResize,[this,a],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const t=this.options.scales||{};Re(t,(n,s)=>{n.id=s})}buildOrUpdateScales(){const e=this.options,t=e.scales,n=this.scales,s=Object.keys(n).reduce((a,o)=>(a[o]=!1,a),{});let i=[];t&&(i=i.concat(Object.keys(t).map(a=>{const o=t[a],l=$p(a,o),c=l==="r",u=l==="x";return{options:o,dposition:c?"chartArea":u?"bottom":"left",dtype:c?"radialLinear":u?"category":"linear"}}))),Re(i,a=>{const o=a.options,l=o.id,c=$p(l,o),u=ae(o.type,a.dtype);(o.position===void 0||ey(o.position,c)!==ey(a.dposition))&&(o.position=a.dposition),s[l]=!0;let d=null;if(l in n&&n[l].type===u)d=n[l];else{const h=Gn.getScale(u);d=new h({id:l,type:u,ctx:this.ctx,chart:this}),n[d.id]=d}d.init(o,e)}),Re(s,(a,o)=>{a||delete n[o]}),Re(n,a=>{wt.configure(this,a,a.options),wt.addBox(this,a)})}_updateMetasets(){const e=this._metasets,t=this.data.datasets.length,n=e.length;if(e.sort((s,i)=>s.index-i.index),n>t){for(let s=t;s<n;++s)this._destroyDatasetMeta(s);e.splice(t,n-t)}this._sortedMetasets=e.slice(0).sort(ty("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:t}}=this;e.length>t.length&&delete this._stacks,e.forEach((n,s)=>{t.filter(i=>i===n._dataset).length===0&&this._destroyDatasetMeta(s)})}buildOrUpdateControllers(){const e=[],t=this.data.datasets;let n,s;for(this._removeUnreferencedMetasets(),n=0,s=t.length;n<s;n++){const i=t[n];let a=this.getDatasetMeta(n);const o=i.type||this.config.type;if(a.type&&a.type!==o&&(this._destroyDatasetMeta(n),a=this.getDatasetMeta(n)),a.type=o,a.indexAxis=i.indexAxis||Ip(o,this.options),a.order=i.order||0,a.index=n,a.label=""+i.label,a.visible=this.isDatasetVisible(n),a.controller)a.controller.updateIndex(n),a.controller.linkScales();else{const l=Gn.getController(o),{datasetElementType:c,dataElementType:u}=qe.datasets[o];Object.assign(l,{dataElementType:Gn.getElement(u),datasetElementType:c&&Gn.getElement(c)}),a.controller=new l(this,n),e.push(a.controller)}}return this._updateMetasets(),e}_resetElements(){Re(this.data.datasets,(e,t)=>{this.getDatasetMeta(t).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const t=this.config;t.update();const n=this._options=t.createResolver(t.chartOptionScopes(),this.getContext()),s=this._animationsDisabled=!n.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;const i=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let a=0;for(let c=0,u=this.data.datasets.length;c<u;c++){const{controller:d}=this.getDatasetMeta(c),h=!s&&i.indexOf(d)===-1;d.buildOrUpdateElements(h),a=Math.max(+d.getMaxOverflow(),a)}a=this._minPadding=n.layout.autoPadding?a:0,this._updateLayout(a),s||Re(i,c=>{c.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(ty("z","_idx"));const{_active:o,_lastEvent:l}=this;l?this._eventHandler(l,!0):o.length&&this._updateHoverStyles(o,o,!0),this.render()}_updateScales(){Re(this.scales,e=>{wt.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,t=new Set(Object.keys(this._listeners)),n=new Set(e.events);(!pb(t,n)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,t=this._getUniformDataChanges()||[];for(const{method:n,start:s,count:i}of t){const a=n==="_removeElements"?-i:i;HC(e,s,a)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const t=this.data.datasets.length,n=i=>new Set(e.filter(a=>a[0]===i).map((a,o)=>o+","+a.splice(1).join(","))),s=n(0);for(let i=1;i<t;i++)if(!pb(s,n(i)))return;return Array.from(s).map(i=>i.split(",")).map(i=>({method:i[1],start:+i[2],count:+i[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;wt.update(this,this.width,this.height,e);const t=this.chartArea,n=t.width<=0||t.height<=0;this._layers=[],Re(this.boxes,s=>{n&&s.position==="chartArea"||(s.configure&&s.configure(),this._layers.push(...s._layers()))},this),this._layers.forEach((s,i)=>{s._idx=i}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let t=0,n=this.data.datasets.length;t<n;++t)this.getDatasetMeta(t).controller.configure();for(let t=0,n=this.data.datasets.length;t<n;++t)this._updateDataset(t,as(e)?e({datasetIndex:t}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,t){const n=this.getDatasetMeta(e),s={meta:n,index:e,mode:t,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",s)!==!1&&(n.controller._update(t),s.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",s))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(gr.has(this)?this.attached&&!gr.running(this)&&gr.start(this):(this.draw(),ny({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:n,height:s}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(n,s)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const t=this._layers;for(e=0;e<t.length&&t[e].z<=0;++e)t[e].draw(this.chartArea);for(this._drawDatasets();e<t.length;++e)t[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const t=this._sortedMetasets,n=[];let s,i;for(s=0,i=t.length;s<i;++s){const a=t[s];(!e||a.visible)&&n.push(a)}return n}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const e=this.getSortedVisibleDatasetMetas();for(let t=e.length-1;t>=0;--t)this._drawDataset(e[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const t=this.ctx,n={meta:e,index:e.index,cancelable:!0},s=sk(this,e);this.notifyPlugins("beforeDatasetDraw",n)!==!1&&(s&&ud(t,s),e.controller.draw(),s&&dd(t),n.cancelable=!1,this.notifyPlugins("afterDatasetDraw",n))}isPointInArea(e){return Er(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,t,n,s){const i=qR.modes[t];return typeof i=="function"?i(this,e,n,s):[]}getDatasetMeta(e){const t=this.data.datasets[e],n=this._metasets;let s=n.filter(i=>i&&i._dataset===t).pop();return s||(s={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:e,_dataset:t,_parsed:[],_sorted:!1},n.push(s)),s}getContext(){return this.$context||(this.$context=gs(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const t=this.data.datasets[e];if(!t)return!1;const n=this.getDatasetMeta(e);return typeof n.hidden=="boolean"?!n.hidden:!t.hidden}setDatasetVisibility(e,t){const n=this.getDatasetMeta(e);n.hidden=!t}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,t,n){const s=n?"show":"hide",i=this.getDatasetMeta(e),a=i.controller._resolveAnimations(void 0,s);To(t)?(i.data[t].hidden=!n,this.update()):(this.setDatasetVisibility(e,n),a.update(i,{visible:n}),this.update(o=>o.datasetIndex===e?s:void 0))}hide(e,t){this._updateVisibility(e,t,!1)}show(e,t){this._updateVisibility(e,t,!0)}_destroyDatasetMeta(e){const t=this._metasets[e];t&&t.controller&&t.controller._destroy(),delete this._metasets[e]}_stop(){let e,t;for(this.stop(),gr.remove(this),e=0,t=this.data.datasets.length;e<t;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:t}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),kb(e,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),delete Gc[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,t=this.platform,n=(i,a)=>{t.addEventListener(this,i,a),e[i]=a},s=(i,a,o)=>{i.offsetX=a,i.offsetY=o,this._eventHandler(i)};Re(this.options.events,i=>n(i,s))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,t=this.platform,n=(l,c)=>{t.addEventListener(this,l,c),e[l]=c},s=(l,c)=>{e[l]&&(t.removeEventListener(this,l,c),delete e[l])},i=(l,c)=>{this.canvas&&this.resize(l,c)};let a;const o=()=>{s("attach",o),this.attached=!0,this.resize(),n("resize",i),n("detach",a)};a=()=>{this.attached=!1,s("resize",i),this._stop(),this._resize(0,0),n("attach",o)},t.isAttached(this.canvas)?o():a()}unbindEvents(){Re(this._listeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._listeners={},Re(this._responsiveListeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,t,n){const s=n?"set":"remove";let i,a,o,l;for(t==="dataset"&&(i=this.getDatasetMeta(e[0].datasetIndex),i.controller["_"+s+"DatasetHoverStyle"]()),o=0,l=e.length;o<l;++o){a=e[o];const c=a&&this.getDatasetMeta(a.datasetIndex).controller;c&&c[s+"HoverStyle"](a.element,a.datasetIndex,a.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const t=this._active||[],n=e.map(({datasetIndex:i,index:a})=>{const o=this.getDatasetMeta(i);if(!o)throw new Error("No dataset found at index "+i);return{datasetIndex:i,element:o.data[a],index:a}});!du(n,t)&&(this._active=n,this._lastEvent=null,this._updateHoverStyles(n,t))}notifyPlugins(e,t,n){return this._plugins.notify(this,e,t,n)}isPluginEnabled(e){return this._plugins._cache.filter(t=>t.plugin.id===e).length===1}_updateHoverStyles(e,t,n){const s=this.options.hover,i=(l,c)=>l.filter(u=>!c.some(d=>u.datasetIndex===d.datasetIndex&&u.index===d.index)),a=i(t,e),o=n?e:i(e,t);a.length&&this.updateHoverStyle(a,s.mode,!1),o.length&&s.mode&&this.updateHoverStyle(o,s.mode,!0)}_eventHandler(e,t){const n={event:e,replay:t,cancelable:!0,inChartArea:this.isPointInArea(e)},s=a=>(a.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",n,s)===!1)return;const i=this._handleEvent(e,t,n.inChartArea);return n.cancelable=!1,this.notifyPlugins("afterEvent",n,s),(i||n.changed)&&this.render(),this}_handleEvent(e,t,n){const{_active:s=[],options:i}=this,a=t,o=this._getActiveElements(e,s,n,a),l=QO(e),c=VC(e,this._lastEvent,n,l);n&&(this._lastEvent=null,je(i.onHover,[e,o,this],this),l&&je(i.onClick,[e,o,this],this));const u=!du(o,s);return(u||t)&&(this._active=o,this._updateHoverStyles(o,s,t)),this._lastEvent=c,u}_getActiveElements(e,t,n,s){if(e.type==="mouseout")return[];if(!n)return t;const i=this.options.hover;return this.getElementsAtEventForMode(e,i.mode,i,s)}}M(vr,"defaults",qe),M(vr,"instances",Gc),M(vr,"overrides",Hs),M(vr,"registry",Gn),M(vr,"version",UC),M(vr,"getChart",ry);function sy(){return Re(vr.instances,r=>r._plugins.invalidate())}function ZC(r,e,t){const{startAngle:n,pixelMargin:s,x:i,y:a,outerRadius:o,innerRadius:l}=e;let c=s/o;r.beginPath(),r.arc(i,a,o,n-c,t+c),l>s?(c=s/l,r.arc(i,a,l,t+c,n-c,!0)):r.arc(i,a,s,t+Ke,n-Ke),r.closePath(),r.clip()}function GC(r){return Gm(r,["outerStart","outerEnd","innerStart","innerEnd"])}function JC(r,e,t,n){const s=GC(r.options.borderRadius),i=(t-e)/2,a=Math.min(i,n*e/2),o=l=>{const c=(t-Math.min(i,l))*n/2;return lt(l,0,Math.min(i,c))};return{outerStart:o(s.outerStart),outerEnd:o(s.outerEnd),innerStart:lt(s.innerStart,0,a),innerEnd:lt(s.innerEnd,0,a)}}function li(r,e,t,n){return{x:t+r*Math.cos(e),y:n+r*Math.sin(e)}}function _u(r,e,t,n,s,i){const{x:a,y:o,startAngle:l,pixelMargin:c,innerRadius:u}=e,d=Math.max(e.outerRadius+n+t-c,0),h=u>0?u+n+t+c:0;let f=0;const p=s-l;if(n){const E=u>0?u-n:0,$=d>0?d-n:0,N=(E+$)/2,R=N!==0?p*N/(N+n):p;f=(p-R)/2}const m=Math.max(.001,p*d-t/Be)/d,g=(p-m)/2,_=l+g+f,y=s-g-f,{outerStart:b,outerEnd:w,innerStart:v,innerEnd:S}=JC(e,h,d,y-_),k=d-b,x=d-w,A=_+b/k,C=y-w/x,I=h+v,D=h+S,Y=_+v/I,O=y-S/D;if(r.beginPath(),i){const E=(A+C)/2;if(r.arc(a,o,d,A,E),r.arc(a,o,d,E,C),w>0){const F=li(x,C,a,o);r.arc(F.x,F.y,w,C,y+Ke)}const $=li(D,y,a,o);if(r.lineTo($.x,$.y),S>0){const F=li(D,O,a,o);r.arc(F.x,F.y,S,y+Ke,O+Math.PI)}const N=(y-S/h+(_+v/h))/2;if(r.arc(a,o,h,y-S/h,N,!0),r.arc(a,o,h,N,_+v/h,!0),v>0){const F=li(I,Y,a,o);r.arc(F.x,F.y,v,Y+Math.PI,_-Ke)}const R=li(k,_,a,o);if(r.lineTo(R.x,R.y),b>0){const F=li(k,A,a,o);r.arc(F.x,F.y,b,_-Ke,A)}}else{r.moveTo(a,o);const E=Math.cos(A)*d+a,$=Math.sin(A)*d+o;r.lineTo(E,$);const N=Math.cos(C)*d+a,R=Math.sin(C)*d+o;r.lineTo(N,R)}r.closePath()}function KC(r,e,t,n,s){const{fullCircles:i,startAngle:a,circumference:o}=e;let l=e.endAngle;if(i){_u(r,e,t,n,l,s);for(let c=0;c<i;++c)r.fill();isNaN(o)||(l=a+(o%Fe||Fe))}return _u(r,e,t,n,l,s),r.fill(),l}function XC(r,e,t,n,s){const{fullCircles:i,startAngle:a,circumference:o,options:l}=e,{borderWidth:c,borderJoinStyle:u,borderDash:d,borderDashOffset:h}=l,f=l.borderAlign==="inner";if(!c)return;r.setLineDash(d||[]),r.lineDashOffset=h,f?(r.lineWidth=c*2,r.lineJoin=u||"round"):(r.lineWidth=c,r.lineJoin=u||"bevel");let p=e.endAngle;if(i){_u(r,e,t,n,p,s);for(let m=0;m<i;++m)r.stroke();isNaN(o)||(p=a+(o%Fe||Fe))}f&&ZC(r,e,p),i||(_u(r,e,t,n,p,s),r.stroke())}class Wa extends $r{constructor(t){super();M(this,"circumference");M(this,"endAngle");M(this,"fullCircles");M(this,"innerRadius");M(this,"outerRadius");M(this,"pixelMargin");M(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,t&&Object.assign(this,t)}inRange(t,n,s){const i=this.getProps(["x","y"],s),{angle:a,distance:o}=jx(i,{x:t,y:n}),{startAngle:l,endAngle:c,innerRadius:u,outerRadius:d,circumference:h}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],s),f=(this.options.spacing+this.options.borderWidth)/2,p=ae(h,c-l),m=Ro(a,l,c)&&l!==c,g=p>=Fe||m,_=Sr(o,u+f,d+f);return g&&_}getCenterPoint(t){const{x:n,y:s,startAngle:i,endAngle:a,innerRadius:o,outerRadius:l}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],t),{offset:c,spacing:u}=this.options,d=(i+a)/2,h=(o+l+u+c)/2;return{x:n+Math.cos(d)*h,y:s+Math.sin(d)*h}}tooltipPosition(t){return this.getCenterPoint(t)}draw(t){const{options:n,circumference:s}=this,i=(n.offset||0)/4,a=(n.spacing||0)/2,o=n.circular;if(this.pixelMargin=n.borderAlign==="inner"?.33:0,this.fullCircles=s>Fe?Math.floor(s/Fe):0,s===0||this.innerRadius<0||this.outerRadius<0)return;t.save();const l=(this.startAngle+this.endAngle)/2;t.translate(Math.cos(l)*i,Math.sin(l)*i);const c=1-Math.sin(Math.min(Be,s||0)),u=i*c;t.fillStyle=n.backgroundColor,t.strokeStyle=n.borderColor,KC(t,this,u,a,o),XC(t,this,u,a,o),t.restore()}}M(Wa,"id","arc"),M(Wa,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),M(Wa,"defaultRoutes",{backgroundColor:"backgroundColor"}),M(Wa,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"});function _k(r,e,t=e){r.lineCap=ae(t.borderCapStyle,e.borderCapStyle),r.setLineDash(ae(t.borderDash,e.borderDash)),r.lineDashOffset=ae(t.borderDashOffset,e.borderDashOffset),r.lineJoin=ae(t.borderJoinStyle,e.borderJoinStyle),r.lineWidth=ae(t.borderWidth,e.borderWidth),r.strokeStyle=ae(t.borderColor,e.borderColor)}function YC(r,e,t){r.lineTo(t.x,t.y)}function QC(r){return r.stepped?xT:r.tension||r.cubicInterpolationMode==="monotone"?kT:YC}function bk(r,e,t={}){const n=r.length,{start:s=0,end:i=n-1}=t,{start:a,end:o}=e,l=Math.max(s,a),c=Math.min(i,o),u=s<a&&i<a||s>o&&i>o;return{count:n,start:l,loop:e.loop,ilen:c<l&&!u?n+c-l:c-l}}function eI(r,e,t,n){const{points:s,options:i}=e,{count:a,start:o,loop:l,ilen:c}=bk(s,t,n),u=QC(i);let{move:d=!0,reverse:h}=n||{},f,p,m;for(f=0;f<=c;++f)p=s[(o+(h?c-f:f))%a],!p.skip&&(d?(r.moveTo(p.x,p.y),d=!1):u(r,m,p,h,i.stepped),m=p);return l&&(p=s[(o+(h?c:0))%a],u(r,m,p,h,i.stepped)),!!l}function tI(r,e,t,n){const s=e.points,{count:i,start:a,ilen:o}=bk(s,t,n),{move:l=!0,reverse:c}=n||{};let u=0,d=0,h,f,p,m,g,_;const y=w=>(a+(c?o-w:w))%i,b=()=>{m!==g&&(r.lineTo(u,g),r.lineTo(u,m),r.lineTo(u,_))};for(l&&(f=s[y(0)],r.moveTo(f.x,f.y)),h=0;h<=o;++h){if(f=s[y(h)],f.skip)continue;const w=f.x,v=f.y,S=w|0;S===p?(v<m?m=v:v>g&&(g=v),u=(d*u+w)/++d):(b(),r.lineTo(w,v),p=S,d=0,m=g=v),_=v}b()}function Mp(r){const e=r.options,t=e.borderDash&&e.borderDash.length;return!r._decimated&&!r._loop&&!e.tension&&e.cubicInterpolationMode!=="monotone"&&!e.stepped&&!t?tI:eI}function nI(r){return r.stepped?tR:r.tension||r.cubicInterpolationMode==="monotone"?nR:Rs}function rI(r,e,t,n){let s=e._path;s||(s=e._path=new Path2D,e.path(s,t,n)&&s.closePath()),_k(r,e.options),r.stroke(s)}function sI(r,e,t,n){const{segments:s,options:i}=e,a=Mp(e);for(const o of s)_k(r,i,o.style),r.beginPath(),a(r,e,o,{start:t,end:t+n-1})&&r.closePath(),r.stroke()}const iI=typeof Path2D=="function";function aI(r,e,t,n){iI&&!e.options.segment?rI(r,e,t,n):sI(r,e,t,n)}class Yr extends $r{constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,t){const n=this.options;if((n.tension||n.cubicInterpolationMode==="monotone")&&!n.stepped&&!this._pointsUpdated){const s=n.spanGaps?this._loop:this._fullLoop;ZT(this._points,n,e,s,t),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=lR(this,this.options.segment))}first(){const e=this.segments,t=this.points;return e.length&&t[e[0].start]}last(){const e=this.segments,t=this.points,n=e.length;return n&&t[e[n-1].end]}interpolate(e,t){const n=this.options,s=e[t],i=this.points,a=rk(this,{property:t,start:s,end:s});if(!a.length)return;const o=[],l=nI(n);let c,u;for(c=0,u=a.length;c<u;++c){const{start:d,end:h}=a[c],f=i[d],p=i[h];if(f===p){o.push(f);continue}const m=Math.abs((s-f[t])/(p[t]-f[t])),g=l(f,p,m,n.stepped);g[t]=e[t],o.push(g)}return o.length===1?o[0]:o}pathSegment(e,t,n){return Mp(this)(e,this,t,n)}path(e,t,n){const s=this.segments,i=Mp(this);let a=this._loop;t=t||0,n=n||this.points.length-t;for(const o of s)a&=i(e,this,o,{start:t,end:t+n-1});return!!a}draw(e,t,n,s){const i=this.options||{};(this.points||[]).length&&i.borderWidth&&(e.save(),aI(e,this,n,s),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}M(Yr,"id","line"),M(Yr,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),M(Yr,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),M(Yr,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"&&e!=="fill"});function iy(r,e,t,n){const s=r.options,{[t]:i}=r.getProps([t],n);return Math.abs(e-i)<s.radius+s.hitRadius}class Jc extends $r{constructor(t){super();M(this,"parsed");M(this,"skip");M(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,n,s){const i=this.options,{x:a,y:o}=this.getProps(["x","y"],s);return Math.pow(t-a,2)+Math.pow(n-o,2)<Math.pow(i.hitRadius+i.radius,2)}inXRange(t,n){return iy(this,t,"x",n)}inYRange(t,n){return iy(this,t,"y",n)}getCenterPoint(t){const{x:n,y:s}=this.getProps(["x","y"],t);return{x:n,y:s}}size(t){t=t||this.options||{};let n=t.radius||0;n=Math.max(n,n&&t.hoverRadius||0);const s=n&&t.borderWidth||0;return(n+s)*2}draw(t,n){const s=this.options;this.skip||s.radius<.1||!Er(this,n,this.size(s)/2)||(t.strokeStyle=s.borderColor,t.lineWidth=s.borderWidth,t.fillStyle=s.backgroundColor,Rp(t,s,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}M(Jc,"id","point"),M(Jc,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),M(Jc,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function yk(r,e){const{x:t,y:n,base:s,width:i,height:a}=r.getProps(["x","y","base","width","height"],e);let o,l,c,u,d;return r.horizontal?(d=a/2,o=Math.min(t,s),l=Math.max(t,s),c=n-d,u=n+d):(d=i/2,o=t-d,l=t+d,c=Math.min(n,s),u=Math.max(n,s)),{left:o,top:c,right:l,bottom:u}}function Qr(r,e,t,n){return r?0:lt(e,t,n)}function oI(r,e,t){const n=r.options.borderWidth,s=r.borderSkipped,i=Vx(n);return{t:Qr(s.top,i.top,0,t),r:Qr(s.right,i.right,0,e),b:Qr(s.bottom,i.bottom,0,t),l:Qr(s.left,i.left,0,e)}}function lI(r,e,t){const{enableBorderRadius:n}=r.getProps(["enableBorderRadius"]),s=r.options.borderRadius,i=js(s),a=Math.min(e,t),o=r.borderSkipped,l=n||we(s);return{topLeft:Qr(!l||o.top||o.left,i.topLeft,0,a),topRight:Qr(!l||o.top||o.right,i.topRight,0,a),bottomLeft:Qr(!l||o.bottom||o.left,i.bottomLeft,0,a),bottomRight:Qr(!l||o.bottom||o.right,i.bottomRight,0,a)}}function cI(r){const e=yk(r),t=e.right-e.left,n=e.bottom-e.top,s=oI(r,t/2,n/2),i=lI(r,t/2,n/2);return{outer:{x:e.left,y:e.top,w:t,h:n,radius:i},inner:{x:e.left+s.l,y:e.top+s.t,w:t-s.l-s.r,h:n-s.t-s.b,radius:{topLeft:Math.max(0,i.topLeft-Math.max(s.t,s.l)),topRight:Math.max(0,i.topRight-Math.max(s.t,s.r)),bottomLeft:Math.max(0,i.bottomLeft-Math.max(s.b,s.l)),bottomRight:Math.max(0,i.bottomRight-Math.max(s.b,s.r))}}}}function kh(r,e,t,n){const s=e===null,i=t===null,o=r&&!(s&&i)&&yk(r,n);return o&&(s||Sr(e,o.left,o.right))&&(i||Sr(t,o.top,o.bottom))}function uI(r){return r.topLeft||r.topRight||r.bottomLeft||r.bottomRight}function dI(r,e){r.rect(e.x,e.y,e.w,e.h)}function Sh(r,e,t={}){const n=r.x!==t.x?-e:0,s=r.y!==t.y?-e:0,i=(r.x+r.w!==t.x+t.w?e:0)-n,a=(r.y+r.h!==t.y+t.h?e:0)-s;return{x:r.x+n,y:r.y+s,w:r.w+i,h:r.h+a,radius:r.radius}}class Kc extends $r{constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:t,options:{borderColor:n,backgroundColor:s}}=this,{inner:i,outer:a}=cI(this),o=uI(a.radius)?Co:dI;e.save(),(a.w!==i.w||a.h!==i.h)&&(e.beginPath(),o(e,Sh(a,t,i)),e.clip(),o(e,Sh(i,-t,a)),e.fillStyle=n,e.fill("evenodd")),e.beginPath(),o(e,Sh(i,t)),e.fillStyle=s,e.fill(),e.restore()}inRange(e,t,n){return kh(this,e,t,n)}inXRange(e,t){return kh(this,e,null,t)}inYRange(e,t){return kh(this,null,e,t)}getCenterPoint(e){const{x:t,y:n,base:s,horizontal:i}=this.getProps(["x","y","base","horizontal"],e);return{x:i?(t+s)/2:t,y:i?n:(n+s)/2}}getRange(e){return e==="x"?this.width/2:this.height/2}}M(Kc,"id","bar"),M(Kc,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),M(Kc,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var hI=Object.freeze({__proto__:null,ArcElement:Wa,BarElement:Kc,LineElement:Yr,PointElement:Jc});const Np=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],ay=Np.map(r=>r.replace("rgb(","rgba(").replace(")",", 0.5)"));function wk(r){return Np[r%Np.length]}function vk(r){return ay[r%ay.length]}function fI(r,e){return r.borderColor=wk(e),r.backgroundColor=vk(e),++e}function pI(r,e){return r.backgroundColor=r.data.map(()=>wk(e++)),e}function mI(r,e){return r.backgroundColor=r.data.map(()=>vk(e++)),e}function gI(r){let e=0;return(t,n)=>{const s=r.getDatasetMeta(n).controller;s instanceof $s?e=pI(t,e):s instanceof lo?e=mI(t,e):s&&(e=fI(t,e))}}function oy(r){let e;for(e in r)if(r[e].borderColor||r[e].backgroundColor)return!0;return!1}function _I(r){return r&&(r.borderColor||r.backgroundColor)}function bI(){return qe.borderColor!=="rgba(0,0,0,0.1)"||qe.backgroundColor!=="rgba(0,0,0,0.1)"}var yI={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(r,e,t){if(!t.enabled)return;const{data:{datasets:n},options:s}=r.config,{elements:i}=s,a=oy(n)||_I(s)||i&&oy(i)||bI();if(!t.forceOverride&&a)return;const o=gI(r);n.forEach(o)}};function wI(r,e,t,n,s){const i=s.samples||n;if(i>=t)return r.slice(e,e+t);const a=[],o=(t-2)/(i-2);let l=0;const c=e+t-1;let u=e,d,h,f,p,m;for(a[l++]=r[u],d=0;d<i-2;d++){let g=0,_=0,y;const b=Math.floor((d+1)*o)+1+e,w=Math.min(Math.floor((d+2)*o)+1,t)+e,v=w-b;for(y=b;y<w;y++)g+=r[y].x,_+=r[y].y;g/=v,_/=v;const S=Math.floor(d*o)+1+e,k=Math.min(Math.floor((d+1)*o)+1,t)+e,{x,y:A}=r[u];for(f=p=-1,y=S;y<k;y++)p=.5*Math.abs((x-g)*(r[y].y-A)-(x-r[y].x)*(_-A)),p>f&&(f=p,h=r[y],m=y);a[l++]=h,u=m}return a[l++]=r[c],a}function vI(r,e,t,n){let s=0,i=0,a,o,l,c,u,d,h,f,p,m;const g=[],_=e+t-1,y=r[e].x,w=r[_].x-y;for(a=e;a<e+t;++a){o=r[a],l=(o.x-y)/w*n,c=o.y;const v=l|0;if(v===u)c<p?(p=c,d=a):c>m&&(m=c,h=a),s=(i*s+o.x)/++i;else{const S=a-1;if(!ye(d)&&!ye(h)){const k=Math.min(d,h),x=Math.max(d,h);k!==f&&k!==S&&g.push({...r[k],x:s}),x!==f&&x!==S&&g.push({...r[x],x:s})}a>0&&S!==f&&g.push(r[S]),g.push(o),u=v,i=0,p=m=c,d=h=f=a}}return g}function xk(r){if(r._decimated){const e=r._data;delete r._decimated,delete r._data,Object.defineProperty(r,"data",{configurable:!0,enumerable:!0,writable:!0,value:e})}}function ly(r){r.data.datasets.forEach(e=>{xk(e)})}function xI(r,e){const t=e.length;let n=0,s;const{iScale:i}=r,{min:a,max:o,minDefined:l,maxDefined:c}=i.getUserBounds();return l&&(n=lt(Pr(e,i.axis,a).lo,0,t-1)),c?s=lt(Pr(e,i.axis,o).hi+1,n,t)-n:s=t-n,{start:n,count:s}}var kI={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(r,e,t)=>{if(!t.enabled){ly(r);return}const n=r.width;r.data.datasets.forEach((s,i)=>{const{_data:a,indexAxis:o}=s,l=r.getDatasetMeta(i),c=a||s.data;if(Ua([o,r.options.indexAxis])==="y"||!l.controller.supportsDecimation)return;const u=r.scales[l.xAxisID];if(u.type!=="linear"&&u.type!=="time"||r.options.parsing)return;let{start:d,count:h}=xI(l,c);const f=t.threshold||4*n;if(h<=f){xk(s);return}ye(a)&&(s._data=c,delete s.data,Object.defineProperty(s,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(m){this._data=m}}));let p;switch(t.algorithm){case"lttb":p=wI(c,d,h,n,t);break;case"min-max":p=vI(c,d,h,n);break;default:throw new Error(`Unsupported decimation algorithm '${t.algorithm}'`)}s._decimated=p})},destroy(r){ly(r)}};function SI(r,e,t){const n=r.segments,s=r.points,i=e.points,a=[];for(const o of n){let{start:l,end:c}=o;c=tg(l,c,s);const u=Lp(t,s[l],s[c],o.loop);if(!e.segments){a.push({source:o,target:u,start:s[l],end:s[c]});continue}const d=rk(e,u);for(const h of d){const f=Lp(t,i[h.start],i[h.end],h.loop),p=nk(o,s,f);for(const m of p)a.push({source:m,target:h,start:{[t]:cy(u,f,"start",Math.max)},end:{[t]:cy(u,f,"end",Math.min)}})}}return a}function Lp(r,e,t,n){if(n)return;let s=e[r],i=t[r];return r==="angle"&&(s=rn(s),i=rn(i)),{property:r,start:s,end:i}}function PI(r,e){const{x:t=null,y:n=null}=r||{},s=e.points,i=[];return e.segments.forEach(({start:a,end:o})=>{o=tg(a,o,s);const l=s[a],c=s[o];n!==null?(i.push({x:l.x,y:n}),i.push({x:c.x,y:n})):t!==null&&(i.push({x:t,y:l.y}),i.push({x:t,y:c.y}))}),i}function tg(r,e,t){for(;e>r;e--){const n=t[e];if(!isNaN(n.x)&&!isNaN(n.y))break}return e}function cy(r,e,t,n){return r&&e?n(r[t],e[t]):r?r[t]:e?e[t]:0}function kk(r,e){let t=[],n=!1;return Ue(r)?(n=!0,t=r):t=PI(r,e),t.length?new Yr({points:t,options:{tension:0},_loop:n,_fullLoop:n}):null}function uy(r){return r&&r.fill!==!1}function EI(r,e,t){let s=r[e].fill;const i=[e];let a;if(!t)return s;for(;s!==!1&&i.indexOf(s)===-1;){if(!Ge(s))return s;if(a=r[s],!a)return!1;if(a.visible)return s;i.push(s),s=a.fill}return!1}function AI(r,e,t){const n=CI(r);if(we(n))return isNaN(n.value)?!1:n;let s=parseFloat(n);return Ge(s)&&Math.floor(s)===s?OI(n[0],e,s,t):["origin","start","end","stack","shape"].indexOf(n)>=0&&n}function OI(r,e,t,n){return(r==="-"||r==="+")&&(t=e+t),t===e||t<0||t>=n?!1:t}function TI(r,e){let t=null;return r==="start"?t=e.bottom:r==="end"?t=e.top:we(r)?t=e.getPixelForValue(r.value):e.getBasePixel&&(t=e.getBasePixel()),t}function RI(r,e,t){let n;return r==="start"?n=t:r==="end"?n=e.options.reverse?e.min:e.max:we(r)?n=r.value:n=e.getBaseValue(),n}function CI(r){const e=r.options,t=e.fill;let n=ae(t&&t.target,t);return n===void 0&&(n=!!e.backgroundColor),n===!1||n===null?!1:n===!0?"origin":n}function II(r){const{scale:e,index:t,line:n}=r,s=[],i=n.segments,a=n.points,o=$I(e,t);o.push(kk({x:null,y:e.bottom},n));for(let l=0;l<i.length;l++){const c=i[l];for(let u=c.start;u<=c.end;u++)MI(s,a[u],o)}return new Yr({points:s,options:{}})}function $I(r,e){const t=[],n=r.getMatchingVisibleMetas("line");for(let s=0;s<n.length;s++){const i=n[s];if(i.index===e)break;i.hidden||t.unshift(i.dataset)}return t}function MI(r,e,t){const n=[];for(let s=0;s<t.length;s++){const i=t[s],{first:a,last:o,point:l}=NI(i,e,"x");if(!(!l||a&&o)){if(a)n.unshift(l);else if(r.push(l),!o)break}}r.push(...n)}function NI(r,e,t){const n=r.interpolate(e,t);if(!n)return{};const s=n[t],i=r.segments,a=r.points;let o=!1,l=!1;for(let c=0;c<i.length;c++){const u=i[c],d=a[u.start][t],h=a[u.end][t];if(Sr(s,d,h)){o=s===d,l=s===h;break}}return{first:o,last:l,point:n}}class Sk{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,t,n){const{x:s,y:i,radius:a}=this;return t=t||{start:0,end:Fe},e.arc(s,i,a,t.end,t.start,!0),!n.bounds}interpolate(e){const{x:t,y:n,radius:s}=this,i=e.angle;return{x:t+Math.cos(i)*s,y:n+Math.sin(i)*s,angle:i}}}function LI(r){const{chart:e,fill:t,line:n}=r;if(Ge(t))return jI(e,t);if(t==="stack")return II(r);if(t==="shape")return!0;const s=DI(r);return s instanceof Sk?s:kk(s,n)}function jI(r,e){const t=r.getDatasetMeta(e);return t&&r.isDatasetVisible(e)?t.dataset:null}function DI(r){return(r.scale||{}).getPointPositionForValue?BI(r):FI(r)}function FI(r){const{scale:e={},fill:t}=r,n=TI(t,e);if(Ge(n)){const s=e.isHorizontal();return{x:s?n:null,y:s?null:n}}return null}function BI(r){const{scale:e,fill:t}=r,n=e.options,s=e.getLabels().length,i=n.reverse?e.max:e.min,a=RI(t,e,i),o=[];if(n.grid.circular){const l=e.getPointPositionForValue(0,i);return new Sk({x:l.x,y:l.y,radius:e.getDistanceFromCenterForValue(a)})}for(let l=0;l<s;++l)o.push(e.getPointPositionForValue(l,a));return o}function Ph(r,e,t){const n=LI(e),{chart:s,index:i,line:a,scale:o,axis:l}=e,c=a.options,u=c.fill,d=c.backgroundColor,{above:h=d,below:f=d}=u||{},p=s.getDatasetMeta(i),m=sk(s,p);n&&a.points.length&&(ud(r,t),zI(r,{line:a,target:n,above:h,below:f,area:t,scale:o,axis:l,clip:m}),dd(r))}function zI(r,e){const{line:t,target:n,above:s,below:i,area:a,scale:o,clip:l}=e,c=t._loop?"angle":e.axis;r.save(),c==="x"&&i!==s&&(dy(r,n,a.top),hy(r,{line:t,target:n,color:s,scale:o,property:c,clip:l}),r.restore(),r.save(),dy(r,n,a.bottom)),hy(r,{line:t,target:n,color:i,scale:o,property:c,clip:l}),r.restore()}function dy(r,e,t){const{segments:n,points:s}=e;let i=!0,a=!1;r.beginPath();for(const o of n){const{start:l,end:c}=o,u=s[l],d=s[tg(l,c,s)];i?(r.moveTo(u.x,u.y),i=!1):(r.lineTo(u.x,t),r.lineTo(u.x,u.y)),a=!!e.pathSegment(r,o,{move:a}),a?r.closePath():r.lineTo(d.x,t)}r.lineTo(e.first().x,t),r.closePath(),r.clip()}function hy(r,e){const{line:t,target:n,property:s,color:i,scale:a,clip:o}=e,l=SI(t,n,s);for(const{source:c,target:u,start:d,end:h}of l){const{style:{backgroundColor:f=i}={}}=c,p=n!==!0;r.save(),r.fillStyle=f,UI(r,a,o,p&&Lp(s,d,h)),r.beginPath();const m=!!t.pathSegment(r,c);let g;if(p){m?r.closePath():fy(r,n,h,s);const _=!!n.pathSegment(r,u,{move:m,reverse:!0});g=m&&_,g||fy(r,n,d,s)}r.closePath(),r.fill(g?"evenodd":"nonzero"),r.restore()}}function UI(r,e,t,n){const s=e.chart.chartArea,{property:i,start:a,end:o}=n||{};if(i==="x"||i==="y"){let l,c,u,d;i==="x"?(l=a,c=s.top,u=o,d=s.bottom):(l=s.left,c=a,u=s.right,d=o),r.beginPath(),t&&(l=Math.max(l,t.left),u=Math.min(u,t.right),c=Math.max(c,t.top),d=Math.min(d,t.bottom)),r.rect(l,c,u-l,d-c),r.clip()}}function fy(r,e,t,n){const s=e.interpolate(t,n);s&&r.lineTo(s.x,s.y)}var qI={id:"filler",afterDatasetsUpdate(r,e,t){const n=(r.data.datasets||[]).length,s=[];let i,a,o,l;for(a=0;a<n;++a)i=r.getDatasetMeta(a),o=i.dataset,l=null,o&&o.options&&o instanceof Yr&&(l={visible:r.isDatasetVisible(a),index:a,fill:AI(o,a,n),chart:r,axis:i.controller.options.indexAxis,scale:i.vScale,line:o}),i.$filler=l,s.push(l);for(a=0;a<n;++a)l=s[a],!(!l||l.fill===!1)&&(l.fill=EI(s,a,t.propagate))},beforeDraw(r,e,t){const n=t.drawTime==="beforeDraw",s=r.getSortedVisibleDatasetMetas(),i=r.chartArea;for(let a=s.length-1;a>=0;--a){const o=s[a].$filler;o&&(o.line.updateControlPoints(i,o.axis),n&&o.fill&&Ph(r.ctx,o,i))}},beforeDatasetsDraw(r,e,t){if(t.drawTime!=="beforeDatasetsDraw")return;const n=r.getSortedVisibleDatasetMetas();for(let s=n.length-1;s>=0;--s){const i=n[s].$filler;uy(i)&&Ph(r.ctx,i,r.chartArea)}},beforeDatasetDraw(r,e,t){const n=e.meta.$filler;!uy(n)||t.drawTime!=="beforeDatasetDraw"||Ph(r.ctx,n,r.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const py=(r,e)=>{let{boxHeight:t=e,boxWidth:n=e}=r;return r.usePointStyle&&(t=Math.min(t,e),n=r.pointStyleWidth||Math.min(n,e)),{boxWidth:n,boxHeight:t,itemHeight:Math.max(e,t)}},WI=(r,e)=>r!==null&&e!==null&&r.datasetIndex===e.datasetIndex&&r.index===e.index;class my extends $r{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,n){this.maxWidth=e,this.maxHeight=t,this._margins=n,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let t=je(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter(n=>e.filter(n,this.chart.data))),e.sort&&(t=t.sort((n,s)=>e.sort(n,s,this.chart.data))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){const{options:e,ctx:t}=this;if(!e.display){this.width=this.height=0;return}const n=e.labels,s=st(n.font),i=s.size,a=this._computeTitleHeight(),{boxWidth:o,itemHeight:l}=py(n,i);let c,u;t.font=s.string,this.isHorizontal()?(c=this.maxWidth,u=this._fitRows(a,i,o,l)+10):(u=this.maxHeight,c=this._fitCols(a,s,o,l)+10),this.width=Math.min(c,e.maxWidth||this.maxWidth),this.height=Math.min(u,e.maxHeight||this.maxHeight)}_fitRows(e,t,n,s){const{ctx:i,maxWidth:a,options:{labels:{padding:o}}}=this,l=this.legendHitBoxes=[],c=this.lineWidths=[0],u=s+o;let d=e;i.textAlign="left",i.textBaseline="middle";let h=-1,f=-u;return this.legendItems.forEach((p,m)=>{const g=n+t/2+i.measureText(p.text).width;(m===0||c[c.length-1]+g+2*o>a)&&(d+=u,c[c.length-(m>0?0:1)]=0,f+=u,h++),l[m]={left:0,top:f,row:h,width:g,height:s},c[c.length-1]+=g+o}),d}_fitCols(e,t,n,s){const{ctx:i,maxHeight:a,options:{labels:{padding:o}}}=this,l=this.legendHitBoxes=[],c=this.columnSizes=[],u=a-e;let d=o,h=0,f=0,p=0,m=0;return this.legendItems.forEach((g,_)=>{const{itemWidth:y,itemHeight:b}=HI(n,t,i,g,s);_>0&&f+b+2*o>u&&(d+=h+o,c.push({width:h,height:f}),p+=h+o,m++,h=f=0),l[_]={left:p,top:f,col:m,width:y,height:b},h=Math.max(h,y),f+=b+o}),d+=h,c.push({width:h,height:f}),d}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:n,labels:{padding:s},rtl:i}}=this,a=Ti(i,this.left,this.width);if(this.isHorizontal()){let o=0,l=_t(n,this.left+s,this.right-this.lineWidths[o]);for(const c of t)o!==c.row&&(o=c.row,l=_t(n,this.left+s,this.right-this.lineWidths[o])),c.top+=this.top+e+s,c.left=a.leftForLtr(a.x(l),c.width),l+=c.width+s}else{let o=0,l=_t(n,this.top+e+s,this.bottom-this.columnSizes[o].height);for(const c of t)c.col!==o&&(o=c.col,l=_t(n,this.top+e+s,this.bottom-this.columnSizes[o].height)),c.top=l,c.left+=this.left+s,c.left=a.leftForLtr(a.x(c.left),c.width),l+=c.height+s}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const e=this.ctx;ud(e,this),this._draw(),dd(e)}}_draw(){const{options:e,columnSizes:t,lineWidths:n,ctx:s}=this,{align:i,labels:a}=e,o=qe.color,l=Ti(e.rtl,this.left,this.width),c=st(a.font),{padding:u}=a,d=c.size,h=d/2;let f;this.drawTitle(),s.textAlign=l.textAlign("left"),s.textBaseline="middle",s.lineWidth=.5,s.font=c.string;const{boxWidth:p,boxHeight:m,itemHeight:g}=py(a,d),_=function(S,k,x){if(isNaN(p)||p<=0||isNaN(m)||m<0)return;s.save();const A=ae(x.lineWidth,1);if(s.fillStyle=ae(x.fillStyle,o),s.lineCap=ae(x.lineCap,"butt"),s.lineDashOffset=ae(x.lineDashOffset,0),s.lineJoin=ae(x.lineJoin,"miter"),s.lineWidth=A,s.strokeStyle=ae(x.strokeStyle,o),s.setLineDash(ae(x.lineDash,[])),a.usePointStyle){const C={radius:m*Math.SQRT2/2,pointStyle:x.pointStyle,rotation:x.rotation,borderWidth:A},I=l.xPlus(S,p/2),D=k+h;Hx(s,C,I,D,a.pointStyleWidth&&p)}else{const C=k+Math.max((d-m)/2,0),I=l.leftForLtr(S,p),D=js(x.borderRadius);s.beginPath(),Object.values(D).some(Y=>Y!==0)?Co(s,{x:I,y:C,w:p,h:m,radius:D}):s.rect(I,C,p,m),s.fill(),A!==0&&s.stroke()}s.restore()},y=function(S,k,x){Vs(s,x.text,S,k+g/2,c,{strikethrough:x.hidden,textAlign:l.textAlign(x.textAlign)})},b=this.isHorizontal(),w=this._computeTitleHeight();b?f={x:_t(i,this.left+u,this.right-n[0]),y:this.top+u+w,line:0}:f={x:this.left+u,y:_t(i,this.top+w+u,this.bottom-t[0].height),line:0},Qx(this.ctx,e.textDirection);const v=g+u;this.legendItems.forEach((S,k)=>{s.strokeStyle=S.fontColor,s.fillStyle=S.fontColor;const x=s.measureText(S.text).width,A=l.textAlign(S.textAlign||(S.textAlign=a.textAlign)),C=p+h+x;let I=f.x,D=f.y;l.setWidth(this.width),b?k>0&&I+C+u>this.right&&(D=f.y+=v,f.line++,I=f.x=_t(i,this.left+u,this.right-n[f.line])):k>0&&D+v>this.bottom&&(I=f.x=I+t[f.line].width+u,f.line++,D=f.y=_t(i,this.top+w+u,this.bottom-t[f.line].height));const Y=l.x(I);if(_(Y,D,S),I=dT(A,I+p+h,b?I+C:this.right,e.rtl),y(l.x(I),D,S),b)f.x+=C+u;else if(typeof S.text!="string"){const O=c.lineHeight;f.y+=Pk(S,O)+u}else f.y+=v}),ek(this.ctx,e.textDirection)}drawTitle(){const e=this.options,t=e.title,n=st(t.font),s=vt(t.padding);if(!t.display)return;const i=Ti(e.rtl,this.left,this.width),a=this.ctx,o=t.position,l=n.size/2,c=s.top+l;let u,d=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),u=this.top+c,d=_t(e.align,d,this.right-h);else{const p=this.columnSizes.reduce((m,g)=>Math.max(m,g.height),0);u=c+_t(e.align,this.top,this.bottom-p-e.labels.padding-this._computeTitleHeight())}const f=_t(o,d,d+h);a.textAlign=i.textAlign(Vm(o)),a.textBaseline="middle",a.strokeStyle=t.color,a.fillStyle=t.color,a.font=n.string,Vs(a,t.text,f,u,n)}_computeTitleHeight(){const e=this.options.title,t=st(e.font),n=vt(e.padding);return e.display?t.lineHeight+n.height:0}_getLegendItemAt(e,t){let n,s,i;if(Sr(e,this.left,this.right)&&Sr(t,this.top,this.bottom)){for(i=this.legendHitBoxes,n=0;n<i.length;++n)if(s=i[n],Sr(e,s.left,s.left+s.width)&&Sr(t,s.top,s.top+s.height))return this.legendItems[n]}return null}handleEvent(e){const t=this.options;if(!GI(e.type,t))return;const n=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){const s=this._hoveredItem,i=WI(s,n);s&&!i&&je(t.onLeave,[e,s,this],this),this._hoveredItem=n,n&&!i&&je(t.onHover,[e,n,this],this)}else n&&je(t.onClick,[e,n,this],this)}}function HI(r,e,t,n,s){const i=VI(n,r,e,t),a=ZI(s,n,e.lineHeight);return{itemWidth:i,itemHeight:a}}function VI(r,e,t,n){let s=r.text;return s&&typeof s!="string"&&(s=s.reduce((i,a)=>i.length>a.length?i:a)),e+t.size/2+n.measureText(s).width}function ZI(r,e,t){let n=r;return typeof e.text!="string"&&(n=Pk(e,t)),n}function Pk(r,e){const t=r.text?r.text.length:0;return e*t}function GI(r,e){return!!((r==="mousemove"||r==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(r==="click"||r==="mouseup"))}var JI={id:"legend",_element:my,start(r,e,t){const n=r.legend=new my({ctx:r.ctx,options:t,chart:r});wt.configure(r,n,t),wt.addBox(r,n)},stop(r){wt.removeBox(r,r.legend),delete r.legend},beforeUpdate(r,e,t){const n=r.legend;wt.configure(r,n,t),n.options=t},afterUpdate(r){const e=r.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(r,e){e.replay||r.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(r,e,t){const n=e.datasetIndex,s=t.chart;s.isDatasetVisible(n)?(s.hide(n),e.hidden=!0):(s.show(n),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:r=>r.chart.options.color,boxWidth:40,padding:10,generateLabels(r){const e=r.data.datasets,{labels:{usePointStyle:t,pointStyle:n,textAlign:s,color:i,useBorderRadius:a,borderRadius:o}}=r.legend.options;return r._getSortedDatasetMetas().map(l=>{const c=l.controller.getStyle(t?0:void 0),u=vt(c.borderWidth);return{text:e[l.index].label,fillStyle:c.backgroundColor,fontColor:i,hidden:!l.visible,lineCap:c.borderCapStyle,lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:(u.width+u.height)/4,strokeStyle:c.borderColor,pointStyle:n||c.pointStyle,rotation:c.rotation,textAlign:s||c.textAlign,borderRadius:a&&(o||c.borderRadius),datasetIndex:l.index}},this)}},title:{color:r=>r.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:r=>!r.startsWith("on"),labels:{_scriptable:r=>!["generateLabels","filter","sort"].includes(r)}}};class ng extends $r{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t){const n=this.options;if(this.left=0,this.top=0,!n.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=e,this.height=this.bottom=t;const s=Ue(n.text)?n.text.length:1;this._padding=vt(n.padding);const i=s*st(n.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=i:this.width=i}isHorizontal(){const e=this.options.position;return e==="top"||e==="bottom"}_drawArgs(e){const{top:t,left:n,bottom:s,right:i,options:a}=this,o=a.align;let l=0,c,u,d;return this.isHorizontal()?(u=_t(o,n,i),d=t+e,c=i-n):(a.position==="left"?(u=n+e,d=_t(o,s,t),l=Be*-.5):(u=i-e,d=_t(o,t,s),l=Be*.5),c=s-t),{titleX:u,titleY:d,maxWidth:c,rotation:l}}draw(){const e=this.ctx,t=this.options;if(!t.display)return;const n=st(t.font),i=n.lineHeight/2+this._padding.top,{titleX:a,titleY:o,maxWidth:l,rotation:c}=this._drawArgs(i);Vs(e,t.text,0,0,n,{color:t.color,maxWidth:l,rotation:c,textAlign:Vm(t.align),textBaseline:"middle",translation:[a,o]})}}function KI(r,e){const t=new ng({ctx:r.ctx,options:e,chart:r});wt.configure(r,t,e),wt.addBox(r,t),r.titleBlock=t}var XI={id:"title",_element:ng,start(r,e,t){KI(r,t)},stop(r){const e=r.titleBlock;wt.removeBox(r,e),delete r.titleBlock},beforeUpdate(r,e,t){const n=r.titleBlock;wt.configure(r,n,t),n.options=t},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Jl=new WeakMap;var YI={id:"subtitle",start(r,e,t){const n=new ng({ctx:r.ctx,options:t,chart:r});wt.configure(r,n,t),wt.addBox(r,n),Jl.set(r,n)},stop(r){wt.removeBox(r,Jl.get(r)),Jl.delete(r)},beforeUpdate(r,e,t){const n=Jl.get(r);wt.configure(r,n,t),n.options=t},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Ha={average(r){if(!r.length)return!1;let e,t,n=new Set,s=0,i=0;for(e=0,t=r.length;e<t;++e){const o=r[e].element;if(o&&o.hasValue()){const l=o.tooltipPosition();n.add(l.x),s+=l.y,++i}}return i===0||n.size===0?!1:{x:[...n].reduce((o,l)=>o+l)/n.size,y:s/i}},nearest(r,e){if(!r.length)return!1;let t=e.x,n=e.y,s=Number.POSITIVE_INFINITY,i,a,o;for(i=0,a=r.length;i<a;++i){const l=r[i].element;if(l&&l.hasValue()){const c=l.getCenterPoint(),u=Op(e,c);u<s&&(s=u,o=l)}}if(o){const l=o.tooltipPosition();t=l.x,n=l.y}return{x:t,y:n}}};function Vn(r,e){return e&&(Ue(e)?Array.prototype.push.apply(r,e):r.push(e)),r}function _r(r){return(typeof r=="string"||r instanceof String)&&r.indexOf(`
`)>-1?r.split(`
`):r}function QI(r,e){const{element:t,datasetIndex:n,index:s}=e,i=r.getDatasetMeta(n).controller,{label:a,value:o}=i.getLabelAndValue(s);return{chart:r,label:a,parsed:i.getParsed(s),raw:r.data.datasets[n].data[s],formattedValue:o,dataset:i.getDataset(),dataIndex:s,datasetIndex:n,element:t}}function gy(r,e){const t=r.chart.ctx,{body:n,footer:s,title:i}=r,{boxWidth:a,boxHeight:o}=e,l=st(e.bodyFont),c=st(e.titleFont),u=st(e.footerFont),d=i.length,h=s.length,f=n.length,p=vt(e.padding);let m=p.height,g=0,_=n.reduce((w,v)=>w+v.before.length+v.lines.length+v.after.length,0);if(_+=r.beforeBody.length+r.afterBody.length,d&&(m+=d*c.lineHeight+(d-1)*e.titleSpacing+e.titleMarginBottom),_){const w=e.displayColors?Math.max(o,l.lineHeight):l.lineHeight;m+=f*w+(_-f)*l.lineHeight+(_-1)*e.bodySpacing}h&&(m+=e.footerMarginTop+h*u.lineHeight+(h-1)*e.footerSpacing);let y=0;const b=function(w){g=Math.max(g,t.measureText(w).width+y)};return t.save(),t.font=c.string,Re(r.title,b),t.font=l.string,Re(r.beforeBody.concat(r.afterBody),b),y=e.displayColors?a+2+e.boxPadding:0,Re(n,w=>{Re(w.before,b),Re(w.lines,b),Re(w.after,b)}),y=0,t.font=u.string,Re(r.footer,b),t.restore(),g+=p.width,{width:g,height:m}}function e$(r,e){const{y:t,height:n}=e;return t<n/2?"top":t>r.height-n/2?"bottom":"center"}function t$(r,e,t,n){const{x:s,width:i}=n,a=t.caretSize+t.caretPadding;if(r==="left"&&s+i+a>e.width||r==="right"&&s-i-a<0)return!0}function n$(r,e,t,n){const{x:s,width:i}=t,{width:a,chartArea:{left:o,right:l}}=r;let c="center";return n==="center"?c=s<=(o+l)/2?"left":"right":s<=i/2?c="left":s>=a-i/2&&(c="right"),t$(c,r,e,t)&&(c="center"),c}function _y(r,e,t){const n=t.yAlign||e.yAlign||e$(r,t);return{xAlign:t.xAlign||e.xAlign||n$(r,e,t,n),yAlign:n}}function r$(r,e){let{x:t,width:n}=r;return e==="right"?t-=n:e==="center"&&(t-=n/2),t}function s$(r,e,t){let{y:n,height:s}=r;return e==="top"?n+=t:e==="bottom"?n-=s+t:n-=s/2,n}function by(r,e,t,n){const{caretSize:s,caretPadding:i,cornerRadius:a}=r,{xAlign:o,yAlign:l}=t,c=s+i,{topLeft:u,topRight:d,bottomLeft:h,bottomRight:f}=js(a);let p=r$(e,o);const m=s$(e,l,c);return l==="center"?o==="left"?p+=c:o==="right"&&(p-=c):o==="left"?p-=Math.max(u,h)+s:o==="right"&&(p+=Math.max(d,f)+s),{x:lt(p,0,n.width-e.width),y:lt(m,0,n.height-e.height)}}function Kl(r,e,t){const n=vt(t.padding);return e==="center"?r.x+r.width/2:e==="right"?r.x+r.width-n.right:r.x+n.left}function yy(r){return Vn([],_r(r))}function i$(r,e,t){return gs(r,{tooltip:e,tooltipItems:t,type:"tooltip"})}function wy(r,e){const t=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return t?r.override(t):r}const Ek={beforeTitle:dr,title(r){if(r.length>0){const e=r[0],t=e.chart.data.labels,n=t?t.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(n>0&&e.dataIndex<n)return t[e.dataIndex]}return""},afterTitle:dr,beforeBody:dr,beforeLabel:dr,label(r){if(this&&this.options&&this.options.mode==="dataset")return r.label+": "+r.formattedValue||r.formattedValue;let e=r.dataset.label||"";e&&(e+=": ");const t=r.formattedValue;return ye(t)||(e+=t),e},labelColor(r){const t=r.chart.getDatasetMeta(r.datasetIndex).controller.getStyle(r.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(r){const t=r.chart.getDatasetMeta(r.datasetIndex).controller.getStyle(r.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:dr,afterBody:dr,beforeFooter:dr,footer:dr,afterFooter:dr};function jt(r,e,t,n){const s=r[e].call(t,n);return typeof s>"u"?Ek[e].call(t,n):s}class jp extends $r{constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const t=this.chart,n=this.options.setContext(this.getContext()),s=n.enabled&&t.options.animation&&n.animations,i=new ik(this.chart,s);return s._cacheable&&(this._cachedAnimations=Object.freeze(i)),i}getContext(){return this.$context||(this.$context=i$(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,t){const{callbacks:n}=t,s=jt(n,"beforeTitle",this,e),i=jt(n,"title",this,e),a=jt(n,"afterTitle",this,e);let o=[];return o=Vn(o,_r(s)),o=Vn(o,_r(i)),o=Vn(o,_r(a)),o}getBeforeBody(e,t){return yy(jt(t.callbacks,"beforeBody",this,e))}getBody(e,t){const{callbacks:n}=t,s=[];return Re(e,i=>{const a={before:[],lines:[],after:[]},o=wy(n,i);Vn(a.before,_r(jt(o,"beforeLabel",this,i))),Vn(a.lines,jt(o,"label",this,i)),Vn(a.after,_r(jt(o,"afterLabel",this,i))),s.push(a)}),s}getAfterBody(e,t){return yy(jt(t.callbacks,"afterBody",this,e))}getFooter(e,t){const{callbacks:n}=t,s=jt(n,"beforeFooter",this,e),i=jt(n,"footer",this,e),a=jt(n,"afterFooter",this,e);let o=[];return o=Vn(o,_r(s)),o=Vn(o,_r(i)),o=Vn(o,_r(a)),o}_createItems(e){const t=this._active,n=this.chart.data,s=[],i=[],a=[];let o=[],l,c;for(l=0,c=t.length;l<c;++l)o.push(QI(this.chart,t[l]));return e.filter&&(o=o.filter((u,d,h)=>e.filter(u,d,h,n))),e.itemSort&&(o=o.sort((u,d)=>e.itemSort(u,d,n))),Re(o,u=>{const d=wy(e.callbacks,u);s.push(jt(d,"labelColor",this,u)),i.push(jt(d,"labelPointStyle",this,u)),a.push(jt(d,"labelTextColor",this,u))}),this.labelColors=s,this.labelPointStyles=i,this.labelTextColors=a,this.dataPoints=o,o}update(e,t){const n=this.options.setContext(this.getContext()),s=this._active;let i,a=[];if(!s.length)this.opacity!==0&&(i={opacity:0});else{const o=Ha[n.position].call(this,s,this._eventPosition);a=this._createItems(n),this.title=this.getTitle(a,n),this.beforeBody=this.getBeforeBody(a,n),this.body=this.getBody(a,n),this.afterBody=this.getAfterBody(a,n),this.footer=this.getFooter(a,n);const l=this._size=gy(this,n),c=Object.assign({},o,l),u=_y(this.chart,n,c),d=by(n,c,u,this.chart);this.xAlign=u.xAlign,this.yAlign=u.yAlign,i={opacity:1,x:d.x,y:d.y,width:l.width,height:l.height,caretX:o.x,caretY:o.y}}this._tooltipItems=a,this.$context=void 0,i&&this._resolveAnimations().update(this,i),e&&n.external&&n.external.call(this,{chart:this.chart,tooltip:this,replay:t})}drawCaret(e,t,n,s){const i=this.getCaretPosition(e,n,s);t.lineTo(i.x1,i.y1),t.lineTo(i.x2,i.y2),t.lineTo(i.x3,i.y3)}getCaretPosition(e,t,n){const{xAlign:s,yAlign:i}=this,{caretSize:a,cornerRadius:o}=n,{topLeft:l,topRight:c,bottomLeft:u,bottomRight:d}=js(o),{x:h,y:f}=e,{width:p,height:m}=t;let g,_,y,b,w,v;return i==="center"?(w=f+m/2,s==="left"?(g=h,_=g-a,b=w+a,v=w-a):(g=h+p,_=g+a,b=w-a,v=w+a),y=g):(s==="left"?_=h+Math.max(l,u)+a:s==="right"?_=h+p-Math.max(c,d)-a:_=this.caretX,i==="top"?(b=f,w=b-a,g=_-a,y=_+a):(b=f+m,w=b+a,g=_+a,y=_-a),v=b),{x1:g,x2:_,x3:y,y1:b,y2:w,y3:v}}drawTitle(e,t,n){const s=this.title,i=s.length;let a,o,l;if(i){const c=Ti(n.rtl,this.x,this.width);for(e.x=Kl(this,n.titleAlign,n),t.textAlign=c.textAlign(n.titleAlign),t.textBaseline="middle",a=st(n.titleFont),o=n.titleSpacing,t.fillStyle=n.titleColor,t.font=a.string,l=0;l<i;++l)t.fillText(s[l],c.x(e.x),e.y+a.lineHeight/2),e.y+=a.lineHeight+o,l+1===i&&(e.y+=n.titleMarginBottom-o)}}_drawColorBox(e,t,n,s,i){const a=this.labelColors[n],o=this.labelPointStyles[n],{boxHeight:l,boxWidth:c}=i,u=st(i.bodyFont),d=Kl(this,"left",i),h=s.x(d),f=l<u.lineHeight?(u.lineHeight-l)/2:0,p=t.y+f;if(i.usePointStyle){const m={radius:Math.min(c,l)/2,pointStyle:o.pointStyle,rotation:o.rotation,borderWidth:1},g=s.leftForLtr(h,c)+c/2,_=p+l/2;e.strokeStyle=i.multiKeyBackground,e.fillStyle=i.multiKeyBackground,Rp(e,m,g,_),e.strokeStyle=a.borderColor,e.fillStyle=a.backgroundColor,Rp(e,m,g,_)}else{e.lineWidth=we(a.borderWidth)?Math.max(...Object.values(a.borderWidth)):a.borderWidth||1,e.strokeStyle=a.borderColor,e.setLineDash(a.borderDash||[]),e.lineDashOffset=a.borderDashOffset||0;const m=s.leftForLtr(h,c),g=s.leftForLtr(s.xPlus(h,1),c-2),_=js(a.borderRadius);Object.values(_).some(y=>y!==0)?(e.beginPath(),e.fillStyle=i.multiKeyBackground,Co(e,{x:m,y:p,w:c,h:l,radius:_}),e.fill(),e.stroke(),e.fillStyle=a.backgroundColor,e.beginPath(),Co(e,{x:g,y:p+1,w:c-2,h:l-2,radius:_}),e.fill()):(e.fillStyle=i.multiKeyBackground,e.fillRect(m,p,c,l),e.strokeRect(m,p,c,l),e.fillStyle=a.backgroundColor,e.fillRect(g,p+1,c-2,l-2))}e.fillStyle=this.labelTextColors[n]}drawBody(e,t,n){const{body:s}=this,{bodySpacing:i,bodyAlign:a,displayColors:o,boxHeight:l,boxWidth:c,boxPadding:u}=n,d=st(n.bodyFont);let h=d.lineHeight,f=0;const p=Ti(n.rtl,this.x,this.width),m=function(x){t.fillText(x,p.x(e.x+f),e.y+h/2),e.y+=h+i},g=p.textAlign(a);let _,y,b,w,v,S,k;for(t.textAlign=a,t.textBaseline="middle",t.font=d.string,e.x=Kl(this,g,n),t.fillStyle=n.bodyColor,Re(this.beforeBody,m),f=o&&g!=="right"?a==="center"?c/2+u:c+2+u:0,w=0,S=s.length;w<S;++w){for(_=s[w],y=this.labelTextColors[w],t.fillStyle=y,Re(_.before,m),b=_.lines,o&&b.length&&(this._drawColorBox(t,e,w,p,n),h=Math.max(d.lineHeight,l)),v=0,k=b.length;v<k;++v)m(b[v]),h=d.lineHeight;Re(_.after,m)}f=0,h=d.lineHeight,Re(this.afterBody,m),e.y-=i}drawFooter(e,t,n){const s=this.footer,i=s.length;let a,o;if(i){const l=Ti(n.rtl,this.x,this.width);for(e.x=Kl(this,n.footerAlign,n),e.y+=n.footerMarginTop,t.textAlign=l.textAlign(n.footerAlign),t.textBaseline="middle",a=st(n.footerFont),t.fillStyle=n.footerColor,t.font=a.string,o=0;o<i;++o)t.fillText(s[o],l.x(e.x),e.y+a.lineHeight/2),e.y+=a.lineHeight+n.footerSpacing}}drawBackground(e,t,n,s){const{xAlign:i,yAlign:a}=this,{x:o,y:l}=e,{width:c,height:u}=n,{topLeft:d,topRight:h,bottomLeft:f,bottomRight:p}=js(s.cornerRadius);t.fillStyle=s.backgroundColor,t.strokeStyle=s.borderColor,t.lineWidth=s.borderWidth,t.beginPath(),t.moveTo(o+d,l),a==="top"&&this.drawCaret(e,t,n,s),t.lineTo(o+c-h,l),t.quadraticCurveTo(o+c,l,o+c,l+h),a==="center"&&i==="right"&&this.drawCaret(e,t,n,s),t.lineTo(o+c,l+u-p),t.quadraticCurveTo(o+c,l+u,o+c-p,l+u),a==="bottom"&&this.drawCaret(e,t,n,s),t.lineTo(o+f,l+u),t.quadraticCurveTo(o,l+u,o,l+u-f),a==="center"&&i==="left"&&this.drawCaret(e,t,n,s),t.lineTo(o,l+d),t.quadraticCurveTo(o,l,o+d,l),t.closePath(),t.fill(),s.borderWidth>0&&t.stroke()}_updateAnimationTarget(e){const t=this.chart,n=this.$animations,s=n&&n.x,i=n&&n.y;if(s||i){const a=Ha[e.position].call(this,this._active,this._eventPosition);if(!a)return;const o=this._size=gy(this,e),l=Object.assign({},a,this._size),c=_y(t,e,l),u=by(e,l,c,t);(s._to!==u.x||i._to!==u.y)&&(this.xAlign=c.xAlign,this.yAlign=c.yAlign,this.width=o.width,this.height=o.height,this.caretX=a.x,this.caretY=a.y,this._resolveAnimations().update(this,u))}}_willRender(){return!!this.opacity}draw(e){const t=this.options.setContext(this.getContext());let n=this.opacity;if(!n)return;this._updateAnimationTarget(t);const s={width:this.width,height:this.height},i={x:this.x,y:this.y};n=Math.abs(n)<.001?0:n;const a=vt(t.padding),o=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;t.enabled&&o&&(e.save(),e.globalAlpha=n,this.drawBackground(i,e,s,t),Qx(e,t.textDirection),i.y+=a.top,this.drawTitle(i,e,t),this.drawBody(i,e,t),this.drawFooter(i,e,t),ek(e,t.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,t){const n=this._active,s=e.map(({datasetIndex:o,index:l})=>{const c=this.chart.getDatasetMeta(o);if(!c)throw new Error("Cannot find a dataset at index "+o);return{datasetIndex:o,element:c.data[l],index:l}}),i=!du(n,s),a=this._positionChanged(s,t);(i||a)&&(this._active=s,this._eventPosition=t,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,t,n=!0){if(t&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const s=this.options,i=this._active||[],a=this._getActiveElements(e,i,t,n),o=this._positionChanged(a,e),l=t||!du(a,i)||o;return l&&(this._active=a,(s.enabled||s.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,t))),l}_getActiveElements(e,t,n,s){const i=this.options;if(e.type==="mouseout")return[];if(!s)return t.filter(o=>this.chart.data.datasets[o.datasetIndex]&&this.chart.getDatasetMeta(o.datasetIndex).controller.getParsed(o.index)!==void 0);const a=this.chart.getElementsAtEventForMode(e,i.mode,i,n);return i.reverse&&a.reverse(),a}_positionChanged(e,t){const{caretX:n,caretY:s,options:i}=this,a=Ha[i.position].call(this,e,t);return a!==!1&&(n!==a.x||s!==a.y)}}M(jp,"positioners",Ha);var a$={id:"tooltip",_element:jp,positioners:Ha,afterInit(r,e,t){t&&(r.tooltip=new jp({chart:r,options:t}))},beforeUpdate(r,e,t){r.tooltip&&r.tooltip.initialize(t)},reset(r,e,t){r.tooltip&&r.tooltip.initialize(t)},afterDraw(r){const e=r.tooltip;if(e&&e._willRender()){const t={tooltip:e};if(r.notifyPlugins("beforeTooltipDraw",{...t,cancelable:!0})===!1)return;e.draw(r.ctx),r.notifyPlugins("afterTooltipDraw",t)}},afterEvent(r,e){if(r.tooltip){const t=e.replay;r.tooltip.handleEvent(e.event,t,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(r,e)=>e.bodyFont.size,boxWidth:(r,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Ek},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:r=>r!=="filter"&&r!=="itemSort"&&r!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},o$=Object.freeze({__proto__:null,Colors:yI,Decimation:kI,Filler:qI,Legend:JI,SubTitle:YI,Title:XI,Tooltip:a$});const l$=(r,e,t,n)=>(typeof e=="string"?(t=r.push(e)-1,n.unshift({index:t,label:e})):isNaN(e)&&(t=null),t);function c$(r,e,t,n){const s=r.indexOf(e);if(s===-1)return l$(r,e,t,n);const i=r.lastIndexOf(e);return s!==i?t:s}const u$=(r,e)=>r===null?null:lt(Math.round(r),0,e);function vy(r){const e=this.getLabels();return r>=0&&r<e.length?e[r]:r}class Dp extends ei{constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const t=this._addedLabels;if(t.length){const n=this.getLabels();for(const{index:s,label:i}of t)n[s]===i&&n.splice(s,1);this._addedLabels=[]}super.init(e)}parse(e,t){if(ye(e))return null;const n=this.getLabels();return t=isFinite(t)&&n[t]===e?t:c$(n,e,ae(t,e),this._addedLabels),u$(t,n.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let{min:n,max:s}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(n=0),t||(s=this.getLabels().length-1)),this.min=n,this.max=s}buildTicks(){const e=this.min,t=this.max,n=this.options.offset,s=[];let i=this.getLabels();i=e===0&&t===i.length-1?i:i.slice(e,t+1),this._valueRange=Math.max(i.length-(n?0:1),1),this._startValue=this.min-(n?.5:0);for(let a=e;a<=t;a++)s.push({value:a});return s}getLabelForValue(e){return vy.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}M(Dp,"id","category"),M(Dp,"defaults",{ticks:{callback:vy}});function d$(r,e){const t=[],{bounds:s,step:i,min:a,max:o,precision:l,count:c,maxTicks:u,maxDigits:d,includeBounds:h}=r,f=i||1,p=u-1,{min:m,max:g}=e,_=!ye(a),y=!ye(o),b=!ye(c),w=(g-m)/(d+1);let v=gb((g-m)/p/f)*f,S,k,x,A;if(v<1e-14&&!_&&!y)return[{value:m},{value:g}];A=Math.ceil(g/v)-Math.floor(m/v),A>p&&(v=gb(A*v/p/f)*f),ye(l)||(S=Math.pow(10,l),v=Math.ceil(v*S)/S),s==="ticks"?(k=Math.floor(m/v)*v,x=Math.ceil(g/v)*v):(k=m,x=g),_&&y&&i&&sT((o-a)/i,v/1e3)?(A=Math.round(Math.min((o-a)/v,u)),v=(o-a)/A,k=a,x=o):b?(k=_?a:k,x=y?o:x,A=c-1,v=(x-k)/A):(A=(x-k)/v,io(A,Math.round(A),v/1e3)?A=Math.round(A):A=Math.ceil(A));const C=Math.max(_b(v),_b(k));S=Math.pow(10,ye(l)?C:l),k=Math.round(k*S)/S,x=Math.round(x*S)/S;let I=0;for(_&&(h&&k!==a?(t.push({value:a}),k<a&&I++,io(Math.round((k+I*v)*S)/S,a,xy(a,w,r))&&I++):k<a&&I++);I<A;++I){const D=Math.round((k+I*v)*S)/S;if(y&&D>o)break;t.push({value:D})}return y&&h&&x!==o?t.length&&io(t[t.length-1].value,o,xy(o,w,r))?t[t.length-1].value=o:t.push({value:o}):(!y||x===o)&&t.push({value:x}),t}function xy(r,e,{horizontal:t,minRotation:n}){const s=Rn(n),i=(t?Math.sin(s):Math.cos(s))||.001,a=.75*e*(""+r).length;return Math.min(e/i,a)}class bu extends ei{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,t){return ye(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:t,maxDefined:n}=this.getUserBounds();let{min:s,max:i}=this;const a=l=>s=t?s:l,o=l=>i=n?i:l;if(e){const l=nr(s),c=nr(i);l<0&&c<0?o(0):l>0&&c>0&&a(0)}if(s===i){let l=i===0?1:Math.abs(i*.05);o(i+l),e||a(s-l)}this.min=s,this.max=i}getTickLimit(){const e=this.options.ticks;let{maxTicksLimit:t,stepSize:n}=e,s;return n?(s=Math.ceil(this.max/n)-Math.floor(this.min/n)+1,s>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${n} would result generating up to ${s} ticks. Limiting to 1000.`),s=1e3)):(s=this.computeTickLimit(),t=t||11),t&&(s=Math.min(t,s)),s}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,t=e.ticks;let n=this.getTickLimit();n=Math.max(2,n);const s={maxTicks:n,bounds:e.bounds,min:e.min,max:e.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:t.includeBounds!==!1},i=this._range||this,a=d$(s,i);return e.bounds==="ticks"&&Lx(a,this,"value"),e.reverse?(a.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),a}configure(){const e=this.ticks;let t=this.min,n=this.max;if(super.configure(),this.options.offset&&e.length){const s=(n-t)/Math.max(e.length-1,1)/2;t-=s,n+=s}this._startValue=t,this._endValue=n,this._valueRange=n-t}getLabelForValue(e){return fl(e,this.chart.options.locale,this.options.ticks.format)}}class Fp extends bu{determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=Ge(e)?e:0,this.max=Ge(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),t=e?this.width:this.height,n=Rn(this.options.ticks.minRotation),s=(e?Math.sin(n):Math.cos(n))||.001,i=this._resolveTickFontOptions(0);return Math.ceil(t/Math.min(40,i.lineHeight/s))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}M(Fp,"id","linear"),M(Fp,"defaults",{ticks:{callback:cd.formatters.numeric}});const $o=r=>Math.floor(Xr(r)),Ps=(r,e)=>Math.pow(10,$o(r)+e);function ky(r){return r/Math.pow(10,$o(r))===1}function Sy(r,e,t){const n=Math.pow(10,t),s=Math.floor(r/n);return Math.ceil(e/n)-s}function h$(r,e){const t=e-r;let n=$o(t);for(;Sy(r,e,n)>10;)n++;for(;Sy(r,e,n)<10;)n--;return Math.min(n,$o(r))}function f$(r,{min:e,max:t}){e=tn(r.min,e);const n=[],s=$o(e);let i=h$(e,t),a=i<0?Math.pow(10,Math.abs(i)):1;const o=Math.pow(10,i),l=s>i?Math.pow(10,s):0,c=Math.round((e-l)*a)/a,u=Math.floor((e-l)/o/10)*o*10;let d=Math.floor((c-u)/Math.pow(10,i)),h=tn(r.min,Math.round((l+u+d*Math.pow(10,i))*a)/a);for(;h<t;)n.push({value:h,major:ky(h),significand:d}),d>=10?d=d<15?15:20:d++,d>=20&&(i++,d=2,a=i>=0?1:a),h=Math.round((l+u+d*Math.pow(10,i))*a)/a;const f=tn(r.max,h);return n.push({value:f,major:ky(f),significand:d}),n}class Bp extends ei{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,t){const n=bu.prototype.parse.apply(this,[e,t]);if(n===0){this._zero=!0;return}return Ge(n)&&n>0?n:null}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=Ge(e)?Math.max(0,e):null,this.max=Ge(t)?Math.max(0,t):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Ge(this._userMin)&&(this.min=e===Ps(this.min,0)?Ps(this.min,-1):Ps(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let n=this.min,s=this.max;const i=o=>n=e?n:o,a=o=>s=t?s:o;n===s&&(n<=0?(i(1),a(10)):(i(Ps(n,-1)),a(Ps(s,1)))),n<=0&&i(Ps(s,-1)),s<=0&&a(Ps(n,1)),this.min=n,this.max=s}buildTicks(){const e=this.options,t={min:this._userMin,max:this._userMax},n=f$(t,this);return e.bounds==="ticks"&&Lx(n,this,"value"),e.reverse?(n.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),n}getLabelForValue(e){return e===void 0?"0":fl(e,this.chart.options.locale,this.options.ticks.format)}configure(){const e=this.min;super.configure(),this._startValue=Xr(e),this._valueRange=Xr(this.max)-Xr(e)}getPixelForValue(e){return(e===void 0||e===0)&&(e=this.min),e===null||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(Xr(e)-this._startValue)/this._valueRange)}getValueForPixel(e){const t=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+t*this._valueRange)}}M(Bp,"id","logarithmic"),M(Bp,"defaults",{ticks:{callback:cd.formatters.logarithmic,major:{enabled:!0}}});function zp(r){const e=r.ticks;if(e.display&&r.display){const t=vt(e.backdropPadding);return ae(e.font&&e.font.size,qe.font.size)+t.height}return 0}function p$(r,e,t){return t=Ue(t)?t:[t],{w:vT(r,e.string,t),h:t.length*e.lineHeight}}function Py(r,e,t,n,s){return r===n||r===s?{start:e-t/2,end:e+t/2}:r<n||r>s?{start:e-t,end:e}:{start:e,end:e+t}}function m$(r){const e={l:r.left+r._padding.left,r:r.right-r._padding.right,t:r.top+r._padding.top,b:r.bottom-r._padding.bottom},t=Object.assign({},e),n=[],s=[],i=r._pointLabels.length,a=r.options.pointLabels,o=a.centerPointLabels?Be/i:0;for(let l=0;l<i;l++){const c=a.setContext(r.getPointLabelContext(l));s[l]=c.padding;const u=r.getPointPosition(l,r.drawingArea+s[l],o),d=st(c.font),h=p$(r.ctx,d,r._pointLabels[l]);n[l]=h;const f=rn(r.getIndexAngle(l)+o),p=Math.round(Wm(f)),m=Py(p,u.x,h.w,0,180),g=Py(p,u.y,h.h,90,270);g$(t,e,f,m,g)}r.setCenterPoint(e.l-t.l,t.r-e.r,e.t-t.t,t.b-e.b),r._pointLabelItems=y$(r,n,s)}function g$(r,e,t,n,s){const i=Math.abs(Math.sin(t)),a=Math.abs(Math.cos(t));let o=0,l=0;n.start<e.l?(o=(e.l-n.start)/i,r.l=Math.min(r.l,e.l-o)):n.end>e.r&&(o=(n.end-e.r)/i,r.r=Math.max(r.r,e.r+o)),s.start<e.t?(l=(e.t-s.start)/a,r.t=Math.min(r.t,e.t-l)):s.end>e.b&&(l=(s.end-e.b)/a,r.b=Math.max(r.b,e.b+l))}function _$(r,e,t){const n=r.drawingArea,{extra:s,additionalAngle:i,padding:a,size:o}=t,l=r.getPointPosition(e,n+s+a,i),c=Math.round(Wm(rn(l.angle+Ke))),u=x$(l.y,o.h,c),d=w$(c),h=v$(l.x,o.w,d);return{visible:!0,x:l.x,y:u,textAlign:d,left:h,top:u,right:h+o.w,bottom:u+o.h}}function b$(r,e){if(!e)return!0;const{left:t,top:n,right:s,bottom:i}=r;return!(Er({x:t,y:n},e)||Er({x:t,y:i},e)||Er({x:s,y:n},e)||Er({x:s,y:i},e))}function y$(r,e,t){const n=[],s=r._pointLabels.length,i=r.options,{centerPointLabels:a,display:o}=i.pointLabels,l={extra:zp(i)/2,additionalAngle:a?Be/s:0};let c;for(let u=0;u<s;u++){l.padding=t[u],l.size=e[u];const d=_$(r,u,l);n.push(d),o==="auto"&&(d.visible=b$(d,c),d.visible&&(c=d))}return n}function w$(r){return r===0||r===180?"center":r<180?"left":"right"}function v$(r,e,t){return t==="right"?r-=e:t==="center"&&(r-=e/2),r}function x$(r,e,t){return t===90||t===270?r-=e/2:(t>270||t<90)&&(r-=e),r}function k$(r,e,t){const{left:n,top:s,right:i,bottom:a}=t,{backdropColor:o}=e;if(!ye(o)){const l=js(e.borderRadius),c=vt(e.backdropPadding);r.fillStyle=o;const u=n-c.left,d=s-c.top,h=i-n+c.width,f=a-s+c.height;Object.values(l).some(p=>p!==0)?(r.beginPath(),Co(r,{x:u,y:d,w:h,h:f,radius:l}),r.fill()):r.fillRect(u,d,h,f)}}function S$(r,e){const{ctx:t,options:{pointLabels:n}}=r;for(let s=e-1;s>=0;s--){const i=r._pointLabelItems[s];if(!i.visible)continue;const a=n.setContext(r.getPointLabelContext(s));k$(t,a,i);const o=st(a.font),{x:l,y:c,textAlign:u}=i;Vs(t,r._pointLabels[s],l,c+o.lineHeight/2,o,{color:a.color,textAlign:u,textBaseline:"middle"})}}function Ak(r,e,t,n){const{ctx:s}=r;if(t)s.arc(r.xCenter,r.yCenter,e,0,Fe);else{let i=r.getPointPosition(0,e);s.moveTo(i.x,i.y);for(let a=1;a<n;a++)i=r.getPointPosition(a,e),s.lineTo(i.x,i.y)}}function P$(r,e,t,n,s){const i=r.ctx,a=e.circular,{color:o,lineWidth:l}=e;!a&&!n||!o||!l||t<0||(i.save(),i.strokeStyle=o,i.lineWidth=l,i.setLineDash(s.dash||[]),i.lineDashOffset=s.dashOffset,i.beginPath(),Ak(r,t,a,n),i.closePath(),i.stroke(),i.restore())}function E$(r,e,t){return gs(r,{label:t,index:e,type:"pointLabel"})}class Va extends bu{constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const e=this._padding=vt(zp(this.options)/2),t=this.width=this.maxWidth-e.width,n=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+t/2+e.left),this.yCenter=Math.floor(this.top+n/2+e.top),this.drawingArea=Math.floor(Math.min(t,n)/2)}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!1);this.min=Ge(e)&&!isNaN(e)?e:0,this.max=Ge(t)&&!isNaN(t)?t:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/zp(this.options))}generateTickLabels(e){bu.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map((t,n)=>{const s=je(this.options.pointLabels.callback,[t,n],this);return s||s===0?s:""}).filter((t,n)=>this.chart.getDataVisibility(n))}fit(){const e=this.options;e.display&&e.pointLabels.display?m$(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,t,n,s){this.xCenter+=Math.floor((e-t)/2),this.yCenter+=Math.floor((n-s)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,t,n,s))}getIndexAngle(e){const t=Fe/(this._pointLabels.length||1),n=this.options.startAngle||0;return rn(e*t+Rn(n))}getDistanceFromCenterForValue(e){if(ye(e))return NaN;const t=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*t:(e-this.min)*t}getValueForDistanceFromCenter(e){if(ye(e))return NaN;const t=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-t:this.min+t}getPointLabelContext(e){const t=this._pointLabels||[];if(e>=0&&e<t.length){const n=t[e];return E$(this.getContext(),e,n)}}getPointPosition(e,t,n=0){const s=this.getIndexAngle(e)-Ke+n;return{x:Math.cos(s)*t+this.xCenter,y:Math.sin(s)*t+this.yCenter,angle:s}}getPointPositionForValue(e,t){return this.getPointPosition(e,this.getDistanceFromCenterForValue(t))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){const{left:t,top:n,right:s,bottom:i}=this._pointLabelItems[e];return{left:t,top:n,right:s,bottom:i}}drawBackground(){const{backgroundColor:e,grid:{circular:t}}=this.options;if(e){const n=this.ctx;n.save(),n.beginPath(),Ak(this,this.getDistanceFromCenterForValue(this._endValue),t,this._pointLabels.length),n.closePath(),n.fillStyle=e,n.fill(),n.restore()}}drawGrid(){const e=this.ctx,t=this.options,{angleLines:n,grid:s,border:i}=t,a=this._pointLabels.length;let o,l,c;if(t.pointLabels.display&&S$(this,a),s.display&&this.ticks.forEach((u,d)=>{if(d!==0||d===0&&this.min<0){l=this.getDistanceFromCenterForValue(u.value);const h=this.getContext(d),f=s.setContext(h),p=i.setContext(h);P$(this,f,l,a,p)}}),n.display){for(e.save(),o=a-1;o>=0;o--){const u=n.setContext(this.getPointLabelContext(o)),{color:d,lineWidth:h}=u;!h||!d||(e.lineWidth=h,e.strokeStyle=d,e.setLineDash(u.borderDash),e.lineDashOffset=u.borderDashOffset,l=this.getDistanceFromCenterForValue(t.reverse?this.min:this.max),c=this.getPointPosition(o,l),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(c.x,c.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){const e=this.ctx,t=this.options,n=t.ticks;if(!n.display)return;const s=this.getIndexAngle(0);let i,a;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(s),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach((o,l)=>{if(l===0&&this.min>=0&&!t.reverse)return;const c=n.setContext(this.getContext(l)),u=st(c.font);if(i=this.getDistanceFromCenterForValue(this.ticks[l].value),c.showLabelBackdrop){e.font=u.string,a=e.measureText(o.label).width,e.fillStyle=c.backdropColor;const d=vt(c.backdropPadding);e.fillRect(-a/2-d.left,-i-u.size/2-d.top,a+d.width,u.size+d.height)}Vs(e,o.label,0,-i,u,{color:c.color,strokeColor:c.textStrokeColor,strokeWidth:c.textStrokeWidth})}),e.restore()}drawTitle(){}}M(Va,"id","radialLinear"),M(Va,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:cd.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(e){return e},padding:5,centerPointLabels:!1}}),M(Va,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),M(Va,"descriptors",{angleLines:{_fallback:"grid"}});const pd={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Ut=Object.keys(pd);function Ey(r,e){return r-e}function Ay(r,e){if(ye(e))return null;const t=r._adapter,{parser:n,round:s,isoWeekday:i}=r._parseOpts;let a=e;return typeof n=="function"&&(a=n(a)),Ge(a)||(a=typeof n=="string"?t.parse(a,n):t.parse(a)),a===null?null:(s&&(a=s==="week"&&(Di(i)||i===!0)?t.startOf(a,"isoWeek",i):t.startOf(a,s)),+a)}function Oy(r,e,t,n){const s=Ut.length;for(let i=Ut.indexOf(r);i<s-1;++i){const a=pd[Ut[i]],o=a.steps?a.steps:Number.MAX_SAFE_INTEGER;if(a.common&&Math.ceil((t-e)/(o*a.size))<=n)return Ut[i]}return Ut[s-1]}function A$(r,e,t,n,s){for(let i=Ut.length-1;i>=Ut.indexOf(t);i--){const a=Ut[i];if(pd[a].common&&r._adapter.diff(s,n,a)>=e-1)return a}return Ut[t?Ut.indexOf(t):0]}function O$(r){for(let e=Ut.indexOf(r)+1,t=Ut.length;e<t;++e)if(pd[Ut[e]].common)return Ut[e]}function Ty(r,e,t){if(!t)r[e]=!0;else if(t.length){const{lo:n,hi:s}=Hm(t,e),i=t[n]>=e?t[n]:t[s];r[i]=!0}}function T$(r,e,t,n){const s=r._adapter,i=+s.startOf(e[0].value,n),a=e[e.length-1].value;let o,l;for(o=i;o<=a;o=+s.add(o,1,n))l=t[o],l>=0&&(e[l].major=!0);return e}function Ry(r,e,t){const n=[],s={},i=e.length;let a,o;for(a=0;a<i;++a)o=e[a],s[o]=a,n.push({value:o,major:!1});return i===0||!t?n:T$(r,n,s,t)}class Mo extends ei{constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,t={}){const n=e.time||(e.time={}),s=this._adapter=new DR._date(e.adapters.date);s.init(t),so(n.displayFormats,s.formats()),this._parseOpts={parser:n.parser,round:n.round,isoWeekday:n.isoWeekday},super.init(e),this._normalized=t.normalized}parse(e,t){return e===void 0?null:Ay(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,t=this._adapter,n=e.time.unit||"day";let{min:s,max:i,minDefined:a,maxDefined:o}=this.getUserBounds();function l(c){!a&&!isNaN(c.min)&&(s=Math.min(s,c.min)),!o&&!isNaN(c.max)&&(i=Math.max(i,c.max))}(!a||!o)&&(l(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&l(this.getMinMax(!1))),s=Ge(s)&&!isNaN(s)?s:+t.startOf(Date.now(),n),i=Ge(i)&&!isNaN(i)?i:+t.endOf(Date.now(),n)+1,this.min=Math.min(s,i-1),this.max=Math.max(s+1,i)}_getLabelBounds(){const e=this.getLabelTimestamps();let t=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return e.length&&(t=e[0],n=e[e.length-1]),{min:t,max:n}}buildTicks(){const e=this.options,t=e.time,n=e.ticks,s=n.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&s.length&&(this.min=this._userMin||s[0],this.max=this._userMax||s[s.length-1]);const i=this.min,a=this.max,o=lT(s,i,a);return this._unit=t.unit||(n.autoSkip?Oy(t.minUnit,this.min,this.max,this._getLabelCapacity(i)):A$(this,o.length,t.minUnit,this.min,this.max)),this._majorUnit=!n.major.enabled||this._unit==="year"?void 0:O$(this._unit),this.initOffsets(s),e.reverse&&o.reverse(),Ry(this,o,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let t=0,n=0,s,i;this.options.offset&&e.length&&(s=this.getDecimalForValue(e[0]),e.length===1?t=1-s:t=(this.getDecimalForValue(e[1])-s)/2,i=this.getDecimalForValue(e[e.length-1]),e.length===1?n=i:n=(i-this.getDecimalForValue(e[e.length-2]))/2);const a=e.length<3?.5:.25;t=lt(t,0,a),n=lt(n,0,a),this._offsets={start:t,end:n,factor:1/(t+1+n)}}_generate(){const e=this._adapter,t=this.min,n=this.max,s=this.options,i=s.time,a=i.unit||Oy(i.minUnit,t,n,this._getLabelCapacity(t)),o=ae(s.ticks.stepSize,1),l=a==="week"?i.isoWeekday:!1,c=Di(l)||l===!0,u={};let d=t,h,f;if(c&&(d=+e.startOf(d,"isoWeek",l)),d=+e.startOf(d,c?"day":a),e.diff(n,t,a)>1e5*o)throw new Error(t+" and "+n+" are too far apart with stepSize of "+o+" "+a);const p=s.ticks.source==="data"&&this.getDataTimestamps();for(h=d,f=0;h<n;h=+e.add(h,o,a),f++)Ty(u,h,p);return(h===n||s.bounds==="ticks"||f===1)&&Ty(u,h,p),Object.keys(u).sort(Ey).map(m=>+m)}getLabelForValue(e){const t=this._adapter,n=this.options.time;return n.tooltipFormat?t.format(e,n.tooltipFormat):t.format(e,n.displayFormats.datetime)}format(e,t){const s=this.options.time.displayFormats,i=this._unit,a=t||s[i];return this._adapter.format(e,a)}_tickFormatFunction(e,t,n,s){const i=this.options,a=i.ticks.callback;if(a)return je(a,[e,t,n],this);const o=i.time.displayFormats,l=this._unit,c=this._majorUnit,u=l&&o[l],d=c&&o[c],h=n[t],f=c&&d&&h&&h.major;return this._adapter.format(e,s||(f?d:u))}generateTickLabels(e){let t,n,s;for(t=0,n=e.length;t<n;++t)s=e[t],s.label=this._tickFormatFunction(s.value,t,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const t=this._offsets,n=this.getDecimalForValue(e);return this.getPixelForDecimal((t.start+n)*t.factor)}getValueForPixel(e){const t=this._offsets,n=this.getDecimalForPixel(e)/t.factor-t.end;return this.min+n*(this.max-this.min)}_getLabelSize(e){const t=this.options.ticks,n=this.ctx.measureText(e).width,s=Rn(this.isHorizontal()?t.maxRotation:t.minRotation),i=Math.cos(s),a=Math.sin(s),o=this._resolveTickFontOptions(0).size;return{w:n*i+o*a,h:n*a+o*i}}_getLabelCapacity(e){const t=this.options.time,n=t.displayFormats,s=n[t.unit]||n.millisecond,i=this._tickFormatFunction(e,0,Ry(this,[e],this._majorUnit),s),a=this._getLabelSize(i),o=Math.floor(this.isHorizontal()?this.width/a.w:this.height/a.h)-1;return o>0?o:1}getDataTimestamps(){let e=this._cache.data||[],t,n;if(e.length)return e;const s=this.getMatchingVisibleMetas();if(this._normalized&&s.length)return this._cache.data=s[0].controller.getAllParsedValues(this);for(t=0,n=s.length;t<n;++t)e=e.concat(s[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let t,n;if(e.length)return e;const s=this.getLabels();for(t=0,n=s.length;t<n;++t)e.push(Ay(this,s[t]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return Fx(e.sort(Ey))}}M(Mo,"id","time"),M(Mo,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function Xl(r,e,t){let n=0,s=r.length-1,i,a,o,l;t?(e>=r[n].pos&&e<=r[s].pos&&({lo:n,hi:s}=Pr(r,"pos",e)),{pos:i,time:o}=r[n],{pos:a,time:l}=r[s]):(e>=r[n].time&&e<=r[s].time&&({lo:n,hi:s}=Pr(r,"time",e)),{time:i,pos:o}=r[n],{time:a,pos:l}=r[s]);const c=a-i;return c?o+(l-o)*(e-i)/c:o}class Up extends Mo{constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(e);this._minPos=Xl(t,this.min),this._tableRange=Xl(t,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:t,max:n}=this,s=[],i=[];let a,o,l,c,u;for(a=0,o=e.length;a<o;++a)c=e[a],c>=t&&c<=n&&s.push(c);if(s.length<2)return[{time:t,pos:0},{time:n,pos:1}];for(a=0,o=s.length;a<o;++a)u=s[a+1],l=s[a-1],c=s[a],Math.round((u+l)/2)!==c&&i.push({time:c,pos:a/(o-1)});return i}_generate(){const e=this.min,t=this.max;let n=super.getDataTimestamps();return(!n.includes(e)||!n.length)&&n.splice(0,0,e),(!n.includes(t)||n.length===1)&&n.push(t),n.sort((s,i)=>s-i)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const t=this.getDataTimestamps(),n=this.getLabelTimestamps();return t.length&&n.length?e=this.normalize(t.concat(n)):e=t.length?t:n,e=this._cache.all=e,e}getDecimalForValue(e){return(Xl(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const t=this._offsets,n=this.getDecimalForPixel(e)/t.factor-t.end;return Xl(this._table,n*this._tableRange+this._minPos,!0)}}M(Up,"id","timeseries"),M(Up,"defaults",Mo.defaults);var R$=Object.freeze({__proto__:null,CategoryScale:Dp,LinearScale:Fp,LogarithmicScale:Bp,RadialLinearScale:Va,TimeScale:Mo,TimeSeriesScale:Up});const C$=[jR,hI,o$,R$];vr.register(...C$);var I$=ie('<div class="resizable-container svelte-1y1kdpk"><div class="left-panel svelte-1y1kdpk"><!></div> <div class="resizer svelte-1y1kdpk" role="presentation"><div class="resizer-handle svelte-1y1kdpk"></div></div> <div class="right-panel svelte-1y1kdpk"><!></div></div>');function Ok(r,e){$t(e,!1);let t=$e(e,"initialLeftWidth",8,60),n=$e(e,"minLeftWidth",8,20),s=$e(e,"maxLeftWidth",8,80),i=ze(),a=ze(),o=ze(),l=ze(),c=!1,u=ze(t());const d=gx();function h(v){c=!0,document.body.style.cursor="col-resize",document.body.style.userSelect="none",v.preventDefault()}function f(v){if(!c)return;const S=P(i).getBoundingClientRect(),k=S.width;let A=(v.clientX-S.left)/k*100;A=Math.max(n(),Math.min(s(),A)),se(u,A),d("resize",{leftWidthPercent:P(u)})}function p(){c=!1,document.body.style.cursor="",document.body.style.userSelect=""}mx(()=>(document.addEventListener("mousemove",f),document.addEventListener("mouseup",p),()=>{document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",p)})),wn();var m=I$(),g=L(m),_=L(g);Vt(_,e,"left",{}),Ba(g,v=>se(o,v),()=>P(o));var y=B(g,2);Ba(y,v=>se(a,v),()=>P(a));var b=B(y,2),w=L(b);Vt(w,e,"right",{}),Ba(b,v=>se(l,v),()=>P(l)),Ba(m,v=>se(i,v),()=>P(i)),De(()=>Nm(m,`--left-width: ${P(u)??""}%;`)),an("mousedown",y,h),an("touchstart",y,Lm(h)),Z(r,m),Mt()}var $$=ie("<div><!></div>");function Cy(r,e){const t=Ye(e,["children","$$slots","$$events","$$legacy"]),n=Ye(t,["class"]);$t(e,!1);let s=$e(e,"class",8,"");wn();var i=$$();let a;var o=L(i);Vt(o,e,"default",{}),De(l=>a=Rr(i,a,{class:l,...n}),[()=>Qs("rounded-lg border bg-card text-card-foreground shadow-sm",s())],yn),Z(r,i),Mt()}var M$=ie("<div><!></div>");function Iy(r,e){const t=Ye(e,["children","$$slots","$$events","$$legacy"]),n=Ye(t,["class"]);$t(e,!1);let s=$e(e,"class",8,"");wn();var i=M$();let a;var o=L(i);Vt(o,e,"default",{}),De(l=>a=Rr(i,a,{class:l,...n}),[()=>Qs("p-6 pt-0",s())],yn),Z(r,i),Mt()}var N$=ie('<div class="text-center py-8 text-muted-foreground"><p>æ²¡æå¯ç¨çééãè¯·åçæä¸ä¸ªä¿¡å·ã</p></div>'),L$=ie('<div role="button" tabindex="0"><div class="flex justify-between items-center mb-2"><h3 class="text-sm"> </h3> <button class="h-8 w-8 flex items-center justify-center rounded-full text-destructive hover:bg-destructive/10"><span class="text-xl">Ã</span></button></div> <div class="h-8"><canvas></canvas></div></div>'),j$=ie('<div slot="left" class="overflow-auto min-h-0 h-full"><div class="flex flex-col"></div></div>'),D$=ie('<div class="space-y-1 col-span-2"><div class="text-xs text-muted-foreground">æºéé</div> <div class="text-sm"></div></div>'),F$=ie('<div class="space-y-1 col-span-2"><div class="text-xs text-muted-foreground">å¤çæ¹æ³</div> <div class="text-sm"> </div></div> <!>',1),B$=ie('<h3 class="text-lg font-semibold mb-4"> </h3> <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4"><div class="space-y-1"><div class="text-xs text-muted-foreground">ID</div> <div class="text-sm font-medium truncate"> </div></div> <div class="space-y-1"><div class="text-xs text-muted-foreground">åå»ºæ¶é´</div> <div class="text-sm"> </div></div> <div class="space-y-1"><div class="text-xs text-muted-foreground">æ´æ°æ¶é´</div> <div class="text-sm"> </div></div> <div class="space-y-1"><div class="text-xs text-muted-foreground">éæ ·ç</div> <div class="text-sm"> </div></div> <div class="space-y-1"><div class="text-xs text-muted-foreground">Length</div> <div class="text-sm"> </div></div> <div class="space-y-1"><div class="text-xs text-muted-foreground">Duration</div> <div class="text-sm"> </div></div> <div class="space-y-1"><div class="text-xs text-muted-foreground">æå°å¼/æå¤§å¼</div> <div class="text-sm"> </div></div> <div class="space-y-1"><div class="text-xs text-muted-foreground">å¹³åå¼/åæ¹æ ¹</div> <div class="text-sm"> </div></div> <!></div> <div class="h-64 mt-4"><canvas id="detail-chart"></canvas></div>',1),z$=ie('<div class="text-center py-8 text-muted-foreground"><p>è¯·éæ©ä¸ä¸ªééä»¥æ¥çè¯¦æã</p></div>'),U$=ie('<div slot="right" class="overflow-auto min-h-0 h-full p-4"><!></div>'),q$=ie('<div class="flex-1 flex flex-col overflow-hidden min-h-0"><!></div>');function W$(r,e){$t(e,!1);const[t,n]=Yi(),s=()=>ul(dl,"$channels",t);let i=$e(e,"selectedChannelId",12,null),a={};h1(()=>{s().length>0&&o()}),mx(()=>()=>{Object.values(a).forEach(g=>g.destroy())});function o(){if(s().forEach(g=>{const _=`chart-${g.id}`,y=document.getElementById(_);if(y){a[_]&&a[_].destroy();const b=y.getContext("2d");a[_]=l(b,g,!1)}}),i()){const g=s().find(_=>_.id===i());if(g){const _="detail-chart",y=document.getElementById(_);if(y){a[_]&&a[_].destroy();const b=y.getContext("2d");a[_]=l(b,g,!0)}}}}function l(g,_,y=!1){const b=_.data,w=Array.from({length:b.length},(S,k)=>k),v=_.processingMethod==="calculateFFT"||_.processingMethod==="calculatePowerSpectrum";return new vr(g,{type:v?"bar":"line",data:{labels:w,datasets:[{label:_.name,data:b,borderColor:"rgb(75, 192, 192)",backgroundColor:"rgba(75, 192, 192, 0.2)",borderWidth:1,pointRadius:y?1:0}]},options:{responsive:!0,maintainAspectRatio:!1,animation:!1,scales:{x:{title:{display:y,text:v?"é¢ç (Hz)":"æ ·æ¬"},display:y},y:{title:{display:y,text:"å¹åº¦"},display:y}},plugins:{legend:{display:y},tooltip:{enabled:y}}}})}function c(g){i(g),setTimeout(o,0)}function u(g){confirm("æ¨ç¡®å®è¦å é¤æ­¤ééåï¼")&&(g1(g),i()===g&&i(null))}function d(g){return new Date(g).toLocaleString()}wn();var h=q$(),f=L(h);{var p=g=>{var _=N$();Z(g,_)},m=g=>{Ok(g,{initialLeftWidth:40,minLeftWidth:30,maxLeftWidth:70,$$slots:{left:(_,y)=>{var b=j$(),w=L(b);Tn(w,5,s,v=>v.id,(v,S)=>{var k=L$(),x=L(k),A=L(x),C=L(A),I=B(A,2),D=B(x,2),Y=L(D);De(()=>{ax(k,1,`p-2 ${i()===P(S).id?"bg-primary/5":""} cursor-pointer hover:bg-accent/50 transition-colors border-b`),Oi(k,"aria-pressed",i()===P(S).id),nt(C,P(S).name),Oi(I,"aria-label",`Delete channel ${P(S).name??""}`),Oi(Y,"id",`chart-${P(S).id}`)}),an("click",I,O=>{O.stopPropagation(),u(P(S).id)}),an("click",k,()=>c(P(S).id)),an("keydown",k,O=>O.key==="Enter"&&c(P(S).id)),Z(v,k)}),Z(_,b)},right:(_,y)=>{var b=U$(),w=L(b);{var v=k=>{var x=kr(),A=bt(x);Tn(A,1,s,C=>C.id,(C,I)=>{var D=kr(),Y=bt(D);{var O=E=>{var $=B$(),N=bt($),R=L(N),F=B(N,2),V=L(F),ne=B(L(V),2),J=L(ne),K=B(V,2),z=B(L(K),2),Q=L(z),be=B(K,2),fe=B(L(be),2),vn=L(fe),Gt=B(be,2),Lt=B(L(Gt),2),ys=L(Lt),ws=B(Gt,2),xE=B(L(ws),2),kE=L(xE),__=B(ws,2),SE=B(L(__),2),PE=L(SE),b_=B(__,2),EE=B(L(b_),2),AE=L(EE),y_=B(b_,2),OE=B(L(y_),2),TE=L(OE),RE=B(y_,2);{var CE=ha=>{var $l=F$(),Ml=bt($l),Jd=B(L(Ml),2),Kd=L(Jd),Xd=B(Ml,2);{var Yd=fa=>{var w_=D$(),IE=B(L(w_),2);Tn(IE,5,()=>P(I).sourceChannelIds,Tr,($E,ME)=>{var v_=kr(),NE=bt(v_);Tn(NE,1,s,Tr,(LE,x_)=>{var k_=kr(),jE=bt(k_);{var DE=Qd=>{var S_=Is();De(()=>nt(S_,P(x_).name)),Z(Qd,S_)};zt(jE,Qd=>{P(x_).id===P(ME)&&Qd(DE)})}Z(LE,k_)}),Z($E,v_)}),Z(fa,w_)};zt(Xd,fa=>{P(I).sourceChannelIds.length>0&&fa(Yd)})}De(()=>nt(Kd,P(I).processingMethod)),Z(ha,$l)};zt(RE,ha=>{P(I).processingMethod&&ha(CE)})}De((ha,$l,Ml,Jd,Kd,Xd,Yd,fa)=>{nt(R,`${P(I).name??""} è¯¦æ`),nt(J,P(I).id),nt(Q,ha),nt(vn,$l),nt(ys,`${P(I).sampleRate??""} Hz`),nt(kE,`${Ml??""} ä¸ªæ ·æ¬`),nt(PE,`${Jd??""} s`),nt(AE,`${Kd??""} / ${Xd??""}`),nt(TE,`${Yd??""} / ${fa??""}`)},[()=>d(P(I).createdAt),()=>d(P(I).updatedAt),()=>P(I).getStats().length,()=>P(I).getStats().duration.toFixed(3),()=>P(I).getStats().min.toFixed(3),()=>P(I).getStats().max.toFixed(3),()=>P(I).getStats().mean.toFixed(3),()=>P(I).getStats().rms.toFixed(3)],yn),Z(E,$)};zt(Y,E=>{P(I).id===i()&&E(O)})}Z(C,D)}),Z(k,x)},S=k=>{var x=z$();Z(k,x)};zt(w,k=>{i()?k(v):k(S,!1)})}Z(_,b)}}})};zt(f,g=>{s().length===0?g(p):g(m,!1)})}Z(r,h),Mt(),n()}const qp="RFC3986",Wp={RFC1738:r=>String(r).replace(/%20/g,"+"),RFC3986:r=>String(r)},H$="RFC1738",V$=Array.isArray,Hn=(()=>{const r=[];for(let e=0;e<256;++e)r.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return r})(),Eh=1024,Z$=(r,e,t,n,s)=>{if(r.length===0)return r;let i=r;if(typeof r=="symbol"?i=Symbol.prototype.toString.call(r):typeof r!="string"&&(i=String(r)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let a="";for(let o=0;o<i.length;o+=Eh){const l=i.length>=Eh?i.slice(o,o+Eh):i,c=[];for(let u=0;u<l.length;++u){let d=l.charCodeAt(u);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||s===H$&&(d===40||d===41)){c[c.length]=l.charAt(u);continue}if(d<128){c[c.length]=Hn[d];continue}if(d<2048){c[c.length]=Hn[192|d>>6]+Hn[128|d&63];continue}if(d<55296||d>=57344){c[c.length]=Hn[224|d>>12]+Hn[128|d>>6&63]+Hn[128|d&63];continue}u+=1,d=65536+((d&1023)<<10|l.charCodeAt(u)&1023),c[c.length]=Hn[240|d>>18]+Hn[128|d>>12&63]+Hn[128|d>>6&63]+Hn[128|d&63]}a+=c.join("")}return a};function G$(r){return!r||typeof r!="object"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))}function $y(r,e){if(V$(r)){const t=[];for(let n=0;n<r.length;n+=1)t.push(e(r[n]));return t}return e(r)}const J$=Object.prototype.hasOwnProperty,Tk={brackets(r){return String(r)+"[]"},comma:"comma",indices(r,e){return String(r)+"["+e+"]"},repeat(r){return String(r)}},Jn=Array.isArray,K$=Array.prototype.push,Rk=function(r,e){K$.apply(r,Jn(e)?e:[e])},X$=Date.prototype.toISOString,tt={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Z$,encodeValuesOnly:!1,format:qp,formatter:Wp[qp],indices:!1,serializeDate(r){return X$.call(r)},skipNulls:!1,strictNullHandling:!1};function Y$(r){return typeof r=="string"||typeof r=="number"||typeof r=="boolean"||typeof r=="symbol"||typeof r=="bigint"}const Ah={};function Ck(r,e,t,n,s,i,a,o,l,c,u,d,h,f,p,m,g,_){let y=r,b=_,w=0,v=!1;for(;(b=b.get(Ah))!==void 0&&!v;){const C=b.get(r);if(w+=1,typeof C<"u"){if(C===w)throw new RangeError("Cyclic object value");v=!0}typeof b.get(Ah)>"u"&&(w=0)}if(typeof c=="function"?y=c(e,y):y instanceof Date?y=h==null?void 0:h(y):t==="comma"&&Jn(y)&&(y=$y(y,function(C){return C instanceof Date?h==null?void 0:h(C):C})),y===null){if(i)return l&&!m?l(e,tt.encoder,g,"key",f):e;y=""}if(Y$(y)||G$(y)){if(l){const C=m?e:l(e,tt.encoder,g,"key",f);return[(p==null?void 0:p(C))+"="+(p==null?void 0:p(l(y,tt.encoder,g,"value",f)))]}return[(p==null?void 0:p(e))+"="+(p==null?void 0:p(String(y)))]}const S=[];if(typeof y>"u")return S;let k;if(t==="comma"&&Jn(y))m&&l&&(y=$y(y,l)),k=[{value:y.length>0?y.join(",")||null:void 0}];else if(Jn(c))k=c;else{const C=Object.keys(y);k=u?C.sort(u):C}const x=o?String(e).replace(/\./g,"%2E"):String(e),A=n&&Jn(y)&&y.length===1?x+"[]":x;if(s&&Jn(y)&&y.length===0)return A+"[]";for(let C=0;C<k.length;++C){const I=k[C],D=typeof I=="object"&&typeof I.value<"u"?I.value:y[I];if(a&&D===null)continue;const Y=d&&o?I.replace(/\./g,"%2E"):I,O=Jn(y)?typeof t=="function"?t(A,Y):A:A+(d?"."+Y:"["+Y+"]");_.set(r,w);const E=new WeakMap;E.set(Ah,_),Rk(S,Ck(D,O,t,n,s,i,a,o,t==="comma"&&m&&Jn(y)?null:l,c,u,d,h,f,p,m,g,E))}return S}function Q$(r=tt){if(typeof r.allowEmptyArrays<"u"&&typeof r.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof r.encodeDotInKeys<"u"&&typeof r.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(r.encoder!==null&&typeof r.encoder<"u"&&typeof r.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=r.charset||tt.charset;if(typeof r.charset<"u"&&r.charset!=="utf-8"&&r.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=qp;if(typeof r.format<"u"){if(!J$.call(Wp,r.format))throw new TypeError("Unknown format option provided.");t=r.format}const n=Wp[t];let s=tt.filter;(typeof r.filter=="function"||Jn(r.filter))&&(s=r.filter);let i;if(r.arrayFormat&&r.arrayFormat in Tk?i=r.arrayFormat:"indices"in r?i=r.indices?"indices":"repeat":i=tt.arrayFormat,"commaRoundTrip"in r&&typeof r.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a=typeof r.allowDots>"u"?r.encodeDotInKeys?!0:tt.allowDots:!!r.allowDots;return{addQueryPrefix:typeof r.addQueryPrefix=="boolean"?r.addQueryPrefix:tt.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof r.allowEmptyArrays=="boolean"?!!r.allowEmptyArrays:tt.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof r.charsetSentinel=="boolean"?r.charsetSentinel:tt.charsetSentinel,commaRoundTrip:!!r.commaRoundTrip,delimiter:typeof r.delimiter>"u"?tt.delimiter:r.delimiter,encode:typeof r.encode=="boolean"?r.encode:tt.encode,encodeDotInKeys:typeof r.encodeDotInKeys=="boolean"?r.encodeDotInKeys:tt.encodeDotInKeys,encoder:typeof r.encoder=="function"?r.encoder:tt.encoder,encodeValuesOnly:typeof r.encodeValuesOnly=="boolean"?r.encodeValuesOnly:tt.encodeValuesOnly,filter:s,format:t,formatter:n,serializeDate:typeof r.serializeDate=="function"?r.serializeDate:tt.serializeDate,skipNulls:typeof r.skipNulls=="boolean"?r.skipNulls:tt.skipNulls,sort:typeof r.sort=="function"?r.sort:null,strictNullHandling:typeof r.strictNullHandling=="boolean"?r.strictNullHandling:tt.strictNullHandling}}function eM(r,e={}){let t=r;const n=Q$(e);let s,i;typeof n.filter=="function"?(i=n.filter,t=i("",t)):Jn(n.filter)&&(i=n.filter,s=i);const a=[];if(typeof t!="object"||t===null)return"";const o=Tk[n.arrayFormat],l=o==="comma"&&n.commaRoundTrip;s||(s=Object.keys(t)),n.sort&&s.sort(n.sort);const c=new WeakMap;for(let h=0;h<s.length;++h){const f=s[h];n.skipNulls&&t[f]===null||Rk(a,Ck(t[f],f,o,l,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,c))}const u=a.join(n.delimiter);let d=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),u.length>0?d+u:""}const gi="4.95.0";let My=!1,co,Ik,$k,Hp,Mk,Nk,Lk,jk,Dk;function tM(r,e={auto:!1}){if(My)throw new Error(`you must \`import 'openai/shims/${r.kind}'\` before importing anything else from openai`);if(co)throw new Error(`can't \`import 'openai/shims/${r.kind}'\` after \`import 'openai/shims/${co}'\``);My=e.auto,co=r.kind,Ik=r.fetch,$k=r.FormData,Hp=r.File,Mk=r.ReadableStream,Nk=r.getMultipartRequestOptions,Lk=r.getDefaultAgent,jk=r.fileFromPath,Dk=r.isFsReadStream}let nM=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function rM({manuallyImported:r}={}){const e=r?"You may need to use polyfills":"Add one of these imports before your first `import â¦ from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,n,s,i;try{t=fetch,n=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new nM(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}const Fk=()=>{co||tM(rM(),{auto:!0})};Fk();class te extends Error{}let Zt=class Vp extends te{constructor(e,t,n,s){super(`${Vp.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"],this.error=t;const i=t;this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,n){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e||!s)return new md({message:n,cause:Gp(t)});const i=t==null?void 0:t.error;return e===400?new Bk(e,i,n,s):e===401?new zk(e,i,n,s):e===403?new Uk(e,i,n,s):e===404?new qk(e,i,n,s):e===409?new Wk(e,i,n,s):e===422?new Hk(e,i,n,s):e===429?new Vk(e,i,n,s):e>=500?new Zk(e,i,n,s):new Vp(e,i,n,s)}},qt=class extends Zt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},md=class extends Zt{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},pl=class extends md{constructor({message:e}={}){super({message:e??"Request timed out."})}},Bk=class extends Zt{},zk=class extends Zt{},Uk=class extends Zt{},qk=class extends Zt{},Wk=class extends Zt{},Hk=class extends Zt{},Vk=class extends Zt{},Zk=class extends Zt{};class Gk extends te{constructor(){super("Could not parse response content as the length limit was reached")}}class Jk extends te{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var Yl=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Es=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Kt;let gd=class{constructor(){Kt.set(this,void 0),this.buffer=new Uint8Array,Yl(this,Kt,null,"f")}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e;let n=new Uint8Array(this.buffer.length+t.length);n.set(this.buffer),n.set(t,this.buffer.length),this.buffer=n;const s=[];let i;for(;(i=sM(this.buffer,Es(this,Kt,"f")))!=null;){if(i.carriage&&Es(this,Kt,"f")==null){Yl(this,Kt,i.index,"f");continue}if(Es(this,Kt,"f")!=null&&(i.index!==Es(this,Kt,"f")+1||i.carriage)){s.push(this.decodeText(this.buffer.slice(0,Es(this,Kt,"f")-1))),this.buffer=this.buffer.slice(Es(this,Kt,"f")),Yl(this,Kt,null,"f");continue}const a=Es(this,Kt,"f")!==null?i.preceding-1:i.preceding,o=this.decodeText(this.buffer.slice(0,a));s.push(o),this.buffer=this.buffer.slice(i.index),Yl(this,Kt,null,"f")}return s}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new te(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new te(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new te("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}};Kt=new WeakMap;gd.NEWLINE_CHARS=new Set([`
`,"\r"]);gd.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function sM(r,e){for(let s=e??0;s<r.length;s++){if(r[s]===10)return{preceding:s,index:s+1,carriage:!1};if(r[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function iM(r){for(let n=0;n<r.length-1;n++){if(r[n]===10&&r[n+1]===10||r[n]===13&&r[n+1]===13)return n+2;if(r[n]===13&&r[n+1]===10&&n+3<r.length&&r[n+2]===13&&r[n+3]===10)return n+4}return-1}function Kk(r){if(r[Symbol.asyncIterator])return r;const e=r.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}let No=class Za{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;async function*s(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(const a of aM(e,t))if(!i){if(a.data.startsWith("[DONE]")){i=!0;continue}if(a.event===null||a.event.startsWith("response.")||a.event.startsWith("transcript.")){let o;try{o=JSON.parse(a.data)}catch(l){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),l}if(o&&o.error)throw new Zt(void 0,o.error,void 0,iS(e.headers));yield o}else{let o;try{o=JSON.parse(a.data)}catch(l){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),l}if(a.event=="error")throw new Zt(void 0,o.error,o.message,void 0);yield{event:a.event,data:o}}}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new Za(s,t)}static fromReadableStream(e,t){let n=!1;async function*s(){const a=new gd,o=Kk(e);for await(const l of o)for(const c of a.decode(l))yield c;for(const l of a.flush())yield l}async function*i(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(const o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new Za(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=n.next();e.push(a),t.push(a)}return i.shift()}});return[new Za(()=>s(e),this.controller),new Za(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new Mk({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:a}=await t.next();if(a)return s.close();const o=n.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}};async function*aM(r,e){if(!r.body)throw e.abort(),new te("Attempted to iterate over a response with no body");const t=new lM,n=new gd,s=Kk(r.body);for await(const i of oM(s))for(const a of n.decode(i)){const o=t.decode(a);o&&(yield o)}for(const i of n.flush()){const a=t.decode(i);a&&(yield a)}}async function*oM(r){let e=new Uint8Array;for await(const t of r){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+n.length);s.set(e),s.set(n,e.length),e=s;let i;for(;(i=iM(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}let lM=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=cM(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function cM(r,e){const t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}const Xk=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function",Yk=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&_d(r),_d=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",uM=r=>Yk(r)||Xk(r)||Dk(r);async function Qk(r,e,t){var s;if(r=await r,Yk(r))return r;if(Xk(r)){const i=await r.blob();e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=_d(i)?[await i.arrayBuffer()]:[i];return new Hp(a,e,t)}const n=await dM(r);if(e||(e=fM(r)??"unknown_file"),!(t!=null&&t.type)){const i=(s=n[0])==null?void 0:s.type;typeof i=="string"&&(t={...t,type:i})}return new Hp(n,e,t)}async function dM(r){var t;let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(_d(r))e.push(await r.arrayBuffer());else if(pM(r))for await(const n of r)e.push(n);else throw new Error(`Unexpected data type: ${typeof r}; constructor: ${(t=r==null?void 0:r.constructor)==null?void 0:t.name}; props: ${hM(r)}`);return e}function hM(r){return`[${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}function fM(r){var e;return Oh(r.name)||Oh(r.filename)||((e=Oh(r.path))==null?void 0:e.split(/[\\/]/).pop())}const Oh=r=>{if(typeof r=="string")return r;if(typeof Buffer<"u"&&r instanceof Buffer)return String(r)},pM=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",Ny=r=>r&&typeof r=="object"&&r.body&&r[Symbol.toStringTag]==="MultipartBody",zi=async r=>{const e=await mM(r.body);return Nk(e,r)},mM=async r=>{const e=new $k;return await Promise.all(Object.entries(r||{}).map(([t,n])=>Zp(e,t,n))),e},Zp=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(uM(t)){const n=await Qk(t);r.append(e,n)}else if(Array.isArray(t))await Promise.all(t.map(n=>Zp(r,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,s])=>Zp(r,`${e}[${n}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Ri={},gM=function(r,e,t,n,s){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t},_M=function(r,e,t,n){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Ql;Fk();async function eS(r){var a;const{response:e}=r;if(r.options.stream)return ns("response",e.status,e.url,e.headers,e.body),r.options.__streamClass?r.options.__streamClass.fromSSEResponse(e,r.controller):No.fromSSEResponse(e,r.controller);if(e.status===204)return null;if(r.options.__binaryResponse)return e;const t=e.headers.get("content-type"),n=(a=t==null?void 0:t.split(";")[0])==null?void 0:a.trim();if((n==null?void 0:n.includes("application/json"))||(n==null?void 0:n.endsWith("+json"))){const o=await e.json();return ns("response",e.status,e.url,e.headers,o),tS(o,e)}const i=await e.text();return ns("response",e.status,e.url,e.headers,i),i}function tS(r,e){return!r||typeof r!="object"||Array.isArray(r)?r:Object.defineProperty(r,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}let nS=class rS extends Promise{constructor(e,t=eS){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new rS(this.responsePromise,async t=>tS(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},bM=class{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=Th("maxRetries",t),this.timeout=Th("timeout",n),this.httpAgent=s,this.fetch=i??Ik}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...kM(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${AM()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(async s=>{const i=s&&_d(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var m;const n={...e},{method:s,path:i,query:a,headers:o={}}=n,l=ArrayBuffer.isView(n.body)||n.__binaryRequest&&typeof n.body=="string"?n.body:Ny(n.body)?n.body.body:n.body?JSON.stringify(n.body,null,2):null,c=this.calculateContentLength(l),u=this.buildURL(i,a);"timeout"in n&&Th("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const d=n.httpAgent??this.httpAgent??Lk(u),h=n.timeout+1e3;typeof((m=d==null?void 0:d.options)==null?void 0:m.timeout)=="number"&&h>(d.options.timeout??0)&&(d.options.timeout=h),this.idempotencyHeader&&s!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);const f=this.buildHeaders({options:n,headers:o,contentLength:c,retryCount:t});return{req:{method:s,...l&&{body:l},headers:f,...d&&{agent:d},signal:n.signal??null},url:u,timeout:n.timeout}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:s}){const i={};n&&(i["content-length"]=n);const a=this.defaultHeaders(e);return Fy(i,a),Fy(i,t),Ny(e.body)&&co!=="node"&&delete i["content-type"],tc(a,"x-stainless-retry-count")===void 0&&tc(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),tc(a,"x-stainless-timeout")===void 0&&tc(t,"x-stainless-timeout")===void 0&&e.timeout&&(i["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,s){return Zt.generate(e,t,n,s)}request(e,t=null){return new nS(this.makeRequest(e,t))}async makeRequest(e,t){var d,h;const n=await e,s=n.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(n);const{req:i,url:a,timeout:o}=this.buildRequest(n,{retryCount:s-t});if(await this.prepareRequest(i,{url:a,options:n}),ns("request",a,n,i.headers),(d=n.signal)!=null&&d.aborted)throw new qt;const l=new AbortController,c=await this.fetchWithTimeout(a,i,o,l).catch(Gp);if(c instanceof Error){if((h=n.signal)!=null&&h.aborted)throw new qt;if(t)return this.retryRequest(n,t);throw c.name==="AbortError"?new pl:new md({cause:c})}const u=iS(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){const y=`retrying, ${t} attempts remaining`;return ns(`response (error; ${y})`,c.status,a,u),this.retryRequest(n,t,u)}const f=await c.text().catch(y=>Gp(y).message),p=SM(f),m=p?void 0:f;throw ns(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,a,u,m),this.makeStatusError(c.status,p,m,u)}return{response:c,options:n,controller:l}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new yM(this,n,e)}buildURL(e,t){const n=EM(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return aS(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new te(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,s){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),n),l={signal:s.signal,...a};return l.method&&(l.method=l.method.toUpperCase()),this.fetch.call(void 0,e,l).finally(()=>{clearTimeout(o)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){let s;const i=n==null?void 0:n["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(s=o)}const a=n==null?void 0:n["retry-after"];if(a&&!s){const o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await ml(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${gi}`}},sS=class{constructor(e,t,n,s){Ql.set(this,void 0),gM(this,Ql,e),this.options=s,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new te("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of n)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await _M(this,Ql,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Ql=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}},yM=class extends nS{constructor(e,t,n){super(t,async s=>new n(e,s.response,await eS(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}};const iS=r=>new Proxy(Object.fromEntries(r.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),wM={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},Je=r=>typeof r=="object"&&r!==null&&!aS(r)&&Object.keys(r).every(e=>oS(wM,e)),vM=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":gi,"X-Stainless-OS":jy(Deno.build.os),"X-Stainless-Arch":Ly(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":gi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":gi,"X-Stainless-OS":jy(process.platform),"X-Stainless-Arch":Ly(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const r=xM();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":gi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":gi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function xM(){if(typeof navigator>"u"||!navigator)return null;const r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of r){const n=t.exec(navigator.userAgent);if(n){const s=n[1]||0,i=n[2]||0,a=n[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const Ly=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",jy=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown");let Dy;const kM=()=>Dy??(Dy=vM()),SM=r=>{try{return JSON.parse(r)}catch{return}},PM=/^[a-z][a-z0-9+.-]*:/i,EM=r=>PM.test(r),ml=r=>new Promise(e=>setTimeout(e,r)),Th=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new te(`${r} must be an integer`);if(e<0)throw new te(`${r} must be a positive integer`);return e},Gp=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null)try{return new Error(JSON.stringify(r))}catch{}return new Error(r)},ec=r=>{var e,t,n,s;if(typeof process<"u")return((e=Ri==null?void 0:Ri[r])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(s=(n=(t=Deno.env)==null?void 0:t.get)==null?void 0:n.call(t,r))==null?void 0:s.trim()};function aS(r){if(!r)return!0;for(const e in r)return!1;return!0}function oS(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function Fy(r,e){for(const t in e){if(!oS(e,t))continue;const n=t.toLowerCase();if(!n)continue;const s=e[t];s===null?delete r[n]:s!==void 0&&(r[n]=s)}}const By=new Set(["authorization","api-key"]);function ns(r,...e){if(typeof process<"u"&&(Ri==null?void 0:Ri.DEBUG)==="true"){const t=e.map(n=>{if(!n)return n;if(n.headers){const i={...n,headers:{...n.headers}};for(const a in n.headers)By.has(a.toLowerCase())&&(i.headers[a]="REDACTED");return i}let s=null;for(const i in n)By.has(i.toLowerCase())&&(s??(s={...n}),s[i]="REDACTED");return s??n});console.log(`OpenAI:DEBUG:${r}`,...t)}}const AM=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)}),OM=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",TM=r=>typeof(r==null?void 0:r.get)=="function",tc=(r,e)=>{var n;const t=e.toLowerCase();if(TM(r)){const s=((n=e[0])==null?void 0:n.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,a,o)=>a+o.toUpperCase());for(const i of[e,t,e.toUpperCase(),s]){const a=r.get(i);if(a)return a}}for(const[s,i]of Object.entries(r))if(s.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i},RM=r=>{if(typeof Buffer<"u"){const e=Buffer.from(r,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(r),t=e.length,n=new Uint8Array(t);for(let s=0;s<t;s++)n[s]=e.charCodeAt(s);return Array.from(new Float32Array(n.buffer))}};function Rh(r){return r!=null&&typeof r=="object"&&!Array.isArray(r)}let bd=class extends sS{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}};class ft extends sS{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var n;const e=this.getPaginatedItems();if(!e.length)return null;const t=(n=e[e.length-1])==null?void 0:n.id;return t?{params:{after:t}}:null}}let he=class{constructor(e){this._client=e}},lS=class extends he{list(e,t={},n){return Je(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,CM,{query:t,...n})}},yd=class extends he{constructor(){super(...arguments),this.messages=new lS(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return Je(e)?this.list({},e):this._client.getAPIList("/chat/completions",wd,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}};class wd extends ft{}class CM extends ft{}yd.ChatCompletionsPage=wd;yd.Messages=lS;let vd=class extends he{constructor(){super(...arguments),this.completions=new yd(this._client)}};vd.Completions=yd;vd.ChatCompletionsPage=wd;class cS extends he{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t==null?void 0:t.headers},__binaryResponse:!0})}}class uS extends he{create(e,t){return this._client.post("/audio/transcriptions",zi({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}}class dS extends he{create(e,t){return this._client.post("/audio/translations",zi({body:e,...t,__metadata:{model:e.model}}))}}class gl extends he{constructor(){super(...arguments),this.transcriptions=new uS(this._client),this.translations=new dS(this._client),this.speech=new cS(this._client)}}gl.Transcriptions=uS;gl.Translations=dS;gl.Speech=cS;let rg=class extends he{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return Je(e)?this.list({},e):this._client.getAPIList("/batches",sg,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}};class sg extends ft{}rg.BatchesPage=sg;class ig extends he{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return Je(e)?this.list({},e):this._client.getAPIList("/assistants",ag,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class ag extends ft{}ig.AssistantsPage=ag;function zy(r){return typeof r.parse=="function"}const Ci=r=>(r==null?void 0:r.role)==="assistant",hS=r=>(r==null?void 0:r.role)==="function",fS=r=>(r==null?void 0:r.role)==="tool";var An=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},He=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Jp,Xc,Yc,Ga,Ja,Qc,Ka,br,Xa,yu,wu,_i,pS;class og{constructor(){Jp.add(this),this.controller=new AbortController,Xc.set(this,void 0),Yc.set(this,()=>{}),Ga.set(this,()=>{}),Ja.set(this,void 0),Qc.set(this,()=>{}),Ka.set(this,()=>{}),br.set(this,{}),Xa.set(this,!1),yu.set(this,!1),wu.set(this,!1),_i.set(this,!1),An(this,Xc,new Promise((e,t)=>{An(this,Yc,e,"f"),An(this,Ga,t,"f")}),"f"),An(this,Ja,new Promise((e,t)=>{An(this,Qc,e,"f"),An(this,Ka,t,"f")}),"f"),He(this,Xc,"f").catch(()=>{}),He(this,Ja,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},He(this,Jp,"m",pS).bind(this))},0)}_connected(){this.ended||(He(this,Yc,"f").call(this),this._emit("connect"))}get ended(){return He(this,Xa,"f")}get errored(){return He(this,yu,"f")}get aborted(){return He(this,wu,"f")}abort(){this.controller.abort()}on(e,t){return(He(this,br,"f")[e]||(He(this,br,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=He(this,br,"f")[e];if(!n)return this;const s=n.findIndex(i=>i.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(He(this,br,"f")[e]||(He(this,br,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{An(this,_i,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){An(this,_i,!0,"f"),await He(this,Ja,"f")}_emit(e,...t){if(He(this,Xa,"f"))return;e==="end"&&(An(this,Xa,!0,"f"),He(this,Qc,"f").call(this));const n=He(this,br,"f")[e];if(n&&(He(this,br,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!He(this,_i,"f")&&!(n!=null&&n.length)&&Promise.reject(s),He(this,Ga,"f").call(this,s),He(this,Ka,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!He(this,_i,"f")&&!(n!=null&&n.length)&&Promise.reject(s),He(this,Ga,"f").call(this,s),He(this,Ka,"f").call(this,s),this._emit("end")}}_emitFinal(){}}Xc=new WeakMap,Yc=new WeakMap,Ga=new WeakMap,Ja=new WeakMap,Qc=new WeakMap,Ka=new WeakMap,br=new WeakMap,Xa=new WeakMap,yu=new WeakMap,wu=new WeakMap,_i=new WeakMap,Jp=new WeakSet,pS=function(e){if(An(this,yu,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new qt),e instanceof qt)return An(this,wu,!0,"f"),this._emit("abort",e);if(e instanceof te)return this._emit("error",e);if(e instanceof Error){const t=new te(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new te(String(e)))};function IM(r,e){const t={...r};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function lg(r){return(r==null?void 0:r.$brand)==="auto-parseable-response-format"}function $M(r,{parser:e,callback:t}){const n={...r};return Object.defineProperties(n,{$brand:{value:"auto-parseable-tool",enumerable:!1},$parseRaw:{value:e,enumerable:!1},$callback:{value:t,enumerable:!1}}),n}function _l(r){return(r==null?void 0:r.$brand)==="auto-parseable-tool"}function MM(r,e){return!e||!mS(e)?{...r,choices:r.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:cg(r,e)}function cg(r,e){const t=r.choices.map(n=>{var s;if(n.finish_reason==="length")throw new Gk;if(n.finish_reason==="content_filter")throw new Jk;return{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:((s=n.message.tool_calls)==null?void 0:s.map(i=>LM(e,i)))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?NM(e,n.message.content):null}}});return{...r,choices:t}}function NM(r,e){var t,n;return((t=r.response_format)==null?void 0:t.type)!=="json_schema"?null:((n=r.response_format)==null?void 0:n.type)==="json_schema"?"$parseRaw"in r.response_format?r.response_format.$parseRaw(e):JSON.parse(e):null}function LM(r,e){var n;const t=(n=r.tools)==null?void 0:n.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:_l(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function jM(r,e){var n;if(!r)return!1;const t=(n=r.tools)==null?void 0:n.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return _l(t)||(t==null?void 0:t.function.strict)||!1}function mS(r){var e;return lg(r.response_format)?!0:((e=r.tools)==null?void 0:e.some(t=>_l(t)||t.type==="function"&&t.function.strict===!0))??!1}function DM(r){for(const e of r??[]){if(e.type!=="function")throw new te(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new te(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var Bt=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},gt,Kp,vu,Xp,Yp,Qp,gS,em;const Uy=10;class _S extends og{constructor(){super(...arguments),gt.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(n=e.choices[0])==null?void 0:n.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(hS(e)||fS(e))&&e.content)this._emit("functionCallResult",e.content);else if(Ci(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Ci(e)&&e.tool_calls)for(const n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new te("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),Bt(this,gt,"m",Kp).call(this)}async finalMessage(){return await this.done(),Bt(this,gt,"m",vu).call(this)}async finalFunctionCall(){return await this.done(),Bt(this,gt,"m",Xp).call(this)}async finalFunctionCallResult(){return await this.done(),Bt(this,gt,"m",Yp).call(this)}async totalUsage(){return await this.done(),Bt(this,gt,"m",Qp).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=Bt(this,gt,"m",vu).call(this);t&&this._emit("finalMessage",t);const n=Bt(this,gt,"m",Kp).call(this);n&&this._emit("finalContent",n);const s=Bt(this,gt,"m",Xp).call(this);s&&this._emit("finalFunctionCall",s);const i=Bt(this,gt,"m",Yp).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",Bt(this,gt,"m",Qp).call(this))}async _createChatCompletion(e,t,n){const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Bt(this,gt,"m",gS).call(this,t);const i=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(cg(i,t))}async _runChatCompletion(e,t,n){for(const s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){var h;const s="function",{function_call:i="auto",stream:a,...o}=t,l=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:c=Uy}=n||{},u={};for(const f of t.functions)u[f.name||f.function.name]=f;const d=t.functions.map(f=>({name:f.name||f.function.name,parameters:f.parameters,description:f.description}));for(const f of t.messages)this._addMessage(f,!1);for(let f=0;f<c;++f){const m=(h=(await this._createChatCompletion(e,{...o,function_call:i,functions:d,messages:[...this.messages]},n)).choices[0])==null?void 0:h.message;if(!m)throw new te("missing message in ChatCompletion response");if(!m.function_call)return;const{name:g,arguments:_}=m.function_call,y=u[g];if(y){if(l&&l!==g){const S=`Invalid function_call: ${JSON.stringify(g)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,name:g,content:S});continue}}else{const S=`Invalid function_call: ${JSON.stringify(g)}. Available options are: ${d.map(k=>JSON.stringify(k.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:g,content:S});continue}let b;try{b=zy(y)?await y.parse(_):_}catch(S){this._addMessage({role:s,name:g,content:S instanceof Error?S.message:String(S)});continue}const w=await y.function(b,this),v=Bt(this,gt,"m",em).call(this,w);if(this._addMessage({role:s,name:g,content:v}),l)return}}async _runTools(e,t,n){var f,p,m;const s="tool",{tool_choice:i="auto",stream:a,...o}=t,l=typeof i!="string"&&((f=i==null?void 0:i.function)==null?void 0:f.name),{maxChatCompletions:c=Uy}=n||{},u=t.tools.map(g=>{if(_l(g)){if(!g.$callback)throw new te("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:g.$callback,name:g.function.name,description:g.function.description||"",parameters:g.function.parameters,parse:g.$parseRaw,strict:!0}}}return g}),d={};for(const g of u)g.type==="function"&&(d[g.function.name||g.function.function.name]=g.function);const h="tools"in t?u.map(g=>g.type==="function"?{type:"function",function:{name:g.function.name||g.function.function.name,parameters:g.function.parameters,description:g.function.description,strict:g.function.strict}}:g):void 0;for(const g of t.messages)this._addMessage(g,!1);for(let g=0;g<c;++g){const y=(p=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:h,messages:[...this.messages]},n)).choices[0])==null?void 0:p.message;if(!y)throw new te("missing message in ChatCompletion response");if(!((m=y.tool_calls)!=null&&m.length))return;for(const b of y.tool_calls){if(b.type!=="function")continue;const w=b.id,{name:v,arguments:S}=b.function,k=d[v];if(k){if(l&&l!==v){const I=`Invalid tool_call: ${JSON.stringify(v)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,tool_call_id:w,content:I});continue}}else{const I=`Invalid tool_call: ${JSON.stringify(v)}. Available options are: ${Object.keys(d).map(D=>JSON.stringify(D)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:w,content:I});continue}let x;try{x=zy(k)?await k.parse(S):S}catch(I){const D=I instanceof Error?I.message:String(I);this._addMessage({role:s,tool_call_id:w,content:D});continue}const A=await k.function(x,this),C=Bt(this,gt,"m",em).call(this,A);if(this._addMessage({role:s,tool_call_id:w,content:C}),l)return}}}}gt=new WeakSet,Kp=function(){return Bt(this,gt,"m",vu).call(this).content??null},vu=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Ci(t)){const{function_call:n,...s}=t,i={...s,content:t.content??null,refusal:t.refusal??null};return n&&(i.function_call=n),i}}throw new te("stream ended without producing a ChatCompletionMessage with role=assistant")},Xp=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){const s=this.messages[n];if(Ci(s)&&(s!=null&&s.function_call))return s.function_call;if(Ci(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},Yp=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(hS(t)&&t.content!=null||fS(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>{var s;return n.role==="assistant"&&((s=n.tool_calls)==null?void 0:s.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},Qp=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},gS=function(e){if(e.n!=null&&e.n>1)throw new te("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},em=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Lo extends _S{static runFunctions(e,t,n){const s=new Lo,i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,n){const s=new Lo,i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e,t=!0){super._addMessage(e,t),Ci(e)&&e.content&&this._emit("content",e.content)}}const bS=1,yS=2,wS=4,vS=8,xS=16,kS=32,SS=64,PS=128,ES=256,AS=PS|ES,OS=xS|kS|AS|SS,TS=bS|yS|OS,RS=wS|vS,FM=TS|RS,at={STR:bS,NUM:yS,ARR:wS,OBJ:vS,NULL:xS,BOOL:kS,NAN:SS,INFINITY:PS,MINUS_INFINITY:ES,INF:AS,SPECIAL:OS,ATOM:TS,COLLECTION:RS,ALL:FM};class BM extends Error{}class zM extends Error{}function UM(r,e=at.ALL){if(typeof r!="string")throw new TypeError(`expecting str, got ${typeof r}`);if(!r.trim())throw new Error(`${r} is empty`);return qM(r.trim(),e)}const qM=(r,e)=>{const t=r.length;let n=0;const s=h=>{throw new BM(`${h} at position ${n}`)},i=h=>{throw new zM(`${h} at position ${n}`)},a=()=>(d(),n>=t&&s("Unexpected end of input"),r[n]==='"'?o():r[n]==="{"?l():r[n]==="["?c():r.substring(n,n+4)==="null"||at.NULL&e&&t-n<4&&"null".startsWith(r.substring(n))?(n+=4,null):r.substring(n,n+4)==="true"||at.BOOL&e&&t-n<4&&"true".startsWith(r.substring(n))?(n+=4,!0):r.substring(n,n+5)==="false"||at.BOOL&e&&t-n<5&&"false".startsWith(r.substring(n))?(n+=5,!1):r.substring(n,n+8)==="Infinity"||at.INFINITY&e&&t-n<8&&"Infinity".startsWith(r.substring(n))?(n+=8,1/0):r.substring(n,n+9)==="-Infinity"||at.MINUS_INFINITY&e&&1<t-n&&t-n<9&&"-Infinity".startsWith(r.substring(n))?(n+=9,-1/0):r.substring(n,n+3)==="NaN"||at.NAN&e&&t-n<3&&"NaN".startsWith(r.substring(n))?(n+=3,NaN):u()),o=()=>{const h=n;let f=!1;for(n++;n<t&&(r[n]!=='"'||f&&r[n-1]==="\\");)f=r[n]==="\\"?!f:!1,n++;if(r.charAt(n)=='"')try{return JSON.parse(r.substring(h,++n-Number(f)))}catch(p){i(String(p))}else if(at.STR&e)try{return JSON.parse(r.substring(h,n-Number(f))+'"')}catch{return JSON.parse(r.substring(h,r.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},l=()=>{n++,d();const h={};try{for(;r[n]!=="}";){if(d(),n>=t&&at.OBJ&e)return h;const f=o();d(),n++;try{const p=a();Object.defineProperty(h,f,{value:p,writable:!0,enumerable:!0,configurable:!0})}catch(p){if(at.OBJ&e)return h;throw p}d(),r[n]===","&&n++}}catch{if(at.OBJ&e)return h;s("Expected '}' at end of object")}return n++,h},c=()=>{n++;const h=[];try{for(;r[n]!=="]";)h.push(a()),d(),r[n]===","&&n++}catch{if(at.ARR&e)return h;s("Expected ']' at end of array")}return n++,h},u=()=>{if(n===0){r==="-"&&at.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(r)}catch(f){if(at.NUM&e)try{return r[r.length-1]==="."?JSON.parse(r.substring(0,r.lastIndexOf("."))):JSON.parse(r.substring(0,r.lastIndexOf("e")))}catch{}i(String(f))}}const h=n;for(r[n]==="-"&&n++;r[n]&&!",]}".includes(r[n]);)n++;n==t&&!(at.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(r.substring(h,n))}catch{r.substring(h,n)==="-"&&at.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(r.substring(h,r.lastIndexOf("e")))}catch(p){i(String(p))}}},d=()=>{for(;n<t&&` 
\r	`.includes(r[n]);)n++};return a()},qy=r=>UM(r,at.ALL^at.NUM);var ci=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Me=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},et,hr,ui,Lr,Ch,nc,Ih,$h,Mh,rc,Nh,Wy;class jo extends _S{constructor(e){super(),et.add(this),hr.set(this,void 0),ui.set(this,void 0),Lr.set(this,void 0),ci(this,hr,e,"f"),ci(this,ui,[],"f")}get currentChatCompletionSnapshot(){return Me(this,Lr,"f")}static fromReadableStream(e){const t=new jo(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const s=new jo(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,n){var a;super._createChatCompletion;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Me(this,et,"m",Ch).call(this);const i=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of i)Me(this,et,"m",Ih).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new qt;return this._addChatCompletion(Me(this,et,"m",rc).call(this))}async _fromReadableStream(e,t){var a;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),Me(this,et,"m",Ch).call(this),this._connected();const s=No.fromReadableStream(e,this.controller);let i;for await(const o of s)i&&i!==o.id&&this._addChatCompletion(Me(this,et,"m",rc).call(this)),Me(this,et,"m",Ih).call(this,o),i=o.id;if((a=s.controller.signal)!=null&&a.aborted)throw new qt;return this._addChatCompletion(Me(this,et,"m",rc).call(this))}[(hr=new WeakMap,ui=new WeakMap,Lr=new WeakMap,et=new WeakSet,Ch=function(){this.ended||ci(this,Lr,void 0,"f")},nc=function(t){let n=Me(this,ui,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Me(this,ui,"f")[t.index]=n,n)},Ih=function(t){var s,i,a,o,l,c,u,d,h,f,p,m,g,_,y;if(this.ended)return;const n=Me(this,et,"m",Wy).call(this,t);this._emit("chunk",t,n);for(const b of t.choices){const w=n.choices[b.index];b.delta.content!=null&&((s=w.message)==null?void 0:s.role)==="assistant"&&((i=w.message)!=null&&i.content)&&(this._emit("content",b.delta.content,w.message.content),this._emit("content.delta",{delta:b.delta.content,snapshot:w.message.content,parsed:w.message.parsed})),b.delta.refusal!=null&&((a=w.message)==null?void 0:a.role)==="assistant"&&((o=w.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:b.delta.refusal,snapshot:w.message.refusal}),((l=b.logprobs)==null?void 0:l.content)!=null&&((c=w.message)==null?void 0:c.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(u=b.logprobs)==null?void 0:u.content,snapshot:((d=w.logprobs)==null?void 0:d.content)??[]}),((h=b.logprobs)==null?void 0:h.refusal)!=null&&((f=w.message)==null?void 0:f.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(p=b.logprobs)==null?void 0:p.refusal,snapshot:((m=w.logprobs)==null?void 0:m.refusal)??[]});const v=Me(this,et,"m",nc).call(this,w);w.finish_reason&&(Me(this,et,"m",Mh).call(this,w),v.current_tool_call_index!=null&&Me(this,et,"m",$h).call(this,w,v.current_tool_call_index));for(const S of b.delta.tool_calls??[])v.current_tool_call_index!==S.index&&(Me(this,et,"m",Mh).call(this,w),v.current_tool_call_index!=null&&Me(this,et,"m",$h).call(this,w,v.current_tool_call_index)),v.current_tool_call_index=S.index;for(const S of b.delta.tool_calls??[]){const k=(g=w.message.tool_calls)==null?void 0:g[S.index];k!=null&&k.type&&((k==null?void 0:k.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(_=k.function)==null?void 0:_.name,index:S.index,arguments:k.function.arguments,parsed_arguments:k.function.parsed_arguments,arguments_delta:((y=S.function)==null?void 0:y.arguments)??""}):(k==null||k.type,void 0))}}},$h=function(t,n){var a,o,l;if(Me(this,et,"m",nc).call(this,t).done_tool_calls.has(n))return;const i=(a=t.message.tool_calls)==null?void 0:a[n];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){const c=(l=(o=Me(this,hr,"f"))==null?void 0:o.tools)==null?void 0:l.find(u=>u.type==="function"&&u.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:n,arguments:i.function.arguments,parsed_arguments:_l(c)?c.$parseRaw(i.function.arguments):c!=null&&c.function.strict?JSON.parse(i.function.arguments):null})}else i.type},Mh=function(t){var s,i;const n=Me(this,et,"m",nc).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;const a=Me(this,et,"m",Nh).call(this);this._emit("content.done",{content:t.message.content,parsed:a?a.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(s=t.logprobs)!=null&&s.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(i=t.logprobs)!=null&&i.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},rc=function(){if(this.ended)throw new te("stream has ended, this shouldn't happen");const t=Me(this,Lr,"f");if(!t)throw new te("request ended without sending any chunks");return ci(this,Lr,void 0,"f"),ci(this,ui,[],"f"),WM(t,Me(this,hr,"f"))},Nh=function(){var n;const t=(n=Me(this,hr,"f"))==null?void 0:n.response_format;return lg(t)?t:null},Wy=function(t){var n,s,i,a;let o=Me(this,Lr,"f");const{choices:l,...c}=t;o?Object.assign(o,c):o=ci(this,Lr,{...c,choices:[]},"f");for(const{delta:u,finish_reason:d,index:h,logprobs:f=null,...p}of t.choices){let m=o.choices[h];if(m||(m=o.choices[h]={finish_reason:d,index:h,message:{},logprobs:f,...p}),f)if(!m.logprobs)m.logprobs=Object.assign({},f);else{const{content:S,refusal:k,...x}=f;Object.assign(m.logprobs,x),S&&((n=m.logprobs).content??(n.content=[]),m.logprobs.content.push(...S)),k&&((s=m.logprobs).refusal??(s.refusal=[]),m.logprobs.refusal.push(...k))}if(d&&(m.finish_reason=d,Me(this,hr,"f")&&mS(Me(this,hr,"f")))){if(d==="length")throw new Gk;if(d==="content_filter")throw new Jk}if(Object.assign(m,p),!u)continue;const{content:g,refusal:_,function_call:y,role:b,tool_calls:w,...v}=u;if(Object.assign(m.message,v),_&&(m.message.refusal=(m.message.refusal||"")+_),b&&(m.message.role=b),y&&(m.message.function_call?(y.name&&(m.message.function_call.name=y.name),y.arguments&&((i=m.message.function_call).arguments??(i.arguments=""),m.message.function_call.arguments+=y.arguments)):m.message.function_call=y),g&&(m.message.content=(m.message.content||"")+g,!m.message.refusal&&Me(this,et,"m",Nh).call(this)&&(m.message.parsed=qy(m.message.content))),w){m.message.tool_calls||(m.message.tool_calls=[]);for(const{index:S,id:k,type:x,function:A,...C}of w){const I=(a=m.message.tool_calls)[S]??(a[S]={});Object.assign(I,C),k&&(I.id=k),x&&(I.type=x),A&&(I.function??(I.function={name:A.name??"",arguments:""})),A!=null&&A.name&&(I.function.name=A.name),A!=null&&A.arguments&&(I.function.arguments+=A.arguments,jM(Me(this,hr,"f"),I)&&(I.function.parsed_arguments=qy(I.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new No(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function WM(r,e){const{id:t,choices:n,created:s,model:i,system_fingerprint:a,...o}=r,l={...o,id:t,choices:n.map(({message:c,finish_reason:u,index:d,logprobs:h,...f})=>{if(!u)throw new te(`missing finish_reason for choice ${d}`);const{content:p=null,function_call:m,tool_calls:g,..._}=c,y=c.role;if(!y)throw new te(`missing role for choice ${d}`);if(m){const{arguments:b,name:w}=m;if(b==null)throw new te(`missing function_call.arguments for choice ${d}`);if(!w)throw new te(`missing function_call.name for choice ${d}`);return{...f,message:{content:p,function_call:{arguments:b,name:w},role:y,refusal:c.refusal??null},finish_reason:u,index:d,logprobs:h}}return g?{...f,index:d,finish_reason:u,logprobs:h,message:{..._,role:y,content:p,refusal:c.refusal??null,tool_calls:g.map((b,w)=>{const{function:v,type:S,id:k,...x}=b,{arguments:A,name:C,...I}=v||{};if(k==null)throw new te(`missing choices[${d}].tool_calls[${w}].id
${sc(r)}`);if(S==null)throw new te(`missing choices[${d}].tool_calls[${w}].type
${sc(r)}`);if(C==null)throw new te(`missing choices[${d}].tool_calls[${w}].function.name
${sc(r)}`);if(A==null)throw new te(`missing choices[${d}].tool_calls[${w}].function.arguments
${sc(r)}`);return{...x,id:k,type:S,function:{...I,name:C,arguments:A}}})}}:{...f,message:{..._,content:p,role:y,refusal:c.refusal??null},finish_reason:u,index:d,logprobs:h}}),created:s,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return MM(l,e)}function sc(r){return JSON.stringify(r)}class Ii extends jo{static fromReadableStream(e){const t=new Ii(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,n){const s=new Ii(null),i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,n){const s=new Ii(t),i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}}let CS=class extends he{parse(e,t){return DM(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(n=>cg(n,e))}runFunctions(e,t){return e.stream?Ii.runFunctions(this._client,e,t):Lo.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?Ii.runTools(this._client,e,t):Lo.runTools(this._client,e,t)}stream(e,t){return jo.createChatCompletion(this._client,e,t)}};class tm extends he{constructor(){super(...arguments),this.completions=new CS(this._client)}}(function(r){r.Completions=CS})(tm||(tm={}));class IS extends he{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class $S extends he{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class xd extends he{constructor(){super(...arguments),this.sessions=new IS(this._client),this.transcriptionSessions=new $S(this._client)}}xd.Sessions=IS;xd.TranscriptionSessions=$S;var X=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Jt=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},dt,nm,Kn,eu,On,Ms,vi,Cs,xu,en,tu,nu,uo,Ya,Qa,Hy,Vy,Zy,Gy,Jy,Ky,Xy;class Cn extends og{constructor(){super(...arguments),dt.add(this),nm.set(this,[]),Kn.set(this,{}),eu.set(this,{}),On.set(this,void 0),Ms.set(this,void 0),vi.set(this,void 0),Cs.set(this,void 0),xu.set(this,void 0),en.set(this,void 0),tu.set(this,void 0),nu.set(this,void 0),uo.set(this,void 0)}[(nm=new WeakMap,Kn=new WeakMap,eu=new WeakMap,On=new WeakMap,Ms=new WeakMap,vi=new WeakMap,Cs=new WeakMap,xu=new WeakMap,en=new WeakMap,tu=new WeakMap,nu=new WeakMap,uo=new WeakMap,dt=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Cn;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var i;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=No.fromReadableStream(e,this.controller);for await(const a of s)X(this,dt,"m",Ya).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new qt;return this._addRun(X(this,dt,"m",Qa).call(this))}toReadableStream(){return new No(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,s,i){const a=new Cn;return a._run(()=>a._runToolAssistantStream(e,t,n,s,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,n,s,i){var c;const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},l=await e.submitToolOutputs(t,n,o,{...i,signal:this.controller.signal});this._connected();for await(const u of l)X(this,dt,"m",Ya).call(this,u);if((c=l.controller.signal)!=null&&c.aborted)throw new qt;return this._addRun(X(this,dt,"m",Qa).call(this))}static createThreadAssistantStream(e,t,n){const s=new Cn;return s._run(()=>s._threadAssistantStream(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,n,s){const i=new Cn;return i._run(()=>i._runAssistantStream(e,t,n,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return X(this,tu,"f")}currentRun(){return X(this,nu,"f")}currentMessageSnapshot(){return X(this,On,"f")}currentRunStepSnapshot(){return X(this,uo,"f")}async finalRunSteps(){return await this.done(),Object.values(X(this,Kn,"f"))}async finalMessages(){return await this.done(),Object.values(X(this,eu,"f"))}async finalRun(){if(await this.done(),!X(this,Ms,"f"))throw Error("Final run was not received.");return X(this,Ms,"f")}async _createThreadAssistantStream(e,t,n){var o;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i={...t,stream:!0},a=await e.createAndRun(i,{...n,signal:this.controller.signal});this._connected();for await(const l of a)X(this,dt,"m",Ya).call(this,l);if((o=a.controller.signal)!=null&&o.aborted)throw new qt;return this._addRun(X(this,dt,"m",Qa).call(this))}async _createAssistantStream(e,t,n,s){var l;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...n,stream:!0},o=await e.create(t,a,{...s,signal:this.controller.signal});this._connected();for await(const c of o)X(this,dt,"m",Ya).call(this,c);if((l=o.controller.signal)!=null&&l.aborted)throw new qt;return this._addRun(X(this,dt,"m",Qa).call(this))}static accumulateDelta(e,t){for(const[n,s]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=s;continue}let i=e[n];if(i==null){e[n]=s;continue}if(n==="index"||n==="type"){e[n]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(Rh(i)&&Rh(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}for(const a of s){if(!Rh(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);const o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const l=i[o];l==null?i.push(a):i[o]=this.accumulateDelta(l,a)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${i}`);e[n]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,s){return await this._createAssistantStream(t,e,n,s)}async _runToolAssistantStream(e,t,n,s,i){return await this._createToolAssistantStream(n,e,t,s,i)}}Ya=function(e){if(!this.ended)switch(Jt(this,tu,e,"f"),X(this,dt,"m",Zy).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":X(this,dt,"m",Xy).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":X(this,dt,"m",Vy).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":X(this,dt,"m",Hy).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Qa=function(){if(this.ended)throw new te("stream has ended, this shouldn't happen");if(!X(this,Ms,"f"))throw Error("Final run has not been received");return X(this,Ms,"f")},Hy=function(e){const[t,n]=X(this,dt,"m",Jy).call(this,e,X(this,On,"f"));Jt(this,On,t,"f"),X(this,eu,"f")[t.id]=t;for(const s of n){const i=t.content[s.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=t.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=X(this,vi,"f")){if(X(this,Cs,"f"))switch(X(this,Cs,"f").type){case"text":this._emit("textDone",X(this,Cs,"f").text,X(this,On,"f"));break;case"image_file":this._emit("imageFileDone",X(this,Cs,"f").image_file,X(this,On,"f"));break}Jt(this,vi,s.index,"f")}Jt(this,Cs,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(X(this,vi,"f")!==void 0){const s=e.data.content[X(this,vi,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,X(this,On,"f"));break;case"text":this._emit("textDone",s.text,X(this,On,"f"));break}}X(this,On,"f")&&this._emit("messageDone",e.data),Jt(this,On,void 0,"f")}},Vy=function(e){const t=X(this,dt,"m",Gy).call(this,e);switch(Jt(this,uo,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const i of n.step_details.tool_calls)i.index==X(this,xu,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(X(this,en,"f")&&this._emit("toolCallDone",X(this,en,"f")),Jt(this,xu,i.index,"f"),Jt(this,en,t.step_details.tool_calls[i.index],"f"),X(this,en,"f")&&this._emit("toolCallCreated",X(this,en,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Jt(this,uo,void 0,"f"),e.data.step_details.type=="tool_calls"&&X(this,en,"f")&&(this._emit("toolCallDone",X(this,en,"f")),Jt(this,en,void 0,"f")),this._emit("runStepDone",e.data,t);break}},Zy=function(e){X(this,nm,"f").push(e),this._emit("event",e)},Gy=function(e){switch(e.event){case"thread.run.step.created":return X(this,Kn,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=X(this,Kn,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const s=Cn.accumulateDelta(t,n.delta);X(this,Kn,"f")[e.data.id]=s}return X(this,Kn,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":X(this,Kn,"f")[e.data.id]=e.data;break}if(X(this,Kn,"f")[e.data.id])return X(this,Kn,"f")[e.data.id];throw new Error("No snapshot available")},Jy=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const i of s.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=X(this,dt,"m",Ky).call(this,i,a)}else t.content[i.index]=i,n.push(i);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Ky=function(e,t){return Cn.accumulateDelta(t,e)},Xy=function(e){switch(Jt(this,nu,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Jt(this,Ms,e.data,"f"),X(this,en,"f")&&(this._emit("toolCallDone",X(this,en,"f")),Jt(this,en,void 0,"f"));break}};let ug=class extends he{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return Je(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,dg,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}};class dg extends ft{}ug.MessagesPage=dg;class hg extends he{retrieve(e,t,n,s={},i){return Je(s)?this.retrieve(e,t,n,{},s):this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,t,n={},s){return Je(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,fg,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class fg extends ft{}hg.RunStepsPage=fg;let bl=class extends he{constructor(){super(...arguments),this.steps=new hg(this._client)}create(e,t,n){const{include:s,...i}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:i,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return Je(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,pg,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t,n);return await this.poll(e,s.id,n)}createAndStream(e,t,n){return Cn.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...n,headers:{...n==null?void 0:n.headers,...s}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const l=a.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(o=c)}}await ml(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,n){return Cn.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,s){const i=await this.submitToolOutputs(e,t,n,s);return await this.poll(e,i.id,s)}submitToolOutputsStream(e,t,n,s){return Cn.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,s)}};class pg extends ft{}bl.RunsPage=pg;bl.Steps=hg;bl.RunStepsPage=fg;class na extends he{constructor(){super(...arguments),this.runs=new bl(this._client),this.messages=new ug(this._client)}create(e={},t){return Je(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return Cn.createThreadAssistantStream(e,this._client.beta.threads,t)}}na.Runs=bl;na.RunsPage=pg;na.Messages=ug;na.MessagesPage=dg;let ra=class extends he{constructor(){super(...arguments),this.realtime=new xd(this._client),this.chat=new tm(this._client),this.assistants=new ig(this._client),this.threads=new na(this._client)}};ra.Realtime=xd;ra.Assistants=ig;ra.AssistantsPage=ag;ra.Threads=na;let MS=class extends he{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}};class NS extends he{create(e,t){const n=!!e.encoding_format;let s=n?e.encoding_format:"base64";n&&ns("Request","User defined encoding_format:",e.encoding_format);const i=this._client.post("/embeddings",{body:{...e,encoding_format:s},...t});return n?i:(ns("response","Decoding base64 embeddings to float32 array"),i._thenUnwrap(a=>(a&&a.data&&a.data.forEach(o=>{const l=o.embedding;o.embedding=RM(l)}),a)))}}class mg extends he{retrieve(e,t,n,s){return this._client.get(`/evals/${e}/runs/${t}/output_items/${n}`,s)}list(e,t,n={},s){return Je(n)?this.list(e,t,{},n):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,gg,{query:n,...s})}}class gg extends ft{}mg.OutputItemListResponsesPage=gg;class yl extends he{constructor(){super(...arguments),this.outputItems=new mg(this._client)}create(e,t,n){return this._client.post(`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){return this._client.get(`/evals/${e}/runs/${t}`,n)}list(e,t={},n){return Je(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,_g,{query:t,...n})}del(e,t,n){return this._client.delete(`/evals/${e}/runs/${t}`,n)}cancel(e,t,n){return this._client.post(`/evals/${e}/runs/${t}`,n)}}class _g extends ft{}yl.RunListResponsesPage=_g;yl.OutputItems=mg;yl.OutputItemListResponsesPage=gg;class wl extends he{constructor(){super(...arguments),this.runs=new yl(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,n){return this._client.post(`/evals/${e}`,{body:t,...n})}list(e={},t){return Je(e)?this.list({},e):this._client.getAPIList("/evals",bg,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}}class bg extends ft{}wl.EvalListResponsesPage=bg;wl.Runs=yl;wl.RunListResponsesPage=_g;let yg=class extends he{create(e,t){return this._client.post("/files",zi({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return Je(e)?this.list({},e):this._client.getAPIList("/files",wg,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),i=Date.now();let a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await ml(t),a=await this.retrieve(e),Date.now()-i>n)throw new pl({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}};class wg extends ft{}yg.FileObjectsPage=wg;class vg extends he{create(e,t,n){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,xg,{body:t,method:"post",...n})}retrieve(e,t={},n){return Je(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}del(e,t){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions`,t)}}class xg extends bd{}vg.PermissionCreateResponsesPage=xg;let kd=class extends he{constructor(){super(...arguments),this.permissions=new vg(this._client)}};kd.Permissions=vg;kd.PermissionCreateResponsesPage=xg;class kg extends he{list(e,t={},n){return Je(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Sg,{query:t,...n})}}class Sg extends ft{}kg.FineTuningJobCheckpointsPage=Sg;class sa extends he{constructor(){super(...arguments),this.checkpoints=new kg(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return Je(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Pg,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return Je(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Eg,{query:t,...n})}}class Pg extends ft{}class Eg extends ft{}sa.FineTuningJobsPage=Pg;sa.FineTuningJobEventsPage=Eg;sa.Checkpoints=kg;sa.FineTuningJobCheckpointsPage=Sg;class ia extends he{constructor(){super(...arguments),this.jobs=new sa(this._client),this.checkpoints=new kd(this._client)}}ia.Jobs=sa;ia.FineTuningJobsPage=Pg;ia.FineTuningJobEventsPage=Eg;ia.Checkpoints=kd;class LS extends he{createVariation(e,t){return this._client.post("/images/variations",zi({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",zi({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}let Ag=class extends he{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Og,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}};class Og extends bd{}Ag.ModelsPage=Og;class jS extends he{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function HM(r,e){return!e||!ZM(e)?{...r,output_parsed:null,output:r.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(n=>({...n,parsed:null}))}:t)}:DS(r,e)}function DS(r,e){const t=r.output.map(s=>{if(s.type==="function_call")return{...s,parsed_arguments:KM(e,s)};if(s.type==="message"){const i=s.content.map(a=>a.type==="output_text"?{...a,parsed:VM(e,a.text)}:a);return{...s,content:i}}return s}),n=Object.assign({},r,{output:t});return Object.getOwnPropertyDescriptor(r,"output_text")||FS(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(const s of n.output)if(s.type==="message"){for(const i of s.content)if(i.type==="output_text"&&i.parsed!==null)return i.parsed}return null}}),n}function VM(r,e){var t,n,s,i;return((n=(t=r.text)==null?void 0:t.format)==null?void 0:n.type)!=="json_schema"?null:"$parseRaw"in((s=r.text)==null?void 0:s.format)?((i=r.text)==null?void 0:i.format).$parseRaw(e):JSON.parse(e)}function ZM(r){var e;return!!lg((e=r.text)==null?void 0:e.format)}function GM(r){return(r==null?void 0:r.$brand)==="auto-parseable-tool"}function JM(r,e){return r.find(t=>t.type==="function"&&t.name===e)}function KM(r,e){const t=JM(r.tools??[],e.name);return{...e,...e,parsed_arguments:GM(t)?t.$parseRaw(e.arguments):t!=null&&t.strict?JSON.parse(e.arguments):null}}function FS(r){const e=[];for(const t of r.output)if(t.type==="message")for(const n of t.content)n.type==="output_text"&&e.push(n.text);r.output_text=e.join("")}class BS extends he{list(e,t={},n){return Je(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,YM,{query:t,...n})}}var di=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},jr=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},hi,ic,Dr,ac,Yy,Qy,ew,tw;class Tg extends og{constructor(e){super(),hi.add(this),ic.set(this,void 0),Dr.set(this,void 0),ac.set(this,void 0),di(this,ic,e,"f")}static createResponse(e,t,n){const s=new Tg(t);return s._run(()=>s._createResponse(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createResponse(e,t,n){var a;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),jr(this,hi,"m",Yy).call(this);const i=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of i)jr(this,hi,"m",Qy).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new qt;return jr(this,hi,"m",ew).call(this)}[(ic=new WeakMap,Dr=new WeakMap,ac=new WeakMap,hi=new WeakSet,Yy=function(){this.ended||di(this,Dr,void 0,"f")},Qy=function(t){if(this.ended)return;const n=jr(this,hi,"m",tw).call(this,t);switch(this._emit("event",t),t.type){case"response.output_text.delta":{const s=n.output[t.output_index];if(!s)throw new te(`missing output at index ${t.output_index}`);if(s.type==="message"){const i=s.content[t.content_index];if(!i)throw new te(`missing content at index ${t.content_index}`);if(i.type!=="output_text")throw new te(`expected content to be 'output_text', got ${i.type}`);this._emit("response.output_text.delta",{...t,snapshot:i.text})}break}case"response.function_call_arguments.delta":{const s=n.output[t.output_index];if(!s)throw new te(`missing output at index ${t.output_index}`);s.type==="function_call"&&this._emit("response.function_call_arguments.delta",{...t,snapshot:s.arguments});break}default:this._emit(t.type,t);break}},ew=function(){if(this.ended)throw new te("stream has ended, this shouldn't happen");const t=jr(this,Dr,"f");if(!t)throw new te("request ended without sending any events");di(this,Dr,void 0,"f");const n=XM(t,jr(this,ic,"f"));return di(this,ac,n,"f"),n},tw=function(t){let n=jr(this,Dr,"f");if(!n){if(t.type!=="response.created")throw new te(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return n=di(this,Dr,t.response,"f"),n}switch(t.type){case"response.output_item.added":{n.output.push(t.item);break}case"response.content_part.added":{const s=n.output[t.output_index];if(!s)throw new te(`missing output at index ${t.output_index}`);s.type==="message"&&s.content.push(t.part);break}case"response.output_text.delta":{const s=n.output[t.output_index];if(!s)throw new te(`missing output at index ${t.output_index}`);if(s.type==="message"){const i=s.content[t.content_index];if(!i)throw new te(`missing content at index ${t.content_index}`);if(i.type!=="output_text")throw new te(`expected content to be 'output_text', got ${i.type}`);i.text+=t.delta}break}case"response.function_call_arguments.delta":{const s=n.output[t.output_index];if(!s)throw new te(`missing output at index ${t.output_index}`);s.type==="function_call"&&(s.arguments+=t.delta);break}case"response.completed":{di(this,Dr,t.response,"f");break}}return n},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=jr(this,ac,"f");if(!e)throw new te("stream ended without producing a ChatCompletion");return e}}function XM(r,e){return HM(r,e)}class Rg extends he{constructor(){super(...arguments),this.inputItems=new BS(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&FS(n),n))}retrieve(e,t={},n){return Je(t)?this.retrieve(e,{},t):this._client.get(`/responses/${e}`,{query:t,...n})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t==null?void 0:t.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(n=>DS(n,e))}stream(e,t){return Tg.createResponse(this._client,e,t)}}class YM extends ft{}Rg.InputItems=BS;class zS extends he{create(e,t,n){return this._client.post(`/uploads/${e}/parts`,zi({body:t,...n}))}}class Cg extends he{constructor(){super(...arguments),this.parts=new zS(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}}Cg.Parts=zS;const QM=async r=>{const e=await Promise.allSettled(r),t=e.filter(s=>s.status==="rejected");if(t.length){for(const s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const n=[];for(const s of e)s.status==="fulfilled"&&n.push(s.value);return n};class Sd extends he{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return Je(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,Pd,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t,n);return await this.poll(e,s.id,n)}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const i=await this.retrieve(e,t,{...n,headers:s}).withResponse(),a=i.data;switch(a.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const l=i.response.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(o=c)}}await ml(o);break;case"failed":case"completed":return a}}}async upload(e,t,n){const s=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:s.id},n)}async uploadAndPoll(e,t,n){const s=await this.upload(e,t,n);return await this.poll(e,s.id,n)}content(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,Ig,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Pd extends ft{}class Ig extends bd{}Sd.VectorStoreFilesPage=Pd;Sd.FileContentResponsesPage=Ig;class US extends he{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t);return await this.poll(e,s.id,n)}listFiles(e,t,n={},s){return Je(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,Pd,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...n,headers:s}).withResponse();switch(i.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const l=a.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(o=c)}}await ml(o);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const i=(s==null?void 0:s.maxConcurrency)??5,a=Math.min(i,t.length),o=this._client,l=t.values(),c=[...n];async function u(h){for(let f of h){const p=await o.files.create({file:f,purpose:"assistants"},s);c.push(p.id)}}const d=Array(a).fill(l).map(u);return await QM(d),await this.createAndPoll(e,{file_ids:c})}}class _s extends he{constructor(){super(...arguments),this.files=new Sd(this._client),this.fileBatches=new US(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return Je(e)?this.list({},e):this._client.getAPIList("/vector_stores",$g,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}search(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/search`,Mg,{body:t,method:"post",...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class $g extends ft{}class Mg extends bd{}_s.VectorStoresPage=$g;_s.VectorStoreSearchResponsesPage=Mg;_s.Files=Sd;_s.VectorStoreFilesPage=Pd;_s.FileContentResponsesPage=Ig;_s.FileBatches=US;var qS;let le=class extends bM{constructor({baseURL:e=ec("OPENAI_BASE_URL"),apiKey:t=ec("OPENAI_API_KEY"),organization:n=ec("OPENAI_ORG_ID")??null,project:s=ec("OPENAI_PROJECT_ID")??null,...i}={}){if(t===void 0)throw new te("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:t,organization:n,project:s,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&OM())throw new te(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new MS(this),this.chat=new vd(this),this.embeddings=new NS(this),this.files=new yg(this),this.images=new LS(this),this.audio=new gl(this),this.moderations=new jS(this),this.models=new Ag(this),this.fineTuning=new ia(this),this.vectorStores=new _s(this),this.beta=new ra(this),this.batches=new rg(this),this.uploads=new Cg(this),this.responses=new Rg(this),this.evals=new wl(this),this._options=a,this.apiKey=t,this.organization=n,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return eM(e,{arrayFormat:"brackets"})}};qS=le;le.OpenAI=qS;le.DEFAULT_TIMEOUT=6e5;le.OpenAIError=te;le.APIError=Zt;le.APIConnectionError=md;le.APIConnectionTimeoutError=pl;le.APIUserAbortError=qt;le.NotFoundError=qk;le.ConflictError=Wk;le.RateLimitError=Vk;le.BadRequestError=Bk;le.AuthenticationError=zk;le.InternalServerError=Zk;le.PermissionDeniedError=Uk;le.UnprocessableEntityError=Hk;le.toFile=Qk;le.fileFromPath=jk;le.Completions=MS;le.Chat=vd;le.ChatCompletionsPage=wd;le.Embeddings=NS;le.Files=yg;le.FileObjectsPage=wg;le.Images=LS;le.Audio=gl;le.Moderations=jS;le.Models=Ag;le.ModelsPage=Og;le.FineTuning=ia;le.VectorStores=_s;le.VectorStoresPage=$g;le.VectorStoreSearchResponsesPage=Mg;le.Beta=ra;le.Batches=rg;le.BatchesPage=sg;le.Uploads=Cg;le.Responses=Rg;le.Evals=wl;le.EvalListResponsesPage=bg;function nw(r,e=Ng){r=r.trim();const t=/```(json)?(.*)```/s.exec(r);return e(t?t[2]:r)}function Ng(r){if(typeof r>"u")return null;try{return JSON.parse(r)}catch{}let e="";const t=[];let n=!1,s=!1;for(let i of r){if(n)i==='"'&&!s?n=!1:i===`
`&&!s?i="\\n":i==="\\"?s=!s:s=!1;else if(i==='"')n=!0,s=!1;else if(i==="{")t.push("}");else if(i==="[")t.push("]");else if(i==="}"||i==="]")if(t&&t[t.length-1]===i)t.pop();else return null;e+=i}n&&(e+='"');for(let i=t.length-1;i>=0;i-=1)e+=t[i];try{return JSON.parse(e)}catch{return null}}var Lh,rw;function eN(){return rw||(rw=1,Lh=function(r,e){if(typeof r!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,r.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}),Lh}var tN=eN();const nN=ta(tN);var oc={exports:{}},sw;function rN(){if(sw)return oc.exports;sw=1;const r=/[\p{Lu}]/u,e=/[\p{Ll}]/u,t=/^[\p{Lu}](?![\p{Lu}])/gu,n=/([\p{Alpha}\p{N}_]|$)/u,s=/[_.\- ]+/,i=new RegExp("^"+s.source),a=new RegExp(s.source+n.source,"gu"),o=new RegExp("\\d+"+n.source,"gu"),l=(h,f,p)=>{let m=!1,g=!1,_=!1;for(let y=0;y<h.length;y++){const b=h[y];m&&r.test(b)?(h=h.slice(0,y)+"-"+h.slice(y),m=!1,_=g,g=!0,y++):g&&_&&e.test(b)?(h=h.slice(0,y-1)+"-"+h.slice(y-1),_=g,g=!1,m=!0):(m=f(b)===b&&p(b)!==b,_=g,g=p(b)===b&&f(b)!==b)}return h},c=(h,f)=>(t.lastIndex=0,h.replace(t,p=>f(p))),u=(h,f)=>(a.lastIndex=0,o.lastIndex=0,h.replace(a,(p,m)=>f(m)).replace(o,p=>f(p))),d=(h,f)=>{if(!(typeof h=="string"||Array.isArray(h)))throw new TypeError("Expected the input to be `string | string[]`");if(f={pascalCase:!1,preserveConsecutiveUppercase:!1,...f},Array.isArray(h)?h=h.map(_=>_.trim()).filter(_=>_.length).join("-"):h=h.trim(),h.length===0)return"";const p=f.locale===!1?_=>_.toLowerCase():_=>_.toLocaleLowerCase(f.locale),m=f.locale===!1?_=>_.toUpperCase():_=>_.toLocaleUpperCase(f.locale);return h.length===1?f.pascalCase?m(h):p(h):(h!==p(h)&&(h=l(h,p,m)),h=h.replace(i,""),f.preserveConsecutiveUppercase?h=c(h,p):h=p(h),f.pascalCase&&(h=m(h.charAt(0))+h.slice(1)),u(h,m))};return oc.exports=d,oc.exports.default=d,oc.exports}rN();function sN(r,e){return(e==null?void 0:e[r])||nN(r)}function iN(r,e,t){const n={};for(const s in r)Object.hasOwn(r,s)&&(n[e(s,t)]=r[s]);return n}function iw(r){return Array.isArray(r)?[...r]:{...r}}function aN(r,e){const t=iw(r);for(const[n,s]of Object.entries(e)){const[i,...a]=n.split(".").reverse();let o=t;for(const l of a.reverse()){if(o[l]===void 0)break;o[l]=iw(o[l]),o=o[l]}o[i]!==void 0&&(o[i]={lc:1,type:"secret",id:[s]})}return t}function WS(r){const e=Object.getPrototypeOf(r);return typeof r.lc_name=="function"&&(typeof e.lc_name!="function"||r.lc_name()!==e.lc_name())?r.lc_name():r.name}class Zs{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,WS(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([n])=>{var s;return(s=this.lc_serializable_keys)==null?void 0:s.includes(n)})):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof Zs||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},n=Object.keys(this.lc_kwargs).reduce((s,i)=>(s[i]=i in this?this[i]:this.lc_kwargs[i],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(t,Reflect.get(s,"lc_secrets",this)),Object.assign(n,Reflect.get(s,"lc_attributes",this));return Object.keys(t).forEach(s=>{let i=this,a=n;const[o,...l]=s.split(".").reverse();for(const c of l.reverse()){if(!(c in i)||i[c]===void 0)return;(!(c in a)||a[c]===void 0)&&(typeof i[c]=="object"&&i[c]!=null?a[c]={}:Array.isArray(i[c])&&(a[c]=[])),i=i[c],a=a[c]}o in i&&i[o]!==void 0&&(a[o]=a[o]||i[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:iN(Object.keys(t).length?aN(n,t):n,sN,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}function aa(r,e){return typeof r=="string"?r===""?e:typeof e=="string"?r+e:[{type:"text",text:r},...e]:Array.isArray(e)?Ed(r,e)??[...r,...e]:e===""?r:[...r,{type:"text",text:e}]}function oN(r,e){return r==="error"||e==="error"?"error":"success"}function lN(r,e){function t(n,s){if(typeof n!="object"||n===null||n===void 0)return n;if(s>=e)return Array.isArray(n)?"[Array]":"[Object]";if(Array.isArray(n))return n.map(a=>t(a,s+1));const i={};for(const a of Object.keys(n))i[a]=t(n[a],s+1);return i}return JSON.stringify(t(r,0),null,2)}class oa extends Zs{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const t=lN(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}}function Ct(r,e){const t={...r};for(const[n,s]of Object.entries(e))if(t[n]==null)t[n]=s;else{if(s==null)continue;if(typeof t[n]!=typeof s||Array.isArray(t[n])!==Array.isArray(s))throw new Error(`field[${n}] already exists in the message chunk, but with a different type.`);if(typeof t[n]=="string"){if(n==="type")continue;t[n]+=s}else if(typeof t[n]=="object"&&!Array.isArray(t[n]))t[n]=Ct(t[n],s);else if(Array.isArray(t[n]))t[n]=Ed(t[n],s);else{if(t[n]===s)continue;console.warn(`field[${n}] already exists in this message chunk and value has unsupported type.`)}}return t}function Ed(r,e){if(!(r===void 0&&e===void 0)){if(r===void 0||e===void 0)return r||e;{const t=[...r];for(const n of e)if(typeof n=="object"&&"index"in n&&typeof n.index=="number"){const s=t.findIndex(i=>i.index===n.index);s!==-1?t[s]=Ct(t[s],n):t.push(n)}else{if(typeof n=="object"&&"text"in n&&n.text==="")continue;t.push(n)}return t}}}function cN(r,e){if(!r&&!e)throw new Error("Cannot merge two undefined objects.");if(!r||!e)return r||e;if(typeof r!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof r}
Right ${typeof e}`);if(typeof r=="string"&&typeof e=="string")return r+e;if(Array.isArray(r)&&Array.isArray(e))return Ed(r,e);if(typeof r=="object"&&typeof e=="object")return Ct(r,e);if(r===e)return r;throw new Error(`Can not merge objects of different types.
Left ${r}
Right ${e}`)}class la extends oa{}function uN(r){return typeof r.role=="string"}function Ad(r){return typeof(r==null?void 0:r._getType)=="function"}function dN(r){return Ad(r)&&typeof r.concat=="function"}class hN extends oa{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,n){typeof e=="string"&&(e={content:e,name:n,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}class Od extends la{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new Od({content:aa(this.content,e.content),additional_kwargs:Ct(this.additional_kwargs,e.additional_kwargs),response_metadata:Ct(this.response_metadata,e.response_metadata),artifact:cN(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:oN(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}function fN(r){const e=[],t=[];for(const n of r)if(n.function){const s=n.function.name;try{const i=JSON.parse(n.function.arguments),a={name:s||"",args:i||{},id:n.id};e.push(a)}catch{t.push({name:s,args:n.function.arguments,id:n.id,error:"Malformed args."})}}else continue;return[e,t]}class or extends oa{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){var s;let n;if(typeof e=="string")n={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{n=e;const i=(s=n.additional_kwargs)==null?void 0:s.tool_calls,a=n.tool_calls;i!=null&&i.length>0&&(a===void 0||a.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(i!=null&&a===void 0){const[o,l]=fN(i);n.tool_calls=o??[],n.invalid_tool_calls=l??[]}else n.tool_calls=n.tool_calls??[],n.invalid_tool_calls=n.invalid_tool_calls??[]}catch{n.tool_calls=[],n.invalid_tool_calls=[]}}super(n),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof n!="string"&&(this.tool_calls=n.tool_calls??this.tool_calls,this.invalid_tool_calls=n.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=n.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}function Mr(r){return r._getType()==="ai"}function aw(r){return r._getType()==="ai"}class Ze extends la{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{const n=[],s=[];for(const i of e.tool_call_chunks){let a={};try{if(a=Ng(i.args||"{}"),a===null||typeof a!="object"||Array.isArray(a))throw new Error("Malformed tool call chunk args.");n.push({name:i.name??"",args:a,id:i.id,type:"tool_call"})}catch{s.push({name:i.name,args:i.args,id:i.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:n,invalid_tool_calls:s,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){var n,s,i,a,o,l,c,u,d,h,f,p,m,g,_,y,b,w,v,S,k,x,A,C,I,D,Y,O,E,$,N,R,F,V,ne,J,K,z,Q,be;const t={content:aa(this.content,e.content),additional_kwargs:Ct(this.additional_kwargs,e.additional_kwargs),response_metadata:Ct(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const fe=Ed(this.tool_call_chunks,e.tool_call_chunks);fe!==void 0&&fe.length>0&&(t.tool_call_chunks=fe)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){const fe={...(((s=(n=this.usage_metadata)==null?void 0:n.input_token_details)==null?void 0:s.audio)!==void 0||((a=(i=e.usage_metadata)==null?void 0:i.input_token_details)==null?void 0:a.audio)!==void 0)&&{audio:(((l=(o=this.usage_metadata)==null?void 0:o.input_token_details)==null?void 0:l.audio)??0)+(((u=(c=e.usage_metadata)==null?void 0:c.input_token_details)==null?void 0:u.audio)??0)},...(((h=(d=this.usage_metadata)==null?void 0:d.input_token_details)==null?void 0:h.cache_read)!==void 0||((p=(f=e.usage_metadata)==null?void 0:f.input_token_details)==null?void 0:p.cache_read)!==void 0)&&{cache_read:(((g=(m=this.usage_metadata)==null?void 0:m.input_token_details)==null?void 0:g.cache_read)??0)+(((y=(_=e.usage_metadata)==null?void 0:_.input_token_details)==null?void 0:y.cache_read)??0)},...(((w=(b=this.usage_metadata)==null?void 0:b.input_token_details)==null?void 0:w.cache_creation)!==void 0||((S=(v=e.usage_metadata)==null?void 0:v.input_token_details)==null?void 0:S.cache_creation)!==void 0)&&{cache_creation:(((x=(k=this.usage_metadata)==null?void 0:k.input_token_details)==null?void 0:x.cache_creation)??0)+(((C=(A=e.usage_metadata)==null?void 0:A.input_token_details)==null?void 0:C.cache_creation)??0)}},vn={...(((D=(I=this.usage_metadata)==null?void 0:I.output_token_details)==null?void 0:D.audio)!==void 0||((O=(Y=e.usage_metadata)==null?void 0:Y.output_token_details)==null?void 0:O.audio)!==void 0)&&{audio:((($=(E=this.usage_metadata)==null?void 0:E.output_token_details)==null?void 0:$.audio)??0)+(((R=(N=e.usage_metadata)==null?void 0:N.output_token_details)==null?void 0:R.audio)??0)},...(((V=(F=this.usage_metadata)==null?void 0:F.output_token_details)==null?void 0:V.reasoning)!==void 0||((J=(ne=e.usage_metadata)==null?void 0:ne.output_token_details)==null?void 0:J.reasoning)!==void 0)&&{reasoning:(((z=(K=this.usage_metadata)==null?void 0:K.output_token_details)==null?void 0:z.reasoning)??0)+(((be=(Q=e.usage_metadata)==null?void 0:Q.output_token_details)==null?void 0:be.reasoning)??0)}},Gt=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},Lt=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},ys={input_tokens:Gt.input_tokens+Lt.input_tokens,output_tokens:Gt.output_tokens+Lt.output_tokens,total_tokens:Gt.total_tokens+Lt.total_tokens,...Object.keys(fe).length>0&&{input_token_details:fe},...Object.keys(vn).length>0&&{output_token_details:vn}};t.usage_metadata=ys}return new Ze(t)}}class ti extends oa{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return ti}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}}class vl extends la{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new vl({content:aa(this.content,e.content),additional_kwargs:Ct(this.additional_kwargs,e.additional_kwargs),response_metadata:Ct(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}class xl extends la{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new xl({content:aa(this.content,e.content),additional_kwargs:Ct(this.additional_kwargs,e.additional_kwargs),response_metadata:Ct(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}class Ui extends oa{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class kl extends la{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new kl({content:aa(this.content,e.content),additional_kwargs:Ct(this.additional_kwargs,e.additional_kwargs),response_metadata:Ct(this.response_metadata,e.response_metadata),id:this.id??e.id})}}class ow extends oa{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class Gs extends la{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new Gs({content:aa(this.content,e.content),additional_kwargs:Ct(this.additional_kwargs,e.additional_kwargs),response_metadata:Ct(this.response_metadata,e.response_metadata),id:this.id??e.id})}}function HS(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function VS(r){return!!(r&&typeof r=="object"&&"type"in r&&r.type==="tool_call")}class pN extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}function mN(r){return VS(r)?r:typeof r.id=="string"&&r.type==="function"&&typeof r.function=="object"&&r.function!==null&&"arguments"in r.function&&typeof r.function.arguments=="string"&&"name"in r.function&&typeof r.function.name=="string"?{id:r.id,args:JSON.parse(r.function.arguments),name:r.function.name,type:"tool_call"}:r}function gN(r){return typeof r=="object"&&r!=null&&r.lc===1&&Array.isArray(r.id)&&r.kwargs!=null&&typeof r.kwargs=="object"}function jh(r){let e,t;if(gN(r)){const n=r.id.at(-1);n==="HumanMessage"||n==="HumanMessageChunk"?e="user":n==="AIMessage"||n==="AIMessageChunk"?e="assistant":n==="SystemMessage"||n==="SystemMessageChunk"?e="system":n==="FunctionMessage"||n==="FunctionMessageChunk"?e="function":n==="ToolMessage"||n==="ToolMessageChunk"?e="tool":e="unknown",t=r.kwargs}else{const{type:n,...s}=r;e=n,t=s}if(e==="human"||e==="user")return new Ui(t);if(e==="ai"||e==="assistant"){const{tool_calls:n,...s}=t;if(!Array.isArray(n))return new or(t);const i=n.map(mN);return new or({...s,tool_calls:i})}else{if(e==="system")return new ow(t);if(e==="developer")return new ow({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in t)return new hN({...t,content:t.content,tool_call_id:t.tool_call_id,name:t.name});throw HS(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(r,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function eo(r){if(typeof r=="string")return new Ui(r);if(Ad(r))return r;if(Array.isArray(r)){const[e,t]=r;return jh({type:e,content:t})}else if(uN(r)){const{role:e,...t}=r;return jh({...t,type:e})}else return jh(r)}function ZS(r,e="Human",t="AI"){const n=[];for(const s of r){let i;if(s._getType()==="human")i=e;else if(s._getType()==="ai")i=t;else if(s._getType()==="system")i="System";else if(s._getType()==="function")i="Function";else if(s._getType()==="tool")i="Tool";else if(s._getType()==="generic")i=s.role;else throw new Error(`Got unsupported message type: ${s._getType()}`);const a=s.name?`${s.name}, `:"",o=typeof s.content=="string"?s.content:JSON.stringify(s.content,null,2);n.push(`${i}: ${a}${o}`)}return n.join(`
`)}function _N(r){var t;const e=r._getType();if(e==="human")return new kl({...r});if(e==="ai"){let n={...r};return"tool_calls"in n&&(n={...n,tool_call_chunks:(t=n.tool_calls)==null?void 0:t.map(s=>({...s,type:"tool_call_chunk",index:void 0,args:JSON.stringify(s.args)}))}),new Ze({...n})}else{if(e==="system")return new Gs({...r});if(e==="function")return new xl({...r});if(ti.isInstance(r))return new vl({...r});throw new Error("Unknown message type.")}}var xe;(function(r){r.assertEqual=s=>s;function e(s){}r.assertIs=e;function t(s){throw new Error}r.assertNever=t,r.arrayToEnum=s=>{const i={};for(const a of s)i[a]=a;return i},r.getValidEnumValues=s=>{const i=r.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),a={};for(const o of i)a[o]=s[o];return r.objectValues(a)},r.objectValues=s=>r.objectKeys(s).map(function(i){return s[i]}),r.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const i=[];for(const a in s)Object.prototype.hasOwnProperty.call(s,a)&&i.push(a);return i},r.find=(s,i)=>{for(const a of s)if(i(a))return a},r.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function n(s,i=" | "){return s.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}r.joinValues=n,r.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(xe||(xe={}));var rm;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(rm||(rm={}));const q=xe.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),xr=r=>{switch(typeof r){case"undefined":return q.undefined;case"string":return q.string;case"number":return isNaN(r)?q.nan:q.number;case"boolean":return q.boolean;case"function":return q.function;case"bigint":return q.bigint;case"symbol":return q.symbol;case"object":return Array.isArray(r)?q.array:r===null?q.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?q.promise:typeof Map<"u"&&r instanceof Map?q.map:typeof Set<"u"&&r instanceof Set?q.set:typeof Date<"u"&&r instanceof Date?q.date:q.object;default:return q.unknown}},j=xe.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),bN=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:");class on extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(i){return i.message},n={_errors:[]},s=i=>{for(const a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)n._errors.push(t(a));else{let o=n,l=0;for(;l<a.path.length;){const c=a.path[l];l===a.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(a))):o[c]=o[c]||{_errors:[]},o=o[c],l++}}};return s(this),n}static assert(e){if(!(e instanceof on))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,xe.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},n=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):n.push(e(s));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}on.create=r=>new on(r);const qi=(r,e)=>{let t;switch(r.code){case j.invalid_type:r.received===q.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case j.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,xe.jsonStringifyReplacer)}`;break;case j.unrecognized_keys:t=`Unrecognized key(s) in object: ${xe.joinValues(r.keys,", ")}`;break;case j.invalid_union:t="Invalid input";break;case j.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${xe.joinValues(r.options)}`;break;case j.invalid_enum_value:t=`Invalid enum value. Expected ${xe.joinValues(r.options)}, received '${r.received}'`;break;case j.invalid_arguments:t="Invalid function arguments";break;case j.invalid_return_type:t="Invalid function return type";break;case j.invalid_date:t="Invalid date";break;case j.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:xe.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case j.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case j.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case j.custom:t="Invalid input";break;case j.invalid_intersection_types:t="Intersection results could not be merged";break;case j.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case j.not_finite:t="Number must be finite";break;default:t=e.defaultError,xe.assertNever(r)}return{message:t}};let GS=qi;function yN(r){GS=r}function ku(){return GS}const Su=r=>{const{data:e,path:t,errorMaps:n,issueData:s}=r,i=[...t,...s.path||[]],a={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let o="";const l=n.filter(c=>!!c).slice().reverse();for(const c of l)o=c(a,{data:e,defaultError:o}).message;return{...s,path:i,message:o}},wN=[];function U(r,e){const t=ku(),n=Su({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===qi?void 0:qi].filter(s=>!!s)});r.common.issues.push(n)}class xt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const s of t){if(s.status==="aborted")return re;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const s of t){const i=await s.key,a=await s.value;n.push({key:i,value:a})}return xt.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const s of t){const{key:i,value:a}=s;if(i.status==="aborted"||a.status==="aborted")return re;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value<"u"||s.alwaysSet)&&(n[i.value]=a.value)}return{status:e.value,value:n}}}const re=Object.freeze({status:"aborted"}),xi=r=>({status:"dirty",value:r}),It=r=>({status:"valid",value:r}),sm=r=>r.status==="aborted",im=r=>r.status==="dirty",Js=r=>r.status==="valid",Do=r=>typeof Promise<"u"&&r instanceof Promise;function Pu(r,e,t,n){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(r)}function JS(r,e,t,n,s){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t}var G;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(G||(G={}));var to,no;class lr{constructor(e,t,n,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const lw=(r,e)=>{if(Js(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new on(r.common.issues);return this._error=t,this._error}}};function oe(r){if(!r)return{};const{errorMap:e,invalid_type_error:t,required_error:n,description:s}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(a,o)=>{var l,c;const{message:u}=r;return a.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:(l=u??n)!==null&&l!==void 0?l:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(c=u??t)!==null&&c!==void 0?c:o.defaultError}},description:s}}class de{get description(){return this._def.description}_getType(e){return xr(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:xr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new xt,ctx:{common:e.parent.common,data:e.data,parsedType:xr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Do(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;const s={common:{issues:[],async:(n=t==null?void 0:t.async)!==null&&n!==void 0?n:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:xr(e)},i=this._parseSync({data:e,path:s.path,parent:s});return lw(s,i)}"~validate"(e){var t,n;const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:xr(e)};if(!this["~standard"].async)try{const i=this._parseSync({data:e,path:[],parent:s});return Js(i)?{value:i.value}:{issues:s.common.issues}}catch(i){!((n=(t=i==null?void 0:i.message)===null||t===void 0?void 0:t.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:s}).then(i=>Js(i)?{value:i.value}:{issues:s.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:xr(e)},s=this._parse({data:e,path:n.path,parent:n}),i=await(Do(s)?s:Promise.resolve(s));return lw(n,i)}refine(e,t){const n=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{const a=e(s),o=()=>i.addIssue({code:j.custom,...n(s)});return typeof Promise<"u"&&a instanceof Promise?a.then(l=>l?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof t=="function"?t(n,s):t),!1))}_refinement(e){return new Bn({schema:this,typeName:T.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return jn.create(this,this._def)}nullable(){return us.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ln.create(this)}promise(){return Hi.create(this,this._def)}or(e){return Uo.create([this,e],this._def)}and(e){return qo.create(this,e,this._def)}transform(e){return new Bn({...oe(this._def),schema:this,typeName:T.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Go({...oe(this._def),innerType:this,defaultValue:t,typeName:T.ZodDefault})}brand(){return new Lg({typeName:T.ZodBranded,type:this,...oe(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Jo({...oe(this._def),innerType:this,catchValue:t,typeName:T.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Sl.create(this,e)}readonly(){return Ko.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const vN=/^c[^\s-]{8,}$/i,xN=/^[0-9a-z]+$/,kN=/^[0-9A-HJKMNP-TV-Z]{26}$/i,SN=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,PN=/^[a-z0-9_-]{21}$/i,EN=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,AN=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,ON=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,TN="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Dh;const RN=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,CN=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,IN=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,$N=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,MN=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,NN=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,KS="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",LN=new RegExp(`^${KS}$`);function XS(r){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`),e}function jN(r){return new RegExp(`^${XS(r)}$`)}function YS(r){let e=`${KS}T${XS(r)}`;const t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function DN(r,e){return!!((e==="v4"||!e)&&RN.test(r)||(e==="v6"||!e)&&IN.test(r))}function FN(r,e){if(!EN.test(r))return!1;try{const[t]=r.split("."),n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(n));return!(typeof s!="object"||s===null||!s.typ||!s.alg||e&&s.alg!==e)}catch{return!1}}function BN(r,e){return!!((e==="v4"||!e)&&CN.test(r)||(e==="v6"||!e)&&$N.test(r))}class In extends de{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==q.string){const i=this._getOrReturnCtx(e);return U(i,{code:j.invalid_type,expected:q.string,received:i.parsedType}),re}const n=new xt;let s;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),U(s,{code:j.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),U(s,{code:j.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="length"){const a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(s=this._getOrReturnCtx(e,s),a?U(s,{code:j.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&U(s,{code:j.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),n.dirty())}else if(i.kind==="email")ON.test(e.data)||(s=this._getOrReturnCtx(e,s),U(s,{validation:"email",code:j.invalid_string,message:i.message}),n.dirty());else if(i.kind==="emoji")Dh||(Dh=new RegExp(TN,"u")),Dh.test(e.data)||(s=this._getOrReturnCtx(e,s),U(s,{validation:"emoji",code:j.invalid_string,message:i.message}),n.dirty());else if(i.kind==="uuid")SN.test(e.data)||(s=this._getOrReturnCtx(e,s),U(s,{validation:"uuid",code:j.invalid_string,message:i.message}),n.dirty());else if(i.kind==="nanoid")PN.test(e.data)||(s=this._getOrReturnCtx(e,s),U(s,{validation:"nanoid",code:j.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid")vN.test(e.data)||(s=this._getOrReturnCtx(e,s),U(s,{validation:"cuid",code:j.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid2")xN.test(e.data)||(s=this._getOrReturnCtx(e,s),U(s,{validation:"cuid2",code:j.invalid_string,message:i.message}),n.dirty());else if(i.kind==="ulid")kN.test(e.data)||(s=this._getOrReturnCtx(e,s),U(s,{validation:"ulid",code:j.invalid_string,message:i.message}),n.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),U(s,{validation:"url",code:j.invalid_string,message:i.message}),n.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),U(s,{validation:"regex",code:j.invalid_string,message:i.message}),n.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),U(s,{code:j.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),n.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),U(s,{code:j.invalid_string,validation:{startsWith:i.value},message:i.message}),n.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),U(s,{code:j.invalid_string,validation:{endsWith:i.value},message:i.message}),n.dirty()):i.kind==="datetime"?YS(i).test(e.data)||(s=this._getOrReturnCtx(e,s),U(s,{code:j.invalid_string,validation:"datetime",message:i.message}),n.dirty()):i.kind==="date"?LN.test(e.data)||(s=this._getOrReturnCtx(e,s),U(s,{code:j.invalid_string,validation:"date",message:i.message}),n.dirty()):i.kind==="time"?jN(i).test(e.data)||(s=this._getOrReturnCtx(e,s),U(s,{code:j.invalid_string,validation:"time",message:i.message}),n.dirty()):i.kind==="duration"?AN.test(e.data)||(s=this._getOrReturnCtx(e,s),U(s,{validation:"duration",code:j.invalid_string,message:i.message}),n.dirty()):i.kind==="ip"?DN(e.data,i.version)||(s=this._getOrReturnCtx(e,s),U(s,{validation:"ip",code:j.invalid_string,message:i.message}),n.dirty()):i.kind==="jwt"?FN(e.data,i.alg)||(s=this._getOrReturnCtx(e,s),U(s,{validation:"jwt",code:j.invalid_string,message:i.message}),n.dirty()):i.kind==="cidr"?BN(e.data,i.version)||(s=this._getOrReturnCtx(e,s),U(s,{validation:"cidr",code:j.invalid_string,message:i.message}),n.dirty()):i.kind==="base64"?MN.test(e.data)||(s=this._getOrReturnCtx(e,s),U(s,{validation:"base64",code:j.invalid_string,message:i.message}),n.dirty()):i.kind==="base64url"?NN.test(e.data)||(s=this._getOrReturnCtx(e,s),U(s,{validation:"base64url",code:j.invalid_string,message:i.message}),n.dirty()):xe.assertNever(i);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(s=>e.test(s),{validation:t,code:j.invalid_string,...G.errToObj(n)})}_addCheck(e){return new In({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...G.errToObj(e)})}url(e){return this._addCheck({kind:"url",...G.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...G.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...G.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...G.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...G.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...G.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...G.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...G.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...G.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...G.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...G.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...G.errToObj(e)})}datetime(e){var t,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(n=e==null?void 0:e.local)!==null&&n!==void 0?n:!1,...G.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...G.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...G.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...G.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...G.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...G.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...G.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...G.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...G.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...G.errToObj(t)})}nonempty(e){return this.min(1,G.errToObj(e))}trim(){return new In({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new In({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new In({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}In.create=r=>{var e;return new In({checks:[],typeName:T.ZodString,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...oe(r)})};function zN(r,e){const t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=t>n?t:n,i=parseInt(r.toFixed(s).replace(".","")),a=parseInt(e.toFixed(s).replace(".",""));return i%a/Math.pow(10,s)}class os extends de{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==q.number){const i=this._getOrReturnCtx(e);return U(i,{code:j.invalid_type,expected:q.number,received:i.parsedType}),re}let n;const s=new xt;for(const i of this._def.checks)i.kind==="int"?xe.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),U(n,{code:j.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),U(n,{code:j.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),U(n,{code:j.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?zN(e.data,i.value)!==0&&(n=this._getOrReturnCtx(e,n),U(n,{code:j.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),U(n,{code:j.not_finite,message:i.message}),s.dirty()):xe.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,G.toString(t))}gt(e,t){return this.setLimit("min",e,!1,G.toString(t))}lte(e,t){return this.setLimit("max",e,!0,G.toString(t))}lt(e,t){return this.setLimit("max",e,!1,G.toString(t))}setLimit(e,t,n,s){return new os({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:G.toString(s)}]})}_addCheck(e){return new os({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:G.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:G.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:G.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:G.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:G.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:G.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:G.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:G.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:G.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&xe.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}os.create=r=>new os({checks:[],typeName:T.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...oe(r)});class ls extends de{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==q.bigint)return this._getInvalidInput(e);let n;const s=new xt;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),U(n,{code:j.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),U(n,{code:j.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),U(n,{code:j.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):xe.assertNever(i);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return U(t,{code:j.invalid_type,expected:q.bigint,received:t.parsedType}),re}gte(e,t){return this.setLimit("min",e,!0,G.toString(t))}gt(e,t){return this.setLimit("min",e,!1,G.toString(t))}lte(e,t){return this.setLimit("max",e,!0,G.toString(t))}lt(e,t){return this.setLimit("max",e,!1,G.toString(t))}setLimit(e,t,n,s){return new ls({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:G.toString(s)}]})}_addCheck(e){return new ls({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:G.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:G.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:G.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:G.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:G.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}ls.create=r=>{var e;return new ls({checks:[],typeName:T.ZodBigInt,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...oe(r)})};class Fo extends de{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==q.boolean){const n=this._getOrReturnCtx(e);return U(n,{code:j.invalid_type,expected:q.boolean,received:n.parsedType}),re}return It(e.data)}}Fo.create=r=>new Fo({typeName:T.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...oe(r)});class Ks extends de{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==q.date){const i=this._getOrReturnCtx(e);return U(i,{code:j.invalid_type,expected:q.date,received:i.parsedType}),re}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return U(i,{code:j.invalid_date}),re}const n=new xt;let s;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),U(s,{code:j.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),n.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),U(s,{code:j.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),n.dirty()):xe.assertNever(i);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Ks({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:G.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:G.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}Ks.create=r=>new Ks({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:T.ZodDate,...oe(r)});class Eu extends de{_parse(e){if(this._getType(e)!==q.symbol){const n=this._getOrReturnCtx(e);return U(n,{code:j.invalid_type,expected:q.symbol,received:n.parsedType}),re}return It(e.data)}}Eu.create=r=>new Eu({typeName:T.ZodSymbol,...oe(r)});class Bo extends de{_parse(e){if(this._getType(e)!==q.undefined){const n=this._getOrReturnCtx(e);return U(n,{code:j.invalid_type,expected:q.undefined,received:n.parsedType}),re}return It(e.data)}}Bo.create=r=>new Bo({typeName:T.ZodUndefined,...oe(r)});class zo extends de{_parse(e){if(this._getType(e)!==q.null){const n=this._getOrReturnCtx(e);return U(n,{code:j.invalid_type,expected:q.null,received:n.parsedType}),re}return It(e.data)}}zo.create=r=>new zo({typeName:T.ZodNull,...oe(r)});class Wi extends de{constructor(){super(...arguments),this._any=!0}_parse(e){return It(e.data)}}Wi.create=r=>new Wi({typeName:T.ZodAny,...oe(r)});class Fs extends de{constructor(){super(...arguments),this._unknown=!0}_parse(e){return It(e.data)}}Fs.create=r=>new Fs({typeName:T.ZodUnknown,...oe(r)});class Cr extends de{_parse(e){const t=this._getOrReturnCtx(e);return U(t,{code:j.invalid_type,expected:q.never,received:t.parsedType}),re}}Cr.create=r=>new Cr({typeName:T.ZodNever,...oe(r)});class Au extends de{_parse(e){if(this._getType(e)!==q.undefined){const n=this._getOrReturnCtx(e);return U(n,{code:j.invalid_type,expected:q.void,received:n.parsedType}),re}return It(e.data)}}Au.create=r=>new Au({typeName:T.ZodVoid,...oe(r)});class Ln extends de{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),s=this._def;if(t.parsedType!==q.array)return U(t,{code:j.invalid_type,expected:q.array,received:t.parsedType}),re;if(s.exactLength!==null){const a=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(a||o)&&(U(t,{code:a?j.too_big:j.too_small,minimum:o?s.exactLength.value:void 0,maximum:a?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(U(t,{code:j.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(U(t,{code:j.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>s.type._parseAsync(new lr(t,a,t.path,o)))).then(a=>xt.mergeArray(n,a));const i=[...t.data].map((a,o)=>s.type._parseSync(new lr(t,a,t.path,o)));return xt.mergeArray(n,i)}get element(){return this._def.type}min(e,t){return new Ln({...this._def,minLength:{value:e,message:G.toString(t)}})}max(e,t){return new Ln({...this._def,maxLength:{value:e,message:G.toString(t)}})}length(e,t){return new Ln({...this._def,exactLength:{value:e,message:G.toString(t)}})}nonempty(e){return this.min(1,e)}}Ln.create=(r,e)=>new Ln({type:r,minLength:null,maxLength:null,exactLength:null,typeName:T.ZodArray,...oe(e)});function bi(r){if(r instanceof Ve){const e={};for(const t in r.shape){const n=r.shape[t];e[t]=jn.create(bi(n))}return new Ve({...r._def,shape:()=>e})}else return r instanceof Ln?new Ln({...r._def,type:bi(r.element)}):r instanceof jn?jn.create(bi(r.unwrap())):r instanceof us?us.create(bi(r.unwrap())):r instanceof cr?cr.create(r.items.map(e=>bi(e))):r}class Ve extends de{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=xe.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==q.object){const c=this._getOrReturnCtx(e);return U(c,{code:j.invalid_type,expected:q.object,received:c.parsedType}),re}const{status:n,ctx:s}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof Cr&&this._def.unknownKeys==="strip"))for(const c in s.data)a.includes(c)||o.push(c);const l=[];for(const c of a){const u=i[c],d=s.data[c];l.push({key:{status:"valid",value:c},value:u._parse(new lr(s,d,s.path,c)),alwaysSet:c in s.data})}if(this._def.catchall instanceof Cr){const c=this._def.unknownKeys;if(c==="passthrough")for(const u of o)l.push({key:{status:"valid",value:u},value:{status:"valid",value:s.data[u]}});else if(c==="strict")o.length>0&&(U(s,{code:j.unrecognized_keys,keys:o}),n.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const u of o){const d=s.data[u];l.push({key:{status:"valid",value:u},value:c._parse(new lr(s,d,s.path,u)),alwaysSet:u in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const c=[];for(const u of l){const d=await u.key,h=await u.value;c.push({key:d,value:h,alwaysSet:u.alwaysSet})}return c}).then(c=>xt.mergeObjectSync(n,c)):xt.mergeObjectSync(n,l)}get shape(){return this._def.shape()}strict(e){return G.errToObj,new Ve({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var s,i,a,o;const l=(a=(i=(s=this._def).errorMap)===null||i===void 0?void 0:i.call(s,t,n).message)!==null&&a!==void 0?a:n.defaultError;return t.code==="unrecognized_keys"?{message:(o=G.errToObj(e).message)!==null&&o!==void 0?o:l}:{message:l}}}:{}})}strip(){return new Ve({...this._def,unknownKeys:"strip"})}passthrough(){return new Ve({...this._def,unknownKeys:"passthrough"})}extend(e){return new Ve({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Ve({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:T.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Ve({...this._def,catchall:e})}pick(e){const t={};return xe.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])}),new Ve({...this._def,shape:()=>t})}omit(e){const t={};return xe.objectKeys(this.shape).forEach(n=>{e[n]||(t[n]=this.shape[n])}),new Ve({...this._def,shape:()=>t})}deepPartial(){return bi(this)}partial(e){const t={};return xe.objectKeys(this.shape).forEach(n=>{const s=this.shape[n];e&&!e[n]?t[n]=s:t[n]=s.optional()}),new Ve({...this._def,shape:()=>t})}required(e){const t={};return xe.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])t[n]=this.shape[n];else{let i=this.shape[n];for(;i instanceof jn;)i=i._def.innerType;t[n]=i}}),new Ve({...this._def,shape:()=>t})}keyof(){return QS(xe.objectKeys(this.shape))}}Ve.create=(r,e)=>new Ve({shape:()=>r,unknownKeys:"strip",catchall:Cr.create(),typeName:T.ZodObject,...oe(e)});Ve.strictCreate=(r,e)=>new Ve({shape:()=>r,unknownKeys:"strict",catchall:Cr.create(),typeName:T.ZodObject,...oe(e)});Ve.lazycreate=(r,e)=>new Ve({shape:r,unknownKeys:"strip",catchall:Cr.create(),typeName:T.ZodObject,...oe(e)});class Uo extends de{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;function s(i){for(const o of i)if(o.result.status==="valid")return o.result;for(const o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const a=i.map(o=>new on(o.ctx.common.issues));return U(t,{code:j.invalid_union,unionErrors:a}),re}if(t.common.async)return Promise.all(n.map(async i=>{const a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(s);{let i;const a=[];for(const l of n){const c={...t,common:{...t.common,issues:[]},parent:null},u=l._parseSync({data:t.data,path:t.path,parent:c});if(u.status==="valid")return u;u.status==="dirty"&&!i&&(i={result:u,ctx:c}),c.common.issues.length&&a.push(c.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const o=a.map(l=>new on(l));return U(t,{code:j.invalid_union,unionErrors:o}),re}}get options(){return this._def.options}}Uo.create=(r,e)=>new Uo({options:r,typeName:T.ZodUnion,...oe(e)});const yr=r=>r instanceof Ho?yr(r.schema):r instanceof Bn?yr(r.innerType()):r instanceof Vo?[r.value]:r instanceof cs?r.options:r instanceof Zo?xe.objectValues(r.enum):r instanceof Go?yr(r._def.innerType):r instanceof Bo?[void 0]:r instanceof zo?[null]:r instanceof jn?[void 0,...yr(r.unwrap())]:r instanceof us?[null,...yr(r.unwrap())]:r instanceof Lg||r instanceof Ko?yr(r.unwrap()):r instanceof Jo?yr(r._def.innerType):[];class Td extends de{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==q.object)return U(t,{code:j.invalid_type,expected:q.object,received:t.parsedType}),re;const n=this.discriminator,s=t.data[n],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(U(t,{code:j.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),re)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){const s=new Map;for(const i of t){const a=yr(i.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of a){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,i)}}return new Td({typeName:T.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...oe(n)})}}function am(r,e){const t=xr(r),n=xr(e);if(r===e)return{valid:!0,data:r};if(t===q.object&&n===q.object){const s=xe.objectKeys(e),i=xe.objectKeys(r).filter(o=>s.indexOf(o)!==-1),a={...r,...e};for(const o of i){const l=am(r[o],e[o]);if(!l.valid)return{valid:!1};a[o]=l.data}return{valid:!0,data:a}}else if(t===q.array&&n===q.array){if(r.length!==e.length)return{valid:!1};const s=[];for(let i=0;i<r.length;i++){const a=r[i],o=e[i],l=am(a,o);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return t===q.date&&n===q.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class qo extends de{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=(i,a)=>{if(sm(i)||sm(a))return re;const o=am(i.value,a.value);return o.valid?((im(i)||im(a))&&t.dirty(),{status:t.value,value:o.data}):(U(n,{code:j.invalid_intersection_types}),re)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([i,a])=>s(i,a)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}qo.create=(r,e,t)=>new qo({left:r,right:e,typeName:T.ZodIntersection,...oe(t)});class cr extends de{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==q.array)return U(n,{code:j.invalid_type,expected:q.array,received:n.parsedType}),re;if(n.data.length<this._def.items.length)return U(n,{code:j.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),re;!this._def.rest&&n.data.length>this._def.items.length&&(U(n,{code:j.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...n.data].map((a,o)=>{const l=this._def.items[o]||this._def.rest;return l?l._parse(new lr(n,a,n.path,o)):null}).filter(a=>!!a);return n.common.async?Promise.all(i).then(a=>xt.mergeArray(t,a)):xt.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new cr({...this._def,rest:e})}}cr.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new cr({items:r,typeName:T.ZodTuple,rest:null,...oe(e)})};class Wo extends de{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==q.object)return U(n,{code:j.invalid_type,expected:q.object,received:n.parsedType}),re;const s=[],i=this._def.keyType,a=this._def.valueType;for(const o in n.data)s.push({key:i._parse(new lr(n,o,n.path,o)),value:a._parse(new lr(n,n.data[o],n.path,o)),alwaysSet:o in n.data});return n.common.async?xt.mergeObjectAsync(t,s):xt.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof de?new Wo({keyType:e,valueType:t,typeName:T.ZodRecord,...oe(n)}):new Wo({keyType:In.create(),valueType:e,typeName:T.ZodRecord,...oe(t)})}}class Ou extends de{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==q.map)return U(n,{code:j.invalid_type,expected:q.map,received:n.parsedType}),re;const s=this._def.keyType,i=this._def.valueType,a=[...n.data.entries()].map(([o,l],c)=>({key:s._parse(new lr(n,o,n.path,[c,"key"])),value:i._parse(new lr(n,l,n.path,[c,"value"]))}));if(n.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const l of a){const c=await l.key,u=await l.value;if(c.status==="aborted"||u.status==="aborted")return re;(c.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(c.value,u.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const l of a){const c=l.key,u=l.value;if(c.status==="aborted"||u.status==="aborted")return re;(c.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(c.value,u.value)}return{status:t.value,value:o}}}}Ou.create=(r,e,t)=>new Ou({valueType:e,keyType:r,typeName:T.ZodMap,...oe(t)});class Xs extends de{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==q.set)return U(n,{code:j.invalid_type,expected:q.set,received:n.parsedType}),re;const s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(U(n,{code:j.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(U(n,{code:j.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const i=this._def.valueType;function a(l){const c=new Set;for(const u of l){if(u.status==="aborted")return re;u.status==="dirty"&&t.dirty(),c.add(u.value)}return{status:t.value,value:c}}const o=[...n.data.values()].map((l,c)=>i._parse(new lr(n,l,n.path,c)));return n.common.async?Promise.all(o).then(l=>a(l)):a(o)}min(e,t){return new Xs({...this._def,minSize:{value:e,message:G.toString(t)}})}max(e,t){return new Xs({...this._def,maxSize:{value:e,message:G.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Xs.create=(r,e)=>new Xs({valueType:r,minSize:null,maxSize:null,typeName:T.ZodSet,...oe(e)});class $i extends de{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==q.function)return U(t,{code:j.invalid_type,expected:q.function,received:t.parsedType}),re;function n(o,l){return Su({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,ku(),qi].filter(c=>!!c),issueData:{code:j.invalid_arguments,argumentsError:l}})}function s(o,l){return Su({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,ku(),qi].filter(c=>!!c),issueData:{code:j.invalid_return_type,returnTypeError:l}})}const i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof Hi){const o=this;return It(async function(...l){const c=new on([]),u=await o._def.args.parseAsync(l,i).catch(f=>{throw c.addIssue(n(l,f)),c}),d=await Reflect.apply(a,this,u);return await o._def.returns._def.type.parseAsync(d,i).catch(f=>{throw c.addIssue(s(d,f)),c})})}else{const o=this;return It(function(...l){const c=o._def.args.safeParse(l,i);if(!c.success)throw new on([n(l,c.error)]);const u=Reflect.apply(a,this,c.data),d=o._def.returns.safeParse(u,i);if(!d.success)throw new on([s(u,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new $i({...this._def,args:cr.create(e).rest(Fs.create())})}returns(e){return new $i({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new $i({args:e||cr.create([]).rest(Fs.create()),returns:t||Fs.create(),typeName:T.ZodFunction,...oe(n)})}}class Ho extends de{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Ho.create=(r,e)=>new Ho({getter:r,typeName:T.ZodLazy,...oe(e)});class Vo extends de{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return U(t,{received:t.data,code:j.invalid_literal,expected:this._def.value}),re}return{status:"valid",value:e.data}}get value(){return this._def.value}}Vo.create=(r,e)=>new Vo({value:r,typeName:T.ZodLiteral,...oe(e)});function QS(r,e){return new cs({values:r,typeName:T.ZodEnum,...oe(e)})}class cs extends de{constructor(){super(...arguments),to.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),n=this._def.values;return U(t,{expected:xe.joinValues(n),received:t.parsedType,code:j.invalid_type}),re}if(Pu(this,to)||JS(this,to,new Set(this._def.values)),!Pu(this,to).has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return U(t,{received:t.data,code:j.invalid_enum_value,options:n}),re}return It(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return cs.create(e,{...this._def,...t})}exclude(e,t=this._def){return cs.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}}to=new WeakMap;cs.create=QS;class Zo extends de{constructor(){super(...arguments),no.set(this,void 0)}_parse(e){const t=xe.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==q.string&&n.parsedType!==q.number){const s=xe.objectValues(t);return U(n,{expected:xe.joinValues(s),received:n.parsedType,code:j.invalid_type}),re}if(Pu(this,no)||JS(this,no,new Set(xe.getValidEnumValues(this._def.values))),!Pu(this,no).has(e.data)){const s=xe.objectValues(t);return U(n,{received:n.data,code:j.invalid_enum_value,options:s}),re}return It(e.data)}get enum(){return this._def.values}}no=new WeakMap;Zo.create=(r,e)=>new Zo({values:r,typeName:T.ZodNativeEnum,...oe(e)});class Hi extends de{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==q.promise&&t.common.async===!1)return U(t,{code:j.invalid_type,expected:q.promise,received:t.parsedType}),re;const n=t.parsedType===q.promise?t.data:Promise.resolve(t.data);return It(n.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Hi.create=(r,e)=>new Hi({type:r,typeName:T.ZodPromise,...oe(e)});class Bn extends de{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===T.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:a=>{U(n,a),a.fatal?t.abort():t.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){const a=s.transform(n.data,i);if(n.common.async)return Promise.resolve(a).then(async o=>{if(t.value==="aborted")return re;const l=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return l.status==="aborted"?re:l.status==="dirty"||t.value==="dirty"?xi(l.value):l});{if(t.value==="aborted")return re;const o=this._def.schema._parseSync({data:a,path:n.path,parent:n});return o.status==="aborted"?re:o.status==="dirty"||t.value==="dirty"?xi(o.value):o}}if(s.type==="refinement"){const a=o=>{const l=s.refinement(o,i);if(n.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?re:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?re:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(n.common.async===!1){const a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Js(a))return a;const o=s.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>Js(a)?Promise.resolve(s.transform(a.value,i)).then(o=>({status:t.value,value:o})):a);xe.assertNever(s)}}Bn.create=(r,e,t)=>new Bn({schema:r,typeName:T.ZodEffects,effect:e,...oe(t)});Bn.createWithPreprocess=(r,e,t)=>new Bn({schema:e,effect:{type:"preprocess",transform:r},typeName:T.ZodEffects,...oe(t)});class jn extends de{_parse(e){return this._getType(e)===q.undefined?It(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}jn.create=(r,e)=>new jn({innerType:r,typeName:T.ZodOptional,...oe(e)});class us extends de{_parse(e){return this._getType(e)===q.null?It(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}us.create=(r,e)=>new us({innerType:r,typeName:T.ZodNullable,...oe(e)});class Go extends de{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===q.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Go.create=(r,e)=>new Go({innerType:r,typeName:T.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...oe(e)});class Jo extends de{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Do(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new on(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new on(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}Jo.create=(r,e)=>new Jo({innerType:r,typeName:T.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...oe(e)});class Tu extends de{_parse(e){if(this._getType(e)!==q.nan){const n=this._getOrReturnCtx(e);return U(n,{code:j.invalid_type,expected:q.nan,received:n.parsedType}),re}return{status:"valid",value:e.data}}}Tu.create=r=>new Tu({typeName:T.ZodNaN,...oe(r)});const UN=Symbol("zod_brand");class Lg extends de{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class Sl extends de{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?re:i.status==="dirty"?(t.dirty(),xi(i.value)):this._def.out._parseAsync({data:i.value,path:n.path,parent:n})})();{const s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?re:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,t){return new Sl({in:e,out:t,typeName:T.ZodPipeline})}}class Ko extends de{_parse(e){const t=this._def.innerType._parse(e),n=s=>(Js(s)&&(s.value=Object.freeze(s.value)),s);return Do(t)?t.then(s=>n(s)):n(t)}unwrap(){return this._def.innerType}}Ko.create=(r,e)=>new Ko({innerType:r,typeName:T.ZodReadonly,...oe(e)});function cw(r,e){const t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function eP(r,e={},t){return r?Wi.create().superRefine((n,s)=>{var i,a;const o=r(n);if(o instanceof Promise)return o.then(l=>{var c,u;if(!l){const d=cw(e,n),h=(u=(c=d.fatal)!==null&&c!==void 0?c:t)!==null&&u!==void 0?u:!0;s.addIssue({code:"custom",...d,fatal:h})}});if(!o){const l=cw(e,n),c=(a=(i=l.fatal)!==null&&i!==void 0?i:t)!==null&&a!==void 0?a:!0;s.addIssue({code:"custom",...l,fatal:c})}}):Wi.create()}const qN={object:Ve.lazycreate};var T;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(T||(T={}));const WN=(r,e={message:`Input not instance of ${r.name}`})=>eP(t=>t instanceof r,e),tP=In.create,nP=os.create,HN=Tu.create,VN=ls.create,rP=Fo.create,ZN=Ks.create,GN=Eu.create,JN=Bo.create,KN=zo.create,XN=Wi.create,YN=Fs.create,QN=Cr.create,eL=Au.create,tL=Ln.create,nL=Ve.create,rL=Ve.strictCreate,sL=Uo.create,iL=Td.create,aL=qo.create,oL=cr.create,lL=Wo.create,cL=Ou.create,uL=Xs.create,dL=$i.create,hL=Ho.create,fL=Vo.create,pL=cs.create,mL=Zo.create,gL=Hi.create,uw=Bn.create,_L=jn.create,bL=us.create,yL=Bn.createWithPreprocess,wL=Sl.create,vL=()=>tP().optional(),xL=()=>nP().optional(),kL=()=>rP().optional(),SL={string:r=>In.create({...r,coerce:!0}),number:r=>os.create({...r,coerce:!0}),boolean:r=>Fo.create({...r,coerce:!0}),bigint:r=>ls.create({...r,coerce:!0}),date:r=>Ks.create({...r,coerce:!0})},PL=re;var rs=Object.freeze({__proto__:null,defaultErrorMap:qi,setErrorMap:yN,getErrorMap:ku,makeIssue:Su,EMPTY_PATH:wN,addIssueToContext:U,ParseStatus:xt,INVALID:re,DIRTY:xi,OK:It,isAborted:sm,isDirty:im,isValid:Js,isAsync:Do,get util(){return xe},get objectUtil(){return rm},ZodParsedType:q,getParsedType:xr,ZodType:de,datetimeRegex:YS,ZodString:In,ZodNumber:os,ZodBigInt:ls,ZodBoolean:Fo,ZodDate:Ks,ZodSymbol:Eu,ZodUndefined:Bo,ZodNull:zo,ZodAny:Wi,ZodUnknown:Fs,ZodNever:Cr,ZodVoid:Au,ZodArray:Ln,ZodObject:Ve,ZodUnion:Uo,ZodDiscriminatedUnion:Td,ZodIntersection:qo,ZodTuple:cr,ZodRecord:Wo,ZodMap:Ou,ZodSet:Xs,ZodFunction:$i,ZodLazy:Ho,ZodLiteral:Vo,ZodEnum:cs,ZodNativeEnum:Zo,ZodPromise:Hi,ZodEffects:Bn,ZodTransformer:Bn,ZodOptional:jn,ZodNullable:us,ZodDefault:Go,ZodCatch:Jo,ZodNaN:Tu,BRAND:UN,ZodBranded:Lg,ZodPipeline:Sl,ZodReadonly:Ko,custom:eP,Schema:de,ZodSchema:de,late:qN,get ZodFirstPartyTypeKind(){return T},coerce:SL,any:XN,array:tL,bigint:VN,boolean:rP,date:ZN,discriminatedUnion:iL,effect:uw,enum:pL,function:dL,instanceof:WN,intersection:aL,lazy:hL,literal:fL,map:cL,nan:HN,nativeEnum:mL,never:QN,null:KN,nullable:bL,number:nP,object:nL,oboolean:kL,onumber:xL,optional:_L,ostring:vL,pipeline:wL,preprocess:yL,promise:gL,record:lL,set:uL,strictObject:rL,string:tP,symbol:GN,transformer:uw,tuple:oL,undefined:JN,union:sL,unknown:YN,void:eL,NEVER:PL,ZodIssueCode:j,quotelessJson:bN,ZodError:on}),ka={exports:{}},Fh={},Bh,dw;function EL(){if(dw)return Bh;dw=1;function r(e,t){typeof t=="boolean"&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return Bh=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(n===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1);else return!1;var s=this;return this._timer=setTimeout(function(){s._attempts++,s._operationTimeoutCb&&(s._timeout=setTimeout(function(){s._operationTimeoutCb(s._attempts)},s._operationTimeout),s._options.unref&&s._timeout.unref()),s._fn(s._attempts)},n),this._options.unref&&this._timer.unref(),!0},r.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},r.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},r.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},t=null,n=0,s=0;s<this._errors.length;s++){var i=this._errors[s],a=i.message,o=(e[a]||0)+1;e[a]=o,o>=n&&(t=i,n=o)}return t},Bh}var hw;function AL(){return hw||(hw=1,function(r){var e=EL();r.operation=function(t){var n=r.timeouts(t);return new e(n,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},r.timeouts=function(t){if(t instanceof Array)return[].concat(t);var n={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var s in t)n[s]=t[s];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var i=[],a=0;a<n.retries;a++)i.push(this.createTimeout(a,n));return t&&t.forever&&!i.length&&i.push(this.createTimeout(a,n)),i.sort(function(o,l){return o-l}),i},r.createTimeout=function(t,n){var s=n.randomize?Math.random()+1:1,i=Math.round(s*Math.max(n.minTimeout,1)*Math.pow(n.factor,t));return i=Math.min(i,n.maxTimeout),i},r.wrap=function(t,n,s){if(n instanceof Array&&(s=n,n=null),!s){s=[];for(var i in t)typeof t[i]=="function"&&s.push(i)}for(var a=0;a<s.length;a++){var o=s[a],l=t[o];t[o]=(function(u){var d=r.operation(n),h=Array.prototype.slice.call(arguments,1),f=h.pop();h.push(function(p){d.retry(p)||(p&&(arguments[0]=d.mainError()),f.apply(this,arguments))}),d.attempt(function(){u.apply(t,h)})}).bind(t,l),t[o].options=n}}}(Fh)),Fh}var zh,fw;function OL(){return fw||(fw=1,zh=AL()),zh}var pw;function TL(){if(pw)return ka.exports;pw=1;const r=OL(),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class t extends Error{constructor(o){super(),o instanceof Error?(this.originalError=o,{message:o}=o):(this.originalError=new Error(o),this.originalError.stack=this.stack),this.name="AbortError",this.message=o}}const n=(a,o,l)=>{const c=l.retries-(o-1);return a.attemptNumber=o,a.retriesLeft=c,a},s=a=>e.includes(a),i=(a,o)=>new Promise((l,c)=>{o={onFailedAttempt:()=>{},retries:10,...o};const u=r.operation(o);u.attempt(async d=>{try{l(await a(d))}catch(h){if(!(h instanceof Error)){c(new TypeError(`Non-error was thrown: "${h}". You should only throw errors.`));return}if(h instanceof t)u.stop(),c(h.originalError);else if(h instanceof TypeError&&!s(h.message))u.stop(),c(h);else{n(h,d,o);try{await o.onFailedAttempt(h)}catch(f){c(f);return}u.retry(h)||c(u.mainError())}}})});return ka.exports=i,ka.exports.default=i,ka.exports.AbortError=t,ka.exports}var RL=TL();const Ru=ta(RL),CL=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function ho(r){return typeof r=="string"&&CL.test(r)}var ut=[];for(var Uh=0;Uh<256;++Uh)ut.push((Uh+256).toString(16).slice(1));function IL(r,e=0){return(ut[r[e+0]]+ut[r[e+1]]+ut[r[e+2]]+ut[r[e+3]]+"-"+ut[r[e+4]]+ut[r[e+5]]+"-"+ut[r[e+6]]+ut[r[e+7]]+"-"+ut[r[e+8]]+ut[r[e+9]]+"-"+ut[r[e+10]]+ut[r[e+11]]+ut[r[e+12]]+ut[r[e+13]]+ut[r[e+14]]+ut[r[e+15]]).toLowerCase()}var lc,$L=new Uint8Array(16);function ML(){if(!lc&&(lc=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!lc))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return lc($L)}var NL=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const mw={randomUUID:NL};function At(r,e,t){if(mw.randomUUID&&!r)return mw.randomUUID();r=r||{};var n=r.random||(r.rng||ML)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,IL(n)}var cc={},qh={exports:{}},gw;function LL(){return gw||(gw=1,function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function s(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function i(l,c,u,d,h){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new s(u,d||l,h),p=t?t+c:c;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],f]:l._events[p].push(f):(l._events[p]=f,l._eventsCount++),l}function a(l,c){--l._eventsCount===0?l._events=new n:delete l._events[c]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],u,d;if(this._eventsCount===0)return c;for(d in u=this._events)e.call(u,d)&&c.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},o.prototype.listeners=function(c){var u=t?t+c:c,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,f=d.length,p=new Array(f);h<f;h++)p[h]=d[h].fn;return p},o.prototype.listenerCount=function(c){var u=t?t+c:c,d=this._events[u];return d?d.fn?1:d.length:0},o.prototype.emit=function(c,u,d,h,f,p){var m=t?t+c:c;if(!this._events[m])return!1;var g=this._events[m],_=arguments.length,y,b;if(g.fn){switch(g.once&&this.removeListener(c,g.fn,void 0,!0),_){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,u),!0;case 3:return g.fn.call(g.context,u,d),!0;case 4:return g.fn.call(g.context,u,d,h),!0;case 5:return g.fn.call(g.context,u,d,h,f),!0;case 6:return g.fn.call(g.context,u,d,h,f,p),!0}for(b=1,y=new Array(_-1);b<_;b++)y[b-1]=arguments[b];g.fn.apply(g.context,y)}else{var w=g.length,v;for(b=0;b<w;b++)switch(g[b].once&&this.removeListener(c,g[b].fn,void 0,!0),_){case 1:g[b].fn.call(g[b].context);break;case 2:g[b].fn.call(g[b].context,u);break;case 3:g[b].fn.call(g[b].context,u,d);break;case 4:g[b].fn.call(g[b].context,u,d,h);break;default:if(!y)for(v=1,y=new Array(_-1);v<_;v++)y[v-1]=arguments[v];g[b].fn.apply(g[b].context,y)}}return!0},o.prototype.on=function(c,u,d){return i(this,c,u,d,!1)},o.prototype.once=function(c,u,d){return i(this,c,u,d,!0)},o.prototype.removeListener=function(c,u,d,h){var f=t?t+c:c;if(!this._events[f])return this;if(!u)return a(this,f),this;var p=this._events[f];if(p.fn)p.fn===u&&(!h||p.once)&&(!d||p.context===d)&&a(this,f);else{for(var m=0,g=[],_=p.length;m<_;m++)(p[m].fn!==u||h&&!p[m].once||d&&p[m].context!==d)&&g.push(p[m]);g.length?this._events[f]=g.length===1?g[0]:g:a(this,f)}return this},o.prototype.removeAllListeners=function(c){var u;return c?(u=t?t+c:c,this._events[u]&&a(this,u)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,r.exports=o}(qh)),qh.exports}var Sa={exports:{}},Wh,_w;function jL(){return _w||(_w=1,Wh=(r,e)=>(e=e||(()=>{}),r.then(t=>new Promise(n=>{n(e())}).then(()=>t),t=>new Promise(n=>{n(e())}).then(()=>{throw t})))),Wh}var bw;function DL(){if(bw)return Sa.exports;bw=1;const r=jL();class e extends Error{constructor(s){super(s),this.name="TimeoutError"}}const t=(n,s,i)=>new Promise((a,o)=>{if(typeof s!="number"||s<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(s===1/0){a(n);return}const l=setTimeout(()=>{if(typeof i=="function"){try{a(i())}catch(d){o(d)}return}const c=typeof i=="string"?i:`Promise timed out after ${s} milliseconds`,u=i instanceof Error?i:new e(c);typeof n.cancel=="function"&&n.cancel(),o(u)},s);r(n.then(a,o),()=>{clearTimeout(l)})});return Sa.exports=t,Sa.exports.default=t,Sa.exports.TimeoutError=e,Sa.exports}var uc={},dc={},yw;function FL(){if(yw)return dc;yw=1,Object.defineProperty(dc,"__esModule",{value:!0});function r(e,t,n){let s=0,i=e.length;for(;i>0;){const a=i/2|0;let o=s+a;n(e[o],t)<=0?(s=++o,i-=a+1):i=a}return s}return dc.default=r,dc}var ww;function BL(){if(ww)return uc;ww=1,Object.defineProperty(uc,"__esModule",{value:!0});const r=FL();class e{constructor(){this._queue=[]}enqueue(n,s){s=Object.assign({priority:0},s);const i={priority:s.priority,run:n};if(this.size&&this._queue[this.size-1].priority>=s.priority){this._queue.push(i);return}const a=r.default(this._queue,i,(o,l)=>l.priority-o.priority);this._queue.splice(a,0,i)}dequeue(){const n=this._queue.shift();return n==null?void 0:n.run}filter(n){return this._queue.filter(s=>s.priority===n.priority).map(s=>s.run)}get size(){return this._queue.length}}return uc.default=e,uc}var vw;function zL(){if(vw)return cc;vw=1,Object.defineProperty(cc,"__esModule",{value:!0});const r=LL(),e=DL(),t=BL(),n=()=>{},s=new e.TimeoutError;class i extends r{constructor(o){var l,c,u,d;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=n,this._resolveIdle=n,o=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:t.default},o),!(typeof o.intervalCap=="number"&&o.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(c=(l=o.intervalCap)===null||l===void 0?void 0:l.toString())!==null&&c!==void 0?c:""}\` (${typeof o.intervalCap})`);if(o.interval===void 0||!(Number.isFinite(o.interval)&&o.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(d=(u=o.interval)===null||u===void 0?void 0:u.toString())!==null&&d!==void 0?d:""}\` (${typeof o.interval})`);this._carryoverConcurrencyCount=o.carryoverConcurrencyCount,this._isIntervalIgnored=o.intervalCap===1/0||o.interval===0,this._intervalCap=o.intervalCap,this._interval=o.interval,this._queue=new o.queueClass,this._queueClass=o.queueClass,this.concurrency=o.concurrency,this._timeout=o.timeout,this._throwOnTimeout=o.throwOnTimeout===!0,this._isPaused=o.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=n,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=n,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const o=Date.now();if(this._intervalId===void 0){const l=this._intervalEnd-o;if(l<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},l)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const o=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const l=this._queue.dequeue();return l?(this.emit("active"),l(),o&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(o){if(!(typeof o=="number"&&o>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${o}\` (${typeof o})`);this._concurrency=o,this._processQueue()}async add(o,l={}){return new Promise((c,u)=>{const d=async()=>{this._pendingCount++,this._intervalCount++;try{const h=this._timeout===void 0&&l.timeout===void 0?o():e.default(Promise.resolve(o()),l.timeout===void 0?this._timeout:l.timeout,()=>{(l.throwOnTimeout===void 0?this._throwOnTimeout:l.throwOnTimeout)&&u(s)});c(await h)}catch(h){u(h)}this._next()};this._queue.enqueue(d,l),this._tryToStartAnother(),this.emit("add")})}async addAll(o,l){return Promise.all(o.map(async c=>this.add(c,l)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(o=>{const l=this._resolveEmpty;this._resolveEmpty=()=>{l(),o()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(o=>{const l=this._resolveIdle;this._resolveIdle=()=>{l(),o()}})}get size(){return this._queue.size}sizeBy(o){return this._queue.filter(o).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(o){this._timeout=o}}return cc.default=i,cc}var UL=zL();const Or=ta(UL),qL=(...r)=>fetch(...r),WL=Symbol.for("ls:fetch_implementation"),ee=()=>globalThis[WL]??qL,HL=[400,401,403,404,405,406,407,408],VL=[409];let xw=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in Or?this.queue=new Or.default({concurrency:this.maxConcurrency}):this.queue=new Or({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...t){const n=this.onFailedResponseHook;return this.queue.add(()=>Ru(()=>e(...t).catch(s=>{throw s instanceof Error?s:new Error(s)}),{async onFailedAttempt(s){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.message.startsWith("AbortError")||(s==null?void 0:s.code)==="ECONNABORTED")throw s;const i=s==null?void 0:s.response,a=i==null?void 0:i.status;if(a){if(HL.includes(+a))throw s;if(VL.includes(+a))return;n&&await n(i)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>ee()(...e).then(t=>t.ok?t:Promise.reject(t)))}};function kw(r){return typeof(r==null?void 0:r._getType)=="function"}function Sw(r){const e={type:r._getType(),data:{content:r.content}};return r!=null&&r.additional_kwargs&&Object.keys(r.additional_kwargs).length>0&&(e.data.additional_kwargs={...r.additional_kwargs}),e}function ce(r,e){if(!ho(r)){const t=e!==void 0?`Invalid UUID for ${e}: ${r}`:`Invalid UUID: ${r}`;throw new Error(t)}return r}const Pw={};function sP(r){Pw[r]||(console.warn(r),Pw[r]=!0)}var hc={exports:{}},Hh,Ew;function Rd(){if(Ew)return Hh;Ew=1;const r="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,n=16,s=e-6;return Hh={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:s,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:r,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},Hh}var Vh,Aw;function Cd(){if(Aw)return Vh;Aw=1;var r={};return Vh=typeof process=="object"&&r&&r.NODE_DEBUG&&/\bsemver\b/i.test(r.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{},Vh}var Ow;function Pl(){return Ow||(Ow=1,function(r,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:s}=Rd(),i=Cd();e=r.exports={};const a=e.re=[],o=e.safeRe=[],l=e.src=[],c=e.safeSrc=[],u=e.t={};let d=0;const h="[a-zA-Z0-9-]",f=[["\\s",1],["\\d",s],[h,n]],p=g=>{for(const[_,y]of f)g=g.split(`${_}*`).join(`${_}{0,${y}}`).split(`${_}+`).join(`${_}{1,${y}}`);return g},m=(g,_,y)=>{const b=p(_),w=d++;i(g,w,_),u[g]=w,l[w]=_,c[w]=b,a[w]=new RegExp(_,y?"g":void 0),o[w]=new RegExp(b,y?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${h}*`),m("MAINVERSION",`(${l[u.NUMERICIDENTIFIER]})\\.(${l[u.NUMERICIDENTIFIER]})\\.(${l[u.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${l[u.NUMERICIDENTIFIERLOOSE]})\\.(${l[u.NUMERICIDENTIFIERLOOSE]})\\.(${l[u.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${l[u.NUMERICIDENTIFIER]}|${l[u.NONNUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${l[u.NUMERICIDENTIFIERLOOSE]}|${l[u.NONNUMERICIDENTIFIER]})`),m("PRERELEASE",`(?:-(${l[u.PRERELEASEIDENTIFIER]}(?:\\.${l[u.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${l[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[u.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${h}+`),m("BUILD",`(?:\\+(${l[u.BUILDIDENTIFIER]}(?:\\.${l[u.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${l[u.MAINVERSION]}${l[u.PRERELEASE]}?${l[u.BUILD]}?`),m("FULL",`^${l[u.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${l[u.MAINVERSIONLOOSE]}${l[u.PRERELEASELOOSE]}?${l[u.BUILD]}?`),m("LOOSE",`^${l[u.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${l[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${l[u.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${l[u.XRANGEIDENTIFIER]})(?:\\.(${l[u.XRANGEIDENTIFIER]})(?:\\.(${l[u.XRANGEIDENTIFIER]})(?:${l[u.PRERELEASE]})?${l[u.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${l[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[u.XRANGEIDENTIFIERLOOSE]})(?:${l[u.PRERELEASELOOSE]})?${l[u.BUILD]}?)?)?`),m("XRANGE",`^${l[u.GTLT]}\\s*${l[u.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${l[u.GTLT]}\\s*${l[u.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),m("COERCE",`${l[u.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",l[u.COERCEPLAIN]+`(?:${l[u.PRERELEASE]})?(?:${l[u.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",l[u.COERCE],!0),m("COERCERTLFULL",l[u.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${l[u.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",m("TILDE",`^${l[u.LONETILDE]}${l[u.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${l[u.LONETILDE]}${l[u.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${l[u.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",m("CARET",`^${l[u.LONECARET]}${l[u.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${l[u.LONECARET]}${l[u.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${l[u.GTLT]}\\s*(${l[u.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${l[u.GTLT]}\\s*(${l[u.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${l[u.GTLT]}\\s*(${l[u.LOOSEPLAIN]}|${l[u.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${l[u.XRANGEPLAIN]})\\s+-\\s+(${l[u.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${l[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[u.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(hc,hc.exports)),hc.exports}var Zh,Tw;function jg(){if(Tw)return Zh;Tw=1;const r=Object.freeze({loose:!0}),e=Object.freeze({});return Zh=n=>n?typeof n!="object"?r:n:e,Zh}var Gh,Rw;function iP(){if(Rw)return Gh;Rw=1;const r=/^[0-9]+$/,e=(n,s)=>{const i=r.test(n),a=r.test(s);return i&&a&&(n=+n,s=+s),n===s?0:i&&!a?-1:a&&!i?1:n<s?-1:1};return Gh={compareIdentifiers:e,rcompareIdentifiers:(n,s)=>e(s,n)},Gh}var Jh,Cw;function Nt(){if(Cw)return Jh;Cw=1;const r=Cd(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=Rd(),{safeRe:n,safeSrc:s,t:i}=Pl(),a=jg(),{compareIdentifiers:o}=iP();class l{constructor(u,d){if(d=a(d),u instanceof l){if(u.loose===!!d.loose&&u.includePrerelease===!!d.includePrerelease)return u;u=u.version}else if(typeof u!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof u}".`);if(u.length>e)throw new TypeError(`version is longer than ${e} characters`);r("SemVer",u,d),this.options=d,this.loose=!!d.loose,this.includePrerelease=!!d.includePrerelease;const h=u.trim().match(d.loose?n[i.LOOSE]:n[i.FULL]);if(!h)throw new TypeError(`Invalid Version: ${u}`);if(this.raw=u,this.major=+h[1],this.minor=+h[2],this.patch=+h[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");h[4]?this.prerelease=h[4].split(".").map(f=>{if(/^[0-9]+$/.test(f)){const p=+f;if(p>=0&&p<t)return p}return f}):this.prerelease=[],this.build=h[5]?h[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(u){if(r("SemVer.compare",this.version,this.options,u),!(u instanceof l)){if(typeof u=="string"&&u===this.version)return 0;u=new l(u,this.options)}return u.version===this.version?0:this.compareMain(u)||this.comparePre(u)}compareMain(u){return u instanceof l||(u=new l(u,this.options)),o(this.major,u.major)||o(this.minor,u.minor)||o(this.patch,u.patch)}comparePre(u){if(u instanceof l||(u=new l(u,this.options)),this.prerelease.length&&!u.prerelease.length)return-1;if(!this.prerelease.length&&u.prerelease.length)return 1;if(!this.prerelease.length&&!u.prerelease.length)return 0;let d=0;do{const h=this.prerelease[d],f=u.prerelease[d];if(r("prerelease compare",d,h,f),h===void 0&&f===void 0)return 0;if(f===void 0)return 1;if(h===void 0)return-1;if(h===f)continue;return o(h,f)}while(++d)}compareBuild(u){u instanceof l||(u=new l(u,this.options));let d=0;do{const h=this.build[d],f=u.build[d];if(r("build compare",d,h,f),h===void 0&&f===void 0)return 0;if(f===void 0)return 1;if(h===void 0)return-1;if(h===f)continue;return o(h,f)}while(++d)}inc(u,d,h){if(u.startsWith("pre")){if(!d&&h===!1)throw new Error("invalid increment argument: identifier is empty");if(d){const f=new RegExp(`^${this.options.loose?s[i.PRERELEASELOOSE]:s[i.PRERELEASE]}$`),p=`-${d}`.match(f);if(!p||p[1]!==d)throw new Error(`invalid identifier: ${d}`)}}switch(u){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",d,h);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",d,h);break;case"prepatch":this.prerelease.length=0,this.inc("patch",d,h),this.inc("pre",d,h);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",d,h),this.inc("pre",d,h);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const f=Number(h)?1:0;if(this.prerelease.length===0)this.prerelease=[f];else{let p=this.prerelease.length;for(;--p>=0;)typeof this.prerelease[p]=="number"&&(this.prerelease[p]++,p=-2);if(p===-1){if(d===this.prerelease.join(".")&&h===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(f)}}if(d){let p=[d,f];h===!1&&(p=[d]),o(this.prerelease[0],d)===0?isNaN(this.prerelease[1])&&(this.prerelease=p):this.prerelease=p}break}default:throw new Error(`invalid increment argument: ${u}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return Jh=l,Jh}var Kh,Iw;function ca(){if(Iw)return Kh;Iw=1;const r=Nt();return Kh=(t,n,s=!1)=>{if(t instanceof r)return t;try{return new r(t,n)}catch(i){if(!s)return null;throw i}},Kh}var Xh,$w;function ZL(){if($w)return Xh;$w=1;const r=ca();return Xh=(t,n)=>{const s=r(t,n);return s?s.version:null},Xh}var Yh,Mw;function GL(){if(Mw)return Yh;Mw=1;const r=ca();return Yh=(t,n)=>{const s=r(t.trim().replace(/^[=v]+/,""),n);return s?s.version:null},Yh}var Qh,Nw;function JL(){if(Nw)return Qh;Nw=1;const r=Nt();return Qh=(t,n,s,i,a)=>{typeof s=="string"&&(a=i,i=s,s=void 0);try{return new r(t instanceof r?t.version:t,s).inc(n,i,a).version}catch{return null}},Qh}var ef,Lw;function KL(){if(Lw)return ef;Lw=1;const r=ca();return ef=(t,n)=>{const s=r(t,null,!0),i=r(n,null,!0),a=s.compare(i);if(a===0)return null;const o=a>0,l=o?s:i,c=o?i:s,u=!!l.prerelease.length;if(!!c.prerelease.length&&!u){if(!c.patch&&!c.minor)return"major";if(c.compareMain(l)===0)return c.minor&&!c.patch?"minor":"patch"}const h=u?"pre":"";return s.major!==i.major?h+"major":s.minor!==i.minor?h+"minor":s.patch!==i.patch?h+"patch":"prerelease"},ef}var tf,jw;function XL(){if(jw)return tf;jw=1;const r=Nt();return tf=(t,n)=>new r(t,n).major,tf}var nf,Dw;function YL(){if(Dw)return nf;Dw=1;const r=Nt();return nf=(t,n)=>new r(t,n).minor,nf}var rf,Fw;function QL(){if(Fw)return rf;Fw=1;const r=Nt();return rf=(t,n)=>new r(t,n).patch,rf}var sf,Bw;function ej(){if(Bw)return sf;Bw=1;const r=ca();return sf=(t,n)=>{const s=r(t,n);return s&&s.prerelease.length?s.prerelease:null},sf}var af,zw;function qn(){if(zw)return af;zw=1;const r=Nt();return af=(t,n,s)=>new r(t,s).compare(new r(n,s)),af}var of,Uw;function tj(){if(Uw)return of;Uw=1;const r=qn();return of=(t,n,s)=>r(n,t,s),of}var lf,qw;function nj(){if(qw)return lf;qw=1;const r=qn();return lf=(t,n)=>r(t,n,!0),lf}var cf,Ww;function Dg(){if(Ww)return cf;Ww=1;const r=Nt();return cf=(t,n,s)=>{const i=new r(t,s),a=new r(n,s);return i.compare(a)||i.compareBuild(a)},cf}var uf,Hw;function rj(){if(Hw)return uf;Hw=1;const r=Dg();return uf=(t,n)=>t.sort((s,i)=>r(s,i,n)),uf}var df,Vw;function sj(){if(Vw)return df;Vw=1;const r=Dg();return df=(t,n)=>t.sort((s,i)=>r(i,s,n)),df}var hf,Zw;function Id(){if(Zw)return hf;Zw=1;const r=qn();return hf=(t,n,s)=>r(t,n,s)>0,hf}var ff,Gw;function Fg(){if(Gw)return ff;Gw=1;const r=qn();return ff=(t,n,s)=>r(t,n,s)<0,ff}var pf,Jw;function aP(){if(Jw)return pf;Jw=1;const r=qn();return pf=(t,n,s)=>r(t,n,s)===0,pf}var mf,Kw;function oP(){if(Kw)return mf;Kw=1;const r=qn();return mf=(t,n,s)=>r(t,n,s)!==0,mf}var gf,Xw;function Bg(){if(Xw)return gf;Xw=1;const r=qn();return gf=(t,n,s)=>r(t,n,s)>=0,gf}var _f,Yw;function zg(){if(Yw)return _f;Yw=1;const r=qn();return _f=(t,n,s)=>r(t,n,s)<=0,_f}var bf,Qw;function lP(){if(Qw)return bf;Qw=1;const r=aP(),e=oP(),t=Id(),n=Bg(),s=Fg(),i=zg();return bf=(o,l,c,u)=>{switch(l){case"===":return typeof o=="object"&&(o=o.version),typeof c=="object"&&(c=c.version),o===c;case"!==":return typeof o=="object"&&(o=o.version),typeof c=="object"&&(c=c.version),o!==c;case"":case"=":case"==":return r(o,c,u);case"!=":return e(o,c,u);case">":return t(o,c,u);case">=":return n(o,c,u);case"<":return s(o,c,u);case"<=":return i(o,c,u);default:throw new TypeError(`Invalid operator: ${l}`)}},bf}var yf,ev;function ij(){if(ev)return yf;ev=1;const r=Nt(),e=ca(),{safeRe:t,t:n}=Pl();return yf=(i,a)=>{if(i instanceof r)return i;if(typeof i=="number"&&(i=String(i)),typeof i!="string")return null;a=a||{};let o=null;if(!a.rtl)o=i.match(a.includePrerelease?t[n.COERCEFULL]:t[n.COERCE]);else{const f=a.includePrerelease?t[n.COERCERTLFULL]:t[n.COERCERTL];let p;for(;(p=f.exec(i))&&(!o||o.index+o[0].length!==i.length);)(!o||p.index+p[0].length!==o.index+o[0].length)&&(o=p),f.lastIndex=p.index+p[1].length+p[2].length;f.lastIndex=-1}if(o===null)return null;const l=o[2],c=o[3]||"0",u=o[4]||"0",d=a.includePrerelease&&o[5]?`-${o[5]}`:"",h=a.includePrerelease&&o[6]?`+${o[6]}`:"";return e(`${l}.${c}.${u}${d}${h}`,a)},yf}var wf,tv;function aj(){if(tv)return wf;tv=1;class r{constructor(){this.max=1e3,this.map=new Map}get(t){const n=this.map.get(t);if(n!==void 0)return this.map.delete(t),this.map.set(t,n),n}delete(t){return this.map.delete(t)}set(t,n){if(!this.delete(t)&&n!==void 0){if(this.map.size>=this.max){const i=this.map.keys().next().value;this.delete(i)}this.map.set(t,n)}return this}}return wf=r,wf}var vf,nv;function Wn(){if(nv)return vf;nv=1;const r=/\s+/g;class e{constructor(E,$){if($=s($),E instanceof e)return E.loose===!!$.loose&&E.includePrerelease===!!$.includePrerelease?E:new e(E.raw,$);if(E instanceof i)return this.raw=E.value,this.set=[[E]],this.formatted=void 0,this;if(this.options=$,this.loose=!!$.loose,this.includePrerelease=!!$.includePrerelease,this.raw=E.trim().replace(r," "),this.set=this.raw.split("||").map(N=>this.parseRange(N.trim())).filter(N=>N.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const N=this.set[0];if(this.set=this.set.filter(R=>!m(R[0])),this.set.length===0)this.set=[N];else if(this.set.length>1){for(const R of this.set)if(R.length===1&&g(R[0])){this.set=[R];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let E=0;E<this.set.length;E++){E>0&&(this.formatted+="||");const $=this.set[E];for(let N=0;N<$.length;N++)N>0&&(this.formatted+=" "),this.formatted+=$[N].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(E){const N=((this.options.includePrerelease&&f)|(this.options.loose&&p))+":"+E,R=n.get(N);if(R)return R;const F=this.options.loose,V=F?l[c.HYPHENRANGELOOSE]:l[c.HYPHENRANGE];E=E.replace(V,D(this.options.includePrerelease)),a("hyphen replace",E),E=E.replace(l[c.COMPARATORTRIM],u),a("comparator trim",E),E=E.replace(l[c.TILDETRIM],d),a("tilde trim",E),E=E.replace(l[c.CARETTRIM],h),a("caret trim",E);let ne=E.split(" ").map(Q=>y(Q,this.options)).join(" ").split(/\s+/).map(Q=>I(Q,this.options));F&&(ne=ne.filter(Q=>(a("loose invalid filter",Q,this.options),!!Q.match(l[c.COMPARATORLOOSE])))),a("range list",ne);const J=new Map,K=ne.map(Q=>new i(Q,this.options));for(const Q of K){if(m(Q))return[Q];J.set(Q.value,Q)}J.size>1&&J.has("")&&J.delete("");const z=[...J.values()];return n.set(N,z),z}intersects(E,$){if(!(E instanceof e))throw new TypeError("a Range is required");return this.set.some(N=>_(N,$)&&E.set.some(R=>_(R,$)&&N.every(F=>R.every(V=>F.intersects(V,$)))))}test(E){if(!E)return!1;if(typeof E=="string")try{E=new o(E,this.options)}catch{return!1}for(let $=0;$<this.set.length;$++)if(Y(this.set[$],E,this.options))return!0;return!1}}vf=e;const t=aj(),n=new t,s=jg(),i=$d(),a=Cd(),o=Nt(),{safeRe:l,t:c,comparatorTrimReplace:u,tildeTrimReplace:d,caretTrimReplace:h}=Pl(),{FLAG_INCLUDE_PRERELEASE:f,FLAG_LOOSE:p}=Rd(),m=O=>O.value==="<0.0.0-0",g=O=>O.value==="",_=(O,E)=>{let $=!0;const N=O.slice();let R=N.pop();for(;$&&N.length;)$=N.every(F=>R.intersects(F,E)),R=N.pop();return $},y=(O,E)=>(a("comp",O,E),O=S(O,E),a("caret",O),O=w(O,E),a("tildes",O),O=x(O,E),a("xrange",O),O=C(O,E),a("stars",O),O),b=O=>!O||O.toLowerCase()==="x"||O==="*",w=(O,E)=>O.trim().split(/\s+/).map($=>v($,E)).join(" "),v=(O,E)=>{const $=E.loose?l[c.TILDELOOSE]:l[c.TILDE];return O.replace($,(N,R,F,V,ne)=>{a("tilde",O,N,R,F,V,ne);let J;return b(R)?J="":b(F)?J=`>=${R}.0.0 <${+R+1}.0.0-0`:b(V)?J=`>=${R}.${F}.0 <${R}.${+F+1}.0-0`:ne?(a("replaceTilde pr",ne),J=`>=${R}.${F}.${V}-${ne} <${R}.${+F+1}.0-0`):J=`>=${R}.${F}.${V} <${R}.${+F+1}.0-0`,a("tilde return",J),J})},S=(O,E)=>O.trim().split(/\s+/).map($=>k($,E)).join(" "),k=(O,E)=>{a("caret",O,E);const $=E.loose?l[c.CARETLOOSE]:l[c.CARET],N=E.includePrerelease?"-0":"";return O.replace($,(R,F,V,ne,J)=>{a("caret",O,R,F,V,ne,J);let K;return b(F)?K="":b(V)?K=`>=${F}.0.0${N} <${+F+1}.0.0-0`:b(ne)?F==="0"?K=`>=${F}.${V}.0${N} <${F}.${+V+1}.0-0`:K=`>=${F}.${V}.0${N} <${+F+1}.0.0-0`:J?(a("replaceCaret pr",J),F==="0"?V==="0"?K=`>=${F}.${V}.${ne}-${J} <${F}.${V}.${+ne+1}-0`:K=`>=${F}.${V}.${ne}-${J} <${F}.${+V+1}.0-0`:K=`>=${F}.${V}.${ne}-${J} <${+F+1}.0.0-0`):(a("no pr"),F==="0"?V==="0"?K=`>=${F}.${V}.${ne}${N} <${F}.${V}.${+ne+1}-0`:K=`>=${F}.${V}.${ne}${N} <${F}.${+V+1}.0-0`:K=`>=${F}.${V}.${ne} <${+F+1}.0.0-0`),a("caret return",K),K})},x=(O,E)=>(a("replaceXRanges",O,E),O.split(/\s+/).map($=>A($,E)).join(" ")),A=(O,E)=>{O=O.trim();const $=E.loose?l[c.XRANGELOOSE]:l[c.XRANGE];return O.replace($,(N,R,F,V,ne,J)=>{a("xRange",O,N,R,F,V,ne,J);const K=b(F),z=K||b(V),Q=z||b(ne),be=Q;return R==="="&&be&&(R=""),J=E.includePrerelease?"-0":"",K?R===">"||R==="<"?N="<0.0.0-0":N="*":R&&be?(z&&(V=0),ne=0,R===">"?(R=">=",z?(F=+F+1,V=0,ne=0):(V=+V+1,ne=0)):R==="<="&&(R="<",z?F=+F+1:V=+V+1),R==="<"&&(J="-0"),N=`${R+F}.${V}.${ne}${J}`):z?N=`>=${F}.0.0${J} <${+F+1}.0.0-0`:Q&&(N=`>=${F}.${V}.0${J} <${F}.${+V+1}.0-0`),a("xRange return",N),N})},C=(O,E)=>(a("replaceStars",O,E),O.trim().replace(l[c.STAR],"")),I=(O,E)=>(a("replaceGTE0",O,E),O.trim().replace(l[E.includePrerelease?c.GTE0PRE:c.GTE0],"")),D=O=>(E,$,N,R,F,V,ne,J,K,z,Q,be)=>(b(N)?$="":b(R)?$=`>=${N}.0.0${O?"-0":""}`:b(F)?$=`>=${N}.${R}.0${O?"-0":""}`:V?$=`>=${$}`:$=`>=${$}${O?"-0":""}`,b(K)?J="":b(z)?J=`<${+K+1}.0.0-0`:b(Q)?J=`<${K}.${+z+1}.0-0`:be?J=`<=${K}.${z}.${Q}-${be}`:O?J=`<${K}.${z}.${+Q+1}-0`:J=`<=${J}`,`${$} ${J}`.trim()),Y=(O,E,$)=>{for(let N=0;N<O.length;N++)if(!O[N].test(E))return!1;if(E.prerelease.length&&!$.includePrerelease){for(let N=0;N<O.length;N++)if(a(O[N].semver),O[N].semver!==i.ANY&&O[N].semver.prerelease.length>0){const R=O[N].semver;if(R.major===E.major&&R.minor===E.minor&&R.patch===E.patch)return!0}return!1}return!0};return vf}var xf,rv;function $d(){if(rv)return xf;rv=1;const r=Symbol("SemVer ANY");class e{static get ANY(){return r}constructor(u,d){if(d=t(d),u instanceof e){if(u.loose===!!d.loose)return u;u=u.value}u=u.trim().split(/\s+/).join(" "),a("comparator",u,d),this.options=d,this.loose=!!d.loose,this.parse(u),this.semver===r?this.value="":this.value=this.operator+this.semver.version,a("comp",this)}parse(u){const d=this.options.loose?n[s.COMPARATORLOOSE]:n[s.COMPARATOR],h=u.match(d);if(!h)throw new TypeError(`Invalid comparator: ${u}`);this.operator=h[1]!==void 0?h[1]:"",this.operator==="="&&(this.operator=""),h[2]?this.semver=new o(h[2],this.options.loose):this.semver=r}toString(){return this.value}test(u){if(a("Comparator.test",u,this.options.loose),this.semver===r||u===r)return!0;if(typeof u=="string")try{u=new o(u,this.options)}catch{return!1}return i(u,this.operator,this.semver,this.options)}intersects(u,d){if(!(u instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new l(u.value,d).test(this.value):u.operator===""?u.value===""?!0:new l(this.value,d).test(u.semver):(d=t(d),d.includePrerelease&&(this.value==="<0.0.0-0"||u.value==="<0.0.0-0")||!d.includePrerelease&&(this.value.startsWith("<0.0.0")||u.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&u.operator.startsWith(">")||this.operator.startsWith("<")&&u.operator.startsWith("<")||this.semver.version===u.semver.version&&this.operator.includes("=")&&u.operator.includes("=")||i(this.semver,"<",u.semver,d)&&this.operator.startsWith(">")&&u.operator.startsWith("<")||i(this.semver,">",u.semver,d)&&this.operator.startsWith("<")&&u.operator.startsWith(">")))}}xf=e;const t=jg(),{safeRe:n,t:s}=Pl(),i=lP(),a=Cd(),o=Nt(),l=Wn();return xf}var kf,sv;function Md(){if(sv)return kf;sv=1;const r=Wn();return kf=(t,n,s)=>{try{n=new r(n,s)}catch{return!1}return n.test(t)},kf}var Sf,iv;function oj(){if(iv)return Sf;iv=1;const r=Wn();return Sf=(t,n)=>new r(t,n).set.map(s=>s.map(i=>i.value).join(" ").trim().split(" ")),Sf}var Pf,av;function lj(){if(av)return Pf;av=1;const r=Nt(),e=Wn();return Pf=(n,s,i)=>{let a=null,o=null,l=null;try{l=new e(s,i)}catch{return null}return n.forEach(c=>{l.test(c)&&(!a||o.compare(c)===-1)&&(a=c,o=new r(a,i))}),a},Pf}var Ef,ov;function cj(){if(ov)return Ef;ov=1;const r=Nt(),e=Wn();return Ef=(n,s,i)=>{let a=null,o=null,l=null;try{l=new e(s,i)}catch{return null}return n.forEach(c=>{l.test(c)&&(!a||o.compare(c)===1)&&(a=c,o=new r(a,i))}),a},Ef}var Af,lv;function uj(){if(lv)return Af;lv=1;const r=Nt(),e=Wn(),t=Id();return Af=(s,i)=>{s=new e(s,i);let a=new r("0.0.0");if(s.test(a)||(a=new r("0.0.0-0"),s.test(a)))return a;a=null;for(let o=0;o<s.set.length;++o){const l=s.set[o];let c=null;l.forEach(u=>{const d=new r(u.semver.version);switch(u.operator){case">":d.prerelease.length===0?d.patch++:d.prerelease.push(0),d.raw=d.format();case"":case">=":(!c||t(d,c))&&(c=d);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${u.operator}`)}}),c&&(!a||t(a,c))&&(a=c)}return a&&s.test(a)?a:null},Af}var Of,cv;function dj(){if(cv)return Of;cv=1;const r=Wn();return Of=(t,n)=>{try{return new r(t,n).range||"*"}catch{return null}},Of}var Tf,uv;function Ug(){if(uv)return Tf;uv=1;const r=Nt(),e=$d(),{ANY:t}=e,n=Wn(),s=Md(),i=Id(),a=Fg(),o=zg(),l=Bg();return Tf=(u,d,h,f)=>{u=new r(u,f),d=new n(d,f);let p,m,g,_,y;switch(h){case">":p=i,m=o,g=a,_=">",y=">=";break;case"<":p=a,m=l,g=i,_="<",y="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(u,d,f))return!1;for(let b=0;b<d.set.length;++b){const w=d.set[b];let v=null,S=null;if(w.forEach(k=>{k.semver===t&&(k=new e(">=0.0.0")),v=v||k,S=S||k,p(k.semver,v.semver,f)?v=k:g(k.semver,S.semver,f)&&(S=k)}),v.operator===_||v.operator===y||(!S.operator||S.operator===_)&&m(u,S.semver))return!1;if(S.operator===y&&g(u,S.semver))return!1}return!0},Tf}var Rf,dv;function hj(){if(dv)return Rf;dv=1;const r=Ug();return Rf=(t,n,s)=>r(t,n,">",s),Rf}var Cf,hv;function fj(){if(hv)return Cf;hv=1;const r=Ug();return Cf=(t,n,s)=>r(t,n,"<",s),Cf}var If,fv;function pj(){if(fv)return If;fv=1;const r=Wn();return If=(t,n,s)=>(t=new r(t,s),n=new r(n,s),t.intersects(n,s)),If}var $f,pv;function mj(){if(pv)return $f;pv=1;const r=Md(),e=qn();return $f=(t,n,s)=>{const i=[];let a=null,o=null;const l=t.sort((h,f)=>e(h,f,s));for(const h of l)r(h,n,s)?(o=h,a||(a=h)):(o&&i.push([a,o]),o=null,a=null);a&&i.push([a,null]);const c=[];for(const[h,f]of i)h===f?c.push(h):!f&&h===l[0]?c.push("*"):f?h===l[0]?c.push(`<=${f}`):c.push(`${h} - ${f}`):c.push(`>=${h}`);const u=c.join(" || "),d=typeof n.raw=="string"?n.raw:String(n);return u.length<d.length?u:n},$f}var Mf,mv;function gj(){if(mv)return Mf;mv=1;const r=Wn(),e=$d(),{ANY:t}=e,n=Md(),s=qn(),i=(d,h,f={})=>{if(d===h)return!0;d=new r(d,f),h=new r(h,f);let p=!1;e:for(const m of d.set){for(const g of h.set){const _=l(m,g,f);if(p=p||_!==null,_)continue e}if(p)return!1}return!0},a=[new e(">=0.0.0-0")],o=[new e(">=0.0.0")],l=(d,h,f)=>{if(d===h)return!0;if(d.length===1&&d[0].semver===t){if(h.length===1&&h[0].semver===t)return!0;f.includePrerelease?d=a:d=o}if(h.length===1&&h[0].semver===t){if(f.includePrerelease)return!0;h=o}const p=new Set;let m,g;for(const x of d)x.operator===">"||x.operator===">="?m=c(m,x,f):x.operator==="<"||x.operator==="<="?g=u(g,x,f):p.add(x.semver);if(p.size>1)return null;let _;if(m&&g){if(_=s(m.semver,g.semver,f),_>0)return null;if(_===0&&(m.operator!==">="||g.operator!=="<="))return null}for(const x of p){if(m&&!n(x,String(m),f)||g&&!n(x,String(g),f))return null;for(const A of h)if(!n(x,String(A),f))return!1;return!0}let y,b,w,v,S=g&&!f.includePrerelease&&g.semver.prerelease.length?g.semver:!1,k=m&&!f.includePrerelease&&m.semver.prerelease.length?m.semver:!1;S&&S.prerelease.length===1&&g.operator==="<"&&S.prerelease[0]===0&&(S=!1);for(const x of h){if(v=v||x.operator===">"||x.operator===">=",w=w||x.operator==="<"||x.operator==="<=",m){if(k&&x.semver.prerelease&&x.semver.prerelease.length&&x.semver.major===k.major&&x.semver.minor===k.minor&&x.semver.patch===k.patch&&(k=!1),x.operator===">"||x.operator===">="){if(y=c(m,x,f),y===x&&y!==m)return!1}else if(m.operator===">="&&!n(m.semver,String(x),f))return!1}if(g){if(S&&x.semver.prerelease&&x.semver.prerelease.length&&x.semver.major===S.major&&x.semver.minor===S.minor&&x.semver.patch===S.patch&&(S=!1),x.operator==="<"||x.operator==="<="){if(b=u(g,x,f),b===x&&b!==g)return!1}else if(g.operator==="<="&&!n(g.semver,String(x),f))return!1}if(!x.operator&&(g||m)&&_!==0)return!1}return!(m&&w&&!g&&_!==0||g&&v&&!m&&_!==0||k||S)},c=(d,h,f)=>{if(!d)return h;const p=s(d.semver,h.semver,f);return p>0?d:p<0||h.operator===">"&&d.operator===">="?h:d},u=(d,h,f)=>{if(!d)return h;const p=s(d.semver,h.semver,f);return p<0?d:p>0||h.operator==="<"&&d.operator==="<="?h:d};return Mf=i,Mf}var Nf,gv;function _j(){if(gv)return Nf;gv=1;const r=Pl(),e=Rd(),t=Nt(),n=iP(),s=ca(),i=ZL(),a=GL(),o=JL(),l=KL(),c=XL(),u=YL(),d=QL(),h=ej(),f=qn(),p=tj(),m=nj(),g=Dg(),_=rj(),y=sj(),b=Id(),w=Fg(),v=aP(),S=oP(),k=Bg(),x=zg(),A=lP(),C=ij(),I=$d(),D=Wn(),Y=Md(),O=oj(),E=lj(),$=cj(),N=uj(),R=dj(),F=Ug(),V=hj(),ne=fj(),J=pj(),K=mj(),z=gj();return Nf={parse:s,valid:i,clean:a,inc:o,diff:l,major:c,minor:u,patch:d,prerelease:h,compare:f,rcompare:p,compareLoose:m,compareBuild:g,sort:_,rsort:y,gt:b,lt:w,eq:v,neq:S,gte:k,lte:x,cmp:A,coerce:C,Comparator:I,Range:D,satisfies:Y,toComparators:O,maxSatisfying:E,minSatisfying:$,minVersion:N,validRange:R,outside:F,gtr:V,ltr:ne,intersects:J,simplifyRange:K,subset:z,SemVer:t,re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:n.compareIdentifiers,rcompareIdentifiers:n.rcompareIdentifiers},Nf}_j();function Fr(r){if(!r||r.split("/").length>2||r.startsWith("/")||r.endsWith("/")||r.split(":").length>2)throw new Error(`Invalid identifier format: ${r}`);const[e,t]=r.split(":"),n=t||"latest";if(e.includes("/")){const[s,i]=e.split("/",2);if(!s||!i)throw new Error(`Invalid identifier format: ${r}`);return[s,i,n]}else{if(!e)throw new Error(`Invalid identifier format: ${r}`);return["-",e,n]}}class bj extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}}async function pe(r,e,t){let n;if(r.ok){t&&(n=await r.text());return}n=await r.text();const s=`Failed to ${e}. Received status [${r.status}]: ${r.statusText}. Server response: ${n}`;throw r.status===409?new bj(s):new Error(s)}var _v="[...]",yj={result:"[Circular]"},Cu=[],ki=[];const wj=new TextEncoder;function vj(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function fc(r){return wj.encode(r)}function Xt(r,e,t,n){var s;try{const i=JSON.stringify(r,e,t);return fc(i)}catch(i){if(!((s=i.message)!=null&&s.includes("Converting circular structure to JSON")))return console.warn("[WARNING]: LangSmith received unserializable value."),fc("[Unserializable]");console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),typeof n>"u"&&(n=vj()),om(r,"",0,[],void 0,0,n);let a;try{ki.length===0?a=JSON.stringify(r,e,t):a=JSON.stringify(r,xj(e),t)}catch{return fc("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;Cu.length!==0;){const o=Cu.pop();o.length===4?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}}return fc(a)}}function Lf(r,e,t,n){var s=Object.getOwnPropertyDescriptor(n,t);s.get!==void 0?s.configurable?(Object.defineProperty(n,t,{value:r}),Cu.push([n,t,e,s])):ki.push([e,t,r]):(n[t]=r,Cu.push([n,t,e]))}function om(r,e,t,n,s,i,a){i+=1;var o;if(typeof r=="object"&&r!==null){for(o=0;o<n.length;o++)if(n[o]===r){Lf(yj,r,e,s);return}if(typeof a.depthLimit<"u"&&i>a.depthLimit){Lf(_v,r,e,s);return}if(typeof a.edgesLimit<"u"&&t+1>a.edgesLimit){Lf(_v,r,e,s);return}if(n.push(r),Array.isArray(r))for(o=0;o<r.length;o++)om(r[o],o,o,n,r,i,a);else{var l=Object.keys(r);for(o=0;o<l.length;o++){var c=l[o];om(r[c],c,o,n,r,i,a)}}n.pop()}}function xj(r){return r=typeof r<"u"?r:function(e,t){return t},function(e,t){if(ki.length>0)for(var n=0;n<ki.length;n++){var s=ki[n];if(s[1]===e&&s[0]===t){t=s[2],ki.splice(n,1);break}}return r.call(this,e,t)}}function bv(r){const e=dP(),t=Nj(),n=r.extra??{},s=n.metadata;return r.extra={...n,runtime:{...e,...n==null?void 0:n.runtime},metadata:{...t,...t.revision_id||r.revision_id?{revision_id:r.revision_id??t.revision_id}:{},...s}},r}const kj=r=>{const e=(r==null?void 0:r.toString())??Zr("TRACING_SAMPLING_RATE");if(e===void 0)return;const t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t},Sj=r=>{const t=r.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};async function Pj(r){const e=[];for await(const t of r)e.push(t);return e}function jf(r){if(r!==void 0)return r.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const Ej=async r=>{if((r==null?void 0:r.status)===429){const e=parseInt(r.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};function yv(r){return typeof r=="number"?Number(r.toFixed(4)):r}class Aj{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;const n=new Promise(i=>{t=i}),s=Xt(e.item).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:t,itemPromise:n,size:s}),this.sizeBytes+=s,n}pop(e){var s;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const t=[];let n=0;for(;n+(((s=this.peek())==null?void 0:s.size)??0)<e&&this.items.length>0;){const i=this.items.shift();i&&(t.push(i),n+=i.size,this.sizeBytes-=i.size)}if(t.length===0&&this.items.length>0){const i=this.items.shift();t.push(i),n+=i.size,this.sizeBytes-=i.size}return[t.map(i=>({action:i.action,item:i.payload})),()=>t.forEach(i=>i.itemPromiseResolve())]}}const Oj=20971520,Tj=2500;class Xo{constructor(e={}){var n;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Aj}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:Bs("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1});const t=Xo.getDefaultClientConfig();if(this.tracingSampleRate=kj(e.tracingSamplingRate),this.apiUrl=jf(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=jf(e.apiKey??t.apiKey),this.webUrl=jf(e.webUrl??t.webUrl),(n=this.webUrl)!=null&&n.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new xw(e.callerOptions??{}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.batchIngestCaller=new xw({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:Ej}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode}static getDefaultClientConfig(){const e=Zr("API_KEY"),t=Zr("ENDPOINT")??"https://api.smith.langchain.com",n=Zr("HIDE_INPUTS")==="true",s=Zr("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:Sj(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${cP}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const t={...e};return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){const n=(t==null?void 0:t.toString())??"",s=`${this.apiUrl}${e}?${n}`,i=await this.caller.call(ee(),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await pe(i,`Failed to fetch ${e}`),i}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,n){let s=Number(t.get("offset"))||0;const i=Number(t.get("limit"))||100;for(;;){t.set("offset",String(s)),t.set("limit",String(i));const a=`${this.apiUrl}${e}?${t}`,o=await this.caller.call(ee(),a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await pe(o,`Failed to fetch ${e}`);const l=n?n(await o.json()):await o.json();if(l.length===0||(yield l,l.length<i))break;s+=l.length}}async*_getCursorPaginatedList(e,t=null,n="POST",s="runs"){const i=t?{...t}:{};for(;;){const o=await(await this.caller.call(ee(),`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(i)})).json();if(!o||!o[s])break;yield o[s];const l=o.cursors;if(!l||!l.next)break;i.cursor=l.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){const n=[];for(const s of e)this.filteredPostUuids.has(s.id)?this.filteredPostUuids.delete(s.id):n.push(s);return n}else{const n=[];for(const s of e){const i=s.trace_id??s.id;this.filteredPostUuids.has(i)||(s.id===i?this._shouldSample()?n.push(s):this.filteredPostUuids.add(i):n.push(s))}return n}}async _getBatchSizeLimitBytes(){var t;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((t=e.batch_ingest_config)==null?void 0:t.size_limit_bytes)??Oj}async _getMultiPartSupport(){var t;return((t=(await this._ensureServerInfo()).instance_flags)==null?void 0:t.dataset_examples_multipart_enabled)??!1}drainAutoBatchQueue(e){const t=[];for(;this.autoBatchQueue.items.length>0;){const[n,s]=this.autoBatchQueue.pop(e);if(!n.length){s();break}const i=this._processBatch(n,s).catch(console.error);t.push(i)}return Promise.all(t)}async _processBatch(e,t){var n;if(!e.length){t();return}try{const s={runCreates:e.filter(a=>a.action==="create").map(a=>a.item),runUpdates:e.filter(a=>a.action==="update").map(a=>a.item)},i=await this._ensureServerInfo();(n=i==null?void 0:i.batch_ingest_config)!=null&&n.use_multipart_endpoint?await this.multipartIngestRuns(s):await this.batchIngestRuns(s)}finally{t()}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=bv(e.item));const t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;const n=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>n&&this.drainAutoBatchQueue(n),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(n)},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){const e=await ee()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(Tj),...this.fetchOptions});return await pe(e,"get server info"),e.json()}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch{console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to batch operations and default limits.")}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},n=e.project_name;delete e.project_name;const s=this.prepareRunCreateOrUpdateInputs({session_name:n,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){this.processRunOperation({action:"create",item:s}).catch(console.error);return}const i=bv(s),a=await this.caller.call(ee(),`${this.apiUrl}/runs`,{method:"POST",headers:t,body:Xt(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await pe(a,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let n=(e==null?void 0:e.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[],s=(t==null?void 0:t.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[];if(n.length>0&&s.length>0){const o=n.reduce((c,u)=>(u.id&&(c[u.id]=u),c),{}),l=[];for(const c of s)c.id!==void 0&&o[c.id]?o[c.id]={...o[c.id],...c}:l.push(c);n=Object.values(o),s=l}const i={post:n,patch:s};if(!i.post.length&&!i.patch.length)return;const a={post:[],patch:[]};for(const o of["post","patch"]){const l=o,c=i[l].reverse();let u=c.pop();for(;u!==void 0;)a[l].push(u),u=c.pop()}(a.post.length>0||a.patch.length>0)&&await this._postBatchIngestRuns(Xt(a))}async _postBatchIngestRuns(e){const t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},n=await this.batchIngestCaller.call(ee(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await pe(n,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;const n={};let s=[];for(const u of e??[]){const d=this.prepareRunCreateOrUpdateInputs(u);d.id!==void 0&&d.attachments!==void 0&&(n[d.id]=d.attachments),delete d.attachments,s.push(d)}let i=[];for(const u of t??[])i.push(this.prepareRunCreateOrUpdateInputs(u));if(s.find(u=>u.trace_id===void 0||u.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(i.find(u=>u.trace_id===void 0||u.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(s.length>0&&i.length>0){const u=s.reduce((h,f)=>(f.id&&(h[f.id]=f),h),{}),d=[];for(const h of i)h.id!==void 0&&u[h.id]?u[h.id]={...u[h.id],...h}:d.push(h);s=Object.values(u),i=d}if(s.length===0&&i.length===0)return;const l=[],c=[];for(const[u,d]of[["post",s],["patch",i]])for(const h of d){const{inputs:f,outputs:p,events:m,attachments:g,..._}=h,y={inputs:f,outputs:p,events:m},b=Xt(_);c.push({name:`${u}.${_.id}`,payload:new Blob([b],{type:`application/json; length=${b.length}`})});for(const[w,v]of Object.entries(y)){if(v===void 0)continue;const S=Xt(v);c.push({name:`${u}.${_.id}.${w}`,payload:new Blob([S],{type:`application/json; length=${S.length}`})})}if(_.id!==void 0){const w=n[_.id];if(w){delete n[_.id];for(const[v,S]of Object.entries(w)){let k,x;if(Array.isArray(S)?[k,x]=S:(k=S.mimeType,x=S.data),v.includes(".")){console.warn(`Skipping attachment '${v}' for run ${_.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}c.push({name:`attachment.${_.id}.${v}`,payload:new Blob([x],{type:`${k}; length=${x.byteLength}`})})}}}l.push(`trace=${_.trace_id},id=${_.id}`)}await this._sendMultipartRequest(c,l.join("; "))}async _sendMultipartRequest(e,t){try{const n="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),s=[];for(const l of e)s.push(new Blob([`--${n}\r
`])),s.push(new Blob([`Content-Disposition: form-data; name="${l.name}"\r
`,`Content-Type: ${l.payload.type}\r
\r
`])),s.push(l.payload),s.push(new Blob([`\r
`]));s.push(new Blob([`--${n}--\r
`]));const a=await new Blob(s).arrayBuffer(),o=await this.batchIngestCaller.call(ee(),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers,"Content-Type":`multipart/form-data; boundary=${n}`},body:a,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await pe(o,"ingest multipart runs",!0)}catch(n){console.warn(`${n.message.trim()}

Context: ${t}`)}}async updateRun(e,t){ce(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));const n={...t,id:e};if(!this._filterForSampling([n],!0).length)return;if(this.autoBatchTracing&&n.trace_id!==void 0&&n.dotted_order!==void 0){if(t.end_time!==void 0&&n.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:n}).catch(console.error);return}else this.processRunOperation({action:"update",item:n}).catch(console.error);return}const s={...this.headers,"Content-Type":"application/json"},i=await this.caller.call(ee(),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:s,body:Xt(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await pe(i,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){ce(e);let n=await this._get(`/runs/${e}`);return t&&n.child_run_ids&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:t,projectOpts:n}){if(t!==void 0){let s;t.session_id?s=t.session_id:n!=null&&n.projectName?s=(await this.readProject({projectName:n==null?void 0:n.projectName})).id:n!=null&&n.projectId?s=n==null?void 0:n.projectId:s=(await this.readProject({projectName:Zr("PROJECT")||"default"})).id;const i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${s}/r/${t.id}?poll=true`}else if(e!==void 0){const s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await Pj(this.listRuns({id:e.child_run_ids})),n={},s={};t.sort((i,a)=>((i==null?void 0:i.dotted_order)??"").localeCompare((a==null?void 0:a.dotted_order)??""));for(const i of t){if(i.parent_run_id===null||i.parent_run_id===void 0)throw new Error(`Child run ${i.id} has no parent`);i.parent_run_id in n||(n[i.parent_run_id]=[]),n[i.parent_run_id].push(i),s[i.id]=i}e.child_runs=n[e.id]||[];for(const i in n)i!==e.id&&(s[i].child_runs=n[i]);return e}async*listRuns(e){const{projectId:t,projectName:n,parentRunId:s,traceId:i,referenceExampleId:a,startTime:o,executionOrder:l,isRoot:c,runType:u,error:d,id:h,query:f,filter:p,traceFilter:m,treeFilter:g,limit:_,select:y}=e;let b=[];if(t&&(b=Array.isArray(t)?t:[t]),n){const k=Array.isArray(n)?n:[n],x=await Promise.all(k.map(A=>this.readProject({projectName:A}).then(C=>C.id)));b.push(...x)}const w=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],v={session:b.length?b:null,run_type:u,reference_example:a,query:f,filter:p,trace_filter:m,tree_filter:g,execution_order:l,parent_run:s,start_time:o?o.toISOString():null,error:d,id:h,limit:_,trace:i,select:y||w,is_root:c};let S=0;for await(const k of this._getCursorPaginatedList("/runs/query",v))if(_){if(S>=_)break;if(k.length+S>_){yield*k.slice(0,_-S);break}S+=k.length,yield*k}else yield*k}async getRunStats({id:e,trace:t,parentRun:n,runType:s,projectNames:i,projectIds:a,referenceExampleIds:o,startTime:l,endTime:c,error:u,query:d,filter:h,traceFilter:f,treeFilter:p,isRoot:m,dataSourceType:g}){let _=a||[];i&&(_=[...a||[],...await Promise.all(i.map(S=>this.readProject({projectName:S}).then(k=>k.id)))]);const b=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:n,run_type:s,session:_,reference_example:o,start_time:l,end_time:c,error:u,query:d,filter:h,trace_filter:f,tree_filter:p,is_root:m,data_source_type:g}).filter(([S,k])=>k!==void 0));return await(await this.caller.call(ee(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(b),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:t}={}){const n={run_id:e,share_token:t||At()};ce(e);const i=await(await this.caller.call(ee(),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(i===null||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){ce(e);const t=await this.caller.call(ee(),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await pe(t,"unshare run",!0)}async readRunSharedLink(e){ce(e);const n=await(await this.caller.call(ee(),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(n===null||!("share_token"in n)))return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const n=new URLSearchParams({share_token:e});if(t!==void 0)for(const a of t)n.append("id",a);return ce(e),await(await this.caller.call(ee(),`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),ce(e);const s=await(await this.caller.call(ee(),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const n={dataset_id:e};ce(e);const i=await(await this.caller.call(ee(),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async unshareDataset(e){ce(e);const t=await this.caller.call(ee(),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await pe(t,"unshare dataset",!0)}async readSharedDataset(e){return ce(e),await(await this.caller.call(ee(),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,t){const n={};t!=null&&t.exampleIds&&(n.id=t.exampleIds);const s=new URLSearchParams;Object.entries(n).forEach(([o,l])=>{Array.isArray(l)?l.forEach(c=>s.append(o,c)):s.append(o,l)});const i=await this.caller.call(ee(),`${this.apiUrl}/public/${e}/examples?${s.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),a=await i.json();if(!i.ok)throw"detail"in a?new Error(`Failed to list shared examples.
Status: ${i.status}
Message: ${a.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${i.status} ${i.statusText}`);return a.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:n=null,upsert:s=!1,projectExtra:i=null,referenceDatasetId:a=null}){const o=s?"?upsert=true":"",l=`${this.apiUrl}/sessions${o}`,c=i||{};n&&(c.metadata=n);const u={name:e,extra:c,description:t};a!==null&&(u.reference_dataset_id=a);const d=await this.caller.call(ee(),l,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await pe(d,"create project"),await d.json()}async updateProject(e,{name:t=null,description:n=null,metadata:s=null,projectExtra:i=null,endTime:a=null}){const o=`${this.apiUrl}/sessions/${e}`;let l=i;s&&(l={...l||{},metadata:s});const c={name:t,extra:l,description:n,end_time:a?new Date(a).toISOString():null},u=await this.caller.call(ee(),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await pe(u,"update project"),await u.json()}async hasProject({projectId:e,projectName:t}){let n="/sessions";const s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)ce(e),n+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");const i=await this.caller.call(ee(),`${this.apiUrl}${n}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const a=await i.json();return i.ok?Array.isArray(a)?a.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:n}){let s="/sessions";const i=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)ce(e),s+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide projectName or projectId");n!==void 0&&i.append("include_stats",n.toString());const a=await this._get(s,i);let o;if(Array.isArray(a)){if(a.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=a[0]}else o=a;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");const n=await this.readProject({projectId:e,projectName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${n.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");const n=await this.readDataset({datasetId:e,datasetName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${n.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:n,referenceDatasetId:s,referenceDatasetName:i,referenceFree:a,metadata:o}={}){const l=new URLSearchParams;if(e!==void 0)for(const c of e)l.append("id",c);if(t!==void 0&&l.append("name",t),n!==void 0&&l.append("name_contains",n),s!==void 0)l.append("reference_dataset",s);else if(i!==void 0){const c=await this.readDataset({datasetName:i});l.append("reference_dataset",c.id)}a!==void 0&&l.append("reference_free",a.toString()),o!==void 0&&l.append("metadata",JSON.stringify(o));for await(const c of this._getPaginated("/sessions",l))yield*c}async deleteProject({projectId:e,projectName:t}){let n;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?n=(await this.readProject({projectName:t})).id:n=e,ce(n);const s=await this.caller.call(ee(),`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await pe(s,`delete session ${n} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:n,outputKeys:s,description:i,dataType:a,name:o}){const l=`${this.apiUrl}/datasets/upload`,c=new FormData;c.append("file",e,t),n.forEach(h=>{c.append("input_keys",h)}),s.forEach(h=>{c.append("output_keys",h)}),i&&c.append("description",i),a&&c.append("data_type",a),o&&c.append("name",o);const u=await this.caller.call(ee(),l,{method:"POST",headers:this.headers,body:c,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await pe(u,"upload CSV"),await u.json()}async createDataset(e,{description:t,dataType:n,inputsSchema:s,outputsSchema:i,metadata:a}={}){const o={name:e,description:t,extra:a?{metadata:a}:void 0};n&&(o.data_type=n),s&&(o.inputs_schema_definition=s),i&&(o.outputs_schema_definition=i);const l=await this.caller.call(ee(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await pe(l,"create dataset"),await l.json()}async readDataset({datasetId:e,datasetName:t}){let n="/datasets";const s=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)ce(e),n+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");const i=await this._get(n,s);let a;if(Array.isArray(i)){if(i.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);a=i[0]}else a=i;return a}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(n){if(n instanceof Error&&n.message.toLocaleLowerCase().includes("not found"))return!1;throw n}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:n,toVersion:s}){let i=e;if(i===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(i!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");i===void 0&&(i=(await this.readDataset({datasetName:t})).id);const a=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${i}/versions/diff`,a)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const n="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${n}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:n,datasetName:s,datasetNameContains:i,metadata:a}={}){const o="/datasets",l=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(n!==void 0)for(const c of n)l.append("id",c);s!==void 0&&l.append("name",s),i!==void 0&&l.append("name_contains",i),a!==void 0&&l.append("metadata",JSON.stringify(a));for await(const c of this._getPaginated(o,l))yield*c}async updateDataset(e){const{datasetId:t,datasetName:n,...s}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");const i=t??(await this.readDataset({datasetName:n})).id;ce(i);const a=await this.caller.call(ee(),`${this.apiUrl}/datasets/${i}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await pe(a,"update dataset"),await a.json()}async updateDatasetTag(e){const{datasetId:t,datasetName:n,asOf:s,tag:i}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");const a=t??(await this.readDataset({datasetName:n})).id;ce(a);const o=await this.caller.call(ee(),`${this.apiUrl}/datasets/${a}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:typeof s=="string"?s:s.toISOString(),tag:i}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await pe(o,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:t}){let n="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(await this.readDataset({datasetName:t})).id),s!==void 0)ce(s),n+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");const i=await this.caller.call(ee(),this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await pe(i,`delete ${n}`),await i.json()}async indexDataset({datasetId:e,datasetName:t,tag:n}){let s=e;if(!s&&!t)throw new Error("Must provide either datasetName or datasetId");if(s&&t)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(await this.readDataset({datasetName:t})).id),ce(s);const i={tag:n},a=await this.caller.call(ee(),`${this.apiUrl}/datasets/${s}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await pe(a,"index dataset"),await a.json()}async similarExamples(e,t,n,{filter:s}={}){const i={limit:n,inputs:e};s!==void 0&&(i.filter=s),ce(t);const a=await this.caller.call(ee(),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await pe(a,"fetch similar examples"),(await a.json()).examples}async createExample(e,t,n){var u;if(wv(e)&&(t!==void 0||n!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let s=t?n==null?void 0:n.datasetId:e.dataset_id;const i=t?n==null?void 0:n.datasetName:e.dataset_name;if(s===void 0&&i===void 0)throw new Error("Must provide either datasetName or datasetId");if(s!==void 0&&i!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");s===void 0&&(s=(await this.readDataset({datasetName:i})).id);const a=(t?n==null?void 0:n.createdAt:e.created_at)||new Date;let o;wv(e)?o=e:o={inputs:e,outputs:t,created_at:a==null?void 0:a.toISOString(),id:n==null?void 0:n.exampleId,metadata:n==null?void 0:n.metadata,split:n==null?void 0:n.split,source_run_id:n==null?void 0:n.sourceRunId,use_source_run_io:n==null?void 0:n.useSourceRunIO,use_source_run_attachments:n==null?void 0:n.useSourceRunAttachments,attachments:n==null?void 0:n.attachments};const l=await this._uploadExamplesMultipart(s,[o]);return await this.readExample(((u=l.example_ids)==null?void 0:u[0])??At())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];const y=e;let b=y[0].dataset_id;const w=y[0].dataset_name;if(b===void 0&&w===void 0)throw new Error("Must provide either datasetName or datasetId");if(b!==void 0&&w!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");b===void 0&&(b=(await this.readDataset({datasetName:w})).id);const v=await this._uploadExamplesMultipart(b,y);return await Promise.all(v.example_ids.map(k=>this.readExample(k)))}const{inputs:t,outputs:n,metadata:s,splits:i,sourceRunIds:a,useSourceRunIOs:o,useSourceRunAttachments:l,attachments:c,exampleIds:u,datasetId:d,datasetName:h}=e;if(t===void 0)throw new Error("Must provide inputs when using legacy parameters");let f=d;const p=h;if(f===void 0&&p===void 0)throw new Error("Must provide either datasetName or datasetId");if(f!==void 0&&p!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");f===void 0&&(f=(await this.readDataset({datasetName:p})).id);const m=t.map((y,b)=>({dataset_id:f,inputs:y,outputs:n==null?void 0:n[b],metadata:s==null?void 0:s[b],split:i==null?void 0:i[b],id:u==null?void 0:u[b],attachments:c==null?void 0:c[b],source_run_id:a==null?void 0:a[b],use_source_run_io:o==null?void 0:o[b],use_source_run_attachments:l==null?void 0:l[b]})),g=await this._uploadExamplesMultipart(f,m);return await Promise.all(g.example_ids.map(y=>this.readExample(y)))}async createLLMExample(e,t,n){return this.createExample({input:e},{output:t},n)}async createChatExample(e,t,n){const s=e.map(a=>kw(a)?Sw(a):a),i=kw(t)?Sw(t):t;return this.createExample({input:s},{output:i},n)}async readExample(e){ce(e);const t=`/examples/${e}`,n=await this._get(t),{attachment_urls:s,...i}=n,a=i;return s&&(a.attachments=Object.entries(s).reduce((o,[l,c])=>(o[l.slice(11)]={presigned_url:c.presigned_url,mime_type:c.mime_type},o),{})),a}async*listExamples({datasetId:e,datasetName:t,exampleIds:n,asOf:s,splits:i,inlineS3Urls:a,metadata:o,limit:l,offset:c,filter:u,includeAttachments:d}={}){let h;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)h=e;else if(t!==void 0)h=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const f=new URLSearchParams({dataset:h}),p=s?typeof s=="string"?s:s==null?void 0:s.toISOString():void 0;p&&f.append("as_of",p);const m=a??!0;if(f.append("inline_s3_urls",m.toString()),n!==void 0)for(const _ of n)f.append("id",_);if(i!==void 0)for(const _ of i)f.append("splits",_);if(o!==void 0){const _=JSON.stringify(o);f.append("metadata",_)}l!==void 0&&f.append("limit",l.toString()),c!==void 0&&f.append("offset",c.toString()),u!==void 0&&f.append("filter",u),d===!0&&["attachment_urls","outputs","metadata"].forEach(_=>f.append("select",_));let g=0;for await(const _ of this._getPaginated("/examples",f)){for(const y of _){const{attachment_urls:b,...w}=y,v=w;b&&(v.attachments=Object.entries(b).reduce((S,[k,x])=>(S[k.slice(11)]={presigned_url:x.presigned_url,mime_type:x.mime_type||void 0},S),{})),yield v,g++}if(l!==void 0&&g>=l)break}}async deleteExample(e){ce(e);const t=`/examples/${e}`,n=await this.caller.call(ee(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await pe(n,`delete ${t}`),await n.json()}async updateExample(e,t){let n;t?n=e:n=e.id,ce(n);let s;t?s={id:n,...t}:s=e;let i;return s.dataset_id!==void 0?i=s.dataset_id:i=(await this.readExample(n)).dataset_id,this._updateExamplesMultipart(i,[s])}async updateExamples(e){let t;return e[0].dataset_id===void 0?t=(await this.readExample(e[0].id)).dataset_id:t=e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:n,tag:s}){let i;if(e?i=e:i=(await this.readDataset({datasetName:t})).id,ce(i),n&&s||!n&&!s)throw new Error("Exactly one of asOf and tag must be specified.");const a=new URLSearchParams;n!==void 0&&a.append("as_of",typeof n=="string"?n:n.toISOString()),s!==void 0&&a.append("tag",s);const o=await this.caller.call(ee(),`${this.apiUrl}/datasets/${i}/version?${a.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await pe(o,"read dataset version"),await o.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:n}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:t})).id:s=e,ce(s);const i=new URLSearchParams,a=n?typeof n=="string"?n:n==null?void 0:n.toISOString():void 0;return a&&i.append("as_of",a),await this._get(`/datasets/${s}/splits`,i)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:n,exampleIds:s,remove:i=!1}){let a;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?a=(await this.readDataset({datasetName:t})).id:a=e,ce(a);const o={split_name:n,examples:s.map(c=>(ce(c),c)),remove:i},l=await this.caller.call(ee(),`${this.apiUrl}/datasets/${a}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await pe(l,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:n,loadChildRuns:s,referenceExample:i}={loadChildRuns:!1}){sP("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let a;if(typeof e=="string")a=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)a=e;else throw new Error(`Invalid run type: ${typeof e}`);a.reference_example_id!==null&&a.reference_example_id!==void 0&&(i=await this.readExample(a.reference_example_id));const o=await t.evaluateRun(a,i),[l,c]=await this._logEvaluationFeedback(o,a,n);return c[0]}async createFeedback(e,t,{score:n,value:s,correction:i,comment:a,sourceInfo:o,feedbackSourceType:l="api",sourceRunId:c,feedbackId:u,feedbackConfig:d,projectId:h,comparativeExperimentId:f}){var y;if(!e&&!h)throw new Error("One of runId or projectId must be provided");if(e&&h)throw new Error("Only one of runId or projectId can be provided");const p={type:l??"api",metadata:o??{}};c!==void 0&&(p==null?void 0:p.metadata)!==void 0&&!p.metadata.__run&&(p.metadata.__run={run_id:c}),(p==null?void 0:p.metadata)!==void 0&&((y=p.metadata.__run)==null?void 0:y.run_id)!==void 0&&ce(p.metadata.__run.run_id);const m={id:u??At(),run_id:e,key:t,score:yv(n),value:s,correction:i,comment:a,feedback_source:p,comparative_experiment_id:f,feedbackConfig:d,session_id:h},g=`${this.apiUrl}/feedback`,_=await this.caller.call(ee(),g,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(m),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await pe(_,"create feedback",!0),m}async updateFeedback(e,{score:t,value:n,correction:s,comment:i}){const a={};t!=null&&(a.score=yv(t)),n!=null&&(a.value=n),s!=null&&(a.correction=s),i!=null&&(a.comment=i),ce(e);const o=await this.caller.call(ee(),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await pe(o,"update feedback",!0)}async readFeedback(e){ce(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){ce(e);const t=`/feedback/${e}`,n=await this.caller.call(ee(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await pe(n,`delete ${t}`),await n.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:n}={}){const s=new URLSearchParams;if(e&&s.append("run",e.join(",")),t)for(const i of t)s.append("key",i);if(n)for(const i of n)s.append("source",i);for await(const i of this._getPaginated("/feedback",s))yield*i}async createPresignedFeedbackToken(e,t,{expiration:n,feedbackConfig:s}={}){const i={run_id:e,feedback_key:t,feedback_config:s};return n?typeof n=="string"?i.expires_at=n:(n!=null&&n.hours||n!=null&&n.minutes||n!=null&&n.days)&&(i.expires_in=n):i.expires_in={hours:3},await(await this.caller.call(ee(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:n,createdAt:s,description:i,metadata:a,id:o}){var u;if(t.length===0)throw new Error("At least one experiment is required");if(n||(n=(await this.readProject({projectId:t[0]})).reference_dataset_id),!n==null)throw new Error("A reference dataset is required");const l={id:o,name:e,experiment_ids:t,reference_dataset_id:n,description:i,created_at:(u=s??new Date)==null?void 0:u.toISOString(),extra:{}};return a&&(l.extra.metadata=a),await(await this.caller.call(ee(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){ce(e);const t=new URLSearchParams({run_id:e});for await(const n of this._getPaginated("/feedback/tokens",t))yield*n}_selectEvalResults(e){let t;return"results"in e?t=e.results:Array.isArray(e)?t=e:t=[e],t}async _logEvaluationFeedback(e,t,n){const s=this._selectEvalResults(e),i=[];for(const a of s){let o=n||{};a.evaluatorInfo&&(o={...a.evaluatorInfo,...o});let l=null;a.targetRunId?l=a.targetRunId:t&&(l=t.id),i.push(await this.createFeedback(l,a.key,{score:a.score,value:a.value,comment:a.comment,correction:a.correction,sourceInfo:o,sourceRunId:a.sourceRunId,feedbackConfig:a.feedbackConfig,feedbackSourceType:"model"}))}return[s,i]}async logEvaluationFeedback(e,t,n){const[s]=await this._logEvaluationFeedback(e,t,n);return s}async*listAnnotationQueues(e={}){const{queueIds:t,name:n,nameContains:s,limit:i}=e,a=new URLSearchParams;t&&t.forEach((l,c)=>{ce(l,`queueIds[${c}]`),a.append("ids",l)}),n&&a.append("name",n),s&&a.append("name_contains",s),a.append("limit",(i!==void 0?Math.min(i,100):100).toString());let o=0;for await(const l of this._getPaginated("/annotation-queues",a))if(yield*l,o++,i!==void 0&&o>=i)break}async createAnnotationQueue(e){const{name:t,description:n,queueId:s}=e,i={name:t,description:n,id:s||At()},a=await this.caller.call(ee(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(i).filter(([l,c])=>c!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await pe(a,"create annotation queue"),await a.json()}async readAnnotationQueue(e){const t=await this.listAnnotationQueues({queueIds:[e]}).next();if(t.done)throw new Error(`Annotation queue with ID ${e} not found`);return t.value}async updateAnnotationQueue(e,t){const{name:n,description:s}=t,i=await this.caller.call(ee(),`${this.apiUrl}/annotation-queues/${ce(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:n,description:s}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await pe(i,"update annotation queue")}async deleteAnnotationQueue(e){const t=await this.caller.call(ee(),`${this.apiUrl}/annotation-queues/${ce(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await pe(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){const n=await this.caller.call(ee(),`${this.apiUrl}/annotation-queues/${ce(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((s,i)=>ce(s,`runIds[${i}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await pe(n,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){const n=`/annotation-queues/${ce(e,"queueId")}/run`,s=await this.caller.call(ee(),`${this.apiUrl}${n}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await pe(s,"get run from annotation queue"),await s.json()}async deleteRunFromAnnotationQueue(e,t){const n=await this.caller.call(ee(),`${this.apiUrl}/annotation-queues/${ce(e,"queueId")}/runs/${ce(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await pe(n,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){const t=await this.caller.call(ee(),`${this.apiUrl}/annotation-queues/${ce(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await pe(t,"get size from annotation queue"),await t.json()}async _currentTenantIsOwner(e){const t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){const n=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${n.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){const t=await this.caller.call(ee(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await t.json();if(!t.ok){const s=typeof n.detail=="string"?n.detail:JSON.stringify(n.detail),i=new Error(`Error ${t.status}: ${t.statusText}
${s}`);throw i.statusCode=t.status,i}if(n.commits.length!==0)return n.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){const[n,s,i]=Fr(e),a=await this.caller.call(ee(),`${this.apiUrl}/likes/${n}/${s}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await pe(a,`${t?"like":"unlike"} prompt`),await a.json()}async _getPromptUrl(e){const[t,n,s]=Fr(e);if(await this._currentTenantIsOwner(t)){const i=await this._getSettings();return s!=="latest"?`${this.getHostUrl()}/prompts/${n}/${s.substring(0,8)}?organizationId=${i.id}`:`${this.getHostUrl()}/prompts/${n}?organizationId=${i.id}`}else return s!=="latest"?`${this.getHostUrl()}/hub/${t}/${n}/${s.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${n}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,n=>n.commits))yield*t}async*listPrompts(e){const t=new URLSearchParams;t.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&t.append("is_public",e.isPublic.toString()),e!=null&&e.query&&t.append("query",e.query);for await(const n of this._getPaginated("/repos",t,s=>s.repos))yield*n}async getPrompt(e){const[t,n,s]=Fr(e),i=await this.caller.call(ee(),`${this.apiUrl}/repos/${t}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(i.status===404)return null;await pe(i,"get prompt");const a=await i.json();return a.repo?a.repo:null}async createPrompt(e,t){const n=await this._getSettings();if(t!=null&&t.isPublic&&!n.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[s,i,a]=Fr(e);if(!await this._currentTenantIsOwner(s))throw await this._ownerConflictError("create a prompt",s);const o={repo_handle:i,...(t==null?void 0:t.description)&&{description:t.description},...(t==null?void 0:t.readme)&&{readme:t.readme},...(t==null?void 0:t.tags)&&{tags:t.tags},is_public:!!(t!=null&&t.isPublic)},l=await this.caller.call(ee(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await pe(l,"create prompt");const{repo:c}=await l.json();return c}async createCommit(e,t,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[s,i,a]=Fr(e),o=(n==null?void 0:n.parentCommitHash)==="latest"||!(n!=null&&n.parentCommitHash)?await this._getLatestCommitHash(`${s}/${i}`):n==null?void 0:n.parentCommitHash,l={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},c=await this.caller.call(ee(),`${this.apiUrl}/commits/${s}/${i}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await pe(c,"create commit");const u=await c.json();return this._getPromptUrl(`${s}/${i}${u.commit_hash?`:${u.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){var o;if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const n=new FormData;for(const l of t){const c=l.id,u={...l.metadata&&{metadata:l.metadata},...l.split&&{split:l.split}},d=Xt(u),h=new Blob([d],{type:"application/json"});if(n.append(c,h),l.inputs){const f=Xt(l.inputs),p=new Blob([f],{type:"application/json"});n.append(`${c}.inputs`,p)}if(l.outputs){const f=Xt(l.outputs),p=new Blob([f],{type:"application/json"});n.append(`${c}.outputs`,p)}if(l.attachments)for(const[f,p]of Object.entries(l.attachments)){let m,g;Array.isArray(p)?[m,g]=p:(m=p.mimeType,g=p.data);const _=new Blob([g],{type:`${m}; length=${g.byteLength}`});n.append(`${c}.attachment.${f}`,_)}if(l.attachments_operations){const f=Xt(l.attachments_operations),p=new Blob([f],{type:"application/json"});n.append(`${c}.attachments_operations`,p)}}const s=e??((o=t[0])==null?void 0:o.dataset_id);return await(await this.caller.call(ee(),`${this.apiUrl}/v1/platform/datasets/${s}/examples`,{method:"PATCH",headers:this.headers,body:n})).json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const n=new FormData;for(const a of t){const o=(a.id??At()).toString(),l={created_at:a.created_at,...a.metadata&&{metadata:a.metadata},...a.split&&{split:a.split},...a.source_run_id&&{source_run_id:a.source_run_id},...a.use_source_run_io&&{use_source_run_io:a.use_source_run_io},...a.use_source_run_attachments&&{use_source_run_attachments:a.use_source_run_attachments}},c=Xt(l),u=new Blob([c],{type:"application/json"});if(n.append(o,u),a.inputs){const d=Xt(a.inputs),h=new Blob([d],{type:"application/json"});n.append(`${o}.inputs`,h)}if(a.outputs){const d=Xt(a.outputs),h=new Blob([d],{type:"application/json"});n.append(`${o}.outputs`,h)}if(a.attachments)for(const[d,h]of Object.entries(a.attachments)){let f,p;Array.isArray(h)?[f,p]=h:(f=h.mimeType,p=h.data);const m=new Blob([p],{type:`${f}; length=${p.byteLength}`});n.append(`${o}.attachment.${d}`,m)}}const s=await this.caller.call(ee(),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"POST",headers:this.headers,body:n});return await pe(s,"upload examples"),await s.json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[n,s]=Fr(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("update a prompt",n);const i={};if((t==null?void 0:t.description)!==void 0&&(i.description=t.description),(t==null?void 0:t.readme)!==void 0&&(i.readme=t.readme),(t==null?void 0:t.tags)!==void 0&&(i.tags=t.tags),(t==null?void 0:t.isPublic)!==void 0&&(i.is_public=t.isPublic),(t==null?void 0:t.isArchived)!==void 0&&(i.is_archived=t.isArchived),Object.keys(i).length===0)throw new Error("No valid update options provided");const a=await this.caller.call(ee(),`${this.apiUrl}/repos/${n}/${s}`,{method:"PATCH",body:JSON.stringify(i),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await pe(a,"update prompt"),a.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[t,n,s]=Fr(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return await(await this.caller.call(ee(),`${this.apiUrl}/repos/${t}/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,t){const[n,s,i]=Fr(e),a=await this.caller.call(ee(),`${this.apiUrl}/commits/${n}/${s}/${i}${t!=null&&t.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await pe(a,"pull prompt commit");const o=await a.json();return{owner:n,repo:s,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,t){const n=await this.pullPromptCommit(e,{includeModel:t==null?void 0:t.includeModel});return JSON.stringify(n.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(s=>s!=="object")&&await this.updatePrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}):await this.createPrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}),t!=null&&t.object?await this.createCommit(e,t==null?void 0:t.object,{parentCommitHash:t==null?void 0:t.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){const{sourceApiUrl:n=this.apiUrl,datasetName:s}=t,[i,a]=this.parseTokenOrUrl(e,n),o=new Xo({apiUrl:i,apiKey:"placeholder"}),l=await o.readSharedDataset(a),c=s||l.name;try{if(await this.hasDataset({datasetId:c})){console.log(`Dataset ${c} already exists in your tenant. Skipping.`);return}}catch{}const u=await o.listSharedExamples(a),d=await this.createDataset(c,{description:l.description,dataType:l.data_type||"kv",inputsSchema:l.inputs_schema_definition??void 0,outputsSchema:l.outputs_schema_definition??void 0});try{await this.createExamples({inputs:u.map(h=>h.inputs),outputs:u.flatMap(h=>h.outputs?[h.outputs]:[]),datasetId:d.id})}catch(h){throw console.error(`An error occurred while creating dataset ${c}. You should delete it manually.`),h}}parseTokenOrUrl(e,t,n=2,s="dataset"){try{return ce(e),[t,e]}catch{}try{const a=new URL(e).pathname.split("/").filter(o=>o!=="");if(a.length>=n){const o=a[a.length-n];return[t,o]}else throw new Error(`Invalid public ${s} URL: ${e}`)}catch{throw new Error(`Invalid public ${s} URL or token: ${e}`)}}awaitPendingTraceBatches(){return this.manualFlushMode?(console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve()):Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()])}}function wv(r){return"dataset_id"in r||"dataset_name"in r}const cP="0.3.18";var fo={};let fr;const Rj=()=>typeof window<"u"&&typeof window.document<"u",Cj=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Ij=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),uP=()=>typeof Deno<"u",$j=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!uP(),Mj=()=>fr||(Rj()?fr="browser":$j()?fr="node":Cj()?fr="webworker":Ij()?fr="jsdom":uP()?fr="deno":fr="other",fr);let Df;function dP(){if(Df===void 0){const r=Mj(),e=jj();Df={library:"langsmith",runtime:r,sdk:"langsmith-js",sdk_version:cP,...e}}return Df}function Nj(){const r=Lj()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[n,s]of Object.entries(r))(n.startsWith("LANGCHAIN_")||n.startsWith("LANGSMITH_"))&&typeof s=="string"&&!t.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[n]=s);return e}function Lj(){try{return typeof process<"u"&&fo?Object.entries(fo).reduce((r,[e,t])=>(r[e]=String(t),r),{}):void 0}catch{return}}function Bs(r){try{return typeof process<"u"?fo==null?void 0:fo[r]:void 0}catch{return}}function Zr(r){return Bs(`LANGSMITH_${r}`)||Bs(`LANGCHAIN_${r}`)}let Ff;function jj(){if(Ff!==void 0)return Ff;const r=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of r){const n=Bs(t);n!==void 0&&(e[t]=n)}return Ff=e,e}const Dj=r=>!!["TRACING_V2","TRACING"].find(t=>Zr(t)==="true"),Bf=Symbol.for("lc:context_variables");function Fj(r){return r.replace(/[-:.]/g,"")}function Bj(r,e,t=1){const n=t.toFixed(0).slice(0,3).padStart(3,"0");return Fj(`${new Date(r).toISOString().slice(0,-1)}${n}Z`)+e}class Iu{constructor(e,t,n){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=n}static fromHeader(e){const t=e.split(",");let n={},s=[],i;for(const a of t){const[o,l]=a.split("="),c=decodeURIComponent(l);o==="langsmith-metadata"?n=JSON.parse(c):o==="langsmith-tags"?s=c.split(","):o==="langsmith-project"&&(i=c)}return new Iu(n,s,i)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class nn{constructor(e){var o;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),hP(e)){Object.assign(this,{...e});return}const t=nn.getDefaultConfig(),{metadata:n,...s}=e,i=s.client??nn.getSharedClient(),a={...n,...(o=s==null?void 0:s.extra)==null?void 0:o.metadata};if(s.extra={...s.extra,metadata:a},Object.assign(this,{...t,...s,client:i}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){const l=Bj(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+l:this.dotted_order=l}}static getDefaultConfig(){return{id:At(),run_type:"chain",project_name:Zr("PROJECT")??Bs("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:Bs("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:Bs("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return nn.sharedClient||(nn.sharedClient=new Xo),nn.sharedClient}createChild(e){var l,c,u,d,h,f;const t=this.child_execution_order+1,n=new nn({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});Bf in this&&(n[Bf]=this[Bf]);const s=Symbol.for("lc:child_config"),i=((l=e.extra)==null?void 0:l[s])??this.extra[s];if(Uj(i)){const p={...i},m=zj(p.callbacks)?(u=(c=p.callbacks).copy)==null?void 0:u.call(c):void 0;m&&(Object.assign(m,{_parentRunId:n.id}),(f=(h=(d=m.handlers)==null?void 0:d.find(fP))==null?void 0:h.updateFromRunTree)==null||f.call(h,n),p.callbacks=m),n.extra[s]=p}const a=new Set;let o=this;for(;o!=null&&!a.has(o.id);)a.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(n),n}async end(e,t,n=Date.now(),s){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??n,s&&Object.keys(s).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...s}}:{metadata:s})}_convertToCreate(e,t,n=!0){var l;const s=e.extra??{};if(s.runtime||(s.runtime={}),t)for(const[c,u]of Object.entries(t))s.runtime[c]||(s.runtime[c]=u);let i,a;return n?(a=(l=e.parent_run)==null?void 0:l.id,i=[]):(i=e.child_runs.map(c=>this._convertToCreate(c,t,n)),a=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:s,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:i,parent_run_id:a,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments}}async postRun(e=!0){try{const t=dP(),n=await this._convertToCreate(this,t,!0);if(await this.client.createRun(n),!e){sP("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const s of this.child_runs)await s.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(){var e;try{const t={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:(e=this.parent_run)==null?void 0:e.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};await this.client.updateRun(this.id,t)}catch(t){console.error(`Error in patchRun for run ${this.id}`,t)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){var c,u,d,h;const n=e==null?void 0:e.callbacks;let s,i,a,o=Dj();if(n){const f=((c=n==null?void 0:n.getParentRunId)==null?void 0:c.call(n))??"",p=(u=n==null?void 0:n.handlers)==null?void 0:u.find(m=>(m==null?void 0:m.name)=="langchain_tracer");s=(d=p==null?void 0:p.getRun)==null?void 0:d.call(p,f),i=p==null?void 0:p.projectName,a=p==null?void 0:p.client,o=o||!!p}return s?new nn({name:s.name,id:s.id,trace_id:s.trace_id,dotted_order:s.dotted_order,client:a,tracingEnabled:o,project_name:i,tags:[...new Set(((s==null?void 0:s.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(h=s==null?void 0:s.extra)==null?void 0:h.metadata,...e==null?void 0:e.metadata}}}).createChild(t):new nn({...t,client:a,tracingEnabled:o,project_name:i})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){var c;const n="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,s=n["langsmith-trace"];if(!s||typeof s!="string")return;const i=s.trim(),a=i.split(".").map(u=>{const[d,h]=u.split("Z");return{strTime:d,time:Date.parse(d+"Z"),uuid:h}}),o=a[0].uuid,l={...t,name:(t==null?void 0:t.name)??"parent",run_type:(t==null?void 0:t.run_type)??"chain",start_time:(t==null?void 0:t.start_time)??Date.now(),id:(c=a.at(-1))==null?void 0:c.uuid,trace_id:o,dotted_order:i};if(n.baggage&&typeof n.baggage=="string"){const u=Iu.fromHeader(n.baggage);l.metadata=u.metadata,l.tags=u.tags,l.project_name=u.project_name}return new nn(l)}toHeaders(e){var n;const t={"langsmith-trace":this.dotted_order,baggage:new Iu((n=this.extra)==null?void 0:n.metadata,this.tags,this.project_name).toHeader()};if(e)for(const[s,i]of Object.entries(t))e.set(s,i);return t}}Object.defineProperty(nn,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function hP(r){return r!==void 0&&typeof r.createChild=="function"&&typeof r.postRun=="function"}function fP(r){return typeof r=="object"&&r!=null&&typeof r.name=="string"&&r.name==="langchain_tracer"}function vv(r){return Array.isArray(r)&&r.some(e=>fP(e))}function zj(r){return typeof r=="object"&&r!=null&&Array.isArray(r.handlers)}function Uj(r){var e;return r!==void 0&&typeof r.callbacks=="object"&&(vv((e=r.callbacks)==null?void 0:e.handlers)||vv(r.callbacks))}let qj=class{getStore(){}run(e,t){return t()}};const zf=Symbol.for("ls:tracing_async_local_storage"),Wj=new qj;let Hj=class{getInstance(){return globalThis[zf]??Wj}initializeGlobalInstance(e){globalThis[zf]===void 0&&(globalThis[zf]=e)}};const Vj=new Hj,Zj=()=>{const r=Vj.getInstance().getStore();if(!hP(r))throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function and that tracing is enabled."].join(`
`));return r};function qg(r){return typeof r=="function"&&"langsmith:traceable"in r}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const Gj=Object.prototype.hasOwnProperty;function lm(r,e){return Gj.call(r,e)}function cm(r){if(Array.isArray(r)){const t=new Array(r.length);for(let n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(r);let e=[];for(let t in r)lm(r,t)&&e.push(t);return e}function Qn(r){switch(typeof r){case"object":return JSON.parse(JSON.stringify(r));case"undefined":return null;default:return r}}function um(r){let e=0;const t=r.length;let n;for(;e<t;){if(n=r.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function fi(r){return r.indexOf("/")===-1&&r.indexOf("~")===-1?r:r.replace(/~/g,"~0").replace(/\//g,"~1")}function Jj(r){return r.replace(/~1/g,"/").replace(/~0/g,"~")}function dm(r){if(r===void 0)return!0;if(r){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(dm(r[t]))return!0}else if(typeof r=="object"){const t=cm(r),n=t.length;for(var e=0;e<n;e++)if(dm(r[t[e]]))return!0}}return!1}function xv(r,e){const t=[r];for(const n in e){const s=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof s<"u"&&t.push(`${n}: ${s}`)}return t.join(`
`)}class Kj extends Error{constructor(e,t,n,s,i){super(xv(e,{name:t,index:n,operation:s,tree:i})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.setPrototypeOf(this,new.target.prototype),this.message=xv(e,{name:t,index:n,operation:s,tree:i})}}const Xe=Kj,Si={add:function(r,e,t){return r[e]=this.value,{newDocument:t}},remove:function(r,e,t){var n=r[e];return delete r[e],{newDocument:t,removed:n}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:function(r,e,t){let n=hm(t,this.path);n&&(n=Qn(n));const s=po(t,{op:"remove",path:this.from}).removed;return po(t,{op:"add",path:this.path,value:s}),{newDocument:t,removed:n}},copy:function(r,e,t){const n=hm(t,this.from);return po(t,{op:"add",path:this.path,value:Qn(n)}),{newDocument:t}},test:function(r,e,t){return{newDocument:t,test:Mu(r[e],this.value)}},_get:function(r,e,t){return this.value=r[e],{newDocument:t}}};var Xj={add:function(r,e,t){return um(e)?r.splice(e,0,this.value):r[e]=this.value,{newDocument:t,index:e}},remove:function(r,e,t){var n=r.splice(e,1);return{newDocument:t,removed:n[0]}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:Si.move,copy:Si.copy,test:Si.test,_get:Si._get};function hm(r,e){if(e=="")return r;var t={op:"_get",path:e};return po(r,t),t.value}function po(r,e,t=!1,n=!0,s=!0,i=0){if(t&&(typeof t=="function"?t(e,0,r,e.path):fm(e,0)),e.path===""){let a={newDocument:r};if(e.op==="add")return a.newDocument=e.value,a;if(e.op==="replace")return a.newDocument=e.value,a.removed=r,a;if(e.op==="move"||e.op==="copy")return a.newDocument=hm(r,e.from),e.op==="move"&&(a.removed=r),a;if(e.op==="test"){if(a.test=Mu(r,e.value),a.test===!1)throw new Xe("Test operation failed","TEST_OPERATION_FAILED",i,e,r);return a.newDocument=r,a}else{if(e.op==="remove")return a.removed=r,a.newDocument=null,a;if(e.op==="_get")return e.value=r,a;if(t)throw new Xe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,e,r);return a}}else{n||(r=Qn(r));const o=(e.path||"").split("/");let l=r,c=1,u=o.length,d,h,f;for(typeof t=="function"?f=t:f=fm;;){if(h=o[c],h&&h.indexOf("~")!=-1&&(h=Jj(h)),s&&(h=="__proto__"||h=="prototype"&&c>0&&o[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&d===void 0&&(l[h]===void 0?d=o.slice(0,c).join("/"):c==u-1&&(d=e.path),d!==void 0&&f(e,0,r,d)),c++,Array.isArray(l)){if(h==="-")h=l.length;else{if(t&&!um(h))throw new Xe("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,e,r);um(h)&&(h=~~h)}if(c>=u){if(t&&e.op==="add"&&h>l.length)throw new Xe("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,e,r);const p=Xj[e.op].call(e,l,h,r);if(p.test===!1)throw new Xe("Test operation failed","TEST_OPERATION_FAILED",i,e,r);return p}}else if(c>=u){const p=Si[e.op].call(e,l,h,r);if(p.test===!1)throw new Xe("Test operation failed","TEST_OPERATION_FAILED",i,e,r);return p}if(l=l[h],t&&c<u&&(!l||typeof l!="object"))throw new Xe("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,e,r)}}}function $u(r,e,t,n=!0,s=!0){if(t&&!Array.isArray(e))throw new Xe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(r=Qn(r));const i=new Array(e.length);for(let a=0,o=e.length;a<o;a++)i[a]=po(r,e[a],t,!0,s,a),r=i[a].newDocument;return i.newDocument=r,i}function fm(r,e,t,n){if(typeof r!="object"||r===null||Array.isArray(r))throw new Xe("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,r,t);if(Si[r.op]){if(typeof r.path!="string")throw new Xe("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,r,t);if(r.path.indexOf("/")!==0&&r.path.length>0)throw new Xe('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,r,t);if((r.op==="move"||r.op==="copy")&&typeof r.from!="string")throw new Xe("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&r.value===void 0)throw new Xe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&dm(r.value))throw new Xe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,r,t);if(t){if(r.op=="add"){var s=r.path.split("/").length,i=n.split("/").length;if(s!==i+1&&s!==i)throw new Xe("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,r,t)}else if(r.op==="replace"||r.op==="remove"||r.op==="_get"){if(r.path!==n)throw new Xe("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,r,t)}else if(r.op==="move"||r.op==="copy"){var a={op:"_get",path:r.from,value:void 0},o=Yj([a],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new Xe("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,r,t)}}}else throw new Xe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,r,t)}function Yj(r,e,t){try{if(!Array.isArray(r))throw new Xe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)$u(Qn(e),Qn(r),t||!0);else{t=t||fm;for(var n=0;n<r.length;n++)t(r[n],n,e,void 0)}}catch(s){if(s instanceof Xe)return s;throw s}}function Mu(r,e){if(r===e)return!0;if(r&&e&&typeof r=="object"&&typeof e=="object"){var t=Array.isArray(r),n=Array.isArray(e),s,i,a;if(t&&n){if(i=r.length,i!=e.length)return!1;for(s=i;s--!==0;)if(!Mu(r[s],e[s]))return!1;return!0}if(t!=n)return!1;var o=Object.keys(r);if(i=o.length,i!==Object.keys(e).length)return!1;for(s=i;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=i;s--!==0;)if(a=o[s],!Mu(r[a],e[a]))return!1;return!0}return r!==r&&e!==e}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2013-2021 Joachim Wester
 * MIT license
 */function pP(r,e,t,n,s){if(e!==r){typeof e.toJSON=="function"&&(e=e.toJSON());for(var i=cm(e),a=cm(r),o=!1,l=a.length-1;l>=0;l--){var c=a[l],u=r[c];if(lm(e,c)&&!(e[c]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var d=e[c];typeof u=="object"&&u!=null&&typeof d=="object"&&d!=null&&Array.isArray(u)===Array.isArray(d)?pP(u,d,t,n+"/"+fi(c),s):u!==d&&(s&&t.push({op:"test",path:n+"/"+fi(c),value:Qn(u)}),t.push({op:"replace",path:n+"/"+fi(c),value:Qn(d)}))}else Array.isArray(r)===Array.isArray(e)?(s&&t.push({op:"test",path:n+"/"+fi(c),value:Qn(u)}),t.push({op:"remove",path:n+"/"+fi(c)}),o=!0):(s&&t.push({op:"test",path:n,value:r}),t.push({op:"replace",path:n,value:e}))}if(!(!o&&i.length==a.length))for(var l=0;l<i.length;l++){var c=i[l];!lm(r,c)&&e[c]!==void 0&&t.push({op:"add",path:n+"/"+fi(c),value:Qn(e[c])})}}}function Qj(r,e,t=!1){var n=[];return pP(r,e,n,"",t),n}var Uf={};const e2=()=>typeof window<"u"&&typeof window.document<"u",t2=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",n2=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),Wg=()=>typeof Deno<"u",r2=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Wg(),s2=()=>{let r;return e2()?r="browser":r2()?r="node":t2()?r="webworker":n2()?r="jsdom":Wg()?r="deno":r="other",r};let qf;async function i2(){return qf===void 0&&(qf={library:"langchain-js",runtime:s2()}),qf}function Ht(r){try{return typeof process<"u"?Uf==null?void 0:Uf[r]:Wg()?Deno==null?void 0:Deno.env.get(r):void 0}catch{return}}class a2{}function o2(r){return"lc_prefer_streaming"in r&&r.lc_prefer_streaming}class El extends a2{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,WS(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:Ht("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return Zs.prototype.toJSON.call(this)}toJSONNotImplemented(){return Zs.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends El{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:At()}),Object.assign(this,e)}}return new t}}const l2=r=>{const e=r;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"};function Wf(r,e){return r&&!Array.isArray(r)&&typeof r=="object"?r:{[e]:r}}function c2(r){return r.replace(/[-:.]/g,"")}function u2(r,e,t){const n=t.toFixed(0).slice(0,3).padStart(3,"0");return c2(`${new Date(r).toISOString().slice(0,-1)}${n}Z`)+e}function Pa(r){return typeof r._addRunToRunMap=="function"}class Al extends El{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){const t=u2(e.start_time,e.id,e.execution_order),n={...e};if(n.parent_run_id!==void 0){const s=this.runMap.get(n.parent_run_id);s&&(this._addChildRun(s,n),s.child_execution_order=Math.max(s.child_execution_order,n.child_execution_order),n.trace_id=s.trace_id,s.dotted_order!==void 0&&(n.dotted_order=[s.dotted_order,t].join(".")))}else n.trace_id=n.id,n.dotted_order=t;return this.runMap.set(n.id,n),n}async _endTrace(e){var n;const t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await((n=this.onRunUpdate)==null?void 0:n.call(this,e))}_getExecutionOrder(e){const t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,n,s,i,a,o,l){const c=this._getExecutionOrder(s),u=Date.now(),d=o?{...i,metadata:o}:i,h={id:n,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:d??{},tags:a||[]};return this._addRunToRunMap(h)}async handleLLMStart(e,t,n,s,i,a,o,l){var u,d;const c=this.runMap.get(n)??this._createRunForLLMStart(e,t,n,s,i,a,o,l);return await((u=this.onRunCreate)==null?void 0:u.call(this,c)),await((d=this.onLLMStart)==null?void 0:d.call(this,c)),c}_createRunForChatModelStart(e,t,n,s,i,a,o,l){const c=this._getExecutionOrder(s),u=Date.now(),d=o?{...i,metadata:o}:i,h={id:n,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:d??{},tags:a||[]};return this._addRunToRunMap(h)}async handleChatModelStart(e,t,n,s,i,a,o,l){var u,d;const c=this.runMap.get(n)??this._createRunForChatModelStart(e,t,n,s,i,a,o,l);return await((u=this.onRunCreate)==null?void 0:u.call(this,c)),await((d=this.onLLMStart)==null?void 0:d.call(this,c)),c}async handleLLMEnd(e,t,n,s,i){var o;const a=this.runMap.get(t);if(!a||(a==null?void 0:a.run_type)!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.outputs=e,a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...i},await((o=this.onLLMEnd)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleLLMError(e,t,n,s,i){var o;const a=this.runMap.get(t);if(!a||(a==null?void 0:a.run_type)!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...i},await((o=this.onLLMError)==null?void 0:o.call(this,a)),await this._endTrace(a),a}_createRunForChainStart(e,t,n,s,i,a,o,l){const c=this._getExecutionOrder(s),u=Date.now(),d={id:n,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:t,execution_order:c,child_execution_order:c,run_type:o??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(d)}async handleChainStart(e,t,n,s,i,a,o,l){var u,d;const c=this.runMap.get(n)??this._createRunForChainStart(e,t,n,s,i,a,o,l);return await((u=this.onRunCreate)==null?void 0:u.call(this,c)),await((d=this.onChainStart)==null?void 0:d.call(this,c)),c}async handleChainEnd(e,t,n,s,i){var o;const a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=Wf(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(a.inputs=Wf(i.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleChainError(e,t,n,s,i){var o;const a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(a.inputs=Wf(i.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,a)),await this._endTrace(a),a}_createRunForToolStart(e,t,n,s,i,a,o){const l=this._getExecutionOrder(s),c=Date.now(),u={id:n,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:t},execution_order:l,child_execution_order:l,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(u)}async handleToolStart(e,t,n,s,i,a,o){var c,u;const l=this.runMap.get(n)??this._createRunForToolStart(e,t,n,s,i,a,o);return await((c=this.onRunCreate)==null?void 0:c.call(this,l)),await((u=this.onToolStart)==null?void 0:u.call(this,l)),l}async handleToolEnd(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((s=this.onToolEnd)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleToolError(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((s=this.onToolError)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleAgentAction(e,t){var i;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="chain")return;const s=n;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((i=this.onAgentAction)==null?void 0:i.call(this,n))}async handleAgentEnd(e,t){var s;const n=this.runMap.get(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentEnd)==null?void 0:s.call(this,n)))}_createRunForRetrieverStart(e,t,n,s,i,a,o){const l=this._getExecutionOrder(s),c=Date.now(),u={id:n,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:t},execution_order:l,child_execution_order:l,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(u)}async handleRetrieverStart(e,t,n,s,i,a,o){var c,u;const l=this.runMap.get(n)??this._createRunForRetrieverStart(e,t,n,s,i,a,o);return await((c=this.onRunCreate)==null?void 0:c.call(this,l)),await((u=this.onRetrieverStart)==null?void 0:u.call(this,l)),l}async handleRetrieverEnd(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((s=this.onRetrieverEnd)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleRetrieverError(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((s=this.onRetrieverError)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleText(e,t){var s;const n=this.runMap.get(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((s=this.onText)==null?void 0:s.call(this,n)))}async handleLLMNewToken(e,t,n,s,i,a){var l;const o=this.runMap.get(n);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:a==null?void 0:a.chunk}}),await((l=this.onLLMNewToken)==null?void 0:l.call(this,o,e,{chunk:a==null?void 0:a.chunk})),o}}var ru={exports:{}};ru.exports;var kv;function d2(){return kv||(kv=1,function(r){const t=(i=0)=>a=>`\x1B[${38+i};5;${a}m`,n=(i=0)=>(a,o,l)=>`\x1B[${38+i};2;${a};${o};${l}m`;function s(){const i=new Map,a={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};a.color.gray=a.color.blackBright,a.bgColor.bgGray=a.bgColor.bgBlackBright,a.color.grey=a.color.blackBright,a.bgColor.bgGrey=a.bgColor.bgBlackBright;for(const[o,l]of Object.entries(a)){for(const[c,u]of Object.entries(l))a[c]={open:`\x1B[${u[0]}m`,close:`\x1B[${u[1]}m`},l[c]=a[c],i.set(u[0],u[1]);Object.defineProperty(a,o,{value:l,enumerable:!1})}return Object.defineProperty(a,"codes",{value:i,enumerable:!1}),a.color.close="\x1B[39m",a.bgColor.close="\x1B[49m",a.color.ansi256=t(),a.color.ansi16m=n(),a.bgColor.ansi256=t(10),a.bgColor.ansi16m=n(10),Object.defineProperties(a,{rgbToAnsi256:{value:(o,l,c)=>o===l&&l===c?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(l/255*5)+Math.round(c/255*5),enumerable:!1},hexToRgb:{value:o=>{const l=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!l)return[0,0,0];let{colorString:c}=l.groups;c.length===3&&(c=c.split("").map(d=>d+d).join(""));const u=Number.parseInt(c,16);return[u>>16&255,u>>8&255,u&255]},enumerable:!1},hexToAnsi256:{value:o=>a.rgbToAnsi256(...a.hexToRgb(o)),enumerable:!1}}),a}Object.defineProperty(r,"exports",{enumerable:!0,get:s})}(ru)),ru.exports}var h2=d2();const mP=ta(h2);function St(r,e){return`${r.open}${e}${r.close}`}function hn(r,e){try{return JSON.stringify(r,null,2)}catch{return e}}function Sv(r){return typeof r=="string"?r.trim():r==null?r:hn(r,r.toString())}function Br(r){if(!r.end_time)return"";const e=r.end_time-r.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:Dt}=mP;class Pv extends Al{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let n=e;for(;n.parent_run_id;){const s=this.runMap.get(n.parent_run_id);if(s)t.push(s),n=s;else break}return t}getBreadcrumbs(e){const n=[...this.getParents(e).reverse(),e].map((s,i,a)=>{const o=`${s.execution_order}:${s.run_type}:${s.name}`;return i===a.length-1?St(mP.bold,o):o}).join(" > ");return St(Dt.grey,n)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${St(Dt.green,"[chain/start]")} [${t}] Entering Chain run with input: ${hn(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${St(Dt.cyan,"[chain/end]")} [${t}] [${Br(e)}] Exiting Chain run with output: ${hn(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${St(Dt.red,"[chain/error]")} [${t}] [${Br(e)}] Chain run errored with error: ${hn(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${St(Dt.green,"[llm/start]")} [${t}] Entering LLM run with input: ${hn(n,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${St(Dt.cyan,"[llm/end]")} [${t}] [${Br(e)}] Exiting LLM run with output: ${hn(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${St(Dt.red,"[llm/error]")} [${t}] [${Br(e)}] LLM run errored with error: ${hn(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${St(Dt.green,"[tool/start]")} [${t}] Entering Tool run with input: "${Sv(e.inputs.input)}"`)}onToolEnd(e){var n;const t=this.getBreadcrumbs(e);console.log(`${St(Dt.cyan,"[tool/end]")} [${t}] [${Br(e)}] Exiting Tool run with output: "${Sv((n=e.outputs)==null?void 0:n.output)}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${St(Dt.red,"[tool/error]")} [${t}] [${Br(e)}] Tool run errored with error: ${hn(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${St(Dt.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${hn(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${St(Dt.cyan,"[retriever/end]")} [${t}] [${Br(e)}] Exiting Retriever run with output: ${hn(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${St(Dt.red,"[retriever/error]")} [${t}] [${Br(e)}] Retriever run errored with error: ${hn(e.error,"[error]")}`)}onAgentAction(e){const t=e,n=this.getBreadcrumbs(e);console.log(`${St(Dt.blue,"[agent/action]")} [${n}] Agent selected action: ${hn(t.actions[t.actions.length-1],"[action]")}`)}}let Hf;const f2=()=>{if(Hf===void 0){const r=Ht("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};Hf=new Xo(r)}return Hf};class mo extends Al{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:n,client:s}=e;this.projectName=n??Ht("LANGCHAIN_PROJECT")??Ht("LANGCHAIN_SESSION"),this.exampleId=t,this.client=s??f2();const i=mo.getTraceableRunTree();i&&this.updateFromRunTree(i)}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await i2()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id,extra:e.extra,session_name:this.projectName};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let t=e;const n=new Set;for(;t.parent_run&&!(n.has(t.id)||(n.add(t.id),!t.parent_run));)t=t.parent_run;n.clear();const s=[t];for(;s.length>0;){const i=s.shift();!i||n.has(i.id)||(n.add(i.id),this.runMap.set(i.id,i),i.child_runs&&s.push(...i.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){const t={},n=[];for(const[s,i]of this.runMap){const a=new nn({...i,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});t[s]=a,n.push([s,i.dotted_order])}n.sort((s,i)=>!s[1]||!i[1]?0:s[1].localeCompare(i[1]));for(const[s]of n){const i=this.runMap.get(s),a=t[s];if(!(!i||!a)&&i.parent_run_id){const o=t[i.parent_run_id];o&&(o.child_runs.push(a),a.parent_run=o)}}return t[e]}static getTraceableRunTree(){try{return Zj()}catch{return}}}const gP=Symbol.for("ls:tracing_async_local_storage"),su=Symbol.for("lc:context_variables"),p2=r=>{globalThis[gP]=r},Yo=()=>globalThis[gP];let go;function m2(){const r="default"in Or?Or.default:Or;return new r({autoStart:!0,concurrency:1})}function g2(){return typeof go>"u"&&(go=m2()),go}async function rt(r,e){if(e===!0){const t=Yo();t!==void 0?await t.run(void 0,async()=>r()):await r()}else go=g2(),go.add(async()=>{const t=Yo();t!==void 0?await t.run(void 0,async()=>r()):await r()})}const _2=r=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>Ht(t)==="true");function _P(r){var n;const e=Yo();if(e===void 0)return;const t=e.getStore();return(n=t==null?void 0:t[su])==null?void 0:n[r]}const b2=Symbol("lc:configure_hooks"),y2=()=>_P(b2)||[];class w2{setHandler(e){return this.setHandlers([e])}}class Nd{constructor(e,t,n,s,i,a,o,l){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:l})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>rt(async()=>{var n;try{await((n=t.handleText)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleCustomEvent(e,t,n,s,i){await Promise.all(this.handlers.map(a=>rt(async()=>{var o;try{await((o=a.handleCustomEvent)==null?void 0:o.call(a,e,t,this.runId,this.tags,this.metadata))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}}class v2 extends Nd{getChild(e){const t=new Wt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>rt(async()=>{var n;if(!t.ignoreRetriever)try{await((n=t.handleRetrieverEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw s}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>rt(async()=>{var n;if(!t.ignoreRetriever)try{await((n=t.handleRetrieverError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${s}`),t.raiseError)throw e}},t.awaitHandlers)))}}class Ev extends Nd{async handleLLMNewToken(e,t,n,s,i,a){await Promise.all(this.handlers.map(o=>rt(async()=>{var l;if(!o.ignoreLLM)try{await((l=o.handleLLMNewToken)==null?void 0:l.call(o,e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a))}catch(c){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${c}`),o.raiseError)throw c}},o.awaitHandlers)))}async handleLLMError(e,t,n,s,i){await Promise.all(this.handlers.map(a=>rt(async()=>{var o;if(!a.ignoreLLM)try{await((o=a.handleLLMError)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMError: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}async handleLLMEnd(e,t,n,s,i){await Promise.all(this.handlers.map(a=>rt(async()=>{var o;if(!a.ignoreLLM)try{await((o=a.handleLLMEnd)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMEnd: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}}class x2 extends Nd{getChild(e){const t=new Wt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,n,s,i){await Promise.all(this.handlers.map(a=>rt(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainError)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainError: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}async handleChainEnd(e,t,n,s,i){await Promise.all(this.handlers.map(a=>rt(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainEnd)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainEnd: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>rt(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleAgentAction)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>rt(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleAgentEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}}class k2 extends Nd{getChild(e){const t=new Wt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>rt(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleToolError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>rt(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleToolEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}}class Wt extends w2{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(t==null?void 0:t.handlers)??this.handlers,this.inheritableHandlers=(t==null?void 0:t.inheritableHandlers)??this.inheritableHandlers,this.tags=(t==null?void 0:t.tags)??this.tags,this.inheritableTags=(t==null?void 0:t.inheritableTags)??this.inheritableTags,this.metadata=(t==null?void 0:t.metadata)??this.metadata,this.inheritableMetadata=(t==null?void 0:t.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,n=void 0,s=void 0,i=void 0,a=void 0,o=void 0,l=void 0){return Promise.all(t.map(async(c,u)=>{const d=u===0&&n?n:At();return await Promise.all(this.handlers.map(h=>{if(!h.ignoreLLM)return Pa(h)&&h._createRunForLLMStart(e,[c],d,this._parentRunId,i,this.tags,this.metadata,l),rt(async()=>{var f;try{await((f=h.handleLLMStart)==null?void 0:f.call(h,e,[c],d,this._parentRunId,i,this.tags,this.metadata,l))}catch(p){if((h.raiseError?console.error:console.warn)(`Error in handler ${h.constructor.name}, handleLLMStart: ${p}`),h.raiseError)throw p}},h.awaitHandlers)})),new Ev(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,n=void 0,s=void 0,i=void 0,a=void 0,o=void 0,l=void 0){return Promise.all(t.map(async(c,u)=>{const d=u===0&&n?n:At();return await Promise.all(this.handlers.map(h=>{if(!h.ignoreLLM)return Pa(h)&&h._createRunForChatModelStart(e,[c],d,this._parentRunId,i,this.tags,this.metadata,l),rt(async()=>{var f,p;try{if(h.handleChatModelStart)await((f=h.handleChatModelStart)==null?void 0:f.call(h,e,[c],d,this._parentRunId,i,this.tags,this.metadata,l));else if(h.handleLLMStart){const m=ZS(c);await((p=h.handleLLMStart)==null?void 0:p.call(h,e,[m],d,this._parentRunId,i,this.tags,this.metadata,l))}}catch(m){if((h.raiseError?console.error:console.warn)(`Error in handler ${h.constructor.name}, handleLLMStart: ${m}`),h.raiseError)throw m}},h.awaitHandlers)})),new Ev(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,n=At(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreChain)return Pa(l)&&l._createRunForChainStart(e,t,n,this._parentRunId,this.tags,this.metadata,s,o),rt(async()=>{var c;try{await((c=l.handleChainStart)==null?void 0:c.call(l,e,t,n,this._parentRunId,this.tags,this.metadata,s,o))}catch(u){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleChainStart: ${u}`),l.raiseError)throw u}},l.awaitHandlers)})),new x2(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,n=At(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreAgent)return Pa(l)&&l._createRunForToolStart(e,t,n,this._parentRunId,this.tags,this.metadata,o),rt(async()=>{var c;try{await((c=l.handleToolStart)==null?void 0:c.call(l,e,t,n,this._parentRunId,this.tags,this.metadata,o))}catch(u){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleToolStart: ${u}`),l.raiseError)throw u}},l.awaitHandlers)})),new k2(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,n=At(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreRetriever)return Pa(l)&&l._createRunForRetrieverStart(e,t,n,this._parentRunId,this.tags,this.metadata,o),rt(async()=>{var c;try{await((c=l.handleRetrieverStart)==null?void 0:c.call(l,e,t,n,this._parentRunId,this.tags,this.metadata,o))}catch(u){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleRetrieverStart: ${u}`),l.raiseError)throw u}},l.awaitHandlers)})),new v2(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,n,s,i){await Promise.all(this.handlers.map(a=>rt(async()=>{var o;if(!a.ignoreCustomEvent)try{await((o=a.handleCustomEvent)==null?void 0:o.call(a,e,t,n,this.tags,this.metadata))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const n of e)this.addHandler(n,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const n=new Wt(this._parentRunId);for(const s of this.handlers){const i=this.inheritableHandlers.includes(s);n.addHandler(s,i)}for(const s of this.tags){const i=this.inheritableTags.includes(s);n.addTags([s],i)}for(const s of Object.keys(this.metadata)){const i=Object.keys(this.inheritableMetadata).includes(s);n.addMetadata({[s]:this.metadata[s]},i)}for(const s of e)n.handlers.filter(i=>i.name==="console_callback_handler").some(i=>i.name===s.name)||n.addHandler(s,t);return n}static fromHandlers(e){class t extends El{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:At()}),Object.assign(this,e)}}const n=new this;return n.addHandler(new t),n}static configure(e,t,n,s,i,a,o){return this._configureSync(e,t,n,s,i,a,o)}static _configureSync(e,t,n,s,i,a,o){var h,f;let l;(e||t)&&(Array.isArray(e)||!e?(l=new Wt,l.setHandlers((e==null?void 0:e.map(Nu))??[],!0)):l=e,l=l.copy(Array.isArray(t)?t.map(Nu):t==null?void 0:t.handlers,!1));const c=Ht("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),u=((h=mo.getTraceableRunTree())==null?void 0:h.tracingEnabled)||_2(),d=u||(Ht("LANGCHAIN_TRACING")??!1);if(c||d){if(l||(l=new Wt),c&&!l.handlers.some(p=>p.name===Pv.prototype.name)){const p=new Pv;l.addHandler(p,!0)}if(d&&!l.handlers.some(p=>p.name==="langchain_tracer")&&u){const p=new mo;l.addHandler(p,!0),l._parentRunId=((f=mo.getTraceableRunTree())==null?void 0:f.id)??l._parentRunId}}for(const{contextVar:p,inheritable:m=!0,handlerClass:g,envVar:_}of y2()){const y=_&&Ht(_)==="true"&&g;let b;const w=p!==void 0?_P(p):void 0;w&&l2(w)?b=w:y&&(b=new g({})),b!==void 0&&(l||(l=new Wt),l.handlers.some(v=>v.name===b.name)||l.addHandler(b,m))}return(n||s)&&l&&(l.addTags(n??[]),l.addTags(s??[],!1)),(i||a)&&l&&(l.addMetadata(i??{}),l.addMetadata(a??{},!1)),l}}function Nu(r){return"name"in r?r:El.fromMethods(r)}class S2{getStore(){}run(e,t){return t()}enterWith(e){}}const P2=new S2,Av=Symbol.for("lc:child_config");class E2{getInstance(){return Yo()??P2}getRunnableConfig(){var t,n;return(n=(t=this.getInstance().getStore())==null?void 0:t.extra)==null?void 0:n[Av]}runWithConfig(e,t,n){var u;const s=Wt._configureSync(e==null?void 0:e.callbacks,void 0,e==null?void 0:e.tags,void 0,e==null?void 0:e.metadata),i=this.getInstance(),a=i.getStore(),o=s==null?void 0:s.getParentRunId(),l=(u=s==null?void 0:s.handlers)==null?void 0:u.find(d=>(d==null?void 0:d.name)==="langchain_tracer");let c;return l&&o?c=l.convertToRunTree(o):n||(c=new nn({name:"<runnable_lambda>",tracingEnabled:!1})),c&&(c.extra={...c.extra,[Av]:e}),a!==void 0&&a[su]!==void 0&&(c===void 0&&(c={}),c[su]=a[su]),i.run(c,t)}initializeGlobalInstance(e){Yo()===void 0&&p2(e)}}const ds=new E2,Vf=25;async function Dn(r){return Wt._configureSync(r==null?void 0:r.callbacks,void 0,r==null?void 0:r.tags,void 0,r==null?void 0:r.metadata)}function Ov(...r){const e={};for(const t of r.filter(n=>!!n))for(const n of Object.keys(t))if(n==="metadata")e[n]={...e[n],...t[n]};else if(n==="tags"){const s=e[n]??[];e[n]=[...new Set(s.concat(t[n]??[]))]}else if(n==="configurable")e[n]={...e[n],...t[n]};else if(n==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(n==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(n==="callbacks"){const s=e.callbacks,i=t.callbacks;if(Array.isArray(i))if(!s)e.callbacks=i;else if(Array.isArray(s))e.callbacks=s.concat(i);else{const a=s.copy();for(const o of i)a.addHandler(Nu(o),!0);e.callbacks=a}else if(i)if(!s)e.callbacks=i;else if(Array.isArray(s)){const a=i.copy();for(const o of s)a.addHandler(Nu(o),!0);e.callbacks=a}else e.callbacks=new Wt(i._parentRunId,{handlers:s.handlers.concat(i.handlers),inheritableHandlers:s.inheritableHandlers.concat(i.inheritableHandlers),tags:Array.from(new Set(s.tags.concat(i.tags))),inheritableTags:Array.from(new Set(s.inheritableTags.concat(i.inheritableTags))),metadata:{...s.metadata,...i.metadata}})}else{const s=n;e[s]=t[s]??e[s]}return e}const A2=new Set(["string","number","boolean"]);function Pe(r){var n;const e=ds.getRunnableConfig();let t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:s,runName:i,...a}=e;t=Object.entries(a).reduce((o,[l,c])=>(c!==void 0&&(o[l]=c),o),t)}if(r&&(t=Object.entries(r).reduce((s,[i,a])=>(a!==void 0&&(s[i]=a),s),t)),t!=null&&t.configurable)for(const s of Object.keys(t.configurable))A2.has(typeof t.configurable[s])&&!((n=t.metadata)!=null&&n[s])&&(t.metadata||(t.metadata={}),t.metadata[s]=t.configurable[s]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");const s=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,s])):t.signal=s,delete t.timeout}return t}function yt(r={},{callbacks:e,maxConcurrency:t,recursionLimit:n,runName:s,configurable:i,runId:a}={}){const o=Pe(r);return e!==void 0&&(delete o.runName,o.callbacks=e),n!==void 0&&(o.recursionLimit=n),t!==void 0&&(o.maxConcurrency=t),s!==void 0&&(o.runName=s),i!==void 0&&(o.configurable={...o.configurable,...i}),a!==void 0&&delete o.runId,o}function Vi(r){return r?{configurable:r.configurable,recursionLimit:r.recursionLimit,callbacks:r.callbacks,tags:r.tags,metadata:r.metadata,maxConcurrency:r.maxConcurrency,timeout:r.timeout,signal:r.signal}:void 0}async function hs(r,e){if(e===void 0)return r;let t;return Promise.race([r.catch(n=>{if(!(e!=null&&e.aborted))throw n}),new Promise((n,s)=>{t=()=>{s(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&s(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))}class ln extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const t=e.getReader();return new ln({start(n){return s();function s(){return t.read().then(({done:i,value:a})=>{if(i){n.close();return}return n.enqueue(a),s()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new ln({async pull(t){const{value:n,done:s}=await e.next();s&&t.close(),t.enqueue(n)},async cancel(t){await e.return(t)}})}}function bP(r,e=2){const t=Array.from({length:e},()=>[]);return t.map(async function*(s){for(;;)if(s.length===0){const i=await r.next();for(const a of t)a.push(i)}else{if(s[0].done)return;yield s.shift().value}})}function Fn(r,e){if(Array.isArray(r)&&Array.isArray(e))return r.concat(e);if(typeof r=="string"&&typeof e=="string")return r+e;if(typeof r=="number"&&typeof e=="number")return r+e;if("concat"in r&&typeof r.concat=="function")return r.concat(e);if(typeof r=="object"&&typeof e=="object"){const t={...r};for(const[n,s]of Object.entries(e))n in t&&!Array.isArray(t[n])?t[n]=Fn(t[n],s):t[n]=s;return t}else throw new Error(`Cannot concat ${typeof r} and ${typeof e}`)}class ua{constructor(e){var t;Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??((t=this.config)==null?void 0:t.signal),this.setup=new Promise((n,s)=>{ds.runWithConfig(Vi(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(n,s):this.firstResult.then(i=>n(void 0),s)},!0)})}async next(...e){var t;return(t=this.signal)==null||t.throwIfAborted(),this.firstResultUsed?ds.runWithConfig(Vi(this.config),this.signal?async()=>hs(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}async function O2(r,e,t,n,...s){const i=new ua({generator:e,startSetup:t,signal:n}),a=await i.setup;return{output:r(i,a,...s),setup:a}}class Wr{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),n=$u({},t);return new Qo({ops:t,state:n[n.length-1].newDocument})}}class Qo extends Wr{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),n=$u(this.state,e.ops);return new Qo({ops:t,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){const t=$u({},e.ops);return new Qo({ops:e.ops,state:t[t.length-1].newDocument})}}const T2=r=>r.name==="log_stream_tracer";async function Tv(r,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:t}=r;if(["retriever","llm","prompt"].includes(r.run_type))return t;if(!(Object.keys(t).length===1&&(t==null?void 0:t.input)===""))return t.input}async function Rv(r,e){const{outputs:t}=r;return e==="original"||["retriever","llm","prompt"].includes(r.run_type)?t:t!==void 0&&Object.keys(t).length===1&&(t==null?void 0:t.output)!==void 0?t.output:t}function R2(r){return r!==void 0&&r.message!==void 0}class Cv extends Al{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=ln.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||t.find(s=>{var i;return(i=this.includeTags)==null?void 0:i.includes(s)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&t.every(s=>{var i;return!((i=this.excludeTags)!=null&&i.includes(s))})),n}async*tapOutputIterable(e,t){for await(const n of t){if(e!==this.rootId){const s=this.keyMapByRunId[e];s&&await this.writer.write(new Wr({ops:[{op:"add",path:`/logs/${s}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){var s;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Wr({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;const n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=await Tv(e,this._schemaFormat)),await this.writer.write(new Wr({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(t===void 0)return;const n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${t}/inputs`,value:await Tv(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${t}/final_output`,value:await Rv(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const s=new Wr({ops:n});await this.writer.write(s)}finally{if(e.id===this.rootId){const t=new Wr({ops:[{op:"replace",path:"/final_output",value:await Rv(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,n){const s=this.keyMapByRunId[e.id];if(s===void 0)return;const i=e.inputs.messages!==void 0;let a;i?R2(n==null?void 0:n.chunk)?a=n==null?void 0:n.chunk:a=new Ze({id:`run-${e.id}`,content:t}):a=t;const o=new Wr({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${s}/streamed_output/-`,value:a}]});await this.writer.write(o)}}const Iv="__run";class Zi{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new Zi({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class zn extends Zi{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new zn({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}function pc({name:r,serialized:e}){return r!==void 0?r:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const C2=r=>r.name==="event_stream_tracer";class I2 extends Al{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=ln.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const t=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(n=n||t.find(s=>{var i;return(i=this.includeTags)==null?void 0:i.includes(s)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(n=n&&t.every(s=>{var i;return!((i=this.excludeTags)!=null&&i.includes(s))})),n}async*tapOutputIterable(e,t){const n=await t.next();if(n.done)return;const s=this.runInfoMap.get(e);if(s===void 0){yield n.value;return}function i(o,l){return o==="llm"&&typeof l=="string"?new Zi({text:l}):l}let a=this.tappedPromises.get(e);if(a===void 0){let o;a=new Promise(l=>{o=l}),this.tappedPromises.set(e,a);try{const l={event:`on_${s.runType}_stream`,run_id:e,name:s.name,tags:s.tags,metadata:s.metadata,data:{}};await this.send({...l,data:{chunk:i(s.runType,n.value)}},s),yield n.value;for await(const c of t)s.runType!=="tool"&&s.runType!=="retriever"&&await this.send({...l,data:{chunk:i(s.runType,c)}},s),yield c}finally{o()}}else{yield n.value;for await(const o of t)yield o}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){const n=this.tappedPromises.get(e.run_id);n!==void 0?n.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){var a,o;const t=pc(e),n=e.inputs.messages!==void 0?"chat_model":"llm",s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,s);const i=`on_${n}_start`;await this.send({event:i,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onLLMNewToken(e,t,n){const s=this.runInfoMap.get(e.id);let i,a;if(s===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(s.runType==="chat_model")a="on_chat_model_stream",(n==null?void 0:n.chunk)===void 0?i=new Ze({content:t,id:`run-${e.id}`}):i=n.chunk.message;else if(s.runType==="llm")a="on_llm_stream",(n==null?void 0:n.chunk)===void 0?i=new Zi({text:t}):i=n.chunk;else throw new Error(`Unexpected run type ${s.runType}`);await this.send({event:a,data:{chunk:i},run_id:e.id,name:s.name,tags:s.tags,metadata:s.metadata},s)}}async onLLMEnd(e){var a,o,l;const t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let n;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const s=(a=e.outputs)==null?void 0:a.generations;let i;if(t.runType==="chat_model"){for(const c of s??[]){if(i!==void 0)break;i=(o=c[0])==null?void 0:o.message}n="on_chat_model_end"}else if(t.runType==="llm")i={generations:s==null?void 0:s.map(c=>c.map(u=>({text:u.text,generationInfo:u.generationInfo}))),llmOutput:((l=e.outputs)==null?void 0:l.llmOutput)??{}},n="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:n,data:{output:i,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){var a,o;const t=pc(e),n=e.run_type??"chain",s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:e.run_type};let i={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(i={},s.inputs={}):e.inputs.input!==void 0?(i.input=e.inputs.input,s.inputs=e.inputs.input):(i.input=e.inputs,s.inputs=e.inputs),this.runInfoMap.set(e.id,s),await this.send({event:`on_${n}_start`,data:i,name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onChainEnd(e){var o;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const n=`on_${e.run_type}_end`,s=e.inputs??t.inputs??{},a={output:((o=e.outputs)==null?void 0:o.output)??e.outputs,input:s};s.input&&Object.keys(s).length===1&&(a.input=s.input,t.inputs=s.input),await this.sendEndEvent({event:n,data:a,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){var s,i;const t=pc(e),n={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{}},n)}async onToolEnd(e){var s;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const n=((s=e.outputs)==null?void 0:s.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:n,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){var i,a;const t=pc(e),s={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,s),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:((a=e.extra)==null?void 0:a.metadata)??{}},s)}async onRetrieverEnd(e){var n;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((n=e.outputs)==null?void 0:n.documents)??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,n){const s=this.runInfoMap.get(n);if(s===void 0)throw new Error(`handleCustomEvent: Run ID ${n} not found in run map.`);await this.send({event:"on_custom_event",run_id:n,name:e,tags:s.tags,metadata:s.metadata,data:t},s)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const $2=[400,401,402,403,404,405,406,407,409],M2=r=>{var t,n;if(r.message.startsWith("Cancel")||r.message.startsWith("AbortError")||r.name==="AbortError"||(r==null?void 0:r.code)==="ECONNABORTED")throw r;const e=((t=r==null?void 0:r.response)==null?void 0:t.status)??(r==null?void 0:r.status);if(e&&$2.includes(+e))throw r;if(((n=r==null?void 0:r.error)==null?void 0:n.code)==="insufficient_quota"){const s=new Error(r==null?void 0:r.message);throw s.name="InsufficientQuotaError",s}};class Hg{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??M2;const t="default"in Or?Or.default:Or;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>Ru(()=>e(...t).catch(n=>{throw n instanceof Error?n:new Error(n)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}class yP extends Al{constructor({config:e,onStart:t,onEnd:n,onError:s}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=n,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function Vg(r){return r?r.lc_runnable:!1}class N2{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let n=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const s=e.tags??[];return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(t)),this.includeTags!==void 0&&(n=n||s.some(i=>{var a;return(a=this.includeTags)==null?void 0:a.includes(i)})),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(n=n&&s.every(i=>{var a;return!((a=this.excludeTags)!=null&&a.includes(i))})),n}}const L2=Symbol("Let zodToJsonSchema decide on which parser to use"),j2={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},D2=r=>({...j2,...r}),F2=r=>{const e=D2(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function wP(r,e,t,n){n!=null&&n.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function Ce(r,e,t,n,s){r[e]=t,wP(r,e,n,s)}function B2(){return{}}function z2(r,e){var n,s,i;const t={type:"array"};return(n=r.type)!=null&&n._def&&((i=(s=r.type)==null?void 0:s._def)==null?void 0:i.typeName)!==T.ZodAny&&(t.items=Oe(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&Ce(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&Ce(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(Ce(t,"minItems",r.exactLength.value,r.exactLength.message,e),Ce(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function U2(r,e){const t={type:"integer",format:"int64"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?Ce(t,"minimum",n.value,n.message,e):Ce(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Ce(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Ce(t,"maximum",n.value,n.message,e):Ce(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Ce(t,"maximum",n.value,n.message,e));break;case"multipleOf":Ce(t,"multipleOf",n.value,n.message,e);break}return t}function q2(){return{type:"boolean"}}function vP(r,e){return Oe(r.type._def,e)}const W2=(r,e)=>Oe(r.innerType._def,e);function xP(r,e,t){const n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((s,i)=>xP(r,e,s))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return H2(r,e)}}const H2=(r,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const n of r.checks)switch(n.kind){case"min":Ce(t,"minimum",n.value,n.message,e);break;case"max":Ce(t,"maximum",n.value,n.message,e);break}return t};function V2(r,e){return{...Oe(r.innerType._def,e),default:r.defaultValue()}}function Z2(r,e){return e.effectStrategy==="input"?Oe(r.schema._def,e):{}}function G2(r){return{type:"string",enum:Array.from(r.values)}}const J2=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function K2(r,e){const t=[Oe(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Oe(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(i=>{if(J2(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(n=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...l}=i;a=l}else n=void 0;s.push(a)}}),s.length?{allOf:s,...n}:void 0}function X2(r,e){const t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}let Zf;const xn={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Zf===void 0&&(Zf=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Zf),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function kP(r,e){const t={type:"string"};if(r.checks)for(const n of r.checks)switch(n.kind){case"min":Ce(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e);break;case"max":Ce(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":kn(t,"email",n.message,e);break;case"format:idn-email":kn(t,"idn-email",n.message,e);break;case"pattern:zod":Pt(t,xn.email,n.message,e);break}break;case"url":kn(t,"uri",n.message,e);break;case"uuid":kn(t,"uuid",n.message,e);break;case"regex":Pt(t,n.regex,n.message,e);break;case"cuid":Pt(t,xn.cuid,n.message,e);break;case"cuid2":Pt(t,xn.cuid2,n.message,e);break;case"startsWith":Pt(t,RegExp(`^${Gf(n.value,e)}`),n.message,e);break;case"endsWith":Pt(t,RegExp(`${Gf(n.value,e)}$`),n.message,e);break;case"datetime":kn(t,"date-time",n.message,e);break;case"date":kn(t,"date",n.message,e);break;case"time":kn(t,"time",n.message,e);break;case"duration":kn(t,"duration",n.message,e);break;case"length":Ce(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e),Ce(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"includes":{Pt(t,RegExp(Gf(n.value,e)),n.message,e);break}case"ip":{n.version!=="v6"&&kn(t,"ipv4",n.message,e),n.version!=="v4"&&kn(t,"ipv6",n.message,e);break}case"base64url":Pt(t,xn.base64url,n.message,e);break;case"jwt":Pt(t,xn.jwt,n.message,e);break;case"cidr":{n.version!=="v6"&&Pt(t,xn.ipv4Cidr,n.message,e),n.version!=="v4"&&Pt(t,xn.ipv6Cidr,n.message,e);break}case"emoji":Pt(t,xn.emoji(),n.message,e);break;case"ulid":{Pt(t,xn.ulid,n.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{kn(t,"binary",n.message,e);break}case"contentEncoding:base64":{Ce(t,"contentEncoding","base64",n.message,e);break}case"pattern:zod":{Pt(t,xn.base64,n.message,e);break}}break}case"nanoid":Pt(t,xn.nanoid,n.message,e)}return t}function Gf(r,e){return e.patternStrategy==="escape"?Q2(r):r}const Y2=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Q2(r){let e="";for(let t=0;t<r.length;t++)Y2.has(r[t])||(e+="\\"),e+=r[t];return e}function kn(r,e,t,n){var s;r.format||(s=r.anyOf)!=null&&s.some(i=>i.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):Ce(r,"format",e,t,n)}function Pt(r,e,t,n){var s;r.pattern||(s=r.allOf)!=null&&s.some(i=>i.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:$v(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):Ce(r,"pattern",$v(e,n),t,n)}function $v(r,e){var l;if(!e.applyRegexFlags||!r.flags)return r.source;const t={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},n=t.i?r.source.toLowerCase():r.source;let s="",i=!1,a=!1,o=!1;for(let c=0;c<n.length;c++){if(i){s+=n[c],i=!1;continue}if(t.i){if(a){if(n[c].match(/[a-z]/)){o?(s+=n[c],s+=`${n[c-2]}-${n[c]}`.toUpperCase(),o=!1):n[c+1]==="-"&&((l=n[c+2])!=null&&l.match(/[a-z]/))?(s+=n[c],o=!0):s+=`${n[c]}${n[c].toUpperCase()}`;continue}}else if(n[c].match(/[a-z]/)){s+=`[${n[c]}${n[c].toUpperCase()}]`;continue}}if(t.m){if(n[c]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(n[c]==="$"){s+=`($|(?=[\r
]))`;continue}}if(t.s&&n[c]==="."){s+=a?`${n[c]}\r
`:`[${n[c]}\r
]`;continue}s+=n[c],n[c]==="\\"?i=!0:a&&n[c]==="]"?a=!1:!a&&n[c]==="["&&(a=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return s}function SP(r,e){var n,s,i,a,o,l;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((n=r.keyType)==null?void 0:n._def.typeName)===T.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((c,u)=>({...c,[u]:Oe(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",u]})??{}}),{}),additionalProperties:e.rejectedAdditionalProperties};const t={type:"object",additionalProperties:Oe(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(((s=r.keyType)==null?void 0:s._def.typeName)===T.ZodString&&((i=r.keyType._def.checks)!=null&&i.length)){const{type:c,...u}=kP(r.keyType._def,e);return{...t,propertyNames:u}}else{if(((a=r.keyType)==null?void 0:a._def.typeName)===T.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};if(((o=r.keyType)==null?void 0:o._def.typeName)===T.ZodBranded&&r.keyType._def.type._def.typeName===T.ZodString&&((l=r.keyType._def.type._def.checks)!=null&&l.length)){const{type:c,...u}=vP(r.keyType._def,e);return{...t,propertyNames:u}}}return t}function eD(r,e){if(e.mapStrategy==="record")return SP(r,e);const t=Oe(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=Oe(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function tD(r){const e=r.values,n=Object.keys(r.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(n.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function nD(){return{not:{}}}function rD(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Lu={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function sD(r,e){if(e.target==="openApi3")return Mv(r,e);const t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in Lu&&(!n._def.checks||!n._def.checks.length))){const n=t.reduce((s,i)=>{const a=Lu[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=t.reduce((s,i)=>{const a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===t.length){const s=n.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,s)=>[...n,...s._def.values.filter(i=>!n.includes(i))],[])};return Mv(r,e)}const Mv=(r,e)=>{const t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,s)=>Oe(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function iD(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"?{type:Lu[r.innerType._def.typeName],nullable:!0}:{type:[Lu[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=Oe(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const t=Oe(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function aD(r,e){const t={type:"number"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"int":t.type="integer",wP(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?Ce(t,"minimum",n.value,n.message,e):Ce(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Ce(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Ce(t,"maximum",n.value,n.message,e):Ce(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Ce(t,"maximum",n.value,n.message,e));break;case"multipleOf":Ce(t,"multipleOf",n.value,n.message,e);break}return t}function oD(r,e){const t=e.target==="openAi",n={type:"object",properties:{}},s=[],i=r.shape();for(const o in i){let l=i[o];if(l===void 0||l._def===void 0)continue;let c=cD(l);c&&t&&(l instanceof jn&&(l=l._def.innerType),l.isNullable()||(l=l.nullable()),c=!1);const u=Oe(l._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});u!==void 0&&(n.properties[o]=u,c||s.push(o))}s.length&&(n.required=s);const a=lD(r,e);return a!==void 0&&(n.additionalProperties=a),n}function lD(r,e){if(r.catchall._def.typeName!=="ZodNever")return Oe(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(r.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function cD(r){try{return r.isOptional()}catch{return!0}}const uD=(r,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return Oe(r.innerType._def,e);const t=Oe(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},dD=(r,e)=>{if(e.pipeStrategy==="input")return Oe(r.in._def,e);if(e.pipeStrategy==="output")return Oe(r.out._def,e);const t=Oe(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=Oe(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(s=>s!==void 0)}};function hD(r,e){return Oe(r.type._def,e)}function fD(r,e){const n={type:"array",uniqueItems:!0,items:Oe(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&Ce(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&Ce(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function pD(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>Oe(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:Oe(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>Oe(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function mD(){return{not:{}}}function gD(){return{}}const _D=(r,e)=>Oe(r.innerType._def,e),bD=(r,e,t)=>{switch(e){case T.ZodString:return kP(r,t);case T.ZodNumber:return aD(r,t);case T.ZodObject:return oD(r,t);case T.ZodBigInt:return U2(r,t);case T.ZodBoolean:return q2();case T.ZodDate:return xP(r,t);case T.ZodUndefined:return mD();case T.ZodNull:return rD(t);case T.ZodArray:return z2(r,t);case T.ZodUnion:case T.ZodDiscriminatedUnion:return sD(r,t);case T.ZodIntersection:return K2(r,t);case T.ZodTuple:return pD(r,t);case T.ZodRecord:return SP(r,t);case T.ZodLiteral:return X2(r,t);case T.ZodEnum:return G2(r);case T.ZodNativeEnum:return tD(r);case T.ZodNullable:return iD(r,t);case T.ZodOptional:return uD(r,t);case T.ZodMap:return eD(r,t);case T.ZodSet:return fD(r,t);case T.ZodLazy:return()=>r.getter()._def;case T.ZodPromise:return hD(r,t);case T.ZodNaN:case T.ZodNever:return nD();case T.ZodEffects:return Z2(r,t);case T.ZodAny:return B2();case T.ZodUnknown:return gD();case T.ZodDefault:return V2(r,t);case T.ZodBranded:return vP(r,t);case T.ZodReadonly:return _D(r,t);case T.ZodCatch:return W2(r,t);case T.ZodPipeline:return dD(r,t);case T.ZodFunction:case T.ZodVoid:case T.ZodSymbol:return;default:return(n=>{})()}};function Oe(r,e,t=!1){var o;const n=e.seen.get(r);if(e.override){const l=(o=e.override)==null?void 0:o.call(e,r,e,n,t);if(l!==L2)return l}if(n&&!t){const l=yD(n,e);if(l!==void 0)return l}const s={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,s);const i=bD(r,r.typeName,e),a=typeof i=="function"?Oe(i(),e):i;if(a&&vD(r,e,a),e.postProcess){const l=e.postProcess(a,r,e);return s.jsonSchema=a,l}return s.jsonSchema=a,a}const yD=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"relative":return{$ref:wD(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((t,n)=>e.currentPath[n]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},wD=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},vD=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t),fs=(r,e)=>{const t=F2(e),n=void 0,s=e==null?void 0:e.name,i=Oe(r._def,t,!1)??{},a=s===void 0?n?{...i,[t.definitionPath]:n}:i:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...n,[s]:i}};return t.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in a||"oneOf"in a||"allOf"in a||"type"in a&&Array.isArray(a.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),a};function Jf(r){return r.replace(/[^a-zA-Z-_0-9]/g,"_")}const xD=["*","_","`"];function kD(r){let e="";for(const[t,n]of Object.entries(r))e+=`	classDef ${t} ${n};
`;return e}function SD(r,e,t){const{firstNode:n,lastNode:s,nodeColors:i,withStyles:a=!0,curveStyle:o="linear",wrapLabelNWords:l=9}=t??{};let c=a?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(a){const f="default",p={[f]:"{0}({1})"};n!==void 0&&(p[n]="{0}([{1}]):::first"),s!==void 0&&(p[s]="{0}([{1}]):::last");for(const[m,g]of Object.entries(r)){const _=g.name.split(":").pop()??"";let b=xD.some(v=>_.startsWith(v)&&_.endsWith(v))?`<p>${_}</p>`:_;Object.keys(g.metadata??{}).length&&(b+=`<hr/><small><em>${Object.entries(g.metadata??{}).map(([v,S])=>`${v} = ${S}`).join(`
`)}</em></small>`);const w=(p[m]??p[f]).replace("{0}",Jf(m)).replace("{1}",b);c+=`	${w}
`}}const u={};for(const f of e){const p=f.source.split(":"),m=f.target.split(":"),g=p.filter((_,y)=>_===m[y]).join(":");u[g]||(u[g]=[]),u[g].push(f)}const d=new Set;function h(f,p){const m=f.length===1&&f[0].source===f[0].target;if(p&&!m){const g=p.split(":").pop();if(d.has(g))throw new Error(`Found duplicate subgraph '${g}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(g),c+=`	subgraph ${g}
`}for(const g of f){const{source:_,target:y,data:b,conditional:w}=g;let v="";if(b!==void 0){let S=b;const k=S.split(" ");k.length>l&&(S=Array.from({length:Math.ceil(k.length/l)},(x,A)=>k.slice(A*l,(A+1)*l).join(" ")).join("&nbsp;<br>&nbsp;")),v=w?` -. &nbsp;${S}&nbsp; .-> `:` -- &nbsp;${S}&nbsp; --> `}else v=w?" -.-> ":" --> ";c+=`	${Jf(_)}${v}${Jf(y)};
`}for(const g in u)g.startsWith(`${p}:`)&&g!==p&&h(u[g],g);p&&!m&&(c+=`	end
`)}h(u[""]??[],"");for(const f in u)!f.includes(":")&&f!==""&&h(u[f],f);return a&&(c+=kD(i??{})),c}async function PD(r,e){let{backgroundColor:t="white"}=e??{};const n=btoa(r);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));const s=`https://mermaid.ink/img/${n}?bgColor=${t}`,i=await fetch(s);if(!i.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${i.status}`,`Status text: ${i.statusText}`].join(`
`));return await i.blob()}function ED(r,e){if(r!==void 0&&!ho(r))return r;if(Vg(e))try{let t=e.getName();return t=t.startsWith("Runnable")?t.slice(8):t,t}catch{return e.getName()}else return e.name??"UnknownSchema"}function AD(r){return Vg(r.data)?{type:"runnable",data:{id:r.data.lc_id,name:r.data.getName()}}:{type:"schema",data:{...fs(r.data.schema),title:r.data.name}}}class Ld{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=(e==null?void 0:e.nodes)??this.nodes,this.edges=(e==null?void 0:e.edges)??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((t,n)=>{e[t.id]=ho(t.id)?n:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...AD(t)})),edges:this.edges.map(t=>{const n={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(n.data=t.data),typeof t.conditional<"u"&&(n.conditional=t.conditional),n})}}addNode(e,t,n){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);const s=t??At(),i={id:s,data:e,name:ED(t,e),metadata:n};return this.nodes[s]=i,i}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,n,s){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);const i={source:e.id,target:t.id,data:n,conditional:s};return this.edges.push(i),i}firstNode(){return Nv(this)}lastNode(){return Lv(this)}extend(e,t=""){let n=t;Object.values(e.nodes).map(c=>c.id).every(ho)&&(n="");const i=c=>n?`${n}:${c}`:c;Object.entries(e.nodes).forEach(([c,u])=>{this.nodes[i(c)]={...u,id:i(c)}});const a=e.edges.map(c=>({...c,source:i(c.source),target:i(c.target)}));this.edges=[...this.edges,...a];const o=e.firstNode(),l=e.lastNode();return[o?{id:i(o.id),data:o.data}:void 0,l?{id:i(l.id),data:l.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&Nv(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&Lv(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(s=>[s.id,s.name])),t=new Map;Object.values(e).forEach(s=>{t.set(s,(t.get(s)||0)+1)});const n=s=>{const i=e[s];return ho(s)&&t.get(i)===1?i:s};return new Ld({nodes:Object.fromEntries(Object.entries(this.nodes).map(([s,i])=>[n(s),{...i,id:n(s)}])),edges:this.edges.map(s=>({...s,source:n(s.source),target:n(s.target)}))})}drawMermaid(e){const{withStyles:t,curveStyle:n,nodeColors:s={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:i}=e??{},a=this.reid(),o=a.firstNode(),l=a.lastNode();return SD(a.nodes,a.edges,{firstNode:o==null?void 0:o.id,lastNode:l==null?void 0:l.id,withStyles:t,curveStyle:n,nodeColors:s,wrapLabelNWords:i})}async drawMermaidPng(e){const t=this.drawMermaid(e);return PD(t,{backgroundColor:e==null?void 0:e.backgroundColor})}}function Nv(r,e=[]){const t=new Set(r.edges.filter(s=>!e.includes(s.source)).map(s=>s.target)),n=[];for(const s of Object.values(r.nodes))!e.includes(s.id)&&!t.has(s.id)&&n.push(s);return n.length===1?n[0]:void 0}function Lv(r,e=[]){const t=new Set(r.edges.filter(s=>!e.includes(s.target)).map(s=>s.source)),n=[];for(const s of Object.values(r.nodes))!e.includes(s.id)&&!t.has(s.id)&&n.push(s);return n.length===1?n[0]:void 0}function OD(r){const e=new TextEncoder,t=new ReadableStream({async start(n){for await(const s of r)n.enqueue(e.encode(`event: data
data: ${JSON.stringify(s)}

`));n.enqueue(e.encode(`event: end

`)),n.close()}});return ln.fromReadableStream(t)}function jv(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.iterator]=="function"&&typeof r.next=="function"}const TD=r=>r!=null&&typeof r=="object"&&"next"in r&&typeof r.next=="function";function pm(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.asyncIterator]=="function"}function*Dv(r,e){for(;;){const{value:t,done:n}=ds.runWithConfig(Vi(r),e.next.bind(e),!0);if(n)break;yield t}}async function*mm(r,e){const t=e[Symbol.asyncIterator]();for(;;){const{value:n,done:s}=await ds.runWithConfig(Vi(r),t.next.bind(e),!0);if(s)break;yield n}}function ot(r,e){return r&&!Array.isArray(r)&&!(r instanceof Date)&&typeof r=="object"?r:{[e]:r}}class ct extends Zs{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new zs({bound:this,kwargs:e,config:{}})}map(){return new ju({bound:this})}withRetry(e){return new RD({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new zs({bound:this,config:e,kwargs:{}})}withFallbacks(e){const t=Array.isArray(e)?e:e.fallbacks;return new ID({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(Pe);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const n=Object.fromEntries(Object.entries(e).filter(([s])=>s!=="runId"));return Array.from({length:t},(s,i)=>Pe(i===0?e:n))}return Array.from({length:t},()=>Pe(e))}async batch(e,t,n){var l;const s=this._getOptionsList(t??{},e.length),i=((l=s[0])==null?void 0:l.maxConcurrency)??(n==null?void 0:n.maxConcurrency),a=new Hg({maxConcurrency:i,onFailedAttempt:c=>{throw c}}),o=e.map((c,u)=>a.call(async()=>{try{return await this.invoke(c,s[u])}catch(d){if(n!=null&&n.returnExceptions)return d;throw d}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const n=Pe(t),s=new ua({generator:this._streamIterator(e,n),config:n});return await s.setup,ln.fromAsyncGenerator(s)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=Pe(e):t=Pe({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,delete n.timeout,delete n.signal,[t,n]}async _callWithConfig(e,t,n){const s=Pe(n),i=await Dn(s),a=await(i==null?void 0:i.handleChainStart(this.toJSON(),ot(t,"input"),s.runId,s==null?void 0:s.runType,void 0,void 0,(s==null?void 0:s.runName)??this.getName()));delete s.runId;let o;try{const l=e.call(this,t,s,a);o=await hs(l,n==null?void 0:n.signal)}catch(l){throw await(a==null?void 0:a.handleChainError(l)),l}return await(a==null?void 0:a.handleChainEnd(ot(o,"output"))),o}async _batchWithConfig(e,t,n,s){var c;const i=this._getOptionsList(n??{},t.length),a=await Promise.all(i.map(Dn)),o=await Promise.all(a.map(async(u,d)=>{const h=await(u==null?void 0:u.handleChainStart(this.toJSON(),ot(t[d],"input"),i[d].runId,i[d].runType,void 0,void 0,i[d].runName??this.getName()));return delete i[d].runId,h}));let l;try{const u=e.call(this,t,i,o,s);l=await hs(u,(c=i==null?void 0:i[0])==null?void 0:c.signal)}catch(u){throw await Promise.all(o.map(d=>d==null?void 0:d.handleChainError(u))),u}return await Promise.all(o.map(u=>u==null?void 0:u.handleChainEnd(ot(l,"output")))),l}async*_transformStreamWithConfig(e,t,n){let s,i=!0,a,o=!0;const l=Pe(n),c=await Dn(l);async function*u(){for await(const h of e){if(i)if(s===void 0)s=h;else try{s=Fn(s,h)}catch{s=void 0,i=!1}yield h}}let d;try{const h=await O2(t.bind(this),u(),async()=>c==null?void 0:c.handleChainStart(this.toJSON(),{input:""},l.runId,l.runType,void 0,void 0,l.runName??this.getName()),n==null?void 0:n.signal,l);delete l.runId,d=h.setup;const f=d==null?void 0:d.handlers.find(C2);let p=h.output;f!==void 0&&d!==void 0&&(p=f.tapOutputIterable(d.runId,p));const m=d==null?void 0:d.handlers.find(T2);m!==void 0&&d!==void 0&&(p=m.tapOutputIterable(d.runId,p));for await(const g of p)if(yield g,o)if(a===void 0)a=g;else try{a=Fn(a,g)}catch{a=void 0,o=!1}}catch(h){throw await(d==null?void 0:d.handleChainError(h,void 0,void 0,void 0,{inputs:ot(s,"input")})),h}await(d==null?void 0:d.handleChainEnd(a??{},void 0,void 0,void 0,{inputs:ot(s,"input")}))}getGraph(e){const t=new Ld,n=t.addNode({name:`${this.getName()}Input`,schema:rs.any()}),s=t.addNode(this),i=t.addNode({name:`${this.getName()}Output`,schema:rs.any()});return t.addEdge(n,s),t.addEdge(s,i),t}pipe(e){return new $n({first:this,last:Ns(e)})}pick(e){return this.pipe(new $D(e))}assign(e){return this.pipe(new PP(new da({steps:e})))}async*transform(e,t){let n;for await(const s of e)n===void 0?n=s:n=Fn(n,s);yield*this._streamIterator(n,Pe(t))}async*streamLog(e,t,n){const s=new Cv({...n,autoClose:!1,_schemaFormat:"original"}),i=Pe(t);yield*this._streamLog(e,s,i)}async*_streamLog(e,t,n){const{callbacks:s}=n;if(s===void 0)n.callbacks=[t];else if(Array.isArray(s))n.callbacks=s.concat([t]);else{const l=s.copy();l.addHandler(t,!0),n.callbacks=l}const i=this.stream(e,n);async function a(){try{const l=await i;for await(const c of l){const u=new Wr({ops:[{op:"add",path:"/streamed_output/-",value:c}]});await t.writer.write(u)}}finally{await t.writer.close()}}const o=a();try{for await(const l of t)yield l}finally{await o}}streamEvents(e,t,n){let s;if(t.version==="v1")s=this._streamEventsV1(e,t,n);else if(t.version==="v2")s=this._streamEventsV2(e,t,n);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?OD(s):ln.fromAsyncGenerator(s)}async*_streamEventsV2(e,t,n){var p;const s=new I2({...n,autoClose:!1}),i=Pe(t),a=i.runId??At();i.runId=a;const o=i.callbacks;if(o===void 0)i.callbacks=[s];else if(Array.isArray(o))i.callbacks=o.concat(s);else{const m=o.copy();m.addHandler(s,!0),i.callbacks=m}const l=new AbortController,c=this;async function u(){try{let m;t!=null&&t.signal?"any"in AbortSignal?m=AbortSignal.any([l.signal,t.signal]):(m=t.signal,t.signal.addEventListener("abort",()=>{l.abort()},{once:!0})):m=l.signal;const g=await c.stream(e,{...i,signal:m}),_=s.tapOutputIterable(a,g);for await(const y of _)if(l.signal.aborted)break}finally{await s.finish()}}const d=u();let h=!1,f;try{for await(const m of s){if(!h){m.data.input=e,h=!0,f=m.run_id,yield m;continue}m.run_id===f&&m.event.endsWith("_end")&&(p=m.data)!=null&&p.input&&delete m.data.input,yield m}}finally{l.abort(),await d}}async*_streamEventsV1(e,t,n){let s,i=!1;const a=Pe(t),o=a.tags??[],l=a.metadata??{},c=a.runName??this.getName(),u=new Cv({...n,autoClose:!1,_schemaFormat:"streaming_events"}),d=new N2({...n}),h=this._streamLog(e,u,a);for await(const p of h){if(s?s=s.concat(p):s=Qo.fromRunLogPatch(p),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!i){i=!0;const y={...s.state},b={run_id:y.id,event:`on_${y.type}_start`,name:c,tags:o,metadata:l,data:{input:e}};d.includeEvent(b,y.type)&&(yield b)}const m=p.ops.filter(y=>y.path.startsWith("/logs/")).map(y=>y.path.split("/")[2]),g=[...new Set(m)];for(const y of g){let b,w={};const v=s.state.logs[y];if(v.end_time===void 0?v.streamed_output.length>0?b="stream":b="start":b="end",b==="start")v.inputs!==void 0&&(w.input=v.inputs);else if(b==="end")v.inputs!==void 0&&(w.input=v.inputs),w.output=v.final_output;else if(b==="stream"){const S=v.streamed_output.length;if(S!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${S} instead. Encountered in: "${v.name}"`);w={chunk:v.streamed_output[0]},v.streamed_output=[]}yield{event:`on_${v.type}_${b}`,name:v.name,run_id:v.id,tags:v.tags,metadata:v.metadata,data:w}}const{state:_}=s;if(_.streamed_output.length>0){const y=_.streamed_output.length;if(y!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${y} instead. Encountered in: "${_.name}"`);const b={chunk:_.streamed_output[0]};_.streamed_output=[];const w={event:`on_${_.type}_stream`,run_id:_.id,tags:o,metadata:l,name:c,data:b};d.includeEvent(w,_.type)&&(yield w)}}const f=s==null?void 0:s.state;if(f!==void 0){const p={event:`on_${f.type}_end`,name:c,run_id:f.id,tags:o,metadata:l,data:{output:f.final_output}};d.includeEvent(p,f.type)&&(yield p)}}static isRunnable(e){return Vg(e)}withListeners({onStart:e,onEnd:t,onError:n}){return new zs({bound:this,config:{},configFactories:[s=>({callbacks:[new yP({config:s,onStart:e,onEnd:t,onError:n})]})]})}asTool(e){return MD(this,e)}}class zs extends ct{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=Ov(this.config,...e);return Ov(t,...this.configFactories?await Promise.all(this.configFactories.map(async n=>await n(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(Pe(t),this.kwargs))}async batch(e,t,n){const s=Array.isArray(t)?await Promise.all(t.map(async i=>this._mergeConfig(Pe(i),this.kwargs))):await this._mergeConfig(Pe(t),this.kwargs);return this.bound.batch(e,s,n)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(Pe(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(Pe(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(Pe(t),this.kwargs))}streamEvents(e,t,n){const s=this,i=async function*(){yield*s.bound.streamEvents(e,{...await s._mergeConfig(Pe(t),s.kwargs),version:t.version},n)};return ln.fromAsyncGenerator(i())}static isRunnableBinding(e){return e.bound&&ct.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:n}){return new zs({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new yP({config:s,onStart:e,onEnd:t,onError:n})]})]})}}class ju extends ct{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new ju({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,n){return this.bound.batch(e,yt(t,{callbacks:n==null?void 0:n.getChild()}))}withListeners({onStart:e,onEnd:t,onError:n}){return new ju({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:n})})}}class RD extends zs{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,n){const s=e>1?`retry:attempt:${e}`:void 0;return yt(t,{callbacks:n==null?void 0:n.getChild(s)})}async _invoke(e,t,n){return Ru(s=>super.invoke(e,this._patchConfigForRetry(s,t,n)),{onFailedAttempt:s=>this.onFailedAttempt(s,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,n,s){const i={};try{await Ru(async a=>{const o=e.map((h,f)=>f).filter(h=>i[h.toString()]===void 0||i[h.toString()]instanceof Error),l=o.map(h=>e[h]),c=o.map(h=>this._patchConfigForRetry(a,t==null?void 0:t[h],n==null?void 0:n[h])),u=await super.batch(l,c,{...s,returnExceptions:!0});let d;for(let h=0;h<u.length;h+=1){const f=u[h],p=o[h];f instanceof Error&&d===void 0&&(d=f,d.input=l[h]),i[p.toString()]=f}if(d)throw d;return u},{onFailedAttempt:a=>this.onFailedAttempt(a,a.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(a){if((s==null?void 0:s.returnExceptions)!==!0)throw a}return Object.keys(i).sort((a,o)=>parseInt(a,10)-parseInt(o,10)).map(a=>i[parseInt(a,10)])}async batch(e,t,n){return this._batchWithConfig(this._batch.bind(this),e,t,n)}}class $n extends ct{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){var l;const n=Pe(t),s=await Dn(n),i=await(s==null?void 0:s.handleChainStart(this.toJSON(),ot(e,"input"),n.runId,void 0,void 0,void 0,n==null?void 0:n.runName));delete n.runId;let a=e,o;try{const c=[this.first,...this.middle];for(let u=0;u<c.length;u+=1){const h=c[u].invoke(a,yt(n,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${u+1}`)}));a=await hs(h,t==null?void 0:t.signal)}if((l=t==null?void 0:t.signal)!=null&&l.aborted)throw new Error("Aborted");o=await this.last.invoke(a,yt(n,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(c){throw await(i==null?void 0:i.handleChainError(c)),c}return await(i==null?void 0:i.handleChainEnd(ot(o,"output"))),o}async batch(e,t,n){var l;const s=this._getOptionsList(t??{},e.length),i=await Promise.all(s.map(Dn)),a=await Promise.all(i.map(async(c,u)=>{const d=await(c==null?void 0:c.handleChainStart(this.toJSON(),ot(e[u],"input"),s[u].runId,void 0,void 0,void 0,s[u].runName));return delete s[u].runId,d}));let o=e;try{for(let c=0;c<this.steps.length;c+=1){const d=this.steps[c].batch(o,a.map((h,f)=>{const p=h==null?void 0:h.getChild(this.omitSequenceTags?void 0:`seq:step:${c+1}`);return yt(s[f],{callbacks:p})}),n);o=await hs(d,(l=s[0])==null?void 0:l.signal)}}catch(c){throw await Promise.all(a.map(u=>u==null?void 0:u.handleChainError(c))),c}return await Promise.all(a.map(c=>c==null?void 0:c.handleChainEnd(ot(o,"output")))),o}async*_streamIterator(e,t){var d;const n=await Dn(t),{runId:s,...i}=t??{},a=await(n==null?void 0:n.handleChainStart(this.toJSON(),ot(e,"input"),s,void 0,void 0,void 0,i==null?void 0:i.runName)),o=[this.first,...this.middle,this.last];let l=!0,c;async function*u(){yield e}try{let h=o[0].transform(u(),yt(i,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let f=1;f<o.length;f+=1)h=await o[f].transform(h,yt(i,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:`seq:step:${f+1}`)}));for await(const f of h)if((d=t==null?void 0:t.signal)==null||d.throwIfAborted(),yield f,l)if(c===void 0)c=f;else try{c=Fn(c,f)}catch{c=void 0,l=!1}}catch(h){throw await(a==null?void 0:a.handleChainError(h)),h}await(a==null?void 0:a.handleChainEnd(ot(c,"output")))}getGraph(e){const t=new Ld;let n=null;return this.steps.forEach((s,i)=>{const a=s.getGraph(e);i!==0&&a.trimFirstNode(),i!==this.steps.length-1&&a.trimLastNode(),t.extend(a);const o=a.firstNode();if(!o)throw new Error(`Runnable ${s} has no first node`);n&&t.addEdge(n,o),n=a.lastNode()}),t}pipe(e){return $n.isRunnableSequence(e)?new $n({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new $n({first:this.first,middle:[...this.middle,this.last],last:Ns(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&ct.isRunnable(e)}static from([e,...t],n){let s={};return typeof n=="string"?s.name=n:n!==void 0&&(s=n),new $n({...s,first:Ns(e),middle:t.slice(0,-1).map(Ns),last:Ns(t[t.length-1])})}}class da extends ct{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,n]of Object.entries(e.steps))this.steps[t]=Ns(n)}static from(e){return new da({steps:e})}async invoke(e,t){const n=Pe(t),s=await Dn(n),i=await(s==null?void 0:s.handleChainStart(this.toJSON(),{input:e},n.runId,void 0,void 0,void 0,n==null?void 0:n.runName));delete n.runId;const a={};try{const o=Object.entries(this.steps).map(async([l,c])=>{a[l]=await c.invoke(e,yt(n,{callbacks:i==null?void 0:i.getChild(`map:key:${l}`)}))});await hs(Promise.all(o),t==null?void 0:t.signal)}catch(o){throw await(i==null?void 0:i.handleChainError(o)),o}return await(i==null?void 0:i.handleChainEnd(a)),a}async*_transform(e,t,n){const s={...this.steps},i=bP(e,Object.keys(s).length),a=new Map(Object.entries(s).map(([o,l],c)=>{const u=l.transform(i[c],yt(n,{callbacks:t==null?void 0:t.getChild(`map:key:${o}`)}));return[o,u.next().then(d=>({key:o,gen:u,result:d}))]}));for(;a.size;){const o=Promise.race(a.values()),{key:l,result:c,gen:u}=await hs(o,n==null?void 0:n.signal);a.delete(l),c.done||(yield{[l]:c.value},a.set(l,u.next().then(d=>({key:l,gen:u,result:d}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=Pe(t),i=new ua({generator:this.transform(n(),s),config:s});return await i.setup,ln.fromAsyncGenerator(i)}}class Zg extends ct{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!qg(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){const[n]=this._getOptionsList(t??{},1),s=await Dn(n),i=this.func(yt(n,{callbacks:s}),e);return hs(i,n==null?void 0:n.signal)}async*_streamIterator(e,t){var i,a;const[n]=this._getOptionsList(t??{},1),s=await this.invoke(e,t);if(pm(s)){for await(const o of s)(i=n==null?void 0:n.signal)==null||i.throwIfAborted(),yield o;return}if(TD(s)){for(;;){(a=n==null?void 0:n.signal)==null||a.throwIfAborted();const o=s.next();if(o.done)break;yield o.value}return}yield s}static from(e){return new Zg({func:e})}}function CD(r){if(qg(r))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}class ni extends ct{static lc_name(){return"RunnableLambda"}constructor(e){if(qg(e.func))return Zg.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),CD(e.func),this.func=e.func}static from(e){return new ni({func:e})}async _invoke(e,t,n){return new Promise((s,i)=>{const a=yt(t,{callbacks:n==null?void 0:n.getChild(),recursionLimit:((t==null?void 0:t.recursionLimit)??Vf)-1});ds.runWithConfig(Vi(a),async()=>{var o,l;try{let c=await this.func(e,{...a});if(c&&ct.isRunnable(c)){if((t==null?void 0:t.recursionLimit)===0)throw new Error("Recursion limit reached.");c=await c.invoke(e,{...a,recursionLimit:(a.recursionLimit??Vf)-1})}else if(pm(c)){let u;for await(const d of mm(a,c))if((o=t==null?void 0:t.signal)==null||o.throwIfAborted(),u===void 0)u=d;else try{u=Fn(u,d)}catch{u=d}c=u}else if(jv(c)){let u;for(const d of Dv(a,c))if((l=t==null?void 0:t.signal)==null||l.throwIfAborted(),u===void 0)u=d;else try{u=Fn(u,d)}catch{u=d}c=u}s(c)}catch(c){i(c)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async*_transform(e,t,n){var o,l;let s;for await(const c of e)if(s===void 0)s=c;else try{s=Fn(s,c)}catch{s=c}const i=yt(n,{callbacks:t==null?void 0:t.getChild(),recursionLimit:((n==null?void 0:n.recursionLimit)??Vf)-1}),a=await new Promise((c,u)=>{ds.runWithConfig(Vi(i),async()=>{try{const d=await this.func(s,{...i,config:i});c(d)}catch(d){u(d)}})});if(a&&ct.isRunnable(a)){if((n==null?void 0:n.recursionLimit)===0)throw new Error("Recursion limit reached.");const c=await a.stream(s,i);for await(const u of c)yield u}else if(pm(a))for await(const c of mm(i,a))(o=n==null?void 0:n.signal)==null||o.throwIfAborted(),yield c;else if(jv(a))for(const c of Dv(i,a))(l=n==null?void 0:n.signal)==null||l.throwIfAborted(),yield c;else yield a}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=Pe(t),i=new ua({generator:this.transform(n(),s),config:s});return await i.setup,ln.fromAsyncGenerator(i)}}class ID extends ct{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const n=Pe(t),s=await Dn(n),{runId:i,...a}=n,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),ot(e,"input"),i,void 0,void 0,void 0,a==null?void 0:a.runName)),l=yt(a,{callbacks:o==null?void 0:o.getChild()});return await ds.runWithConfig(l,async()=>{var d;let u;for(const h of this.runnables()){(d=n==null?void 0:n.signal)==null||d.throwIfAborted();try{const f=await h.invoke(e,l);return await(o==null?void 0:o.handleChainEnd(ot(f,"output"))),f}catch(f){u===void 0&&(u=f)}}throw u===void 0?new Error("No error stored at end of fallback."):(await(o==null?void 0:o.handleChainError(u)),u)})}async*_streamIterator(e,t){var d;const n=Pe(t),s=await Dn(n),{runId:i,...a}=n,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),ot(e,"input"),i,void 0,void 0,void 0,a==null?void 0:a.runName));let l,c;for(const h of this.runnables()){(d=n==null?void 0:n.signal)==null||d.throwIfAborted();const f=yt(a,{callbacks:o==null?void 0:o.getChild()});try{const p=await h.stream(e,f);c=mm(f,p);break}catch(p){l===void 0&&(l=p)}}if(c===void 0){const h=l??new Error("No error stored at end of fallback.");throw await(o==null?void 0:o.handleChainError(h)),h}let u;try{for await(const h of c){yield h;try{u=u===void 0?u:Fn(u,h)}catch{u=void 0}}}catch(h){throw await(o==null?void 0:o.handleChainError(h)),h}await(o==null?void 0:o.handleChainEnd(ot(u,"output")))}async batch(e,t,n){var l;if(n!=null&&n.returnExceptions)throw new Error("Not implemented.");const s=this._getOptionsList(t??{},e.length),i=await Promise.all(s.map(c=>Dn(c))),a=await Promise.all(i.map(async(c,u)=>{const d=await(c==null?void 0:c.handleChainStart(this.toJSON(),ot(e[u],"input"),s[u].runId,void 0,void 0,void 0,s[u].runName));return delete s[u].runId,d}));let o;for(const c of this.runnables()){(l=s[0].signal)==null||l.throwIfAborted();try{const u=await c.batch(e,a.map((d,h)=>yt(s[h],{callbacks:d==null?void 0:d.getChild()})),n);return await Promise.all(a.map((d,h)=>d==null?void 0:d.handleChainEnd(ot(u[h],"output")))),u}catch(u){o===void 0&&(o=u)}}throw o?(await Promise.all(a.map(c=>c==null?void 0:c.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function Ns(r){if(typeof r=="function")return new ni({func:r});if(ct.isRunnable(r))return r;if(!Array.isArray(r)&&typeof r=="object"){const e={};for(const[t,n]of Object.entries(r))e[t]=Ns(n);return new da({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class PP extends ct{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof da&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const n=await this.mapper.invoke(e,t);return{...e,...n}}async*_transform(e,t,n){const s=this.mapper.getStepsKeys(),[i,a]=bP(e),o=this.mapper.transform(a,yt(n,{callbacks:t==null?void 0:t.getChild()})),l=o.next();for await(const c of i){if(typeof c!="object"||Array.isArray(c))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof c}`);const u=Object.fromEntries(Object.entries(c).filter(([d])=>!s.includes(d)));Object.keys(u).length>0&&(yield u)}yield(await l).value;for await(const c of o)yield c}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=Pe(t),i=new ua({generator:this.transform(n(),s),config:s});return await i.setup,ln.fromAsyncGenerator(i)}}class $D extends ct{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const t=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const n=await this._pick(t);n!==void 0&&(yield n)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=Pe(t),i=new ua({generator:this.transform(n(),s),config:s});return await i.setup,ln.fromAsyncGenerator(i)}}class Fv extends zs{constructor(e){const t=$n.from([ni.from(async n=>{let s;if(VS(n))try{s=await this.schema.parseAsync(n.args)}catch{throw new pN("Received tool input did not match expected schema",JSON.stringify(n.args))}else s=n;return s}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}function MD(r,e){var s;const t=e.name??r.getName(),n=e.description??((s=e.schema)==null?void 0:s.description);return e.schema.constructor===rs.ZodString?new Fv({name:t,description:n,schema:rs.object({input:rs.string()}).transform(i=>i.input),bound:r}):new Fv({name:t,description:n,schema:e.schema,bound:r})}/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var ND=typeof window=="object"?window:{},ue="0123456789abcdef".split(""),LD=[-2147483648,8388608,32768,128],Sn=[24,16,8,0],it=[];function Un(r){r?(it[0]=it[16]=it[1]=it[2]=it[3]=it[4]=it[5]=it[6]=it[7]=it[8]=it[9]=it[10]=it[11]=it[12]=it[13]=it[14]=it[15]=0,this.blocks=it):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Un.prototype.update=function(r){if(!this.finalized){var e=typeof r!="string";e&&r.constructor===ND.ArrayBuffer&&(r=new Uint8Array(r));for(var t,n=0,s,i=r.length||0,a=this.blocks;n<i;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),e)for(s=this.start;n<i&&s<64;++n)a[s>>2]|=r[n]<<Sn[s++&3];else for(s=this.start;n<i&&s<64;++n)t=r.charCodeAt(n),t<128?a[s>>2]|=t<<Sn[s++&3]:t<2048?(a[s>>2]|=(192|t>>6)<<Sn[s++&3],a[s>>2]|=(128|t&63)<<Sn[s++&3]):t<55296||t>=57344?(a[s>>2]|=(224|t>>12)<<Sn[s++&3],a[s>>2]|=(128|t>>6&63)<<Sn[s++&3],a[s>>2]|=(128|t&63)<<Sn[s++&3]):(t=65536+((t&1023)<<10|r.charCodeAt(++n)&1023),a[s>>2]|=(240|t>>18)<<Sn[s++&3],a[s>>2]|=(128|t>>12&63)<<Sn[s++&3],a[s>>2]|=(128|t>>6&63)<<Sn[s++&3],a[s>>2]|=(128|t&63)<<Sn[s++&3]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=a[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};Un.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var r=this.blocks,e=this.lastByteIndex;r[16]=this.block,r[e>>2]|=LD[e&3],this.block=r[16],e>=56&&(this.hashed||this.hash(),r[0]=this.block,r[16]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=r[9]=r[10]=r[11]=r[12]=r[13]=r[14]=r[15]=0),r[14]=this.hBytes<<3|this.bytes>>>29,r[15]=this.bytes<<3,this.hash()}};Un.prototype.hash=function(){var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4,i,a,o,l=this.blocks;for(a=16;a<80;++a)o=l[a-3]^l[a-8]^l[a-14]^l[a-16],l[a]=o<<1|o>>>31;for(a=0;a<20;a+=5)i=e&t|~e&n,o=r<<5|r>>>27,s=o+i+s+1518500249+l[a]<<0,e=e<<30|e>>>2,i=r&e|~r&t,o=s<<5|s>>>27,n=o+i+n+1518500249+l[a+1]<<0,r=r<<30|r>>>2,i=s&r|~s&e,o=n<<5|n>>>27,t=o+i+t+1518500249+l[a+2]<<0,s=s<<30|s>>>2,i=n&s|~n&r,o=t<<5|t>>>27,e=o+i+e+1518500249+l[a+3]<<0,n=n<<30|n>>>2,i=t&n|~t&s,o=e<<5|e>>>27,r=o+i+r+1518500249+l[a+4]<<0,t=t<<30|t>>>2;for(;a<40;a+=5)i=e^t^n,o=r<<5|r>>>27,s=o+i+s+1859775393+l[a]<<0,e=e<<30|e>>>2,i=r^e^t,o=s<<5|s>>>27,n=o+i+n+1859775393+l[a+1]<<0,r=r<<30|r>>>2,i=s^r^e,o=n<<5|n>>>27,t=o+i+t+1859775393+l[a+2]<<0,s=s<<30|s>>>2,i=n^s^r,o=t<<5|t>>>27,e=o+i+e+1859775393+l[a+3]<<0,n=n<<30|n>>>2,i=t^n^s,o=e<<5|e>>>27,r=o+i+r+1859775393+l[a+4]<<0,t=t<<30|t>>>2;for(;a<60;a+=5)i=e&t|e&n|t&n,o=r<<5|r>>>27,s=o+i+s-1894007588+l[a]<<0,e=e<<30|e>>>2,i=r&e|r&t|e&t,o=s<<5|s>>>27,n=o+i+n-1894007588+l[a+1]<<0,r=r<<30|r>>>2,i=s&r|s&e|r&e,o=n<<5|n>>>27,t=o+i+t-1894007588+l[a+2]<<0,s=s<<30|s>>>2,i=n&s|n&r|s&r,o=t<<5|t>>>27,e=o+i+e-1894007588+l[a+3]<<0,n=n<<30|n>>>2,i=t&n|t&s|n&s,o=e<<5|e>>>27,r=o+i+r-1894007588+l[a+4]<<0,t=t<<30|t>>>2;for(;a<80;a+=5)i=e^t^n,o=r<<5|r>>>27,s=o+i+s-899497514+l[a]<<0,e=e<<30|e>>>2,i=r^e^t,o=s<<5|s>>>27,n=o+i+n-899497514+l[a+1]<<0,r=r<<30|r>>>2,i=s^r^e,o=n<<5|n>>>27,t=o+i+t-899497514+l[a+2]<<0,s=s<<30|s>>>2,i=n^s^r,o=t<<5|t>>>27,e=o+i+e-899497514+l[a+3]<<0,n=n<<30|n>>>2,i=t^n^s,o=e<<5|e>>>27,r=o+i+r-899497514+l[a+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+r<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+n<<0,this.h4=this.h4+s<<0};Un.prototype.hex=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4;return ue[r>>28&15]+ue[r>>24&15]+ue[r>>20&15]+ue[r>>16&15]+ue[r>>12&15]+ue[r>>8&15]+ue[r>>4&15]+ue[r&15]+ue[e>>28&15]+ue[e>>24&15]+ue[e>>20&15]+ue[e>>16&15]+ue[e>>12&15]+ue[e>>8&15]+ue[e>>4&15]+ue[e&15]+ue[t>>28&15]+ue[t>>24&15]+ue[t>>20&15]+ue[t>>16&15]+ue[t>>12&15]+ue[t>>8&15]+ue[t>>4&15]+ue[t&15]+ue[n>>28&15]+ue[n>>24&15]+ue[n>>20&15]+ue[n>>16&15]+ue[n>>12&15]+ue[n>>8&15]+ue[n>>4&15]+ue[n&15]+ue[s>>28&15]+ue[s>>24&15]+ue[s>>20&15]+ue[s>>16&15]+ue[s>>12&15]+ue[s>>8&15]+ue[s>>4&15]+ue[s&15]};Un.prototype.toString=Un.prototype.hex;Un.prototype.digest=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4;return[r>>24&255,r>>16&255,r>>8&255,r&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,n>>24&255,n>>16&255,n>>8&255,n&255,s>>24&255,s>>16&255,s>>8&255,s&255]};Un.prototype.array=Un.prototype.digest;Un.prototype.arrayBuffer=function(){this.finalize();var r=new ArrayBuffer(20),e=new DataView(r);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),r};const jD=r=>new Un(!0).update(r).hex(),Bv=(...r)=>jD(r.join("_"));class DD{}const FD=new Map;class Gg extends DD{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(Bv(e,t))??null)}async update(e,t,n){this.cache.set(Bv(e,t),n)}static global(){return new Gg(FD)}}class EP extends Zs{}class BD extends EP{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new Ui(this.value)]}}class zD extends EP{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return ZS(this.messages)}toChatMessages(){return this.messages}}var Ea={},zv;function UD(){if(zv)return Ea;zv=1,Ea.byteLength=o,Ea.toByteArray=c,Ea.fromByteArray=h;for(var r=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,i=n.length;s<i;++s)r[s]=n[s],e[n.charCodeAt(s)]=s;e[45]=62,e[95]=63;function a(f){var p=f.length;if(p%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var m=f.indexOf("=");m===-1&&(m=p);var g=m===p?0:4-m%4;return[m,g]}function o(f){var p=a(f),m=p[0],g=p[1];return(m+g)*3/4-g}function l(f,p,m){return(p+m)*3/4-m}function c(f){var p,m=a(f),g=m[0],_=m[1],y=new t(l(f,g,_)),b=0,w=_>0?g-4:g,v;for(v=0;v<w;v+=4)p=e[f.charCodeAt(v)]<<18|e[f.charCodeAt(v+1)]<<12|e[f.charCodeAt(v+2)]<<6|e[f.charCodeAt(v+3)],y[b++]=p>>16&255,y[b++]=p>>8&255,y[b++]=p&255;return _===2&&(p=e[f.charCodeAt(v)]<<2|e[f.charCodeAt(v+1)]>>4,y[b++]=p&255),_===1&&(p=e[f.charCodeAt(v)]<<10|e[f.charCodeAt(v+1)]<<4|e[f.charCodeAt(v+2)]>>2,y[b++]=p>>8&255,y[b++]=p&255),y}function u(f){return r[f>>18&63]+r[f>>12&63]+r[f>>6&63]+r[f&63]}function d(f,p,m){for(var g,_=[],y=p;y<m;y+=3)g=(f[y]<<16&16711680)+(f[y+1]<<8&65280)+(f[y+2]&255),_.push(u(g));return _.join("")}function h(f){for(var p,m=f.length,g=m%3,_=[],y=16383,b=0,w=m-g;b<w;b+=y)_.push(d(f,b,b+y>w?w:b+y));return g===1?(p=f[m-1],_.push(r[p>>2]+r[p<<4&63]+"==")):g===2&&(p=(f[m-2]<<8)+f[m-1],_.push(r[p>>10]+r[p>>4&63]+r[p<<2&63]+"=")),_.join("")}return Ea}var qD=UD();const WD=ta(qD);var HD=Object.defineProperty,VD=(r,e,t)=>e in r?HD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ZD=(r,e,t)=>(VD(r,e+"",t),t);function GD(r,e){let t=Array.from({length:r.length},(n,s)=>({start:s,end:s+1}));for(;t.length>1;){let n=null;for(let s=0;s<t.length-1;s++){const i=r.slice(t[s].start,t[s+1].end),a=e.get(i.join(","));a!=null&&(n==null||a<n[0])&&(n=[a,s])}if(n!=null){const s=n[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function JD(r,e){return r.length===1?[e.get(r.join(","))]:GD(r,e).map(t=>e.get(r.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function KD(r){return r.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var gm=class{constructor(r,e){M(this,"specialTokens");M(this,"inverseSpecialTokens");M(this,"patStr");M(this,"textEncoder",new TextEncoder);M(this,"textDecoder",new TextDecoder("utf-8"));M(this,"rankMap",new Map);M(this,"textMap",new Map);this.patStr=r.pat_str;const t=r.bpe_ranks.split(`
`).filter(Boolean).reduce((n,s)=>{const[i,a,...o]=s.split(" "),l=Number.parseInt(a,10);return o.forEach((c,u)=>n[c]=l+u),n},{});for(const[n,s]of Object.entries(t)){const i=WD.toByteArray(n);this.rankMap.set(i.join(","),s),this.textMap.set(s,i)}this.specialTokens={...r.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[s,i])=>(n[i]=this.textEncoder.encode(s),n),{})}encode(r,e=[],t="all"){const n=new RegExp(this.patStr,"ug"),s=gm.specialTokenRegex(Object.keys(this.specialTokens)),i=[],a=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(c=>!a.has(c)):t);if(o.size>0){const c=gm.specialTokenRegex([...o]),u=r.match(c);if(u!=null)throw new Error(`The text contains a special token that is not allowed: ${u[0]}`)}let l=0;for(;;){let c=null,u=l;for(;s.lastIndex=u,c=s.exec(r),!(c==null||a.has(c[0]));)u=c.index+1;const d=(c==null?void 0:c.index)??r.length;for(const f of r.substring(l,d).matchAll(n)){const p=this.textEncoder.encode(f[0]),m=this.rankMap.get(p.join(","));if(m!=null){i.push(m);continue}i.push(...JD(p,this.rankMap))}if(c==null)break;let h=this.specialTokens[c[0]];i.push(h),l=c.index+c[0].length}return i}decode(r){const e=[];let t=0;for(let i=0;i<r.length;++i){const a=r[i],o=this.textMap.get(a)??this.inverseSpecialTokens[a];o!=null&&(e.push(o),t+=o.length)}const n=new Uint8Array(t);let s=0;for(const i of e)n.set(i,s),s+=i.length;return this.textDecoder.decode(n)}},AP=gm;ZD(AP,"specialTokenRegex",r=>new RegExp(r.map(e=>KD(e)).join("|"),"g"));function XD(r){switch(r){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-preview":case"o1-preview-2024-09-12":case"o1-mini-2024-09-12":case"o3-mini":case"o3-mini-2025-01-31":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":return"o200k_base";default:throw new Error("Unknown model")}}const mc={},YD=new Hg({});async function QD(r){return r in mc||(mc[r]=YD.fetch(`https://tiktoken.pages.dev/js/${r}.json`).then(e=>e.json()).then(e=>new AP(e)).catch(e=>{throw delete mc[r],e})),await mc[r]}async function eF(r){return QD(XD(r))}const tF=r=>r.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":r.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":r.startsWith("gpt-4-32k")?"gpt-4-32k":r.startsWith("gpt-4-")?"gpt-4":r.startsWith("gpt-4o")?"gpt-4o":r;function Ol(r){return typeof r!="object"||!r?!1:!!("type"in r&&r.type==="function"&&"function"in r&&typeof r.function=="object"&&r.function&&"name"in r.function&&"parameters"in r.function)}const nF=()=>!1;class rF extends ct{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??nF(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class sF extends rF{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...n}){const{cache:s,...i}=n;super({callbacks:e??t,...i}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof s=="object"?this.cache=s:s?this.cache=Gg.global():this.cache=void 0,this.caller=new Hg(n??{})}async getNumTokens(e){if(typeof e!="string")return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await eF("modelName"in this?tF(this.modelName):"gpt2")}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}return t}static _convertInputToPromptValue(e){return typeof e=="string"?new BD(e):Array.isArray(e)?new zD(e.map(eo)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const n={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(n).filter(([a,o])=>o!==void 0).map(([a,o])=>`${a}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}class ps extends ct{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){const n=Pe(t);return this.func&&await this.func(e,n),this._callWithConfig(s=>Promise.resolve(s),e,n)}async*transform(e,t){const n=Pe(t);let s,i=!0;for await(const a of this._transformStreamWithConfig(e,o=>o,n))if(yield a,i)if(s===void 0)s=a;else try{s=Fn(s,a)}catch{s=void 0,i=!1}this.func&&s!==void 0&&await this.func(s,n)}static assign(e){return new PP(new da({steps:e}))}}function el(r){var n;if(!r||typeof r!="object"||Array.isArray(r))return!1;const e=r;return e._def||Object.values(rs.ZodFirstPartyTypeKind).includes(((n=e.constructor)==null?void 0:n.name)??"NOT_INCLUDED")?!0:typeof e.parse=="function"&&typeof e.parseAsync=="function"&&typeof e.safeParse=="function"&&typeof e.safeParseAsync=="function"}class Xn extends sF{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]}),Object.defineProperty(this,"disableStreaming",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_separateRunnableConfigFromCallOptionsCompat(e){const[t,n]=super._separateRunnableConfigFromCallOptions(e);return n.signal=t.signal,[t,n]}async invoke(e,t){const n=Xn._convertInputToPromptValue(e);return(await this.generatePrompt([n],t,t==null?void 0:t.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,n){throw new Error("Not implemented.")}async*_streamIterator(e,t){var n;if(this._streamResponseChunks===Xn.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(e,t);else{const i=Xn._convertInputToPromptValue(e).toChatMessages(),[a,o]=this._separateRunnableConfigFromCallOptionsCompat(t),l={...a.metadata,...this.getLsParams(o)},c=await Wt.configure(a.callbacks,this.callbacks,a.tags,this.tags,l,this.metadata,{verbose:this.verbose}),u={options:o,invocation_params:this==null?void 0:this.invocationParams(o),batch_size:1},d=await(c==null?void 0:c.handleChatModelStart(this.toJSON(),[i],a.runId,void 0,u,void 0,void 0,a.runName));let h,f;try{for await(const p of this._streamResponseChunks(i,o,d==null?void 0:d[0])){if(p.message.id==null){const m=(n=d==null?void 0:d.at(0))==null?void 0:n.runId;m!=null&&p.message._updateId(`run-${m}`)}p.message.response_metadata={...p.generationInfo,...p.message.response_metadata},yield p.message,h?h=h.concat(p):h=p,aw(p.message)&&p.message.usage_metadata!==void 0&&(f={tokenUsage:{promptTokens:p.message.usage_metadata.input_tokens,completionTokens:p.message.usage_metadata.output_tokens,totalTokens:p.message.usage_metadata.total_tokens}})}}catch(p){throw await Promise.all((d??[]).map(m=>m==null?void 0:m.handleLLMError(p))),p}await Promise.all((d??[]).map(p=>p==null?void 0:p.handleLLMEnd({generations:[[h]],llmOutput:f})))}}getLsParams(e){const t=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:t}}async _generateUncached(e,t,n,s){var d,h;const i=e.map(f=>f.map(eo));let a;if(s!==void 0&&s.length===i.length)a=s;else{const f={...n.metadata,...this.getLsParams(t)},p=await Wt.configure(n.callbacks,this.callbacks,n.tags,this.tags,f,this.metadata,{verbose:this.verbose}),m={options:t,invocation_params:this==null?void 0:this.invocationParams(t),batch_size:1};a=await(p==null?void 0:p.handleChatModelStart(this.toJSON(),i,n.runId,void 0,m,void 0,void 0,n.runName))}const o=[],l=[];if(!!(a!=null&&a[0].handlers.find(o2))&&!this.disableStreaming&&i.length===1&&this._streamResponseChunks!==Xn.prototype._streamResponseChunks)try{const f=await this._streamResponseChunks(i[0],t,a==null?void 0:a[0]);let p,m;for await(const g of f){if(g.message.id==null){const _=(d=a==null?void 0:a.at(0))==null?void 0:d.runId;_!=null&&g.message._updateId(`run-${_}`)}p===void 0?p=g:p=Fn(p,g),aw(g.message)&&g.message.usage_metadata!==void 0&&(m={tokenUsage:{promptTokens:g.message.usage_metadata.input_tokens,completionTokens:g.message.usage_metadata.output_tokens,totalTokens:g.message.usage_metadata.total_tokens}})}if(p===void 0)throw new Error("Received empty response from chat model call.");o.push([p]),await(a==null?void 0:a[0].handleLLMEnd({generations:o,llmOutput:m}))}catch(f){throw await(a==null?void 0:a[0].handleLLMError(f)),f}else{const f=await Promise.allSettled(i.map((p,m)=>this._generate(p,{...t,promptIndex:m},a==null?void 0:a[m])));await Promise.all(f.map(async(p,m)=>{var g,_,y;if(p.status==="fulfilled"){const b=p.value;for(const w of b.generations){if(w.message.id==null){const v=(g=a==null?void 0:a.at(0))==null?void 0:g.runId;v!=null&&w.message._updateId(`run-${v}`)}w.message.response_metadata={...w.generationInfo,...w.message.response_metadata}}return b.generations.length===1&&(b.generations[0].message.response_metadata={...b.llmOutput,...b.generations[0].message.response_metadata}),o[m]=b.generations,l[m]=b.llmOutput,(_=a==null?void 0:a[m])==null?void 0:_.handleLLMEnd({generations:[b.generations],llmOutput:b.llmOutput})}else return await((y=a==null?void 0:a[m])==null?void 0:y.handleLLMError(p.reason)),Promise.reject(p.reason)}))}const u={generations:o,llmOutput:l.length?(h=this._combineLLMOutput)==null?void 0:h.call(this,...l):void 0};return Object.defineProperty(u,Iv,{value:a?{runIds:a==null?void 0:a.map(f=>f.runId)}:void 0,configurable:!0}),u}async _generateCached({messages:e,cache:t,llmStringKey:n,parsedOptions:s,handledOptions:i}){const a=e.map(g=>g.map(eo)),o={...i.metadata,...this.getLsParams(s)},l=await Wt.configure(i.callbacks,this.callbacks,i.tags,this.tags,o,this.metadata,{verbose:this.verbose}),c={options:s,invocation_params:this==null?void 0:this.invocationParams(s),batch_size:1},u=await(l==null?void 0:l.handleChatModelStart(this.toJSON(),a,i.runId,void 0,c,void 0,void 0,i.runName)),d=[],f=(await Promise.allSettled(a.map(async(g,_)=>{const y=Xn._convertInputToPromptValue(g).toString(),b=await t.lookup(y,n);return b==null&&d.push(_),b}))).map((g,_)=>({result:g,runManager:u==null?void 0:u[_]})).filter(({result:g})=>g.status==="fulfilled"&&g.value!=null||g.status==="rejected"),p=[];await Promise.all(f.map(async({result:g,runManager:_},y)=>{if(g.status==="fulfilled"){const b=g.value;return p[y]=b.map(w=>("message"in w&&Ad(w.message)&&Mr(w.message)&&(w.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0}),w.generationInfo={...w.generationInfo,tokenUsage:{}},w)),b.length&&await(_==null?void 0:_.handleLLMNewToken(b[0].text)),_==null?void 0:_.handleLLMEnd({generations:[b]},void 0,void 0,void 0,{cached:!0})}else return await(_==null?void 0:_.handleLLMError(g.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(g.reason)}));const m={generations:p,missingPromptIndices:d,startedRunManagers:u};return Object.defineProperty(m,Iv,{value:u?{runIds:u==null?void 0:u.map(g=>g.runId)}:void 0,configurable:!0}),m}async generate(e,t,n){let s;Array.isArray(t)?s={stop:t}:s=t;const i=e.map(p=>p.map(eo)),[a,o]=this._separateRunnableConfigFromCallOptionsCompat(s);if(a.callbacks=a.callbacks??n,!this.cache)return this._generateUncached(i,o,a);const{cache:l}=this,c=this._getSerializedCacheKeyParametersForCall(o),{generations:u,missingPromptIndices:d,startedRunManagers:h}=await this._generateCached({messages:i,cache:l,llmStringKey:c,parsedOptions:o,handledOptions:a});let f={};if(d.length>0){const p=await this._generateUncached(d.map(m=>i[m]),o,a,h!==void 0?d.map(m=>h==null?void 0:h[m]):void 0);await Promise.all(p.generations.map(async(m,g)=>{const _=d[g];u[_]=m;const y=Xn._convertInputToPromptValue(i[_]).toString();return l.update(y,c,m)})),f=p.llmOutput??{}}return{generations:u,llmOutput:f}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,n){const s=e.map(i=>i.toChatMessages());return this.generate(s,t,n)}async call(e,t,n){return(await this.generate([e.map(eo)],t,n)).generations[0][0].message}async callPrompt(e,t,n){const s=e.toChatMessages();return this.call(s,t,n)}async predictMessages(e,t,n){return this.call(e,t,n)}async predict(e,t,n){const s=new Ui(e),i=await this.call([s],t,n);if(typeof i.content!="string")throw new Error("Cannot use predict when output is not a string.");return i.content}withStructuredOutput(e,t){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(t!=null&&t.strict)throw new Error('"strict" mode is not supported for this model by default.');const n=e,s=t==null?void 0:t.name,i=n.description??"A function available to call.",a=t==null?void 0:t.method,o=t==null?void 0:t.includeRaw;if(a==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let l=s??"extract",c;el(n)?c=[{type:"function",function:{name:l,description:i,parameters:fs(n)}}]:("name"in n&&(l=n.name),c=[{type:"function",function:{name:l,description:i,parameters:n}}]);const u=this.bindTools(c),d=ni.from(m=>{if(!m.tool_calls||m.tool_calls.length===0)throw new Error("No tool calls found in the response.");const g=m.tool_calls.find(_=>_.name===l);if(!g)throw new Error(`No tool call found with name ${l}.`);return g.args});if(!o)return u.pipe(d).withConfig({runName:"StructuredOutput"});const h=ps.assign({parsed:(m,g)=>d.invoke(m.raw,g)}),f=ps.assign({parsed:()=>null}),p=h.withFallbacks({fallbacks:[f]});return $n.from([{raw:u},p]).withConfig({runName:"StructuredOutputRunnable"})}}class OP extends ct{parseResultWithPrompt(e,t,n){return this.parseResult(e,n)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(n,s)=>this.parseResult([{text:n}],s==null?void 0:s.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(n,s)=>this.parseResult([{message:n,text:this._baseMessageToString(n)}],s==null?void 0:s.callbacks),e,{...t,runType:"parser"})}}class TP extends OP{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,n){return this.parse(e,n)}_type(){throw new Error("_type not implemented")}}class tl extends Error{constructor(e,t,n,s=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=n,this.sendToLLM=s,s&&(n===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");HS(this,"OUTPUT_PARSING_FAILURE")}}function _m(r,e){const t=typeof r;if(t!==typeof e)return!1;if(Array.isArray(r)){if(!Array.isArray(e))return!1;const n=r.length;if(n!==e.length)return!1;for(let s=0;s<n;s++)if(!_m(r[s],e[s]))return!1;return!0}if(t==="object"){if(!r||!e)return r===e;const n=Object.keys(r),s=Object.keys(e);if(n.length!==s.length)return!1;for(const a of n)if(!_m(r[a],e[a]))return!1;return!0}return r===e}class iF extends TP{async*_transform(e){for await(const t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}class RP extends iF{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=(e==null?void 0:e.diff)??this.diff}async*_transform(e){let t,n;for await(const s of e){if(typeof s!="string"&&typeof s.content!="string")throw new Error("Cannot handle non-string output.");let i;if(dN(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new zn({message:s,text:s.content})}else if(Ad(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new zn({message:_N(s),text:s.content})}else i=new Zi({text:s});n===void 0?n=i:n=n.concat(i);const a=await this.parsePartialResult([n]);a!=null&&!_m(a,t)&&(this.diff?yield this._diff(t,a):yield a,t=a)}}getFormatInstructions(){return""}}class Du extends TP{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const t=rs.object(Object.fromEntries(Object.entries(e).map(([n,s])=>[n,rs.string().describe(s)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(fs(this.schema))}
\`\`\`
`}async parse(e){try{const n=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(s,i)=>`"${i.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await this.schema.parseAsync(JSON.parse(n))}catch(t){throw new tl(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}}class Fu extends RP{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,t){if(t)return e?Qj(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return nw(e[0].text)}async parse(e){return nw(e,JSON.parse)}getFormatInstructions(){return""}}function Tl(r,e){if(r.function===void 0)return;let t;if(e!=null&&e.partial)try{t=Ng(r.function.arguments??"{}")}catch{return}else try{t=JSON.parse(r.function.arguments)}catch(s){throw new tl([`Function "${r.function.name}" arguments:`,"",r.function.arguments,"","are not valid JSON.",`Error: ${s.message}`].join(`
`))}const n={name:r.function.name,args:t,type:"tool_call"};return e!=null&&e.returnId&&(n.id=r.id),n}function CP(r){if(r.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:r.id,type:"function",function:{name:r.name,arguments:JSON.stringify(r.args)}}}function jd(r,e){var t,n;return{name:(t=r.function)==null?void 0:t.name,args:(n=r.function)==null?void 0:n.arguments,id:r.id,error:e,type:"invalid_tool_call"}}class aF extends RP{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=(e==null?void 0:e.returnId)??this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){var a;const n=e[0].message;let s;if(Mr(n)&&((a=n.tool_calls)!=null&&a.length)?s=n.tool_calls.map(o=>{const{id:l,...c}=o;return this.returnId?{id:l,...c}:c}):n.additional_kwargs.tool_calls!==void 0&&(s=JSON.parse(JSON.stringify(n.additional_kwargs.tool_calls)).map(l=>Tl(l,{returnId:this.returnId,partial:t}))),!s)return[];const i=[];for(const o of s)if(o!==void 0){const l={type:o.name,args:o.args,id:o.id};i.push(l)}return i}}class Bu extends aF{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;const t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new tl(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){const n=(await super.parsePartialResult(e)).filter(i=>i.type===this.keyName);let s=n;if(n.length)return this.returnId||(s=n.map(i=>i.args)),this.returnSingle?s[0]:s}async parseResult(e){const n=(await super.parsePartialResult(e,!1)).filter(a=>a.type===this.keyName);let s=n;return n.length?(this.returnId||(s=n.map(a=>a.args)),this.returnSingle?this._validateResult(s[0]):await Promise.all(s.map(a=>this._validateResult(a)))):void 0}}const oF=Symbol("Let zodToJsonSchema decide on which parser to use"),Uv={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},lF=r=>typeof r=="string"?{...Uv,basePath:["#"],definitions:{},name:r}:{...Uv,basePath:["#"],definitions:{},...r},bm=r=>"_def"in r?r._def:r;function cF(r){if(!r)return!0;for(const e in r)return!1;return!0}const uF=r=>{const e=lF(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[bm(s),{def:bm(s),path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function IP(r,e,t,n){n!=null&&n.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function Ie(r,e,t,n,s){r[e]=t,IP(r,e,n,s)}function dF(){return{}}function hF(r,e){var n,s;const t={type:"array"};return((s=(n=r.type)==null?void 0:n._def)==null?void 0:s.typeName)!==T.ZodAny&&(t.items=Se(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&Ie(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&Ie(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(Ie(t,"minItems",r.exactLength.value,r.exactLength.message,e),Ie(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function fF(r,e){const t={type:"integer",format:"int64"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?Ie(t,"minimum",n.value,n.message,e):Ie(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Ie(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Ie(t,"maximum",n.value,n.message,e):Ie(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Ie(t,"maximum",n.value,n.message,e));break;case"multipleOf":Ie(t,"multipleOf",n.value,n.message,e);break}return t}function pF(){return{type:"boolean"}}function mF(r,e){return Se(r.type._def,e)}const gF=(r,e)=>Se(r.innerType._def,e);function $P(r,e,t){const n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((s,i)=>$P(r,e,s))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return _F(r,e)}}const _F=(r,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const n of r.checks)switch(n.kind){case"min":Ie(t,"minimum",n.value,n.message,e);break;case"max":Ie(t,"maximum",n.value,n.message,e);break}return t};function bF(r,e){return{...Se(r.innerType._def,e),default:r.defaultValue()}}function yF(r,e,t){return e.effectStrategy==="input"?Se(r.schema._def,e,t):{}}function wF(r){return{type:"string",enum:[...r.values]}}const vF=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function xF(r,e){const t=[Se(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Se(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(i=>{if(vF(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(n=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...l}=i;a=l}else n=void 0;s.push(a)}}),s.length?{allOf:s,...n}:void 0}function kF(r,e){const t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}let Kf;const As={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Kf===void 0&&(Kf=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Kf),base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function MP(r,e){const t={type:"string"};function n(s){return e.patternStrategy==="escape"?SF(s):s}if(r.checks)for(const s of r.checks)switch(s.kind){case"min":Ie(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e);break;case"max":Ie(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Pn(t,"email",s.message,e);break;case"format:idn-email":Pn(t,"idn-email",s.message,e);break;case"pattern:zod":En(t,As.email,s.message,e);break}break;case"url":Pn(t,"uri",s.message,e);break;case"uuid":Pn(t,"uuid",s.message,e);break;case"regex":En(t,s.regex,s.message,e);break;case"cuid":En(t,As.cuid,s.message,e);break;case"cuid2":En(t,As.cuid2,s.message,e);break;case"startsWith":En(t,RegExp(`^${n(s.value)}`),s.message,e);break;case"endsWith":En(t,RegExp(`${n(s.value)}$`),s.message,e);break;case"datetime":Pn(t,"date-time",s.message,e);break;case"date":Pn(t,"date",s.message,e);break;case"time":Pn(t,"time",s.message,e);break;case"duration":Pn(t,"duration",s.message,e);break;case"length":Ie(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e),Ie(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"includes":{En(t,RegExp(n(s.value)),s.message,e);break}case"ip":{s.version!=="v6"&&Pn(t,"ipv4",s.message,e),s.version!=="v4"&&Pn(t,"ipv6",s.message,e);break}case"emoji":En(t,As.emoji,s.message,e);break;case"ulid":{En(t,As.ulid,s.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Pn(t,"binary",s.message,e);break}case"contentEncoding:base64":{Ie(t,"contentEncoding","base64",s.message,e);break}case"pattern:zod":{En(t,As.base64,s.message,e);break}}break}case"nanoid":En(t,As.nanoid,s.message,e)}return t}const SF=r=>Array.from(r).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),Pn=(r,e,t,n)=>{var s;r.format||(s=r.anyOf)!=null&&s.some(i=>i.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):Ie(r,"format",e,t,n)},En=(r,e,t,n)=>{var s;r.pattern||(s=r.allOf)!=null&&s.some(i=>i.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:qv(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):Ie(r,"pattern",qv(e,n),t,n)},qv=(r,e)=>{var c;const t=typeof r=="function"?r():r;if(!e.applyRegexFlags||!t.flags)return t.source;const n={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},s=n.i?t.source.toLowerCase():t.source;let i="",a=!1,o=!1,l=!1;for(let u=0;u<s.length;u++){if(a){i+=s[u],a=!1;continue}if(n.i){if(o){if(s[u].match(/[a-z]/)){l?(i+=s[u],i+=`${s[u-2]}-${s[u]}`.toUpperCase(),l=!1):s[u+1]==="-"&&((c=s[u+2])!=null&&c.match(/[a-z]/))?(i+=s[u],l=!0):i+=`${s[u]}${s[u].toUpperCase()}`;continue}}else if(s[u].match(/[a-z]/)){i+=`[${s[u]}${s[u].toUpperCase()}]`;continue}}if(n.m){if(s[u]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(s[u]==="$"){i+=`($|(?=[\r
]))`;continue}}if(n.s&&s[u]==="."){i+=o?`${s[u]}\r
`:`[${s[u]}\r
]`;continue}i+=s[u],s[u]==="\\"?a=!0:o&&s[u]==="]"?o=!1:!o&&s[u]==="["&&(o=!0)}try{const u=new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return i};function NP(r,e){var n,s,i,a;if(e.target==="openApi3"&&((n=r.keyType)==null?void 0:n._def.typeName)===T.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((o,l)=>({...o,[l]:Se(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",l]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:Se(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((s=r.keyType)==null?void 0:s._def.typeName)===T.ZodString&&((i=r.keyType._def.checks)!=null&&i.length)){const o=Object.entries(MP(r.keyType._def,e)).reduce((l,[c,u])=>c==="type"?l:{...l,[c]:u},{});return{...t,propertyNames:o}}else if(((a=r.keyType)==null?void 0:a._def.typeName)===T.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};return t}function PF(r,e){if(e.mapStrategy==="record")return NP(r,e);const t=Se(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=Se(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function EF(r){const e=r.values,n=Object.keys(r.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(n.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function AF(){return{not:{}}}function OF(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const zu={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function TF(r,e){if(e.target==="openApi3")return Wv(r,e);const t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in zu&&(!n._def.checks||!n._def.checks.length))){const n=t.reduce((s,i)=>{const a=zu[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=t.reduce((s,i)=>{const a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===t.length){const s=n.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,s)=>[...n,...s._def.values.filter(i=>!n.includes(i))],[])};return Wv(r,e)}const Wv=(r,e)=>{const t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,s)=>Se(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function RF(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:zu[r.innerType._def.typeName],nullable:!0}:{type:[zu[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=Se(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const t=Se(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function CF(r,e){const t={type:"number"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"int":t.type="integer",IP(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?Ie(t,"minimum",n.value,n.message,e):Ie(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Ie(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Ie(t,"maximum",n.value,n.message,e):Ie(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Ie(t,"maximum",n.value,n.message,e));break;case"multipleOf":Ie(t,"multipleOf",n.value,n.message,e);break}return t}function IF(r,e){return e.removeAdditionalStrategy==="strict"?r.catchall._def.typeName==="ZodNever"?r.unknownKeys!=="strict":Se(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":Se(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function $F(r,e){const t={type:"object",...Object.entries(r.shape()).reduce((n,[s,i])=>{if(i===void 0||i._def===void 0)return n;const a=Se(i._def,{...e,currentPath:[...e.currentPath,"properties",s],propertyPath:[...e.currentPath,"properties",s]});return a===void 0?n:{properties:{...n.properties,[s]:a},required:i.isOptional()&&!e.openaiStrictMode?n.required:[...n.required,s]}},{properties:{},required:[]}),additionalProperties:IF(r,e)};return t.required.length||delete t.required,t}const MF=(r,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return Se(r.innerType._def,e);const t=Se(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},NF=(r,e)=>{if(e.pipeStrategy==="input")return Se(r.in._def,e);if(e.pipeStrategy==="output")return Se(r.out._def,e);const t=Se(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=Se(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(s=>s!==void 0)}};function LF(r,e){return Se(r.type._def,e)}function jF(r,e){const n={type:"array",uniqueItems:!0,items:Se(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&Ie(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&Ie(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function DF(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>Se(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:Se(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>Se(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function FF(){return{not:{}}}function BF(){return{}}const zF=(r,e)=>Se(r.innerType._def,e);function Se(r,e,t=!1){var a;const n=e.seen.get(r);if(e.override){const o=(a=e.override)==null?void 0:a.call(e,r,e,n,t);if(o!==oF)return o}if(n&&!t){const o=UF(n,e);if(o!==void 0)return"$ref"in o&&e.seenRefs.add(o.$ref),o}const s={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,s);const i=WF(r,r.typeName,e,t);return i&&HF(r,e,i),s.jsonSchema=i,i}const UF=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"extract-to-root":const t=r.path.slice(e.basePath.length+1).join("_");return t!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[t]=r.def),{$ref:[...e.basePath,e.definitionPath,t].join("/")};case"relative":return{$ref:qF(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((n,s)=>e.currentPath[s]===n)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},qF=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},WF=(r,e,t,n)=>{switch(e){case T.ZodString:return MP(r,t);case T.ZodNumber:return CF(r,t);case T.ZodObject:return $F(r,t);case T.ZodBigInt:return fF(r,t);case T.ZodBoolean:return pF();case T.ZodDate:return $P(r,t);case T.ZodUndefined:return FF();case T.ZodNull:return OF(t);case T.ZodArray:return hF(r,t);case T.ZodUnion:case T.ZodDiscriminatedUnion:return TF(r,t);case T.ZodIntersection:return xF(r,t);case T.ZodTuple:return DF(r,t);case T.ZodRecord:return NP(r,t);case T.ZodLiteral:return kF(r,t);case T.ZodEnum:return wF(r);case T.ZodNativeEnum:return EF(r);case T.ZodNullable:return RF(r,t);case T.ZodOptional:return MF(r,t);case T.ZodMap:return PF(r,t);case T.ZodSet:return jF(r,t);case T.ZodLazy:return Se(r.getter()._def,t);case T.ZodPromise:return LF(r,t);case T.ZodNaN:case T.ZodNever:return AF();case T.ZodEffects:return yF(r,t,n);case T.ZodAny:return dF();case T.ZodUnknown:return BF();case T.ZodDefault:return bF(r,t);case T.ZodBranded:return mF(r,t);case T.ZodReadonly:return zF(r,t);case T.ZodCatch:return gF(r,t);case T.ZodPipeline:return NF(r,t);case T.ZodFunction:case T.ZodVoid:case T.ZodSymbol:return;default:return(s=>{})()}},HF=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t),VF=(r,e)=>{const t=uF(e),n=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,s=Se(r._def,n===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,n]},!1)??{},i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(s.title=i);const a=(()=>{if(cF(t.definitions))return;const l={},c=new Set;for(let u=0;u<500;u++){const d=Object.entries(t.definitions).filter(([h])=>!c.has(h));if(d.length===0)break;for(const[h,f]of d)l[h]=Se(bm(f),{...t,currentPath:[...t.basePath,t.definitionPath,h]},!0)??{},c.add(h)}return l})(),o=n===void 0?a?{...s,[t.definitionPath]:a}:s:t.nameStrategy==="duplicate-ref"?{...s,...a||t.seenRefs.size?{[t.definitionPath]:{...a,...t.seenRefs.size?{[n]:s}:void 0}}:void 0}:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,n].join("/"),[t.definitionPath]:{...a,[n]:s}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function LP(r,e){return VF(r,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function jP(r,e,t){return IM({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:LP(r,{name:e})}},n=>r.parse(JSON.parse(n)))}function ZF(r){return $M({type:"function",function:{name:r.name,parameters:LP(r.parameters,{name:r.name}),strict:!0,...r.description?{description:r.description}:void 0}},{callback:r.function,parser:e=>r.parameters.parse(JSON.parse(e))})}function GF(r){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:n,azureOpenAIBasePath:s,baseURL:i,azureADTokenProvider:a,azureOpenAIEndpoint:o}=r;if((n||a)&&s&&e)return`${s}/${e}`;if((n||a)&&o&&e)return`${o}/openai/deployments/${e}`;if(n||a){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return i}function JF(r){return r!==void 0&&Array.isArray(r.lc_namespace)}function KF(r){return r!==void 0&&ct.isRunnable(r)&&"lc_name"in r.constructor&&typeof r.constructor.lc_name=="function"&&r.constructor.lc_name()==="RunnableToolLike"}function XF(r){return!!r&&typeof r=="object"&&"name"in r&&"schema"in r&&el(r.schema)}function Dd(r){return XF(r)||KF(r)||JF(r)}function YF(r){return el(r)?fs(r):r}function DP(r,e){const t=typeof e=="number"?void 0:e;return{name:r.name,description:r.description,parameters:YF(r.schema),...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}}function QF(r,e){let t;return Dd(r)?t={type:"function",function:DP(r)}:t=r,t}function gc(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function Xf(r){let e;return r.constructor.name===pl.name?(e=new Error(r.message),e.name="TimeoutError"):r.constructor.name===qt.name?(e=new Error(r.message),e.name="AbortError"):r.status===400&&r.message.includes("tool_calls")?e=gc(r,"INVALID_TOOL_RESULTS"):r.status===401?e=gc(r,"MODEL_AUTHENTICATION"):r.status===429?e=gc(r,"MODEL_RATE_LIMIT"):r.status===404?e=gc(r,"MODEL_NOT_FOUND"):e=r,e}function Hv(r){if(r)return r==="any"||r==="required"?"required":r==="auto"?"auto":r==="none"?"none":typeof r=="string"?{type:"function",function:{name:r}}:r}function eB(r){return r.anyOf!==void 0&&Array.isArray(r.anyOf)}function tB(r){const e=["namespace functions {",""];for(const t of r)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(FP(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function FP(r,e){var n;const t=[];for(const[s,i]of Object.entries(r.properties??{}))i.description&&e<2&&t.push(`// ${i.description}`),(n=r.required)!=null&&n.includes(s)?t.push(`${s}: ${Uu(i,e)},`):t.push(`${s}?: ${Uu(i,e)},`);return t.map(s=>" ".repeat(e)+s).join(`
`)}function Uu(r,e){if(eB(r))return r.anyOf.map(t=>Uu(t,e)).join(" | ");switch(r.type){case"string":return r.enum?r.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",FP(r,e+2),"}"].join(`
`);case"array":return r.items?`${Uu(r.items,e)}[]`:"any[]";default:return""}}function nB(r,e){let t;return Dd(r)?t=QF(r):t=r,(e==null?void 0:e.strict)!==void 0&&(t.function.strict=e.strict),t}function rB(r){return r.role!=="system"&&r.role!=="developer"&&r.role!=="assistant"&&r.role!=="user"&&r.role!=="function"&&r.role!=="tool"&&console.warn(`Unknown message role: ${r.role}`),r.role}function Jg(r){const e=r._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!ti.isInstance(r))throw new Error("Invalid generic chat message");return rB(r)}default:throw new Error(`Unknown message type: ${e}`)}}function Vv(r,e){return r.flatMap(t=>{var i;let n=Jg(t);n==="system"&&Kg(e)&&(n="developer");const s={role:n,content:t.content};if(t.name!=null&&(s.name=t.name),t.additional_kwargs.function_call!=null&&(s.function_call=t.additional_kwargs.function_call,s.content=""),Mr(t)&&((i=t.tool_calls)!=null&&i.length)?(s.tool_calls=t.tool_calls.map(CP),s.content=""):(t.additional_kwargs.tool_calls!=null&&(s.tool_calls=t.additional_kwargs.tool_calls),t.tool_call_id!=null&&(s.tool_call_id=t.tool_call_id)),t.additional_kwargs.audio&&typeof t.additional_kwargs.audio=="object"&&"id"in t.additional_kwargs.audio){const a={role:"assistant",audio:{id:t.additional_kwargs.audio.id}};return[s,a]}return s})}const Pi="__openai_function_call_ids__";function Zv(r,e){return r.flatMap(t=>{var i,a,o;let n=Jg(t);if(n==="system"&&Kg(e)&&(n="developer"),n==="function")throw new Error("Function messages are not supported in Responses API");if(n==="tool"){const l=t;return((i=l.additional_kwargs)==null?void 0:i.type)==="computer_call_output"?{type:"computer_call_output",output:(()=>{if(typeof l.content=="string")return{type:"computer_screenshot",image_url:l.content};if(Array.isArray(l.content)){const u=l.content.find(h=>h.type==="computer_screenshot");if(u)return u;const d=l.content.find(h=>h.type==="image_url");if(d)return{type:"computer_screenshot",image_url:typeof d.image_url=="string"?d.image_url:d.image_url.url}}throw new Error("Invalid computer call output")})(),call_id:l.tool_call_id}:{type:"function_call_output",call_id:l.tool_call_id,id:l.id,output:typeof l.content!="string"?JSON.stringify(l.content):l.content}}if(n==="assistant"){const l=[];t.additional_kwargs.reasoning!=null&&(f=>typeof f=="object"&&f!=null&&"type"in f&&f.type==="reasoning")(t.additional_kwargs.reasoning)&&l.push(t.additional_kwargs.reasoning);let{content:c}=t;t.additional_kwargs.refusal!=null&&(typeof c=="string"&&(c=[{type:"output_text",text:c,annotations:[]}]),c=[...c,{type:"refusal",refusal:t.additional_kwargs.refusal}]),l.push({type:"message",role:"assistant",content:typeof c=="string"?c:c.flatMap(h=>h.type==="text"?{type:"output_text",text:h.text,annotations:h.annotations??[]}:h.type==="output_text"||h.type==="refusal"?h:[])});const u=t.additional_kwargs[Pi];Mr(t)&&((a=t.tool_calls)!=null&&a.length)?l.push(...t.tool_calls.map(h=>({type:"function_call",name:h.name,arguments:JSON.stringify(h.args),call_id:h.id,id:u==null?void 0:u[h.id]}))):t.additional_kwargs.tool_calls!=null&&l.push(...t.additional_kwargs.tool_calls.map(h=>({type:"function_call",name:h.function.name,call_id:h.id,id:u==null?void 0:u[h.id],arguments:h.function.arguments})));const d=(o=t.response_metadata.output)!=null&&o.length?t.response_metadata.output:t.additional_kwargs.tool_outputs;if(d!=null){const h=d,f=h==null?void 0:h.filter(m=>m.type==="reasoning"),p=h==null?void 0:h.filter(m=>m.type==="computer_call");f.length>0&&p.length>0&&l.push(...f),p.length>0&&l.push(...p)}return l}const s=typeof t.content=="string"?t.content:t.content.flatMap(l=>{if(l.type==="text")return{type:"input_text",text:l.text};if(l.type==="image_url"){const c=typeof l.image_url=="string"?l.image_url:l.image_url.url,u=typeof l.image_url=="string"?"auto":l.image_url.detail;return{type:"input_image",image_url:c,detail:u}}return l.type==="input_text"||l.type==="input_image"||l.type==="input_file"?l:[]});return n==="user"||n==="system"||n==="developer"?{type:"message",role:n,content:s}:(console.warn(`Unsupported role found when converting to OpenAI Responses API: ${n}`),[])})}function BP(r){if(r.error){const a=new Error(r.error.message);throw a.name=r.error.code,a}const e=[],t=[],n=[],s={model:r.model,created_at:r.created_at,id:r.id,incomplete_details:r.incomplete_details,metadata:r.metadata,object:r.object,status:r.status,user:r.user,model_name:r.model},i={};for(const a of r.output)if(a.type==="message")e.push(...a.content.flatMap(o=>o.type==="output_text"?("parsed"in o&&o.parsed!=null&&(i.parsed=o.parsed),{type:"text",text:o.text,annotations:o.annotations}):o.type==="refusal"?(i.refusal=o.refusal,[]):o));else if(a.type==="function_call"){const o={function:{name:a.name,arguments:a.arguments},id:a.call_id};try{t.push(Tl(o,{returnId:!0}))}catch(l){let c;typeof l=="object"&&l!=null&&"message"in l&&typeof l.message=="string"&&(c=l.message),n.push(jd(o,c))}i[Pi]??(i[Pi]={}),i[Pi][a.call_id]=a.id}else a.type==="reasoning"?i.reasoning=a:(i.tool_outputs??(i.tool_outputs=[]),i.tool_outputs.push(a));return new or({id:r.id,content:e,tool_calls:t,invalid_tool_calls:n,usage_metadata:r.usage,additional_kwargs:i,response_metadata:s})}function sB(r){var l,c;const e=[];let t={},n;const s=[],i={},a={};let o;if(r.type==="response.output_text.delta")e.push({type:"text",text:r.delta,index:r.content_index});else if(r.type==="response.output_text.annotation.added")e.push({type:"text",text:"",annotations:[r.annotation],index:r.content_index});else if(r.type==="response.output_item.added"&&r.item.type==="message")o=r.item.id;else if(r.type==="response.output_item.added"&&r.item.type==="function_call")s.push({type:"tool_call_chunk",name:r.item.name,args:r.item.arguments,id:r.item.id,index:r.output_index}),a[Pi]={[r.item.call_id]:r.item.id};else if(r.type==="response.output_item.done"&&(r.item.type==="web_search_call"||r.item.type==="file_search_call"||r.item.type==="computer_call"))a.tool_outputs=[r.item];else if(r.type==="response.created")i.id=r.response.id,i.model_name=r.response.model,i.model=r.response.model;else if(r.type==="response.completed"){const u=BP(r.response);n=r.response.usage,((c=(l=r.response.text)==null?void 0:l.format)==null?void 0:c.type)==="json_schema"&&(a.parsed??(a.parsed=JSON.parse(u.text)));for(const[d,h]of Object.entries(r.response))d!=="id"&&(i[d]=h)}else if(r.type==="response.function_call_arguments.delta")s.push({type:"tool_call_chunk",args:r.delta,index:r.output_index});else if(r.type==="response.web_search_call.completed"||r.type==="response.file_search_call.completed")t={tool_outputs:{id:r.item_id,type:r.type.replace("response.","").replace(".completed",""),status:"completed"}};else if(r.type==="response.refusal.done")a.refusal=r.refusal;else return null;return new zn({text:e.map(u=>u.text).join(""),message:new Ze({id:o,content:e,tool_call_chunks:s,usage_metadata:n,additional_kwargs:a,response_metadata:i}),generationInfo:t})}function Yf(r){return"type"in r&&r.type!=="function"}function iB(r){return r!=null&&typeof r=="object"&&"type"in r&&r.type!=="function"}function Gv(r,e){return Ol(r)?(e==null?void 0:e.strict)!==void 0?{...r,function:{...r.function,strict:e.strict}}:r:nB(r,e)}function Kg(r){return(r==null?void 0:r.startsWith("o1"))||(r==null?void 0:r.startsWith("o3"))}let aB=class extends Xn{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","reasoningEffort","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","modelName","model","modelKwargs","stop","stopSequences","timeout","openAIApiKey","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming"]}constructor(e){var t,n;super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useResponsesApi",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.openAIApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.openAIApiKey)??((t=e==null?void 0:e.configuration)==null?void 0:t.apiKey)??Ht("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.organization=((n=e==null?void 0:e.configuration)==null?void 0:n.organization)??Ht("OPENAI_ORGANIZATION"),this.model=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.modelName=this.model,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this.stop,this.user=e==null?void 0:e.user,this.__includeRawResponse=e==null?void 0:e.__includeRawResponse,this.audio=e==null?void 0:e.audio,this.modalities=e==null?void 0:e.modalities,this.reasoningEffort=e==null?void 0:e.reasoningEffort,this.maxTokens=(e==null?void 0:e.maxCompletionTokens)??(e==null?void 0:e.maxTokens),this.useResponsesApi=(e==null?void 0:e.useResponsesApi)??this.useResponsesApi,this.disableStreaming=(e==null?void 0:e.disableStreaming)??this.disableStreaming,this.model==="o1"&&(this.disableStreaming=!0),this.streaming=(e==null?void 0:e.streaming)??!1,this.disableStreaming&&(this.streaming=!1),this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.disableStreaming&&(this.streamUsage=!1),this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e==null?void 0:e.configuration},(e==null?void 0:e.supportsStrictToolCalling)!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling)}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){let n;return(t==null?void 0:t.strict)!==void 0?n=t.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this.bind({tools:e.map(s=>Yf(s)?s:Gv(s,{strict:n})),...t})}createResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&_c(e.json_schema.schema)?jP(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}invocationParams(e,t){var o,l;let n;if((e==null?void 0:e.strict)!==void 0?n=e.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this._useResponseApi(e)){const c={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:e==null?void 0:e.previous_response_id,truncation:e==null?void 0:e.truncation,include:e==null?void 0:e.include,tools:(o=e==null?void 0:e.tools)!=null&&o.length?e.tools.map(d=>Yf(d)?d:Ol(d)?{type:"function",name:d.function.name,parameters:d.function.parameters,description:d.function.description,strict:n}:null).filter(d=>d!==null):void 0,tool_choice:iB(e==null?void 0:e.tool_choice)?e==null?void 0:e.tool_choice:(()=>{const d=Hv(e==null?void 0:e.tool_choice);if(typeof d=="object"&&"type"in d)return{type:"function",name:d.function.name}})(),text:(()=>{if(e!=null&&e.text)return e.text;const d=this.createResponseFormat(e==null?void 0:e.response_format);return(d==null?void 0:d.type)==="json_schema"?d.json_schema.schema!=null?{format:{type:"json_schema",schema:d.json_schema.schema,description:d.json_schema.description,name:d.json_schema.name,strict:d.json_schema.strict}}:void 0:{format:d}})(),parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,max_output_tokens:this.maxTokens===-1?void 0:this.maxTokens,...this.modelKwargs},u=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return u!==void 0&&(c.reasoning={effort:u}),c}let s={};(e==null?void 0:e.stream_options)!==void 0?s={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t!=null&&t.streaming)&&(s={stream_options:{include_usage:!0}});const i={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:(l=e==null?void 0:e.tools)!=null&&l.length?e.tools.map(c=>Gv(c,{strict:n})):void 0,tool_choice:Hv(e==null?void 0:e.tool_choice),response_format:this.createResponseFormat(e==null?void 0:e.response_format),seed:e==null?void 0:e.seed,...s,parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,...this.audio||e!=null&&e.audio?{audio:this.audio||(e==null?void 0:e.audio)}:{},...this.modalities||e!=null&&e.modalities?{modalities:this.modalities||(e==null?void 0:e.modalities)}:{},...this.modelKwargs};(e==null?void 0:e.prediction)!==void 0&&(i.prediction=e.prediction);const a=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return a!==void 0&&(i.reasoning_effort=a),Kg(i.model)?i.max_completion_tokens=this.maxTokens===-1?void 0:this.maxTokens:i.max_tokens=this.maxTokens===-1?void 0:this.maxTokens,i}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){const n=e.tool_calls;switch(e.role){case"assistant":{const s=[],i=[];for(const l of n??[])try{s.push(Tl(l,{returnId:!0}))}catch(c){i.push(jd(l,c.message))}const a={function_call:e.function_call,tool_calls:n};this.__includeRawResponse!==void 0&&(a.__raw_response=t);const o={model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};return e.audio&&(a.audio=e.audio),new or({content:e.content||"",tool_calls:s,invalid_tool_calls:i,additional_kwargs:a,response_metadata:o,id:t.id})}default:return new ti(e.content||"",e.role??"unknown")}}_convertOpenAIDeltaToBaseMessageChunk(e,t,n){var l,c;const s=e.role??n,i=e.content??"";let a;e.function_call?a={function_call:e.function_call}:e.tool_calls?a={tool_calls:e.tool_calls}:a={},this.__includeRawResponse&&(a.__raw_response=t),e.audio&&(a.audio={...e.audio,index:t.choices[0].index});const o={usage:{...t.usage}};if(s==="user")return new kl({content:i,response_metadata:o});if(s==="assistant"){const u=[];if(Array.isArray(e.tool_calls))for(const d of e.tool_calls)u.push({name:(l=d.function)==null?void 0:l.name,args:(c=d.function)==null?void 0:c.arguments,id:d.id,index:d.index,type:"tool_call_chunk"});return new Ze({content:i,tool_call_chunks:u,additional_kwargs:a,id:t.id,response_metadata:o})}else return s==="system"?new Gs({content:i,response_metadata:o}):s==="developer"?new Gs({content:i,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}}):s==="function"?new xl({content:i,additional_kwargs:a,name:e.name,response_metadata:o}):s==="tool"?new Od({content:i,additional_kwargs:a,tool_call_id:e.tool_call_id,response_metadata:o}):new vl({content:i,role:s,response_metadata:o})}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,n){var c,u,d,h,f,p,m,g,_,y;if(this._useResponseApi(t)){const b=await this.responseApiWithRetry({...this.invocationParams(t,{streaming:!0}),input:Zv(e,this.model),stream:!0},t);for await(const w of b){const v=sB(w);v!=null&&(yield v)}return}const s=Vv(e,this.model),i={...this.invocationParams(t,{streaming:!0}),messages:s,stream:!0};let a;const o=await this.completionWithRetry(i,t);let l;for await(const b of o){const w=(c=b==null?void 0:b.choices)==null?void 0:c[0];if(b.usage&&(l=b.usage),!w)continue;const{delta:v}=w;if(!v)continue;const S=this._convertOpenAIDeltaToBaseMessageChunk(v,b,a);a=v.role??a;const k={prompt:t.promptIndex??0,completion:w.index??0};if(typeof S.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const x={...k};w.finish_reason!=null&&(x.finish_reason=w.finish_reason,x.system_fingerprint=b.system_fingerprint,x.model_name=b.model),this.logprobs&&(x.logprobs=w.logprobs);const A=new zn({message:S,text:S.content,generationInfo:x});yield A,await(n==null?void 0:n.handleLLMNewToken(A.text??"",k,void 0,void 0,void 0,{chunk:A}))}if(l){const b={...((u=l.prompt_tokens_details)==null?void 0:u.audio_tokens)!==null&&{audio:(d=l.prompt_tokens_details)==null?void 0:d.audio_tokens},...((h=l.prompt_tokens_details)==null?void 0:h.cached_tokens)!==null&&{cache_read:(f=l.prompt_tokens_details)==null?void 0:f.cached_tokens}},w={...((p=l.completion_tokens_details)==null?void 0:p.audio_tokens)!==null&&{audio:(m=l.completion_tokens_details)==null?void 0:m.audio_tokens},...((g=l.completion_tokens_details)==null?void 0:g.reasoning_tokens)!==null&&{reasoning:(_=l.completion_tokens_details)==null?void 0:_.reasoning_tokens}};yield new zn({message:new Ze({content:"",response_metadata:{usage:{...l}},usage_metadata:{input_tokens:l.prompt_tokens,output_tokens:l.completion_tokens,total_tokens:l.total_tokens,...Object.keys(b).length>0&&{input_token_details:b},...Object.keys(w).length>0&&{output_token_details:w}}}),text:""})}if((y=t.signal)!=null&&y.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _responseApiGenerate(e,t,n){var o;const s=this.invocationParams(t);if(s.stream){const l=this._streamResponseChunks(e,t,n);let c;for await(const u of l)u.message.response_metadata={...u.generationInfo,...u.message.response_metadata},c=(c==null?void 0:c.concat(u))??u;return{generations:c?[c]:[],llmOutput:{estimatedTokenUsage:(o=c==null?void 0:c.message)==null?void 0:o.usage_metadata}}}const i=Zv(e,this.model),a=await this.responseApiWithRetry({input:i,...s},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});return{generations:[{text:a.output_text,message:BP(a)}],llmOutput:{id:a.id,estimatedTokenUsage:a.usage?{promptTokens:a.usage.input_tokens,completionTokens:a.usage.output_tokens,totalTokens:a.usage.total_tokens}:void 0}}}_useResponseApi(e){var s;const t=(s=e==null?void 0:e.tools)==null?void 0:s.some(Yf),n=(e==null?void 0:e.previous_response_id)!=null||(e==null?void 0:e.text)!=null||(e==null?void 0:e.truncation)!=null||(e==null?void 0:e.include)!=null;return this.useResponsesApi||t||n}async _generate(e,t,n){var o,l;if(this._useResponseApi(t))return this._responseApiGenerate(e,t,n);const s={},i=this.invocationParams(t),a=Vv(e,this.model);if(i.stream){const c=this._streamResponseChunks(e,t,n),u={};for await(const g of c){g.message.response_metadata={...g.generationInfo,...g.message.response_metadata};const _=((o=g.generationInfo)==null?void 0:o.completion)??0;u[_]===void 0?u[_]=g:u[_]=u[_].concat(g)}const d=Object.entries(u).sort(([g],[_])=>parseInt(g,10)-parseInt(_,10)).map(([g,_])=>_),{functions:h,function_call:f}=this.invocationParams(t),p=await this.getEstimatedTokenCountFromPrompt(e,h,f),m=await this.getNumTokensFromGenerations(d);return s.input_tokens=p,s.output_tokens=m,s.total_tokens=p+m,{generations:d,llmOutput:{estimatedTokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}else{let c;t.response_format&&t.response_format.type==="json_schema"?c=await this.betaParsedCompletionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}):c=await this.completionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});const{completion_tokens:u,prompt_tokens:d,total_tokens:h,prompt_tokens_details:f,completion_tokens_details:p}=(c==null?void 0:c.usage)??{};u&&(s.output_tokens=(s.output_tokens??0)+u),d&&(s.input_tokens=(s.input_tokens??0)+d),h&&(s.total_tokens=(s.total_tokens??0)+h),((f==null?void 0:f.audio_tokens)!==null||(f==null?void 0:f.cached_tokens)!==null)&&(s.input_token_details={...(f==null?void 0:f.audio_tokens)!==null&&{audio:f==null?void 0:f.audio_tokens},...(f==null?void 0:f.cached_tokens)!==null&&{cache_read:f==null?void 0:f.cached_tokens}}),((p==null?void 0:p.audio_tokens)!==null||(p==null?void 0:p.reasoning_tokens)!==null)&&(s.output_token_details={...(p==null?void 0:p.audio_tokens)!==null&&{audio:p==null?void 0:p.audio_tokens},...(p==null?void 0:p.reasoning_tokens)!==null&&{reasoning:p==null?void 0:p.reasoning_tokens}});const m=[];for(const g of(c==null?void 0:c.choices)??[]){const y={text:((l=g.message)==null?void 0:l.content)??"",message:this._convertOpenAIChatCompletionMessageToBaseMessage(g.message??{role:"assistant"},c)};y.generationInfo={...g.finish_reason?{finish_reason:g.finish_reason}:{},...g.logprobs?{logprobs:g.logprobs}:{}},Mr(y.message)&&(y.message.usage_metadata=s),y.message=new or(Object.fromEntries(Object.entries(y.message).filter(([b])=>!b.startsWith("lc_")))),m.push(y)}return{generations:m,llmOutput:{tokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,t,n){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&n!=="auto"){const i=tB(t);s+=await this.getNumTokens(i),s+=9}return t&&e.find(i=>i._getType()==="system")&&(s-=4),n==="none"?s+=1:typeof n=="object"&&(s+=await this.getNumTokens(n.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async n=>{var s;return(s=n.message.additional_kwargs)!=null&&s.function_call?(await this.getNumTokensFromMessages([n.message])).countPerMessage[0]:await this.getNumTokens(n.message.content)}))).reduce((n,s)=>n+s,0)}async getNumTokensFromMessages(e){let t=0,n=0,s=0;this.model==="gpt-3.5-turbo-0301"?(n=4,s=-1):(n=3,s=1);const i=await Promise.all(e.map(async a=>{var h,f,p,m,g,_;const o=await this.getNumTokens(a.content),l=await this.getNumTokens(Jg(a)),c=a.name!==void 0?s+await this.getNumTokens(a.name):0;let u=o+n+l+c;const d=a;if(d._getType()==="function"&&(u-=2),(h=d.additional_kwargs)!=null&&h.function_call&&(u+=3),(f=d==null?void 0:d.additional_kwargs.function_call)!=null&&f.name&&(u+=await this.getNumTokens((p=d.additional_kwargs.function_call)==null?void 0:p.name)),(m=d.additional_kwargs.function_call)!=null&&m.arguments)try{u+=await this.getNumTokens(JSON.stringify(JSON.parse((g=d.additional_kwargs.function_call)==null?void 0:g.arguments)))}catch(y){console.error("Error parsing function arguments",y,JSON.stringify(d.additional_kwargs.function_call)),u+=await this.getNumTokens((_=d.additional_kwargs.function_call)==null?void 0:_.arguments)}return t+=u,u}));return t+=3,{totalCount:t,countPerMessage:i}}async completionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,n)}catch(s){throw Xf(s)}})}async responseApiWithRetry(e,t){return this.caller.call(async()=>{var s,i;const n=this._getClientOptions(t);try{return((i=(s=e.text)==null?void 0:s.format)==null?void 0:i.type)==="json_schema"&&!e.stream?await this.client.responses.parse(e,n):await this.client.responses.create(e,n)}catch(a){throw Xf(a)}})}async betaParsedCompletionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.beta.chat.completions.parse(e,n)}catch(s){throw Xf(s)}})}_getClientOptions(e){if(!this.client){const n={baseURL:this.clientConfig.baseURL},s=GF(n),i={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new le(i)}return{...this.clientConfig,...e}}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,n)=>(n&&n.tokenUsage&&(t.tokenUsage.completionTokens+=n.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=n.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=n.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let n,s,i,a;oB(e)?(n=e.schema,s=e.name,i=e.method,a=e.includeRaw):(n=e,s=t==null?void 0:t.name,i=t==null?void 0:t.method,a=t==null?void 0:t.includeRaw);let o,l;if((t==null?void 0:t.strict)!==void 0&&i==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"?i===void 0&&(i="jsonSchema"):i==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`),i==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),_c(n)?l=Du.fromZodSchema(n):l=new Fu;else if(i==="jsonSchema")if(o=this.bind({response_format:{type:"json_schema",json_schema:{name:s??"extract",description:n.description,schema:n,strict:t==null?void 0:t.strict}}}),_c(n)){const h=Du.fromZodSchema(n);l=ni.from(f=>"parsed"in f.additional_kwargs?f.additional_kwargs.parsed:h)}else l=new Fu;else{let h=s??"extract";if(_c(n)){const f=fs(n);o=this.bind({tools:[{type:"function",function:{name:h,description:f.description,parameters:f}}],tool_choice:{type:"function",function:{name:h}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),l=new Bu({returnSingle:!0,keyName:h,zodSchema:n})}else{let f;typeof n.name=="string"&&typeof n.parameters=="object"&&n.parameters!=null?(f=n,h=n.name):(h=n.title??h,f={name:h,description:n.description??"",parameters:n}),o=this.bind({tools:[{type:"function",function:f}],tool_choice:{type:"function",function:{name:h}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),l=new Bu({returnSingle:!0,keyName:h})}}if(!a)return o.pipe(l);const c=ps.assign({parsed:(h,f)=>l.invoke(h.raw,f)}),u=ps.assign({parsed:()=>null}),d=c.withFallbacks({fallbacks:[u]});return $n.from([{raw:o},d])}};function _c(r){return typeof(r==null?void 0:r.parse)=="function"}function oB(r){return r!==void 0&&typeof r.schema=="object"}const yi="0.37.0";let Jv=!1,_o,zP,ym,UP,qP,WP;function lB(r,e={auto:!1}){if(Jv)throw new Error(`you must \`import '@anthropic-ai/sdk/shims/${r.kind}'\` before importing anything else from @anthropic-ai/sdk`);if(_o)throw new Error(`can't \`import '@anthropic-ai/sdk/shims/${r.kind}'\` after \`import '@anthropic-ai/sdk/shims/${_o}'\``);Jv=e.auto,_o=r.kind,zP=r.fetch,ym=r.File,UP=r.ReadableStream,qP=r.getDefaultAgent,WP=r.fileFromPath}class cB{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function uB({manuallyImported:r}={}){const e=r?"You may need to use polyfills":"Add one of these imports before your first `import â¦ from '@anthropic-ai/sdk'`:\n- `import '@anthropic-ai/sdk/shims/node'` (if you're running on Node)\n- `import '@anthropic-ai/sdk/shims/web'` (otherwise)\n";let t,n,s,i;try{t=fetch,n=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new cB(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/anthropics/anthropic-sdk-typescript#file-uploads")},isFsReadStream:a=>!1}}_o||lB(uB(),{auto:!0});class ve extends Error{}class kt extends ve{constructor(e,t,n,s){super(`${kt.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["request-id"],this.error=t}static makeMessage(e,t,n){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e||!s)return new Fd({message:n,cause:wm(t)});const i=t;return e===400?new VP(e,i,n,s):e===401?new ZP(e,i,n,s):e===403?new GP(e,i,n,s):e===404?new JP(e,i,n,s):e===409?new KP(e,i,n,s):e===422?new XP(e,i,n,s):e===429?new YP(e,i,n,s):e>=500?new QP(e,i,n,s):new kt(e,i,n,s)}}class Mn extends kt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Fd extends kt{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class HP extends Fd{constructor({message:e}={}){super({message:e??"Request timed out."})}}class VP extends kt{}class ZP extends kt{}class GP extends kt{}class JP extends kt{}class KP extends kt{}class XP extends kt{}class YP extends kt{}class QP extends kt{}var bc=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Os=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Yt;class Rl{constructor(){Yt.set(this,void 0),this.buffer=new Uint8Array,bc(this,Yt,null,"f")}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e;let n=new Uint8Array(this.buffer.length+t.length);n.set(this.buffer),n.set(t,this.buffer.length),this.buffer=n;const s=[];let i;for(;(i=dB(this.buffer,Os(this,Yt,"f")))!=null;){if(i.carriage&&Os(this,Yt,"f")==null){bc(this,Yt,i.index,"f");continue}if(Os(this,Yt,"f")!=null&&(i.index!==Os(this,Yt,"f")+1||i.carriage)){s.push(this.decodeText(this.buffer.slice(0,Os(this,Yt,"f")-1))),this.buffer=this.buffer.slice(Os(this,Yt,"f")),bc(this,Yt,null,"f");continue}const a=Os(this,Yt,"f")!==null?i.preceding-1:i.preceding,o=this.decodeText(this.buffer.slice(0,a));s.push(o),this.buffer=this.buffer.slice(i.index),bc(this,Yt,null,"f")}return s}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new ve(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new ve(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new ve("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}}Yt=new WeakMap;Rl.NEWLINE_CHARS=new Set([`
`,"\r"]);Rl.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function dB(r,e){for(let s=e??0;s<r.length;s++){if(r[s]===10)return{preceding:s,index:s+1,carriage:!1};if(r[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function hB(r){for(let n=0;n<r.length-1;n++){if(r[n]===10&&r[n+1]===10||r[n]===13&&r[n+1]===13)return n+2;if(r[n]===13&&r[n+1]===10&&n+3<r.length&&r[n+2]===13&&r[n+3]===10)return n+4}return-1}function Xg(r){if(r[Symbol.asyncIterator])return r;const e=r.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class er{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;async function*s(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(const a of fB(e,t)){if(a.event==="completion")try{yield JSON.parse(a.data)}catch(o){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),o}if(a.event==="message_start"||a.event==="message_delta"||a.event==="message_stop"||a.event==="content_block_start"||a.event==="content_block_delta"||a.event==="content_block_stop")try{yield JSON.parse(a.data)}catch(o){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),o}if(a.event!=="ping"&&a.event==="error")throw kt.generate(void 0,`SSE Error: ${a.data}`,a.data,nE(e.headers))}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new er(s,t)}static fromReadableStream(e,t){let n=!1;async function*s(){const a=new Rl,o=Xg(e);for await(const l of o)for(const c of a.decode(l))yield c;for(const l of a.flush())yield l}async function*i(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(const o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new er(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=n.next();e.push(a),t.push(a)}return i.shift()}});return[new er(()=>s(e),this.controller),new er(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new UP({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:a}=await t.next();if(a)return s.close();const o=n.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}}async function*fB(r,e){if(!r.body)throw e.abort(),new ve("Attempted to iterate over a response with no body");const t=new mB,n=new Rl,s=Xg(r.body);for await(const i of pB(s))for(const a of n.decode(i)){const o=t.decode(a);o&&(yield o)}for(const i of n.flush()){const a=t.decode(i);a&&(yield a)}}async function*pB(r){let e=new Uint8Array;for await(const t of r){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+n.length);s.set(e),s.set(n,e.length),e=s;let i;for(;(i=hB(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}class mB{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=gB(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}function gB(r,e){const t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}const _B=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function",bB=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&Bd(r),Bd=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function";async function yB(r,e,t){var s;if(r=await r,bB(r))return r;if(_B(r)){const i=await r.blob();e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=Bd(i)?[await i.arrayBuffer()]:[i];return new ym(a,e,t)}const n=await wB(r);if(e||(e=xB(r)??"unknown_file"),!(t!=null&&t.type)){const i=(s=n[0])==null?void 0:s.type;typeof i=="string"&&(t={...t,type:i})}return new ym(n,e,t)}async function wB(r){var t;let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(Bd(r))e.push(await r.arrayBuffer());else if(kB(r))for await(const n of r)e.push(n);else throw new Error(`Unexpected data type: ${typeof r}; constructor: ${(t=r==null?void 0:r.constructor)==null?void 0:t.name}; props: ${vB(r)}`);return e}function vB(r){return`[${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}function xB(r){var e;return Qf(r.name)||Qf(r.filename)||((e=Qf(r.path))==null?void 0:e.split(/[\\/]/).pop())}const Qf=r=>{if(typeof r=="string")return r;if(typeof Buffer<"u"&&r instanceof Buffer)return String(r)},kB=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",Kv=r=>r&&typeof r=="object"&&r.body&&r[Symbol.toStringTag]==="MultipartBody";var Mi={},SB=function(r,e,t,n,s){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t},PB=function(r,e,t,n){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},yc;async function eE(r){const{response:e}=r;if(r.options.stream)return Ni("response",e.status,e.url,e.headers,e.body),r.options.__streamClass?r.options.__streamClass.fromSSEResponse(e,r.controller):er.fromSSEResponse(e,r.controller);if(e.status===204)return null;if(r.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const i=await e.json();return Ni("response",e.status,e.url,e.headers,i),tE(i,e)}const s=await e.text();return Ni("response",e.status,e.url,e.headers,s),s}function tE(r,e){return!r||typeof r!="object"||Array.isArray(r)?r:Object.defineProperty(r,"_request_id",{value:e.headers.get("request-id"),enumerable:!1})}class zd extends Promise{constructor(e,t=eE){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new zd(this.responsePromise,async t=>tE(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class EB{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=ep("maxRetries",t),this.timeout=ep("timeout",n),this.httpAgent=s,this.fetch=i??zP}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...IB(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${jB()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(async s=>{const i=s&&Bd(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var p;e={...e};const{method:n,path:s,query:i,headers:a={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:Kv(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,l=this.calculateContentLength(o),c=this.buildURL(s,i);"timeout"in e&&ep("timeout",e.timeout),e.timeout=e.timeout??this.timeout;const u=e.httpAgent??this.httpAgent??qP(c),d=e.timeout+1e3;typeof((p=u==null?void 0:u.options)==null?void 0:p.timeout)=="number"&&d>(u.options.timeout??0)&&(u.options.timeout=d),this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const h=this.buildHeaders({options:e,headers:a,contentLength:l,retryCount:t});return{req:{method:n,...o&&{body:o},headers:h,...u&&{agent:u},signal:e.signal??null},url:c,timeout:e.timeout}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:s}){const i={};n&&(i["content-length"]=n);const a=this.defaultHeaders(e);return e0(i,a),e0(i,t),Kv(e.body)&&_o!=="node"&&delete i["content-type"],wc(a,"x-stainless-retry-count")===void 0&&wc(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),wc(a,"x-stainless-timeout")===void 0&&wc(t,"x-stainless-timeout")===void 0&&e.timeout&&(i["x-stainless-timeout"]=String(e.timeout)),this.validateHeaders(i,t),i}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new ve("Streaming is strongly recommended for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-python#streaming-responses for more details");return 600*1e3}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,s){return kt.generate(e,t,n,s)}request(e,t=null){return new zd(this.makeRequest(e,t))}async makeRequest(e,t){var d,h;const n=await e,s=n.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(n);const{req:i,url:a,timeout:o}=this.buildRequest(n,{retryCount:s-t});if(await this.prepareRequest(i,{url:a,options:n}),Ni("request",a,n,i.headers),(d=n.signal)!=null&&d.aborted)throw new Mn;const l=new AbortController,c=await this.fetchWithTimeout(a,i,o,l).catch(wm);if(c instanceof Error){if((h=n.signal)!=null&&h.aborted)throw new Mn;if(t)return this.retryRequest(n,t);throw c.name==="AbortError"?new HP:new Fd({cause:c})}const u=nE(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){const y=`retrying, ${t} attempts remaining`;return Ni(`response (error; ${y})`,c.status,a,u),this.retryRequest(n,t,u)}const f=await c.text().catch(y=>wm(y).message),p=$B(f),m=p?void 0:f;throw Ni(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,a,u,m),this.makeStatusError(c.status,p,m,u)}return{response:c,options:n,controller:l}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new OB(this,n,e)}buildURL(e,t){const n=NB(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return qu(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new ve(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,s){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),n),l={signal:s.signal,...a};l.method&&(l.method=l.method.toUpperCase());const c=60*1e3,u=setTimeout(()=>{var d,h;if(l&&((d=l==null?void 0:l.agent)!=null&&d.sockets))for(const f of Object.values((h=l==null?void 0:l.agent)==null?void 0:h.sockets).flat())f!=null&&f.setKeepAlive&&f.setKeepAlive(!0,c)},c);return this.fetch.call(void 0,e,l).finally(()=>{clearTimeout(o),clearTimeout(u)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){let s;const i=n==null?void 0:n["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(s=o)}const a=n==null?void 0:n["retry-after"];if(a&&!s){const o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await LB(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${yi}`}}class AB{constructor(e,t,n,s){yc.set(this,void 0),SB(this,yc,e),this.options=s,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new ve("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of n)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await PB(this,yc,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(yc=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class OB extends zd{constructor(e,t,n){super(t,async s=>new n(e,s.response,await eE(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const nE=r=>new Proxy(Object.fromEntries(r.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),TB={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},Gr=r=>typeof r=="object"&&r!==null&&!qu(r)&&Object.keys(r).every(e=>rE(TB,e)),RB=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":yi,"X-Stainless-OS":Yv(Deno.build.os),"X-Stainless-Arch":Xv(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":yi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":yi,"X-Stainless-OS":Yv(process.platform),"X-Stainless-Arch":Xv(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const r=CB();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":yi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":yi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function CB(){if(typeof navigator>"u"||!navigator)return null;const r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of r){const n=t.exec(navigator.userAgent);if(n){const s=n[1]||0,i=n[2]||0,a=n[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const Xv=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",Yv=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown");let Qv;const IB=()=>Qv??(Qv=RB()),$B=r=>{try{return JSON.parse(r)}catch{return}},MB=/^[a-z][a-z0-9+.-]*:/i,NB=r=>MB.test(r),LB=r=>new Promise(e=>setTimeout(e,r)),ep=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new ve(`${r} must be an integer`);if(e<0)throw new ve(`${r} must be a positive integer`);return e},wm=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null)try{return new Error(JSON.stringify(r))}catch{}return new Error(String(r))},tp=r=>{var e,t,n,s;if(typeof process<"u")return((e=Mi==null?void 0:Mi[r])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(s=(n=(t=Deno.env)==null?void 0:t.get)==null?void 0:n.call(t,r))==null?void 0:s.trim()};function qu(r){if(!r)return!0;for(const e in r)return!1;return!0}function rE(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function e0(r,e){for(const t in e){if(!rE(e,t))continue;const n=t.toLowerCase();if(!n)continue;const s=e[t];s===null?delete r[n]:s!==void 0&&(r[n]=s)}}function Ni(r,...e){typeof process<"u"&&(Mi==null?void 0:Mi.DEBUG)==="true"&&console.log(`Anthropic:DEBUG:${r}`,...e)}const jB=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)}),DB=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",FB=r=>typeof(r==null?void 0:r.get)=="function",wc=(r,e)=>{var n;const t=e.toLowerCase();if(FB(r)){const s=((n=e[0])==null?void 0:n.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,a,o)=>a+o.toUpperCase());for(const i of[e,t,e.toUpperCase(),s]){const a=r.get(i);if(a)return a}}for(const[s,i]of Object.entries(r))if(s.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i};class Ud extends AB{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.has_more=n.has_more||!1,this.first_id=n.first_id||null,this.last_id=n.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var t;if((t=this.options.query)!=null&&t.before_id){const n=this.first_id;return n?{params:{before_id:n}}:null}const e=this.last_id;return e?{params:{after_id:e}}:null}}class bs{constructor(e){this._client=e}}let Yg=class extends bs{retrieve(e,t){return this._client.get(`/v1/models/${e}?beta=true`,t)}list(e={},t){return Gr(e)?this.list({},e):this._client.getAPIList("/v1/models?beta=true",Qg,{query:e,...t})}};class Qg extends Ud{}Yg.BetaModelInfosPage=Qg;class qd{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){const e=new Rl;for await(const t of this.iterator)for(const n of e.decode(t))yield JSON.parse(n);for(const t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body)throw t.abort(),new ve("Attempted to iterate over a response with no body");return new qd(Xg(e.body),t)}}let e_=class extends bs{create(e,t){const{betas:n,...s}=e;return this._client.post("/v1/messages/batches?beta=true",{body:s,...t,headers:{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString(),...t==null?void 0:t.headers}})}retrieve(e,t={},n){if(Gr(t))return this.retrieve(e,{},t);const{betas:s}=t;return this._client.get(`/v1/messages/batches/${e}?beta=true`,{...n,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...n==null?void 0:n.headers}})}list(e={},t){if(Gr(e))return this.list({},e);const{betas:n,...s}=e;return this._client.getAPIList("/v1/messages/batches?beta=true",t_,{query:s,...t,headers:{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString(),...t==null?void 0:t.headers}})}delete(e,t={},n){if(Gr(t))return this.delete(e,{},t);const{betas:s}=t;return this._client.delete(`/v1/messages/batches/${e}?beta=true`,{...n,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...n==null?void 0:n.headers}})}cancel(e,t={},n){if(Gr(t))return this.cancel(e,{},t);const{betas:s}=t;return this._client.post(`/v1/messages/batches/${e}/cancel?beta=true`,{...n,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...n==null?void 0:n.headers}})}async results(e,t={},n){if(Gr(t))return this.results(e,{},t);const s=await this.retrieve(e);if(!s.results_url)throw new ve(`No batch \`results_url\`; Has it finished processing? ${s.processing_status} - ${s.id}`);const{betas:i}=t;return this._client.get(s.results_url,{...n,headers:{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary",...n==null?void 0:n.headers},__binaryResponse:!0})._thenUnwrap((a,o)=>qd.fromResponse(o.response,o.controller))}};class t_ extends Ud{}e_.BetaMessageBatchesPage=t_;const BB=r=>{let e=0,t=[];for(;e<r.length;){let n=r[e];if(n==="\\"){e++;continue}if(n==="{"){t.push({type:"brace",value:"{"}),e++;continue}if(n==="}"){t.push({type:"brace",value:"}"}),e++;continue}if(n==="["){t.push({type:"paren",value:"["}),e++;continue}if(n==="]"){t.push({type:"paren",value:"]"}),e++;continue}if(n===":"){t.push({type:"separator",value:":"}),e++;continue}if(n===","){t.push({type:"delimiter",value:","}),e++;continue}if(n==='"'){let o="",l=!1;for(n=r[++e];n!=='"';){if(e===r.length){l=!0;break}if(n==="\\"){if(e++,e===r.length){l=!0;break}o+=n+r[e],n=r[++e]}else o+=n,n=r[++e]}n=r[++e],l||t.push({type:"string",value:o});continue}if(n&&/\s/.test(n)){e++;continue}let i=/[0-9]/;if(n&&i.test(n)||n==="-"||n==="."){let o="";for(n==="-"&&(o+=n,n=r[++e]);n&&i.test(n)||n===".";)o+=n,n=r[++e];t.push({type:"number",value:o});continue}let a=/[a-z]/i;if(n&&a.test(n)){let o="";for(;n&&a.test(n)&&e!==r.length;)o+=n,n=r[++e];if(o=="true"||o=="false"||o==="null")t.push({type:"name",value:o});else{e++;continue}continue}e++}return t},wi=r=>{if(r.length===0)return r;let e=r[r.length-1];switch(e.type){case"separator":return r=r.slice(0,r.length-1),wi(r);case"number":let t=e.value[e.value.length-1];if(t==="."||t==="-")return r=r.slice(0,r.length-1),wi(r);case"string":let n=r[r.length-2];if((n==null?void 0:n.type)==="delimiter")return r=r.slice(0,r.length-1),wi(r);if((n==null?void 0:n.type)==="brace"&&n.value==="{")return r=r.slice(0,r.length-1),wi(r);break;case"delimiter":return r=r.slice(0,r.length-1),wi(r)}return r},zB=r=>{let e=[];return r.map(t=>{t.type==="brace"&&(t.value==="{"?e.push("}"):e.splice(e.lastIndexOf("}"),1)),t.type==="paren"&&(t.value==="["?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(t=>{t==="}"?r.push({type:"brace",value:"}"}):t==="]"&&r.push({type:"paren",value:"]"})}),r},UB=r=>{let e="";return r.map(t=>{switch(t.type){case"string":e+='"'+t.value+'"';break;default:e+=t.value;break}}),e},sE=r=>JSON.parse(UB(zB(wi(BB(r)))));var pt=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},me=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},un,zr,Aa,vc,Oa,Ta,xc,Ra,pr,Ca,kc,Sc,pi,Pc,Ec,np,t0,rp,sp,ip,ap,n0;const r0="__json_buf";class Wu{constructor(){un.add(this),this.messages=[],this.receivedMessages=[],zr.set(this,void 0),this.controller=new AbortController,Aa.set(this,void 0),vc.set(this,()=>{}),Oa.set(this,()=>{}),Ta.set(this,void 0),xc.set(this,()=>{}),Ra.set(this,()=>{}),pr.set(this,{}),Ca.set(this,!1),kc.set(this,!1),Sc.set(this,!1),pi.set(this,!1),Pc.set(this,void 0),Ec.set(this,void 0),rp.set(this,e=>{if(pt(this,kc,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Mn),e instanceof Mn)return pt(this,Sc,!0,"f"),this._emit("abort",e);if(e instanceof ve)return this._emit("error",e);if(e instanceof Error){const t=new ve(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new ve(String(e)))}),pt(this,Aa,new Promise((e,t)=>{pt(this,vc,e,"f"),pt(this,Oa,t,"f")}),"f"),pt(this,Ta,new Promise((e,t)=>{pt(this,xc,e,"f"),pt(this,Ra,t,"f")}),"f"),me(this,Aa,"f").catch(()=>{}),me(this,Ta,"f").catch(()=>{})}get response(){return me(this,Pc,"f")}get request_id(){return me(this,Ec,"f")}async withResponse(){const e=await me(this,Aa,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new Wu;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,n){const s=new Wu;for(const i of t.messages)s._addMessageParam(i);return s._run(()=>s._createMessage(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},me(this,rp,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,n){var o;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),me(this,un,"m",sp).call(this);const{response:i,data:a}=await e.create({...t,stream:!0},{...n,signal:this.controller.signal}).withResponse();this._connected(i);for await(const l of a)me(this,un,"m",ip).call(this,l);if((o=a.controller.signal)!=null&&o.aborted)throw new Mn;me(this,un,"m",ap).call(this)}_connected(e){this.ended||(pt(this,Pc,e,"f"),pt(this,Ec,e==null?void 0:e.headers.get("request-id"),"f"),me(this,vc,"f").call(this,e),this._emit("connect"))}get ended(){return me(this,Ca,"f")}get errored(){return me(this,kc,"f")}get aborted(){return me(this,Sc,"f")}abort(){this.controller.abort()}on(e,t){return(me(this,pr,"f")[e]||(me(this,pr,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=me(this,pr,"f")[e];if(!n)return this;const s=n.findIndex(i=>i.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(me(this,pr,"f")[e]||(me(this,pr,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{pt(this,pi,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){pt(this,pi,!0,"f"),await me(this,Ta,"f")}get currentMessage(){return me(this,zr,"f")}async finalMessage(){return await this.done(),me(this,un,"m",np).call(this)}async finalText(){return await this.done(),me(this,un,"m",t0).call(this)}_emit(e,...t){if(me(this,Ca,"f"))return;e==="end"&&(pt(this,Ca,!0,"f"),me(this,xc,"f").call(this));const n=me(this,pr,"f")[e];if(n&&(me(this,pr,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!me(this,pi,"f")&&!(n!=null&&n.length)&&Promise.reject(s),me(this,Oa,"f").call(this,s),me(this,Ra,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!me(this,pi,"f")&&!(n!=null&&n.length)&&Promise.reject(s),me(this,Oa,"f").call(this,s),me(this,Ra,"f").call(this,s),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",me(this,un,"m",np).call(this))}async _fromReadableStream(e,t){var i;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),me(this,un,"m",sp).call(this),this._connected(null);const s=er.fromReadableStream(e,this.controller);for await(const a of s)me(this,un,"m",ip).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new Mn;me(this,un,"m",ap).call(this)}[(zr=new WeakMap,Aa=new WeakMap,vc=new WeakMap,Oa=new WeakMap,Ta=new WeakMap,xc=new WeakMap,Ra=new WeakMap,pr=new WeakMap,Ca=new WeakMap,kc=new WeakMap,Sc=new WeakMap,pi=new WeakMap,Pc=new WeakMap,Ec=new WeakMap,rp=new WeakMap,un=new WeakSet,np=function(){if(this.receivedMessages.length===0)throw new ve("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},t0=function(){if(this.receivedMessages.length===0)throw new ve("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(n=>n.type==="text").map(n=>n.text);if(t.length===0)throw new ve("stream ended without producing a content block with type=text");return t.join(" ")},sp=function(){this.ended||pt(this,zr,void 0,"f")},ip=function(t){if(this.ended)return;const n=me(this,un,"m",n0).call(this,t);switch(this._emit("streamEvent",t,n),t.type){case"content_block_delta":{const s=n.content.at(-1);switch(t.delta.type){case"text_delta":{s.type==="text"&&this._emit("text",t.delta.text,s.text||"");break}case"citations_delta":{s.type==="text"&&this._emit("citation",t.delta.citation,s.citations??[]);break}case"input_json_delta":{s.type==="tool_use"&&s.input&&this._emit("inputJson",t.delta.partial_json,s.input);break}case"thinking_delta":{s.type==="thinking"&&this._emit("thinking",t.delta.thinking,s.thinking);break}case"signature_delta":{s.type==="thinking"&&this._emit("signature",s.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(n),this._addMessage(n,!0);break}case"content_block_stop":{this._emit("contentBlock",n.content.at(-1));break}case"message_start":{pt(this,zr,n,"f");break}}},ap=function(){if(this.ended)throw new ve("stream has ended, this shouldn't happen");const t=me(this,zr,"f");if(!t)throw new ve("request ended without sending any chunks");return pt(this,zr,void 0,"f"),t},n0=function(t){let n=me(this,zr,"f");if(t.type==="message_start"){if(n)throw new ve(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!n)throw new ve(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return n;case"message_delta":return n.stop_reason=t.delta.stop_reason,n.stop_sequence=t.delta.stop_sequence,n.usage.output_tokens=t.usage.output_tokens,n;case"content_block_start":return n.content.push(t.content_block),n;case"content_block_delta":{const s=n.content.at(t.index);switch(t.delta.type){case"text_delta":{(s==null?void 0:s.type)==="text"&&(s.text+=t.delta.text);break}case"citations_delta":{(s==null?void 0:s.type)==="text"&&(s.citations??(s.citations=[]),s.citations.push(t.delta.citation));break}case"input_json_delta":{if((s==null?void 0:s.type)==="tool_use"){let i=s[r0]||"";i+=t.delta.partial_json,Object.defineProperty(s,r0,{value:i,enumerable:!1,writable:!0}),i&&(s.input=sE(i))}break}case"thinking_delta":{(s==null?void 0:s.type)==="thinking"&&(s.thinking+=t.delta.thinking);break}case"signature_delta":{(s==null?void 0:s.type)==="thinking"&&(s.signature=t.delta.signature);break}default:t.delta}return n}case"content_block_stop":return n}},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("streamEvent",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new er(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}const s0={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"};let Wd=class extends bs{constructor(){super(...arguments),this.batches=new e_(this._client)}create(e,t){const{betas:n,...s}=e;return s.model in s0&&console.warn(`The model '${s.model}' is deprecated and will reach end-of-life on ${s0[s.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`),this._client.post("/v1/messages?beta=true",{body:s,timeout:this._client._options.timeout??(s.stream?6e5:this._client._calculateNonstreamingTimeout(s.max_tokens)),...t,headers:{...(n==null?void 0:n.toString())!=null?{"anthropic-beta":n==null?void 0:n.toString()}:void 0,...t==null?void 0:t.headers},stream:e.stream??!1})}stream(e,t){return Wu.createMessage(this,e,t)}countTokens(e,t){const{betas:n,...s}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:s,...t,headers:{"anthropic-beta":[...n??[],"token-counting-2024-11-01"].toString(),...t==null?void 0:t.headers}})}};Wd.Batches=e_;Wd.BetaMessageBatchesPage=t_;class Cl extends bs{constructor(){super(...arguments),this.models=new Yg(this._client),this.messages=new Wd(this._client)}}Cl.Models=Yg;Cl.BetaModelInfosPage=Qg;Cl.Messages=Wd;class iE extends bs{create(e,t){return this._client.post("/v1/complete",{body:e,timeout:this._client._options.timeout??6e5,...t,stream:e.stream??!1})}}class n_ extends bs{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/v1/messages/batches/${e}`,t)}list(e={},t){return Gr(e)?this.list({},e):this._client.getAPIList("/v1/messages/batches",r_,{query:e,...t})}delete(e,t){return this._client.delete(`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post(`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){const n=await this.retrieve(e);if(!n.results_url)throw new ve(`No batch \`results_url\`; Has it finished processing? ${n.processing_status} - ${n.id}`);return this._client.get(n.results_url,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})._thenUnwrap((s,i)=>qd.fromResponse(i.response,i.controller))}}class r_ extends Ud{}n_.MessageBatchesPage=r_;var mt=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},ge=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},dn,Ur,Ia,Ac,$a,Ma,Oc,Na,mr,La,Tc,Rc,mi,Cc,Ic,op,i0,lp,cp,up,dp,a0;const o0="__json_buf";class Hu{constructor(){dn.add(this),this.messages=[],this.receivedMessages=[],Ur.set(this,void 0),this.controller=new AbortController,Ia.set(this,void 0),Ac.set(this,()=>{}),$a.set(this,()=>{}),Ma.set(this,void 0),Oc.set(this,()=>{}),Na.set(this,()=>{}),mr.set(this,{}),La.set(this,!1),Tc.set(this,!1),Rc.set(this,!1),mi.set(this,!1),Cc.set(this,void 0),Ic.set(this,void 0),lp.set(this,e=>{if(mt(this,Tc,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Mn),e instanceof Mn)return mt(this,Rc,!0,"f"),this._emit("abort",e);if(e instanceof ve)return this._emit("error",e);if(e instanceof Error){const t=new ve(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new ve(String(e)))}),mt(this,Ia,new Promise((e,t)=>{mt(this,Ac,e,"f"),mt(this,$a,t,"f")}),"f"),mt(this,Ma,new Promise((e,t)=>{mt(this,Oc,e,"f"),mt(this,Na,t,"f")}),"f"),ge(this,Ia,"f").catch(()=>{}),ge(this,Ma,"f").catch(()=>{})}get response(){return ge(this,Cc,"f")}get request_id(){return ge(this,Ic,"f")}async withResponse(){const e=await ge(this,Ia,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new Hu;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,n){const s=new Hu;for(const i of t.messages)s._addMessageParam(i);return s._run(()=>s._createMessage(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},ge(this,lp,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,n){var o;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),ge(this,dn,"m",cp).call(this);const{response:i,data:a}=await e.create({...t,stream:!0},{...n,signal:this.controller.signal}).withResponse();this._connected(i);for await(const l of a)ge(this,dn,"m",up).call(this,l);if((o=a.controller.signal)!=null&&o.aborted)throw new Mn;ge(this,dn,"m",dp).call(this)}_connected(e){this.ended||(mt(this,Cc,e,"f"),mt(this,Ic,e==null?void 0:e.headers.get("request-id"),"f"),ge(this,Ac,"f").call(this,e),this._emit("connect"))}get ended(){return ge(this,La,"f")}get errored(){return ge(this,Tc,"f")}get aborted(){return ge(this,Rc,"f")}abort(){this.controller.abort()}on(e,t){return(ge(this,mr,"f")[e]||(ge(this,mr,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=ge(this,mr,"f")[e];if(!n)return this;const s=n.findIndex(i=>i.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(ge(this,mr,"f")[e]||(ge(this,mr,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{mt(this,mi,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){mt(this,mi,!0,"f"),await ge(this,Ma,"f")}get currentMessage(){return ge(this,Ur,"f")}async finalMessage(){return await this.done(),ge(this,dn,"m",op).call(this)}async finalText(){return await this.done(),ge(this,dn,"m",i0).call(this)}_emit(e,...t){if(ge(this,La,"f"))return;e==="end"&&(mt(this,La,!0,"f"),ge(this,Oc,"f").call(this));const n=ge(this,mr,"f")[e];if(n&&(ge(this,mr,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!ge(this,mi,"f")&&!(n!=null&&n.length)&&Promise.reject(s),ge(this,$a,"f").call(this,s),ge(this,Na,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!ge(this,mi,"f")&&!(n!=null&&n.length)&&Promise.reject(s),ge(this,$a,"f").call(this,s),ge(this,Na,"f").call(this,s),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",ge(this,dn,"m",op).call(this))}async _fromReadableStream(e,t){var i;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),ge(this,dn,"m",cp).call(this),this._connected(null);const s=er.fromReadableStream(e,this.controller);for await(const a of s)ge(this,dn,"m",up).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new Mn;ge(this,dn,"m",dp).call(this)}[(Ur=new WeakMap,Ia=new WeakMap,Ac=new WeakMap,$a=new WeakMap,Ma=new WeakMap,Oc=new WeakMap,Na=new WeakMap,mr=new WeakMap,La=new WeakMap,Tc=new WeakMap,Rc=new WeakMap,mi=new WeakMap,Cc=new WeakMap,Ic=new WeakMap,lp=new WeakMap,dn=new WeakSet,op=function(){if(this.receivedMessages.length===0)throw new ve("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},i0=function(){if(this.receivedMessages.length===0)throw new ve("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(n=>n.type==="text").map(n=>n.text);if(t.length===0)throw new ve("stream ended without producing a content block with type=text");return t.join(" ")},cp=function(){this.ended||mt(this,Ur,void 0,"f")},up=function(t){if(this.ended)return;const n=ge(this,dn,"m",a0).call(this,t);switch(this._emit("streamEvent",t,n),t.type){case"content_block_delta":{const s=n.content.at(-1);switch(t.delta.type){case"text_delta":{s.type==="text"&&this._emit("text",t.delta.text,s.text||"");break}case"citations_delta":{s.type==="text"&&this._emit("citation",t.delta.citation,s.citations??[]);break}case"input_json_delta":{s.type==="tool_use"&&s.input&&this._emit("inputJson",t.delta.partial_json,s.input);break}case"thinking_delta":{s.type==="thinking"&&this._emit("thinking",t.delta.thinking,s.thinking);break}case"signature_delta":{s.type==="thinking"&&this._emit("signature",s.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(n),this._addMessage(n,!0);break}case"content_block_stop":{this._emit("contentBlock",n.content.at(-1));break}case"message_start":{mt(this,Ur,n,"f");break}}},dp=function(){if(this.ended)throw new ve("stream has ended, this shouldn't happen");const t=ge(this,Ur,"f");if(!t)throw new ve("request ended without sending any chunks");return mt(this,Ur,void 0,"f"),t},a0=function(t){let n=ge(this,Ur,"f");if(t.type==="message_start"){if(n)throw new ve(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!n)throw new ve(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return n;case"message_delta":return n.stop_reason=t.delta.stop_reason,n.stop_sequence=t.delta.stop_sequence,n.usage.output_tokens=t.usage.output_tokens,n;case"content_block_start":return n.content.push(t.content_block),n;case"content_block_delta":{const s=n.content.at(t.index);switch(t.delta.type){case"text_delta":{(s==null?void 0:s.type)==="text"&&(s.text+=t.delta.text);break}case"citations_delta":{(s==null?void 0:s.type)==="text"&&(s.citations??(s.citations=[]),s.citations.push(t.delta.citation));break}case"input_json_delta":{if((s==null?void 0:s.type)==="tool_use"){let i=s[o0]||"";i+=t.delta.partial_json,Object.defineProperty(s,o0,{value:i,enumerable:!1,writable:!0}),i&&(s.input=sE(i))}break}case"thinking_delta":{(s==null?void 0:s.type)==="thinking"&&(s.thinking+=t.delta.thinking);break}case"signature_delta":{(s==null?void 0:s.type)==="thinking"&&(s.signature=t.delta.signature);break}default:t.delta}return n}case"content_block_stop":return n}},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("streamEvent",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new er(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class Hd extends bs{constructor(){super(...arguments),this.batches=new n_(this._client)}create(e,t){return e.model in l0&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${l0[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`),this._client.post("/v1/messages",{body:e,timeout:this._client._options.timeout??(e.stream?6e5:this._client._calculateNonstreamingTimeout(e.max_tokens)),...t,stream:e.stream??!1})}stream(e,t){return Hu.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}}const l0={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"};Hd.Batches=n_;Hd.MessageBatchesPage=r_;class s_ extends bs{retrieve(e,t){return this._client.get(`/v1/models/${e}`,t)}list(e={},t){return Gr(e)?this.list({},e):this._client.getAPIList("/v1/models",i_,{query:e,...t})}}class i_ extends Ud{}s_.ModelInfosPage=i_;var aE;class Le extends EB{constructor({baseURL:e=tp("ANTHROPIC_BASE_URL"),apiKey:t=tp("ANTHROPIC_API_KEY")??null,authToken:n=tp("ANTHROPIC_AUTH_TOKEN")??null,...s}={}){const i={apiKey:t,authToken:n,...s,baseURL:e||"https://api.anthropic.com"};if(!i.dangerouslyAllowBrowser&&DB())throw new ve(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new iE(this),this.messages=new Hd(this),this.models=new s_(this),this.beta=new Cl(this),this._options=i,this.apiKey=t,this.authToken=n}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01",...this._options.defaultHeaders}}validateHeaders(e,t){if(!(this.apiKey&&e["x-api-key"])&&t["x-api-key"]!==null&&!(this.authToken&&e.authorization)&&t.authorization!==null)throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}authHeaders(e){const t=this.apiKeyAuth(e),n=this.bearerAuth(e);return t!=null&&!qu(t)?t:n!=null&&!qu(n)?n:{}}apiKeyAuth(e){return this.apiKey==null?{}:{"X-Api-Key":this.apiKey}}bearerAuth(e){return this.authToken==null?{}:{Authorization:`Bearer ${this.authToken}`}}}aE=Le;Le.Anthropic=aE;Le.HUMAN_PROMPT=`

Human:`;Le.AI_PROMPT=`

Assistant:`;Le.DEFAULT_TIMEOUT=6e5;Le.AnthropicError=ve;Le.APIError=kt;Le.APIConnectionError=Fd;Le.APIConnectionTimeoutError=HP;Le.APIUserAbortError=Mn;Le.NotFoundError=JP;Le.ConflictError=KP;Le.RateLimitError=YP;Le.BadRequestError=VP;Le.AuthenticationError=ZP;Le.InternalServerError=QP;Le.PermissionDeniedError=GP;Le.UnprocessableEntityError=XP;Le.toFile=yB;Le.fileFromPath=WP;Le.Completions=iE;Le.Messages=Hd;Le.Models=s_;Le.ModelInfosPage=i_;Le.Beta=Cl;const{HUMAN_PROMPT:S4,AI_PROMPT:P4}=Le;class c0 extends OP{static lc_name(){return"AnthropicToolsOutputParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","anthropic","output_parsers"]}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){let t=e;if(typeof e=="string")try{t=JSON.parse(e)}catch(s){throw new tl(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(s.message)}`,e)}else t=e;if(this.zodSchema===void 0)return t;const n=await this.zodSchema.safeParseAsync(t);if(n.success)return n.data;throw new tl(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(n.error.errors)}`,JSON.stringify(t,null,2))}async parseResult(e){const t=e.flatMap(i=>{const{message:a}=i;return Array.isArray(a.content)?oE(a.content)[0]:[]});if(t[0]===void 0)throw new Error("No parseable tool calls provided to AnthropicToolsOutputParser.");const[n]=t;return await this._validateResult(n.args)}}function oE(r){const e=[];for(const t of r)t.type==="tool_use"&&e.push({name:t.name,args:t.input,id:t.id,type:"tool_call"});return e}function qB(r){if(r)return r==="any"?{type:"any"}:r==="auto"?{type:"auto"}:typeof r=="string"?{type:"tool",name:r}:r}function u0(r){const e=/^data:(image\/.+);base64,(.+)$/,t=r.match(e);if(t===null)throw new Error(["Anthropic only supports base64-encoded images currently.","Example: data:image/png;base64,/9j/4AAQSk..."].join(`

`));return{type:"base64",media_type:t[1]??"",data:t[2]??""}}function WB(r){const e=[];for(const t of r)if(t._getType()==="tool")if(typeof t.content=="string"){const n=e[e.length-1];(n==null?void 0:n._getType())==="human"&&Array.isArray(n.content)&&"type"in n.content[0]&&n.content[0].type==="tool_result"?n.content.push({type:"tool_result",content:t.content,tool_use_id:t.tool_call_id}):e.push(new Ui({content:[{type:"tool_result",content:t.content,tool_use_id:t.tool_call_id}]}))}else e.push(new Ui({content:[{type:"tool_result",content:vm(t.content),tool_use_id:t.tool_call_id}]}));else e.push(t);return e}function d0(r){if(r.id===void 0)throw new Error('Anthropic requires all tool calls to have an "id".');return{type:"tool_use",id:r.id,name:r.name,input:r.args}}function vm(r){const e=["tool_use","tool_result","input_json_delta"],t=["text","text_delta"];return typeof r=="string"?r:r.map(s=>{const i="cache_control"in s?s.cache_control:void 0;if(s.type==="image_url"){let a;return typeof s.image_url=="string"?a=u0(s.image_url):a=u0(s.image_url.url),{type:"image",source:a,...i?{cache_control:i}:{}}}else{if(s.type==="document")return{...s,...i?{cache_control:i}:{}};if(s.type==="thinking")return{type:"thinking",thinking:s.thinking,signature:s.signature,...i?{cache_control:i}:{}};if(s.type==="redacted_thinking")return{type:"redacted_thinking",data:s.data,...i?{cache_control:i}:{}};if(t.find(a=>a===s.type)&&"text"in s)return{type:"text",text:s.text,...i?{cache_control:i}:{}};if(e.find(a=>a===s.type)){const a={...s};if("index"in a&&delete a.index,a.type==="input_json_delta"&&(a.type="tool_use"),"input"in a&&typeof a.input=="string")try{a.input=JSON.parse(a.input)}catch{a.input={}}return{...a,...i?{cache_control:i}:{}}}else throw new Error("Unsupported message content format")}})}function h0(r){const e=WB(r);let t;e.length>0&&e[0]._getType()==="system"&&(t=r[0].content);const s=(t!==void 0?e.slice(1):e).map(i=>{var o;let a;if(i._getType()==="human")a="user";else if(i._getType()==="ai")a="assistant";else if(i._getType()==="tool")a="user";else throw i._getType()==="system"?new Error("System messages are only permitted as the first passed message."):new Error(`Message type "${i._getType()}" is not supported.`);if(Mr(i)&&((o=i.tool_calls)!=null&&o.length)){if(typeof i.content=="string")return i.content===""?{role:a,content:i.tool_calls.map(d0)}:{role:a,content:[{type:"text",text:i.content},...i.tool_calls.map(d0)]};{const{content:l}=i;return!i.tool_calls.every(u=>l.find(d=>(d.type==="tool_use"||d.type==="input_json_delta")&&d.id===u.id))&&console.warn('The "tool_calls" field on a message is only respected if content is a string.'),{role:a,content:vm(i.content)}}}else return{role:a,content:vm(i.content)}});return{messages:HB(s),system:t}}function HB(r){if(!r||r.length<=1)return r;const e=[];let t=r[0];const n=i=>typeof i=="string"?[{type:"text",text:i}]:i,s=i=>i.role!=="user"||typeof i.content=="string"?!1:Array.isArray(i.content)&&i.content.every(a=>a.type==="tool_result");for(let i=1;i<r.length;i+=1){const a=r[i];s(t)&&s(a)?t={...t,content:[...n(t.content),...n(a.content)]}:(e.push(t),t=a)}return e.push(t),e}function VB(r,e){var t;if(r.type==="message_start"){const{content:n,usage:s,...i}=r.message,a={};for(const[d,h]of Object.entries(i))h!=null&&(a[d]=h);const{input_tokens:o,output_tokens:l,...c}=s??{},u={input_tokens:o,output_tokens:l,total_tokens:o+l,input_token_details:{cache_creation:c.cache_creation_input_tokens,cache_read:c.cache_read_input_tokens}};return{chunk:new Ze({content:e.coerceContentToString?"":[],additional_kwargs:a,usage_metadata:e.streamUsage?u:void 0,response_metadata:{usage:{...c}},id:r.message.id})}}else if(r.type==="message_delta"){const n={input_tokens:0,output_tokens:r.usage.output_tokens,total_tokens:r.usage.output_tokens,input_token_details:{cache_creation:r.usage.cache_creation_input_tokens,cache_read:r.usage.cache_read_input_tokens}};return{chunk:new Ze({content:e.coerceContentToString?"":[],additional_kwargs:{...r.delta},usage_metadata:e.streamUsage?n:void 0})}}else if(r.type==="content_block_start"&&["tool_use","document"].includes(r.content_block.type)){const n=r.content_block;let s;return n.type==="tool_use"?s=[{id:n.id,index:r.index,name:n.name,args:""}]:s=[],{chunk:new Ze({content:e.coerceContentToString?"":[{index:r.index,...r.content_block,input:""}],additional_kwargs:{},tool_call_chunks:s})}}else if(r.type==="content_block_delta"&&["text_delta","citations_delta","thinking_delta","signature_delta"].includes(r.delta.type)){if(e.coerceContentToString&&"text"in r.delta)return{chunk:new Ze({content:r.delta.text})};{const n=r.delta;return"citation"in n&&(n.citations=[n.citation],delete n.citation),n.type==="thinking_delta"||n.type==="signature_delta"?{chunk:new Ze({content:[{index:r.index,...n,type:"thinking"}]})}:{chunk:new Ze({content:[{index:r.index,...n,type:"text"}]})}}}else{if(r.type==="content_block_delta"&&r.delta.type==="input_json_delta")return{chunk:new Ze({content:e.coerceContentToString?"":[{index:r.index,input:r.delta.partial_json,type:r.delta.type}],additional_kwargs:{},tool_call_chunks:[{index:r.index,args:r.delta.partial_json}]})};if(r.type==="content_block_start"&&r.content_block.type==="text"){const n=(t=r.content_block)==null?void 0:t.text;if(n!==void 0)return{chunk:new Ze({content:e.coerceContentToString?n:[{index:r.index,...r.content_block}],additional_kwargs:{}})}}else{if(r.type==="content_block_start"&&r.content_block.type==="redacted_thinking")return{chunk:new Ze({content:e.coerceContentToString?"":[{index:r.index,...r.content_block}]})};if(r.type==="content_block_start"&&r.content_block.type==="thinking"){const n=r.content_block.thinking;return{chunk:new Ze({content:e.coerceContentToString?n:[{index:r.index,...r.content_block}]})}}}}return null}function ZB(r,e){const t=e.usage,n=t!=null?{input_tokens:t.input_tokens??0,output_tokens:t.output_tokens??0,total_tokens:(t.input_tokens??0)+(t.output_tokens??0),input_token_details:{cache_creation:t.cache_creation_input_tokens,cache_read:t.cache_read_input_tokens}}:void 0;if(r.length===1&&r[0].type==="text")return[{text:r[0].text,message:new or({content:r[0].text,additional_kwargs:e,usage_metadata:n,response_metadata:e,id:e.id})}];{const s=oE(r);return[{text:"",message:new or({content:r,additional_kwargs:e,tool_calls:s,usage_metadata:n,response_metadata:e,id:e.id})}]}}function $c(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function f0(r){let e;return r.status===400&&r.message.includes("tool")?e=$c(r,"INVALID_TOOL_RESULTS"):r.status===401?e=$c(r,"MODEL_AUTHENTICATION"):r.status===404?e=$c(r,"MODEL_NOT_FOUND"):r.status===429?e=$c(r,"MODEL_RATE_LIMIT"):e=r,e}function GB(r){return!!(r.tools&&r.tools.length>0)}function JB(r){for(const e of r.messages??[])if(typeof e.content!="string"){for(const t of e.content??[])if(typeof t=="object"&&t!=null&&t.type==="document"&&typeof t.citations=="object"&&t.citations.enabled)return!0}return!1}function KB(r){return!!(r.thinking&&r.thinking.type==="enabled")}function XB(r){return"input_schema"in r}function YB(r){if(typeof r.content=="string")return r.content;if(Array.isArray(r.content)&&r.content.length>=1&&"input"in r.content[0])return typeof r.content[0].input=="string"?r.content[0].input:JSON.stringify(r.content[0].input);if(Array.isArray(r.content)&&r.content.length>=1&&"text"in r.content[0])return r.content[0].text}class QB extends Xn{static lc_name(){return"ChatAnthropic"}get lc_secrets(){return{anthropicApiKey:"ANTHROPIC_API_KEY",apiKey:"ANTHROPIC_API_KEY"}}get lc_aliases(){return{modelName:"model"}}constructor(e){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"anthropicApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:2048}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"claude-2.1"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"claude-2.1"}),Object.defineProperty(this,"invocationKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"clientOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"thinking",{enumerable:!0,configurable:!0,writable:!0,value:{type:"disabled"}}),Object.defineProperty(this,"batchClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamingClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"createClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.anthropicApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.anthropicApiKey)??Ht("ANTHROPIC_API_KEY"),!this.anthropicApiKey&&!(e!=null&&e.createClient))throw new Error("Anthropic API key not found");this.clientOptions=(e==null?void 0:e.clientOptions)??{},this.apiKey=this.anthropicApiKey,this.apiUrl=e==null?void 0:e.anthropicApiUrl,this.modelName=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.model=this.modelName,this.invocationKwargs=(e==null?void 0:e.invocationKwargs)??{},this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topK=(e==null?void 0:e.topK)??this.topK,this.topP=(e==null?void 0:e.topP)??this.topP,this.maxTokens=(e==null?void 0:e.maxTokensToSample)??(e==null?void 0:e.maxTokens)??this.maxTokens,this.stopSequences=(e==null?void 0:e.stopSequences)??this.stopSequences,this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.thinking=(e==null?void 0:e.thinking)??this.thinking,this.createClient=(e==null?void 0:e.createClient)??(t=>new Le(t))}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"anthropic",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}formatStructuredToolToAnthropic(e){if(!(!e||!e.length))return e.map(t=>{if(XB(t))return t;if(Ol(t))return{name:t.function.name,description:t.function.description,input_schema:t.function.parameters};if(Dd(t))return{name:t.name,description:t.description,input_schema:el(t.schema)?fs(t.schema):t.schema};throw new Error(`Unknown tool type passed to ChatAnthropic: ${JSON.stringify(t,null,2)}`)})}bindTools(e,t){return this.bind({tools:this.formatStructuredToolToAnthropic(e),...t})}invocationParams(e){const t=qB(e==null?void 0:e.tool_choice);if(this.thinking.type==="enabled"){if(this.topK!==-1)throw new Error("topK is not supported when thinking is enabled");if(this.topP!==-1)throw new Error("topP is not supported when thinking is enabled");if(this.temperature!==1)throw new Error("temperature is not supported when thinking is enabled");return{model:this.model,stop_sequences:(e==null?void 0:e.stop)??this.stopSequences,stream:this.streaming,max_tokens:this.maxTokens,tools:this.formatStructuredToolToAnthropic(e==null?void 0:e.tools),tool_choice:t,thinking:this.thinking,...this.invocationKwargs}}return{model:this.model,temperature:this.temperature,top_k:this.topK,top_p:this.topP,stop_sequences:(e==null?void 0:e.stop)??this.stopSequences,stream:this.streaming,max_tokens:this.maxTokens,tools:this.formatStructuredToolToAnthropic(e==null?void 0:e.tools),tool_choice:t,thinking:this.thinking,...this.invocationKwargs}}_identifyingParams(){return{model_name:this.model,...this.invocationParams()}}identifyingParams(){return{model_name:this.model,...this.invocationParams()}}async*_streamResponseChunks(e,t,n){var c;const s=this.invocationParams(t),i=h0(e),a={...s,...i,stream:!0},o=!GB(a)&&!JB(a)&&!KB(a),l=await this.createStreamWithRetry(a,{headers:t.headers});for await(const u of l){if((c=t.signal)!=null&&c.aborted)throw l.controller.abort(),new Error("AbortError: User aborted the request.");const d=this.streamUsage??t.streamUsage,h=VB(u,{streamUsage:d,coerceContentToString:o});if(!h)continue;const{chunk:f}=h,p=YB(f),m=new zn({message:new Ze({content:f.content,additional_kwargs:f.additional_kwargs,tool_call_chunks:f.tool_call_chunks,usage_metadata:d?f.usage_metadata:void 0,response_metadata:f.response_metadata,id:f.id}),text:p??""});yield m,await(n==null?void 0:n.handleLLMNewToken(p??"",void 0,void 0,void 0,void 0,{chunk:m}))}}async _generateNonStreaming(e,t,n){const s=await this.completionWithRetry({...t,stream:!1,...h0(e)},n),{content:i,...a}=s,o=ZB(i,a),{role:l,type:c,...u}=a;return{generations:o,llmOutput:u}}async _generate(e,t,n){if(this.stopSequences&&t.stop)throw new Error('"stopSequence" parameter found in input and default params');const s=this.invocationParams(t);if(s.stream){let i;const a=this._streamResponseChunks(e,t,n);for await(const o of a)i===void 0?i=o:i=i.concat(o);if(i===void 0)throw new Error("No chunks returned from Anthropic API.");return{generations:[{text:i.text,message:i.message}]}}else return this._generateNonStreaming(e,s,{signal:t.signal,headers:t.headers})}async createStreamWithRetry(e,t){if(!this.streamingClient){const s=this.apiUrl?{baseURL:this.apiUrl}:void 0;this.streamingClient=this.createClient({dangerouslyAllowBrowser:!0,...this.clientOptions,...s,apiKey:this.apiKey,maxRetries:0})}const n=async()=>{try{return await this.streamingClient.messages.create({...e,...this.invocationKwargs,stream:!0},t)}catch(s){throw f0(s)}};return this.caller.call(n)}async completionWithRetry(e,t){if(!this.batchClient){const s=this.apiUrl?{baseURL:this.apiUrl}:void 0;this.batchClient=this.createClient({dangerouslyAllowBrowser:!0,...this.clientOptions,...s,apiKey:this.apiKey,maxRetries:0})}const n=async()=>{try{return await this.batchClient.messages.create({...e,...this.invocationKwargs},t)}catch(s){throw f0(s)}};return this.caller.callWithOptions({signal:t.signal??void 0},n)}_llmType(){return"anthropic"}withStructuredOutput(e,t){var p;const n=e,s=t==null?void 0:t.name,i=t==null?void 0:t.method,a=t==null?void 0:t.includeRaw;if(i==="jsonMode")throw new Error('Anthropic only supports "functionCalling" as a method.');let o=s??"extract",l,c;if(el(n)){const m=fs(n);c=[{name:o,description:m.description??"A function available to call.",input_schema:m}],l=new c0({returnSingle:!0,keyName:o,zodSchema:n})}else{let m;typeof n.name=="string"&&typeof n.description=="string"&&typeof n.input_schema=="object"&&n.input_schema!=null?(m=n,o=n.name):m={name:o,description:n.description??"",input_schema:n},c=[m],l=new c0({returnSingle:!0,keyName:o})}let u;if(((p=this.thinking)==null?void 0:p.type)==="enabled"){const m="Anthropic structured output relies on forced tool calling, which is not supported when `thinking` is enabled. This method will raise OutputParserException if tool calls are not generated. Consider disabling `thinking` or adjust your prompt to ensure the tool is called.";console.warn(m),u=this.bind({tools:c});const g=_=>{if(!_.tool_calls||_.tool_calls.length===0)throw new Error(m);return _};u=u.pipe(g)}else u=this.bind({tools:c,tool_choice:{type:"tool",name:o}});if(!a)return u.pipe(l).withConfig({runName:"ChatAnthropicStructuredOutput"});const d=ps.assign({parsed:(m,g)=>l.invoke(m.raw,g)}),h=ps.assign({parsed:()=>null}),f=d.withFallbacks({fallbacks:[h]});return $n.from([{raw:u},f]).withConfig({runName:"StructuredOutputRunnable"})}}class ez extends QB{}function tz(r){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:n,azureOpenAIBasePath:s,baseURL:i,azureADTokenProvider:a,azureOpenAIEndpoint:o}=r;if((n||a)&&s&&e)return`${s}/${e}`;if((n||a)&&o&&e)return`${o}/openai/deployments/${e}`;if(n||a){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return i}function Mc(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function hp(r){let e;return r.constructor.name===pl.name?(e=new Error(r.message),e.name="TimeoutError"):r.constructor.name===qt.name?(e=new Error(r.message),e.name="AbortError"):r.status===400&&r.message.includes("tool_calls")?e=Mc(r,"INVALID_TOOL_RESULTS"):r.status===401?e=Mc(r,"MODEL_AUTHENTICATION"):r.status===429?e=Mc(r,"MODEL_RATE_LIMIT"):r.status===404?e=Mc(r,"MODEL_NOT_FOUND"):e=r,e}function p0(r){if(r)return r==="any"||r==="required"?"required":r==="auto"?"auto":r==="none"?"none":typeof r=="string"?{type:"function",function:{name:r}}:r}function nz(r){return r.anyOf!==void 0&&Array.isArray(r.anyOf)}function rz(r){const e=["namespace functions {",""];for(const t of r)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(lE(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function lE(r,e){var n;const t=[];for(const[s,i]of Object.entries(r.properties??{}))i.description&&e<2&&t.push(`// ${i.description}`),(n=r.required)!=null&&n.includes(s)?t.push(`${s}: ${Vu(i,e)},`):t.push(`${s}?: ${Vu(i,e)},`);return t.map(s=>" ".repeat(e)+s).join(`
`)}function Vu(r,e){if(nz(r))return r.anyOf.map(t=>Vu(t,e)).join(" | ");switch(r.type){case"string":return r.enum?r.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",lE(r,e+2),"}"].join(`
`);case"array":return r.items?`${Vu(r.items,e)}[]`:"any[]";default:return""}}function sz(r,e){let t;if(Dd(r)){const n=ZF({name:r.name,parameters:r.schema,description:r.description});n.function.parameters?t={type:n.type,function:{name:n.function.name,description:n.function.description,parameters:n.function.parameters,...(e==null?void 0:e.strict)!==void 0?{strict:e.strict}:{}}}:t={type:"function",function:DP(r,e)}}else t=r;return(e==null?void 0:e.strict)!==void 0&&(t.function.strict=e.strict),t}function iz(r){return r.role!=="system"&&r.role!=="developer"&&r.role!=="assistant"&&r.role!=="user"&&r.role!=="function"&&r.role!=="tool"&&console.warn(`Unknown message role: ${r.role}`),r.role}function a_(r){const e=r._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!ti.isInstance(r))throw new Error("Invalid generic chat message");return iz(r)}default:throw new Error(`Unknown message type: ${e}`)}}function m0(r,e){return r.flatMap(t=>{var i;let n=a_(t);n==="system"&&o_(e)&&(n="developer");const s={role:n,content:t.content};if(t.name!=null&&(s.name=t.name),t.additional_kwargs.function_call!=null&&(s.function_call=t.additional_kwargs.function_call,s.content=""),Mr(t)&&((i=t.tool_calls)!=null&&i.length)?(s.tool_calls=t.tool_calls.map(CP),s.content=""):(t.additional_kwargs.tool_calls!=null&&(s.tool_calls=t.additional_kwargs.tool_calls),t.tool_call_id!=null&&(s.tool_call_id=t.tool_call_id)),t.additional_kwargs.audio&&typeof t.additional_kwargs.audio=="object"&&"id"in t.additional_kwargs.audio){const a={role:"assistant",audio:{id:t.additional_kwargs.audio.id}};return[s,a]}return s})}const Ei="__openai_function_call_ids__";function g0(r,e){return r.flatMap(t=>{var s,i;let n=a_(t);if(n==="system"&&o_(e)&&(n="developer"),n==="function")throw new Error("Function messages are not supported in Responses API");if(n==="tool"){const a=t;return((s=a.additional_kwargs)==null?void 0:s.type)==="computer_call_output"?{type:"computer_call_output",output:(()=>{if(typeof a.content=="string")return{type:"computer_screenshot",image_url:a.content};if(Array.isArray(a.content)){const l=a.content.find(u=>u.type==="computer_screenshot");if(l)return l;const c=a.content.find(u=>u.type==="image_url");if(c)return{type:"computer_screenshot",image_url:typeof c.image_url=="string"?c.image_url:c.image_url.url}}throw new Error("Invalid computer call output")})(),call_id:a.tool_call_id}:{type:"function_call_output",call_id:a.tool_call_id,id:a.id,output:typeof a.content!="string"?JSON.stringify(a.content):a.content}}if(n==="assistant"){const a=[];t.additional_kwargs.reasoning!=null&&(u=>typeof u=="object"&&u!=null&&"type"in u&&u.type==="reasoning")(t.additional_kwargs.reasoning)&&a.push(t.additional_kwargs.reasoning);let{content:o}=t;t.additional_kwargs.refusal!=null&&(typeof o=="string"&&(o=[{type:"output_text",text:o,annotations:[]}]),o=[...o,{type:"refusal",refusal:t.additional_kwargs.refusal}]),a.push({type:"message",role:"assistant",content:typeof o=="string"?o:o.flatMap(c=>c.type==="text"?{type:"output_text",text:c.text,annotations:c.annotations??[]}:c.type==="output_text"||c.type==="refusal"?c:[])});const l=t.additional_kwargs[Ei];if(Mr(t)&&((i=t.tool_calls)!=null&&i.length)?a.push(...t.tool_calls.map(c=>({type:"function_call",name:c.name,arguments:JSON.stringify(c.args),call_id:c.id,id:l==null?void 0:l[c.id]}))):t.additional_kwargs.tool_calls!=null&&a.push(...t.additional_kwargs.tool_calls.map(c=>({type:"function_call",name:c.function.name,call_id:c.id,id:l==null?void 0:l[c.id],arguments:c.function.arguments}))),t.additional_kwargs.tool_outputs!=null){const c=t.additional_kwargs.tool_outputs,u=c==null?void 0:c.filter(d=>d.type==="computer_call");u.length>0&&a.push(...u)}return a}return n==="user"?{type:"message",role:"user",content:typeof t.content=="string"?t.content:t.content.flatMap(a=>{if(a.type==="text")return{type:"input_text",text:a.text};if(a.type==="image_url"){const o=typeof a.image_url=="string"?a.image_url:a.image_url.url,l=typeof a.image_url=="string"?"auto":a.image_url.detail;return{type:"input_image",image_url:o,detail:l}}return a.type==="input_text"||a.type==="input_image"||a.type==="input_file"?a:[]})}:[]})}function cE(r){if(r.error){const a=new Error(r.error.message);throw a.name=r.error.code,a}const e=[],t=[],n=[],s={model:r.model,created_at:r.created_at,id:r.id,incomplete_details:r.incomplete_details,metadata:r.metadata,object:r.object,status:r.status,user:r.user,model_name:r.model},i={};for(const a of r.output)if(a.type==="message")e.push(...a.content.flatMap(o=>o.type==="output_text"?("parsed"in o&&o.parsed!=null&&(i.parsed=o.parsed),{type:"text",text:o.text,annotations:o.annotations}):o.type==="refusal"?(i.refusal=o.refusal,[]):o));else if(a.type==="function_call"){const o={function:{name:a.name,arguments:a.arguments},id:a.call_id};try{t.push(Tl(o,{returnId:!0}))}catch(l){let c;typeof l=="object"&&l!=null&&"message"in l&&typeof l.message=="string"&&(c=l.message),n.push(jd(o,c))}i[Ei]??(i[Ei]={}),i[Ei][a.call_id]=a.id}else a.type==="reasoning"?i.reasoning=a:(i.tool_outputs??(i.tool_outputs=[]),i.tool_outputs.push(a));return new or({id:r.id,content:e,tool_calls:t,invalid_tool_calls:n,usage_metadata:r.usage,additional_kwargs:i,response_metadata:s})}function az(r){var l,c;const e=[];let t={},n;const s=[],i={},a={};let o;if(r.type==="response.output_text.delta")e.push({type:"text",text:r.delta,index:r.content_index});else if(r.type==="response.output_text.annotation.added")e.push({type:"text",text:"",annotations:[r.annotation],index:r.content_index});else if(r.type==="response.output_item.added"&&r.item.type==="message")o=r.item.id;else if(r.type==="response.output_item.added"&&r.item.type==="function_call")s.push({type:"tool_call_chunk",name:r.item.name,args:r.item.arguments,id:r.item.id,index:r.output_index}),a[Ei]={[r.item.call_id]:r.item.id};else if(r.type==="response.output_item.done"&&(r.item.type==="web_search_call"||r.item.type==="file_search_call"||r.item.type==="computer_call"))a.tool_outputs=[r.item];else if(r.type==="response.created")i.id=r.response.id,i.model_name=r.response.model,i.model=r.response.model;else if(r.type==="response.completed"){const u=cE(r.response);n=r.response.usage,((c=(l=r.response.text)==null?void 0:l.format)==null?void 0:c.type)==="json_schema"&&(a.parsed??(a.parsed=JSON.parse(u.text)));for(const[d,h]of Object.entries(r.response))d!=="id"&&(i[d]=h)}else if(r.type==="response.function_call_arguments.delta")s.push({type:"tool_call_chunk",args:r.delta,index:r.output_index});else if(r.type==="response.web_search_call.completed"||r.type==="response.file_search_call.completed")t={tool_outputs:{id:r.item_id,type:r.type.replace("response.","").replace(".completed",""),status:"completed"}};else if(r.type==="response.refusal.done")a.refusal=r.refusal;else return null;return new zn({text:e.map(u=>u.text).join(""),message:new Ze({id:o,content:e,tool_call_chunks:s,usage_metadata:n,additional_kwargs:a,response_metadata:i}),generationInfo:t})}function fp(r){return"type"in r&&r.type!=="function"}function oz(r){return r!=null&&typeof r=="object"&&"type"in r&&r.type!=="function"}function _0(r,e){return Ol(r)?(e==null?void 0:e.strict)!==void 0?{...r,function:{...r.function,strict:e.strict}}:r:sz(r,e)}function o_(r){return(r==null?void 0:r.startsWith("o1"))||(r==null?void 0:r.startsWith("o3"))}class lz extends Xn{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","reasoningEffort","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","modelName","model","modelKwargs","stop","stopSequences","timeout","openAIApiKey","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming"]}constructor(e){var t,n;super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useResponsesApi",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.openAIApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.openAIApiKey)??((t=e==null?void 0:e.configuration)==null?void 0:t.apiKey)??Ht("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.organization=((n=e==null?void 0:e.configuration)==null?void 0:n.organization)??Ht("OPENAI_ORGANIZATION"),this.model=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.modelName=this.model,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this.stop,this.user=e==null?void 0:e.user,this.__includeRawResponse=e==null?void 0:e.__includeRawResponse,this.audio=e==null?void 0:e.audio,this.modalities=e==null?void 0:e.modalities,this.reasoningEffort=e==null?void 0:e.reasoningEffort,this.maxTokens=(e==null?void 0:e.maxCompletionTokens)??(e==null?void 0:e.maxTokens),this.useResponsesApi=(e==null?void 0:e.useResponsesApi)??this.useResponsesApi,this.model==="o1"&&(this.disableStreaming=!0),this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e==null?void 0:e.configuration},(e==null?void 0:e.supportsStrictToolCalling)!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling)}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){let n;return(t==null?void 0:t.strict)!==void 0?n=t.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this.bind({tools:e.map(s=>fp(s)?s:_0(s,{strict:n})),...t})}createResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&Nc(e.json_schema.schema)?jP(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}invocationParams(e,t){var o,l;let n;if((e==null?void 0:e.strict)!==void 0?n=e.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this._useResponseApi(e)){const c={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:e==null?void 0:e.previous_response_id,truncation:e==null?void 0:e.truncation,include:e==null?void 0:e.include,tools:(o=e==null?void 0:e.tools)!=null&&o.length?e.tools.map(d=>fp(d)?d:Ol(d)?{type:"function",name:d.function.name,parameters:d.function.parameters,description:d.function.description,strict:n}:null).filter(d=>d!==null):void 0,tool_choice:oz(e==null?void 0:e.tool_choice)?e==null?void 0:e.tool_choice:(()=>{const d=p0(e==null?void 0:e.tool_choice);if(typeof d=="object"&&"type"in d)return{type:"function",name:d.function.name}})(),text:(()=>{if(e!=null&&e.text)return e.text;const d=this.createResponseFormat(e==null?void 0:e.response_format);return(d==null?void 0:d.type)==="json_schema"?d.json_schema.schema!=null?{format:{type:"json_schema",schema:d.json_schema.schema,description:d.json_schema.description,name:d.json_schema.name,strict:d.json_schema.strict}}:void 0:{format:d}})(),parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,max_output_tokens:this.maxTokens===-1?void 0:this.maxTokens,...this.modelKwargs},u=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return u!==void 0&&(c.reasoning={effort:u}),c}let s={};(e==null?void 0:e.stream_options)!==void 0?s={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t!=null&&t.streaming)&&(s={stream_options:{include_usage:!0}});const i={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:(l=e==null?void 0:e.tools)!=null&&l.length?e.tools.map(c=>_0(c,{strict:n})):void 0,tool_choice:p0(e==null?void 0:e.tool_choice),response_format:this.createResponseFormat(e==null?void 0:e.response_format),seed:e==null?void 0:e.seed,...s,parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,...this.audio||e!=null&&e.audio?{audio:this.audio||(e==null?void 0:e.audio)}:{},...this.modalities||e!=null&&e.modalities?{modalities:this.modalities||(e==null?void 0:e.modalities)}:{},...this.modelKwargs};(e==null?void 0:e.prediction)!==void 0&&(i.prediction=e.prediction);const a=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return a!==void 0&&(i.reasoning_effort=a),o_(i.model)?i.max_completion_tokens=this.maxTokens===-1?void 0:this.maxTokens:i.max_tokens=this.maxTokens===-1?void 0:this.maxTokens,i}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){const n=e.tool_calls;switch(e.role){case"assistant":{const s=[],i=[];for(const l of n??[])try{s.push(Tl(l,{returnId:!0}))}catch(c){i.push(jd(l,c.message))}const a={function_call:e.function_call,tool_calls:n};this.__includeRawResponse!==void 0&&(a.__raw_response=t);const o={model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};return e.audio&&(a.audio=e.audio),new or({content:e.content||"",tool_calls:s,invalid_tool_calls:i,additional_kwargs:a,response_metadata:o,id:t.id})}default:return new ti(e.content||"",e.role??"unknown")}}_convertOpenAIDeltaToBaseMessageChunk(e,t,n){var l,c;const s=e.role??n,i=e.content??"";let a;e.function_call?a={function_call:e.function_call}:e.tool_calls?a={tool_calls:e.tool_calls}:a={},this.__includeRawResponse&&(a.__raw_response=t),e.audio&&(a.audio={...e.audio,index:t.choices[0].index});const o={usage:{...t.usage}};if(s==="user")return new kl({content:i,response_metadata:o});if(s==="assistant"){const u=[];if(Array.isArray(e.tool_calls))for(const d of e.tool_calls)u.push({name:(l=d.function)==null?void 0:l.name,args:(c=d.function)==null?void 0:c.arguments,id:d.id,index:d.index,type:"tool_call_chunk"});return new Ze({content:i,tool_call_chunks:u,additional_kwargs:a,id:t.id,response_metadata:o})}else return s==="system"?new Gs({content:i,response_metadata:o}):s==="developer"?new Gs({content:i,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}}):s==="function"?new xl({content:i,additional_kwargs:a,name:e.name,response_metadata:o}):s==="tool"?new Od({content:i,additional_kwargs:a,tool_call_id:e.tool_call_id,response_metadata:o}):new vl({content:i,role:s,response_metadata:o})}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,n){var c,u,d,h,f,p,m,g,_,y;if(this._useResponseApi(t)){const b=await this.responseApiWithRetry({...this.invocationParams(t,{streaming:!0}),input:g0(e,this.model),stream:!0},t);for await(const w of b){const v=az(w);v!=null&&(yield v)}return}const s=m0(e,this.model),i={...this.invocationParams(t,{streaming:!0}),messages:s,stream:!0};let a;const o=await this.completionWithRetry(i,t);let l;for await(const b of o){const w=(c=b==null?void 0:b.choices)==null?void 0:c[0];if(b.usage&&(l=b.usage),!w)continue;const{delta:v}=w;if(!v)continue;const S=this._convertOpenAIDeltaToBaseMessageChunk(v,b,a);a=v.role??a;const k={prompt:t.promptIndex??0,completion:w.index??0};if(typeof S.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const x={...k};w.finish_reason!=null&&(x.finish_reason=w.finish_reason,x.system_fingerprint=b.system_fingerprint,x.model_name=b.model),this.logprobs&&(x.logprobs=w.logprobs);const A=new zn({message:S,text:S.content,generationInfo:x});yield A,await(n==null?void 0:n.handleLLMNewToken(A.text??"",k,void 0,void 0,void 0,{chunk:A}))}if(l){const b={...((u=l.prompt_tokens_details)==null?void 0:u.audio_tokens)!==null&&{audio:(d=l.prompt_tokens_details)==null?void 0:d.audio_tokens},...((h=l.prompt_tokens_details)==null?void 0:h.cached_tokens)!==null&&{cache_read:(f=l.prompt_tokens_details)==null?void 0:f.cached_tokens}},w={...((p=l.completion_tokens_details)==null?void 0:p.audio_tokens)!==null&&{audio:(m=l.completion_tokens_details)==null?void 0:m.audio_tokens},...((g=l.completion_tokens_details)==null?void 0:g.reasoning_tokens)!==null&&{reasoning:(_=l.completion_tokens_details)==null?void 0:_.reasoning_tokens}};yield new zn({message:new Ze({content:"",response_metadata:{usage:{...l}},usage_metadata:{input_tokens:l.prompt_tokens,output_tokens:l.completion_tokens,total_tokens:l.total_tokens,...Object.keys(b).length>0&&{input_token_details:b},...Object.keys(w).length>0&&{output_token_details:w}}}),text:""})}if((y=t.signal)!=null&&y.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _responseApiGenerate(e,t,n){var o;const s=this.invocationParams(t);if(s.stream){const l=this._streamResponseChunks(e,t,n);let c;for await(const u of l)u.message.response_metadata={...u.generationInfo,...u.message.response_metadata},c=(c==null?void 0:c.concat(u))??u;return{generations:c?[c]:[],llmOutput:{estimatedTokenUsage:(o=c==null?void 0:c.message)==null?void 0:o.usage_metadata}}}const i=g0(e,this.model),a=await this.responseApiWithRetry({input:i,...s},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});return{generations:[{text:a.output_text,message:cE(a)}],llmOutput:{id:a.id,estimatedTokenUsage:a.usage?{promptTokens:a.usage.input_tokens,completionTokens:a.usage.output_tokens,totalTokens:a.usage.total_tokens}:void 0}}}_useResponseApi(e){var s;const t=(s=e==null?void 0:e.tools)==null?void 0:s.some(fp),n=(e==null?void 0:e.previous_response_id)!=null||(e==null?void 0:e.text)!=null||(e==null?void 0:e.truncation)!=null||(e==null?void 0:e.include)!=null;return this.useResponsesApi||t||n}async _generate(e,t,n){var o,l;if(this._useResponseApi(t))return this._responseApiGenerate(e,t,n);const s={},i=this.invocationParams(t),a=m0(e,this.model);if(i.stream){const c=this._streamResponseChunks(e,t,n),u={};for await(const g of c){g.message.response_metadata={...g.generationInfo,...g.message.response_metadata};const _=((o=g.generationInfo)==null?void 0:o.completion)??0;u[_]===void 0?u[_]=g:u[_]=u[_].concat(g)}const d=Object.entries(u).sort(([g],[_])=>parseInt(g,10)-parseInt(_,10)).map(([g,_])=>_),{functions:h,function_call:f}=this.invocationParams(t),p=await this.getEstimatedTokenCountFromPrompt(e,h,f),m=await this.getNumTokensFromGenerations(d);return s.input_tokens=p,s.output_tokens=m,s.total_tokens=p+m,{generations:d,llmOutput:{estimatedTokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}else{let c;t.response_format&&t.response_format.type==="json_schema"?c=await this.betaParsedCompletionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}):c=await this.completionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});const{completion_tokens:u,prompt_tokens:d,total_tokens:h,prompt_tokens_details:f,completion_tokens_details:p}=(c==null?void 0:c.usage)??{};u&&(s.output_tokens=(s.output_tokens??0)+u),d&&(s.input_tokens=(s.input_tokens??0)+d),h&&(s.total_tokens=(s.total_tokens??0)+h),((f==null?void 0:f.audio_tokens)!==null||(f==null?void 0:f.cached_tokens)!==null)&&(s.input_token_details={...(f==null?void 0:f.audio_tokens)!==null&&{audio:f==null?void 0:f.audio_tokens},...(f==null?void 0:f.cached_tokens)!==null&&{cache_read:f==null?void 0:f.cached_tokens}}),((p==null?void 0:p.audio_tokens)!==null||(p==null?void 0:p.reasoning_tokens)!==null)&&(s.output_token_details={...(p==null?void 0:p.audio_tokens)!==null&&{audio:p==null?void 0:p.audio_tokens},...(p==null?void 0:p.reasoning_tokens)!==null&&{reasoning:p==null?void 0:p.reasoning_tokens}});const m=[];for(const g of(c==null?void 0:c.choices)??[]){const y={text:((l=g.message)==null?void 0:l.content)??"",message:this._convertOpenAIChatCompletionMessageToBaseMessage(g.message??{role:"assistant"},c)};y.generationInfo={...g.finish_reason?{finish_reason:g.finish_reason}:{},...g.logprobs?{logprobs:g.logprobs}:{}},Mr(y.message)&&(y.message.usage_metadata=s),y.message=new or(Object.fromEntries(Object.entries(y.message).filter(([b])=>!b.startsWith("lc_")))),m.push(y)}return{generations:m,llmOutput:{tokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,t,n){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&n!=="auto"){const i=rz(t);s+=await this.getNumTokens(i),s+=9}return t&&e.find(i=>i._getType()==="system")&&(s-=4),n==="none"?s+=1:typeof n=="object"&&(s+=await this.getNumTokens(n.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async n=>{var s;return(s=n.message.additional_kwargs)!=null&&s.function_call?(await this.getNumTokensFromMessages([n.message])).countPerMessage[0]:await this.getNumTokens(n.message.content)}))).reduce((n,s)=>n+s,0)}async getNumTokensFromMessages(e){let t=0,n=0,s=0;this.model==="gpt-3.5-turbo-0301"?(n=4,s=-1):(n=3,s=1);const i=await Promise.all(e.map(async a=>{var h,f,p,m,g,_;const o=await this.getNumTokens(a.content),l=await this.getNumTokens(a_(a)),c=a.name!==void 0?s+await this.getNumTokens(a.name):0;let u=o+n+l+c;const d=a;if(d._getType()==="function"&&(u-=2),(h=d.additional_kwargs)!=null&&h.function_call&&(u+=3),(f=d==null?void 0:d.additional_kwargs.function_call)!=null&&f.name&&(u+=await this.getNumTokens((p=d.additional_kwargs.function_call)==null?void 0:p.name)),(m=d.additional_kwargs.function_call)!=null&&m.arguments)try{u+=await this.getNumTokens(JSON.stringify(JSON.parse((g=d.additional_kwargs.function_call)==null?void 0:g.arguments)))}catch(y){console.error("Error parsing function arguments",y,JSON.stringify(d.additional_kwargs.function_call)),u+=await this.getNumTokens((_=d.additional_kwargs.function_call)==null?void 0:_.arguments)}return t+=u,u}));return t+=3,{totalCount:t,countPerMessage:i}}async completionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,n)}catch(s){throw hp(s)}})}async responseApiWithRetry(e,t){return this.caller.call(async()=>{var s,i;const n=this._getClientOptions(t);try{return((i=(s=e.text)==null?void 0:s.format)==null?void 0:i.type)==="json_schema"&&!e.stream?await this.client.responses.parse(e,n):await this.client.responses.create(e,n)}catch(a){throw hp(a)}})}async betaParsedCompletionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.beta.chat.completions.parse(e,n)}catch(s){throw hp(s)}})}_getClientOptions(e){if(!this.client){const n={baseURL:this.clientConfig.baseURL},s=tz(n),i={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new le(i)}return{...this.clientConfig,...e}}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,n)=>(n&&n.tokenUsage&&(t.tokenUsage.completionTokens+=n.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=n.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=n.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let n,s,i,a;cz(e)?(n=e.schema,s=e.name,i=e.method,a=e.includeRaw):(n=e,s=t==null?void 0:t.name,i=t==null?void 0:t.method,a=t==null?void 0:t.includeRaw);let o,l;if((t==null?void 0:t.strict)!==void 0&&i==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"?i===void 0&&(i="jsonSchema"):i==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`),i==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),Nc(n)?l=Du.fromZodSchema(n):l=new Fu;else if(i==="jsonSchema")if(o=this.bind({response_format:{type:"json_schema",json_schema:{name:s??"extract",description:n.description,schema:n,strict:t==null?void 0:t.strict}}}),Nc(n)){const h=Du.fromZodSchema(n);l=ni.from(f=>"parsed"in f.additional_kwargs?f.additional_kwargs.parsed:h)}else l=new Fu;else{let h=s??"extract";if(Nc(n)){const f=fs(n);o=this.bind({tools:[{type:"function",function:{name:h,description:f.description,parameters:f}}],tool_choice:{type:"function",function:{name:h}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),l=new Bu({returnSingle:!0,keyName:h,zodSchema:n})}else{let f;typeof n.name=="string"&&typeof n.parameters=="object"&&n.parameters!=null?(f=n,h=n.name):(h=n.title??h,f={name:h,description:n.description??"",parameters:n}),o=this.bind({tools:[{type:"function",function:f}],tool_choice:{type:"function",function:{name:h}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),l=new Bu({returnSingle:!0,keyName:h})}}if(!a)return o.pipe(l);const c=ps.assign({parsed:(h,f)=>l.invoke(h.raw,f)}),u=ps.assign({parsed:()=>null}),d=c.withFallbacks({fallbacks:[u]});return $n.from([{raw:o},d])}}function Nc(r){return typeof(r==null?void 0:r.parse)=="function"}function cz(r){return r!==void 0&&typeof r.schema=="object"}class uz extends lz{static lc_name(){return"ChatDeepSeek"}_llmType(){return"deepseek"}get lc_secrets(){return{apiKey:"DEEPSEEK_API_KEY"}}constructor(e){const t=(e==null?void 0:e.apiKey)||Ht("DEEPSEEK_API_KEY");if(!t)throw new Error('Deepseek API key not found. Please set the DEEPSEEK_API_KEY environment variable or pass the key into "apiKey" field.');super({...e,apiKey:t,configuration:{baseURL:"https://api.deepseek.com",...e==null?void 0:e.configuration}}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models","deepseek"]})}_convertOpenAIDeltaToBaseMessageChunk(e,t,n){const s=super._convertOpenAIDeltaToBaseMessageChunk(e,t,n);return s.additional_kwargs.reasoning_content=e.reasoning_content,s}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){const n=super._convertOpenAIChatCompletionMessageToBaseMessage(e,t);return n.additional_kwargs.reasoning_content=e.reasoning_content,n}withStructuredOutput(e,t){const n={...t};return(n==null?void 0:n.method)===void 0&&(n.method="functionCalling"),super.withStructuredOutput(e,n)}}const xm={provider:"openai",model:"gpt-3.5-turbo",apiKey:"",temperature:.7,maxTokens:1e3,baseUrl:""},uE=od(xm),km=od([]);function pp(r,e){km.update(t=>[...t,{role:r,content:e,timestamp:new Date}])}function dz(){const r=fx(uE);switch(r.provider){case"openai":return new aB({openAIApiKey:r.apiKey,modelName:r.model,temperature:r.temperature,maxTokens:r.maxTokens,...r.baseUrl?{baseURL:r.baseUrl}:{}});case"anthropic":return new ez({anthropicApiKey:r.apiKey,modelName:r.model,temperature:r.temperature,maxTokens:r.maxTokens});case"deepseek":return new uz({apiKey:r.apiKey,modelName:r.model,temperature:r.temperature,maxTokens:r.maxTokens,...r.baseUrl?{baseURL:r.baseUrl}:{}});default:throw new Error(`Unsupported LLM provider: ${r.provider}`)}}async function hz(r,e=[]){try{const t=dz(),n=e.map(i=>({role:i.role,content:i.content}));return n.push({role:"user",content:r}),(await t.invoke(n)).content}catch(t){throw console.error("Error sending message to LLM:",t),t}}function fz(r){switch(r.provider){case"openai":return["gpt-3.5-turbo","gpt-4","gpt-4-turbo"];case"anthropic":return["claude-3-opus-20240229","claude-3-sonnet-20240229","claude-3-haiku-20240307"];case"deepseek":return["deepseek-reasoner","deepseek-chat","deepseek-coder"];default:return[]}}function pz(){return[{id:"openai",name:"OpenAI"},{id:"anthropic",name:"Anthropic"},{id:"deepseek",name:"Deepseek"}]}/**
 * @license lucide-svelte v0.488.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const mz={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var gz=VA("<svg><!><!></svg>");function Vd(r,e){const t=Ye(e,["children","$$slots","$$events","$$legacy"]),n=Ye(t,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);$t(e,!1);let s=$e(e,"name",8,void 0),i=$e(e,"color",8,"currentColor"),a=$e(e,"size",8,24),o=$e(e,"strokeWidth",8,2),l=$e(e,"absoluteStrokeWidth",8,!1),c=$e(e,"iconNode",24,()=>[]);const u=(...m)=>m.filter((g,_,y)=>!!g&&y.indexOf(g)===_).join(" ");wn();var d=gz();let h;var f=L(d);Tn(f,1,c,Tr,(m,g)=>{let _=()=>P(g)[0],y=()=>P(g)[1];var b=kr(),w=bt(b);t1(w,_,!0,(v,S)=>{let k;De(()=>k=Rr(v,k,{...y()}))}),Z(m,b)});var p=B(f);Vt(p,e,"default",{}),De((m,g)=>h=Rr(d,h,{...mz,...n,width:a(),height:a(),stroke:i(),"stroke-width":m,class:g}),[()=>l()?Number(o())*24/Number(a()):o(),()=>u("lucide-icon","lucide",s()?`lucide-${s()}`:"",t.class)],yn),Z(r,d),Mt()}function _z(r,e){const t=Ye(e,["children","$$slots","$$events","$$legacy"]);Vd(r,ld({name:"loader-circle"},()=>t,{iconNode:[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56"}]],children:(s,i)=>{var a=kr(),o=bt(a);Vt(o,e,"default",{}),Z(s,a)},$$slots:{default:!0}}))}function bz(r,e){const t=Ye(e,["children","$$slots","$$events","$$legacy"]);Vd(r,ld({name:"rotate-ccw"},()=>t,{iconNode:[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}]],children:(s,i)=>{var a=kr(),o=bt(a);Vt(o,e,"default",{}),Z(s,a)},$$slots:{default:!0}}))}function yz(r,e){const t=Ye(e,["children","$$slots","$$events","$$legacy"]);Vd(r,ld({name:"send"},()=>t,{iconNode:[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]],children:(s,i)=>{var a=kr(),o=bt(a);Vt(o,e,"default",{}),Z(s,a)},$$slots:{default:!0}}))}function wz(r,e){const t=Ye(e,["children","$$slots","$$events","$$legacy"]);Vd(r,ld({name:"trash-2"},()=>t,{iconNode:[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]],children:(s,i)=>{var a=kr(),o=bt(a);Vt(o,e,"default",{}),Z(s,a)},$$slots:{default:!0}}))}function l_(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let ri=l_();function dE(r){ri=r}const bo={exec:()=>null};function Te(r,e=""){let t=typeof r=="string"?r:r.source;const n={replace:(s,i)=>{let a=typeof i=="string"?i:i.source;return a=a.replace(Ot.caret,"$1"),t=t.replace(s,a),n},getRegex:()=>new RegExp(t,e)};return n}const Ot={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:r=>new RegExp(`^( {0,3}${r})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}#`),htmlBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}<(?:[a-z].*>|!--)`,"i")},vz=/^(?:[ \t]*(?:\n|$))+/,xz=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,kz=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Il=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Sz=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,c_=/(?:[*+-]|\d{1,9}[.)])/,hE=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,fE=Te(hE).replace(/bull/g,c_).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Pz=Te(hE).replace(/bull/g,c_).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),u_=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Ez=/^[^\n]+/,d_=/(?!\s*\])(?:\\.|[^\[\]\\])+/,Az=Te(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",d_).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Oz=Te(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,c_).getRegex(),Zd="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",h_=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Tz=Te("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",h_).replace("tag",Zd).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),pE=Te(u_).replace("hr",Il).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Zd).getRegex(),Rz=Te(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",pE).getRegex(),f_={blockquote:Rz,code:xz,def:Az,fences:kz,heading:Sz,hr:Il,html:Tz,lheading:fE,list:Oz,newline:vz,paragraph:pE,table:bo,text:Ez},b0=Te("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Il).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Zd).getRegex(),Cz={...f_,lheading:Pz,table:b0,paragraph:Te(u_).replace("hr",Il).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",b0).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Zd).getRegex()},Iz={...f_,html:Te(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",h_).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:bo,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Te(u_).replace("hr",Il).replace("heading",` *#{1,6} *[^
]`).replace("lheading",fE).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},$z=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Mz=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,mE=/^( {2,}|\\)\n(?!\s*$)/,Nz=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Gd=/[\p{P}\p{S}]/u,p_=/[\s\p{P}\p{S}]/u,gE=/[^\s\p{P}\p{S}]/u,Lz=Te(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,p_).getRegex(),_E=/(?!~)[\p{P}\p{S}]/u,jz=/(?!~)[\s\p{P}\p{S}]/u,Dz=/(?:[^\s\p{P}\p{S}]|~)/u,Fz=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,bE=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Bz=Te(bE,"u").replace(/punct/g,Gd).getRegex(),zz=Te(bE,"u").replace(/punct/g,_E).getRegex(),yE="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Uz=Te(yE,"gu").replace(/notPunctSpace/g,gE).replace(/punctSpace/g,p_).replace(/punct/g,Gd).getRegex(),qz=Te(yE,"gu").replace(/notPunctSpace/g,Dz).replace(/punctSpace/g,jz).replace(/punct/g,_E).getRegex(),Wz=Te("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,gE).replace(/punctSpace/g,p_).replace(/punct/g,Gd).getRegex(),Hz=Te(/\\(punct)/,"gu").replace(/punct/g,Gd).getRegex(),Vz=Te(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Zz=Te(h_).replace("(?:-->|$)","-->").getRegex(),Gz=Te("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Zz).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Zu=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,Jz=Te(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",Zu).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),wE=Te(/^!?\[(label)\]\[(ref)\]/).replace("label",Zu).replace("ref",d_).getRegex(),vE=Te(/^!?\[(ref)\](?:\[\])?/).replace("ref",d_).getRegex(),Kz=Te("reflink|nolink(?!\\()","g").replace("reflink",wE).replace("nolink",vE).getRegex(),m_={_backpedal:bo,anyPunctuation:Hz,autolink:Vz,blockSkip:Fz,br:mE,code:Mz,del:bo,emStrongLDelim:Bz,emStrongRDelimAst:Uz,emStrongRDelimUnd:Wz,escape:$z,link:Jz,nolink:vE,punctuation:Lz,reflink:wE,reflinkSearch:Kz,tag:Gz,text:Nz,url:bo},Xz={...m_,link:Te(/^!?\[(label)\]\((.*?)\)/).replace("label",Zu).getRegex(),reflink:Te(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Zu).getRegex()},Sm={...m_,emStrongRDelimAst:qz,emStrongLDelim:zz,url:Te(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},Yz={...Sm,br:Te(mE).replace("{2,}","*").getRegex(),text:Te(Sm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Lc={normal:f_,gfm:Cz,pedantic:Iz},ja={normal:m_,gfm:Sm,breaks:Yz,pedantic:Xz},Qz={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},y0=r=>Qz[r];function Zn(r,e){if(e){if(Ot.escapeTest.test(r))return r.replace(Ot.escapeReplace,y0)}else if(Ot.escapeTestNoEncode.test(r))return r.replace(Ot.escapeReplaceNoEncode,y0);return r}function w0(r){try{r=encodeURI(r).replace(Ot.percentDecode,"%")}catch{return null}return r}function v0(r,e){var i;const t=r.replace(Ot.findPipe,(a,o,l)=>{let c=!1,u=o;for(;--u>=0&&l[u]==="\\";)c=!c;return c?"|":" |"}),n=t.split(Ot.splitPipe);let s=0;if(n[0].trim()||n.shift(),n.length>0&&!((i=n.at(-1))!=null&&i.trim())&&n.pop(),e)if(n.length>e)n.splice(e);else for(;n.length<e;)n.push("");for(;s<n.length;s++)n[s]=n[s].trim().replace(Ot.slashPipe,"|");return n}function Da(r,e,t){const n=r.length;if(n===0)return"";let s=0;for(;s<n&&r.charAt(n-s-1)===e;)s++;return r.slice(0,n-s)}function eU(r,e){if(r.indexOf(e[1])===-1)return-1;let t=0;for(let n=0;n<r.length;n++)if(r[n]==="\\")n++;else if(r[n]===e[0])t++;else if(r[n]===e[1]&&(t--,t<0))return n;return-1}function x0(r,e,t,n,s){const i=e.href,a=e.title||null,o=r[1].replace(s.other.outputLinkReplace,"$1");if(r[0].charAt(0)!=="!"){n.state.inLink=!0;const l={type:"link",raw:t,href:i,title:a,text:o,tokens:n.inlineTokens(o)};return n.state.inLink=!1,l}return{type:"image",raw:t,href:i,title:a,text:o}}function tU(r,e,t){const n=r.match(t.other.indentCodeCompensation);if(n===null)return e;const s=n[1];return e.split(`
`).map(i=>{const a=i.match(t.other.beginningSpace);if(a===null)return i;const[o]=a;return o.length>=s.length?i.slice(s.length):i}).join(`
`)}class Gu{constructor(e){M(this,"options");M(this,"rules");M(this,"lexer");this.options=e||ri}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const n=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?n:Da(n,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const n=t[0],s=tU(n,t[3]||"",this.rules);return{type:"code",raw:n,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:s}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let n=t[2].trim();if(this.rules.other.endingHash.test(n)){const s=Da(n,"#");(this.options.pedantic||!s||this.rules.other.endingSpaceChar.test(s))&&(n=s.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:Da(t[0],`
`)}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){let n=Da(t[0],`
`).split(`
`),s="",i="";const a=[];for(;n.length>0;){let o=!1;const l=[];let c;for(c=0;c<n.length;c++)if(this.rules.other.blockquoteStart.test(n[c]))l.push(n[c]),o=!0;else if(!o)l.push(n[c]);else break;n=n.slice(c);const u=l.join(`
`),d=u.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");s=s?`${s}
${u}`:u,i=i?`${i}
${d}`:d;const h=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(d,a,!0),this.lexer.state.top=h,n.length===0)break;const f=a.at(-1);if((f==null?void 0:f.type)==="code")break;if((f==null?void 0:f.type)==="blockquote"){const p=f,m=p.raw+`
`+n.join(`
`),g=this.blockquote(m);a[a.length-1]=g,s=s.substring(0,s.length-p.raw.length)+g.raw,i=i.substring(0,i.length-p.text.length)+g.text;break}else if((f==null?void 0:f.type)==="list"){const p=f,m=p.raw+`
`+n.join(`
`),g=this.list(m);a[a.length-1]=g,s=s.substring(0,s.length-f.raw.length)+g.raw,i=i.substring(0,i.length-p.raw.length)+g.raw,n=m.substring(a.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:s,tokens:a,text:i}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n=t[1].trim();const s=n.length>1,i={type:"list",raw:"",ordered:s,start:s?+n.slice(0,-1):"",loose:!1,items:[]};n=s?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=s?n:"[*+-]");const a=this.rules.other.listItemRegex(n);let o=!1;for(;e;){let c=!1,u="",d="";if(!(t=a.exec(e))||this.rules.block.hr.test(e))break;u=t[0],e=e.substring(u.length);let h=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,y=>" ".repeat(3*y.length)),f=e.split(`
`,1)[0],p=!h.trim(),m=0;if(this.options.pedantic?(m=2,d=h.trimStart()):p?m=t[1].length+1:(m=t[2].search(this.rules.other.nonSpaceChar),m=m>4?1:m,d=h.slice(m),m+=t[1].length),p&&this.rules.other.blankLine.test(f)&&(u+=f+`
`,e=e.substring(f.length+1),c=!0),!c){const y=this.rules.other.nextBulletRegex(m),b=this.rules.other.hrRegex(m),w=this.rules.other.fencesBeginRegex(m),v=this.rules.other.headingBeginRegex(m),S=this.rules.other.htmlBeginRegex(m);for(;e;){const k=e.split(`
`,1)[0];let x;if(f=k,this.options.pedantic?(f=f.replace(this.rules.other.listReplaceNesting,"  "),x=f):x=f.replace(this.rules.other.tabCharGlobal,"    "),w.test(f)||v.test(f)||S.test(f)||y.test(f)||b.test(f))break;if(x.search(this.rules.other.nonSpaceChar)>=m||!f.trim())d+=`
`+x.slice(m);else{if(p||h.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||w.test(h)||v.test(h)||b.test(h))break;d+=`
`+f}!p&&!f.trim()&&(p=!0),u+=k+`
`,e=e.substring(k.length+1),h=x.slice(m)}}i.loose||(o?i.loose=!0:this.rules.other.doubleBlankLine.test(u)&&(o=!0));let g=null,_;this.options.gfm&&(g=this.rules.other.listIsTask.exec(d),g&&(_=g[0]!=="[ ] ",d=d.replace(this.rules.other.listReplaceTask,""))),i.items.push({type:"list_item",raw:u,task:!!g,checked:_,loose:!1,text:d,tokens:[]}),i.raw+=u}const l=i.items.at(-1);if(l)l.raw=l.raw.trimEnd(),l.text=l.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let c=0;c<i.items.length;c++)if(this.lexer.state.top=!1,i.items[c].tokens=this.lexer.blockTokens(i.items[c].text,[]),!i.loose){const u=i.items[c].tokens.filter(h=>h.type==="space"),d=u.length>0&&u.some(h=>this.rules.other.anyLine.test(h.raw));i.loose=d}if(i.loose)for(let c=0;c<i.items.length;c++)i.items[c].loose=!0;return i}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){const t=this.rules.block.def.exec(e);if(t){const n=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),s=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:n,raw:t[0],href:s,title:i}}}table(e){var o;const t=this.rules.block.table.exec(e);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;const n=v0(t[1]),s=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=(o=t[3])!=null&&o.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],a={type:"table",raw:t[0],header:[],align:[],rows:[]};if(n.length===s.length){for(const l of s)this.rules.other.tableAlignRight.test(l)?a.align.push("right"):this.rules.other.tableAlignCenter.test(l)?a.align.push("center"):this.rules.other.tableAlignLeft.test(l)?a.align.push("left"):a.align.push(null);for(let l=0;l<n.length;l++)a.header.push({text:n[l],tokens:this.lexer.inline(n[l]),header:!0,align:a.align[l]});for(const l of i)a.rows.push(v0(l,a.header.length).map((c,u)=>({text:c,tokens:this.lexer.inline(c),header:!1,align:a.align[u]})));return a}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const n=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:n,tokens:this.lexer.inline(n)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const n=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;const a=Da(n.slice(0,-1),"\\");if((n.length-a.length)%2===0)return}else{const a=eU(t[2],"()");if(a>-1){const l=(t[0].indexOf("!")===0?5:4)+t[1].length+a;t[2]=t[2].substring(0,a),t[0]=t[0].substring(0,l).trim(),t[3]=""}}let s=t[2],i="";if(this.options.pedantic){const a=this.rules.other.pedanticHrefTitle.exec(s);a&&(s=a[1],i=a[3])}else i=t[3]?t[3].slice(1,-1):"";return s=s.trim(),this.rules.other.startAngleBracket.test(s)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?s=s.slice(1):s=s.slice(1,-1)),x0(t,{href:s&&s.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){const s=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=t[s.toLowerCase()];if(!i){const a=n[0].charAt(0);return{type:"text",raw:a,text:a}}return x0(n,i,n[0],this.lexer,this.rules)}}emStrong(e,t,n=""){let s=this.rules.inline.emStrongLDelim.exec(e);if(!s||s[3]&&n.match(this.rules.other.unicodeAlphaNumeric))return;if(!(s[1]||s[2]||"")||!n||this.rules.inline.punctuation.exec(n)){const a=[...s[0]].length-1;let o,l,c=a,u=0;const d=s[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(d.lastIndex=0,t=t.slice(-1*e.length+a);(s=d.exec(t))!=null;){if(o=s[1]||s[2]||s[3]||s[4]||s[5]||s[6],!o)continue;if(l=[...o].length,s[3]||s[4]){c+=l;continue}else if((s[5]||s[6])&&a%3&&!((a+l)%3)){u+=l;continue}if(c-=l,c>0)continue;l=Math.min(l,l+c+u);const h=[...s[0]][0].length,f=e.slice(0,a+s.index+h+l);if(Math.min(a,l)%2){const m=f.slice(1,-1);return{type:"em",raw:f,text:m,tokens:this.lexer.inlineTokens(m)}}const p=f.slice(2,-2);return{type:"strong",raw:f,text:p,tokens:this.lexer.inlineTokens(p)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let n=t[2].replace(this.rules.other.newLineCharGlobal," ");const s=this.rules.other.nonSpaceChar.test(n),i=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return s&&i&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:t[0],text:n}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let n,s;return t[2]==="@"?(n=t[1],s="mailto:"+n):(n=t[1],s=n),{type:"link",raw:t[0],text:n,href:s,tokens:[{type:"text",raw:n,text:n}]}}}url(e){var n;let t;if(t=this.rules.inline.url.exec(e)){let s,i;if(t[2]==="@")s=t[0],i="mailto:"+s;else{let a;do a=t[0],t[0]=((n=this.rules.inline._backpedal.exec(t[0]))==null?void 0:n[0])??"";while(a!==t[0]);s=t[0],t[1]==="www."?i="http://"+t[0]:i=t[0]}return{type:"link",raw:t[0],text:s,href:i,tokens:[{type:"text",raw:s,text:s}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){const n=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:n}}}}class mn{constructor(e){M(this,"tokens");M(this,"options");M(this,"state");M(this,"tokenizer");M(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||ri,this.options.tokenizer=this.options.tokenizer||new Gu,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={other:Ot,block:Lc.normal,inline:ja.normal};this.options.pedantic?(t.block=Lc.pedantic,t.inline=ja.pedantic):this.options.gfm&&(t.block=Lc.gfm,this.options.breaks?t.inline=ja.breaks:t.inline=ja.gfm),this.tokenizer.rules=t}static get rules(){return{block:Lc,inline:ja}}static lex(e,t){return new mn(t).lex(e)}static lexInline(e,t){return new mn(t).inlineTokens(e)}lex(e){e=e.replace(Ot.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){const n=this.inlineQueue[t];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],n=!1){var s,i,a;for(this.options.pedantic&&(e=e.replace(Ot.tabCharGlobal,"    ").replace(Ot.spaceLine,""));e;){let o;if((i=(s=this.options.extensions)==null?void 0:s.block)!=null&&i.some(c=>(o=c.call({lexer:this},e,t))?(e=e.substring(o.raw.length),t.push(o),!0):!1))continue;if(o=this.tokenizer.space(e)){e=e.substring(o.raw.length);const c=t.at(-1);o.raw.length===1&&c!==void 0?c.raw+=`
`:t.push(o);continue}if(o=this.tokenizer.code(e)){e=e.substring(o.raw.length);const c=t.at(-1);(c==null?void 0:c.type)==="paragraph"||(c==null?void 0:c.type)==="text"?(c.raw+=`
`+o.raw,c.text+=`
`+o.text,this.inlineQueue.at(-1).src=c.text):t.push(o);continue}if(o=this.tokenizer.fences(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.heading(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.hr(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.blockquote(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.list(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.html(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.def(e)){e=e.substring(o.raw.length);const c=t.at(-1);(c==null?void 0:c.type)==="paragraph"||(c==null?void 0:c.type)==="text"?(c.raw+=`
`+o.raw,c.text+=`
`+o.raw,this.inlineQueue.at(-1).src=c.text):this.tokens.links[o.tag]||(this.tokens.links[o.tag]={href:o.href,title:o.title});continue}if(o=this.tokenizer.table(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.lheading(e)){e=e.substring(o.raw.length),t.push(o);continue}let l=e;if((a=this.options.extensions)!=null&&a.startBlock){let c=1/0;const u=e.slice(1);let d;this.options.extensions.startBlock.forEach(h=>{d=h.call({lexer:this},u),typeof d=="number"&&d>=0&&(c=Math.min(c,d))}),c<1/0&&c>=0&&(l=e.substring(0,c+1))}if(this.state.top&&(o=this.tokenizer.paragraph(l))){const c=t.at(-1);n&&(c==null?void 0:c.type)==="paragraph"?(c.raw+=`
`+o.raw,c.text+=`
`+o.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=c.text):t.push(o),n=l.length!==e.length,e=e.substring(o.raw.length);continue}if(o=this.tokenizer.text(e)){e=e.substring(o.raw.length);const c=t.at(-1);(c==null?void 0:c.type)==="text"?(c.raw+=`
`+o.raw,c.text+=`
`+o.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=c.text):t.push(o);continue}if(e){const c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){var o,l,c;let n=e,s=null;if(this.tokens.links){const u=Object.keys(this.tokens.links);if(u.length>0)for(;(s=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)u.includes(s[0].slice(s[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(s=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,s.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(s=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)n=n.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let i=!1,a="";for(;e;){i||(a=""),i=!1;let u;if((l=(o=this.options.extensions)==null?void 0:o.inline)!=null&&l.some(h=>(u=h.call({lexer:this},e,t))?(e=e.substring(u.raw.length),t.push(u),!0):!1))continue;if(u=this.tokenizer.escape(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.tag(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.link(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(u.raw.length);const h=t.at(-1);u.type==="text"&&(h==null?void 0:h.type)==="text"?(h.raw+=u.raw,h.text+=u.text):t.push(u);continue}if(u=this.tokenizer.emStrong(e,n,a)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.codespan(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.br(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.del(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.autolink(e)){e=e.substring(u.raw.length),t.push(u);continue}if(!this.state.inLink&&(u=this.tokenizer.url(e))){e=e.substring(u.raw.length),t.push(u);continue}let d=e;if((c=this.options.extensions)!=null&&c.startInline){let h=1/0;const f=e.slice(1);let p;this.options.extensions.startInline.forEach(m=>{p=m.call({lexer:this},f),typeof p=="number"&&p>=0&&(h=Math.min(h,p))}),h<1/0&&h>=0&&(d=e.substring(0,h+1))}if(u=this.tokenizer.inlineText(d)){e=e.substring(u.raw.length),u.raw.slice(-1)!=="_"&&(a=u.raw.slice(-1)),i=!0;const h=t.at(-1);(h==null?void 0:h.type)==="text"?(h.raw+=u.raw,h.text+=u.text):t.push(u);continue}if(e){const h="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(h);break}else throw new Error(h)}}return t}}class Ju{constructor(e){M(this,"options");M(this,"parser");this.options=e||ri}space(e){return""}code({text:e,lang:t,escaped:n}){var a;const s=(a=(t||"").match(Ot.notSpaceStart))==null?void 0:a[0],i=e.replace(Ot.endingNewline,"")+`
`;return s?'<pre><code class="language-'+Zn(s)+'">'+(n?i:Zn(i,!0))+`</code></pre>
`:"<pre><code>"+(n?i:Zn(i,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){const t=e.ordered,n=e.start;let s="";for(let o=0;o<e.items.length;o++){const l=e.items[o];s+=this.listitem(l)}const i=t?"ol":"ul",a=t&&n!==1?' start="'+n+'"':"";return"<"+i+a+`>
`+s+"</"+i+`>
`}listitem(e){var n;let t="";if(e.task){const s=this.checkbox({checked:!!e.checked});e.loose?((n=e.tokens[0])==null?void 0:n.type)==="paragraph"?(e.tokens[0].text=s+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=s+" "+Zn(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:s+" ",text:s+" ",escaped:!0}):t+=s+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",n="";for(let i=0;i<e.header.length;i++)n+=this.tablecell(e.header[i]);t+=this.tablerow({text:n});let s="";for(let i=0;i<e.rows.length;i++){const a=e.rows[i];n="";for(let o=0;o<a.length;o++)n+=this.tablecell(a[o]);s+=this.tablerow({text:n})}return s&&(s=`<tbody>${s}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+s+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){const t=this.parser.parseInline(e.tokens),n=e.header?"th":"td";return(e.align?`<${n} align="${e.align}">`:`<${n}>`)+t+`</${n}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${Zn(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:n}){const s=this.parser.parseInline(n),i=w0(e);if(i===null)return s;e=i;let a='<a href="'+e+'"';return t&&(a+=' title="'+Zn(t)+'"'),a+=">"+s+"</a>",a}image({href:e,title:t,text:n}){const s=w0(e);if(s===null)return Zn(n);e=s;let i=`<img src="${e}" alt="${n}"`;return t&&(i+=` title="${Zn(t)}"`),i+=">",i}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:Zn(e.text)}}class g_{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}}class gn{constructor(e){M(this,"options");M(this,"renderer");M(this,"textRenderer");this.options=e||ri,this.options.renderer=this.options.renderer||new Ju,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new g_}static parse(e,t){return new gn(t).parse(e)}static parseInline(e,t){return new gn(t).parseInline(e)}parse(e,t=!0){var s,i;let n="";for(let a=0;a<e.length;a++){const o=e[a];if((i=(s=this.options.extensions)==null?void 0:s.renderers)!=null&&i[o.type]){const c=o,u=this.options.extensions.renderers[c.type].call({parser:this},c);if(u!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(c.type)){n+=u||"";continue}}const l=o;switch(l.type){case"space":{n+=this.renderer.space(l);continue}case"hr":{n+=this.renderer.hr(l);continue}case"heading":{n+=this.renderer.heading(l);continue}case"code":{n+=this.renderer.code(l);continue}case"table":{n+=this.renderer.table(l);continue}case"blockquote":{n+=this.renderer.blockquote(l);continue}case"list":{n+=this.renderer.list(l);continue}case"html":{n+=this.renderer.html(l);continue}case"paragraph":{n+=this.renderer.paragraph(l);continue}case"text":{let c=l,u=this.renderer.text(c);for(;a+1<e.length&&e[a+1].type==="text";)c=e[++a],u+=`
`+this.renderer.text(c);t?n+=this.renderer.paragraph({type:"paragraph",raw:u,text:u,tokens:[{type:"text",raw:u,text:u,escaped:!0}]}):n+=u;continue}default:{const c='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(c),"";throw new Error(c)}}}return n}parseInline(e,t=this.renderer){var s,i;let n="";for(let a=0;a<e.length;a++){const o=e[a];if((i=(s=this.options.extensions)==null?void 0:s.renderers)!=null&&i[o.type]){const c=this.options.extensions.renderers[o.type].call({parser:this},o);if(c!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){n+=c||"";continue}}const l=o;switch(l.type){case"escape":{n+=t.text(l);break}case"html":{n+=t.html(l);break}case"link":{n+=t.link(l);break}case"image":{n+=t.image(l);break}case"strong":{n+=t.strong(l);break}case"em":{n+=t.em(l);break}case"codespan":{n+=t.codespan(l);break}case"br":{n+=t.br(l);break}case"del":{n+=t.del(l);break}case"text":{n+=t.text(l);break}default:{const c='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(c),"";throw new Error(c)}}}return n}}class yo{constructor(e){M(this,"options");M(this,"block");this.options=e||ri}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?mn.lex:mn.lexInline}provideParser(){return this.block?gn.parse:gn.parseInline}}M(yo,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));class nU{constructor(...e){M(this,"defaults",l_());M(this,"options",this.setOptions);M(this,"parse",this.parseMarkdown(!0));M(this,"parseInline",this.parseMarkdown(!1));M(this,"Parser",gn);M(this,"Renderer",Ju);M(this,"TextRenderer",g_);M(this,"Lexer",mn);M(this,"Tokenizer",Gu);M(this,"Hooks",yo);this.use(...e)}walkTokens(e,t){var s,i;let n=[];for(const a of e)switch(n=n.concat(t.call(this,a)),a.type){case"table":{const o=a;for(const l of o.header)n=n.concat(this.walkTokens(l.tokens,t));for(const l of o.rows)for(const c of l)n=n.concat(this.walkTokens(c.tokens,t));break}case"list":{const o=a;n=n.concat(this.walkTokens(o.items,t));break}default:{const o=a;(i=(s=this.defaults.extensions)==null?void 0:s.childTokens)!=null&&i[o.type]?this.defaults.extensions.childTokens[o.type].forEach(l=>{const c=o[l].flat(1/0);n=n.concat(this.walkTokens(c,t))}):o.tokens&&(n=n.concat(this.walkTokens(o.tokens,t)))}}return n}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(n=>{const s={...n};if(s.async=this.defaults.async||s.async||!1,n.extensions&&(n.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){const a=t.renderers[i.name];a?t.renderers[i.name]=function(...o){let l=i.renderer.apply(this,o);return l===!1&&(l=a.apply(this,o)),l}:t.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const a=t[i.level];a?a.unshift(i.tokenizer):t[i.level]=[i.tokenizer],i.start&&(i.level==="block"?t.startBlock?t.startBlock.push(i.start):t.startBlock=[i.start]:i.level==="inline"&&(t.startInline?t.startInline.push(i.start):t.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(t.childTokens[i.name]=i.childTokens)}),s.extensions=t),n.renderer){const i=this.defaults.renderer||new Ju(this.defaults);for(const a in n.renderer){if(!(a in i))throw new Error(`renderer '${a}' does not exist`);if(["options","parser"].includes(a))continue;const o=a,l=n.renderer[o],c=i[o];i[o]=(...u)=>{let d=l.apply(i,u);return d===!1&&(d=c.apply(i,u)),d||""}}s.renderer=i}if(n.tokenizer){const i=this.defaults.tokenizer||new Gu(this.defaults);for(const a in n.tokenizer){if(!(a in i))throw new Error(`tokenizer '${a}' does not exist`);if(["options","rules","lexer"].includes(a))continue;const o=a,l=n.tokenizer[o],c=i[o];i[o]=(...u)=>{let d=l.apply(i,u);return d===!1&&(d=c.apply(i,u)),d}}s.tokenizer=i}if(n.hooks){const i=this.defaults.hooks||new yo;for(const a in n.hooks){if(!(a in i))throw new Error(`hook '${a}' does not exist`);if(["options","block"].includes(a))continue;const o=a,l=n.hooks[o],c=i[o];yo.passThroughHooks.has(a)?i[o]=u=>{if(this.defaults.async)return Promise.resolve(l.call(i,u)).then(h=>c.call(i,h));const d=l.call(i,u);return c.call(i,d)}:i[o]=(...u)=>{let d=l.apply(i,u);return d===!1&&(d=c.apply(i,u)),d}}s.hooks=i}if(n.walkTokens){const i=this.defaults.walkTokens,a=n.walkTokens;s.walkTokens=function(o){let l=[];return l.push(a.call(this,o)),i&&(l=l.concat(i.call(this,o))),l}}this.defaults={...this.defaults,...s}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return mn.lex(e,t??this.defaults)}parser(e,t){return gn.parse(e,t??this.defaults)}parseMarkdown(e){return(n,s)=>{const i={...s},a={...this.defaults,...i},o=this.onError(!!a.silent,!!a.async);if(this.defaults.async===!0&&i.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof n>"u"||n===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof n!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(n)+", string expected"));a.hooks&&(a.hooks.options=a,a.hooks.block=e);const l=a.hooks?a.hooks.provideLexer():e?mn.lex:mn.lexInline,c=a.hooks?a.hooks.provideParser():e?gn.parse:gn.parseInline;if(a.async)return Promise.resolve(a.hooks?a.hooks.preprocess(n):n).then(u=>l(u,a)).then(u=>a.hooks?a.hooks.processAllTokens(u):u).then(u=>a.walkTokens?Promise.all(this.walkTokens(u,a.walkTokens)).then(()=>u):u).then(u=>c(u,a)).then(u=>a.hooks?a.hooks.postprocess(u):u).catch(o);try{a.hooks&&(n=a.hooks.preprocess(n));let u=l(n,a);a.hooks&&(u=a.hooks.processAllTokens(u)),a.walkTokens&&this.walkTokens(u,a.walkTokens);let d=c(u,a);return a.hooks&&(d=a.hooks.postprocess(d)),d}catch(u){return o(u)}}}onError(e,t){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,e){const s="<p>An error occurred:</p><pre>"+Zn(n.message+"",!0)+"</pre>";return t?Promise.resolve(s):s}if(t)return Promise.reject(n);throw n}}}const Ys=new nU;function Ee(r,e){return Ys.parse(r,e)}Ee.options=Ee.setOptions=function(r){return Ys.setOptions(r),Ee.defaults=Ys.defaults,dE(Ee.defaults),Ee};Ee.getDefaults=l_;Ee.defaults=ri;Ee.use=function(...r){return Ys.use(...r),Ee.defaults=Ys.defaults,dE(Ee.defaults),Ee};Ee.walkTokens=function(r,e){return Ys.walkTokens(r,e)};Ee.parseInline=Ys.parseInline;Ee.Parser=gn;Ee.parser=gn.parse;Ee.Renderer=Ju;Ee.TextRenderer=g_;Ee.Lexer=mn;Ee.lexer=mn.lex;Ee.Tokenizer=Gu;Ee.Hooks=yo;Ee.parse=Ee;Ee.options;Ee.setOptions;Ee.use;Ee.walkTokens;Ee.parseInline;gn.parse;mn.lex;var rU=ie('<div class="flex items-center justify-center text-muted-foreground"><p>å¼å§ä¸ AI å©æå¯¹è¯</p></div>'),sU=ie('<div class="flex items-center gap-2"><div class="self-start shrink-0 w-8 h-8 rounded-full bg-primary flex items-center justify-center text-primary-foreground text-sm"> </div> <div class="flex-1 flex flex-col justify-center"><div class="markdown-content break-words overflow-wrap-anywhere"><!></div></div></div>'),iU=ie('<div class="flex items-center gap-2"><div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center text-primary-foreground">AI</div> <!> <span>æèä¸­...</span></div>'),aU=ie('<div class="space-y-4"><!> <!></div>'),oU=(r,e)=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),e())},lU=ie("<!> åé",1),cU=ie("<!> æ¸ç©º",1),uU=ie('<div class="flex-1 flex flex-col min-h-0 overflow-hidden"><div class="flex-1 overflow-y-auto overflow-x-hidden py-4 min-h-0 border-t"><!></div> <div class="border-t pt-4"><form class="flex gap-2"><div class="flex-1 relative"><textarea placeholder="è¾å¥æ¶æ¯..." class="w-full p-2 border rounded-md resize-none h-full whitespace-pre-wrap break-words overflow-wrap-anywhere"></textarea></div> <div class="flex flex-col gap-2"><!> <!></div></form></div></div>');function dU(r,e){$t(e,!0);const[t,n]=Yi(),s=()=>ul(km,"$chatHistory",t);let i=pn(""),a=pn(!1),o;xo(()=>{o&&setTimeout(()=>{o.scrollTop=o.scrollHeight},0)});async function l(){if(!P(i).trim()||P(a))return;const x=P(i).trim();se(i,""),pp("user",x);try{se(a,!0);const A=await hz(x,s());pp("assistant",A)}catch(A){console.error("Error in chat:",A),pp("assistant",`Error: ${A.message}`)}finally{se(a,!1)}}function c(){px(km,[])}function u(x){try{return Ee.setOptions({gfm:!0,breaks:!0,mangle:!1,sanitize:!1,smartLists:!0,smartypants:!0,xhtml:!1}),Ee.parse(x)}catch(A){return console.error("Error parsing markdown:",A),x}}var d=uU(),h=L(d),f=L(h);{var p=x=>{var A=rU();Z(x,A)},m=x=>{var A=aU(),C=L(A);Tn(C,1,s,Tr,(Y,O)=>{const E=_p(()=>P(O).role==="user"?"bg-muted":"bg-card");Cy(Y,{get class(){return P(E)},children:($,N)=>{Iy($,{class:"p-2",children:(R,F)=>{var V=sU(),ne=L(V),J=L(ne),K=B(ne,2),z=L(K),Q=L(z);e1(Q,()=>u(P(O).content)),De(()=>{nt(J,P(O).role==="user"?"æ":"AI"),Nm(z,`--message-role: ${P(O).role==="user"?"user":"assistant"}`)}),Z(R,V)},$$slots:{default:!0}})},$$slots:{default:!0}})});var I=B(C,2);{var D=Y=>{Cy(Y,{children:(O,E)=>{Iy(O,{class:"p-3",children:($,N)=>{var R=iU(),F=B(L(R),2);_z(F,{class:"h-4 w-4 animate-spin"}),Z($,R)},$$slots:{default:!0}})},$$slots:{default:!0}})};zt(I,Y=>{P(a)&&Y(D)})}Z(x,A)};zt(f,x=>{s().length===0?x(p):x(m,!1)})}Ba(h,x=>o=x,()=>o);var g=B(h,2),_=L(g),y=L(_),b=L(y);b.__keydown=[oU,l];var w=B(y,2),v=L(w);const S=_p(()=>P(a)||!P(i).trim());Eo(v,{type:"submit",get disabled(){return P(S)},children:(x,A)=>{var C=lU(),I=bt(C);yz(I,{class:"h-4 w-4 mr-2"}),Z(x,C)},$$slots:{default:!0}});var k=B(v,2);Eo(k,{type:"button",variant:"outline",$$events:{click:c},children:(x,A)=>{var C=cU(),I=bt(C);wz(I,{class:"h-4 w-4 mr-2"}),Z(x,C)},$$slots:{default:!0}}),an("submit",_,x=>{x.preventDefault(),l()}),ht(b,()=>P(i),x=>se(i,x)),Z(r,d),Mt(),n()}sx(["keydown"]);var hU=ie("<option> </option>"),fU=ie("<option> </option>"),pU=ie("<!> éç½®",1),mU=ie('<div class="space-y-4 py-4"><div class="space-y-2"><h2 class="text-xl font-semibold">LLM éç½®</h2> <p class="text-sm text-muted-foreground">éç½® LLM æä¾ååæ¨¡åè®¾ç½®</p></div> <div class="space-y-4"><div class="space-y-2"><label for="provider" class="text-sm font-medium">æä¾å</label> <select id="provider" class="w-full p-2 border rounded-md"></select></div> <div class="space-y-2"><label for="model" class="text-sm font-medium">æ¨¡å</label> <select id="model" class="w-full p-2 border rounded-md"></select></div> <div class="space-y-2"><label for="apiKey" class="text-sm font-medium">API å¯é¥</label> <input id="apiKey" type="password" placeholder="è¾å¥ API å¯é¥" class="w-full p-2 border rounded-md"></div> <div class="space-y-2"><label for="temperature" class="text-sm font-medium"> </label> <input id="temperature" type="range" min="0" max="1" step="0.1" class="w-full"></div> <div class="space-y-2"><label for="maxTokens" class="text-sm font-medium">æå¤§ Token æ°</label> <input id="maxTokens" type="number" min="1" max="4000" class="w-full p-2 border rounded-md"></div> <div class="space-y-2"><label for="baseUrl" class="text-sm font-medium">èªå®ä¹ API ç«¯ç¹ (å¯é)</label> <input id="baseUrl" type="text" placeholder="https://api.example.com/v1" class="w-full p-2 border rounded-md"></div></div> <div class="flex justify-between"><!></div></div>');function gU(r,e){$t(e,!0);const[t,n]=Yi();let s=pn(Hr(xm));const i=pz();let a=_p(()=>fz(P(s)));function o(){se(s,xm,!0)}xo(()=>{px(uE,P(s)),P(a).includes(P(s).model)||(P(s).model=P(a)[0])});var l=mU(),c=B(L(l),2),u=L(c),d=B(L(u),2);Tn(d,21,()=>i,Tr,(C,I)=>{var D=hU(),Y={},O=L(D);De(()=>{Y!==(Y=P(I).id)&&(D.value=(D.__value=P(I).id)??""),nt(O,P(I).name)}),Z(C,D)});var h=B(u,2),f=B(L(h),2);Tn(f,21,()=>P(a),Tr,(C,I)=>{var D=fU(),Y={},O=L(D);De(()=>{Y!==(Y=P(I))&&(D.value=(D.__value=P(I))??""),nt(O,P(I))}),Z(C,D)});var p=B(h,2),m=B(L(p),2),g=B(p,2),_=L(g),y=L(_),b=B(_,2),w=B(g,2),v=B(L(w),2),S=B(w,2),k=B(L(S),2),x=B(c,2),A=L(x);Eo(A,{variant:"outline",$$events:{click:o},children:(C,I)=>{var D=pU(),Y=bt(D);bz(Y,{class:"h-4 w-4 mr-2"}),Z(C,D)},$$slots:{default:!0}}),De(()=>nt(y,`æ¸©åº¦ (${P(s).temperature??""})`)),Po(d,()=>P(s).provider,C=>P(s).provider=C),Po(f,()=>P(s).model,C=>P(s).model=C),ht(m,()=>P(s).apiKey,C=>P(s).apiKey=C),ht(b,()=>P(s).temperature,C=>P(s).temperature=C),ht(v,()=>P(s).maxTokens,C=>P(s).maxTokens=C),ht(k,()=>P(s).baseUrl,C=>P(s).baseUrl=C),Z(r,l),Mt(),n()}var _U=ie("<div><!></div>");function bU(r,e){const t=Ye(e,["children","$$slots","$$events","$$legacy"]),n=Ye(t,["class","value","defaultValue","activateOnFocus"]);$t(e,!1);let s=$e(e,"class",8,""),i=$e(e,"value",8,void 0),a=$e(e,"defaultValue",8,void 0),o=$e(e,"activateOnFocus",8,!0);const l=gx(),c=od(i()??a());mA("tabs",{selectedTabValue:c,activateOnFocus:o(),onSelectedTabValueChange:f=>{c.set(f),l("change",f)}}),td(()=>cl(i()),()=>{i()!==void 0&&c.set(i())}),nd(),wn();var u=_U();let d;var h=L(u);Vt(h,e,"default",{}),De(f=>d=Rr(u,d,{class:f,...n}),[()=>Qs("",s())],yn),Z(r,u),Mt()}var yU=ie("<div><!></div>");function wU(r,e){const t=Ye(e,["children","$$slots","$$events","$$legacy"]),n=Ye(t,["class"]);$t(e,!1);let s=$e(e,"class",8,"");wn();var i=yU();let a;var o=L(i);Vt(o,e,"default",{}),De(l=>a=Rr(i,a,{class:l,role:"tablist",...n}),[()=>Qs("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s())],yn),Z(r,i),Mt()}var vU=ie("<button><!></button>");function jc(r,e){const t=Ye(e,["children","$$slots","$$events","$$legacy"]),n=Ye(t,["class","value","disabled"]);$t(e,!1);const[s,i]=Yi(),a=()=>ul(u,"$selectedTabValue",s);let o=$e(e,"class",8,""),l=$e(e,"value",8),c=$e(e,"disabled",8,!1);const{selectedTabValue:u,activateOnFocus:d,onSelectedTabValueChange:h}=M0("tabs");let f=ze();function p(){c()||h(l())}function m(w){(w.key===" "||w.key==="Enter")&&(w.preventDefault(),p())}function g(){d&&!c()&&h(l())}td(()=>(a(),cl(l())),()=>{se(f,a()===l())}),nd(),wn();var _=vU();let y;var b=L(_);Vt(b,e,"default",{}),De(w=>y=Rr(_,y,{type:"button",role:"tab","aria-selected":P(f),"aria-controls":`${l()}-tab`,"data-state":P(f)?"active":"inactive",disabled:c(),tabindex:P(f)?0:-1,class:w,...n}),[()=>Qs("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",P(f)?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-current",o())],yn),an("click",_,p),an("keydown",_,m),an("focus",_,g),Z(r,_),Mt(),i()}var xU=ie("<div><!></div>");function Dc(r,e){const t=Ye(e,["children","$$slots","$$events","$$legacy"]),n=Ye(t,["class","value"]);$t(e,!1);const[s,i]=Yi(),a=()=>ul(c,"$selectedTabValue",s);let o=$e(e,"class",8,""),l=$e(e,"value",8);const{selectedTabValue:c}=M0("tabs");let u=ze();td(()=>(a(),cl(l())),()=>{se(u,a()===l())}),nd(),wn();var d=xU();let h;var f=L(d);Vt(f,e,"default",{}),De(p=>h=Rr(d,h,{role:"tabpanel",id:`${l()}-tab`,"aria-labelledby":`${l()}-trigger`,tabindex:0,class:p,...n}),[()=>Qs("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",P(u)?"flex":"hidden",o())],yn),Z(r,d),Mt(),i()}var kU=ie('<div slot="left" class="h-full flex-1 flex flex-col min-h-0 overflow-hidden"><div class="border-b p-4 flex-none"><h2 class="text-xl font-semibold">éé</h2> <p class="text-sm text-muted-foreground">æ¥çåç®¡çä¿¡å·éé</p></div> <div class="flex-1 min-h-0 overflow-hidden flex"><!></div></div>'),SU=ie("<!> <!> <!> <!>",1),PU=ie("<!> <!> <!> <!> <!>",1),EU=ie('<div slot="right" class="h-full flex-1 flex flex-col min-h-0 overflow-hidden"><div class="border-b p-4 flex-none"><h2 class="text-xl font-semibold">ä¿¡å·æä½</h2> <p class="text-sm text-muted-foreground">çæåå¤çä¿¡å·</p></div> <div class="flex-1 p-4 flex flex-col min-h-0 overflow-hidden"><!></div></div>'),AU=ie('<div class="h-screen bg-background flex flex-col overflow-hidden"><header class="border-b flex-none"><div class="container py-4"><h1 class="text-3xl font-bold tracking-tight">ä¿¡å·åæå¨</h1> <p class="text-muted-foreground">çæãå¤çååæä¿¡å·</p></div></header> <main class="flex-1 flex flex-col overflow-hidden min-h-0"><div class="flex-1 flex flex-col min-h-0 overflow-hidden"><!></div></main></div>');function OU(r){let e=pn(void 0);var t=AU(),n=B(L(t),2),s=L(n),i=L(s);Ok(i,{initialLeftWidth:65,minLeftWidth:30,maxLeftWidth:80,$$slots:{left:(a,o)=>{var l=kU(),c=B(L(l),2),u=L(c);W$(u,{get selectedChannelId(){return P(e)},set selectedChannelId(d){se(e,d,!0)}}),Z(a,l)},right:(a,o)=>{var l=EU(),c=B(L(l),2),u=L(c);bU(u,{defaultValue:"generate",class:"flex-1 flex flex-col min-h-0 overflow-hidden",children:(d,h)=>{var f=PU(),p=bt(f);wU(p,{class:"grid grid-cols-4",children:(b,w)=>{var v=SU(),S=bt(v);jc(S,{value:"generate",children:(C,I)=>{var D=Is("çæä¿¡å·");Z(C,D)},$$slots:{default:!0}});var k=B(S,2);jc(k,{value:"process",children:(C,I)=>{var D=Is("å¤çä¿¡å·");Z(C,D)},$$slots:{default:!0}});var x=B(k,2);jc(x,{value:"chat",children:(C,I)=>{var D=Is("AI å©æ");Z(C,D)},$$slots:{default:!0}});var A=B(x,2);jc(A,{value:"config",children:(C,I)=>{var D=Is("LLM éç½®");Z(C,D)},$$slots:{default:!0}}),Z(b,v)},$$slots:{default:!0}});var m=B(p,2);Dc(m,{value:"generate",class:"mt-2 flex-1 flex-col min-h-0 overflow-auto",children:(b,w)=>{oO(b,{})},$$slots:{default:!0}});var g=B(m,2);Dc(g,{value:"process",class:"mt-2 flex-1 flex-col min-h-0 overflow-auto",children:(b,w)=>{SO(b,{get selectedChannelId(){return P(e)},set selectedChannelId(v){se(e,v,!0)}})},$$slots:{default:!0}});var _=B(g,2);Dc(_,{value:"chat",class:"mt-2 flex-1 flex-col min-h-0 overflow-hidden",children:(b,w)=>{dU(b,{})},$$slots:{default:!0}});var y=B(_,2);Dc(y,{value:"config",class:"mt-2 flex-1 flex-col min-h-0 overflow-auto",children:(b,w)=>{gU(b,{})},$$slots:{default:!0}}),Z(d,f)},$$slots:{default:!0}}),Z(a,l)}}}),Z(r,t)}ZA(OU,{target:document.getElementById("app")});
