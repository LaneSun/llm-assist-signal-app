var ME=Object.defineProperty;var NE=Object.getPrototypeOf;var LE=Reflect.get;var wy=r=>{throw TypeError(r)};var jE=(r,e,t)=>e in r?ME(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var M=(r,e,t)=>jE(r,typeof e!="symbol"?e+"":e,t),vf=(r,e,t)=>e.has(r)||wy("Cannot "+t);var F=(r,e,t)=>(vf(r,e,"read from private field"),t?t.call(r):e.get(r)),ye=(r,e,t)=>e.has(r)?wy("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),Qa=(r,e,t,n)=>(vf(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),Us=(r,e,t)=>(vf(r,e,"access private method"),t);var vy=(r,e,t)=>LE(NE(r),t,e);import{b as Bm,e as DE,c as Fe,a as q,t as pe,d as ni,n as _k}from"../chunks/d9qGaLUB.js";import{ah as yk,au as wk,av as FE,I as oa,h as et,C as db,B as vk,H as Pa,b as hb,j as A,a0 as hc,K as zE,L as xy,M as oi,c as kr,al as BE,N as fb,a as wh,O as xk,aw as kk,ao as Sk,V as nn,aa as qr,ax as xf,R as UE,F as Um,ay as pb,az as qE,aA as mb,aB as ky,aC as HE,ad as WE,aD as VE,d as gb,aE as GE,aj as Pk,am as ZE,ak as JE,E as KE,aF as XE,aG as YE,aH as QE,aI as eO,aJ as tO,aK as nO,g as vh,Q as bb,P as Ak,aL as rO,W as de,aM as sO,as as Ek,p as at,o as ke,q as ot,s as B,n as Rn,v as z,t as Ue,w as V,aN as qm,aO as Jn,aP as iO,aQ as aO,k as oO,ar as rn,a3 as xh,at as ze,u as lO,f as Os,aR as cO,aS as Sy,aT as uO}from"../chunks/ixtH5zbp.js";import{i as kh}from"../chunks/D0-JovLt.js";import{i as dO,a as hO,c as fO,d as pO,b as mO,n as gO,e as bO,f as _O,l as _b,g as la,s as yt,o as ms,r as yO}from"../chunks/C7W07q0B.js";import{p as se,i as Qe,b as es,r as Tt,s as Sh,a as Ph,d as Ir,c as fc,l as Aa,e as Ok}from"../chunks/CYpfN_IN.js";import{w as yb,o as Tk,a as wO,g as wb}from"../chunks/ZhjlL-g9.js";import{s as kt}from"../chunks/CCtTOmwb.js";const vO=[];function xO(r,e=!1){return Ku(r,new Map,"",vO)}function Ku(r,e,t,n,s=null){if(typeof r=="object"&&r!==null){var i=e.get(r);if(i!==void 0)return i;if(r instanceof Map)return new Map(r);if(r instanceof Set)return new Set(r);if(yk(r)){var a=Array(r.length);e.set(r,a),s!==null&&e.set(s,a);for(var o=0;o<r.length;o+=1){var l=r[o];o in r&&(a[o]=Ku(l,e,t,n))}return a}if(wk(r)===FE){a={},e.set(r,a),s!==null&&e.set(s,a);for(var c in r)a[c]=Ku(r[c],e,t,n);return a}if(r instanceof Date)return structuredClone(r);if(typeof r.toJSON=="function")return Ku(r.toJSON(),e,t,n,r)}if(r instanceof EventTarget)return r;try{return structuredClone(r)}catch{return r}}function Er(r,e){return e}function kO(r,e,t,n){for(var s=[],i=e.length,a=0;a<i;a++)HE(e[a].e,s,!0);var o=i>0&&s.length===0&&t!==null;if(o){var l=t.parentNode;WE(l),l.append(t),n.clear(),gs(r,e[0].prev,e[i-1].next)}VE(s,()=>{for(var c=0;c<i;c++){var u=e[c];o||(n.delete(u.k),gs(r,u.prev,u.next)),gb(u.e,!o)}})}function jn(r,e,t,n,s,i=null){var a=r,o={flags:e,items:new Map,first:null},l=(e&kk)!==0;if(l){var c=r;a=et?oa(db(c)):c.appendChild(vk())}et&&Pa();var u=null,d=!1,h=hc(()=>{var f=t();return yk(f)?f:f==null?[]:Sk(f)});hb(()=>{var f=A(h),p=f.length;if(d&&p===0)return;d=p===0;let m=!1;if(et){var g=a.data===zE;g!==(p===0)&&(a=xy(),oa(a),oi(!1),m=!0)}if(et){for(var b=null,_,y=0;y<p;y++){if(kr.nodeType===8&&kr.data===BE){a=kr,m=!0,oi(!1);break}var w=f[y],v=n(w,y);_=Rk(kr,o,b,null,w,v,y,s,e,t),o.items.set(v,_),b=_}p>0&&oa(xy())}et||SO(f,o,a,s,e,n,t),i!==null&&(p===0?u?fb(u):u=wh(()=>i(a)):u!==null&&xk(u,()=>{u=null})),m&&oi(!0),A(h)}),et&&(a=kr)}function SO(r,e,t,n,s,i,a){var P,E,O,I;var o=(s&qE)!==0,l=(s&(mb|pb))!==0,c=r.length,u=e.items,d=e.first,h=d,f,p=null,m,g=[],b=[],_,y,w,v;if(o)for(v=0;v<c;v+=1)_=r[v],y=i(_,v),w=u.get(y),w!==void 0&&((P=w.a)==null||P.measure(),(m??(m=new Set)).add(w));for(v=0;v<c;v+=1){if(_=r[v],y=i(_,v),w=u.get(y),w===void 0){var x=h?h.e.nodes_start:t;p=Rk(x,e,p,p===null?e.first:p.next,_,y,v,n,s,a),u.set(y,p),g=[],b=[],h=p.next;continue}if(l&&PO(w,_,v,s),(w.e.f&xf)!==0&&(fb(w.e),o&&((E=w.a)==null||E.unfix(),(m??(m=new Set)).delete(w))),w!==h){if(f!==void 0&&f.has(w)){if(g.length<b.length){var S=b[0],k;p=S.prev;var R=g[0],D=g[g.length-1];for(k=0;k<g.length;k+=1)Py(g[k],S,t);for(k=0;k<b.length;k+=1)f.delete(b[k]);gs(e,R.prev,D.next),gs(e,p,R),gs(e,D,S),h=S,p=D,v-=1,g=[],b=[]}else f.delete(w),Py(w,h,t),gs(e,w.prev,w.next),gs(e,w,p===null?e.first:p.next),gs(e,p,w),p=w;continue}for(g=[],b=[];h!==null&&h.k!==y;)(h.e.f&xf)===0&&(f??(f=new Set)).add(h),b.push(h),h=h.next;if(h===null)continue;w=h}g.push(w),p=w,h=w.next}if(h!==null||f!==void 0){for(var C=f===void 0?[]:Sk(f);h!==null;)(h.e.f&xf)===0&&C.push(h),h=h.next;var N=C.length;if(N>0){var $=(s&kk)!==0&&c===0?t:null;if(o){for(v=0;v<N;v+=1)(O=C[v].a)==null||O.measure();for(v=0;v<N;v+=1)(I=C[v].a)==null||I.fix()}kO(e,C,$,u)}}o&&UE(()=>{var T;if(m!==void 0)for(w of m)(T=w.a)==null||T.apply()}),Um.first=e.first&&e.first.e,Um.last=p&&p.e}function PO(r,e,t,n){(n&mb)!==0&&ky(r.v,e),(n&pb)!==0?ky(r.i,t):r.i=t}function Rk(r,e,t,n,s,i,a,o,l,c){var u=(l&mb)!==0,d=(l&GE)===0,h=u?d?nn(s):qr(s):s,f=(l&pb)===0?a:qr(a),p={i:f,v:h,k:i,a:null,e:null,prev:t,next:n};try{return p.e=wh(()=>o(r,h,f,c),et),p.e.prev=t&&t.e,p.e.next=n&&n.e,t===null?e.first=p:(t.next=p,t.e.next=p.e),n!==null&&(n.prev=p,n.e.prev=p.e),p}finally{}}function Py(r,e,t){for(var n=r.next?r.next.e.nodes_start:t,s=e?e.e.nodes_start:t,i=r.e.nodes_start;i!==n;){var a=Pk(i);s.before(i),i=a}}function gs(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function AO(r,e,t,n,s){var i=r,a="",o;hb(()=>{if(a===(a=e()??"")){et&&Pa();return}o!==void 0&&(gb(o),o=void 0),a!==""&&(o=wh(()=>{if(et){kr.data;for(var l=Pa(),c=l;l!==null&&(l.nodeType!==8||l.data!=="");)c=l,l=Pk(l);if(l===null)throw ZE(),JE;Bm(kr,c),i=oa(l);return}var u=a+"",d=DE(u);Bm(db(d),d.lastChild),i.before(d)}))})}function pc(r,e,t,n,s){var o;et&&Pa();var i=(o=e.$$slots)==null?void 0:o[t],a=!1;i===!0&&(i=e.children,a=!0),i===void 0||i(r,a?()=>n:n)}function Ik(r,e,t,n,s,i){let a=et;et&&Pa();var o,l,c=null;et&&kr.nodeType===1&&(c=kr,Pa());var u=et?kr:r,d;hb(()=>{const h=e()||null;var f=XE;h!==o&&(d&&(h===null?xk(d,()=>{d=null,l=null}):h===l?fb(d):gb(d)),h&&h!==l&&(d=wh(()=>{if(c=et?c:document.createElementNS(f,h),Bm(c,c),n){et&&dO(h)&&c.append(document.createComment(""));var p=et?db(c):c.appendChild(vk());et&&(p===null?oi(!1):oa(p)),n(c,p)}Um.nodes_end=c,u.before(c)})),o=h,o&&(l=o))},KE),a&&(oi(!0),oa(u))}function Ck(r){var e,t,n="";if(typeof r=="string"||typeof r=="number")n+=r;else if(typeof r=="object")if(Array.isArray(r)){var s=r.length;for(e=0;e<s;e++)r[e]&&(t=Ck(r[e]))&&(n&&(n+=" "),n+=t)}else for(t in r)r[t]&&(n&&(n+=" "),n+=t);return n}function Zo(){for(var r,e,t=0,n="",s=arguments.length;t<s;t++)(r=arguments[t])&&(e=Ck(r))&&(n&&(n+=" "),n+=e);return n}function EO(r){return typeof r=="object"?Zo(r):r??""}const Ay=[...` 	
\r\fÂ \v\uFEFF`];function OO(r,e,t){var n=r==null?"":""+r;if(t){for(var s in t)if(t[s])n=n?n+" "+s:s;else if(n.length)for(var i=s.length,a=0;(a=n.indexOf(s,a))>=0;){var o=a+i;(a===0||Ay.includes(n[a-1]))&&(o===n.length||Ay.includes(n[o]))?n=(a===0?"":n.substring(0,a))+n.substring(o+1):a=o}}return n===""?null:n}function Ey(r,e=!1){var t=e?" !important;":";",n="";for(var s in r){var i=r[s];i!=null&&i!==""&&(n+=" "+s+": "+i+t)}return n}function kf(r){return r[0]!=="-"||r[1]!=="-"?r.toLowerCase():r}function TO(r,e){if(e){var t="",n,s;if(Array.isArray(e)?(n=e[0],s=e[1]):n=e,r){r=String(r).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var i=!1,a=0,o=!1,l=[];n&&l.push(...Object.keys(n).map(kf)),s&&l.push(...Object.keys(s).map(kf));var c=0,u=-1;const m=r.length;for(var d=0;d<m;d++){var h=r[d];if(o?h==="/"&&r[d-1]==="*"&&(o=!1):i?i===h&&(i=!1):h==="/"&&r[d+1]==="*"?o=!0:h==='"'||h==="'"?i=h:h==="("?a++:h===")"&&a--,!o&&i===!1&&a===0){if(h===":"&&u===-1)u=d;else if(h===";"||d===m-1){if(u!==-1){var f=kf(r.substring(c,u).trim());if(!l.includes(f)){h!==";"&&d++;var p=r.substring(c,d).trim();t+=" "+p+";"}}c=d+1,u=-1}}}}return n&&(t+=Ey(n)),s&&(t+=Ey(s,!0)),t=t.trim(),t===""?null:t}return r==null?null:String(r)}function vb(r,e,t,n,s,i){var a=r.__className;if(et||a!==t||a===void 0){var o=OO(t,n,i);(!et||o!==r.getAttribute("class"))&&(o==null?r.removeAttribute("class"):e?r.className=o:r.setAttribute("class",o)),r.__className=t}else if(i&&s!==i)for(var l in i){var c=!!i[l];(s==null||c!==!!s[l])&&r.classList.toggle(l,c)}return i}function Sf(r,e={},t,n){for(var s in t){var i=t[s];e[s]!==i&&(t[s]==null?r.style.removeProperty(s):r.style.setProperty(s,i,n))}}function RO(r,e,t,n){var s=r.__style;if(et||s!==e){var i=TO(e,n);(!et||i!==r.getAttribute("style"))&&(i==null?r.removeAttribute("style"):r.style.cssText=i),r.__style=e}else n&&(Array.isArray(n)?(Sf(r,t==null?void 0:t[0],n[0]),Sf(r,t==null?void 0:t[1],n[1],"important")):Sf(r,t,n));return n}const eo=Symbol("class"),to=Symbol("style"),$k=Symbol("is custom element"),Mk=Symbol("is html");function Oy(r){if(et){var e=!1,t=()=>{if(!e){if(e=!0,r.hasAttribute("value")){var n=r.value;li(r,"value",null),r.value=n}if(r.hasAttribute("checked")){var s=r.checked;li(r,"checked",null),r.checked=s}}};r.__on_r=t,eO(t),bO()}}function IO(r,e){e?r.hasAttribute("selected")||r.setAttribute("selected",""):r.removeAttribute("selected")}function li(r,e,t,n){var s=Nk(r);et&&(s[e]=r.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&r.nodeName==="LINK")||s[e]!==(s[e]=t)&&(e==="loading"&&(r[QE]=t),t==null?r.removeAttribute(e):typeof t!="string"&&Lk(r).includes(e)?r[e]=t:r.setAttribute(e,t))}function jt(r,e,t,n,s=!1){var i=Nk(r),a=i[$k],o=!i[Mk];let l=et&&a;l&&oi(!1);var c=e||{},u=r.tagName==="OPTION";for(var d in e)d in t||(t[d]=null);t.class?t.class=EO(t.class):t[eo]&&(t.class=null),t[to]&&(t.style??(t.style=null));var h=Lk(r);for(const y in t){let w=t[y];if(u&&y==="value"&&w==null){r.value=r.__value="",c[y]=w;continue}if(y==="class"){var f=r.namespaceURI==="http://www.w3.org/1999/xhtml";vb(r,f,w,n,e==null?void 0:e[eo],t[eo]),c[y]=w,c[eo]=t[eo];continue}if(y==="style"){RO(r,w,e==null?void 0:e[to],t[to]),c[y]=w,c[to]=t[to];continue}var p=c[y];if(w!==p){c[y]=w;var m=y[0]+y[1];if(m!=="$$")if(m==="on"){const v={},x="$$"+y;let S=y.slice(2);var g=_O(S);if(hO(S)&&(S=S.slice(0,-7),v.capture=!0),!g&&p){if(w!=null)continue;r.removeEventListener(S,c[x],v),c[x]=null}if(w!=null)if(g)r[`__${S}`]=w,pO([S]);else{let k=function(R){c[y].call(this,R)};c[x]=fO(S,r,k,v)}else g&&(r[`__${S}`]=void 0)}else if(y==="style")li(r,y,w);else if(y==="autofocus")mO(r,!!w);else if(!a&&(y==="__value"||y==="value"&&w!=null))r.value=r.__value=w;else if(y==="selected"&&u)IO(r,w);else{var b=y;o||(b=gO(b));var _=b==="defaultValue"||b==="defaultChecked";if(w==null&&!a&&!_)if(i[y]=null,b==="value"||b==="checked"){let v=r;const x=e===void 0;if(b==="value"){let S=v.defaultValue;v.removeAttribute(b),v.defaultValue=S,v.value=v.__value=x?S:null}else{let S=v.defaultChecked;v.removeAttribute(b),v.defaultChecked=S,v.checked=x?S:!1}}else r.removeAttribute(y);else _||h.includes(b)&&(a||typeof w!="string")?r[b]=w:typeof w!="function"&&li(r,b,w)}}}return l&&oi(!0),c}function Nk(r){return r.__attributes??(r.__attributes={[$k]:r.nodeName.includes("-"),[Mk]:r.namespaceURI===YE})}var Ty=new Map;function Lk(r){var e=Ty.get(r.nodeName);if(e)return e;Ty.set(r.nodeName,e=[]);for(var t,n=r,s=Element.prototype;s!==n;){t=tO(n);for(var i in t)t[i].set&&e.push(i);n=wk(n)}return e}function Hm(r,e,t=e){var n=nO();_b(r,"input",s=>{var i=s?r.defaultValue:r.value;if(i=Pf(r)?Af(i):i,t(i),n&&i!==(i=e())){var a=r.selectionStart,o=r.selectionEnd;r.value=i??"",o!==null&&(r.selectionStart=a,r.selectionEnd=Math.min(o,r.value.length))}}),(et&&r.defaultValue!==r.value||vh(e)==null&&r.value)&&t(Pf(r)?Af(r.value):r.value),bb(()=>{var s=e();Pf(r)&&s===Af(r.value)||r.type==="date"&&!s&&!r.value||s!==r.value&&(r.value=s??"")})}function Pf(r){var e=r.type;return e==="number"||e==="range"}function Af(r){return r===""?null:+r}function CO(r,e,t=e){_b(r,"change",()=>{t(r.files)}),et&&r.files&&t(r.files),bb(()=>{r.files=e()})}function jk(r,e,t){if(r.multiple)return MO(r,e);for(var n of r.options){var s=Jo(n);if(rO(s,e)){n.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function $O(r,e){Ak(()=>{var t=new MutationObserver(()=>{var n=r.__value;jk(r,n)});return t.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{t.disconnect()}})}function dl(r,e,t=e){var n=!0;_b(r,"change",s=>{var i=s?"[selected]":":checked",a;if(r.multiple)a=[].map.call(r.querySelectorAll(i),Jo);else{var o=r.querySelector(i)??r.querySelector("option:not([disabled])");a=o&&Jo(o)}t(a)}),Ak(()=>{var s=e();if(jk(r,s,n),n&&s===void 0){var i=r.querySelector(":checked");i!==null&&(s=Jo(i),t(s))}r.__value=s,n=!1}),$O(r)}function MO(r,e){for(var t of r.options)t.selected=~e.indexOf(Jo(t))}function Jo(r){return"__value"in r?r.__value:r.value}function Vi(r){de(r,r.v+1)}function NO(r){let e=0,t=qr(0),n;return()=>{sO()&&(A(t),bb(()=>(e===0&&(n=vh(()=>r(()=>Vi(t)))),e+=1,()=>{Ek().then(()=>{e-=1,e===0&&(n==null||n(),n=void 0)})})))}}class LO{constructor(e,t=[],n=1e3){this.id=crypto.randomUUID(),this.name=e,this.data=t,this.sampleRate=n,this.createdAt=new Date,this.updatedAt=new Date,this.sourceChannelIds=[],this.processingMethod=null}getStats(){if(this.data.length===0)return{length:0,min:0,max:0,mean:0,rms:0,duration:0};const e=Math.min(...this.data),t=Math.max(...this.data),s=this.data.reduce((l,c)=>l+c,0)/this.data.length,i=this.data.reduce((l,c)=>l+c*c,0),a=Math.sqrt(i/this.data.length),o=this.data.length/this.sampleRate;return{length:this.data.length,min:e,max:t,mean:s,rms:a,duration:o}}updateData(e,t=null,n=[]){this.data=e,this.updatedAt=new Date,t&&(this.processingMethod=t),n.length>0&&(this.sourceChannelIds=n)}}const Na=yb([]);function xb(r,e=[],t=1e3){const n=new LO(r,e,t);return Na.update(s=>[...s,n]),n}function Wm(r){let e=null;return Na.subscribe(t=>{e=t.find(n=>n.id===r)})(),e}function jO(r){let e=!1;return Na.update(t=>{const n=t.length,s=t.filter(i=>i.id!==r);return e=s.length<n,s}),e}function Dk(r,e,t,n={}){const s=Wm(r);if(!s)return null;const i=e(s.data,...Object.values(n)),a=xb(t,i,s.sampleRate);return a.processingMethod=e.name,a.sourceChannelIds=[r],a}function Vm(r,e,t=1,n=1e3,s=0){const i=[];for(let a=0;a<r;a++){const o=a/n;i.push(t*Math.sin(2*Math.PI*e*o+s))}return i}function Gm(r,e,t=1,n=1e3,s=.5){const i=[],a=n/e;for(let o=0;o<r;o++){const l=o%a;i.push(l<a*s?t:-t)}return i}function Zm(r,e,t=1,n=1e3){const s=[],i=n/e;for(let a=0;a<r;a++){const l=a%i/i;let c;l<.5?c=2*l:c=2*(1-l),s.push(t*(2*c-1))}return s}function Jm(r,e,t=1,n=1e3){const s=[],i=n/e;for(let a=0;a<r;a++){const l=a%i/i;s.push(t*(2*l-1))}return s}function Km(r,e=1){const t=[];for(let n=0;n<r;n++)t.push(e*(2*Math.random()-1));return t}function Xm(r,e,t=1,n=1){const s=new Array(r).fill(0);for(let i=0;i<t;i++){const a=e+i;a>=0&&a<r&&(s[a]=n)}return s}var Ry=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,pn=r=>!r||typeof r!="object"||Object.keys(r).length===0,DO=(r,e)=>JSON.stringify(r)===JSON.stringify(e);function Fk(r,e){r.forEach(function(t){Array.isArray(t)?Fk(t,e):e.push(t)})}function zk(r){let e=[];return Fk(r,e),e}var Bk=(...r)=>zk(r).filter(Boolean),Uk=(r,e)=>{let t={},n=Object.keys(r),s=Object.keys(e);for(let i of n)if(s.includes(i)){let a=r[i],o=e[i];Array.isArray(a)||Array.isArray(o)?t[i]=Bk(o,a):typeof a=="object"&&typeof o=="object"?t[i]=Uk(a,o):t[i]=o+" "+a}else t[i]=r[i];for(let i of s)n.includes(i)||(t[i]=e[i]);return t},Iy=r=>!r||typeof r!="string"?r:r.replace(/\s+/g," ").trim();const kb="-",FO=r=>{const e=BO(r),{conflictingClassGroups:t,conflictingClassGroupModifiers:n}=r;return{getClassGroupId:a=>{const o=a.split(kb);return o[0]===""&&o.length!==1&&o.shift(),qk(o,e)||zO(a)},getConflictingClassGroupIds:(a,o)=>{const l=t[a]||[];return o&&n[a]?[...l,...n[a]]:l}}},qk=(r,e)=>{var a;if(r.length===0)return e.classGroupId;const t=r[0],n=e.nextPart.get(t),s=n?qk(r.slice(1),n):void 0;if(s)return s;if(e.validators.length===0)return;const i=r.join(kb);return(a=e.validators.find(({validator:o})=>o(i)))==null?void 0:a.classGroupId},Cy=/^\[(.+)\]$/,zO=r=>{if(Cy.test(r)){const e=Cy.exec(r)[1],t=e==null?void 0:e.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},BO=r=>{const{theme:e,classGroups:t}=r,n={nextPart:new Map,validators:[]};for(const s in t)Ym(t[s],n,s,e);return n},Ym=(r,e,t,n)=>{r.forEach(s=>{if(typeof s=="string"){const i=s===""?e:$y(e,s);i.classGroupId=t;return}if(typeof s=="function"){if(UO(s)){Ym(s(n),e,t,n);return}e.validators.push({validator:s,classGroupId:t});return}Object.entries(s).forEach(([i,a])=>{Ym(a,$y(e,i),t,n)})})},$y=(r,e)=>{let t=r;return e.split(kb).forEach(n=>{t.nextPart.has(n)||t.nextPart.set(n,{nextPart:new Map,validators:[]}),t=t.nextPart.get(n)}),t},UO=r=>r.isThemeGetter,qO=r=>{if(r<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,n=new Map;const s=(i,a)=>{t.set(i,a),e++,e>r&&(e=0,n=t,t=new Map)};return{get(i){let a=t.get(i);if(a!==void 0)return a;if((a=n.get(i))!==void 0)return s(i,a),a},set(i,a){t.has(i)?t.set(i,a):s(i,a)}}},Qm="!",eg=":",HO=eg.length,WO=r=>{const{prefix:e,experimentalParseClassName:t}=r;let n=s=>{const i=[];let a=0,o=0,l=0,c;for(let p=0;p<s.length;p++){let m=s[p];if(a===0&&o===0){if(m===eg){i.push(s.slice(l,p)),l=p+HO;continue}if(m==="/"){c=p;continue}}m==="["?a++:m==="]"?a--:m==="("?o++:m===")"&&o--}const u=i.length===0?s:s.substring(l),d=VO(u),h=d!==u,f=c&&c>l?c-l:void 0;return{modifiers:i,hasImportantModifier:h,baseClassName:d,maybePostfixModifierPosition:f}};if(e){const s=e+eg,i=n;n=a=>a.startsWith(s)?i(a.substring(s.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:a,maybePostfixModifierPosition:void 0}}if(t){const s=n;n=i=>t({className:i,parseClassName:s})}return n},VO=r=>r.endsWith(Qm)?r.substring(0,r.length-1):r.startsWith(Qm)?r.substring(1):r,GO=r=>{const e=Object.fromEntries(r.orderSensitiveModifiers.map(n=>[n,!0]));return n=>{if(n.length<=1)return n;const s=[];let i=[];return n.forEach(a=>{a[0]==="["||e[a]?(s.push(...i.sort(),a),i=[]):i.push(a)}),s.push(...i.sort()),s}},ZO=r=>({cache:qO(r.cacheSize),parseClassName:WO(r),sortModifiers:GO(r),...FO(r)}),JO=/\s+/,KO=(r,e)=>{const{parseClassName:t,getClassGroupId:n,getConflictingClassGroupIds:s,sortModifiers:i}=e,a=[],o=r.trim().split(JO);let l="";for(let c=o.length-1;c>=0;c-=1){const u=o[c],{isExternal:d,modifiers:h,hasImportantModifier:f,baseClassName:p,maybePostfixModifierPosition:m}=t(u);if(d){l=u+(l.length>0?" "+l:l);continue}let g=!!m,b=n(g?p.substring(0,m):p);if(!b){if(!g){l=u+(l.length>0?" "+l:l);continue}if(b=n(p),!b){l=u+(l.length>0?" "+l:l);continue}g=!1}const _=i(h).join(":"),y=f?_+Qm:_,w=y+b;if(a.includes(w))continue;a.push(w);const v=s(b,g);for(let x=0;x<v.length;++x){const S=v[x];a.push(y+S)}l=u+(l.length>0?" "+l:l)}return l};function XO(){let r=0,e,t,n="";for(;r<arguments.length;)(e=arguments[r++])&&(t=Hk(e))&&(n&&(n+=" "),n+=t);return n}const Hk=r=>{if(typeof r=="string")return r;let e,t="";for(let n=0;n<r.length;n++)r[n]&&(e=Hk(r[n]))&&(t&&(t+=" "),t+=e);return t};function tg(r,...e){let t,n,s,i=a;function a(l){const c=e.reduce((u,d)=>d(u),r());return t=ZO(c),n=t.cache.get,s=t.cache.set,i=o,o(l)}function o(l){const c=n(l);if(c)return c;const u=KO(l,t);return s(l,u),u}return function(){return i(XO.apply(null,arguments))}}const Rt=r=>{const e=t=>t[r]||[];return e.isThemeGetter=!0,e},Wk=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,Vk=/^\((?:(\w[\w-]*):)?(.+)\)$/i,YO=/^\d+\/\d+$/,QO=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,eT=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,tT=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,nT=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,rT=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,$i=r=>YO.test(r),Le=r=>!!r&&!Number.isNaN(Number(r)),qs=r=>!!r&&Number.isInteger(Number(r)),My=r=>r.endsWith("%")&&Le(r.slice(0,-1)),as=r=>QO.test(r),sT=()=>!0,iT=r=>eT.test(r)&&!tT.test(r),Sb=()=>!1,aT=r=>nT.test(r),oT=r=>rT.test(r),lT=r=>!ie(r)&&!ae(r),cT=r=>La(r,Jk,Sb),ie=r=>Wk.test(r),Hs=r=>La(r,Kk,iT),Ef=r=>La(r,wT,Le),uT=r=>La(r,Gk,Sb),dT=r=>La(r,Zk,oT),hT=r=>La(r,Sb,aT),ae=r=>Vk.test(r),Uc=r=>ja(r,Kk),fT=r=>ja(r,vT),pT=r=>ja(r,Gk),mT=r=>ja(r,Jk),gT=r=>ja(r,Zk),bT=r=>ja(r,xT,!0),La=(r,e,t)=>{const n=Wk.exec(r);return n?n[1]?e(n[1]):t(n[2]):!1},ja=(r,e,t=!1)=>{const n=Vk.exec(r);return n?n[1]?e(n[1]):t:!1},Gk=r=>r==="position",_T=new Set(["image","url"]),Zk=r=>_T.has(r),yT=new Set(["length","size","percentage"]),Jk=r=>yT.has(r),Kk=r=>r==="length",wT=r=>r==="number",vT=r=>r==="family-name",xT=r=>r==="shadow",ng=()=>{const r=Rt("color"),e=Rt("font"),t=Rt("text"),n=Rt("font-weight"),s=Rt("tracking"),i=Rt("leading"),a=Rt("breakpoint"),o=Rt("container"),l=Rt("spacing"),c=Rt("radius"),u=Rt("shadow"),d=Rt("inset-shadow"),h=Rt("drop-shadow"),f=Rt("blur"),p=Rt("perspective"),m=Rt("aspect"),g=Rt("ease"),b=Rt("animate"),_=()=>["auto","avoid","all","avoid-page","page","left","right","column"],y=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],w=()=>["auto","hidden","clip","visible","scroll"],v=()=>["auto","contain","none"],x=()=>[ae,ie,l],S=()=>[$i,"full","auto",...x()],k=()=>[qs,"none","subgrid",ae,ie],R=()=>["auto",{span:["full",qs,ae,ie]},ae,ie],D=()=>[qs,"auto",ae,ie],C=()=>["auto","min","max","fr",ae,ie],N=()=>["start","end","center","between","around","evenly","stretch","baseline"],$=()=>["start","end","center","stretch"],P=()=>["auto",...x()],E=()=>[$i,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...x()],O=()=>[r,ae,ie],I=()=>[My,Hs],T=()=>["","none","full",c,ae,ie],j=()=>["",Le,Uc,Hs],W=()=>["solid","dashed","dotted","double"],ee=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Z=()=>["","none",f,ae,ie],X=()=>["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ae,ie],U=()=>["none",Le,ae,ie],G=()=>["none",Le,ae,ie],le=()=>[Le,ae,ie],he=()=>[$i,"full",...x()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[as],breakpoint:[as],color:[sT],container:[as],"drop-shadow":[as],ease:["in","out","in-out"],font:[lT],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[as],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[as],shadow:[as],spacing:["px",Le],text:[as],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",$i,ie,ae,m]}],container:["container"],columns:[{columns:[Le,ie,ae,o]}],"break-after":[{"break-after":_()}],"break-before":[{"break-before":_()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...y(),ie,ae]}],overflow:[{overflow:w()}],"overflow-x":[{"overflow-x":w()}],"overflow-y":[{"overflow-y":w()}],overscroll:[{overscroll:v()}],"overscroll-x":[{"overscroll-x":v()}],"overscroll-y":[{"overscroll-y":v()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:S()}],"inset-x":[{"inset-x":S()}],"inset-y":[{"inset-y":S()}],start:[{start:S()}],end:[{end:S()}],top:[{top:S()}],right:[{right:S()}],bottom:[{bottom:S()}],left:[{left:S()}],visibility:["visible","invisible","collapse"],z:[{z:[qs,"auto",ae,ie]}],basis:[{basis:[$i,"full","auto",o,...x()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Le,$i,"auto","initial","none",ie]}],grow:[{grow:["",Le,ae,ie]}],shrink:[{shrink:["",Le,ae,ie]}],order:[{order:[qs,"first","last","none",ae,ie]}],"grid-cols":[{"grid-cols":k()}],"col-start-end":[{col:R()}],"col-start":[{"col-start":D()}],"col-end":[{"col-end":D()}],"grid-rows":[{"grid-rows":k()}],"row-start-end":[{row:R()}],"row-start":[{"row-start":D()}],"row-end":[{"row-end":D()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":C()}],"auto-rows":[{"auto-rows":C()}],gap:[{gap:x()}],"gap-x":[{"gap-x":x()}],"gap-y":[{"gap-y":x()}],"justify-content":[{justify:[...N(),"normal"]}],"justify-items":[{"justify-items":[...$(),"normal"]}],"justify-self":[{"justify-self":["auto",...$()]}],"align-content":[{content:["normal",...N()]}],"align-items":[{items:[...$(),"baseline"]}],"align-self":[{self:["auto",...$(),"baseline"]}],"place-content":[{"place-content":N()}],"place-items":[{"place-items":[...$(),"baseline"]}],"place-self":[{"place-self":["auto",...$()]}],p:[{p:x()}],px:[{px:x()}],py:[{py:x()}],ps:[{ps:x()}],pe:[{pe:x()}],pt:[{pt:x()}],pr:[{pr:x()}],pb:[{pb:x()}],pl:[{pl:x()}],m:[{m:P()}],mx:[{mx:P()}],my:[{my:P()}],ms:[{ms:P()}],me:[{me:P()}],mt:[{mt:P()}],mr:[{mr:P()}],mb:[{mb:P()}],ml:[{ml:P()}],"space-x":[{"space-x":x()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":x()}],"space-y-reverse":["space-y-reverse"],size:[{size:E()}],w:[{w:[o,"screen",...E()]}],"min-w":[{"min-w":[o,"screen","none",...E()]}],"max-w":[{"max-w":[o,"screen","none","prose",{screen:[a]},...E()]}],h:[{h:["screen",...E()]}],"min-h":[{"min-h":["screen","none",...E()]}],"max-h":[{"max-h":["screen",...E()]}],"font-size":[{text:["base",t,Uc,Hs]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[n,ae,Ef]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",My,ie]}],"font-family":[{font:[fT,ie,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[s,ae,ie]}],"line-clamp":[{"line-clamp":[Le,"none",ae,Ef]}],leading:[{leading:[i,...x()]}],"list-image":[{"list-image":["none",ae,ie]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",ae,ie]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:O()}],"text-color":[{text:O()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...W(),"wavy"]}],"text-decoration-thickness":[{decoration:[Le,"from-font","auto",ae,Hs]}],"text-decoration-color":[{decoration:O()}],"underline-offset":[{"underline-offset":[Le,"auto",ae,ie]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:x()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ae,ie]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ae,ie]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...y(),pT,uT]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","space","round"]}]}],"bg-size":[{bg:["auto","cover","contain",mT,cT]}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},qs,ae,ie],radial:["",ae,ie],conic:[qs,ae,ie]},gT,dT]}],"bg-color":[{bg:O()}],"gradient-from-pos":[{from:I()}],"gradient-via-pos":[{via:I()}],"gradient-to-pos":[{to:I()}],"gradient-from":[{from:O()}],"gradient-via":[{via:O()}],"gradient-to":[{to:O()}],rounded:[{rounded:T()}],"rounded-s":[{"rounded-s":T()}],"rounded-e":[{"rounded-e":T()}],"rounded-t":[{"rounded-t":T()}],"rounded-r":[{"rounded-r":T()}],"rounded-b":[{"rounded-b":T()}],"rounded-l":[{"rounded-l":T()}],"rounded-ss":[{"rounded-ss":T()}],"rounded-se":[{"rounded-se":T()}],"rounded-ee":[{"rounded-ee":T()}],"rounded-es":[{"rounded-es":T()}],"rounded-tl":[{"rounded-tl":T()}],"rounded-tr":[{"rounded-tr":T()}],"rounded-br":[{"rounded-br":T()}],"rounded-bl":[{"rounded-bl":T()}],"border-w":[{border:j()}],"border-w-x":[{"border-x":j()}],"border-w-y":[{"border-y":j()}],"border-w-s":[{"border-s":j()}],"border-w-e":[{"border-e":j()}],"border-w-t":[{"border-t":j()}],"border-w-r":[{"border-r":j()}],"border-w-b":[{"border-b":j()}],"border-w-l":[{"border-l":j()}],"divide-x":[{"divide-x":j()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":j()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...W(),"hidden","none"]}],"divide-style":[{divide:[...W(),"hidden","none"]}],"border-color":[{border:O()}],"border-color-x":[{"border-x":O()}],"border-color-y":[{"border-y":O()}],"border-color-s":[{"border-s":O()}],"border-color-e":[{"border-e":O()}],"border-color-t":[{"border-t":O()}],"border-color-r":[{"border-r":O()}],"border-color-b":[{"border-b":O()}],"border-color-l":[{"border-l":O()}],"divide-color":[{divide:O()}],"outline-style":[{outline:[...W(),"none","hidden"]}],"outline-offset":[{"outline-offset":[Le,ae,ie]}],"outline-w":[{outline:["",Le,Uc,Hs]}],"outline-color":[{outline:[r]}],shadow:[{shadow:["","none",u,bT,hT]}],"shadow-color":[{shadow:O()}],"inset-shadow":[{"inset-shadow":["none",ae,ie,d]}],"inset-shadow-color":[{"inset-shadow":O()}],"ring-w":[{ring:j()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:O()}],"ring-offset-w":[{"ring-offset":[Le,Hs]}],"ring-offset-color":[{"ring-offset":O()}],"inset-ring-w":[{"inset-ring":j()}],"inset-ring-color":[{"inset-ring":O()}],opacity:[{opacity:[Le,ae,ie]}],"mix-blend":[{"mix-blend":[...ee(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":ee()}],filter:[{filter:["","none",ae,ie]}],blur:[{blur:Z()}],brightness:[{brightness:[Le,ae,ie]}],contrast:[{contrast:[Le,ae,ie]}],"drop-shadow":[{"drop-shadow":["","none",h,ae,ie]}],grayscale:[{grayscale:["",Le,ae,ie]}],"hue-rotate":[{"hue-rotate":[Le,ae,ie]}],invert:[{invert:["",Le,ae,ie]}],saturate:[{saturate:[Le,ae,ie]}],sepia:[{sepia:["",Le,ae,ie]}],"backdrop-filter":[{"backdrop-filter":["","none",ae,ie]}],"backdrop-blur":[{"backdrop-blur":Z()}],"backdrop-brightness":[{"backdrop-brightness":[Le,ae,ie]}],"backdrop-contrast":[{"backdrop-contrast":[Le,ae,ie]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Le,ae,ie]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Le,ae,ie]}],"backdrop-invert":[{"backdrop-invert":["",Le,ae,ie]}],"backdrop-opacity":[{"backdrop-opacity":[Le,ae,ie]}],"backdrop-saturate":[{"backdrop-saturate":[Le,ae,ie]}],"backdrop-sepia":[{"backdrop-sepia":["",Le,ae,ie]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":x()}],"border-spacing-x":[{"border-spacing-x":x()}],"border-spacing-y":[{"border-spacing-y":x()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",ae,ie]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Le,"initial",ae,ie]}],ease:[{ease:["linear","initial",g,ae,ie]}],delay:[{delay:[Le,ae,ie]}],animate:[{animate:["none",b,ae,ie]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[p,ae,ie]}],"perspective-origin":[{"perspective-origin":X()}],rotate:[{rotate:U()}],"rotate-x":[{"rotate-x":U()}],"rotate-y":[{"rotate-y":U()}],"rotate-z":[{"rotate-z":U()}],scale:[{scale:G()}],"scale-x":[{"scale-x":G()}],"scale-y":[{"scale-y":G()}],"scale-z":[{"scale-z":G()}],"scale-3d":["scale-3d"],skew:[{skew:le()}],"skew-x":[{"skew-x":le()}],"skew-y":[{"skew-y":le()}],transform:[{transform:[ae,ie,"","none","gpu","cpu"]}],"transform-origin":[{origin:X()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:he()}],"translate-x":[{"translate-x":he()}],"translate-y":[{"translate-y":he()}],"translate-z":[{"translate-z":he()}],"translate-none":["translate-none"],accent:[{accent:O()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:O()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ae,ie]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":x()}],"scroll-mx":[{"scroll-mx":x()}],"scroll-my":[{"scroll-my":x()}],"scroll-ms":[{"scroll-ms":x()}],"scroll-me":[{"scroll-me":x()}],"scroll-mt":[{"scroll-mt":x()}],"scroll-mr":[{"scroll-mr":x()}],"scroll-mb":[{"scroll-mb":x()}],"scroll-ml":[{"scroll-ml":x()}],"scroll-p":[{"scroll-p":x()}],"scroll-px":[{"scroll-px":x()}],"scroll-py":[{"scroll-py":x()}],"scroll-ps":[{"scroll-ps":x()}],"scroll-pe":[{"scroll-pe":x()}],"scroll-pt":[{"scroll-pt":x()}],"scroll-pr":[{"scroll-pr":x()}],"scroll-pb":[{"scroll-pb":x()}],"scroll-pl":[{"scroll-pl":x()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ae,ie]}],fill:[{fill:["none",...O()]}],"stroke-w":[{stroke:[Le,Uc,Hs,Ef]}],stroke:[{stroke:["none",...O()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["before","after","placeholder","file","marker","selection","first-line","first-letter","backdrop","*","**"]}},kT=(r,{cacheSize:e,prefix:t,experimentalParseClassName:n,extend:s={},override:i={}})=>(Ro(r,"cacheSize",e),Ro(r,"prefix",t),Ro(r,"experimentalParseClassName",n),qc(r.theme,i.theme),qc(r.classGroups,i.classGroups),qc(r.conflictingClassGroups,i.conflictingClassGroups),qc(r.conflictingClassGroupModifiers,i.conflictingClassGroupModifiers),Ro(r,"orderSensitiveModifiers",i.orderSensitiveModifiers),Hc(r.theme,s.theme),Hc(r.classGroups,s.classGroups),Hc(r.conflictingClassGroups,s.conflictingClassGroups),Hc(r.conflictingClassGroupModifiers,s.conflictingClassGroupModifiers),Xk(r,s,"orderSensitiveModifiers"),r),Ro=(r,e,t)=>{t!==void 0&&(r[e]=t)},qc=(r,e)=>{if(e)for(const t in e)Ro(r,t,e[t])},Hc=(r,e)=>{if(e)for(const t in e)Xk(r,e,t)},Xk=(r,e,t)=>{const n=e[t];n!==void 0&&(r[t]=r[t]?r[t].concat(n):n)},ST=(r,...e)=>typeof r=="function"?tg(ng,r,...e):tg(()=>kT(ng(),r),...e),PT=tg(ng);var AT={twMerge:!0,twMergeConfig:{},responsiveVariants:!1},Yk=r=>r||void 0,hl=(...r)=>Yk(zk(r).filter(Boolean).join(" ")),Of=null,Ur={},rg=!1,no=(...r)=>e=>e.twMerge?((!Of||rg)&&(rg=!1,Of=pn(Ur)?PT:ST({...Ur,extend:{theme:Ur.theme,classGroups:Ur.classGroups,conflictingClassGroupModifiers:Ur.conflictingClassGroupModifiers,conflictingClassGroups:Ur.conflictingClassGroups,...Ur.extend}})),Yk(Of(hl(r)))):hl(r),Ny=(r,e)=>{for(let t in e)r.hasOwnProperty(t)?r[t]=hl(r[t],e[t]):r[t]=e[t];return r},ET=(r,e)=>{let{extend:t=null,slots:n={},variants:s={},compoundVariants:i=[],compoundSlots:a=[],defaultVariants:o={}}=r,l={...AT,...e},c=t!=null&&t.base?hl(t.base,r==null?void 0:r.base):r==null?void 0:r.base,u=t!=null&&t.variants&&!pn(t.variants)?Uk(s,t.variants):s,d=t!=null&&t.defaultVariants&&!pn(t.defaultVariants)?{...t.defaultVariants,...o}:o;!pn(l.twMergeConfig)&&!DO(l.twMergeConfig,Ur)&&(rg=!0,Ur=l.twMergeConfig);let h=pn(t==null?void 0:t.slots),f=pn(n)?{}:{base:hl(r==null?void 0:r.base,h&&(t==null?void 0:t.base)),...n},p=h?f:Ny({...t==null?void 0:t.slots},pn(f)?{base:r==null?void 0:r.base}:f),m=pn(t==null?void 0:t.compoundVariants)?i:Bk(t==null?void 0:t.compoundVariants,i),g=_=>{if(pn(u)&&pn(n)&&h)return no(c,_==null?void 0:_.class,_==null?void 0:_.className)(l);if(m&&!Array.isArray(m))throw new TypeError(`The "compoundVariants" prop must be an array. Received: ${typeof m}`);if(a&&!Array.isArray(a))throw new TypeError(`The "compoundSlots" prop must be an array. Received: ${typeof a}`);let y=(N,$,P=[],E)=>{let O=P;if(typeof $=="string")O=O.concat(Iy($).split(" ").map(I=>`${N}:${I}`));else if(Array.isArray($))O=O.concat($.reduce((I,T)=>I.concat(`${N}:${T}`),[]));else if(typeof $=="object"&&typeof E=="string"){for(let I in $)if($.hasOwnProperty(I)&&I===E){let T=$[I];if(T&&typeof T=="string"){let j=Iy(T);O[E]?O[E]=O[E].concat(j.split(" ").map(W=>`${N}:${W}`)):O[E]=j.split(" ").map(W=>`${N}:${W}`)}else Array.isArray(T)&&T.length>0&&(O[E]=T.reduce((j,W)=>j.concat(`${N}:${W}`),[]))}}return O},w=(N,$=u,P=null,E=null)=>{var O;let I=$[N];if(!I||pn(I))return null;let T=(O=E==null?void 0:E[N])!=null?O:_==null?void 0:_[N];if(T===null)return null;let j=Ry(T),W=Array.isArray(l.responsiveVariants)&&l.responsiveVariants.length>0||l.responsiveVariants===!0,ee=d==null?void 0:d[N],Z=[];if(typeof j=="object"&&W)for(let[G,le]of Object.entries(j)){let he=I[le];if(G==="initial"){ee=le;continue}Array.isArray(l.responsiveVariants)&&!l.responsiveVariants.includes(G)||(Z=y(G,he,Z,P))}let X=j!=null&&typeof j!="object"?j:Ry(ee),U=I[X||"false"];return typeof Z=="object"&&typeof P=="string"&&Z[P]?Ny(Z,U):Z.length>0?(Z.push(U),P==="base"?Z.join(" "):Z):U},v=()=>u?Object.keys(u).map(N=>w(N,u)):null,x=(N,$)=>{if(!u||typeof u!="object")return null;let P=new Array;for(let E in u){let O=w(E,u,N,$),I=N==="base"&&typeof O=="string"?O:O&&O[N];I&&(P[P.length]=I)}return P},S={};for(let N in _)_[N]!==void 0&&(S[N]=_[N]);let k=(N,$)=>{var P;let E=typeof(_==null?void 0:_[N])=="object"?{[N]:(P=_[N])==null?void 0:P.initial}:{};return{...d,...S,...E,...$}},R=(N=[],$)=>{let P=[];for(let{class:E,className:O,...I}of N){let T=!0;for(let[j,W]of Object.entries(I)){let ee=k(j,$)[j];if(Array.isArray(W)){if(!W.includes(ee)){T=!1;break}}else{let Z=X=>X==null||X===!1;if(Z(W)&&Z(ee))continue;if(ee!==W){T=!1;break}}}T&&(E&&P.push(E),O&&P.push(O))}return P},D=N=>{let $=R(m,N);if(!Array.isArray($))return $;let P={};for(let E of $)if(typeof E=="string"&&(P.base=no(P.base,E)(l)),typeof E=="object")for(let[O,I]of Object.entries(E))P[O]=no(P[O],I)(l);return P},C=N=>{if(a.length<1)return null;let $={};for(let{slots:P=[],class:E,className:O,...I}of a){if(!pn(I)){let T=!0;for(let j of Object.keys(I)){let W=k(j,N)[j];if(W===void 0||(Array.isArray(I[j])?!I[j].includes(W):I[j]!==W)){T=!1;break}}if(!T)continue}for(let T of P)$[T]=$[T]||[],$[T].push([E,O])}return $};if(!pn(n)||!h){let N={};if(typeof p=="object"&&!pn(p))for(let $ of Object.keys(p))N[$]=P=>{var E,O;return no(p[$],x($,P),((E=D(P))!=null?E:[])[$],((O=C(P))!=null?O:[])[$],P==null?void 0:P.class,P==null?void 0:P.className)(l)};return N}return no(c,v(),R(m),_==null?void 0:_.class,_==null?void 0:_.className)(l)},b=()=>{if(!(!u||typeof u!="object"))return Object.keys(u)};return g.variantKeys=b(),g.extend=t,g.base=c,g.slots=p,g.variants=u,g.defaultVariants=d,g.compoundSlots=a,g.compoundVariants=m,g};const Pb="-",OT=r=>{const e=RT(r),{conflictingClassGroups:t,conflictingClassGroupModifiers:n}=r;return{getClassGroupId:a=>{const o=a.split(Pb);return o[0]===""&&o.length!==1&&o.shift(),Qk(o,e)||TT(a)},getConflictingClassGroupIds:(a,o)=>{const l=t[a]||[];return o&&n[a]?[...l,...n[a]]:l}}},Qk=(r,e)=>{var a;if(r.length===0)return e.classGroupId;const t=r[0],n=e.nextPart.get(t),s=n?Qk(r.slice(1),n):void 0;if(s)return s;if(e.validators.length===0)return;const i=r.join(Pb);return(a=e.validators.find(({validator:o})=>o(i)))==null?void 0:a.classGroupId},Ly=/^\[(.+)\]$/,TT=r=>{if(Ly.test(r)){const e=Ly.exec(r)[1],t=e==null?void 0:e.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},RT=r=>{const{theme:e,classGroups:t}=r,n={nextPart:new Map,validators:[]};for(const s in t)sg(t[s],n,s,e);return n},sg=(r,e,t,n)=>{r.forEach(s=>{if(typeof s=="string"){const i=s===""?e:jy(e,s);i.classGroupId=t;return}if(typeof s=="function"){if(IT(s)){sg(s(n),e,t,n);return}e.validators.push({validator:s,classGroupId:t});return}Object.entries(s).forEach(([i,a])=>{sg(a,jy(e,i),t,n)})})},jy=(r,e)=>{let t=r;return e.split(Pb).forEach(n=>{t.nextPart.has(n)||t.nextPart.set(n,{nextPart:new Map,validators:[]}),t=t.nextPart.get(n)}),t},IT=r=>r.isThemeGetter,CT=r=>{if(r<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,n=new Map;const s=(i,a)=>{t.set(i,a),e++,e>r&&(e=0,n=t,t=new Map)};return{get(i){let a=t.get(i);if(a!==void 0)return a;if((a=n.get(i))!==void 0)return s(i,a),a},set(i,a){t.has(i)?t.set(i,a):s(i,a)}}},ig="!",ag=":",$T=ag.length,MT=r=>{const{prefix:e,experimentalParseClassName:t}=r;let n=s=>{const i=[];let a=0,o=0,l=0,c;for(let p=0;p<s.length;p++){let m=s[p];if(a===0&&o===0){if(m===ag){i.push(s.slice(l,p)),l=p+$T;continue}if(m==="/"){c=p;continue}}m==="["?a++:m==="]"?a--:m==="("?o++:m===")"&&o--}const u=i.length===0?s:s.substring(l),d=NT(u),h=d!==u,f=c&&c>l?c-l:void 0;return{modifiers:i,hasImportantModifier:h,baseClassName:d,maybePostfixModifierPosition:f}};if(e){const s=e+ag,i=n;n=a=>a.startsWith(s)?i(a.substring(s.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:a,maybePostfixModifierPosition:void 0}}if(t){const s=n;n=i=>t({className:i,parseClassName:s})}return n},NT=r=>r.endsWith(ig)?r.substring(0,r.length-1):r.startsWith(ig)?r.substring(1):r,LT=r=>{const e=Object.fromEntries(r.orderSensitiveModifiers.map(n=>[n,!0]));return n=>{if(n.length<=1)return n;const s=[];let i=[];return n.forEach(a=>{a[0]==="["||e[a]?(s.push(...i.sort(),a),i=[]):i.push(a)}),s.push(...i.sort()),s}},jT=r=>({cache:CT(r.cacheSize),parseClassName:MT(r),sortModifiers:LT(r),...OT(r)}),DT=/\s+/,FT=(r,e)=>{const{parseClassName:t,getClassGroupId:n,getConflictingClassGroupIds:s,sortModifiers:i}=e,a=[],o=r.trim().split(DT);let l="";for(let c=o.length-1;c>=0;c-=1){const u=o[c],{isExternal:d,modifiers:h,hasImportantModifier:f,baseClassName:p,maybePostfixModifierPosition:m}=t(u);if(d){l=u+(l.length>0?" "+l:l);continue}let g=!!m,b=n(g?p.substring(0,m):p);if(!b){if(!g){l=u+(l.length>0?" "+l:l);continue}if(b=n(p),!b){l=u+(l.length>0?" "+l:l);continue}g=!1}const _=i(h).join(":"),y=f?_+ig:_,w=y+b;if(a.includes(w))continue;a.push(w);const v=s(b,g);for(let x=0;x<v.length;++x){const S=v[x];a.push(y+S)}l=u+(l.length>0?" "+l:l)}return l};function zT(){let r=0,e,t,n="";for(;r<arguments.length;)(e=arguments[r++])&&(t=eS(e))&&(n&&(n+=" "),n+=t);return n}const eS=r=>{if(typeof r=="string")return r;let e,t="";for(let n=0;n<r.length;n++)r[n]&&(e=eS(r[n]))&&(t&&(t+=" "),t+=e);return t};function BT(r,...e){let t,n,s,i=a;function a(l){const c=e.reduce((u,d)=>d(u),r());return t=jT(c),n=t.cache.get,s=t.cache.set,i=o,o(l)}function o(l){const c=n(l);if(c)return c;const u=FT(l,t);return s(l,u),u}return function(){return i(zT.apply(null,arguments))}}const St=r=>{const e=t=>t[r]||[];return e.isThemeGetter=!0,e},tS=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,nS=/^\((?:(\w[\w-]*):)?(.+)\)$/i,UT=/^\d+\/\d+$/,qT=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,HT=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,WT=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,VT=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,GT=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Mi=r=>UT.test(r),Me=r=>!!r&&!Number.isNaN(Number(r)),os=r=>!!r&&Number.isInteger(Number(r)),Tf=r=>r.endsWith("%")&&Me(r.slice(0,-1)),Cr=r=>qT.test(r),ZT=()=>!0,JT=r=>HT.test(r)&&!WT.test(r),rS=()=>!1,KT=r=>VT.test(r),XT=r=>GT.test(r),YT=r=>!ne(r)&&!re(r),QT=r=>Da(r,aS,rS),ne=r=>tS.test(r),Ws=r=>Da(r,oS,JT),Rf=r=>Da(r,sR,Me),Dy=r=>Da(r,sS,rS),eR=r=>Da(r,iS,XT),Wc=r=>Da(r,lS,KT),re=r=>nS.test(r),ro=r=>Fa(r,oS),tR=r=>Fa(r,iR),Fy=r=>Fa(r,sS),nR=r=>Fa(r,aS),rR=r=>Fa(r,iS),Vc=r=>Fa(r,lS,!0),Da=(r,e,t)=>{const n=tS.exec(r);return n?n[1]?e(n[1]):t(n[2]):!1},Fa=(r,e,t=!1)=>{const n=nS.exec(r);return n?n[1]?e(n[1]):t:!1},sS=r=>r==="position"||r==="percentage",iS=r=>r==="image"||r==="url",aS=r=>r==="length"||r==="size"||r==="bg-size",oS=r=>r==="length",sR=r=>r==="number",iR=r=>r==="family-name",lS=r=>r==="shadow",aR=()=>{const r=St("color"),e=St("font"),t=St("text"),n=St("font-weight"),s=St("tracking"),i=St("leading"),a=St("breakpoint"),o=St("container"),l=St("spacing"),c=St("radius"),u=St("shadow"),d=St("inset-shadow"),h=St("text-shadow"),f=St("drop-shadow"),p=St("blur"),m=St("perspective"),g=St("aspect"),b=St("ease"),_=St("animate"),y=()=>["auto","avoid","all","avoid-page","page","left","right","column"],w=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],v=()=>[...w(),re,ne],x=()=>["auto","hidden","clip","visible","scroll"],S=()=>["auto","contain","none"],k=()=>[re,ne,l],R=()=>[Mi,"full","auto",...k()],D=()=>[os,"none","subgrid",re,ne],C=()=>["auto",{span:["full",os,re,ne]},os,re,ne],N=()=>[os,"auto",re,ne],$=()=>["auto","min","max","fr",re,ne],P=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],E=()=>["start","end","center","stretch","center-safe","end-safe"],O=()=>["auto",...k()],I=()=>[Mi,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...k()],T=()=>[r,re,ne],j=()=>[...w(),Fy,Dy,{position:[re,ne]}],W=()=>["no-repeat",{repeat:["","x","y","space","round"]}],ee=()=>["auto","cover","contain",nR,QT,{size:[re,ne]}],Z=()=>[Tf,ro,Ws],X=()=>["","none","full",c,re,ne],U=()=>["",Me,ro,Ws],G=()=>["solid","dashed","dotted","double"],le=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],he=()=>[Me,Tf,Fy,Dy],Dt=()=>["","none",p,re,ne],vt=()=>["none",Me,re,ne],lt=()=>["none",Me,re,ne],_t=()=>[Me,re,ne],Ut=()=>[Mi,"full",...k()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Cr],breakpoint:[Cr],color:[ZT],container:[Cr],"drop-shadow":[Cr],ease:["in","out","in-out"],font:[YT],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Cr],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Cr],shadow:[Cr],spacing:["px",Me],text:[Cr],"text-shadow":[Cr],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Mi,ne,re,g]}],container:["container"],columns:[{columns:[Me,ne,re,o]}],"break-after":[{"break-after":y()}],"break-before":[{"break-before":y()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:v()}],overflow:[{overflow:x()}],"overflow-x":[{"overflow-x":x()}],"overflow-y":[{"overflow-y":x()}],overscroll:[{overscroll:S()}],"overscroll-x":[{"overscroll-x":S()}],"overscroll-y":[{"overscroll-y":S()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:R()}],"inset-x":[{"inset-x":R()}],"inset-y":[{"inset-y":R()}],start:[{start:R()}],end:[{end:R()}],top:[{top:R()}],right:[{right:R()}],bottom:[{bottom:R()}],left:[{left:R()}],visibility:["visible","invisible","collapse"],z:[{z:[os,"auto",re,ne]}],basis:[{basis:[Mi,"full","auto",o,...k()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Me,Mi,"auto","initial","none",ne]}],grow:[{grow:["",Me,re,ne]}],shrink:[{shrink:["",Me,re,ne]}],order:[{order:[os,"first","last","none",re,ne]}],"grid-cols":[{"grid-cols":D()}],"col-start-end":[{col:C()}],"col-start":[{"col-start":N()}],"col-end":[{"col-end":N()}],"grid-rows":[{"grid-rows":D()}],"row-start-end":[{row:C()}],"row-start":[{"row-start":N()}],"row-end":[{"row-end":N()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":$()}],"auto-rows":[{"auto-rows":$()}],gap:[{gap:k()}],"gap-x":[{"gap-x":k()}],"gap-y":[{"gap-y":k()}],"justify-content":[{justify:[...P(),"normal"]}],"justify-items":[{"justify-items":[...E(),"normal"]}],"justify-self":[{"justify-self":["auto",...E()]}],"align-content":[{content:["normal",...P()]}],"align-items":[{items:[...E(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...E(),{baseline:["","last"]}]}],"place-content":[{"place-content":P()}],"place-items":[{"place-items":[...E(),"baseline"]}],"place-self":[{"place-self":["auto",...E()]}],p:[{p:k()}],px:[{px:k()}],py:[{py:k()}],ps:[{ps:k()}],pe:[{pe:k()}],pt:[{pt:k()}],pr:[{pr:k()}],pb:[{pb:k()}],pl:[{pl:k()}],m:[{m:O()}],mx:[{mx:O()}],my:[{my:O()}],ms:[{ms:O()}],me:[{me:O()}],mt:[{mt:O()}],mr:[{mr:O()}],mb:[{mb:O()}],ml:[{ml:O()}],"space-x":[{"space-x":k()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":k()}],"space-y-reverse":["space-y-reverse"],size:[{size:I()}],w:[{w:[o,"screen",...I()]}],"min-w":[{"min-w":[o,"screen","none",...I()]}],"max-w":[{"max-w":[o,"screen","none","prose",{screen:[a]},...I()]}],h:[{h:["screen",...I()]}],"min-h":[{"min-h":["screen","none",...I()]}],"max-h":[{"max-h":["screen",...I()]}],"font-size":[{text:["base",t,ro,Ws]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[n,re,Rf]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Tf,ne]}],"font-family":[{font:[tR,ne,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[s,re,ne]}],"line-clamp":[{"line-clamp":[Me,"none",re,Rf]}],leading:[{leading:[i,...k()]}],"list-image":[{"list-image":["none",re,ne]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",re,ne]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:T()}],"text-color":[{text:T()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...G(),"wavy"]}],"text-decoration-thickness":[{decoration:[Me,"from-font","auto",re,Ws]}],"text-decoration-color":[{decoration:T()}],"underline-offset":[{"underline-offset":[Me,"auto",re,ne]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:k()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",re,ne]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",re,ne]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:j()}],"bg-repeat":[{bg:W()}],"bg-size":[{bg:ee()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},os,re,ne],radial:["",re,ne],conic:[os,re,ne]},rR,eR]}],"bg-color":[{bg:T()}],"gradient-from-pos":[{from:Z()}],"gradient-via-pos":[{via:Z()}],"gradient-to-pos":[{to:Z()}],"gradient-from":[{from:T()}],"gradient-via":[{via:T()}],"gradient-to":[{to:T()}],rounded:[{rounded:X()}],"rounded-s":[{"rounded-s":X()}],"rounded-e":[{"rounded-e":X()}],"rounded-t":[{"rounded-t":X()}],"rounded-r":[{"rounded-r":X()}],"rounded-b":[{"rounded-b":X()}],"rounded-l":[{"rounded-l":X()}],"rounded-ss":[{"rounded-ss":X()}],"rounded-se":[{"rounded-se":X()}],"rounded-ee":[{"rounded-ee":X()}],"rounded-es":[{"rounded-es":X()}],"rounded-tl":[{"rounded-tl":X()}],"rounded-tr":[{"rounded-tr":X()}],"rounded-br":[{"rounded-br":X()}],"rounded-bl":[{"rounded-bl":X()}],"border-w":[{border:U()}],"border-w-x":[{"border-x":U()}],"border-w-y":[{"border-y":U()}],"border-w-s":[{"border-s":U()}],"border-w-e":[{"border-e":U()}],"border-w-t":[{"border-t":U()}],"border-w-r":[{"border-r":U()}],"border-w-b":[{"border-b":U()}],"border-w-l":[{"border-l":U()}],"divide-x":[{"divide-x":U()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":U()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...G(),"hidden","none"]}],"divide-style":[{divide:[...G(),"hidden","none"]}],"border-color":[{border:T()}],"border-color-x":[{"border-x":T()}],"border-color-y":[{"border-y":T()}],"border-color-s":[{"border-s":T()}],"border-color-e":[{"border-e":T()}],"border-color-t":[{"border-t":T()}],"border-color-r":[{"border-r":T()}],"border-color-b":[{"border-b":T()}],"border-color-l":[{"border-l":T()}],"divide-color":[{divide:T()}],"outline-style":[{outline:[...G(),"none","hidden"]}],"outline-offset":[{"outline-offset":[Me,re,ne]}],"outline-w":[{outline:["",Me,ro,Ws]}],"outline-color":[{outline:T()}],shadow:[{shadow:["","none",u,Vc,Wc]}],"shadow-color":[{shadow:T()}],"inset-shadow":[{"inset-shadow":["none",d,Vc,Wc]}],"inset-shadow-color":[{"inset-shadow":T()}],"ring-w":[{ring:U()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:T()}],"ring-offset-w":[{"ring-offset":[Me,Ws]}],"ring-offset-color":[{"ring-offset":T()}],"inset-ring-w":[{"inset-ring":U()}],"inset-ring-color":[{"inset-ring":T()}],"text-shadow":[{"text-shadow":["none",h,Vc,Wc]}],"text-shadow-color":[{"text-shadow":T()}],opacity:[{opacity:[Me,re,ne]}],"mix-blend":[{"mix-blend":[...le(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":le()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[Me]}],"mask-image-linear-from-pos":[{"mask-linear-from":he()}],"mask-image-linear-to-pos":[{"mask-linear-to":he()}],"mask-image-linear-from-color":[{"mask-linear-from":T()}],"mask-image-linear-to-color":[{"mask-linear-to":T()}],"mask-image-t-from-pos":[{"mask-t-from":he()}],"mask-image-t-to-pos":[{"mask-t-to":he()}],"mask-image-t-from-color":[{"mask-t-from":T()}],"mask-image-t-to-color":[{"mask-t-to":T()}],"mask-image-r-from-pos":[{"mask-r-from":he()}],"mask-image-r-to-pos":[{"mask-r-to":he()}],"mask-image-r-from-color":[{"mask-r-from":T()}],"mask-image-r-to-color":[{"mask-r-to":T()}],"mask-image-b-from-pos":[{"mask-b-from":he()}],"mask-image-b-to-pos":[{"mask-b-to":he()}],"mask-image-b-from-color":[{"mask-b-from":T()}],"mask-image-b-to-color":[{"mask-b-to":T()}],"mask-image-l-from-pos":[{"mask-l-from":he()}],"mask-image-l-to-pos":[{"mask-l-to":he()}],"mask-image-l-from-color":[{"mask-l-from":T()}],"mask-image-l-to-color":[{"mask-l-to":T()}],"mask-image-x-from-pos":[{"mask-x-from":he()}],"mask-image-x-to-pos":[{"mask-x-to":he()}],"mask-image-x-from-color":[{"mask-x-from":T()}],"mask-image-x-to-color":[{"mask-x-to":T()}],"mask-image-y-from-pos":[{"mask-y-from":he()}],"mask-image-y-to-pos":[{"mask-y-to":he()}],"mask-image-y-from-color":[{"mask-y-from":T()}],"mask-image-y-to-color":[{"mask-y-to":T()}],"mask-image-radial":[{"mask-radial":[re,ne]}],"mask-image-radial-from-pos":[{"mask-radial-from":he()}],"mask-image-radial-to-pos":[{"mask-radial-to":he()}],"mask-image-radial-from-color":[{"mask-radial-from":T()}],"mask-image-radial-to-color":[{"mask-radial-to":T()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":w()}],"mask-image-conic-pos":[{"mask-conic":[Me]}],"mask-image-conic-from-pos":[{"mask-conic-from":he()}],"mask-image-conic-to-pos":[{"mask-conic-to":he()}],"mask-image-conic-from-color":[{"mask-conic-from":T()}],"mask-image-conic-to-color":[{"mask-conic-to":T()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:j()}],"mask-repeat":[{mask:W()}],"mask-size":[{mask:ee()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",re,ne]}],filter:[{filter:["","none",re,ne]}],blur:[{blur:Dt()}],brightness:[{brightness:[Me,re,ne]}],contrast:[{contrast:[Me,re,ne]}],"drop-shadow":[{"drop-shadow":["","none",f,Vc,Wc]}],"drop-shadow-color":[{"drop-shadow":T()}],grayscale:[{grayscale:["",Me,re,ne]}],"hue-rotate":[{"hue-rotate":[Me,re,ne]}],invert:[{invert:["",Me,re,ne]}],saturate:[{saturate:[Me,re,ne]}],sepia:[{sepia:["",Me,re,ne]}],"backdrop-filter":[{"backdrop-filter":["","none",re,ne]}],"backdrop-blur":[{"backdrop-blur":Dt()}],"backdrop-brightness":[{"backdrop-brightness":[Me,re,ne]}],"backdrop-contrast":[{"backdrop-contrast":[Me,re,ne]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Me,re,ne]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Me,re,ne]}],"backdrop-invert":[{"backdrop-invert":["",Me,re,ne]}],"backdrop-opacity":[{"backdrop-opacity":[Me,re,ne]}],"backdrop-saturate":[{"backdrop-saturate":[Me,re,ne]}],"backdrop-sepia":[{"backdrop-sepia":["",Me,re,ne]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":k()}],"border-spacing-x":[{"border-spacing-x":k()}],"border-spacing-y":[{"border-spacing-y":k()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",re,ne]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Me,"initial",re,ne]}],ease:[{ease:["linear","initial",b,re,ne]}],delay:[{delay:[Me,re,ne]}],animate:[{animate:["none",_,re,ne]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[m,re,ne]}],"perspective-origin":[{"perspective-origin":v()}],rotate:[{rotate:vt()}],"rotate-x":[{"rotate-x":vt()}],"rotate-y":[{"rotate-y":vt()}],"rotate-z":[{"rotate-z":vt()}],scale:[{scale:lt()}],"scale-x":[{"scale-x":lt()}],"scale-y":[{"scale-y":lt()}],"scale-z":[{"scale-z":lt()}],"scale-3d":["scale-3d"],skew:[{skew:_t()}],"skew-x":[{"skew-x":_t()}],"skew-y":[{"skew-y":_t()}],transform:[{transform:[re,ne,"","none","gpu","cpu"]}],"transform-origin":[{origin:v()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Ut()}],"translate-x":[{"translate-x":Ut()}],"translate-y":[{"translate-y":Ut()}],"translate-z":[{"translate-z":Ut()}],"translate-none":["translate-none"],accent:[{accent:T()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:T()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",re,ne]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":k()}],"scroll-mx":[{"scroll-mx":k()}],"scroll-my":[{"scroll-my":k()}],"scroll-ms":[{"scroll-ms":k()}],"scroll-me":[{"scroll-me":k()}],"scroll-mt":[{"scroll-mt":k()}],"scroll-mr":[{"scroll-mr":k()}],"scroll-mb":[{"scroll-mb":k()}],"scroll-ml":[{"scroll-ml":k()}],"scroll-p":[{"scroll-p":k()}],"scroll-px":[{"scroll-px":k()}],"scroll-py":[{"scroll-py":k()}],"scroll-ps":[{"scroll-ps":k()}],"scroll-pe":[{"scroll-pe":k()}],"scroll-pt":[{"scroll-pt":k()}],"scroll-pr":[{"scroll-pr":k()}],"scroll-pb":[{"scroll-pb":k()}],"scroll-pl":[{"scroll-pl":k()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",re,ne]}],fill:[{fill:["none",...T()]}],"stroke-w":[{stroke:[Me,ro,Ws,Rf]}],stroke:[{stroke:["none",...T()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},oR=BT(aR);function zn(...r){return oR(Zo(r))}const zy=ET({base:"ring-offset-background focus-visible:ring-ring inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border-input bg-background hover:bg-accent hover:text-accent-foreground border",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}});var lR=pe("<a><!></a>"),cR=pe("<button><!></button>");function fl(r,e){at(e,!0);let t=se(e,"variant",3,"default"),n=se(e,"size",3,"default"),s=se(e,"ref",15,null),i=se(e,"href",3,void 0),a=se(e,"type",3,"button"),o=Tt(e,["$$slots","$$events","$$legacy","class","variant","size","ref","href","type","children"]);var l=Fe(),c=ke(l);{var u=h=>{var f=lR();let p;var m=B(f);kt(m,()=>e.children??Rn),z(f),es(f,g=>s(g),()=>s()),Ue(g=>p=jt(f,p,{class:g,href:i(),...o}),[()=>zn(zy({variant:t(),size:n()}),e.class)]),q(h,f)},d=h=>{var f=cR();let p;var m=B(f);kt(m,()=>e.children??Rn),z(f),es(f,g=>s(g),()=>s()),Ue(g=>p=jt(f,p,{class:g,type:a(),...o}),[()=>zn(zy({variant:t(),size:n()}),e.class)]),q(h,f)};Qe(c,h=>{i()?h(u):h(d,!1)})}q(r,l),ot()}var uR=pe("<input>"),dR=pe("<input>");function Jt(r,e){at(e,!0);let t=se(e,"ref",15,null),n=se(e,"value",15),s=se(e,"files",15),i=Tt(e,["$$slots","$$events","$$legacy","ref","value","type","files","class"]);var a=Fe(),o=ke(a);{var l=u=>{var d=uR();Oy(d);let h;es(d,f=>t(f),()=>t()),Ue(f=>h=jt(d,h,{class:f,type:"file",...i}),[()=>zn("border-input bg-background ring-offset-background placeholder:text-muted-foreground focus-visible:ring-ring flex h-10 w-full rounded-md border px-3 py-2 text-base file:border-0 file:bg-transparent file:text-sm file:font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e.class)]),CO(d,s),Hm(d,n),q(u,d)},c=u=>{var d=dR();Oy(d);let h;es(d,f=>t(f),()=>t()),Ue(f=>h=jt(d,h,{class:f,type:e.type,...i}),[()=>zn("border-input bg-background ring-offset-background placeholder:text-muted-foreground focus-visible:ring-ring flex h-10 w-full rounded-md border px-3 py-2 text-base file:border-0 file:bg-transparent file:text-sm file:font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e.class)]),Hm(d,n),q(u,d)};Qe(o,u=>{e.type==="file"?u(l):u(c,!1)})}q(r,a),ot()}var hR=pe("<option> </option>"),fR=pe('<div class="box gap-2"><label for="frequency" class="text-sm font-medium">é¢ç (Hz)</label> <!></div>'),pR=pe('<div class="box gap-2"><label for="phase" class="text-sm font-medium">ç¸ä½ (å¼§åº¦)</label> <!></div>'),mR=pe('<div class="box gap-2"><label for="dutyCycle" class="text-sm font-medium">å ç©ºæ¯ (0-1)</label> <!></div>'),gR=pe('<div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="box gap-2"><label for="pulsePosition" class="text-sm font-medium">èå² Position (sample)</label> <!></div> <div class="box gap-2"><label for="pulseWidth" class="text-sm font-medium">èå² Width (samples)</label> <!></div></div>'),bR=pe('<div class="box gap-4"><form class="box space-y-4"><div class="grid gap-4"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="box gap-2"><label for="channelName" class="text-sm font-medium">ééåç§°</label> <!></div> <div class="box gap-2"><label for="signalType" class="text-sm font-medium">ä¿¡å·ç±»å</label> <select id="signalType" class="w-full px-3 py-2 border rounded-md border-input bg-background"></select></div></div> <div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div class="box gap-2"><label for="sampleRate" class="text-sm font-medium">éæ ·ç (Hz)</label> <!></div> <div class="box gap-2"><label for="length" class="text-sm font-medium">é¿åº¦ (æ ·æ¬æ°)</label> <!></div> <div class="box gap-2"><label for="amplitude" class="text-sm font-medium">å¹åº¦</label> <!></div></div> <!> <!> <!> <!></div> <!></form></div>');function _R(r,e){at(e,!1);const t=[{id:"sine",name:"æ­£å¼¦æ³¢",generator:Vm},{id:"square",name:"æ¹æ³¢",generator:Gm},{id:"triangle",name:"ä¸è§æ³¢",generator:Zm},{id:"sawtooth",name:"é¯é½¿æ³¢",generator:Jm},{id:"noise",name:"ç½åªå£°",generator:Km},{id:"pulse",name:"èå²",generator:Xm}];let n=1;function s(){return"ä¿¡å· "+n++}let i=nn(t[0]),a=nn(s()),o=nn(1e3),l=nn(1e3),c=nn(10),u=nn(1),d=nn(.5),h=nn(500),f=nn(10),p=nn(0);function m(){let U;switch(A(i).id){case"sine":U=Vm(A(l),A(c),A(u),A(o),A(p));break;case"square":U=Gm(A(l),A(c),A(u),A(o),A(d));break;case"triangle":U=Zm(A(l),A(c),A(u),A(o));break;case"sawtooth":U=Jm(A(l),A(c),A(u),A(o));break;case"noise":U=Km(A(l),A(u));break;case"pulse":U=Xm(A(l),A(h),A(f),A(u));break;default:U=[]}xb(A(a),U,A(o)),de(a,s())}kh();var g=bR(),b=B(g),_=B(b),y=B(_),w=B(y),v=V(B(w),2);Jt(v,{id:"channelName",type:"text",required:!0,get value(){return A(a)},set value(U){de(a,U)},$$legacy:!0}),z(w);var x=V(w,2),S=V(B(x),2);Ue(()=>{A(i),qm(()=>{})}),jn(S,5,()=>t,Er,(U,G)=>{var le=hR(),he={},Dt=B(le,!0);z(le),Ue(()=>{he!==(he=A(G))&&(le.value=(le.__value=A(G))??""),yt(Dt,A(G).name)}),q(U,le)}),z(S),z(x),z(y);var k=V(y,2),R=B(k),D=V(B(R),2);Jt(D,{id:"sampleRate",type:"number",min:"1",required:!0,get value(){return A(o)},set value(U){de(o,U)},$$legacy:!0}),z(R);var C=V(R,2),N=V(B(C),2);Jt(N,{id:"length",type:"number",min:"1",required:!0,get value(){return A(l)},set value(U){de(l,U)},$$legacy:!0}),z(C);var $=V(C,2),P=V(B($),2);Jt(P,{id:"amplitude",type:"number",step:"0.1",required:!0,get value(){return A(u)},set value(U){de(u,U)},$$legacy:!0}),z($),z(k);var E=V(k,2);{var O=U=>{var G=fR(),le=V(B(G),2);Jt(le,{id:"frequency",type:"number",min:"0.1",step:"0.1",required:!0,get value(){return A(c)},set value(he){de(c,he)},$$legacy:!0}),z(G),q(U,G)};Qe(E,U=>{(A(i).id==="sine"||A(i).id==="square"||A(i).id==="triangle"||A(i).id==="sawtooth")&&U(O)})}var I=V(E,2);{var T=U=>{var G=pR(),le=V(B(G),2);Jt(le,{id:"phase",type:"number",step:"0.1",get value(){return A(p)},set value(he){de(p,he)},$$legacy:!0}),z(G),q(U,G)};Qe(I,U=>{A(i).id==="sine"&&U(T)})}var j=V(I,2);{var W=U=>{var G=mR(),le=V(B(G),2);Jt(le,{id:"dutyCycle",type:"number",min:"0",max:"1",step:"0.1",required:!0,get value(){return A(d)},set value(he){de(d,he)},$$legacy:!0}),z(G),q(U,G)};Qe(j,U=>{A(i).id==="square"&&U(W)})}var ee=V(j,2);{var Z=U=>{var G=gR(),le=B(G),he=V(B(le),2);const Dt=hc(()=>A(l)-1);Jt(he,{id:"pulsePosition",type:"number",min:"0",get max(){return A(Dt)},required:!0,get value(){return A(h)},set value(_t){de(h,_t)},$$legacy:!0}),z(le);var vt=V(le,2),lt=V(B(vt),2);Jt(lt,{id:"pulseWidth",type:"number",min:"1",required:!0,get value(){return A(f)},set value(_t){de(f,_t)},$$legacy:!0}),z(vt),z(G),q(U,G)};Qe(ee,U=>{A(i).id==="pulse"&&U(Z)})}z(_);var X=V(_,2);fl(X,{type:"submit",class:"w-full",children:(U,G)=>{Jn();var le=ni("çæä¿¡å·");q(U,le)},$$slots:{default:!0}}),z(b),z(g),la("submit",b,U=>{U.preventDefault(),m()}),dl(S,()=>A(i),U=>de(i,U)),q(r,g),ot()}function Pi(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var If,By;function Ab(){if(By)return If;By=1;var r=function(s,i){return[s[0]+i[0],s[1]+i[1]]},e=function(s,i){return[s[0]-i[0],s[1]-i[1]]},t=function(s,i){return[s[0]*i[0]-s[1]*i[1],s[0]*i[1]+s[1]*i[0]]},n=function(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])};return If={add:r,subtract:e,multiply:t,magnitude:n},If}var Cf,Uy;function Eb(){if(Uy)return Cf;Uy=1;var r=Ab(),e={},t=function(i,a){var o=-2*Math.PI*(i/a);return e[a]=e[a]||{},e[a][i]=e[a][i]||[Math.cos(o),Math.sin(o)],e[a][i]},n=function(i){var a=i.map(r.magnitude);return a.slice(0,a.length/2)},s=function(i,a){var o=a/i.length,l=i.slice(0,i.length/2);return l.map(function(c,u){return u*o})};return Cf={fftMag:n,fftFreq:s,exponent:t},Cf}var dt={},qy;function yR(){if(qy)return dt;qy=1;var r=32;dt.INT_BITS=r,dt.INT_MAX=2147483647,dt.INT_MIN=-1<<r-1,dt.sign=function(n){return(n>0)-(n<0)},dt.abs=function(n){var s=n>>r-1;return(n^s)-s},dt.min=function(n,s){return s^(n^s)&-(n<s)},dt.max=function(n,s){return n^(n^s)&-(n<s)},dt.isPow2=function(n){return!(n&n-1)&&!!n},dt.log2=function(n){var s,i;return s=(n>65535)<<4,n>>>=s,i=(n>255)<<3,n>>>=i,s|=i,i=(n>15)<<2,n>>>=i,s|=i,i=(n>3)<<1,n>>>=i,s|=i,s|n>>1},dt.log10=function(n){return n>=1e9?9:n>=1e8?8:n>=1e7?7:n>=1e6?6:n>=1e5?5:n>=1e4?4:n>=1e3?3:n>=100?2:n>=10?1:0},dt.popCount=function(n){return n=n-(n>>>1&1431655765),n=(n&858993459)+(n>>>2&858993459),(n+(n>>>4)&252645135)*16843009>>>24};function e(n){var s=32;return n&=-n,n&&s--,n&65535&&(s-=16),n&16711935&&(s-=8),n&252645135&&(s-=4),n&858993459&&(s-=2),n&1431655765&&(s-=1),s}dt.countTrailingZeros=e,dt.nextPow2=function(n){return n+=n===0,--n,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n+1},dt.prevPow2=function(n){return n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n-(n>>>1)},dt.parity=function(n){return n^=n>>>16,n^=n>>>8,n^=n>>>4,n&=15,27030>>>n&1};var t=new Array(256);return function(n){for(var s=0;s<256;++s){var i=s,a=s,o=7;for(i>>>=1;i;i>>>=1)a<<=1,a|=i&1,--o;n[s]=a<<o&255}}(t),dt.reverse=function(n){return t[n&255]<<24|t[n>>>8&255]<<16|t[n>>>16&255]<<8|t[n>>>24&255]},dt.interleave2=function(n,s){return n&=65535,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,s&=65535,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,n|s<<1},dt.deinterleave2=function(n,s){return n=n>>>s&1431655765,n=(n|n>>>1)&858993459,n=(n|n>>>2)&252645135,n=(n|n>>>4)&16711935,n=(n|n>>>16)&65535,n<<16>>16},dt.interleave3=function(n,s,i){return n&=1023,n=(n|n<<16)&4278190335,n=(n|n<<8)&251719695,n=(n|n<<4)&3272356035,n=(n|n<<2)&1227133513,s&=1023,s=(s|s<<16)&4278190335,s=(s|s<<8)&251719695,s=(s|s<<4)&3272356035,s=(s|s<<2)&1227133513,n|=s<<1,i&=1023,i=(i|i<<16)&4278190335,i=(i|i<<8)&251719695,i=(i|i<<4)&3272356035,i=(i|i<<2)&1227133513,n|i<<2},dt.deinterleave3=function(n,s){return n=n>>>s&1227133513,n=(n|n>>>2)&3272356035,n=(n|n>>>4)&251719695,n=(n|n>>>8)&4278190335,n=(n|n>>>16)&1023,n<<22>>22},dt.nextCombination=function(n){var s=n|n-1;return s+1|(~s&-~s)-1>>>e(n)+1},dt}var $f,Hy;function og(){if(Hy)return $f;Hy=1;var r=Ab(),e=Eb(),t=yR();return $f={fft:function n(s){var i=[],a=s.length;if(a==1)return Array.isArray(s[0])?[[s[0][0],s[0][1]]]:[[s[0],0]];for(var o=n(s.filter(h)),l=n(s.filter(f)),c=0;c<a/2;c++){var u=o[c],d=r.multiply(e.exponent(c,a),l[c]);i[c]=r.add(u,d),i[c+a/2]=r.subtract(u,d)}function h(p,m){return m%2==0}function f(p,m){return m%2==1}return i},fftInPlace:function(n){for(var s=n.length,i=t.countTrailingZeros(s),a=0;a<s;a++){var o=t.reverse(a)>>>t.INT_BITS-i;if(o>a){var l=[n[a],0];n[a]=n[o],n[o]=l}else n[o]=[n[o],0]}for(var c=2;c<=s;c+=c)for(var u=0;u<c/2;u++)for(var d=e.exponent(u,c),h=0;h<s/c;h++){var f=r.multiply(d,n[h*c+u+c/2]);n[h*c+u+c/2]=r.subtract(n[h*c+u],f),n[h*c+u]=r.add(n[h*c+u],f)}}},$f}var Mf,Wy;function wR(){if(Wy)return Mf;Wy=1;var r=og().fft;return Mf={ifft:function(t){for(var n=[],s=0;s<t.length;s++)n[s]=[t[s][1],t[s][0]];for(var i=r(n),a=[],o=0;o<i.length;o++)a[o]=[i[o][1]/i.length,i[o][0]/i.length];return a}},Mf}var Nf,Vy;function cS(){if(Vy)return Nf;Vy=1;var r=Ab(),e=Eb(),t=function(n){for(var s=[],i=n.length,a=0;a<i;a++){s[a]=[0,0];for(var o=0;o<i;o++){var l=e.exponent(a*o,i),c;Array.isArray(n[o])?c=r.multiply(n[o],l):c=r.multiply([n[o],0],l),s[a]=r.add(s[a],c)}}return s};return Nf=t,Nf}var Lf,Gy;function vR(){if(Gy)return Lf;Gy=1;var r=cS();function e(t){for(var n=[],s=0;s<t.length;s++)n[s]=[t[s][1],t[s][0]];for(var i=r(n),a=[],o=0;o<i.length;o++)a[o]=[i[o][1]/i.length,i[o][0]/i.length];return a}return Lf=e,Lf}var jf,Zy;function xR(){return Zy||(Zy=1,jf={fft:og().fft,ifft:wR().ifft,fftInPlace:og().fftInPlace,util:Eb(),dft:cS(),idft:vR()}),jf}var kR=xR();const Jy=Pi(kR);function uS(r,e){if(e<=1||e>r.length)return[...r];const t=[];let n=0;for(let s=0;s<e;s++)s<r.length&&(n+=r[s]);for(let s=0;s<r.length;s++)s>=e&&(n=n-r[s-e]+r[s]),t.push(n/Math.min(e,s+1));return t}function dS(r,e,t){const n=1/t,s=1/(2*Math.PI*e),i=n/(s+n),a=[];let o=r[0]||0;for(let l=0;l<r.length;l++)o=o+i*(r[l]-o),a.push(o);return a}function hS(r,e,t){const n=1/t,s=1/(2*Math.PI*e),i=s/(s+n),a=[];let o=0,l=r[0]||0;for(let c=0;c<r.length;c++){const u=r[c],d=i*(o+u-l);a.push(d),o=d,l=u}return a}function Ob(r){const e=Math.pow(2,Math.ceil(Math.log2(r.length))),t=[...r];for(;t.length<e;)t.push(0);const n=Jy.fft(t),s=Jy.util.fftMag(n);return s.slice(0,Math.floor(s.length/2))}function SR(r,e){const t=Ob(r),n=t.length,s=Array.from({length:n},(a,o)=>o*e/(2*n)),i=t.map(a=>a*a);return{frequencies:s,powerSpectrum:i}}function fS(r,e){if(r.length<=1)return new Array(r.length).fill(0);const t=[],n=1/e;t.push((r[1]-r[0])/n);for(let s=1;s<r.length-1;s++)t.push((r[s+1]-r[s-1])/(2*n));return t.push((r[r.length-1]-r[r.length-2])/n),t}function pS(r,e){const t=[],n=1/e;let s=0;for(let i=0;i<r.length;i++)s+=r[i]*n,t.push(s);return t}var PR=pe("<option> </option>"),AR=pe("<option> </option>"),ER=pe('<div class="box gap-2"><label for="windowSize" class="text-sm font-medium">çªå£å¤§å°</label> <!></div>'),OR=pe('<div class="box gap-2"><label for="cutoffFrequency" class="text-sm font-medium">æªæ­¢é¢ç (Hz)</label> <!></div>'),TR=pe('<div class="box gap-4"><form class="box space-y-4"><div class="grid gap-4"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="box gap-2"><label for="sourceChannel" class="text-sm font-medium">æºéé</label> <select id="sourceChannel" required class="w-full px-3 py-2 border rounded-md border-input bg-background"><option>éæ©ä¸ä¸ªéé</option><!></select></div> <div class="box gap-2"><label for="processingMethod" class="text-sm font-medium">å¤çæ¹æ³</label> <select id="processingMethod" class="w-full px-3 py-2 border rounded-md border-input bg-background"></select></div></div> <div class="box gap-2"><label for="newChannelName" class="text-sm font-medium">æ°ééåç§°</label> <!></div> <!> <!></div> <!></form></div>');function RR(r,e){at(e,!1);const[t,n]=Sh(),s=()=>Ph(Na,"$channels",t),i=[{id:"movingAverage",name:"ç§»å¨å¹³å",processor:uS,params:["windowSize"]},{id:"lowPass",name:"ä½éæ»¤æ³¢å¨",processor:dS,params:["cutoffFrequency","sampleRate"]},{id:"highPass",name:"é«éæ»¤æ³¢å¨",processor:hS,params:["cutoffFrequency","sampleRate"]},{id:"fft",name:"FFT",processor:Ob,params:[]},{id:"powerSpectrum",name:"åçè°±",processor:SR,params:["sampleRate"]},{id:"differentiate",name:"å¾®å",processor:fS,params:["sampleRate"]},{id:"integrate",name:"ç§¯å",processor:pS,params:["sampleRate"]}];let a=nn(i[0]),o=se(e,"selectedChannelId",12,""),l=nn(""),c=nn(10),u=nn(100);function d(){if(!o()||!A(l))return;const P=s().find(O=>O.id===o());if(!P)return;A(l)||de(l,`${P.name} (${A(a).name})`);const E={};A(a).params.includes("windowSize")&&(E.windowSize=A(c)),A(a).params.includes("cutoffFrequency")&&(E.cutoffFrequency=A(u)),A(a).params.includes("sampleRate")&&(E.sampleRate=P.sampleRate),Dk(o(),A(a).processor,A(l),E),de(l,"")}iO(()=>(oO(o()),A(a),s()),()=>{if(o()&&A(a)){const P=s().find(E=>E.id===o());P&&de(l,`${P.name} (${A(a).name})`)}}),aO(),kh();var h=TR(),f=B(h),p=B(f),m=B(p),g=B(m),b=V(B(g),2);Ue(()=>{o(),qm(()=>{s()})});var _=B(b);_.value=_.__value="";var y=V(_);jn(y,1,s,Er,(P,E)=>{var O=PR(),I={},T=B(O,!0);z(O),Ue(()=>{I!==(I=A(E).id)&&(O.value=(O.__value=A(E).id)??""),yt(T,A(E).name)}),q(P,O)}),z(b),z(g);var w=V(g,2),v=V(B(w),2);Ue(()=>{A(a),qm(()=>{})}),jn(v,5,()=>i,Er,(P,E)=>{var O=AR(),I={},T=B(O,!0);z(O),Ue(()=>{I!==(I=A(E))&&(O.value=(O.__value=A(E))??""),yt(T,A(E).name)}),q(P,O)}),z(v),z(w),z(m);var x=V(m,2),S=V(B(x),2);Jt(S,{id:"newChannelName",type:"text",required:!0,get value(){return A(l)},set value(P){de(l,P)},$$legacy:!0}),z(x);var k=V(x,2);{var R=P=>{var E=ER(),O=V(B(E),2);Jt(O,{id:"windowSize",type:"number",min:"1",required:!0,get value(){return A(c)},set value(I){de(c,I)},$$legacy:!0}),z(E),q(P,E)};Qe(k,P=>{A(a)&&A(a).params.includes("windowSize")&&P(R)})}var D=V(k,2);{var C=P=>{var E=OR(),O=V(B(E),2);Jt(O,{id:"cutoffFrequency",type:"number",min:"0.1",step:"0.1",required:!0,get value(){return A(u)},set value(I){de(u,I)},$$legacy:!0}),z(E),q(P,E)};Qe(D,P=>{A(a)&&A(a).params.includes("cutoffFrequency")&&P(C)})}z(p);var N=V(p,2);const $=hc(()=>!o());fl(N,{type:"submit",get disabled(){return A($)},class:"w-full",children:(P,E)=>{Jn();var O=ni("å¤çä¿¡å·");q(P,O)},$$slots:{default:!0}}),z(f),z(h),la("submit",f,P=>{P.preventDefault(),d()}),dl(b,o),dl(v,()=>A(a),P=>de(a,P)),q(r,h),ot(),n()}/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function mc(r){return r+.5|0}const vs=(r,e,t)=>Math.max(Math.min(r,t),e);function Io(r){return vs(mc(r*2.55),0,255)}function Ps(r){return vs(mc(r*255),0,255)}function Hr(r){return vs(mc(r/2.55)/100,0,1)}function Ky(r){return vs(mc(r*100),0,100)}const $n={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},lg=[..."0123456789ABCDEF"],IR=r=>lg[r&15],CR=r=>lg[(r&240)>>4]+lg[r&15],Gc=r=>(r&240)>>4===(r&15),$R=r=>Gc(r.r)&&Gc(r.g)&&Gc(r.b)&&Gc(r.a);function MR(r){var e=r.length,t;return r[0]==="#"&&(e===4||e===5?t={r:255&$n[r[1]]*17,g:255&$n[r[2]]*17,b:255&$n[r[3]]*17,a:e===5?$n[r[4]]*17:255}:(e===7||e===9)&&(t={r:$n[r[1]]<<4|$n[r[2]],g:$n[r[3]]<<4|$n[r[4]],b:$n[r[5]]<<4|$n[r[6]],a:e===9?$n[r[7]]<<4|$n[r[8]]:255})),t}const NR=(r,e)=>r<255?e(r):"";function LR(r){var e=$R(r)?IR:CR;return r?"#"+e(r.r)+e(r.g)+e(r.b)+NR(r.a,e):void 0}const jR=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function mS(r,e,t){const n=e*Math.min(t,1-t),s=(i,a=(i+r/30)%12)=>t-n*Math.max(Math.min(a-3,9-a,1),-1);return[s(0),s(8),s(4)]}function DR(r,e,t){const n=(s,i=(s+r/60)%6)=>t-t*e*Math.max(Math.min(i,4-i,1),0);return[n(5),n(3),n(1)]}function FR(r,e,t){const n=mS(r,1,.5);let s;for(e+t>1&&(s=1/(e+t),e*=s,t*=s),s=0;s<3;s++)n[s]*=1-e-t,n[s]+=e;return n}function zR(r,e,t,n,s){return r===s?(e-t)/n+(e<t?6:0):e===s?(t-r)/n+2:(r-e)/n+4}function Tb(r){const t=r.r/255,n=r.g/255,s=r.b/255,i=Math.max(t,n,s),a=Math.min(t,n,s),o=(i+a)/2;let l,c,u;return i!==a&&(u=i-a,c=o>.5?u/(2-i-a):u/(i+a),l=zR(t,n,s,u,i),l=l*60+.5),[l|0,c||0,o]}function Rb(r,e,t,n){return(Array.isArray(e)?r(e[0],e[1],e[2]):r(e,t,n)).map(Ps)}function Ib(r,e,t){return Rb(mS,r,e,t)}function BR(r,e,t){return Rb(FR,r,e,t)}function UR(r,e,t){return Rb(DR,r,e,t)}function gS(r){return(r%360+360)%360}function qR(r){const e=jR.exec(r);let t=255,n;if(!e)return;e[5]!==n&&(t=e[6]?Io(+e[5]):Ps(+e[5]));const s=gS(+e[2]),i=+e[3]/100,a=+e[4]/100;return e[1]==="hwb"?n=BR(s,i,a):e[1]==="hsv"?n=UR(s,i,a):n=Ib(s,i,a),{r:n[0],g:n[1],b:n[2],a:t}}function HR(r,e){var t=Tb(r);t[0]=gS(t[0]+e),t=Ib(t),r.r=t[0],r.g=t[1],r.b=t[2]}function WR(r){if(!r)return;const e=Tb(r),t=e[0],n=Ky(e[1]),s=Ky(e[2]);return r.a<255?`hsla(${t}, ${n}%, ${s}%, ${Hr(r.a)})`:`hsl(${t}, ${n}%, ${s}%)`}const Xy={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Yy={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function VR(){const r={},e=Object.keys(Yy),t=Object.keys(Xy);let n,s,i,a,o;for(n=0;n<e.length;n++){for(a=o=e[n],s=0;s<t.length;s++)i=t[s],o=o.replace(i,Xy[i]);i=parseInt(Yy[a],16),r[o]=[i>>16&255,i>>8&255,i&255]}return r}let Zc;function GR(r){Zc||(Zc=VR(),Zc.transparent=[0,0,0,0]);const e=Zc[r.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const ZR=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function JR(r){const e=ZR.exec(r);let t=255,n,s,i;if(e){if(e[7]!==n){const a=+e[7];t=e[8]?Io(a):vs(a*255,0,255)}return n=+e[1],s=+e[3],i=+e[5],n=255&(e[2]?Io(n):vs(n,0,255)),s=255&(e[4]?Io(s):vs(s,0,255)),i=255&(e[6]?Io(i):vs(i,0,255)),{r:n,g:s,b:i,a:t}}}function KR(r){return r&&(r.a<255?`rgba(${r.r}, ${r.g}, ${r.b}, ${Hr(r.a)})`:`rgb(${r.r}, ${r.g}, ${r.b})`)}const Df=r=>r<=.0031308?r*12.92:Math.pow(r,1/2.4)*1.055-.055,Ni=r=>r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4);function XR(r,e,t){const n=Ni(Hr(r.r)),s=Ni(Hr(r.g)),i=Ni(Hr(r.b));return{r:Ps(Df(n+t*(Ni(Hr(e.r))-n))),g:Ps(Df(s+t*(Ni(Hr(e.g))-s))),b:Ps(Df(i+t*(Ni(Hr(e.b))-i))),a:r.a+t*(e.a-r.a)}}function Jc(r,e,t){if(r){let n=Tb(r);n[e]=Math.max(0,Math.min(n[e]+n[e]*t,e===0?360:1)),n=Ib(n),r.r=n[0],r.g=n[1],r.b=n[2]}}function bS(r,e){return r&&Object.assign(e||{},r)}function Qy(r){var e={r:0,g:0,b:0,a:255};return Array.isArray(r)?r.length>=3&&(e={r:r[0],g:r[1],b:r[2],a:255},r.length>3&&(e.a=Ps(r[3]))):(e=bS(r,{r:0,g:0,b:0,a:1}),e.a=Ps(e.a)),e}function YR(r){return r.charAt(0)==="r"?JR(r):qR(r)}class pl{constructor(e){if(e instanceof pl)return e;const t=typeof e;let n;t==="object"?n=Qy(e):t==="string"&&(n=MR(e)||GR(e)||YR(e)),this._rgb=n,this._valid=!!n}get valid(){return this._valid}get rgb(){var e=bS(this._rgb);return e&&(e.a=Hr(e.a)),e}set rgb(e){this._rgb=Qy(e)}rgbString(){return this._valid?KR(this._rgb):void 0}hexString(){return this._valid?LR(this._rgb):void 0}hslString(){return this._valid?WR(this._rgb):void 0}mix(e,t){if(e){const n=this.rgb,s=e.rgb;let i;const a=t===i?.5:t,o=2*a-1,l=n.a-s.a,c=((o*l===-1?o:(o+l)/(1+o*l))+1)/2;i=1-c,n.r=255&c*n.r+i*s.r+.5,n.g=255&c*n.g+i*s.g+.5,n.b=255&c*n.b+i*s.b+.5,n.a=a*n.a+(1-a)*s.a,this.rgb=n}return this}interpolate(e,t){return e&&(this._rgb=XR(this._rgb,e._rgb,t)),this}clone(){return new pl(this.rgb)}alpha(e){return this._rgb.a=Ps(e),this}clearer(e){const t=this._rgb;return t.a*=1-e,this}greyscale(){const e=this._rgb,t=mc(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=t,this}opaquer(e){const t=this._rgb;return t.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return Jc(this._rgb,2,e),this}darken(e){return Jc(this._rgb,2,-e),this}saturate(e){return Jc(this._rgb,1,e),this}desaturate(e){return Jc(this._rgb,1,-e),this}rotate(e){return HR(this._rgb,e),this}}/*!
 * Chart.js v4.4.9
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function $r(){}const QR=(()=>{let r=0;return()=>r++})();function Ne(r){return r==null}function ct(r){if(Array.isArray&&Array.isArray(r))return!0;const e=Object.prototype.toString.call(r);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function je(r){return r!==null&&Object.prototype.toString.call(r)==="[object Object]"}function gt(r){return(typeof r=="number"||r instanceof Number)&&isFinite(+r)}function Pn(r,e){return gt(r)?r:e}function Se(r,e){return typeof r>"u"?e:r}const eI=(r,e)=>typeof r=="string"&&r.endsWith("%")?parseFloat(r)/100:+r/e,_S=(r,e)=>typeof r=="string"&&r.endsWith("%")?parseFloat(r)/100*e:+r;function nt(r,e,t){if(r&&typeof r.call=="function")return r.apply(t,e)}function Je(r,e,t,n){let s,i,a;if(ct(r))for(i=r.length,s=0;s<i;s++)e.call(t,r[s],s);else if(je(r))for(a=Object.keys(r),i=a.length,s=0;s<i;s++)e.call(t,r[a[s]],a[s])}function _d(r,e){let t,n,s,i;if(!r||!e||r.length!==e.length)return!1;for(t=0,n=r.length;t<n;++t)if(s=r[t],i=e[t],s.datasetIndex!==i.datasetIndex||s.index!==i.index)return!1;return!0}function yd(r){if(ct(r))return r.map(yd);if(je(r)){const e=Object.create(null),t=Object.keys(r),n=t.length;let s=0;for(;s<n;++s)e[t[s]]=yd(r[t[s]]);return e}return r}function yS(r){return["__proto__","prototype","constructor"].indexOf(r)===-1}function tI(r,e,t,n){if(!yS(r))return;const s=e[r],i=t[r];je(s)&&je(i)?ml(s,i,n):e[r]=yd(i)}function ml(r,e,t){const n=ct(e)?e:[e],s=n.length;if(!je(r))return r;t=t||{};const i=t.merger||tI;let a;for(let o=0;o<s;++o){if(a=n[o],!je(a))continue;const l=Object.keys(a);for(let c=0,u=l.length;c<u;++c)i(l[c],r,a,t)}return r}function Ko(r,e){return ml(r,e,{merger:nI})}function nI(r,e,t){if(!yS(r))return;const n=e[r],s=t[r];je(n)&&je(s)?Ko(n,s):Object.prototype.hasOwnProperty.call(e,r)||(e[r]=yd(s))}const ew={"":r=>r,x:r=>r.x,y:r=>r.y};function rI(r){const e=r.split("."),t=[];let n="";for(const s of e)n+=s,n.endsWith("\\")?n=n.slice(0,-1)+".":(t.push(n),n="");return t}function sI(r){const e=rI(r);return t=>{for(const n of e){if(n==="")break;t=t&&t[n]}return t}}function Ts(r,e){return(ew[e]||(ew[e]=sI(e)))(r)}function Cb(r){return r.charAt(0).toUpperCase()+r.slice(1)}const gl=r=>typeof r<"u",Rs=r=>typeof r=="function",tw=(r,e)=>{if(r.size!==e.size)return!1;for(const t of r)if(!e.has(t))return!1;return!0};function iI(r){return r.type==="mouseup"||r.type==="click"||r.type==="contextmenu"}const it=Math.PI,st=2*it,aI=st+it,wd=Number.POSITIVE_INFINITY,oI=it/180,wt=it/2,Vs=it/4,nw=it*2/3,xs=Math.log10,Ar=Math.sign;function Xo(r,e,t){return Math.abs(r-e)<t}function rw(r){const e=Math.round(r);r=Xo(r,e,r/1e3)?e:r;const t=Math.pow(10,Math.floor(xs(r))),n=r/t;return(n<=1?1:n<=2?2:n<=5?5:10)*t}function lI(r){const e=[],t=Math.sqrt(r);let n;for(n=1;n<t;n++)r%n===0&&(e.push(n),e.push(r/n));return t===(t|0)&&e.push(t),e.sort((s,i)=>s-i).pop(),e}function cI(r){return typeof r=="symbol"||typeof r=="object"&&r!==null&&!(Symbol.toPrimitive in r||"toString"in r||"valueOf"in r)}function Ea(r){return!cI(r)&&!isNaN(parseFloat(r))&&isFinite(r)}function uI(r,e){const t=Math.round(r);return t-e<=r&&t+e>=r}function wS(r,e,t){let n,s,i;for(n=0,s=r.length;n<s;n++)i=r[n][t],isNaN(i)||(e.min=Math.min(e.min,i),e.max=Math.max(e.max,i))}function Kn(r){return r*(it/180)}function $b(r){return r*(180/it)}function sw(r){if(!gt(r))return;let e=1,t=0;for(;Math.round(r*e)/e!==r;)e*=10,t++;return t}function vS(r,e){const t=e.x-r.x,n=e.y-r.y,s=Math.sqrt(t*t+n*n);let i=Math.atan2(n,t);return i<-.5*it&&(i+=st),{angle:i,distance:s}}function cg(r,e){return Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2))}function dI(r,e){return(r-e+aI)%st-it}function On(r){return(r%st+st)%st}function bl(r,e,t,n){const s=On(r),i=On(e),a=On(t),o=On(i-s),l=On(a-s),c=On(s-i),u=On(s-a);return s===i||s===a||n&&i===a||o>l&&c<u}function Nt(r,e,t){return Math.max(e,Math.min(t,r))}function hI(r){return Nt(r,-32768,32767)}function Kr(r,e,t,n=1e-6){return r>=Math.min(e,t)-n&&r<=Math.max(e,t)+n}function Mb(r,e,t){t=t||(a=>r[a]<e);let n=r.length-1,s=0,i;for(;n-s>1;)i=s+n>>1,t(i)?s=i:n=i;return{lo:s,hi:n}}const Xr=(r,e,t,n)=>Mb(r,t,n?s=>{const i=r[s][e];return i<t||i===t&&r[s+1][e]===t}:s=>r[s][e]<t),fI=(r,e,t)=>Mb(r,t,n=>r[n][e]>=t);function pI(r,e,t){let n=0,s=r.length;for(;n<s&&r[n]<e;)n++;for(;s>n&&r[s-1]>t;)s--;return n>0||s<r.length?r.slice(n,s):r}const xS=["push","pop","shift","splice","unshift"];function mI(r,e){if(r._chartjs){r._chartjs.listeners.push(e);return}Object.defineProperty(r,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),xS.forEach(t=>{const n="_onData"+Cb(t),s=r[t];Object.defineProperty(r,t,{configurable:!0,enumerable:!1,value(...i){const a=s.apply(this,i);return r._chartjs.listeners.forEach(o=>{typeof o[n]=="function"&&o[n](...i)}),a}})})}function iw(r,e){const t=r._chartjs;if(!t)return;const n=t.listeners,s=n.indexOf(e);s!==-1&&n.splice(s,1),!(n.length>0)&&(xS.forEach(i=>{delete r[i]}),delete r._chartjs)}function kS(r){const e=new Set(r);return e.size===r.length?r:Array.from(e)}const SS=function(){return typeof window>"u"?function(r){return r()}:window.requestAnimationFrame}();function PS(r,e){let t=[],n=!1;return function(...s){t=s,n||(n=!0,SS.call(window,()=>{n=!1,r.apply(e,t)}))}}function gI(r,e){let t;return function(...n){return e?(clearTimeout(t),t=setTimeout(r,e,n)):r.apply(this,n),e}}const Nb=r=>r==="start"?"left":r==="end"?"right":"center",Zt=(r,e,t)=>r==="start"?e:r==="end"?t:(e+t)/2,bI=(r,e,t,n)=>r===(n?"left":"right")?t:r==="center"?(e+t)/2:e;function AS(r,e,t){const n=e.length;let s=0,i=n;if(r._sorted){const{iScale:a,vScale:o,_parsed:l}=r,c=r.dataset&&r.dataset.options?r.dataset.options.spanGaps:null,u=a.axis,{min:d,max:h,minDefined:f,maxDefined:p}=a.getUserBounds();if(f){if(s=Math.min(Xr(l,u,d).lo,t?n:Xr(e,u,a.getPixelForValue(d)).lo),c){const m=l.slice(0,s+1).reverse().findIndex(g=>!Ne(g[o.axis]));s-=Math.max(0,m)}s=Nt(s,0,n-1)}if(p){let m=Math.max(Xr(l,a.axis,h,!0).hi+1,t?0:Xr(e,u,a.getPixelForValue(h),!0).hi+1);if(c){const g=l.slice(m-1).findIndex(b=>!Ne(b[o.axis]));m+=Math.max(0,g)}i=Nt(m,s,n)-s}else i=n-s}return{start:s,count:i}}function ES(r){const{xScale:e,yScale:t,_scaleRanges:n}=r,s={xmin:e.min,xmax:e.max,ymin:t.min,ymax:t.max};if(!n)return r._scaleRanges=s,!0;const i=n.xmin!==e.min||n.xmax!==e.max||n.ymin!==t.min||n.ymax!==t.max;return Object.assign(n,s),i}const Kc=r=>r===0||r===1,aw=(r,e,t)=>-(Math.pow(2,10*(r-=1))*Math.sin((r-e)*st/t)),ow=(r,e,t)=>Math.pow(2,-10*r)*Math.sin((r-e)*st/t)+1,Yo={linear:r=>r,easeInQuad:r=>r*r,easeOutQuad:r=>-r*(r-2),easeInOutQuad:r=>(r/=.5)<1?.5*r*r:-.5*(--r*(r-2)-1),easeInCubic:r=>r*r*r,easeOutCubic:r=>(r-=1)*r*r+1,easeInOutCubic:r=>(r/=.5)<1?.5*r*r*r:.5*((r-=2)*r*r+2),easeInQuart:r=>r*r*r*r,easeOutQuart:r=>-((r-=1)*r*r*r-1),easeInOutQuart:r=>(r/=.5)<1?.5*r*r*r*r:-.5*((r-=2)*r*r*r-2),easeInQuint:r=>r*r*r*r*r,easeOutQuint:r=>(r-=1)*r*r*r*r+1,easeInOutQuint:r=>(r/=.5)<1?.5*r*r*r*r*r:.5*((r-=2)*r*r*r*r+2),easeInSine:r=>-Math.cos(r*wt)+1,easeOutSine:r=>Math.sin(r*wt),easeInOutSine:r=>-.5*(Math.cos(it*r)-1),easeInExpo:r=>r===0?0:Math.pow(2,10*(r-1)),easeOutExpo:r=>r===1?1:-Math.pow(2,-10*r)+1,easeInOutExpo:r=>Kc(r)?r:r<.5?.5*Math.pow(2,10*(r*2-1)):.5*(-Math.pow(2,-10*(r*2-1))+2),easeInCirc:r=>r>=1?r:-(Math.sqrt(1-r*r)-1),easeOutCirc:r=>Math.sqrt(1-(r-=1)*r),easeInOutCirc:r=>(r/=.5)<1?-.5*(Math.sqrt(1-r*r)-1):.5*(Math.sqrt(1-(r-=2)*r)+1),easeInElastic:r=>Kc(r)?r:aw(r,.075,.3),easeOutElastic:r=>Kc(r)?r:ow(r,.075,.3),easeInOutElastic(r){return Kc(r)?r:r<.5?.5*aw(r*2,.1125,.45):.5+.5*ow(r*2-1,.1125,.45)},easeInBack(r){return r*r*((1.70158+1)*r-1.70158)},easeOutBack(r){return(r-=1)*r*((1.70158+1)*r+1.70158)+1},easeInOutBack(r){let e=1.70158;return(r/=.5)<1?.5*(r*r*(((e*=1.525)+1)*r-e)):.5*((r-=2)*r*(((e*=1.525)+1)*r+e)+2)},easeInBounce:r=>1-Yo.easeOutBounce(1-r),easeOutBounce(r){return r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375},easeInOutBounce:r=>r<.5?Yo.easeInBounce(r*2)*.5:Yo.easeOutBounce(r*2-1)*.5+.5};function Lb(r){if(r&&typeof r=="object"){const e=r.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function lw(r){return Lb(r)?r:new pl(r)}function Ff(r){return Lb(r)?r:new pl(r).saturate(.5).darken(.1).hexString()}const _I=["x","y","borderWidth","radius","tension"],yI=["color","borderColor","backgroundColor"];function wI(r){r.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),r.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),r.set("animations",{colors:{type:"color",properties:yI},numbers:{type:"number",properties:_I}}),r.describe("animations",{_fallback:"animation"}),r.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function vI(r){r.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const cw=new Map;function xI(r,e){e=e||{};const t=r+JSON.stringify(e);let n=cw.get(t);return n||(n=new Intl.NumberFormat(r,e),cw.set(t,n)),n}function gc(r,e,t){return xI(e,t).format(r)}const OS={values(r){return ct(r)?r:""+r},numeric(r,e,t){if(r===0)return"0";const n=this.chart.options.locale;let s,i=r;if(t.length>1){const c=Math.max(Math.abs(t[0].value),Math.abs(t[t.length-1].value));(c<1e-4||c>1e15)&&(s="scientific"),i=kI(r,t)}const a=xs(Math.abs(i)),o=isNaN(a)?1:Math.max(Math.min(-1*Math.floor(a),20),0),l={notation:s,minimumFractionDigits:o,maximumFractionDigits:o};return Object.assign(l,this.options.ticks.format),gc(r,n,l)},logarithmic(r,e,t){if(r===0)return"0";const n=t[e].significand||r/Math.pow(10,Math.floor(xs(r)));return[1,2,3,5,10,15].includes(n)||e>.8*t.length?OS.numeric.call(this,r,e,t):""}};function kI(r,e){let t=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(t)>=1&&r!==Math.floor(r)&&(t=r-Math.floor(r)),t}var Ah={formatters:OS};function SI(r){r.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,t)=>t.lineWidth,tickColor:(e,t)=>t.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Ah.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),r.route("scale.ticks","color","","color"),r.route("scale.grid","color","","borderColor"),r.route("scale.border","color","","borderColor"),r.route("scale.title","color","","color"),r.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),r.describe("scales",{_fallback:"scale"}),r.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}const mi=Object.create(null),ug=Object.create(null);function Qo(r,e){if(!e)return r;const t=e.split(".");for(let n=0,s=t.length;n<s;++n){const i=t[n];r=r[i]||(r[i]=Object.create(null))}return r}function zf(r,e,t){return typeof e=="string"?ml(Qo(r,e),t):ml(Qo(r,""),e)}class PI{constructor(e,t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=n=>n.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(n,s)=>Ff(s.backgroundColor),this.hoverBorderColor=(n,s)=>Ff(s.borderColor),this.hoverColor=(n,s)=>Ff(s.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(t)}set(e,t){return zf(this,e,t)}get(e){return Qo(this,e)}describe(e,t){return zf(ug,e,t)}override(e,t){return zf(mi,e,t)}route(e,t,n,s){const i=Qo(this,e),a=Qo(this,n),o="_"+t;Object.defineProperties(i,{[o]:{value:i[t],writable:!0},[t]:{enumerable:!0,get(){const l=this[o],c=a[s];return je(l)?Object.assign({},c,l):Se(l,c)},set(l){this[o]=l}}})}apply(e){e.forEach(t=>t(this))}}var ut=new PI({_scriptable:r=>!r.startsWith("on"),_indexable:r=>r!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[wI,vI,SI]);function AI(r){return!r||Ne(r.size)||Ne(r.family)?null:(r.style?r.style+" ":"")+(r.weight?r.weight+" ":"")+r.size+"px "+r.family}function vd(r,e,t,n,s){let i=e[s];return i||(i=e[s]=r.measureText(s).width,t.push(s)),i>n&&(n=i),n}function EI(r,e,t,n){n=n||{};let s=n.data=n.data||{},i=n.garbageCollect=n.garbageCollect||[];n.font!==e&&(s=n.data={},i=n.garbageCollect=[],n.font=e),r.save(),r.font=e;let a=0;const o=t.length;let l,c,u,d,h;for(l=0;l<o;l++)if(d=t[l],d!=null&&!ct(d))a=vd(r,s,i,a,d);else if(ct(d))for(c=0,u=d.length;c<u;c++)h=d[c],h!=null&&!ct(h)&&(a=vd(r,s,i,a,h));r.restore();const f=i.length/2;if(f>t.length){for(l=0;l<f;l++)delete s[i[l]];i.splice(0,f)}return a}function Gs(r,e,t){const n=r.currentDevicePixelRatio,s=t!==0?Math.max(t/2,.5):0;return Math.round((e-s)*n)/n+s}function uw(r,e){!e&&!r||(e=e||r.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,r.width,r.height),e.restore())}function dg(r,e,t,n){TS(r,e,t,n,null)}function TS(r,e,t,n,s){let i,a,o,l,c,u,d,h;const f=e.pointStyle,p=e.rotation,m=e.radius;let g=(p||0)*oI;if(f&&typeof f=="object"&&(i=f.toString(),i==="[object HTMLImageElement]"||i==="[object HTMLCanvasElement]")){r.save(),r.translate(t,n),r.rotate(g),r.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),r.restore();return}if(!(isNaN(m)||m<=0)){switch(r.beginPath(),f){default:s?r.ellipse(t,n,s/2,m,0,0,st):r.arc(t,n,m,0,st),r.closePath();break;case"triangle":u=s?s/2:m,r.moveTo(t+Math.sin(g)*u,n-Math.cos(g)*m),g+=nw,r.lineTo(t+Math.sin(g)*u,n-Math.cos(g)*m),g+=nw,r.lineTo(t+Math.sin(g)*u,n-Math.cos(g)*m),r.closePath();break;case"rectRounded":c=m*.516,l=m-c,a=Math.cos(g+Vs)*l,d=Math.cos(g+Vs)*(s?s/2-c:l),o=Math.sin(g+Vs)*l,h=Math.sin(g+Vs)*(s?s/2-c:l),r.arc(t-d,n-o,c,g-it,g-wt),r.arc(t+h,n-a,c,g-wt,g),r.arc(t+d,n+o,c,g,g+wt),r.arc(t-h,n+a,c,g+wt,g+it),r.closePath();break;case"rect":if(!p){l=Math.SQRT1_2*m,u=s?s/2:l,r.rect(t-u,n-l,2*u,2*l);break}g+=Vs;case"rectRot":d=Math.cos(g)*(s?s/2:m),a=Math.cos(g)*m,o=Math.sin(g)*m,h=Math.sin(g)*(s?s/2:m),r.moveTo(t-d,n-o),r.lineTo(t+h,n-a),r.lineTo(t+d,n+o),r.lineTo(t-h,n+a),r.closePath();break;case"crossRot":g+=Vs;case"cross":d=Math.cos(g)*(s?s/2:m),a=Math.cos(g)*m,o=Math.sin(g)*m,h=Math.sin(g)*(s?s/2:m),r.moveTo(t-d,n-o),r.lineTo(t+d,n+o),r.moveTo(t+h,n-a),r.lineTo(t-h,n+a);break;case"star":d=Math.cos(g)*(s?s/2:m),a=Math.cos(g)*m,o=Math.sin(g)*m,h=Math.sin(g)*(s?s/2:m),r.moveTo(t-d,n-o),r.lineTo(t+d,n+o),r.moveTo(t+h,n-a),r.lineTo(t-h,n+a),g+=Vs,d=Math.cos(g)*(s?s/2:m),a=Math.cos(g)*m,o=Math.sin(g)*m,h=Math.sin(g)*(s?s/2:m),r.moveTo(t-d,n-o),r.lineTo(t+d,n+o),r.moveTo(t+h,n-a),r.lineTo(t-h,n+a);break;case"line":a=s?s/2:Math.cos(g)*m,o=Math.sin(g)*m,r.moveTo(t-a,n-o),r.lineTo(t+a,n+o);break;case"dash":r.moveTo(t,n),r.lineTo(t+Math.cos(g)*(s?s/2:m),n+Math.sin(g)*m);break;case!1:r.closePath();break}r.fill(),e.borderWidth>0&&r.stroke()}}function Yr(r,e,t){return t=t||.5,!e||r&&r.x>e.left-t&&r.x<e.right+t&&r.y>e.top-t&&r.y<e.bottom+t}function Eh(r,e){r.save(),r.beginPath(),r.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),r.clip()}function Oh(r){r.restore()}function OI(r,e,t,n,s){if(!e)return r.lineTo(t.x,t.y);if(s==="middle"){const i=(e.x+t.x)/2;r.lineTo(i,e.y),r.lineTo(i,t.y)}else s==="after"!=!!n?r.lineTo(e.x,t.y):r.lineTo(t.x,e.y);r.lineTo(t.x,t.y)}function TI(r,e,t,n){if(!e)return r.lineTo(t.x,t.y);r.bezierCurveTo(n?e.cp1x:e.cp2x,n?e.cp1y:e.cp2y,n?t.cp2x:t.cp1x,n?t.cp2y:t.cp1y,t.x,t.y)}function RI(r,e){e.translation&&r.translate(e.translation[0],e.translation[1]),Ne(e.rotation)||r.rotate(e.rotation),e.color&&(r.fillStyle=e.color),e.textAlign&&(r.textAlign=e.textAlign),e.textBaseline&&(r.textBaseline=e.textBaseline)}function II(r,e,t,n,s){if(s.strikethrough||s.underline){const i=r.measureText(n),a=e-i.actualBoundingBoxLeft,o=e+i.actualBoundingBoxRight,l=t-i.actualBoundingBoxAscent,c=t+i.actualBoundingBoxDescent,u=s.strikethrough?(l+c)/2:c;r.strokeStyle=r.fillStyle,r.beginPath(),r.lineWidth=s.decorationWidth||2,r.moveTo(a,u),r.lineTo(o,u),r.stroke()}}function CI(r,e){const t=r.fillStyle;r.fillStyle=e.color,r.fillRect(e.left,e.top,e.width,e.height),r.fillStyle=t}function gi(r,e,t,n,s,i={}){const a=ct(e)?e:[e],o=i.strokeWidth>0&&i.strokeColor!=="";let l,c;for(r.save(),r.font=s.string,RI(r,i),l=0;l<a.length;++l)c=a[l],i.backdrop&&CI(r,i.backdrop),o&&(i.strokeColor&&(r.strokeStyle=i.strokeColor),Ne(i.strokeWidth)||(r.lineWidth=i.strokeWidth),r.strokeText(c,t,n,i.maxWidth)),r.fillText(c,t,n,i.maxWidth),II(r,t,n,c,i),n+=Number(s.lineHeight);r.restore()}function _l(r,e){const{x:t,y:n,w:s,h:i,radius:a}=e;r.arc(t+a.topLeft,n+a.topLeft,a.topLeft,1.5*it,it,!0),r.lineTo(t,n+i-a.bottomLeft),r.arc(t+a.bottomLeft,n+i-a.bottomLeft,a.bottomLeft,it,wt,!0),r.lineTo(t+s-a.bottomRight,n+i),r.arc(t+s-a.bottomRight,n+i-a.bottomRight,a.bottomRight,wt,0,!0),r.lineTo(t+s,n+a.topRight),r.arc(t+s-a.topRight,n+a.topRight,a.topRight,0,-wt,!0),r.lineTo(t+a.topLeft,n)}const $I=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,MI=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function NI(r,e){const t=(""+r).match($I);if(!t||t[1]==="normal")return e*1.2;switch(r=+t[2],t[3]){case"px":return r;case"%":r/=100;break}return e*r}const LI=r=>+r||0;function jb(r,e){const t={},n=je(e),s=n?Object.keys(e):e,i=je(r)?n?a=>Se(r[a],r[e[a]]):a=>r[a]:()=>r;for(const a of s)t[a]=LI(i(a));return t}function RS(r){return jb(r,{top:"y",right:"x",bottom:"y",left:"x"})}function ci(r){return jb(r,["topLeft","topRight","bottomLeft","bottomRight"])}function Xt(r){const e=RS(r);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function Ot(r,e){r=r||{},e=e||ut.font;let t=Se(r.size,e.size);typeof t=="string"&&(t=parseInt(t,10));let n=Se(r.style,e.style);n&&!(""+n).match(MI)&&(console.warn('Invalid font style specified: "'+n+'"'),n=void 0);const s={family:Se(r.family,e.family),lineHeight:NI(Se(r.lineHeight,e.lineHeight),t),size:t,style:n,weight:Se(r.weight,e.weight),string:""};return s.string=AI(s),s}function Co(r,e,t,n){let s,i,a;for(s=0,i=r.length;s<i;++s)if(a=r[s],a!==void 0&&a!==void 0)return a}function jI(r,e,t){const{min:n,max:s}=r,i=_S(e,(s-n)/2),a=(o,l)=>t&&o===0?0:o+l;return{min:a(n,-Math.abs(i)),max:a(s,i)}}function Fs(r,e){return Object.assign(Object.create(r),e)}function Db(r,e=[""],t,n,s=()=>r[0]){const i=t||r;typeof n>"u"&&(n=MS("_fallback",r));const a={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:r,_rootScopes:i,_fallback:n,_getTarget:s,override:o=>Db([o,...r],e,i,n)};return new Proxy(a,{deleteProperty(o,l){return delete o[l],delete o._keys,delete r[0][l],!0},get(o,l){return CS(o,l,()=>WI(l,e,r,o))},getOwnPropertyDescriptor(o,l){return Reflect.getOwnPropertyDescriptor(o._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(r[0])},has(o,l){return hw(o).includes(l)},ownKeys(o){return hw(o)},set(o,l,c){const u=o._storage||(o._storage=s());return o[l]=u[l]=c,delete o._keys,!0}})}function Oa(r,e,t,n){const s={_cacheable:!1,_proxy:r,_context:e,_subProxy:t,_stack:new Set,_descriptors:IS(r,n),setContext:i=>Oa(r,i,t,n),override:i=>Oa(r.override(i),e,t,n)};return new Proxy(s,{deleteProperty(i,a){return delete i[a],delete r[a],!0},get(i,a,o){return CS(i,a,()=>FI(i,a,o))},getOwnPropertyDescriptor(i,a){return i._descriptors.allKeys?Reflect.has(r,a)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(r,a)},getPrototypeOf(){return Reflect.getPrototypeOf(r)},has(i,a){return Reflect.has(r,a)},ownKeys(){return Reflect.ownKeys(r)},set(i,a,o){return r[a]=o,delete i[a],!0}})}function IS(r,e={scriptable:!0,indexable:!0}){const{_scriptable:t=e.scriptable,_indexable:n=e.indexable,_allKeys:s=e.allKeys}=r;return{allKeys:s,scriptable:t,indexable:n,isScriptable:Rs(t)?t:()=>t,isIndexable:Rs(n)?n:()=>n}}const DI=(r,e)=>r?r+Cb(e):e,Fb=(r,e)=>je(e)&&r!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function CS(r,e,t){if(Object.prototype.hasOwnProperty.call(r,e)||e==="constructor")return r[e];const n=t();return r[e]=n,n}function FI(r,e,t){const{_proxy:n,_context:s,_subProxy:i,_descriptors:a}=r;let o=n[e];return Rs(o)&&a.isScriptable(e)&&(o=zI(e,o,r,t)),ct(o)&&o.length&&(o=BI(e,o,r,a.isIndexable)),Fb(e,o)&&(o=Oa(o,s,i&&i[e],a)),o}function zI(r,e,t,n){const{_proxy:s,_context:i,_subProxy:a,_stack:o}=t;if(o.has(r))throw new Error("Recursion detected: "+Array.from(o).join("->")+"->"+r);o.add(r);let l=e(i,a||n);return o.delete(r),Fb(r,l)&&(l=zb(s._scopes,s,r,l)),l}function BI(r,e,t,n){const{_proxy:s,_context:i,_subProxy:a,_descriptors:o}=t;if(typeof i.index<"u"&&n(r))return e[i.index%e.length];if(je(e[0])){const l=e,c=s._scopes.filter(u=>u!==l);e=[];for(const u of l){const d=zb(c,s,r,u);e.push(Oa(d,i,a&&a[r],o))}}return e}function $S(r,e,t){return Rs(r)?r(e,t):r}const UI=(r,e)=>r===!0?e:typeof r=="string"?Ts(e,r):void 0;function qI(r,e,t,n,s){for(const i of e){const a=UI(t,i);if(a){r.add(a);const o=$S(a._fallback,t,s);if(typeof o<"u"&&o!==t&&o!==n)return o}else if(a===!1&&typeof n<"u"&&t!==n)return null}return!1}function zb(r,e,t,n){const s=e._rootScopes,i=$S(e._fallback,t,n),a=[...r,...s],o=new Set;o.add(n);let l=dw(o,a,t,i||t,n);return l===null||typeof i<"u"&&i!==t&&(l=dw(o,a,i,l,n),l===null)?!1:Db(Array.from(o),[""],s,i,()=>HI(e,t,n))}function dw(r,e,t,n,s){for(;t;)t=qI(r,e,t,n,s);return t}function HI(r,e,t){const n=r._getTarget();e in n||(n[e]={});const s=n[e];return ct(s)&&je(t)?t:s||{}}function WI(r,e,t,n){let s;for(const i of e)if(s=MS(DI(i,r),t),typeof s<"u")return Fb(r,s)?zb(t,n,r,s):s}function MS(r,e){for(const t of e){if(!t)continue;const n=t[r];if(typeof n<"u")return n}}function hw(r){let e=r._keys;return e||(e=r._keys=VI(r._scopes)),e}function VI(r){const e=new Set;for(const t of r)for(const n of Object.keys(t).filter(s=>!s.startsWith("_")))e.add(n);return Array.from(e)}function NS(r,e,t,n){const{iScale:s}=r,{key:i="r"}=this._parsing,a=new Array(n);let o,l,c,u;for(o=0,l=n;o<l;++o)c=o+t,u=e[c],a[o]={r:s.parse(Ts(u,i),c)};return a}const GI=Number.EPSILON||1e-14,Ta=(r,e)=>e<r.length&&!r[e].skip&&r[e],LS=r=>r==="x"?"y":"x";function ZI(r,e,t,n){const s=r.skip?e:r,i=e,a=t.skip?e:t,o=cg(i,s),l=cg(a,i);let c=o/(o+l),u=l/(o+l);c=isNaN(c)?0:c,u=isNaN(u)?0:u;const d=n*c,h=n*u;return{previous:{x:i.x-d*(a.x-s.x),y:i.y-d*(a.y-s.y)},next:{x:i.x+h*(a.x-s.x),y:i.y+h*(a.y-s.y)}}}function JI(r,e,t){const n=r.length;let s,i,a,o,l,c=Ta(r,0);for(let u=0;u<n-1;++u)if(l=c,c=Ta(r,u+1),!(!l||!c)){if(Xo(e[u],0,GI)){t[u]=t[u+1]=0;continue}s=t[u]/e[u],i=t[u+1]/e[u],o=Math.pow(s,2)+Math.pow(i,2),!(o<=9)&&(a=3/Math.sqrt(o),t[u]=s*a*e[u],t[u+1]=i*a*e[u])}}function KI(r,e,t="x"){const n=LS(t),s=r.length;let i,a,o,l=Ta(r,0);for(let c=0;c<s;++c){if(a=o,o=l,l=Ta(r,c+1),!o)continue;const u=o[t],d=o[n];a&&(i=(u-a[t])/3,o[`cp1${t}`]=u-i,o[`cp1${n}`]=d-i*e[c]),l&&(i=(l[t]-u)/3,o[`cp2${t}`]=u+i,o[`cp2${n}`]=d+i*e[c])}}function XI(r,e="x"){const t=LS(e),n=r.length,s=Array(n).fill(0),i=Array(n);let a,o,l,c=Ta(r,0);for(a=0;a<n;++a)if(o=l,l=c,c=Ta(r,a+1),!!l){if(c){const u=c[e]-l[e];s[a]=u!==0?(c[t]-l[t])/u:0}i[a]=o?c?Ar(s[a-1])!==Ar(s[a])?0:(s[a-1]+s[a])/2:s[a-1]:s[a]}JI(r,s,i),KI(r,i,e)}function Xc(r,e,t){return Math.max(Math.min(r,t),e)}function YI(r,e){let t,n,s,i,a,o=Yr(r[0],e);for(t=0,n=r.length;t<n;++t)a=i,i=o,o=t<n-1&&Yr(r[t+1],e),i&&(s=r[t],a&&(s.cp1x=Xc(s.cp1x,e.left,e.right),s.cp1y=Xc(s.cp1y,e.top,e.bottom)),o&&(s.cp2x=Xc(s.cp2x,e.left,e.right),s.cp2y=Xc(s.cp2y,e.top,e.bottom)))}function QI(r,e,t,n,s){let i,a,o,l;if(e.spanGaps&&(r=r.filter(c=>!c.skip)),e.cubicInterpolationMode==="monotone")XI(r,s);else{let c=n?r[r.length-1]:r[0];for(i=0,a=r.length;i<a;++i)o=r[i],l=ZI(c,o,r[Math.min(i+1,a-(n?0:1))%a],e.tension),o.cp1x=l.previous.x,o.cp1y=l.previous.y,o.cp2x=l.next.x,o.cp2y=l.next.y,c=o}e.capBezierPoints&&YI(r,t)}function Bb(){return typeof window<"u"&&typeof document<"u"}function Ub(r){let e=r.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function xd(r,e,t){let n;return typeof r=="string"?(n=parseInt(r,10),r.indexOf("%")!==-1&&(n=n/100*e.parentNode[t])):n=r,n}const Th=r=>r.ownerDocument.defaultView.getComputedStyle(r,null);function eC(r,e){return Th(r).getPropertyValue(e)}const tC=["top","right","bottom","left"];function ui(r,e,t){const n={};t=t?"-"+t:"";for(let s=0;s<4;s++){const i=tC[s];n[i]=parseFloat(r[e+"-"+i+t])||0}return n.width=n.left+n.right,n.height=n.top+n.bottom,n}const nC=(r,e,t)=>(r>0||e>0)&&(!t||!t.shadowRoot);function rC(r,e){const t=r.touches,n=t&&t.length?t[0]:r,{offsetX:s,offsetY:i}=n;let a=!1,o,l;if(nC(s,i,r.target))o=s,l=i;else{const c=e.getBoundingClientRect();o=n.clientX-c.left,l=n.clientY-c.top,a=!0}return{x:o,y:l,box:a}}function Qs(r,e){if("native"in r)return r;const{canvas:t,currentDevicePixelRatio:n}=e,s=Th(t),i=s.boxSizing==="border-box",a=ui(s,"padding"),o=ui(s,"border","width"),{x:l,y:c,box:u}=rC(r,t),d=a.left+(u&&o.left),h=a.top+(u&&o.top);let{width:f,height:p}=e;return i&&(f-=a.width+o.width,p-=a.height+o.height),{x:Math.round((l-d)/f*t.width/n),y:Math.round((c-h)/p*t.height/n)}}function sC(r,e,t){let n,s;if(e===void 0||t===void 0){const i=r&&Ub(r);if(!i)e=r.clientWidth,t=r.clientHeight;else{const a=i.getBoundingClientRect(),o=Th(i),l=ui(o,"border","width"),c=ui(o,"padding");e=a.width-c.width-l.width,t=a.height-c.height-l.height,n=xd(o.maxWidth,i,"clientWidth"),s=xd(o.maxHeight,i,"clientHeight")}}return{width:e,height:t,maxWidth:n||wd,maxHeight:s||wd}}const Yc=r=>Math.round(r*10)/10;function iC(r,e,t,n){const s=Th(r),i=ui(s,"margin"),a=xd(s.maxWidth,r,"clientWidth")||wd,o=xd(s.maxHeight,r,"clientHeight")||wd,l=sC(r,e,t);let{width:c,height:u}=l;if(s.boxSizing==="content-box"){const h=ui(s,"border","width"),f=ui(s,"padding");c-=f.width+h.width,u-=f.height+h.height}return c=Math.max(0,c-i.width),u=Math.max(0,n?c/n:u-i.height),c=Yc(Math.min(c,a,l.maxWidth)),u=Yc(Math.min(u,o,l.maxHeight)),c&&!u&&(u=Yc(c/2)),(e!==void 0||t!==void 0)&&n&&l.height&&u>l.height&&(u=l.height,c=Yc(Math.floor(u*n))),{width:c,height:u}}function fw(r,e,t){const n=e||1,s=Math.floor(r.height*n),i=Math.floor(r.width*n);r.height=Math.floor(r.height),r.width=Math.floor(r.width);const a=r.canvas;return a.style&&(t||!a.style.height&&!a.style.width)&&(a.style.height=`${r.height}px`,a.style.width=`${r.width}px`),r.currentDevicePixelRatio!==n||a.height!==s||a.width!==i?(r.currentDevicePixelRatio=n,a.height=s,a.width=i,r.ctx.setTransform(n,0,0,n,0,0),!0):!1}const aC=function(){let r=!1;try{const e={get passive(){return r=!0,!1}};Bb()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch{}return r}();function pw(r,e){const t=eC(r,e),n=t&&t.match(/^(\d+)(\.\d+)?px$/);return n?+n[1]:void 0}function ei(r,e,t,n){return{x:r.x+t*(e.x-r.x),y:r.y+t*(e.y-r.y)}}function oC(r,e,t,n){return{x:r.x+t*(e.x-r.x),y:n==="middle"?t<.5?r.y:e.y:n==="after"?t<1?r.y:e.y:t>0?e.y:r.y}}function lC(r,e,t,n){const s={x:r.cp2x,y:r.cp2y},i={x:e.cp1x,y:e.cp1y},a=ei(r,s,t),o=ei(s,i,t),l=ei(i,e,t),c=ei(a,o,t),u=ei(o,l,t);return ei(c,u,t)}const cC=function(r,e){return{x(t){return r+r+e-t},setWidth(t){e=t},textAlign(t){return t==="center"?t:t==="right"?"left":"right"},xPlus(t,n){return t-n},leftForLtr(t,n){return t-n}}},uC=function(){return{x(r){return r},setWidth(r){},textAlign(r){return r},xPlus(r,e){return r+e},leftForLtr(r,e){return r}}};function ca(r,e,t){return r?cC(e,t):uC()}function jS(r,e){let t,n;(e==="ltr"||e==="rtl")&&(t=r.canvas.style,n=[t.getPropertyValue("direction"),t.getPropertyPriority("direction")],t.setProperty("direction",e,"important"),r.prevTextDirection=n)}function DS(r,e){e!==void 0&&(delete r.prevTextDirection,r.canvas.style.setProperty("direction",e[0],e[1]))}function FS(r){return r==="angle"?{between:bl,compare:dI,normalize:On}:{between:Kr,compare:(e,t)=>e-t,normalize:e=>e}}function mw({start:r,end:e,count:t,loop:n,style:s}){return{start:r%t,end:e%t,loop:n&&(e-r+1)%t===0,style:s}}function dC(r,e,t){const{property:n,start:s,end:i}=t,{between:a,normalize:o}=FS(n),l=e.length;let{start:c,end:u,loop:d}=r,h,f;if(d){for(c+=l,u+=l,h=0,f=l;h<f&&a(o(e[c%l][n]),s,i);++h)c--,u--;c%=l,u%=l}return u<c&&(u+=l),{start:c,end:u,loop:d,style:r.style}}function zS(r,e,t){if(!t)return[r];const{property:n,start:s,end:i}=t,a=e.length,{compare:o,between:l,normalize:c}=FS(n),{start:u,end:d,loop:h,style:f}=dC(r,e,t),p=[];let m=!1,g=null,b,_,y;const w=()=>l(s,y,b)&&o(s,y)!==0,v=()=>o(i,b)===0||l(i,y,b),x=()=>m||w(),S=()=>!m||v();for(let k=u,R=u;k<=d;++k)_=e[k%a],!_.skip&&(b=c(_[n]),b!==y&&(m=l(b,s,i),g===null&&x()&&(g=o(b,s)===0?k:R),g!==null&&S()&&(p.push(mw({start:g,end:k,loop:h,count:a,style:f})),g=null),R=k,y=b));return g!==null&&p.push(mw({start:g,end:d,loop:h,count:a,style:f})),p}function BS(r,e){const t=[],n=r.segments;for(let s=0;s<n.length;s++){const i=zS(n[s],r.points,e);i.length&&t.push(...i)}return t}function hC(r,e,t,n){let s=0,i=e-1;if(t&&!n)for(;s<e&&!r[s].skip;)s++;for(;s<e&&r[s].skip;)s++;for(s%=e,t&&(i+=s);i>s&&r[i%e].skip;)i--;return i%=e,{start:s,end:i}}function fC(r,e,t,n){const s=r.length,i=[];let a=e,o=r[e],l;for(l=e+1;l<=t;++l){const c=r[l%s];c.skip||c.stop?o.skip||(n=!1,i.push({start:e%s,end:(l-1)%s,loop:n}),e=a=c.stop?l:null):(a=l,o.skip&&(e=l)),o=c}return a!==null&&i.push({start:e%s,end:a%s,loop:n}),i}function pC(r,e){const t=r.points,n=r.options.spanGaps,s=t.length;if(!s)return[];const i=!!r._loop,{start:a,end:o}=hC(t,s,i,n);if(n===!0)return gw(r,[{start:a,end:o,loop:i}],t,e);const l=o<a?o+s:o,c=!!r._fullLoop&&a===0&&o===s-1;return gw(r,fC(t,a,l,c),t,e)}function gw(r,e,t,n){return!n||!n.setContext||!t?e:mC(r,e,t,n)}function mC(r,e,t,n){const s=r._chart.getContext(),i=bw(r.options),{_datasetIndex:a,options:{spanGaps:o}}=r,l=t.length,c=[];let u=i,d=e[0].start,h=d;function f(p,m,g,b){const _=o?-1:1;if(p!==m){for(p+=l;t[p%l].skip;)p-=_;for(;t[m%l].skip;)m+=_;p%l!==m%l&&(c.push({start:p%l,end:m%l,loop:g,style:b}),u=b,d=m%l)}}for(const p of e){d=o?d:p.start;let m=t[d%l],g;for(h=d+1;h<=p.end;h++){const b=t[h%l];g=bw(n.setContext(Fs(s,{type:"segment",p0:m,p1:b,p0DataIndex:(h-1)%l,p1DataIndex:h%l,datasetIndex:a}))),gC(g,u)&&f(d,h-1,p.loop,u),m=b,u=g}d<h-1&&f(d,h-1,p.loop,u)}return c}function bw(r){return{backgroundColor:r.backgroundColor,borderCapStyle:r.borderCapStyle,borderDash:r.borderDash,borderDashOffset:r.borderDashOffset,borderJoinStyle:r.borderJoinStyle,borderWidth:r.borderWidth,borderColor:r.borderColor}}function gC(r,e){if(!e)return!1;const t=[],n=function(s,i){return Lb(i)?(t.includes(i)||t.push(i),t.indexOf(i)):i};return JSON.stringify(r,n)!==JSON.stringify(e,n)}function Qc(r,e,t){return r.options.clip?r[t]:e[t]}function bC(r,e){const{xScale:t,yScale:n}=r;return t&&n?{left:Qc(t,e,"left"),right:Qc(t,e,"right"),top:Qc(n,e,"top"),bottom:Qc(n,e,"bottom")}:e}function US(r,e){const t=e._clip;if(t.disabled)return!1;const n=bC(e,r.chartArea);return{left:t.left===!1?0:n.left-(t.left===!0?0:t.left),right:t.right===!1?r.width:n.right+(t.right===!0?0:t.right),top:t.top===!1?0:n.top-(t.top===!0?0:t.top),bottom:t.bottom===!1?r.height:n.bottom+(t.bottom===!0?0:t.bottom)}}/*!
 * Chart.js v4.4.9
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class _C{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,n,s){const i=t.listeners[s],a=t.duration;i.forEach(o=>o({chart:e,initial:t.initial,numSteps:a,currentStep:Math.min(n-t.start,a)}))}_refresh(){this._request||(this._running=!0,this._request=SS.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let t=0;this._charts.forEach((n,s)=>{if(!n.running||!n.items.length)return;const i=n.items;let a=i.length-1,o=!1,l;for(;a>=0;--a)l=i[a],l._active?(l._total>n.duration&&(n.duration=l._total),l.tick(e),o=!0):(i[a]=i[i.length-1],i.pop());o&&(s.draw(),this._notify(s,n,e,"progress")),i.length||(n.running=!1,this._notify(s,n,e,"complete"),n.initial=!1),t+=i.length}),this._lastDate=e,t===0&&(this._running=!1)}_getAnims(e){const t=this._charts;let n=t.get(e);return n||(n={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,n)),n}listen(e,t,n){this._getAnims(e).listeners[t].push(n)}add(e,t){!t||!t.length||this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){const t=this._charts.get(e);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce((n,s)=>Math.max(n,s._duration),0),this._refresh())}running(e){if(!this._running)return!1;const t=this._charts.get(e);return!(!t||!t.running||!t.items.length)}stop(e){const t=this._charts.get(e);if(!t||!t.items.length)return;const n=t.items;let s=n.length-1;for(;s>=0;--s)n[s].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var Dr=new _C;const _w="transparent",yC={boolean(r,e,t){return t>.5?e:r},color(r,e,t){const n=lw(r||_w),s=n.valid&&lw(e||_w);return s&&s.valid?s.mix(n,t).hexString():e},number(r,e,t){return r+(e-r)*t}};class wC{constructor(e,t,n,s){const i=t[n];s=Co([e.to,s,i,e.from]);const a=Co([e.from,i,s]);this._active=!0,this._fn=e.fn||yC[e.type||typeof a],this._easing=Yo[e.easing]||Yo.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=n,this._from=a,this._to=s,this._promises=void 0}active(){return this._active}update(e,t,n){if(this._active){this._notify(!1);const s=this._target[this._prop],i=n-this._start,a=this._duration-i;this._start=n,this._duration=Math.floor(Math.max(a,e.duration)),this._total+=i,this._loop=!!e.loop,this._to=Co([e.to,t,s,e.from]),this._from=Co([e.from,s,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const t=e-this._start,n=this._duration,s=this._prop,i=this._from,a=this._loop,o=this._to;let l;if(this._active=i!==o&&(a||t<n),!this._active){this._target[s]=o,this._notify(!0);return}if(t<0){this._target[s]=i;return}l=t/n%2,l=a&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[s]=this._fn(i,o,l)}wait(){const e=this._promises||(this._promises=[]);return new Promise((t,n)=>{e.push({res:t,rej:n})})}_notify(e){const t=e?"res":"rej",n=this._promises||[];for(let s=0;s<n.length;s++)n[s][t]()}}class qS{constructor(e,t){this._chart=e,this._properties=new Map,this.configure(t)}configure(e){if(!je(e))return;const t=Object.keys(ut.animation),n=this._properties;Object.getOwnPropertyNames(e).forEach(s=>{const i=e[s];if(!je(i))return;const a={};for(const o of t)a[o]=i[o];(ct(i.properties)&&i.properties||[s]).forEach(o=>{(o===s||!n.has(o))&&n.set(o,a)})})}_animateOptions(e,t){const n=t.options,s=xC(e,n);if(!s)return[];const i=this._createAnimations(s,n);return n.$shared&&vC(e.options.$animations,n).then(()=>{e.options=n},()=>{}),i}_createAnimations(e,t){const n=this._properties,s=[],i=e.$animations||(e.$animations={}),a=Object.keys(t),o=Date.now();let l;for(l=a.length-1;l>=0;--l){const c=a[l];if(c.charAt(0)==="$")continue;if(c==="options"){s.push(...this._animateOptions(e,t));continue}const u=t[c];let d=i[c];const h=n.get(c);if(d)if(h&&d.active()){d.update(h,u,o);continue}else d.cancel();if(!h||!h.duration){e[c]=u;continue}i[c]=d=new wC(h,e,c,u),s.push(d)}return s}update(e,t){if(this._properties.size===0){Object.assign(e,t);return}const n=this._createAnimations(e,t);if(n.length)return Dr.add(this._chart,n),!0}}function vC(r,e){const t=[],n=Object.keys(e);for(let s=0;s<n.length;s++){const i=r[n[s]];i&&i.active()&&t.push(i.wait())}return Promise.all(t)}function xC(r,e){if(!e)return;let t=r.options;if(!t){r.options=e;return}return t.$shared&&(r.options=t=Object.assign({},t,{$shared:!1,$animations:{}})),t}function yw(r,e){const t=r&&r.options||{},n=t.reverse,s=t.min===void 0?e:0,i=t.max===void 0?e:0;return{start:n?i:s,end:n?s:i}}function kC(r,e,t){if(t===!1)return!1;const n=yw(r,t),s=yw(e,t);return{top:s.end,right:n.end,bottom:s.start,left:n.start}}function SC(r){let e,t,n,s;return je(r)?(e=r.top,t=r.right,n=r.bottom,s=r.left):e=t=n=s=r,{top:e,right:t,bottom:n,left:s,disabled:r===!1}}function HS(r,e){const t=[],n=r._getSortedDatasetMetas(e);let s,i;for(s=0,i=n.length;s<i;++s)t.push(n[s].index);return t}function ww(r,e,t,n={}){const s=r.keys,i=n.mode==="single";let a,o,l,c;if(e===null)return;let u=!1;for(a=0,o=s.length;a<o;++a){if(l=+s[a],l===t){if(u=!0,n.all)continue;break}c=r.values[l],gt(c)&&(i||e===0||Ar(e)===Ar(c))&&(e+=c)}return!u&&!n.all?0:e}function PC(r,e){const{iScale:t,vScale:n}=e,s=t.axis==="x"?"x":"y",i=n.axis==="x"?"x":"y",a=Object.keys(r),o=new Array(a.length);let l,c,u;for(l=0,c=a.length;l<c;++l)u=a[l],o[l]={[s]:u,[i]:r[u]};return o}function Bf(r,e){const t=r&&r.options.stacked;return t||t===void 0&&e.stack!==void 0}function AC(r,e,t){return`${r.id}.${e.id}.${t.stack||t.type}`}function EC(r){const{min:e,max:t,minDefined:n,maxDefined:s}=r.getUserBounds();return{min:n?e:Number.NEGATIVE_INFINITY,max:s?t:Number.POSITIVE_INFINITY}}function OC(r,e,t){const n=r[e]||(r[e]={});return n[t]||(n[t]={})}function vw(r,e,t,n){for(const s of e.getMatchingVisibleMetas(n).reverse()){const i=r[s.index];if(t&&i>0||!t&&i<0)return s.index}return null}function xw(r,e){const{chart:t,_cachedMeta:n}=r,s=t._stacks||(t._stacks={}),{iScale:i,vScale:a,index:o}=n,l=i.axis,c=a.axis,u=AC(i,a,n),d=e.length;let h;for(let f=0;f<d;++f){const p=e[f],{[l]:m,[c]:g}=p,b=p._stacks||(p._stacks={});h=b[c]=OC(s,u,m),h[o]=g,h._top=vw(h,a,!0,n.type),h._bottom=vw(h,a,!1,n.type);const _=h._visualValues||(h._visualValues={});_[o]=g}}function Uf(r,e){const t=r.scales;return Object.keys(t).filter(n=>t[n].axis===e).shift()}function TC(r,e){return Fs(r,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function RC(r,e,t){return Fs(r,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:t,index:e,mode:"default",type:"data"})}function so(r,e){const t=r.controller.index,n=r.vScale&&r.vScale.axis;if(n){e=e||r._parsed;for(const s of e){const i=s._stacks;if(!i||i[n]===void 0||i[n][t]===void 0)return;delete i[n][t],i[n]._visualValues!==void 0&&i[n]._visualValues[t]!==void 0&&delete i[n]._visualValues[t]}}}const qf=r=>r==="reset"||r==="none",kw=(r,e)=>e?r:Object.assign({},r),IC=(r,e,t)=>r&&!e.hidden&&e._stacked&&{keys:HS(t,!0),values:null};class tr{constructor(e,t){this.chart=e,this._ctx=e.ctx,this.index=t,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=Bf(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&so(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,t=this._cachedMeta,n=this.getDataset(),s=(d,h,f,p)=>d==="x"?h:d==="r"?p:f,i=t.xAxisID=Se(n.xAxisID,Uf(e,"x")),a=t.yAxisID=Se(n.yAxisID,Uf(e,"y")),o=t.rAxisID=Se(n.rAxisID,Uf(e,"r")),l=t.indexAxis,c=t.iAxisID=s(l,i,a,o),u=t.vAxisID=s(l,a,i,o);t.xScale=this.getScaleForId(i),t.yScale=this.getScaleForId(a),t.rScale=this.getScaleForId(o),t.iScale=this.getScaleForId(c),t.vScale=this.getScaleForId(u)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const t=this._cachedMeta;return e===t.iScale?t.vScale:t.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&iw(this._data,this),e._stacked&&so(e)}_dataCheck(){const e=this.getDataset(),t=e.data||(e.data=[]),n=this._data;if(je(t)){const s=this._cachedMeta;this._data=PC(t,s)}else if(n!==t){if(n){iw(n,this);const s=this._cachedMeta;so(s),s._parsed=[]}t&&Object.isExtensible(t)&&mI(t,this),this._syncList=[],this._data=t}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const t=this._cachedMeta,n=this.getDataset();let s=!1;this._dataCheck();const i=t._stacked;t._stacked=Bf(t.vScale,t),t.stack!==n.stack&&(s=!0,so(t),t.stack=n.stack),this._resyncElements(e),(s||i!==t._stacked)&&(xw(this,t._parsed),t._stacked=Bf(t.vScale,t))}configure(){const e=this.chart.config,t=e.datasetScopeKeys(this._type),n=e.getOptionScopes(this.getDataset(),t,!0);this.options=e.createResolver(n,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,t){const{_cachedMeta:n,_data:s}=this,{iScale:i,_stacked:a}=n,o=i.axis;let l=e===0&&t===s.length?!0:n._sorted,c=e>0&&n._parsed[e-1],u,d,h;if(this._parsing===!1)n._parsed=s,n._sorted=!0,h=s;else{ct(s[e])?h=this.parseArrayData(n,s,e,t):je(s[e])?h=this.parseObjectData(n,s,e,t):h=this.parsePrimitiveData(n,s,e,t);const f=()=>d[o]===null||c&&d[o]<c[o];for(u=0;u<t;++u)n._parsed[u+e]=d=h[u],l&&(f()&&(l=!1),c=d);n._sorted=l}a&&xw(this,h)}parsePrimitiveData(e,t,n,s){const{iScale:i,vScale:a}=e,o=i.axis,l=a.axis,c=i.getLabels(),u=i===a,d=new Array(s);let h,f,p;for(h=0,f=s;h<f;++h)p=h+n,d[h]={[o]:u||i.parse(c[p],p),[l]:a.parse(t[p],p)};return d}parseArrayData(e,t,n,s){const{xScale:i,yScale:a}=e,o=new Array(s);let l,c,u,d;for(l=0,c=s;l<c;++l)u=l+n,d=t[u],o[l]={x:i.parse(d[0],u),y:a.parse(d[1],u)};return o}parseObjectData(e,t,n,s){const{xScale:i,yScale:a}=e,{xAxisKey:o="x",yAxisKey:l="y"}=this._parsing,c=new Array(s);let u,d,h,f;for(u=0,d=s;u<d;++u)h=u+n,f=t[h],c[u]={x:i.parse(Ts(f,o),h),y:a.parse(Ts(f,l),h)};return c}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,t,n){const s=this.chart,i=this._cachedMeta,a=t[e.axis],o={keys:HS(s,!0),values:t._stacks[e.axis]._visualValues};return ww(o,a,i.index,{mode:n})}updateRangeFromParsed(e,t,n,s){const i=n[t.axis];let a=i===null?NaN:i;const o=s&&n._stacks[t.axis];s&&o&&(s.values=o,a=ww(s,i,this._cachedMeta.index)),e.min=Math.min(e.min,a),e.max=Math.max(e.max,a)}getMinMax(e,t){const n=this._cachedMeta,s=n._parsed,i=n._sorted&&e===n.iScale,a=s.length,o=this._getOtherScale(e),l=IC(t,n,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:u,max:d}=EC(o);let h,f;function p(){f=s[h];const m=f[o.axis];return!gt(f[e.axis])||u>m||d<m}for(h=0;h<a&&!(!p()&&(this.updateRangeFromParsed(c,e,f,l),i));++h);if(i){for(h=a-1;h>=0;--h)if(!p()){this.updateRangeFromParsed(c,e,f,l);break}}return c}getAllParsedValues(e){const t=this._cachedMeta._parsed,n=[];let s,i,a;for(s=0,i=t.length;s<i;++s)a=t[s][e.axis],gt(a)&&n.push(a);return n}getMaxOverflow(){return!1}getLabelAndValue(e){const t=this._cachedMeta,n=t.iScale,s=t.vScale,i=this.getParsed(e);return{label:n?""+n.getLabelForValue(i[n.axis]):"",value:s?""+s.getLabelForValue(i[s.axis]):""}}_update(e){const t=this._cachedMeta;this.update(e||"default"),t._clip=SC(Se(this.options.clip,kC(t.xScale,t.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,t=this.chart,n=this._cachedMeta,s=n.data||[],i=t.chartArea,a=[],o=this._drawStart||0,l=this._drawCount||s.length-o,c=this.options.drawActiveElementsOnTop;let u;for(n.dataset&&n.dataset.draw(e,i,o,l),u=o;u<o+l;++u){const d=s[u];d.hidden||(d.active&&c?a.push(d):d.draw(e,i))}for(u=0;u<a.length;++u)a[u].draw(e,i)}getStyle(e,t){const n=t?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(n):this.resolveDataElementOptions(e||0,n)}getContext(e,t,n){const s=this.getDataset();let i;if(e>=0&&e<this._cachedMeta.data.length){const a=this._cachedMeta.data[e];i=a.$context||(a.$context=RC(this.getContext(),e,a)),i.parsed=this.getParsed(e),i.raw=s.data[e],i.index=i.dataIndex=e}else i=this.$context||(this.$context=TC(this.chart.getContext(),this.index)),i.dataset=s,i.index=i.datasetIndex=this.index;return i.active=!!t,i.mode=n,i}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,t){return this._resolveElementOptions(this.dataElementType.id,t,e)}_resolveElementOptions(e,t="default",n){const s=t==="active",i=this._cachedDataOpts,a=e+"-"+t,o=i[a],l=this.enableOptionSharing&&gl(n);if(o)return kw(o,l);const c=this.chart.config,u=c.datasetElementScopeKeys(this._type,e),d=s?[`${e}Hover`,"hover",e,""]:[e,""],h=c.getOptionScopes(this.getDataset(),u),f=Object.keys(ut.elements[e]),p=()=>this.getContext(n,s,t),m=c.resolveNamedOptions(h,f,p,d);return m.$shared&&(m.$shared=l,i[a]=Object.freeze(kw(m,l))),m}_resolveAnimations(e,t,n){const s=this.chart,i=this._cachedDataOpts,a=`animation-${t}`,o=i[a];if(o)return o;let l;if(s.options.animation!==!1){const u=this.chart.config,d=u.datasetAnimationScopeKeys(this._type,t),h=u.getOptionScopes(this.getDataset(),d);l=u.createResolver(h,this.getContext(e,n,t))}const c=new qS(s,l&&l.animations);return l&&l._cacheable&&(i[a]=Object.freeze(c)),c}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,t){return!t||qf(e)||this.chart._animationsDisabled}_getSharedOptions(e,t){const n=this.resolveDataElementOptions(e,t),s=this._sharedOptions,i=this.getSharedOptions(n),a=this.includeOptions(t,i)||i!==s;return this.updateSharedOptions(i,t,n),{sharedOptions:i,includeOptions:a}}updateElement(e,t,n,s){qf(s)?Object.assign(e,n):this._resolveAnimations(t,s).update(e,n)}updateSharedOptions(e,t,n){e&&!qf(t)&&this._resolveAnimations(void 0,t).update(e,n)}_setStyle(e,t,n,s){e.active=s;const i=this.getStyle(t,s);this._resolveAnimations(t,n,s).update(e,{options:!s&&this.getSharedOptions(i)||i})}removeHoverStyle(e,t,n){this._setStyle(e,n,"active",!1)}setHoverStyle(e,t,n){this._setStyle(e,n,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const t=this._data,n=this._cachedMeta.data;for(const[o,l,c]of this._syncList)this[o](l,c);this._syncList=[];const s=n.length,i=t.length,a=Math.min(i,s);a&&this.parse(0,a),i>s?this._insertElements(s,i-s,e):i<s&&this._removeElements(i,s-i)}_insertElements(e,t,n=!0){const s=this._cachedMeta,i=s.data,a=e+t;let o;const l=c=>{for(c.length+=t,o=c.length-1;o>=a;o--)c[o]=c[o-t]};for(l(i),o=e;o<a;++o)i[o]=new this.dataElementType;this._parsing&&l(s._parsed),this.parse(e,t),n&&this.updateElements(i,e,t,"reset")}updateElements(e,t,n,s){}_removeElements(e,t){const n=this._cachedMeta;if(this._parsing){const s=n._parsed.splice(e,t);n._stacked&&so(n,s)}n.data.splice(e,t)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[t,n,s]=e;this[t](n,s)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,t){t&&this._sync(["_removeElements",e,t]);const n=arguments.length-2;n&&this._sync(["_insertElements",e,n])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}M(tr,"defaults",{}),M(tr,"datasetElementType",null),M(tr,"dataElementType",null);function CC(r,e){if(!r._cache.$bar){const t=r.getMatchingVisibleMetas(e);let n=[];for(let s=0,i=t.length;s<i;s++)n=n.concat(t[s].controller.getAllParsedValues(r));r._cache.$bar=kS(n.sort((s,i)=>s-i))}return r._cache.$bar}function $C(r){const e=r.iScale,t=CC(e,r.type);let n=e._length,s,i,a,o;const l=()=>{a===32767||a===-32768||(gl(o)&&(n=Math.min(n,Math.abs(a-o)||n)),o=a)};for(s=0,i=t.length;s<i;++s)a=e.getPixelForValue(t[s]),l();for(o=void 0,s=0,i=e.ticks.length;s<i;++s)a=e.getPixelForTick(s),l();return n}function MC(r,e,t,n){const s=t.barThickness;let i,a;return Ne(s)?(i=e.min*t.categoryPercentage,a=t.barPercentage):(i=s*n,a=1),{chunk:i/n,ratio:a,start:e.pixels[r]-i/2}}function NC(r,e,t,n){const s=e.pixels,i=s[r];let a=r>0?s[r-1]:null,o=r<s.length-1?s[r+1]:null;const l=t.categoryPercentage;a===null&&(a=i-(o===null?e.end-e.start:o-i)),o===null&&(o=i+i-a);const c=i-(i-Math.min(a,o))/2*l;return{chunk:Math.abs(o-a)/2*l/n,ratio:t.barPercentage,start:c}}function LC(r,e,t,n){const s=t.parse(r[0],n),i=t.parse(r[1],n),a=Math.min(s,i),o=Math.max(s,i);let l=a,c=o;Math.abs(a)>Math.abs(o)&&(l=o,c=a),e[t.axis]=c,e._custom={barStart:l,barEnd:c,start:s,end:i,min:a,max:o}}function WS(r,e,t,n){return ct(r)?LC(r,e,t,n):e[t.axis]=t.parse(r,n),e}function Sw(r,e,t,n){const s=r.iScale,i=r.vScale,a=s.getLabels(),o=s===i,l=[];let c,u,d,h;for(c=t,u=t+n;c<u;++c)h=e[c],d={},d[s.axis]=o||s.parse(a[c],c),l.push(WS(h,d,i,c));return l}function Hf(r){return r&&r.barStart!==void 0&&r.barEnd!==void 0}function jC(r,e,t){return r!==0?Ar(r):(e.isHorizontal()?1:-1)*(e.min>=t?1:-1)}function DC(r){let e,t,n,s,i;return r.horizontal?(e=r.base>r.x,t="left",n="right"):(e=r.base<r.y,t="bottom",n="top"),e?(s="end",i="start"):(s="start",i="end"),{start:t,end:n,reverse:e,top:s,bottom:i}}function FC(r,e,t,n){let s=e.borderSkipped;const i={};if(!s){r.borderSkipped=i;return}if(s===!0){r.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:a,end:o,reverse:l,top:c,bottom:u}=DC(r);s==="middle"&&t&&(r.enableBorderRadius=!0,(t._top||0)===n?s=c:(t._bottom||0)===n?s=u:(i[Pw(u,a,o,l)]=!0,s=c)),i[Pw(s,a,o,l)]=!0,r.borderSkipped=i}function Pw(r,e,t,n){return n?(r=zC(r,e,t),r=Aw(r,t,e)):r=Aw(r,e,t),r}function zC(r,e,t){return r===e?t:r===t?e:r}function Aw(r,e,t){return r==="start"?e:r==="end"?t:r}function BC(r,{inflateAmount:e},t){r.inflateAmount=e==="auto"?t===1?.33:0:e}class Xu extends tr{parsePrimitiveData(e,t,n,s){return Sw(e,t,n,s)}parseArrayData(e,t,n,s){return Sw(e,t,n,s)}parseObjectData(e,t,n,s){const{iScale:i,vScale:a}=e,{xAxisKey:o="x",yAxisKey:l="y"}=this._parsing,c=i.axis==="x"?o:l,u=a.axis==="x"?o:l,d=[];let h,f,p,m;for(h=n,f=n+s;h<f;++h)m=t[h],p={},p[i.axis]=i.parse(Ts(m,c),h),d.push(WS(Ts(m,u),p,a,h));return d}updateRangeFromParsed(e,t,n,s){super.updateRangeFromParsed(e,t,n,s);const i=n._custom;i&&t===this._cachedMeta.vScale&&(e.min=Math.min(e.min,i.min),e.max=Math.max(e.max,i.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const t=this._cachedMeta,{iScale:n,vScale:s}=t,i=this.getParsed(e),a=i._custom,o=Hf(a)?"["+a.start+", "+a.end+"]":""+s.getLabelForValue(i[s.axis]);return{label:""+n.getLabelForValue(i[n.axis]),value:o}}initialize(){this.enableOptionSharing=!0,super.initialize();const e=this._cachedMeta;e.stack=this.getDataset().stack}update(e){const t=this._cachedMeta;this.updateElements(t.data,0,t.data.length,e)}updateElements(e,t,n,s){const i=s==="reset",{index:a,_cachedMeta:{vScale:o}}=this,l=o.getBasePixel(),c=o.isHorizontal(),u=this._getRuler(),{sharedOptions:d,includeOptions:h}=this._getSharedOptions(t,s);for(let f=t;f<t+n;f++){const p=this.getParsed(f),m=i||Ne(p[o.axis])?{base:l,head:l}:this._calculateBarValuePixels(f),g=this._calculateBarIndexPixels(f,u),b=(p._stacks||{})[o.axis],_={horizontal:c,base:m.base,enableBorderRadius:!b||Hf(p._custom)||a===b._top||a===b._bottom,x:c?m.head:g.center,y:c?g.center:m.head,height:c?g.size:Math.abs(m.size),width:c?Math.abs(m.size):g.size};h&&(_.options=d||this.resolveDataElementOptions(f,e[f].active?"active":s));const y=_.options||e[f].options;FC(_,y,b,a),BC(_,y,u.ratio),this.updateElement(e[f],f,_,s)}}_getStacks(e,t){const{iScale:n}=this._cachedMeta,s=n.getMatchingVisibleMetas(this._type).filter(u=>u.controller.options.grouped),i=n.options.stacked,a=[],o=this._cachedMeta.controller.getParsed(t),l=o&&o[n.axis],c=u=>{const d=u._parsed.find(f=>f[n.axis]===l),h=d&&d[u.vScale.axis];if(Ne(h)||isNaN(h))return!0};for(const u of s)if(!(t!==void 0&&c(u))&&((i===!1||a.indexOf(u.stack)===-1||i===void 0&&u.stack===void 0)&&a.push(u.stack),u.index===e))break;return a.length||a.push(void 0),a}_getStackCount(e){return this._getStacks(void 0,e).length}_getStackIndex(e,t,n){const s=this._getStacks(e,n),i=t!==void 0?s.indexOf(t):-1;return i===-1?s.length-1:i}_getRuler(){const e=this.options,t=this._cachedMeta,n=t.iScale,s=[];let i,a;for(i=0,a=t.data.length;i<a;++i)s.push(n.getPixelForValue(this.getParsed(i)[n.axis],i));const o=e.barThickness;return{min:o||$C(t),pixels:s,start:n._startPixel,end:n._endPixel,stackCount:this._getStackCount(),scale:n,grouped:e.grouped,ratio:o?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:t,_stacked:n,index:s},options:{base:i,minBarLength:a}}=this,o=i||0,l=this.getParsed(e),c=l._custom,u=Hf(c);let d=l[t.axis],h=0,f=n?this.applyStack(t,l,n):d,p,m;f!==d&&(h=f-d,f=d),u&&(d=c.barStart,f=c.barEnd-c.barStart,d!==0&&Ar(d)!==Ar(c.barEnd)&&(h=0),h+=d);const g=!Ne(i)&&!u?i:h;let b=t.getPixelForValue(g);if(this.chart.getDataVisibility(e)?p=t.getPixelForValue(h+f):p=b,m=p-b,Math.abs(m)<a){m=jC(m,t,o)*a,d===o&&(b-=m/2);const _=t.getPixelForDecimal(0),y=t.getPixelForDecimal(1),w=Math.min(_,y),v=Math.max(_,y);b=Math.max(Math.min(b,v),w),p=b+m,n&&!u&&(l._stacks[t.axis]._visualValues[s]=t.getValueForPixel(p)-t.getValueForPixel(b))}if(b===t.getPixelForValue(o)){const _=Ar(m)*t.getLineWidthForValue(o)/2;b+=_,m-=_}return{size:m,base:b,head:p,center:p+m/2}}_calculateBarIndexPixels(e,t){const n=t.scale,s=this.options,i=s.skipNull,a=Se(s.maxBarThickness,1/0);let o,l;if(t.grouped){const c=i?this._getStackCount(e):t.stackCount,u=s.barThickness==="flex"?NC(e,t,s,c):MC(e,t,s,c),d=this._getStackIndex(this.index,this._cachedMeta.stack,i?e:void 0);o=u.start+u.chunk*d+u.chunk/2,l=Math.min(a,u.chunk*u.ratio)}else o=n.getPixelForValue(this.getParsed(e)[n.axis],e),l=Math.min(a,t.min*t.ratio);return{base:o-l/2,head:o+l/2,center:o,size:l}}draw(){const e=this._cachedMeta,t=e.vScale,n=e.data,s=n.length;let i=0;for(;i<s;++i)this.getParsed(i)[t.axis]!==null&&!n[i].hidden&&n[i].draw(this._ctx)}}M(Xu,"id","bar"),M(Xu,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),M(Xu,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class Yu extends tr{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(e,t,n,s){const i=super.parsePrimitiveData(e,t,n,s);for(let a=0;a<i.length;a++)i[a]._custom=this.resolveDataElementOptions(a+n).radius;return i}parseArrayData(e,t,n,s){const i=super.parseArrayData(e,t,n,s);for(let a=0;a<i.length;a++){const o=t[n+a];i[a]._custom=Se(o[2],this.resolveDataElementOptions(a+n).radius)}return i}parseObjectData(e,t,n,s){const i=super.parseObjectData(e,t,n,s);for(let a=0;a<i.length;a++){const o=t[n+a];i[a]._custom=Se(o&&o.r&&+o.r,this.resolveDataElementOptions(a+n).radius)}return i}getMaxOverflow(){const e=this._cachedMeta.data;let t=0;for(let n=e.length-1;n>=0;--n)t=Math.max(t,e[n].size(this.resolveDataElementOptions(n))/2);return t>0&&t}getLabelAndValue(e){const t=this._cachedMeta,n=this.chart.data.labels||[],{xScale:s,yScale:i}=t,a=this.getParsed(e),o=s.getLabelForValue(a.x),l=i.getLabelForValue(a.y),c=a._custom;return{label:n[e]||"",value:"("+o+", "+l+(c?", "+c:"")+")"}}update(e){const t=this._cachedMeta.data;this.updateElements(t,0,t.length,e)}updateElements(e,t,n,s){const i=s==="reset",{iScale:a,vScale:o}=this._cachedMeta,{sharedOptions:l,includeOptions:c}=this._getSharedOptions(t,s),u=a.axis,d=o.axis;for(let h=t;h<t+n;h++){const f=e[h],p=!i&&this.getParsed(h),m={},g=m[u]=i?a.getPixelForDecimal(.5):a.getPixelForValue(p[u]),b=m[d]=i?o.getBasePixel():o.getPixelForValue(p[d]);m.skip=isNaN(g)||isNaN(b),c&&(m.options=l||this.resolveDataElementOptions(h,f.active?"active":s),i&&(m.options.radius=0)),this.updateElement(f,h,m,s)}}resolveDataElementOptions(e,t){const n=this.getParsed(e);let s=super.resolveDataElementOptions(e,t);s.$shared&&(s=Object.assign({},s,{$shared:!1}));const i=s.radius;return t!=="active"&&(s.radius=0),s.radius+=Se(n&&n._custom,i),s}}M(Yu,"id","bubble"),M(Yu,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),M(Yu,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function UC(r,e,t){let n=1,s=1,i=0,a=0;if(e<st){const o=r,l=o+e,c=Math.cos(o),u=Math.sin(o),d=Math.cos(l),h=Math.sin(l),f=(y,w,v)=>bl(y,o,l,!0)?1:Math.max(w,w*t,v,v*t),p=(y,w,v)=>bl(y,o,l,!0)?-1:Math.min(w,w*t,v,v*t),m=f(0,c,d),g=f(wt,u,h),b=p(it,c,d),_=p(it+wt,u,h);n=(m-b)/2,s=(g-_)/2,i=-(m+b)/2,a=-(g+_)/2}return{ratioX:n,ratioY:s,offsetX:i,offsetY:a}}class ri extends tr{constructor(e,t){super(e,t),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(e,t){const n=this.getDataset().data,s=this._cachedMeta;if(this._parsing===!1)s._parsed=n;else{let i=l=>+n[l];if(je(n[e])){const{key:l="value"}=this._parsing;i=c=>+Ts(n[c],l)}let a,o;for(a=e,o=e+t;a<o;++a)s._parsed[a]=i(a)}}_getRotation(){return Kn(this.options.rotation-90)}_getCircumference(){return Kn(this.options.circumference)}_getRotationExtents(){let e=st,t=-st;for(let n=0;n<this.chart.data.datasets.length;++n)if(this.chart.isDatasetVisible(n)&&this.chart.getDatasetMeta(n).type===this._type){const s=this.chart.getDatasetMeta(n).controller,i=s._getRotation(),a=s._getCircumference();e=Math.min(e,i),t=Math.max(t,i+a)}return{rotation:e,circumference:t-e}}update(e){const t=this.chart,{chartArea:n}=t,s=this._cachedMeta,i=s.data,a=this.getMaxBorderWidth()+this.getMaxOffset(i)+this.options.spacing,o=Math.max((Math.min(n.width,n.height)-a)/2,0),l=Math.min(eI(this.options.cutout,o),1),c=this._getRingWeight(this.index),{circumference:u,rotation:d}=this._getRotationExtents(),{ratioX:h,ratioY:f,offsetX:p,offsetY:m}=UC(d,u,l),g=(n.width-a)/h,b=(n.height-a)/f,_=Math.max(Math.min(g,b)/2,0),y=_S(this.options.radius,_),w=Math.max(y*l,0),v=(y-w)/this._getVisibleDatasetWeightTotal();this.offsetX=p*y,this.offsetY=m*y,s.total=this.calculateTotal(),this.outerRadius=y-v*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-v*c,0),this.updateElements(i,0,i.length,e)}_circumference(e,t){const n=this.options,s=this._cachedMeta,i=this._getCircumference();return t&&n.animation.animateRotate||!this.chart.getDataVisibility(e)||s._parsed[e]===null||s.data[e].hidden?0:this.calculateCircumference(s._parsed[e]*i/st)}updateElements(e,t,n,s){const i=s==="reset",a=this.chart,o=a.chartArea,c=a.options.animation,u=(o.left+o.right)/2,d=(o.top+o.bottom)/2,h=i&&c.animateScale,f=h?0:this.innerRadius,p=h?0:this.outerRadius,{sharedOptions:m,includeOptions:g}=this._getSharedOptions(t,s);let b=this._getRotation(),_;for(_=0;_<t;++_)b+=this._circumference(_,i);for(_=t;_<t+n;++_){const y=this._circumference(_,i),w=e[_],v={x:u+this.offsetX,y:d+this.offsetY,startAngle:b,endAngle:b+y,circumference:y,outerRadius:p,innerRadius:f};g&&(v.options=m||this.resolveDataElementOptions(_,w.active?"active":s)),b+=y,this.updateElement(w,_,v,s)}}calculateTotal(){const e=this._cachedMeta,t=e.data;let n=0,s;for(s=0;s<t.length;s++){const i=e._parsed[s];i!==null&&!isNaN(i)&&this.chart.getDataVisibility(s)&&!t[s].hidden&&(n+=Math.abs(i))}return n}calculateCircumference(e){const t=this._cachedMeta.total;return t>0&&!isNaN(e)?st*(Math.abs(e)/t):0}getLabelAndValue(e){const t=this._cachedMeta,n=this.chart,s=n.data.labels||[],i=gc(t._parsed[e],n.options.locale);return{label:s[e]||"",value:i}}getMaxBorderWidth(e){let t=0;const n=this.chart;let s,i,a,o,l;if(!e){for(s=0,i=n.data.datasets.length;s<i;++s)if(n.isDatasetVisible(s)){a=n.getDatasetMeta(s),e=a.data,o=a.controller;break}}if(!e)return 0;for(s=0,i=e.length;s<i;++s)l=o.resolveDataElementOptions(s),l.borderAlign!=="inner"&&(t=Math.max(t,l.borderWidth||0,l.hoverBorderWidth||0));return t}getMaxOffset(e){let t=0;for(let n=0,s=e.length;n<s;++n){const i=this.resolveDataElementOptions(n);t=Math.max(t,i.offset||0,i.hoverOffset||0)}return t}_getRingWeightOffset(e){let t=0;for(let n=0;n<e;++n)this.chart.isDatasetVisible(n)&&(t+=this._getRingWeight(n));return t}_getRingWeight(e){return Math.max(Se(this.chart.data.datasets[e].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}M(ri,"id","doughnut"),M(ri,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),M(ri,"descriptors",{_scriptable:e=>e!=="spacing",_indexable:e=>e!=="spacing"&&!e.startsWith("borderDash")&&!e.startsWith("hoverBorderDash")}),M(ri,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:n,color:s}}=e.legend.options;return t.labels.map((i,a)=>{const l=e.getDatasetMeta(0).controller.getStyle(a);return{text:i,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:s,lineWidth:l.borderWidth,pointStyle:n,hidden:!e.getDataVisibility(a),index:a}})}return[]}},onClick(e,t,n){n.chart.toggleDataVisibility(t.index),n.chart.update()}}}});class Qu extends tr{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const t=this._cachedMeta,{dataset:n,data:s=[],_dataset:i}=t,a=this.chart._animationsDisabled;let{start:o,count:l}=AS(t,s,a);this._drawStart=o,this._drawCount=l,ES(t)&&(o=0,l=s.length),n._chart=this.chart,n._datasetIndex=this.index,n._decimated=!!i._decimated,n.points=s;const c=this.resolveDatasetElementOptions(e);this.options.showLine||(c.borderWidth=0),c.segment=this.options.segment,this.updateElement(n,void 0,{animated:!a,options:c},e),this.updateElements(s,o,l,e)}updateElements(e,t,n,s){const i=s==="reset",{iScale:a,vScale:o,_stacked:l,_dataset:c}=this._cachedMeta,{sharedOptions:u,includeOptions:d}=this._getSharedOptions(t,s),h=a.axis,f=o.axis,{spanGaps:p,segment:m}=this.options,g=Ea(p)?p:Number.POSITIVE_INFINITY,b=this.chart._animationsDisabled||i||s==="none",_=t+n,y=e.length;let w=t>0&&this.getParsed(t-1);for(let v=0;v<y;++v){const x=e[v],S=b?x:{};if(v<t||v>=_){S.skip=!0;continue}const k=this.getParsed(v),R=Ne(k[f]),D=S[h]=a.getPixelForValue(k[h],v),C=S[f]=i||R?o.getBasePixel():o.getPixelForValue(l?this.applyStack(o,k,l):k[f],v);S.skip=isNaN(D)||isNaN(C)||R,S.stop=v>0&&Math.abs(k[h]-w[h])>g,m&&(S.parsed=k,S.raw=c.data[v]),d&&(S.options=u||this.resolveDataElementOptions(v,x.active?"active":s)),b||this.updateElement(x,v,S,s),w=k}}getMaxOverflow(){const e=this._cachedMeta,t=e.dataset,n=t.options&&t.options.borderWidth||0,s=e.data||[];if(!s.length)return n;const i=s[0].size(this.resolveDataElementOptions(0)),a=s[s.length-1].size(this.resolveDataElementOptions(s.length-1));return Math.max(n,i,a)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}M(Qu,"id","line"),M(Qu,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),M(Qu,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class el extends tr{constructor(e,t){super(e,t),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(e){const t=this._cachedMeta,n=this.chart,s=n.data.labels||[],i=gc(t._parsed[e].r,n.options.locale);return{label:s[e]||"",value:i}}parseObjectData(e,t,n,s){return NS.bind(this)(e,t,n,s)}update(e){const t=this._cachedMeta.data;this._updateRadius(),this.updateElements(t,0,t.length,e)}getMinMax(){const e=this._cachedMeta,t={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return e.data.forEach((n,s)=>{const i=this.getParsed(s).r;!isNaN(i)&&this.chart.getDataVisibility(s)&&(i<t.min&&(t.min=i),i>t.max&&(t.max=i))}),t}_updateRadius(){const e=this.chart,t=e.chartArea,n=e.options,s=Math.min(t.right-t.left,t.bottom-t.top),i=Math.max(s/2,0),a=Math.max(n.cutoutPercentage?i/100*n.cutoutPercentage:1,0),o=(i-a)/e.getVisibleDatasetCount();this.outerRadius=i-o*this.index,this.innerRadius=this.outerRadius-o}updateElements(e,t,n,s){const i=s==="reset",a=this.chart,l=a.options.animation,c=this._cachedMeta.rScale,u=c.xCenter,d=c.yCenter,h=c.getIndexAngle(0)-.5*it;let f=h,p;const m=360/this.countVisibleElements();for(p=0;p<t;++p)f+=this._computeAngle(p,s,m);for(p=t;p<t+n;p++){const g=e[p];let b=f,_=f+this._computeAngle(p,s,m),y=a.getDataVisibility(p)?c.getDistanceFromCenterForValue(this.getParsed(p).r):0;f=_,i&&(l.animateScale&&(y=0),l.animateRotate&&(b=_=h));const w={x:u,y:d,innerRadius:0,outerRadius:y,startAngle:b,endAngle:_,options:this.resolveDataElementOptions(p,g.active?"active":s)};this.updateElement(g,p,w,s)}}countVisibleElements(){const e=this._cachedMeta;let t=0;return e.data.forEach((n,s)=>{!isNaN(this.getParsed(s).r)&&this.chart.getDataVisibility(s)&&t++}),t}_computeAngle(e,t,n){return this.chart.getDataVisibility(e)?Kn(this.resolveDataElementOptions(e,t).angle||n):0}}M(el,"id","polarArea"),M(el,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),M(el,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:n,color:s}}=e.legend.options;return t.labels.map((i,a)=>{const l=e.getDatasetMeta(0).controller.getStyle(a);return{text:i,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:s,lineWidth:l.borderWidth,pointStyle:n,hidden:!e.getDataVisibility(a),index:a}})}return[]}},onClick(e,t,n){n.chart.toggleDataVisibility(t.index),n.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class hg extends ri{}M(hg,"id","pie"),M(hg,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class ed extends tr{getLabelAndValue(e){const t=this._cachedMeta.vScale,n=this.getParsed(e);return{label:t.getLabels()[e],value:""+t.getLabelForValue(n[t.axis])}}parseObjectData(e,t,n,s){return NS.bind(this)(e,t,n,s)}update(e){const t=this._cachedMeta,n=t.dataset,s=t.data||[],i=t.iScale.getLabels();if(n.points=s,e!=="resize"){const a=this.resolveDatasetElementOptions(e);this.options.showLine||(a.borderWidth=0);const o={_loop:!0,_fullLoop:i.length===s.length,options:a};this.updateElement(n,void 0,o,e)}this.updateElements(s,0,s.length,e)}updateElements(e,t,n,s){const i=this._cachedMeta.rScale,a=s==="reset";for(let o=t;o<t+n;o++){const l=e[o],c=this.resolveDataElementOptions(o,l.active?"active":s),u=i.getPointPositionForValue(o,this.getParsed(o).r),d=a?i.xCenter:u.x,h=a?i.yCenter:u.y,f={x:d,y:h,angle:u.angle,skip:isNaN(d)||isNaN(h),options:c};this.updateElement(l,o,f,s)}}}M(ed,"id","radar"),M(ed,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),M(ed,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class td extends tr{getLabelAndValue(e){const t=this._cachedMeta,n=this.chart.data.labels||[],{xScale:s,yScale:i}=t,a=this.getParsed(e),o=s.getLabelForValue(a.x),l=i.getLabelForValue(a.y);return{label:n[e]||"",value:"("+o+", "+l+")"}}update(e){const t=this._cachedMeta,{data:n=[]}=t,s=this.chart._animationsDisabled;let{start:i,count:a}=AS(t,n,s);if(this._drawStart=i,this._drawCount=a,ES(t)&&(i=0,a=n.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:o,_dataset:l}=t;o._chart=this.chart,o._datasetIndex=this.index,o._decimated=!!l._decimated,o.points=n;const c=this.resolveDatasetElementOptions(e);c.segment=this.options.segment,this.updateElement(o,void 0,{animated:!s,options:c},e)}else this.datasetElementType&&(delete t.dataset,this.datasetElementType=!1);this.updateElements(n,i,a,e)}addElements(){const{showLine:e}=this.options;!this.datasetElementType&&e&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(e,t,n,s){const i=s==="reset",{iScale:a,vScale:o,_stacked:l,_dataset:c}=this._cachedMeta,u=this.resolveDataElementOptions(t,s),d=this.getSharedOptions(u),h=this.includeOptions(s,d),f=a.axis,p=o.axis,{spanGaps:m,segment:g}=this.options,b=Ea(m)?m:Number.POSITIVE_INFINITY,_=this.chart._animationsDisabled||i||s==="none";let y=t>0&&this.getParsed(t-1);for(let w=t;w<t+n;++w){const v=e[w],x=this.getParsed(w),S=_?v:{},k=Ne(x[p]),R=S[f]=a.getPixelForValue(x[f],w),D=S[p]=i||k?o.getBasePixel():o.getPixelForValue(l?this.applyStack(o,x,l):x[p],w);S.skip=isNaN(R)||isNaN(D)||k,S.stop=w>0&&Math.abs(x[f]-y[f])>b,g&&(S.parsed=x,S.raw=c.data[w]),h&&(S.options=d||this.resolveDataElementOptions(w,v.active?"active":s)),_||this.updateElement(v,w,S,s),y=x}this.updateSharedOptions(d,s,u)}getMaxOverflow(){const e=this._cachedMeta,t=e.data||[];if(!this.options.showLine){let o=0;for(let l=t.length-1;l>=0;--l)o=Math.max(o,t[l].size(this.resolveDataElementOptions(l))/2);return o>0&&o}const n=e.dataset,s=n.options&&n.options.borderWidth||0;if(!t.length)return s;const i=t[0].size(this.resolveDataElementOptions(0)),a=t[t.length-1].size(this.resolveDataElementOptions(t.length-1));return Math.max(s,i,a)/2}}M(td,"id","scatter"),M(td,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),M(td,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var qC=Object.freeze({__proto__:null,BarController:Xu,BubbleController:Yu,DoughnutController:ri,LineController:Qu,PieController:hg,PolarAreaController:el,RadarController:ed,ScatterController:td});function Zs(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class qb{constructor(e){M(this,"options");this.options=e||{}}static override(e){Object.assign(qb.prototype,e)}init(){}formats(){return Zs()}parse(){return Zs()}format(){return Zs()}add(){return Zs()}diff(){return Zs()}startOf(){return Zs()}endOf(){return Zs()}}var HC={_date:qb};function WC(r,e,t,n){const{controller:s,data:i,_sorted:a}=r,o=s._cachedMeta.iScale,l=r.dataset&&r.dataset.options?r.dataset.options.spanGaps:null;if(o&&e===o.axis&&e!=="r"&&a&&i.length){const c=o._reversePixels?fI:Xr;if(n){if(s._sharedOptions){const u=i[0],d=typeof u.getRange=="function"&&u.getRange(e);if(d){const h=c(i,e,t-d),f=c(i,e,t+d);return{lo:h.lo,hi:f.hi}}}}else{const u=c(i,e,t);if(l){const{vScale:d}=s._cachedMeta,{_parsed:h}=r,f=h.slice(0,u.lo+1).reverse().findIndex(m=>!Ne(m[d.axis]));u.lo-=Math.max(0,f);const p=h.slice(u.hi).findIndex(m=>!Ne(m[d.axis]));u.hi+=Math.max(0,p)}return u}}return{lo:0,hi:i.length-1}}function Rh(r,e,t,n,s){const i=r.getSortedVisibleDatasetMetas(),a=t[e];for(let o=0,l=i.length;o<l;++o){const{index:c,data:u}=i[o],{lo:d,hi:h}=WC(i[o],e,a,s);for(let f=d;f<=h;++f){const p=u[f];p.skip||n(p,c,f)}}}function VC(r){const e=r.indexOf("x")!==-1,t=r.indexOf("y")!==-1;return function(n,s){const i=e?Math.abs(n.x-s.x):0,a=t?Math.abs(n.y-s.y):0;return Math.sqrt(Math.pow(i,2)+Math.pow(a,2))}}function Wf(r,e,t,n,s){const i=[];return!s&&!r.isPointInArea(e)||Rh(r,t,e,function(o,l,c){!s&&!Yr(o,r.chartArea,0)||o.inRange(e.x,e.y,n)&&i.push({element:o,datasetIndex:l,index:c})},!0),i}function GC(r,e,t,n){let s=[];function i(a,o,l){const{startAngle:c,endAngle:u}=a.getProps(["startAngle","endAngle"],n),{angle:d}=vS(a,{x:e.x,y:e.y});bl(d,c,u)&&s.push({element:a,datasetIndex:o,index:l})}return Rh(r,t,e,i),s}function ZC(r,e,t,n,s,i){let a=[];const o=VC(t);let l=Number.POSITIVE_INFINITY;function c(u,d,h){const f=u.inRange(e.x,e.y,s);if(n&&!f)return;const p=u.getCenterPoint(s);if(!(!!i||r.isPointInArea(p))&&!f)return;const g=o(e,p);g<l?(a=[{element:u,datasetIndex:d,index:h}],l=g):g===l&&a.push({element:u,datasetIndex:d,index:h})}return Rh(r,t,e,c),a}function Vf(r,e,t,n,s,i){return!i&&!r.isPointInArea(e)?[]:t==="r"&&!n?GC(r,e,t,s):ZC(r,e,t,n,s,i)}function Ew(r,e,t,n,s){const i=[],a=t==="x"?"inXRange":"inYRange";let o=!1;return Rh(r,t,e,(l,c,u)=>{l[a]&&l[a](e[t],s)&&(i.push({element:l,datasetIndex:c,index:u}),o=o||l.inRange(e.x,e.y,s))}),n&&!o?[]:i}var JC={modes:{index(r,e,t,n){const s=Qs(e,r),i=t.axis||"x",a=t.includeInvisible||!1,o=t.intersect?Wf(r,s,i,n,a):Vf(r,s,i,!1,n,a),l=[];return o.length?(r.getSortedVisibleDatasetMetas().forEach(c=>{const u=o[0].index,d=c.data[u];d&&!d.skip&&l.push({element:d,datasetIndex:c.index,index:u})}),l):[]},dataset(r,e,t,n){const s=Qs(e,r),i=t.axis||"xy",a=t.includeInvisible||!1;let o=t.intersect?Wf(r,s,i,n,a):Vf(r,s,i,!1,n,a);if(o.length>0){const l=o[0].datasetIndex,c=r.getDatasetMeta(l).data;o=[];for(let u=0;u<c.length;++u)o.push({element:c[u],datasetIndex:l,index:u})}return o},point(r,e,t,n){const s=Qs(e,r),i=t.axis||"xy",a=t.includeInvisible||!1;return Wf(r,s,i,n,a)},nearest(r,e,t,n){const s=Qs(e,r),i=t.axis||"xy",a=t.includeInvisible||!1;return Vf(r,s,i,t.intersect,n,a)},x(r,e,t,n){const s=Qs(e,r);return Ew(r,s,"x",t.intersect,n)},y(r,e,t,n){const s=Qs(e,r);return Ew(r,s,"y",t.intersect,n)}}};const VS=["left","top","right","bottom"];function io(r,e){return r.filter(t=>t.pos===e)}function Ow(r,e){return r.filter(t=>VS.indexOf(t.pos)===-1&&t.box.axis===e)}function ao(r,e){return r.sort((t,n)=>{const s=e?n:t,i=e?t:n;return s.weight===i.weight?s.index-i.index:s.weight-i.weight})}function KC(r){const e=[];let t,n,s,i,a,o;for(t=0,n=(r||[]).length;t<n;++t)s=r[t],{position:i,options:{stack:a,stackWeight:o=1}}=s,e.push({index:t,box:s,pos:i,horizontal:s.isHorizontal(),weight:s.weight,stack:a&&i+a,stackWeight:o});return e}function XC(r){const e={};for(const t of r){const{stack:n,pos:s,stackWeight:i}=t;if(!n||!VS.includes(s))continue;const a=e[n]||(e[n]={count:0,placed:0,weight:0,size:0});a.count++,a.weight+=i}return e}function YC(r,e){const t=XC(r),{vBoxMaxWidth:n,hBoxMaxHeight:s}=e;let i,a,o;for(i=0,a=r.length;i<a;++i){o=r[i];const{fullSize:l}=o.box,c=t[o.stack],u=c&&o.stackWeight/c.weight;o.horizontal?(o.width=u?u*n:l&&e.availableWidth,o.height=s):(o.width=n,o.height=u?u*s:l&&e.availableHeight)}return t}function QC(r){const e=KC(r),t=ao(e.filter(c=>c.box.fullSize),!0),n=ao(io(e,"left"),!0),s=ao(io(e,"right")),i=ao(io(e,"top"),!0),a=ao(io(e,"bottom")),o=Ow(e,"x"),l=Ow(e,"y");return{fullSize:t,leftAndTop:n.concat(i),rightAndBottom:s.concat(l).concat(a).concat(o),chartArea:io(e,"chartArea"),vertical:n.concat(s).concat(l),horizontal:i.concat(a).concat(o)}}function Tw(r,e,t,n){return Math.max(r[t],e[t])+Math.max(r[n],e[n])}function GS(r,e){r.top=Math.max(r.top,e.top),r.left=Math.max(r.left,e.left),r.bottom=Math.max(r.bottom,e.bottom),r.right=Math.max(r.right,e.right)}function e$(r,e,t,n){const{pos:s,box:i}=t,a=r.maxPadding;if(!je(s)){t.size&&(r[s]-=t.size);const d=n[t.stack]||{size:0,count:1};d.size=Math.max(d.size,t.horizontal?i.height:i.width),t.size=d.size/d.count,r[s]+=t.size}i.getPadding&&GS(a,i.getPadding());const o=Math.max(0,e.outerWidth-Tw(a,r,"left","right")),l=Math.max(0,e.outerHeight-Tw(a,r,"top","bottom")),c=o!==r.w,u=l!==r.h;return r.w=o,r.h=l,t.horizontal?{same:c,other:u}:{same:u,other:c}}function t$(r){const e=r.maxPadding;function t(n){const s=Math.max(e[n]-r[n],0);return r[n]+=s,s}r.y+=t("top"),r.x+=t("left"),t("right"),t("bottom")}function n$(r,e){const t=e.maxPadding;function n(s){const i={left:0,top:0,right:0,bottom:0};return s.forEach(a=>{i[a]=Math.max(e[a],t[a])}),i}return n(r?["left","right"]:["top","bottom"])}function $o(r,e,t,n){const s=[];let i,a,o,l,c,u;for(i=0,a=r.length,c=0;i<a;++i){o=r[i],l=o.box,l.update(o.width||e.w,o.height||e.h,n$(o.horizontal,e));const{same:d,other:h}=e$(e,t,o,n);c|=d&&s.length,u=u||h,l.fullSize||s.push(o)}return c&&$o(s,e,t,n)||u}function eu(r,e,t,n,s){r.top=t,r.left=e,r.right=e+n,r.bottom=t+s,r.width=n,r.height=s}function Rw(r,e,t,n){const s=t.padding;let{x:i,y:a}=e;for(const o of r){const l=o.box,c=n[o.stack]||{placed:0,weight:1},u=o.stackWeight/c.weight||1;if(o.horizontal){const d=e.w*u,h=c.size||l.height;gl(c.start)&&(a=c.start),l.fullSize?eu(l,s.left,a,t.outerWidth-s.right-s.left,h):eu(l,e.left+c.placed,a,d,h),c.start=a,c.placed+=d,a=l.bottom}else{const d=e.h*u,h=c.size||l.width;gl(c.start)&&(i=c.start),l.fullSize?eu(l,i,s.top,h,t.outerHeight-s.bottom-s.top):eu(l,i,e.top+c.placed,h,d),c.start=i,c.placed+=d,i=l.right}}e.x=i,e.y=a}var Kt={addBox(r,e){r.boxes||(r.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},r.boxes.push(e)},removeBox(r,e){const t=r.boxes?r.boxes.indexOf(e):-1;t!==-1&&r.boxes.splice(t,1)},configure(r,e,t){e.fullSize=t.fullSize,e.position=t.position,e.weight=t.weight},update(r,e,t,n){if(!r)return;const s=Xt(r.options.layout.padding),i=Math.max(e-s.width,0),a=Math.max(t-s.height,0),o=QC(r.boxes),l=o.vertical,c=o.horizontal;Je(r.boxes,m=>{typeof m.beforeLayout=="function"&&m.beforeLayout()});const u=l.reduce((m,g)=>g.box.options&&g.box.options.display===!1?m:m+1,0)||1,d=Object.freeze({outerWidth:e,outerHeight:t,padding:s,availableWidth:i,availableHeight:a,vBoxMaxWidth:i/2/u,hBoxMaxHeight:a/2}),h=Object.assign({},s);GS(h,Xt(n));const f=Object.assign({maxPadding:h,w:i,h:a,x:s.left,y:s.top},s),p=YC(l.concat(c),d);$o(o.fullSize,f,d,p),$o(l,f,d,p),$o(c,f,d,p)&&$o(l,f,d,p),t$(f),Rw(o.leftAndTop,f,d,p),f.x+=f.w,f.y+=f.h,Rw(o.rightAndBottom,f,d,p),r.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},Je(o.chartArea,m=>{const g=m.box;Object.assign(g,r.chartArea),g.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})})}};class ZS{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,n){}removeEventListener(e,t,n){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,n,s){return t=Math.max(0,t||e.width),n=n||e.height,{width:t,height:Math.max(0,s?Math.floor(t/s):n)}}isAttached(e){return!0}updateConfig(e){}}class r$ extends ZS{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const nd="$chartjs",s$={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Iw=r=>r===null||r==="";function i$(r,e){const t=r.style,n=r.getAttribute("height"),s=r.getAttribute("width");if(r[nd]={initial:{height:n,width:s,style:{display:t.display,height:t.height,width:t.width}}},t.display=t.display||"block",t.boxSizing=t.boxSizing||"border-box",Iw(s)){const i=pw(r,"width");i!==void 0&&(r.width=i)}if(Iw(n))if(r.style.height==="")r.height=r.width/(e||2);else{const i=pw(r,"height");i!==void 0&&(r.height=i)}return r}const JS=aC?{passive:!0}:!1;function a$(r,e,t){r&&r.addEventListener(e,t,JS)}function o$(r,e,t){r&&r.canvas&&r.canvas.removeEventListener(e,t,JS)}function l$(r,e){const t=s$[r.type]||r.type,{x:n,y:s}=Qs(r,e);return{type:t,chart:e,native:r,x:n!==void 0?n:null,y:s!==void 0?s:null}}function kd(r,e){for(const t of r)if(t===e||t.contains(e))return!0}function c$(r,e,t){const n=r.canvas,s=new MutationObserver(i=>{let a=!1;for(const o of i)a=a||kd(o.addedNodes,n),a=a&&!kd(o.removedNodes,n);a&&t()});return s.observe(document,{childList:!0,subtree:!0}),s}function u$(r,e,t){const n=r.canvas,s=new MutationObserver(i=>{let a=!1;for(const o of i)a=a||kd(o.removedNodes,n),a=a&&!kd(o.addedNodes,n);a&&t()});return s.observe(document,{childList:!0,subtree:!0}),s}const yl=new Map;let Cw=0;function KS(){const r=window.devicePixelRatio;r!==Cw&&(Cw=r,yl.forEach((e,t)=>{t.currentDevicePixelRatio!==r&&e()}))}function d$(r,e){yl.size||window.addEventListener("resize",KS),yl.set(r,e)}function h$(r){yl.delete(r),yl.size||window.removeEventListener("resize",KS)}function f$(r,e,t){const n=r.canvas,s=n&&Ub(n);if(!s)return;const i=PS((o,l)=>{const c=s.clientWidth;t(o,l),c<s.clientWidth&&t()},window),a=new ResizeObserver(o=>{const l=o[0],c=l.contentRect.width,u=l.contentRect.height;c===0&&u===0||i(c,u)});return a.observe(s),d$(r,i),a}function Gf(r,e,t){t&&t.disconnect(),e==="resize"&&h$(r)}function p$(r,e,t){const n=r.canvas,s=PS(i=>{r.ctx!==null&&t(l$(i,r))},r);return a$(n,e,s),s}class m$ extends ZS{acquireContext(e,t){const n=e&&e.getContext&&e.getContext("2d");return n&&n.canvas===e?(i$(e,t),n):null}releaseContext(e){const t=e.canvas;if(!t[nd])return!1;const n=t[nd].initial;["height","width"].forEach(i=>{const a=n[i];Ne(a)?t.removeAttribute(i):t.setAttribute(i,a)});const s=n.style||{};return Object.keys(s).forEach(i=>{t.style[i]=s[i]}),t.width=t.width,delete t[nd],!0}addEventListener(e,t,n){this.removeEventListener(e,t);const s=e.$proxies||(e.$proxies={}),a={attach:c$,detach:u$,resize:f$}[t]||p$;s[t]=a(e,t,n)}removeEventListener(e,t){const n=e.$proxies||(e.$proxies={}),s=n[t];if(!s)return;({attach:Gf,detach:Gf,resize:Gf}[t]||o$)(e,t,s),n[t]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,n,s){return iC(e,t,n,s)}isAttached(e){const t=e&&Ub(e);return!!(t&&t.isConnected)}}function g$(r){return!Bb()||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas?r$:m$}var Ju;let ns=(Ju=class{constructor(){M(this,"x");M(this,"y");M(this,"active",!1);M(this,"options");M(this,"$animations")}tooltipPosition(e){const{x:t,y:n}=this.getProps(["x","y"],e);return{x:t,y:n}}hasValue(){return Ea(this.x)&&Ea(this.y)}getProps(e,t){const n=this.$animations;if(!t||!n)return this;const s={};return e.forEach(i=>{s[i]=n[i]&&n[i].active()?n[i]._to:this[i]}),s}},M(Ju,"defaults",{}),M(Ju,"defaultRoutes"),Ju);function b$(r,e){const t=r.options.ticks,n=_$(r),s=Math.min(t.maxTicksLimit||n,n),i=t.major.enabled?w$(e):[],a=i.length,o=i[0],l=i[a-1],c=[];if(a>s)return v$(e,c,i,a/s),c;const u=y$(i,e,s);if(a>0){let d,h;const f=a>1?Math.round((l-o)/(a-1)):null;for(tu(e,c,u,Ne(f)?0:o-f,o),d=0,h=a-1;d<h;d++)tu(e,c,u,i[d],i[d+1]);return tu(e,c,u,l,Ne(f)?e.length:l+f),c}return tu(e,c,u),c}function _$(r){const e=r.options.offset,t=r._tickSize(),n=r._length/t+(e?0:1),s=r._maxLength/t;return Math.floor(Math.min(n,s))}function y$(r,e,t){const n=x$(r),s=e.length/t;if(!n)return Math.max(s,1);const i=lI(n);for(let a=0,o=i.length-1;a<o;a++){const l=i[a];if(l>s)return l}return Math.max(s,1)}function w$(r){const e=[];let t,n;for(t=0,n=r.length;t<n;t++)r[t].major&&e.push(t);return e}function v$(r,e,t,n){let s=0,i=t[0],a;for(n=Math.ceil(n),a=0;a<r.length;a++)a===i&&(e.push(r[a]),s++,i=t[s*n])}function tu(r,e,t,n,s){const i=Se(n,0),a=Math.min(Se(s,r.length),r.length);let o=0,l,c,u;for(t=Math.ceil(t),s&&(l=s-n,t=l/Math.floor(l/t)),u=i;u<0;)o++,u=Math.round(i+o*t);for(c=Math.max(i,0);c<a;c++)c===u&&(e.push(r[c]),o++,u=Math.round(i+o*t))}function x$(r){const e=r.length;let t,n;if(e<2)return!1;for(n=r[0],t=1;t<e;++t)if(r[t]-r[t-1]!==n)return!1;return n}const k$=r=>r==="left"?"right":r==="right"?"left":r,$w=(r,e,t)=>e==="top"||e==="left"?r[e]+t:r[e]-t,Mw=(r,e)=>Math.min(e||r,r);function Nw(r,e){const t=[],n=r.length/e,s=r.length;let i=0;for(;i<s;i+=n)t.push(r[Math.floor(i)]);return t}function S$(r,e,t){const n=r.ticks.length,s=Math.min(e,n-1),i=r._startPixel,a=r._endPixel,o=1e-6;let l=r.getPixelForTick(s),c;if(!(t&&(n===1?c=Math.max(l-i,a-l):e===0?c=(r.getPixelForTick(1)-l)/2:c=(l-r.getPixelForTick(s-1))/2,l+=s<e?c:-c,l<i-o||l>a+o)))return l}function P$(r,e){Je(r,t=>{const n=t.gc,s=n.length/2;let i;if(s>e){for(i=0;i<s;++i)delete t.data[n[i]];n.splice(0,s)}})}function oo(r){return r.drawTicks?r.tickLength:0}function Lw(r,e){if(!r.display)return 0;const t=Ot(r.font,e),n=Xt(r.padding);return(ct(r.text)?r.text.length:1)*t.lineHeight+n.height}function A$(r,e){return Fs(r,{scale:e,type:"scale"})}function E$(r,e,t){return Fs(r,{tick:t,index:e,type:"tick"})}function O$(r,e,t){let n=Nb(r);return(t&&e!=="right"||!t&&e==="right")&&(n=k$(n)),n}function T$(r,e,t,n){const{top:s,left:i,bottom:a,right:o,chart:l}=r,{chartArea:c,scales:u}=l;let d=0,h,f,p;const m=a-s,g=o-i;if(r.isHorizontal()){if(f=Zt(n,i,o),je(t)){const b=Object.keys(t)[0],_=t[b];p=u[b].getPixelForValue(_)+m-e}else t==="center"?p=(c.bottom+c.top)/2+m-e:p=$w(r,t,e);h=o-i}else{if(je(t)){const b=Object.keys(t)[0],_=t[b];f=u[b].getPixelForValue(_)-g+e}else t==="center"?f=(c.left+c.right)/2-g+e:f=$w(r,t,e);p=Zt(n,a,s),d=t==="left"?-wt:wt}return{titleX:f,titleY:p,maxWidth:h,rotation:d}}class Ai extends ns{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:n,_suggestedMax:s}=this;return e=Pn(e,Number.POSITIVE_INFINITY),t=Pn(t,Number.NEGATIVE_INFINITY),n=Pn(n,Number.POSITIVE_INFINITY),s=Pn(s,Number.NEGATIVE_INFINITY),{min:Pn(e,n),max:Pn(t,s),minDefined:gt(e),maxDefined:gt(t)}}getMinMax(e){let{min:t,max:n,minDefined:s,maxDefined:i}=this.getUserBounds(),a;if(s&&i)return{min:t,max:n};const o=this.getMatchingVisibleMetas();for(let l=0,c=o.length;l<c;++l)a=o[l].controller.getMinMax(this,e),s||(t=Math.min(t,a.min)),i||(n=Math.max(n,a.max));return t=i&&t>n?n:t,n=s&&t>n?t:n,{min:Pn(t,Pn(n,t)),max:Pn(n,Pn(t,n))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){nt(this.options.beforeUpdate,[this])}update(e,t,n){const{beginAtZero:s,grace:i,ticks:a}=this.options,o=a.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=n=Object.assign({left:0,right:0,top:0,bottom:0},n),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+n.left+n.right:this.height+n.top+n.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=jI(this,i,s),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=o<this.ticks.length;this._convertTicksToLabels(l?Nw(this.ticks,o):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),a.display&&(a.autoSkip||a.source==="auto")&&(this.ticks=b$(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,t,n;this.isHorizontal()?(t=this.left,n=this.right):(t=this.top,n=this.bottom,e=!e),this._startPixel=t,this._endPixel=n,this._reversePixels=e,this._length=n-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){nt(this.options.afterUpdate,[this])}beforeSetDimensions(){nt(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){nt(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),nt(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){nt(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const t=this.options.ticks;let n,s,i;for(n=0,s=e.length;n<s;n++)i=e[n],i.label=nt(t.callback,[i.value,n,e],this)}afterTickToLabelConversion(){nt(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){nt(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,t=e.ticks,n=Mw(this.ticks.length,e.ticks.maxTicksLimit),s=t.minRotation||0,i=t.maxRotation;let a=s,o,l,c;if(!this._isVisible()||!t.display||s>=i||n<=1||!this.isHorizontal()){this.labelRotation=s;return}const u=this._getLabelSizes(),d=u.widest.width,h=u.highest.height,f=Nt(this.chart.width-d,0,this.maxWidth);o=e.offset?this.maxWidth/n:f/(n-1),d+6>o&&(o=f/(n-(e.offset?.5:1)),l=this.maxHeight-oo(e.grid)-t.padding-Lw(e.title,this.chart.options.font),c=Math.sqrt(d*d+h*h),a=$b(Math.min(Math.asin(Nt((u.highest.height+6)/o,-1,1)),Math.asin(Nt(l/c,-1,1))-Math.asin(Nt(h/c,-1,1)))),a=Math.max(s,Math.min(i,a))),this.labelRotation=a}afterCalculateLabelRotation(){nt(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){nt(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:t,options:{ticks:n,title:s,grid:i}}=this,a=this._isVisible(),o=this.isHorizontal();if(a){const l=Lw(s,t.options.font);if(o?(e.width=this.maxWidth,e.height=oo(i)+l):(e.height=this.maxHeight,e.width=oo(i)+l),n.display&&this.ticks.length){const{first:c,last:u,widest:d,highest:h}=this._getLabelSizes(),f=n.padding*2,p=Kn(this.labelRotation),m=Math.cos(p),g=Math.sin(p);if(o){const b=n.mirror?0:g*d.width+m*h.height;e.height=Math.min(this.maxHeight,e.height+b+f)}else{const b=n.mirror?0:m*d.width+g*h.height;e.width=Math.min(this.maxWidth,e.width+b+f)}this._calculatePadding(c,u,g,m)}}this._handleMargins(),o?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,n,s){const{ticks:{align:i,padding:a},position:o}=this.options,l=this.labelRotation!==0,c=o!=="top"&&this.axis==="x";if(this.isHorizontal()){const u=this.getPixelForTick(0)-this.left,d=this.right-this.getPixelForTick(this.ticks.length-1);let h=0,f=0;l?c?(h=s*e.width,f=n*t.height):(h=n*e.height,f=s*t.width):i==="start"?f=t.width:i==="end"?h=e.width:i!=="inner"&&(h=e.width/2,f=t.width/2),this.paddingLeft=Math.max((h-u+a)*this.width/(this.width-u),0),this.paddingRight=Math.max((f-d+a)*this.width/(this.width-d),0)}else{let u=t.height/2,d=e.height/2;i==="start"?(u=0,d=e.height):i==="end"&&(u=t.height,d=0),this.paddingTop=u+a,this.paddingBottom=d+a}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){nt(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:t}=this.options;return t==="top"||t==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let t,n;for(t=0,n=e.length;t<n;t++)Ne(e[t].label)&&(e.splice(t,1),n--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const t=this.options.ticks.sampleSize;let n=this.ticks;t<n.length&&(n=Nw(n,t)),this._labelSizes=e=this._computeLabelSizes(n,n.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,t,n){const{ctx:s,_longestTextCache:i}=this,a=[],o=[],l=Math.floor(t/Mw(t,n));let c=0,u=0,d,h,f,p,m,g,b,_,y,w,v;for(d=0;d<t;d+=l){if(p=e[d].label,m=this._resolveTickFontOptions(d),s.font=g=m.string,b=i[g]=i[g]||{data:{},gc:[]},_=m.lineHeight,y=w=0,!Ne(p)&&!ct(p))y=vd(s,b.data,b.gc,y,p),w=_;else if(ct(p))for(h=0,f=p.length;h<f;++h)v=p[h],!Ne(v)&&!ct(v)&&(y=vd(s,b.data,b.gc,y,v),w+=_);a.push(y),o.push(w),c=Math.max(y,c),u=Math.max(w,u)}P$(i,t);const x=a.indexOf(c),S=o.indexOf(u),k=R=>({width:a[R]||0,height:o[R]||0});return{first:k(0),last:k(t-1),widest:k(x),highest:k(S),widths:a,heights:o}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const t=this._startPixel+e*this._length;return hI(this._alignToPixels?Gs(this.chart,t,0):t)}getDecimalForPixel(e){const t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){const t=this.ticks||[];if(e>=0&&e<t.length){const n=t[e];return n.$context||(n.$context=E$(this.getContext(),e,n))}return this.$context||(this.$context=A$(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,t=Kn(this.labelRotation),n=Math.abs(Math.cos(t)),s=Math.abs(Math.sin(t)),i=this._getLabelSizes(),a=e.autoSkipPadding||0,o=i?i.widest.width+a:0,l=i?i.highest.height+a:0;return this.isHorizontal()?l*n>o*s?o/n:l/s:l*s<o*n?l/n:o/s}_isVisible(){const e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const t=this.axis,n=this.chart,s=this.options,{grid:i,position:a,border:o}=s,l=i.offset,c=this.isHorizontal(),d=this.ticks.length+(l?1:0),h=oo(i),f=[],p=o.setContext(this.getContext()),m=p.display?p.width:0,g=m/2,b=function(O){return Gs(n,O,m)};let _,y,w,v,x,S,k,R,D,C,N,$;if(a==="top")_=b(this.bottom),S=this.bottom-h,R=_-g,C=b(e.top)+g,$=e.bottom;else if(a==="bottom")_=b(this.top),C=e.top,$=b(e.bottom)-g,S=_+g,R=this.top+h;else if(a==="left")_=b(this.right),x=this.right-h,k=_-g,D=b(e.left)+g,N=e.right;else if(a==="right")_=b(this.left),D=e.left,N=b(e.right)-g,x=_+g,k=this.left+h;else if(t==="x"){if(a==="center")_=b((e.top+e.bottom)/2+.5);else if(je(a)){const O=Object.keys(a)[0],I=a[O];_=b(this.chart.scales[O].getPixelForValue(I))}C=e.top,$=e.bottom,S=_+g,R=S+h}else if(t==="y"){if(a==="center")_=b((e.left+e.right)/2);else if(je(a)){const O=Object.keys(a)[0],I=a[O];_=b(this.chart.scales[O].getPixelForValue(I))}x=_-g,k=x-h,D=e.left,N=e.right}const P=Se(s.ticks.maxTicksLimit,d),E=Math.max(1,Math.ceil(d/P));for(y=0;y<d;y+=E){const O=this.getContext(y),I=i.setContext(O),T=o.setContext(O),j=I.lineWidth,W=I.color,ee=T.dash||[],Z=T.dashOffset,X=I.tickWidth,U=I.tickColor,G=I.tickBorderDash||[],le=I.tickBorderDashOffset;w=S$(this,y,l),w!==void 0&&(v=Gs(n,w,j),c?x=k=D=N=v:S=R=C=$=v,f.push({tx1:x,ty1:S,tx2:k,ty2:R,x1:D,y1:C,x2:N,y2:$,width:j,color:W,borderDash:ee,borderDashOffset:Z,tickWidth:X,tickColor:U,tickBorderDash:G,tickBorderDashOffset:le}))}return this._ticksLength=d,this._borderValue=_,f}_computeLabelItems(e){const t=this.axis,n=this.options,{position:s,ticks:i}=n,a=this.isHorizontal(),o=this.ticks,{align:l,crossAlign:c,padding:u,mirror:d}=i,h=oo(n.grid),f=h+u,p=d?-u:f,m=-Kn(this.labelRotation),g=[];let b,_,y,w,v,x,S,k,R,D,C,N,$="middle";if(s==="top")x=this.bottom-p,S=this._getXAxisLabelAlignment();else if(s==="bottom")x=this.top+p,S=this._getXAxisLabelAlignment();else if(s==="left"){const E=this._getYAxisLabelAlignment(h);S=E.textAlign,v=E.x}else if(s==="right"){const E=this._getYAxisLabelAlignment(h);S=E.textAlign,v=E.x}else if(t==="x"){if(s==="center")x=(e.top+e.bottom)/2+f;else if(je(s)){const E=Object.keys(s)[0],O=s[E];x=this.chart.scales[E].getPixelForValue(O)+f}S=this._getXAxisLabelAlignment()}else if(t==="y"){if(s==="center")v=(e.left+e.right)/2-f;else if(je(s)){const E=Object.keys(s)[0],O=s[E];v=this.chart.scales[E].getPixelForValue(O)}S=this._getYAxisLabelAlignment(h).textAlign}t==="y"&&(l==="start"?$="top":l==="end"&&($="bottom"));const P=this._getLabelSizes();for(b=0,_=o.length;b<_;++b){y=o[b],w=y.label;const E=i.setContext(this.getContext(b));k=this.getPixelForTick(b)+i.labelOffset,R=this._resolveTickFontOptions(b),D=R.lineHeight,C=ct(w)?w.length:1;const O=C/2,I=E.color,T=E.textStrokeColor,j=E.textStrokeWidth;let W=S;a?(v=k,S==="inner"&&(b===_-1?W=this.options.reverse?"left":"right":b===0?W=this.options.reverse?"right":"left":W="center"),s==="top"?c==="near"||m!==0?N=-C*D+D/2:c==="center"?N=-P.highest.height/2-O*D+D:N=-P.highest.height+D/2:c==="near"||m!==0?N=D/2:c==="center"?N=P.highest.height/2-O*D:N=P.highest.height-C*D,d&&(N*=-1),m!==0&&!E.showLabelBackdrop&&(v+=D/2*Math.sin(m))):(x=k,N=(1-C)*D/2);let ee;if(E.showLabelBackdrop){const Z=Xt(E.backdropPadding),X=P.heights[b],U=P.widths[b];let G=N-Z.top,le=0-Z.left;switch($){case"middle":G-=X/2;break;case"bottom":G-=X;break}switch(S){case"center":le-=U/2;break;case"right":le-=U;break;case"inner":b===_-1?le-=U:b>0&&(le-=U/2);break}ee={left:le,top:G,width:U+Z.width,height:X+Z.height,color:E.backdropColor}}g.push({label:w,font:R,textOffset:N,options:{rotation:m,color:I,strokeColor:T,strokeWidth:j,textAlign:W,textBaseline:$,translation:[v,x],backdrop:ee}})}return g}_getXAxisLabelAlignment(){const{position:e,ticks:t}=this.options;if(-Kn(this.labelRotation))return e==="top"?"left":"right";let s="center";return t.align==="start"?s="left":t.align==="end"?s="right":t.align==="inner"&&(s="inner"),s}_getYAxisLabelAlignment(e){const{position:t,ticks:{crossAlign:n,mirror:s,padding:i}}=this.options,a=this._getLabelSizes(),o=e+i,l=a.widest.width;let c,u;return t==="left"?s?(u=this.right+i,n==="near"?c="left":n==="center"?(c="center",u+=l/2):(c="right",u+=l)):(u=this.right-o,n==="near"?c="right":n==="center"?(c="center",u-=l/2):(c="left",u=this.left)):t==="right"?s?(u=this.left+i,n==="near"?c="right":n==="center"?(c="center",u-=l/2):(c="left",u-=l)):(u=this.left+o,n==="near"?c="left":n==="center"?(c="center",u+=l/2):(c="right",u=this.right)):c="right",{textAlign:c,x:u}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,t=this.options.position;if(t==="left"||t==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(t==="top"||t==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){const{ctx:e,options:{backgroundColor:t},left:n,top:s,width:i,height:a}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(n,s,i,a),e.restore())}getLineWidthForValue(e){const t=this.options.grid;if(!this._isVisible()||!t.display)return 0;const s=this.ticks.findIndex(i=>i.value===e);return s>=0?t.setContext(this.getContext(s)).lineWidth:0}drawGrid(e){const t=this.options.grid,n=this.ctx,s=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let i,a;const o=(l,c,u)=>{!u.width||!u.color||(n.save(),n.lineWidth=u.width,n.strokeStyle=u.color,n.setLineDash(u.borderDash||[]),n.lineDashOffset=u.borderDashOffset,n.beginPath(),n.moveTo(l.x,l.y),n.lineTo(c.x,c.y),n.stroke(),n.restore())};if(t.display)for(i=0,a=s.length;i<a;++i){const l=s[i];t.drawOnChartArea&&o({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),t.drawTicks&&o({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:t,options:{border:n,grid:s}}=this,i=n.setContext(this.getContext()),a=n.display?i.width:0;if(!a)return;const o=s.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let c,u,d,h;this.isHorizontal()?(c=Gs(e,this.left,a)-a/2,u=Gs(e,this.right,o)+o/2,d=h=l):(d=Gs(e,this.top,a)-a/2,h=Gs(e,this.bottom,o)+o/2,c=u=l),t.save(),t.lineWidth=i.width,t.strokeStyle=i.color,t.beginPath(),t.moveTo(c,d),t.lineTo(u,h),t.stroke(),t.restore()}drawLabels(e){if(!this.options.ticks.display)return;const n=this.ctx,s=this._computeLabelArea();s&&Eh(n,s);const i=this.getLabelItems(e);for(const a of i){const o=a.options,l=a.font,c=a.label,u=a.textOffset;gi(n,c,0,u,l,o)}s&&Oh(n)}drawTitle(){const{ctx:e,options:{position:t,title:n,reverse:s}}=this;if(!n.display)return;const i=Ot(n.font),a=Xt(n.padding),o=n.align;let l=i.lineHeight/2;t==="bottom"||t==="center"||je(t)?(l+=a.bottom,ct(n.text)&&(l+=i.lineHeight*(n.text.length-1))):l+=a.top;const{titleX:c,titleY:u,maxWidth:d,rotation:h}=T$(this,l,t,o);gi(e,n.text,0,0,i,{color:n.color,maxWidth:d,rotation:h,textAlign:O$(o,t,s),textBaseline:"middle",translation:[c,u]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,t=e.ticks&&e.ticks.z||0,n=Se(e.grid&&e.grid.z,-1),s=Se(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==Ai.prototype.draw?[{z:t,draw:i=>{this.draw(i)}}]:[{z:n,draw:i=>{this.drawBackground(),this.drawGrid(i),this.drawTitle()}},{z:s,draw:()=>{this.drawBorder()}},{z:t,draw:i=>{this.drawLabels(i)}}]}getMatchingVisibleMetas(e){const t=this.chart.getSortedVisibleDatasetMetas(),n=this.axis+"AxisID",s=[];let i,a;for(i=0,a=t.length;i<a;++i){const o=t[i];o[n]===this.id&&(!e||o.type===e)&&s.push(o)}return s}_resolveTickFontOptions(e){const t=this.options.ticks.setContext(this.getContext(e));return Ot(t.font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class nu{constructor(e,t,n){this.type=e,this.scope=t,this.override=n,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const t=Object.getPrototypeOf(e);let n;C$(t)&&(n=this.register(t));const s=this.items,i=e.id,a=this.scope+"."+i;if(!i)throw new Error("class does not have id: "+e);return i in s||(s[i]=e,R$(e,a,n),this.override&&ut.override(e.id,e.overrides)),a}get(e){return this.items[e]}unregister(e){const t=this.items,n=e.id,s=this.scope;n in t&&delete t[n],s&&n in ut[s]&&(delete ut[s][n],this.override&&delete mi[n])}}function R$(r,e,t){const n=ml(Object.create(null),[t?ut.get(t):{},ut.get(e),r.defaults]);ut.set(e,n),r.defaultRoutes&&I$(e,r.defaultRoutes),r.descriptors&&ut.describe(e,r.descriptors)}function I$(r,e){Object.keys(e).forEach(t=>{const n=t.split("."),s=n.pop(),i=[r].concat(n).join("."),a=e[t].split("."),o=a.pop(),l=a.join(".");ut.route(i,s,l,o)})}function C$(r){return"id"in r&&"defaults"in r}class $${constructor(){this.controllers=new nu(tr,"datasets",!0),this.elements=new nu(ns,"elements"),this.plugins=new nu(Object,"plugins"),this.scales=new nu(Ai,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,t,n){[...t].forEach(s=>{const i=n||this._getRegistryForType(s);n||i.isForType(s)||i===this.plugins&&s.id?this._exec(e,i,s):Je(s,a=>{const o=n||this._getRegistryForType(a);this._exec(e,o,a)})})}_exec(e,t,n){const s=Cb(e);nt(n["before"+s],[],n),t[e](n),nt(n["after"+s],[],n)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){const n=this._typedRegistries[t];if(n.isForType(e))return n}return this.plugins}_get(e,t,n){const s=t.get(e);if(s===void 0)throw new Error('"'+e+'" is not a registered '+n+".");return s}}var br=new $$;class M${constructor(){this._init=[]}notify(e,t,n,s){t==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const i=s?this._descriptors(e).filter(s):this._descriptors(e),a=this._notify(i,e,t,n);return t==="afterDestroy"&&(this._notify(i,e,"stop"),this._notify(this._init,e,"uninstall")),a}_notify(e,t,n,s){s=s||{};for(const i of e){const a=i.plugin,o=a[n],l=[t,s,i.options];if(nt(o,l,a)===!1&&s.cancelable)return!1}return!0}invalidate(){Ne(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){const n=e&&e.config,s=Se(n.options&&n.options.plugins,{}),i=N$(n);return s===!1&&!t?[]:j$(e,i,s,t)}_notifyStateChanges(e){const t=this._oldCache||[],n=this._cache,s=(i,a)=>i.filter(o=>!a.some(l=>o.plugin.id===l.plugin.id));this._notify(s(t,n),e,"stop"),this._notify(s(n,t),e,"start")}}function N$(r){const e={},t=[],n=Object.keys(br.plugins.items);for(let i=0;i<n.length;i++)t.push(br.getPlugin(n[i]));const s=r.plugins||[];for(let i=0;i<s.length;i++){const a=s[i];t.indexOf(a)===-1&&(t.push(a),e[a.id]=!0)}return{plugins:t,localIds:e}}function L$(r,e){return!e&&r===!1?null:r===!0?{}:r}function j$(r,{plugins:e,localIds:t},n,s){const i=[],a=r.getContext();for(const o of e){const l=o.id,c=L$(n[l],s);c!==null&&i.push({plugin:o,options:D$(r.config,{plugin:o,local:t[l]},c,a)})}return i}function D$(r,{plugin:e,local:t},n,s){const i=r.pluginScopeKeys(e),a=r.getOptionScopes(n,i);return t&&e.defaults&&a.push(e.defaults),r.createResolver(a,s,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function fg(r,e){const t=ut.datasets[r]||{};return((e.datasets||{})[r]||{}).indexAxis||e.indexAxis||t.indexAxis||"x"}function F$(r,e){let t=r;return r==="_index_"?t=e:r==="_value_"&&(t=e==="x"?"y":"x"),t}function z$(r,e){return r===e?"_index_":"_value_"}function jw(r){if(r==="x"||r==="y"||r==="r")return r}function B$(r){if(r==="top"||r==="bottom")return"x";if(r==="left"||r==="right")return"y"}function pg(r,...e){if(jw(r))return r;for(const t of e){const n=t.axis||B$(t.position)||r.length>1&&jw(r[0].toLowerCase());if(n)return n}throw new Error(`Cannot determine type of '${r}' axis. Please provide 'axis' or 'position' option.`)}function Dw(r,e,t){if(t[e+"AxisID"]===r)return{axis:e}}function U$(r,e){if(e.data&&e.data.datasets){const t=e.data.datasets.filter(n=>n.xAxisID===r||n.yAxisID===r);if(t.length)return Dw(r,"x",t[0])||Dw(r,"y",t[0])}return{}}function q$(r,e){const t=mi[r.type]||{scales:{}},n=e.scales||{},s=fg(r.type,e),i=Object.create(null);return Object.keys(n).forEach(a=>{const o=n[a];if(!je(o))return console.error(`Invalid scale configuration for scale: ${a}`);if(o._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${a}`);const l=pg(a,o,U$(a,r),ut.scales[o.type]),c=z$(l,s),u=t.scales||{};i[a]=Ko(Object.create(null),[{axis:l},o,u[l],u[c]])}),r.data.datasets.forEach(a=>{const o=a.type||r.type,l=a.indexAxis||fg(o,e),u=(mi[o]||{}).scales||{};Object.keys(u).forEach(d=>{const h=F$(d,l),f=a[h+"AxisID"]||h;i[f]=i[f]||Object.create(null),Ko(i[f],[{axis:h},n[f],u[d]])})}),Object.keys(i).forEach(a=>{const o=i[a];Ko(o,[ut.scales[o.type],ut.scale])}),i}function XS(r){const e=r.options||(r.options={});e.plugins=Se(e.plugins,{}),e.scales=q$(r,e)}function YS(r){return r=r||{},r.datasets=r.datasets||[],r.labels=r.labels||[],r}function H$(r){return r=r||{},r.data=YS(r.data),XS(r),r}const Fw=new Map,QS=new Set;function ru(r,e){let t=Fw.get(r);return t||(t=e(),Fw.set(r,t),QS.add(t)),t}const lo=(r,e,t)=>{const n=Ts(e,t);n!==void 0&&r.add(n)};class W${constructor(e){this._config=H$(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=YS(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),XS(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return ru(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,t){return ru(`${e}.transition.${t}`,()=>[[`datasets.${e}.transitions.${t}`,`transitions.${t}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,t){return ru(`${e}-${t}`,()=>[[`datasets.${e}.elements.${t}`,`datasets.${e}`,`elements.${t}`,""]])}pluginScopeKeys(e){const t=e.id,n=this.type;return ru(`${n}-plugin-${t}`,()=>[[`plugins.${t}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,t){const n=this._scopeCache;let s=n.get(e);return(!s||t)&&(s=new Map,n.set(e,s)),s}getOptionScopes(e,t,n){const{options:s,type:i}=this,a=this._cachedScopes(e,n),o=a.get(t);if(o)return o;const l=new Set;t.forEach(u=>{e&&(l.add(e),u.forEach(d=>lo(l,e,d))),u.forEach(d=>lo(l,s,d)),u.forEach(d=>lo(l,mi[i]||{},d)),u.forEach(d=>lo(l,ut,d)),u.forEach(d=>lo(l,ug,d))});const c=Array.from(l);return c.length===0&&c.push(Object.create(null)),QS.has(t)&&a.set(t,c),c}chartOptionScopes(){const{options:e,type:t}=this;return[e,mi[t]||{},ut.datasets[t]||{},{type:t},ut,ug]}resolveNamedOptions(e,t,n,s=[""]){const i={$shared:!0},{resolver:a,subPrefixes:o}=zw(this._resolverCache,e,s);let l=a;if(G$(a,t)){i.$shared=!1,n=Rs(n)?n():n;const c=this.createResolver(e,n,o);l=Oa(a,n,c)}for(const c of t)i[c]=l[c];return i}createResolver(e,t,n=[""],s){const{resolver:i}=zw(this._resolverCache,e,n);return je(t)?Oa(i,t,void 0,s):i}}function zw(r,e,t){let n=r.get(e);n||(n=new Map,r.set(e,n));const s=t.join();let i=n.get(s);return i||(i={resolver:Db(e,t),subPrefixes:t.filter(o=>!o.toLowerCase().includes("hover"))},n.set(s,i)),i}const V$=r=>je(r)&&Object.getOwnPropertyNames(r).some(e=>Rs(r[e]));function G$(r,e){const{isScriptable:t,isIndexable:n}=IS(r);for(const s of e){const i=t(s),a=n(s),o=(a||i)&&r[s];if(i&&(Rs(o)||V$(o))||a&&ct(o))return!0}return!1}var Z$="4.4.9";const J$=["top","bottom","left","right","chartArea"];function Bw(r,e){return r==="top"||r==="bottom"||J$.indexOf(r)===-1&&e==="x"}function Uw(r,e){return function(t,n){return t[r]===n[r]?t[e]-n[e]:t[r]-n[r]}}function qw(r){const e=r.chart,t=e.options.animation;e.notifyPlugins("afterRender"),nt(t&&t.onComplete,[r],e)}function K$(r){const e=r.chart,t=e.options.animation;nt(t&&t.onProgress,[r],e)}function e1(r){return Bb()&&typeof r=="string"?r=document.getElementById(r):r&&r.length&&(r=r[0]),r&&r.canvas&&(r=r.canvas),r}const rd={},Hw=r=>{const e=e1(r);return Object.values(rd).filter(t=>t.canvas===e).pop()};function X$(r,e,t){const n=Object.keys(r);for(const s of n){const i=+s;if(i>=e){const a=r[s];delete r[s],(t>0||i>e)&&(r[i+t]=a)}}}function Y$(r,e,t,n){return!t||r.type==="mouseout"?null:n?e:r}class Wr{static register(...e){br.add(...e),Ww()}static unregister(...e){br.remove(...e),Ww()}constructor(e,t){const n=this.config=new W$(t),s=e1(e),i=Hw(s);if(i)throw new Error("Canvas is already in use. Chart with ID '"+i.id+"' must be destroyed before the canvas with ID '"+i.canvas.id+"' can be reused.");const a=n.createResolver(n.chartOptionScopes(),this.getContext());this.platform=new(n.platform||g$(s)),this.platform.updateConfig(n);const o=this.platform.acquireContext(s,a.aspectRatio),l=o&&o.canvas,c=l&&l.height,u=l&&l.width;if(this.id=QR(),this.ctx=o,this.canvas=l,this.width=u,this.height=c,this._options=a,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new M$,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=gI(d=>this.update(d),a.resizeDelay||0),this._dataChanges=[],rd[this.id]=this,!o||!l){console.error("Failed to create chart: can't acquire context from the given item");return}Dr.listen(this,"complete",qw),Dr.listen(this,"progress",K$),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:t},width:n,height:s,_aspectRatio:i}=this;return Ne(e)?t&&i?i:s?n/s:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return br}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():fw(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return uw(this.canvas,this.ctx),this}stop(){return Dr.stop(this),this}resize(e,t){Dr.running(this)?this._resizeBeforeDraw={width:e,height:t}:this._resize(e,t)}_resize(e,t){const n=this.options,s=this.canvas,i=n.maintainAspectRatio&&this.aspectRatio,a=this.platform.getMaximumSize(s,e,t,i),o=n.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=a.width,this.height=a.height,this._aspectRatio=this.aspectRatio,fw(this,o,!0)&&(this.notifyPlugins("resize",{size:a}),nt(n.onResize,[this,a],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const t=this.options.scales||{};Je(t,(n,s)=>{n.id=s})}buildOrUpdateScales(){const e=this.options,t=e.scales,n=this.scales,s=Object.keys(n).reduce((a,o)=>(a[o]=!1,a),{});let i=[];t&&(i=i.concat(Object.keys(t).map(a=>{const o=t[a],l=pg(a,o),c=l==="r",u=l==="x";return{options:o,dposition:c?"chartArea":u?"bottom":"left",dtype:c?"radialLinear":u?"category":"linear"}}))),Je(i,a=>{const o=a.options,l=o.id,c=pg(l,o),u=Se(o.type,a.dtype);(o.position===void 0||Bw(o.position,c)!==Bw(a.dposition))&&(o.position=a.dposition),s[l]=!0;let d=null;if(l in n&&n[l].type===u)d=n[l];else{const h=br.getScale(u);d=new h({id:l,type:u,ctx:this.ctx,chart:this}),n[d.id]=d}d.init(o,e)}),Je(s,(a,o)=>{a||delete n[o]}),Je(n,a=>{Kt.configure(this,a,a.options),Kt.addBox(this,a)})}_updateMetasets(){const e=this._metasets,t=this.data.datasets.length,n=e.length;if(e.sort((s,i)=>s.index-i.index),n>t){for(let s=t;s<n;++s)this._destroyDatasetMeta(s);e.splice(t,n-t)}this._sortedMetasets=e.slice(0).sort(Uw("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:t}}=this;e.length>t.length&&delete this._stacks,e.forEach((n,s)=>{t.filter(i=>i===n._dataset).length===0&&this._destroyDatasetMeta(s)})}buildOrUpdateControllers(){const e=[],t=this.data.datasets;let n,s;for(this._removeUnreferencedMetasets(),n=0,s=t.length;n<s;n++){const i=t[n];let a=this.getDatasetMeta(n);const o=i.type||this.config.type;if(a.type&&a.type!==o&&(this._destroyDatasetMeta(n),a=this.getDatasetMeta(n)),a.type=o,a.indexAxis=i.indexAxis||fg(o,this.options),a.order=i.order||0,a.index=n,a.label=""+i.label,a.visible=this.isDatasetVisible(n),a.controller)a.controller.updateIndex(n),a.controller.linkScales();else{const l=br.getController(o),{datasetElementType:c,dataElementType:u}=ut.datasets[o];Object.assign(l,{dataElementType:br.getElement(u),datasetElementType:c&&br.getElement(c)}),a.controller=new l(this,n),e.push(a.controller)}}return this._updateMetasets(),e}_resetElements(){Je(this.data.datasets,(e,t)=>{this.getDatasetMeta(t).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const t=this.config;t.update();const n=this._options=t.createResolver(t.chartOptionScopes(),this.getContext()),s=this._animationsDisabled=!n.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;const i=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let a=0;for(let c=0,u=this.data.datasets.length;c<u;c++){const{controller:d}=this.getDatasetMeta(c),h=!s&&i.indexOf(d)===-1;d.buildOrUpdateElements(h),a=Math.max(+d.getMaxOverflow(),a)}a=this._minPadding=n.layout.autoPadding?a:0,this._updateLayout(a),s||Je(i,c=>{c.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(Uw("z","_idx"));const{_active:o,_lastEvent:l}=this;l?this._eventHandler(l,!0):o.length&&this._updateHoverStyles(o,o,!0),this.render()}_updateScales(){Je(this.scales,e=>{Kt.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,t=new Set(Object.keys(this._listeners)),n=new Set(e.events);(!tw(t,n)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,t=this._getUniformDataChanges()||[];for(const{method:n,start:s,count:i}of t){const a=n==="_removeElements"?-i:i;X$(e,s,a)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const t=this.data.datasets.length,n=i=>new Set(e.filter(a=>a[0]===i).map((a,o)=>o+","+a.splice(1).join(","))),s=n(0);for(let i=1;i<t;i++)if(!tw(s,n(i)))return;return Array.from(s).map(i=>i.split(",")).map(i=>({method:i[1],start:+i[2],count:+i[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Kt.update(this,this.width,this.height,e);const t=this.chartArea,n=t.width<=0||t.height<=0;this._layers=[],Je(this.boxes,s=>{n&&s.position==="chartArea"||(s.configure&&s.configure(),this._layers.push(...s._layers()))},this),this._layers.forEach((s,i)=>{s._idx=i}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let t=0,n=this.data.datasets.length;t<n;++t)this.getDatasetMeta(t).controller.configure();for(let t=0,n=this.data.datasets.length;t<n;++t)this._updateDataset(t,Rs(e)?e({datasetIndex:t}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,t){const n=this.getDatasetMeta(e),s={meta:n,index:e,mode:t,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",s)!==!1&&(n.controller._update(t),s.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",s))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Dr.has(this)?this.attached&&!Dr.running(this)&&Dr.start(this):(this.draw(),qw({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:n,height:s}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(n,s)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const t=this._layers;for(e=0;e<t.length&&t[e].z<=0;++e)t[e].draw(this.chartArea);for(this._drawDatasets();e<t.length;++e)t[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const t=this._sortedMetasets,n=[];let s,i;for(s=0,i=t.length;s<i;++s){const a=t[s];(!e||a.visible)&&n.push(a)}return n}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const e=this.getSortedVisibleDatasetMetas();for(let t=e.length-1;t>=0;--t)this._drawDataset(e[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const t=this.ctx,n={meta:e,index:e.index,cancelable:!0},s=US(this,e);this.notifyPlugins("beforeDatasetDraw",n)!==!1&&(s&&Eh(t,s),e.controller.draw(),s&&Oh(t),n.cancelable=!1,this.notifyPlugins("afterDatasetDraw",n))}isPointInArea(e){return Yr(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,t,n,s){const i=JC.modes[t];return typeof i=="function"?i(this,e,n,s):[]}getDatasetMeta(e){const t=this.data.datasets[e],n=this._metasets;let s=n.filter(i=>i&&i._dataset===t).pop();return s||(s={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:e,_dataset:t,_parsed:[],_sorted:!1},n.push(s)),s}getContext(){return this.$context||(this.$context=Fs(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const t=this.data.datasets[e];if(!t)return!1;const n=this.getDatasetMeta(e);return typeof n.hidden=="boolean"?!n.hidden:!t.hidden}setDatasetVisibility(e,t){const n=this.getDatasetMeta(e);n.hidden=!t}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,t,n){const s=n?"show":"hide",i=this.getDatasetMeta(e),a=i.controller._resolveAnimations(void 0,s);gl(t)?(i.data[t].hidden=!n,this.update()):(this.setDatasetVisibility(e,n),a.update(i,{visible:n}),this.update(o=>o.datasetIndex===e?s:void 0))}hide(e,t){this._updateVisibility(e,t,!1)}show(e,t){this._updateVisibility(e,t,!0)}_destroyDatasetMeta(e){const t=this._metasets[e];t&&t.controller&&t.controller._destroy(),delete this._metasets[e]}_stop(){let e,t;for(this.stop(),Dr.remove(this),e=0,t=this.data.datasets.length;e<t;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:t}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),uw(e,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),delete rd[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,t=this.platform,n=(i,a)=>{t.addEventListener(this,i,a),e[i]=a},s=(i,a,o)=>{i.offsetX=a,i.offsetY=o,this._eventHandler(i)};Je(this.options.events,i=>n(i,s))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,t=this.platform,n=(l,c)=>{t.addEventListener(this,l,c),e[l]=c},s=(l,c)=>{e[l]&&(t.removeEventListener(this,l,c),delete e[l])},i=(l,c)=>{this.canvas&&this.resize(l,c)};let a;const o=()=>{s("attach",o),this.attached=!0,this.resize(),n("resize",i),n("detach",a)};a=()=>{this.attached=!1,s("resize",i),this._stop(),this._resize(0,0),n("attach",o)},t.isAttached(this.canvas)?o():a()}unbindEvents(){Je(this._listeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._listeners={},Je(this._responsiveListeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,t,n){const s=n?"set":"remove";let i,a,o,l;for(t==="dataset"&&(i=this.getDatasetMeta(e[0].datasetIndex),i.controller["_"+s+"DatasetHoverStyle"]()),o=0,l=e.length;o<l;++o){a=e[o];const c=a&&this.getDatasetMeta(a.datasetIndex).controller;c&&c[s+"HoverStyle"](a.element,a.datasetIndex,a.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const t=this._active||[],n=e.map(({datasetIndex:i,index:a})=>{const o=this.getDatasetMeta(i);if(!o)throw new Error("No dataset found at index "+i);return{datasetIndex:i,element:o.data[a],index:a}});!_d(n,t)&&(this._active=n,this._lastEvent=null,this._updateHoverStyles(n,t))}notifyPlugins(e,t,n){return this._plugins.notify(this,e,t,n)}isPluginEnabled(e){return this._plugins._cache.filter(t=>t.plugin.id===e).length===1}_updateHoverStyles(e,t,n){const s=this.options.hover,i=(l,c)=>l.filter(u=>!c.some(d=>u.datasetIndex===d.datasetIndex&&u.index===d.index)),a=i(t,e),o=n?e:i(e,t);a.length&&this.updateHoverStyle(a,s.mode,!1),o.length&&s.mode&&this.updateHoverStyle(o,s.mode,!0)}_eventHandler(e,t){const n={event:e,replay:t,cancelable:!0,inChartArea:this.isPointInArea(e)},s=a=>(a.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",n,s)===!1)return;const i=this._handleEvent(e,t,n.inChartArea);return n.cancelable=!1,this.notifyPlugins("afterEvent",n,s),(i||n.changed)&&this.render(),this}_handleEvent(e,t,n){const{_active:s=[],options:i}=this,a=t,o=this._getActiveElements(e,s,n,a),l=iI(e),c=Y$(e,this._lastEvent,n,l);n&&(this._lastEvent=null,nt(i.onHover,[e,o,this],this),l&&nt(i.onClick,[e,o,this],this));const u=!_d(o,s);return(u||t)&&(this._active=o,this._updateHoverStyles(o,s,t)),this._lastEvent=c,u}_getActiveElements(e,t,n,s){if(e.type==="mouseout")return[];if(!n)return t;const i=this.options.hover;return this.getElementsAtEventForMode(e,i.mode,i,s)}}M(Wr,"defaults",ut),M(Wr,"instances",rd),M(Wr,"overrides",mi),M(Wr,"registry",br),M(Wr,"version",Z$),M(Wr,"getChart",Hw);function Ww(){return Je(Wr.instances,r=>r._plugins.invalidate())}function Q$(r,e,t){const{startAngle:n,pixelMargin:s,x:i,y:a,outerRadius:o,innerRadius:l}=e;let c=s/o;r.beginPath(),r.arc(i,a,o,n-c,t+c),l>s?(c=s/l,r.arc(i,a,l,t+c,n-c,!0)):r.arc(i,a,s,t+wt,n-wt),r.closePath(),r.clip()}function eM(r){return jb(r,["outerStart","outerEnd","innerStart","innerEnd"])}function tM(r,e,t,n){const s=eM(r.options.borderRadius),i=(t-e)/2,a=Math.min(i,n*e/2),o=l=>{const c=(t-Math.min(i,l))*n/2;return Nt(l,0,Math.min(i,c))};return{outerStart:o(s.outerStart),outerEnd:o(s.outerEnd),innerStart:Nt(s.innerStart,0,a),innerEnd:Nt(s.innerEnd,0,a)}}function Li(r,e,t,n){return{x:t+r*Math.cos(e),y:n+r*Math.sin(e)}}function Sd(r,e,t,n,s,i){const{x:a,y:o,startAngle:l,pixelMargin:c,innerRadius:u}=e,d=Math.max(e.outerRadius+n+t-c,0),h=u>0?u+n+t+c:0;let f=0;const p=s-l;if(n){const E=u>0?u-n:0,O=d>0?d-n:0,I=(E+O)/2,T=I!==0?p*I/(I+n):p;f=(p-T)/2}const m=Math.max(.001,p*d-t/it)/d,g=(p-m)/2,b=l+g+f,_=s-g-f,{outerStart:y,outerEnd:w,innerStart:v,innerEnd:x}=tM(e,h,d,_-b),S=d-y,k=d-w,R=b+y/S,D=_-w/k,C=h+v,N=h+x,$=b+v/C,P=_-x/N;if(r.beginPath(),i){const E=(R+D)/2;if(r.arc(a,o,d,R,E),r.arc(a,o,d,E,D),w>0){const j=Li(k,D,a,o);r.arc(j.x,j.y,w,D,_+wt)}const O=Li(N,_,a,o);if(r.lineTo(O.x,O.y),x>0){const j=Li(N,P,a,o);r.arc(j.x,j.y,x,_+wt,P+Math.PI)}const I=(_-x/h+(b+v/h))/2;if(r.arc(a,o,h,_-x/h,I,!0),r.arc(a,o,h,I,b+v/h,!0),v>0){const j=Li(C,$,a,o);r.arc(j.x,j.y,v,$+Math.PI,b-wt)}const T=Li(S,b,a,o);if(r.lineTo(T.x,T.y),y>0){const j=Li(S,R,a,o);r.arc(j.x,j.y,y,b-wt,R)}}else{r.moveTo(a,o);const E=Math.cos(R)*d+a,O=Math.sin(R)*d+o;r.lineTo(E,O);const I=Math.cos(D)*d+a,T=Math.sin(D)*d+o;r.lineTo(I,T)}r.closePath()}function nM(r,e,t,n,s){const{fullCircles:i,startAngle:a,circumference:o}=e;let l=e.endAngle;if(i){Sd(r,e,t,n,l,s);for(let c=0;c<i;++c)r.fill();isNaN(o)||(l=a+(o%st||st))}return Sd(r,e,t,n,l,s),r.fill(),l}function rM(r,e,t,n,s){const{fullCircles:i,startAngle:a,circumference:o,options:l}=e,{borderWidth:c,borderJoinStyle:u,borderDash:d,borderDashOffset:h}=l,f=l.borderAlign==="inner";if(!c)return;r.setLineDash(d||[]),r.lineDashOffset=h,f?(r.lineWidth=c*2,r.lineJoin=u||"round"):(r.lineWidth=c,r.lineJoin=u||"bevel");let p=e.endAngle;if(i){Sd(r,e,t,n,p,s);for(let m=0;m<i;++m)r.stroke();isNaN(o)||(p=a+(o%st||st))}f&&Q$(r,e,p),i||(Sd(r,e,t,n,p,s),r.stroke())}class Mo extends ns{constructor(t){super();M(this,"circumference");M(this,"endAngle");M(this,"fullCircles");M(this,"innerRadius");M(this,"outerRadius");M(this,"pixelMargin");M(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,t&&Object.assign(this,t)}inRange(t,n,s){const i=this.getProps(["x","y"],s),{angle:a,distance:o}=vS(i,{x:t,y:n}),{startAngle:l,endAngle:c,innerRadius:u,outerRadius:d,circumference:h}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],s),f=(this.options.spacing+this.options.borderWidth)/2,p=Se(h,c-l),m=bl(a,l,c)&&l!==c,g=p>=st||m,b=Kr(o,u+f,d+f);return g&&b}getCenterPoint(t){const{x:n,y:s,startAngle:i,endAngle:a,innerRadius:o,outerRadius:l}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],t),{offset:c,spacing:u}=this.options,d=(i+a)/2,h=(o+l+u+c)/2;return{x:n+Math.cos(d)*h,y:s+Math.sin(d)*h}}tooltipPosition(t){return this.getCenterPoint(t)}draw(t){const{options:n,circumference:s}=this,i=(n.offset||0)/4,a=(n.spacing||0)/2,o=n.circular;if(this.pixelMargin=n.borderAlign==="inner"?.33:0,this.fullCircles=s>st?Math.floor(s/st):0,s===0||this.innerRadius<0||this.outerRadius<0)return;t.save();const l=(this.startAngle+this.endAngle)/2;t.translate(Math.cos(l)*i,Math.sin(l)*i);const c=1-Math.sin(Math.min(it,s||0)),u=i*c;t.fillStyle=n.backgroundColor,t.strokeStyle=n.borderColor,nM(t,this,u,a,o),rM(t,this,u,a,o),t.restore()}}M(Mo,"id","arc"),M(Mo,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),M(Mo,"defaultRoutes",{backgroundColor:"backgroundColor"}),M(Mo,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"});function t1(r,e,t=e){r.lineCap=Se(t.borderCapStyle,e.borderCapStyle),r.setLineDash(Se(t.borderDash,e.borderDash)),r.lineDashOffset=Se(t.borderDashOffset,e.borderDashOffset),r.lineJoin=Se(t.borderJoinStyle,e.borderJoinStyle),r.lineWidth=Se(t.borderWidth,e.borderWidth),r.strokeStyle=Se(t.borderColor,e.borderColor)}function sM(r,e,t){r.lineTo(t.x,t.y)}function iM(r){return r.stepped?OI:r.tension||r.cubicInterpolationMode==="monotone"?TI:sM}function n1(r,e,t={}){const n=r.length,{start:s=0,end:i=n-1}=t,{start:a,end:o}=e,l=Math.max(s,a),c=Math.min(i,o),u=s<a&&i<a||s>o&&i>o;return{count:n,start:l,loop:e.loop,ilen:c<l&&!u?n+c-l:c-l}}function aM(r,e,t,n){const{points:s,options:i}=e,{count:a,start:o,loop:l,ilen:c}=n1(s,t,n),u=iM(i);let{move:d=!0,reverse:h}=n||{},f,p,m;for(f=0;f<=c;++f)p=s[(o+(h?c-f:f))%a],!p.skip&&(d?(r.moveTo(p.x,p.y),d=!1):u(r,m,p,h,i.stepped),m=p);return l&&(p=s[(o+(h?c:0))%a],u(r,m,p,h,i.stepped)),!!l}function oM(r,e,t,n){const s=e.points,{count:i,start:a,ilen:o}=n1(s,t,n),{move:l=!0,reverse:c}=n||{};let u=0,d=0,h,f,p,m,g,b;const _=w=>(a+(c?o-w:w))%i,y=()=>{m!==g&&(r.lineTo(u,g),r.lineTo(u,m),r.lineTo(u,b))};for(l&&(f=s[_(0)],r.moveTo(f.x,f.y)),h=0;h<=o;++h){if(f=s[_(h)],f.skip)continue;const w=f.x,v=f.y,x=w|0;x===p?(v<m?m=v:v>g&&(g=v),u=(d*u+w)/++d):(y(),r.lineTo(w,v),p=x,d=0,m=g=v),b=v}y()}function mg(r){const e=r.options,t=e.borderDash&&e.borderDash.length;return!r._decimated&&!r._loop&&!e.tension&&e.cubicInterpolationMode!=="monotone"&&!e.stepped&&!t?oM:aM}function lM(r){return r.stepped?oC:r.tension||r.cubicInterpolationMode==="monotone"?lC:ei}function cM(r,e,t,n){let s=e._path;s||(s=e._path=new Path2D,e.path(s,t,n)&&s.closePath()),t1(r,e.options),r.stroke(s)}function uM(r,e,t,n){const{segments:s,options:i}=e,a=mg(e);for(const o of s)t1(r,i,o.style),r.beginPath(),a(r,e,o,{start:t,end:t+n-1})&&r.closePath(),r.stroke()}const dM=typeof Path2D=="function";function hM(r,e,t,n){dM&&!e.options.segment?cM(r,e,t,n):uM(r,e,t,n)}class ks extends ns{constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,t){const n=this.options;if((n.tension||n.cubicInterpolationMode==="monotone")&&!n.stepped&&!this._pointsUpdated){const s=n.spanGaps?this._loop:this._fullLoop;QI(this._points,n,e,s,t),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=pC(this,this.options.segment))}first(){const e=this.segments,t=this.points;return e.length&&t[e[0].start]}last(){const e=this.segments,t=this.points,n=e.length;return n&&t[e[n-1].end]}interpolate(e,t){const n=this.options,s=e[t],i=this.points,a=BS(this,{property:t,start:s,end:s});if(!a.length)return;const o=[],l=lM(n);let c,u;for(c=0,u=a.length;c<u;++c){const{start:d,end:h}=a[c],f=i[d],p=i[h];if(f===p){o.push(f);continue}const m=Math.abs((s-f[t])/(p[t]-f[t])),g=l(f,p,m,n.stepped);g[t]=e[t],o.push(g)}return o.length===1?o[0]:o}pathSegment(e,t,n){return mg(this)(e,this,t,n)}path(e,t,n){const s=this.segments,i=mg(this);let a=this._loop;t=t||0,n=n||this.points.length-t;for(const o of s)a&=i(e,this,o,{start:t,end:t+n-1});return!!a}draw(e,t,n,s){const i=this.options||{};(this.points||[]).length&&i.borderWidth&&(e.save(),hM(e,this,n,s),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}M(ks,"id","line"),M(ks,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),M(ks,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),M(ks,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"&&e!=="fill"});function Vw(r,e,t,n){const s=r.options,{[t]:i}=r.getProps([t],n);return Math.abs(e-i)<s.radius+s.hitRadius}class sd extends ns{constructor(t){super();M(this,"parsed");M(this,"skip");M(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,n,s){const i=this.options,{x:a,y:o}=this.getProps(["x","y"],s);return Math.pow(t-a,2)+Math.pow(n-o,2)<Math.pow(i.hitRadius+i.radius,2)}inXRange(t,n){return Vw(this,t,"x",n)}inYRange(t,n){return Vw(this,t,"y",n)}getCenterPoint(t){const{x:n,y:s}=this.getProps(["x","y"],t);return{x:n,y:s}}size(t){t=t||this.options||{};let n=t.radius||0;n=Math.max(n,n&&t.hoverRadius||0);const s=n&&t.borderWidth||0;return(n+s)*2}draw(t,n){const s=this.options;this.skip||s.radius<.1||!Yr(this,n,this.size(s)/2)||(t.strokeStyle=s.borderColor,t.lineWidth=s.borderWidth,t.fillStyle=s.backgroundColor,dg(t,s,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}M(sd,"id","point"),M(sd,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),M(sd,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function r1(r,e){const{x:t,y:n,base:s,width:i,height:a}=r.getProps(["x","y","base","width","height"],e);let o,l,c,u,d;return r.horizontal?(d=a/2,o=Math.min(t,s),l=Math.max(t,s),c=n-d,u=n+d):(d=i/2,o=t-d,l=t+d,c=Math.min(n,s),u=Math.max(n,s)),{left:o,top:c,right:l,bottom:u}}function Ss(r,e,t,n){return r?0:Nt(e,t,n)}function fM(r,e,t){const n=r.options.borderWidth,s=r.borderSkipped,i=RS(n);return{t:Ss(s.top,i.top,0,t),r:Ss(s.right,i.right,0,e),b:Ss(s.bottom,i.bottom,0,t),l:Ss(s.left,i.left,0,e)}}function pM(r,e,t){const{enableBorderRadius:n}=r.getProps(["enableBorderRadius"]),s=r.options.borderRadius,i=ci(s),a=Math.min(e,t),o=r.borderSkipped,l=n||je(s);return{topLeft:Ss(!l||o.top||o.left,i.topLeft,0,a),topRight:Ss(!l||o.top||o.right,i.topRight,0,a),bottomLeft:Ss(!l||o.bottom||o.left,i.bottomLeft,0,a),bottomRight:Ss(!l||o.bottom||o.right,i.bottomRight,0,a)}}function mM(r){const e=r1(r),t=e.right-e.left,n=e.bottom-e.top,s=fM(r,t/2,n/2),i=pM(r,t/2,n/2);return{outer:{x:e.left,y:e.top,w:t,h:n,radius:i},inner:{x:e.left+s.l,y:e.top+s.t,w:t-s.l-s.r,h:n-s.t-s.b,radius:{topLeft:Math.max(0,i.topLeft-Math.max(s.t,s.l)),topRight:Math.max(0,i.topRight-Math.max(s.t,s.r)),bottomLeft:Math.max(0,i.bottomLeft-Math.max(s.b,s.l)),bottomRight:Math.max(0,i.bottomRight-Math.max(s.b,s.r))}}}}function Zf(r,e,t,n){const s=e===null,i=t===null,o=r&&!(s&&i)&&r1(r,n);return o&&(s||Kr(e,o.left,o.right))&&(i||Kr(t,o.top,o.bottom))}function gM(r){return r.topLeft||r.topRight||r.bottomLeft||r.bottomRight}function bM(r,e){r.rect(e.x,e.y,e.w,e.h)}function Jf(r,e,t={}){const n=r.x!==t.x?-e:0,s=r.y!==t.y?-e:0,i=(r.x+r.w!==t.x+t.w?e:0)-n,a=(r.y+r.h!==t.y+t.h?e:0)-s;return{x:r.x+n,y:r.y+s,w:r.w+i,h:r.h+a,radius:r.radius}}class id extends ns{constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:t,options:{borderColor:n,backgroundColor:s}}=this,{inner:i,outer:a}=mM(this),o=gM(a.radius)?_l:bM;e.save(),(a.w!==i.w||a.h!==i.h)&&(e.beginPath(),o(e,Jf(a,t,i)),e.clip(),o(e,Jf(i,-t,a)),e.fillStyle=n,e.fill("evenodd")),e.beginPath(),o(e,Jf(i,t)),e.fillStyle=s,e.fill(),e.restore()}inRange(e,t,n){return Zf(this,e,t,n)}inXRange(e,t){return Zf(this,e,null,t)}inYRange(e,t){return Zf(this,null,e,t)}getCenterPoint(e){const{x:t,y:n,base:s,horizontal:i}=this.getProps(["x","y","base","horizontal"],e);return{x:i?(t+s)/2:t,y:i?n:(n+s)/2}}getRange(e){return e==="x"?this.width/2:this.height/2}}M(id,"id","bar"),M(id,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),M(id,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var _M=Object.freeze({__proto__:null,ArcElement:Mo,BarElement:id,LineElement:ks,PointElement:sd});const gg=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],Gw=gg.map(r=>r.replace("rgb(","rgba(").replace(")",", 0.5)"));function s1(r){return gg[r%gg.length]}function i1(r){return Gw[r%Gw.length]}function yM(r,e){return r.borderColor=s1(e),r.backgroundColor=i1(e),++e}function wM(r,e){return r.backgroundColor=r.data.map(()=>s1(e++)),e}function vM(r,e){return r.backgroundColor=r.data.map(()=>i1(e++)),e}function xM(r){let e=0;return(t,n)=>{const s=r.getDatasetMeta(n).controller;s instanceof ri?e=wM(t,e):s instanceof el?e=vM(t,e):s&&(e=yM(t,e))}}function Zw(r){let e;for(e in r)if(r[e].borderColor||r[e].backgroundColor)return!0;return!1}function kM(r){return r&&(r.borderColor||r.backgroundColor)}function SM(){return ut.borderColor!=="rgba(0,0,0,0.1)"||ut.backgroundColor!=="rgba(0,0,0,0.1)"}var PM={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(r,e,t){if(!t.enabled)return;const{data:{datasets:n},options:s}=r.config,{elements:i}=s,a=Zw(n)||kM(s)||i&&Zw(i)||SM();if(!t.forceOverride&&a)return;const o=xM(r);n.forEach(o)}};function AM(r,e,t,n,s){const i=s.samples||n;if(i>=t)return r.slice(e,e+t);const a=[],o=(t-2)/(i-2);let l=0;const c=e+t-1;let u=e,d,h,f,p,m;for(a[l++]=r[u],d=0;d<i-2;d++){let g=0,b=0,_;const y=Math.floor((d+1)*o)+1+e,w=Math.min(Math.floor((d+2)*o)+1,t)+e,v=w-y;for(_=y;_<w;_++)g+=r[_].x,b+=r[_].y;g/=v,b/=v;const x=Math.floor(d*o)+1+e,S=Math.min(Math.floor((d+1)*o)+1,t)+e,{x:k,y:R}=r[u];for(f=p=-1,_=x;_<S;_++)p=.5*Math.abs((k-g)*(r[_].y-R)-(k-r[_].x)*(b-R)),p>f&&(f=p,h=r[_],m=_);a[l++]=h,u=m}return a[l++]=r[c],a}function EM(r,e,t,n){let s=0,i=0,a,o,l,c,u,d,h,f,p,m;const g=[],b=e+t-1,_=r[e].x,w=r[b].x-_;for(a=e;a<e+t;++a){o=r[a],l=(o.x-_)/w*n,c=o.y;const v=l|0;if(v===u)c<p?(p=c,d=a):c>m&&(m=c,h=a),s=(i*s+o.x)/++i;else{const x=a-1;if(!Ne(d)&&!Ne(h)){const S=Math.min(d,h),k=Math.max(d,h);S!==f&&S!==x&&g.push({...r[S],x:s}),k!==f&&k!==x&&g.push({...r[k],x:s})}a>0&&x!==f&&g.push(r[x]),g.push(o),u=v,i=0,p=m=c,d=h=f=a}}return g}function a1(r){if(r._decimated){const e=r._data;delete r._decimated,delete r._data,Object.defineProperty(r,"data",{configurable:!0,enumerable:!0,writable:!0,value:e})}}function Jw(r){r.data.datasets.forEach(e=>{a1(e)})}function OM(r,e){const t=e.length;let n=0,s;const{iScale:i}=r,{min:a,max:o,minDefined:l,maxDefined:c}=i.getUserBounds();return l&&(n=Nt(Xr(e,i.axis,a).lo,0,t-1)),c?s=Nt(Xr(e,i.axis,o).hi+1,n,t)-n:s=t-n,{start:n,count:s}}var TM={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(r,e,t)=>{if(!t.enabled){Jw(r);return}const n=r.width;r.data.datasets.forEach((s,i)=>{const{_data:a,indexAxis:o}=s,l=r.getDatasetMeta(i),c=a||s.data;if(Co([o,r.options.indexAxis])==="y"||!l.controller.supportsDecimation)return;const u=r.scales[l.xAxisID];if(u.type!=="linear"&&u.type!=="time"||r.options.parsing)return;let{start:d,count:h}=OM(l,c);const f=t.threshold||4*n;if(h<=f){a1(s);return}Ne(a)&&(s._data=c,delete s.data,Object.defineProperty(s,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(m){this._data=m}}));let p;switch(t.algorithm){case"lttb":p=AM(c,d,h,n,t);break;case"min-max":p=EM(c,d,h,n);break;default:throw new Error(`Unsupported decimation algorithm '${t.algorithm}'`)}s._decimated=p})},destroy(r){Jw(r)}};function RM(r,e,t){const n=r.segments,s=r.points,i=e.points,a=[];for(const o of n){let{start:l,end:c}=o;c=Hb(l,c,s);const u=bg(t,s[l],s[c],o.loop);if(!e.segments){a.push({source:o,target:u,start:s[l],end:s[c]});continue}const d=BS(e,u);for(const h of d){const f=bg(t,i[h.start],i[h.end],h.loop),p=zS(o,s,f);for(const m of p)a.push({source:m,target:h,start:{[t]:Kw(u,f,"start",Math.max)},end:{[t]:Kw(u,f,"end",Math.min)}})}}return a}function bg(r,e,t,n){if(n)return;let s=e[r],i=t[r];return r==="angle"&&(s=On(s),i=On(i)),{property:r,start:s,end:i}}function IM(r,e){const{x:t=null,y:n=null}=r||{},s=e.points,i=[];return e.segments.forEach(({start:a,end:o})=>{o=Hb(a,o,s);const l=s[a],c=s[o];n!==null?(i.push({x:l.x,y:n}),i.push({x:c.x,y:n})):t!==null&&(i.push({x:t,y:l.y}),i.push({x:t,y:c.y}))}),i}function Hb(r,e,t){for(;e>r;e--){const n=t[e];if(!isNaN(n.x)&&!isNaN(n.y))break}return e}function Kw(r,e,t,n){return r&&e?n(r[t],e[t]):r?r[t]:e?e[t]:0}function o1(r,e){let t=[],n=!1;return ct(r)?(n=!0,t=r):t=IM(r,e),t.length?new ks({points:t,options:{tension:0},_loop:n,_fullLoop:n}):null}function Xw(r){return r&&r.fill!==!1}function CM(r,e,t){let s=r[e].fill;const i=[e];let a;if(!t)return s;for(;s!==!1&&i.indexOf(s)===-1;){if(!gt(s))return s;if(a=r[s],!a)return!1;if(a.visible)return s;i.push(s),s=a.fill}return!1}function $M(r,e,t){const n=jM(r);if(je(n))return isNaN(n.value)?!1:n;let s=parseFloat(n);return gt(s)&&Math.floor(s)===s?MM(n[0],e,s,t):["origin","start","end","stack","shape"].indexOf(n)>=0&&n}function MM(r,e,t,n){return(r==="-"||r==="+")&&(t=e+t),t===e||t<0||t>=n?!1:t}function NM(r,e){let t=null;return r==="start"?t=e.bottom:r==="end"?t=e.top:je(r)?t=e.getPixelForValue(r.value):e.getBasePixel&&(t=e.getBasePixel()),t}function LM(r,e,t){let n;return r==="start"?n=t:r==="end"?n=e.options.reverse?e.min:e.max:je(r)?n=r.value:n=e.getBaseValue(),n}function jM(r){const e=r.options,t=e.fill;let n=Se(t&&t.target,t);return n===void 0&&(n=!!e.backgroundColor),n===!1||n===null?!1:n===!0?"origin":n}function DM(r){const{scale:e,index:t,line:n}=r,s=[],i=n.segments,a=n.points,o=FM(e,t);o.push(o1({x:null,y:e.bottom},n));for(let l=0;l<i.length;l++){const c=i[l];for(let u=c.start;u<=c.end;u++)zM(s,a[u],o)}return new ks({points:s,options:{}})}function FM(r,e){const t=[],n=r.getMatchingVisibleMetas("line");for(let s=0;s<n.length;s++){const i=n[s];if(i.index===e)break;i.hidden||t.unshift(i.dataset)}return t}function zM(r,e,t){const n=[];for(let s=0;s<t.length;s++){const i=t[s],{first:a,last:o,point:l}=BM(i,e,"x");if(!(!l||a&&o)){if(a)n.unshift(l);else if(r.push(l),!o)break}}r.push(...n)}function BM(r,e,t){const n=r.interpolate(e,t);if(!n)return{};const s=n[t],i=r.segments,a=r.points;let o=!1,l=!1;for(let c=0;c<i.length;c++){const u=i[c],d=a[u.start][t],h=a[u.end][t];if(Kr(s,d,h)){o=s===d,l=s===h;break}}return{first:o,last:l,point:n}}class l1{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,t,n){const{x:s,y:i,radius:a}=this;return t=t||{start:0,end:st},e.arc(s,i,a,t.end,t.start,!0),!n.bounds}interpolate(e){const{x:t,y:n,radius:s}=this,i=e.angle;return{x:t+Math.cos(i)*s,y:n+Math.sin(i)*s,angle:i}}}function UM(r){const{chart:e,fill:t,line:n}=r;if(gt(t))return qM(e,t);if(t==="stack")return DM(r);if(t==="shape")return!0;const s=HM(r);return s instanceof l1?s:o1(s,n)}function qM(r,e){const t=r.getDatasetMeta(e);return t&&r.isDatasetVisible(e)?t.dataset:null}function HM(r){return(r.scale||{}).getPointPositionForValue?VM(r):WM(r)}function WM(r){const{scale:e={},fill:t}=r,n=NM(t,e);if(gt(n)){const s=e.isHorizontal();return{x:s?n:null,y:s?null:n}}return null}function VM(r){const{scale:e,fill:t}=r,n=e.options,s=e.getLabels().length,i=n.reverse?e.max:e.min,a=LM(t,e,i),o=[];if(n.grid.circular){const l=e.getPointPositionForValue(0,i);return new l1({x:l.x,y:l.y,radius:e.getDistanceFromCenterForValue(a)})}for(let l=0;l<s;++l)o.push(e.getPointPositionForValue(l,a));return o}function Kf(r,e,t){const n=UM(e),{chart:s,index:i,line:a,scale:o,axis:l}=e,c=a.options,u=c.fill,d=c.backgroundColor,{above:h=d,below:f=d}=u||{},p=s.getDatasetMeta(i),m=US(s,p);n&&a.points.length&&(Eh(r,t),GM(r,{line:a,target:n,above:h,below:f,area:t,scale:o,axis:l,clip:m}),Oh(r))}function GM(r,e){const{line:t,target:n,above:s,below:i,area:a,scale:o,clip:l}=e,c=t._loop?"angle":e.axis;r.save(),c==="x"&&i!==s&&(Yw(r,n,a.top),Qw(r,{line:t,target:n,color:s,scale:o,property:c,clip:l}),r.restore(),r.save(),Yw(r,n,a.bottom)),Qw(r,{line:t,target:n,color:i,scale:o,property:c,clip:l}),r.restore()}function Yw(r,e,t){const{segments:n,points:s}=e;let i=!0,a=!1;r.beginPath();for(const o of n){const{start:l,end:c}=o,u=s[l],d=s[Hb(l,c,s)];i?(r.moveTo(u.x,u.y),i=!1):(r.lineTo(u.x,t),r.lineTo(u.x,u.y)),a=!!e.pathSegment(r,o,{move:a}),a?r.closePath():r.lineTo(d.x,t)}r.lineTo(e.first().x,t),r.closePath(),r.clip()}function Qw(r,e){const{line:t,target:n,property:s,color:i,scale:a,clip:o}=e,l=RM(t,n,s);for(const{source:c,target:u,start:d,end:h}of l){const{style:{backgroundColor:f=i}={}}=c,p=n!==!0;r.save(),r.fillStyle=f,ZM(r,a,o,p&&bg(s,d,h)),r.beginPath();const m=!!t.pathSegment(r,c);let g;if(p){m?r.closePath():ev(r,n,h,s);const b=!!n.pathSegment(r,u,{move:m,reverse:!0});g=m&&b,g||ev(r,n,d,s)}r.closePath(),r.fill(g?"evenodd":"nonzero"),r.restore()}}function ZM(r,e,t,n){const s=e.chart.chartArea,{property:i,start:a,end:o}=n||{};if(i==="x"||i==="y"){let l,c,u,d;i==="x"?(l=a,c=s.top,u=o,d=s.bottom):(l=s.left,c=a,u=s.right,d=o),r.beginPath(),t&&(l=Math.max(l,t.left),u=Math.min(u,t.right),c=Math.max(c,t.top),d=Math.min(d,t.bottom)),r.rect(l,c,u-l,d-c),r.clip()}}function ev(r,e,t,n){const s=e.interpolate(t,n);s&&r.lineTo(s.x,s.y)}var JM={id:"filler",afterDatasetsUpdate(r,e,t){const n=(r.data.datasets||[]).length,s=[];let i,a,o,l;for(a=0;a<n;++a)i=r.getDatasetMeta(a),o=i.dataset,l=null,o&&o.options&&o instanceof ks&&(l={visible:r.isDatasetVisible(a),index:a,fill:$M(o,a,n),chart:r,axis:i.controller.options.indexAxis,scale:i.vScale,line:o}),i.$filler=l,s.push(l);for(a=0;a<n;++a)l=s[a],!(!l||l.fill===!1)&&(l.fill=CM(s,a,t.propagate))},beforeDraw(r,e,t){const n=t.drawTime==="beforeDraw",s=r.getSortedVisibleDatasetMetas(),i=r.chartArea;for(let a=s.length-1;a>=0;--a){const o=s[a].$filler;o&&(o.line.updateControlPoints(i,o.axis),n&&o.fill&&Kf(r.ctx,o,i))}},beforeDatasetsDraw(r,e,t){if(t.drawTime!=="beforeDatasetsDraw")return;const n=r.getSortedVisibleDatasetMetas();for(let s=n.length-1;s>=0;--s){const i=n[s].$filler;Xw(i)&&Kf(r.ctx,i,r.chartArea)}},beforeDatasetDraw(r,e,t){const n=e.meta.$filler;!Xw(n)||t.drawTime!=="beforeDatasetDraw"||Kf(r.ctx,n,r.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const tv=(r,e)=>{let{boxHeight:t=e,boxWidth:n=e}=r;return r.usePointStyle&&(t=Math.min(t,e),n=r.pointStyleWidth||Math.min(n,e)),{boxWidth:n,boxHeight:t,itemHeight:Math.max(e,t)}},KM=(r,e)=>r!==null&&e!==null&&r.datasetIndex===e.datasetIndex&&r.index===e.index;class nv extends ns{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,n){this.maxWidth=e,this.maxHeight=t,this._margins=n,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let t=nt(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter(n=>e.filter(n,this.chart.data))),e.sort&&(t=t.sort((n,s)=>e.sort(n,s,this.chart.data))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){const{options:e,ctx:t}=this;if(!e.display){this.width=this.height=0;return}const n=e.labels,s=Ot(n.font),i=s.size,a=this._computeTitleHeight(),{boxWidth:o,itemHeight:l}=tv(n,i);let c,u;t.font=s.string,this.isHorizontal()?(c=this.maxWidth,u=this._fitRows(a,i,o,l)+10):(u=this.maxHeight,c=this._fitCols(a,s,o,l)+10),this.width=Math.min(c,e.maxWidth||this.maxWidth),this.height=Math.min(u,e.maxHeight||this.maxHeight)}_fitRows(e,t,n,s){const{ctx:i,maxWidth:a,options:{labels:{padding:o}}}=this,l=this.legendHitBoxes=[],c=this.lineWidths=[0],u=s+o;let d=e;i.textAlign="left",i.textBaseline="middle";let h=-1,f=-u;return this.legendItems.forEach((p,m)=>{const g=n+t/2+i.measureText(p.text).width;(m===0||c[c.length-1]+g+2*o>a)&&(d+=u,c[c.length-(m>0?0:1)]=0,f+=u,h++),l[m]={left:0,top:f,row:h,width:g,height:s},c[c.length-1]+=g+o}),d}_fitCols(e,t,n,s){const{ctx:i,maxHeight:a,options:{labels:{padding:o}}}=this,l=this.legendHitBoxes=[],c=this.columnSizes=[],u=a-e;let d=o,h=0,f=0,p=0,m=0;return this.legendItems.forEach((g,b)=>{const{itemWidth:_,itemHeight:y}=XM(n,t,i,g,s);b>0&&f+y+2*o>u&&(d+=h+o,c.push({width:h,height:f}),p+=h+o,m++,h=f=0),l[b]={left:p,top:f,col:m,width:_,height:y},h=Math.max(h,_),f+=y+o}),d+=h,c.push({width:h,height:f}),d}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:n,labels:{padding:s},rtl:i}}=this,a=ca(i,this.left,this.width);if(this.isHorizontal()){let o=0,l=Zt(n,this.left+s,this.right-this.lineWidths[o]);for(const c of t)o!==c.row&&(o=c.row,l=Zt(n,this.left+s,this.right-this.lineWidths[o])),c.top+=this.top+e+s,c.left=a.leftForLtr(a.x(l),c.width),l+=c.width+s}else{let o=0,l=Zt(n,this.top+e+s,this.bottom-this.columnSizes[o].height);for(const c of t)c.col!==o&&(o=c.col,l=Zt(n,this.top+e+s,this.bottom-this.columnSizes[o].height)),c.top=l,c.left+=this.left+s,c.left=a.leftForLtr(a.x(c.left),c.width),l+=c.height+s}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const e=this.ctx;Eh(e,this),this._draw(),Oh(e)}}_draw(){const{options:e,columnSizes:t,lineWidths:n,ctx:s}=this,{align:i,labels:a}=e,o=ut.color,l=ca(e.rtl,this.left,this.width),c=Ot(a.font),{padding:u}=a,d=c.size,h=d/2;let f;this.drawTitle(),s.textAlign=l.textAlign("left"),s.textBaseline="middle",s.lineWidth=.5,s.font=c.string;const{boxWidth:p,boxHeight:m,itemHeight:g}=tv(a,d),b=function(x,S,k){if(isNaN(p)||p<=0||isNaN(m)||m<0)return;s.save();const R=Se(k.lineWidth,1);if(s.fillStyle=Se(k.fillStyle,o),s.lineCap=Se(k.lineCap,"butt"),s.lineDashOffset=Se(k.lineDashOffset,0),s.lineJoin=Se(k.lineJoin,"miter"),s.lineWidth=R,s.strokeStyle=Se(k.strokeStyle,o),s.setLineDash(Se(k.lineDash,[])),a.usePointStyle){const D={radius:m*Math.SQRT2/2,pointStyle:k.pointStyle,rotation:k.rotation,borderWidth:R},C=l.xPlus(x,p/2),N=S+h;TS(s,D,C,N,a.pointStyleWidth&&p)}else{const D=S+Math.max((d-m)/2,0),C=l.leftForLtr(x,p),N=ci(k.borderRadius);s.beginPath(),Object.values(N).some($=>$!==0)?_l(s,{x:C,y:D,w:p,h:m,radius:N}):s.rect(C,D,p,m),s.fill(),R!==0&&s.stroke()}s.restore()},_=function(x,S,k){gi(s,k.text,x,S+g/2,c,{strikethrough:k.hidden,textAlign:l.textAlign(k.textAlign)})},y=this.isHorizontal(),w=this._computeTitleHeight();y?f={x:Zt(i,this.left+u,this.right-n[0]),y:this.top+u+w,line:0}:f={x:this.left+u,y:Zt(i,this.top+w+u,this.bottom-t[0].height),line:0},jS(this.ctx,e.textDirection);const v=g+u;this.legendItems.forEach((x,S)=>{s.strokeStyle=x.fontColor,s.fillStyle=x.fontColor;const k=s.measureText(x.text).width,R=l.textAlign(x.textAlign||(x.textAlign=a.textAlign)),D=p+h+k;let C=f.x,N=f.y;l.setWidth(this.width),y?S>0&&C+D+u>this.right&&(N=f.y+=v,f.line++,C=f.x=Zt(i,this.left+u,this.right-n[f.line])):S>0&&N+v>this.bottom&&(C=f.x=C+t[f.line].width+u,f.line++,N=f.y=Zt(i,this.top+w+u,this.bottom-t[f.line].height));const $=l.x(C);if(b($,N,x),C=bI(R,C+p+h,y?C+D:this.right,e.rtl),_(l.x(C),N,x),y)f.x+=D+u;else if(typeof x.text!="string"){const P=c.lineHeight;f.y+=c1(x,P)+u}else f.y+=v}),DS(this.ctx,e.textDirection)}drawTitle(){const e=this.options,t=e.title,n=Ot(t.font),s=Xt(t.padding);if(!t.display)return;const i=ca(e.rtl,this.left,this.width),a=this.ctx,o=t.position,l=n.size/2,c=s.top+l;let u,d=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),u=this.top+c,d=Zt(e.align,d,this.right-h);else{const p=this.columnSizes.reduce((m,g)=>Math.max(m,g.height),0);u=c+Zt(e.align,this.top,this.bottom-p-e.labels.padding-this._computeTitleHeight())}const f=Zt(o,d,d+h);a.textAlign=i.textAlign(Nb(o)),a.textBaseline="middle",a.strokeStyle=t.color,a.fillStyle=t.color,a.font=n.string,gi(a,t.text,f,u,n)}_computeTitleHeight(){const e=this.options.title,t=Ot(e.font),n=Xt(e.padding);return e.display?t.lineHeight+n.height:0}_getLegendItemAt(e,t){let n,s,i;if(Kr(e,this.left,this.right)&&Kr(t,this.top,this.bottom)){for(i=this.legendHitBoxes,n=0;n<i.length;++n)if(s=i[n],Kr(e,s.left,s.left+s.width)&&Kr(t,s.top,s.top+s.height))return this.legendItems[n]}return null}handleEvent(e){const t=this.options;if(!eN(e.type,t))return;const n=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){const s=this._hoveredItem,i=KM(s,n);s&&!i&&nt(t.onLeave,[e,s,this],this),this._hoveredItem=n,n&&!i&&nt(t.onHover,[e,n,this],this)}else n&&nt(t.onClick,[e,n,this],this)}}function XM(r,e,t,n,s){const i=YM(n,r,e,t),a=QM(s,n,e.lineHeight);return{itemWidth:i,itemHeight:a}}function YM(r,e,t,n){let s=r.text;return s&&typeof s!="string"&&(s=s.reduce((i,a)=>i.length>a.length?i:a)),e+t.size/2+n.measureText(s).width}function QM(r,e,t){let n=r;return typeof e.text!="string"&&(n=c1(e,t)),n}function c1(r,e){const t=r.text?r.text.length:0;return e*t}function eN(r,e){return!!((r==="mousemove"||r==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(r==="click"||r==="mouseup"))}var tN={id:"legend",_element:nv,start(r,e,t){const n=r.legend=new nv({ctx:r.ctx,options:t,chart:r});Kt.configure(r,n,t),Kt.addBox(r,n)},stop(r){Kt.removeBox(r,r.legend),delete r.legend},beforeUpdate(r,e,t){const n=r.legend;Kt.configure(r,n,t),n.options=t},afterUpdate(r){const e=r.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(r,e){e.replay||r.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(r,e,t){const n=e.datasetIndex,s=t.chart;s.isDatasetVisible(n)?(s.hide(n),e.hidden=!0):(s.show(n),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:r=>r.chart.options.color,boxWidth:40,padding:10,generateLabels(r){const e=r.data.datasets,{labels:{usePointStyle:t,pointStyle:n,textAlign:s,color:i,useBorderRadius:a,borderRadius:o}}=r.legend.options;return r._getSortedDatasetMetas().map(l=>{const c=l.controller.getStyle(t?0:void 0),u=Xt(c.borderWidth);return{text:e[l.index].label,fillStyle:c.backgroundColor,fontColor:i,hidden:!l.visible,lineCap:c.borderCapStyle,lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:(u.width+u.height)/4,strokeStyle:c.borderColor,pointStyle:n||c.pointStyle,rotation:c.rotation,textAlign:s||c.textAlign,borderRadius:a&&(o||c.borderRadius),datasetIndex:l.index}},this)}},title:{color:r=>r.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:r=>!r.startsWith("on"),labels:{_scriptable:r=>!["generateLabels","filter","sort"].includes(r)}}};class Wb extends ns{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t){const n=this.options;if(this.left=0,this.top=0,!n.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=e,this.height=this.bottom=t;const s=ct(n.text)?n.text.length:1;this._padding=Xt(n.padding);const i=s*Ot(n.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=i:this.width=i}isHorizontal(){const e=this.options.position;return e==="top"||e==="bottom"}_drawArgs(e){const{top:t,left:n,bottom:s,right:i,options:a}=this,o=a.align;let l=0,c,u,d;return this.isHorizontal()?(u=Zt(o,n,i),d=t+e,c=i-n):(a.position==="left"?(u=n+e,d=Zt(o,s,t),l=it*-.5):(u=i-e,d=Zt(o,t,s),l=it*.5),c=s-t),{titleX:u,titleY:d,maxWidth:c,rotation:l}}draw(){const e=this.ctx,t=this.options;if(!t.display)return;const n=Ot(t.font),i=n.lineHeight/2+this._padding.top,{titleX:a,titleY:o,maxWidth:l,rotation:c}=this._drawArgs(i);gi(e,t.text,0,0,n,{color:t.color,maxWidth:l,rotation:c,textAlign:Nb(t.align),textBaseline:"middle",translation:[a,o]})}}function nN(r,e){const t=new Wb({ctx:r.ctx,options:e,chart:r});Kt.configure(r,t,e),Kt.addBox(r,t),r.titleBlock=t}var rN={id:"title",_element:Wb,start(r,e,t){nN(r,t)},stop(r){const e=r.titleBlock;Kt.removeBox(r,e),delete r.titleBlock},beforeUpdate(r,e,t){const n=r.titleBlock;Kt.configure(r,n,t),n.options=t},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const su=new WeakMap;var sN={id:"subtitle",start(r,e,t){const n=new Wb({ctx:r.ctx,options:t,chart:r});Kt.configure(r,n,t),Kt.addBox(r,n),su.set(r,n)},stop(r){Kt.removeBox(r,su.get(r)),su.delete(r)},beforeUpdate(r,e,t){const n=su.get(r);Kt.configure(r,n,t),n.options=t},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const No={average(r){if(!r.length)return!1;let e,t,n=new Set,s=0,i=0;for(e=0,t=r.length;e<t;++e){const o=r[e].element;if(o&&o.hasValue()){const l=o.tooltipPosition();n.add(l.x),s+=l.y,++i}}return i===0||n.size===0?!1:{x:[...n].reduce((o,l)=>o+l)/n.size,y:s/i}},nearest(r,e){if(!r.length)return!1;let t=e.x,n=e.y,s=Number.POSITIVE_INFINITY,i,a,o;for(i=0,a=r.length;i<a;++i){const l=r[i].element;if(l&&l.hasValue()){const c=l.getCenterPoint(),u=cg(e,c);u<s&&(s=u,o=l)}}if(o){const l=o.tooltipPosition();t=l.x,n=l.y}return{x:t,y:n}}};function mr(r,e){return e&&(ct(e)?Array.prototype.push.apply(r,e):r.push(e)),r}function Fr(r){return(typeof r=="string"||r instanceof String)&&r.indexOf(`
`)>-1?r.split(`
`):r}function iN(r,e){const{element:t,datasetIndex:n,index:s}=e,i=r.getDatasetMeta(n).controller,{label:a,value:o}=i.getLabelAndValue(s);return{chart:r,label:a,parsed:i.getParsed(s),raw:r.data.datasets[n].data[s],formattedValue:o,dataset:i.getDataset(),dataIndex:s,datasetIndex:n,element:t}}function rv(r,e){const t=r.chart.ctx,{body:n,footer:s,title:i}=r,{boxWidth:a,boxHeight:o}=e,l=Ot(e.bodyFont),c=Ot(e.titleFont),u=Ot(e.footerFont),d=i.length,h=s.length,f=n.length,p=Xt(e.padding);let m=p.height,g=0,b=n.reduce((w,v)=>w+v.before.length+v.lines.length+v.after.length,0);if(b+=r.beforeBody.length+r.afterBody.length,d&&(m+=d*c.lineHeight+(d-1)*e.titleSpacing+e.titleMarginBottom),b){const w=e.displayColors?Math.max(o,l.lineHeight):l.lineHeight;m+=f*w+(b-f)*l.lineHeight+(b-1)*e.bodySpacing}h&&(m+=e.footerMarginTop+h*u.lineHeight+(h-1)*e.footerSpacing);let _=0;const y=function(w){g=Math.max(g,t.measureText(w).width+_)};return t.save(),t.font=c.string,Je(r.title,y),t.font=l.string,Je(r.beforeBody.concat(r.afterBody),y),_=e.displayColors?a+2+e.boxPadding:0,Je(n,w=>{Je(w.before,y),Je(w.lines,y),Je(w.after,y)}),_=0,t.font=u.string,Je(r.footer,y),t.restore(),g+=p.width,{width:g,height:m}}function aN(r,e){const{y:t,height:n}=e;return t<n/2?"top":t>r.height-n/2?"bottom":"center"}function oN(r,e,t,n){const{x:s,width:i}=n,a=t.caretSize+t.caretPadding;if(r==="left"&&s+i+a>e.width||r==="right"&&s-i-a<0)return!0}function lN(r,e,t,n){const{x:s,width:i}=t,{width:a,chartArea:{left:o,right:l}}=r;let c="center";return n==="center"?c=s<=(o+l)/2?"left":"right":s<=i/2?c="left":s>=a-i/2&&(c="right"),oN(c,r,e,t)&&(c="center"),c}function sv(r,e,t){const n=t.yAlign||e.yAlign||aN(r,t);return{xAlign:t.xAlign||e.xAlign||lN(r,e,t,n),yAlign:n}}function cN(r,e){let{x:t,width:n}=r;return e==="right"?t-=n:e==="center"&&(t-=n/2),t}function uN(r,e,t){let{y:n,height:s}=r;return e==="top"?n+=t:e==="bottom"?n-=s+t:n-=s/2,n}function iv(r,e,t,n){const{caretSize:s,caretPadding:i,cornerRadius:a}=r,{xAlign:o,yAlign:l}=t,c=s+i,{topLeft:u,topRight:d,bottomLeft:h,bottomRight:f}=ci(a);let p=cN(e,o);const m=uN(e,l,c);return l==="center"?o==="left"?p+=c:o==="right"&&(p-=c):o==="left"?p-=Math.max(u,h)+s:o==="right"&&(p+=Math.max(d,f)+s),{x:Nt(p,0,n.width-e.width),y:Nt(m,0,n.height-e.height)}}function iu(r,e,t){const n=Xt(t.padding);return e==="center"?r.x+r.width/2:e==="right"?r.x+r.width-n.right:r.x+n.left}function av(r){return mr([],Fr(r))}function dN(r,e,t){return Fs(r,{tooltip:e,tooltipItems:t,type:"tooltip"})}function ov(r,e){const t=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return t?r.override(t):r}const u1={beforeTitle:$r,title(r){if(r.length>0){const e=r[0],t=e.chart.data.labels,n=t?t.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(n>0&&e.dataIndex<n)return t[e.dataIndex]}return""},afterTitle:$r,beforeBody:$r,beforeLabel:$r,label(r){if(this&&this.options&&this.options.mode==="dataset")return r.label+": "+r.formattedValue||r.formattedValue;let e=r.dataset.label||"";e&&(e+=": ");const t=r.formattedValue;return Ne(t)||(e+=t),e},labelColor(r){const t=r.chart.getDatasetMeta(r.datasetIndex).controller.getStyle(r.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(r){const t=r.chart.getDatasetMeta(r.datasetIndex).controller.getStyle(r.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:$r,afterBody:$r,beforeFooter:$r,footer:$r,afterFooter:$r};function hn(r,e,t,n){const s=r[e].call(t,n);return typeof s>"u"?u1[e].call(t,n):s}class _g extends ns{constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const t=this.chart,n=this.options.setContext(this.getContext()),s=n.enabled&&t.options.animation&&n.animations,i=new qS(this.chart,s);return s._cacheable&&(this._cachedAnimations=Object.freeze(i)),i}getContext(){return this.$context||(this.$context=dN(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,t){const{callbacks:n}=t,s=hn(n,"beforeTitle",this,e),i=hn(n,"title",this,e),a=hn(n,"afterTitle",this,e);let o=[];return o=mr(o,Fr(s)),o=mr(o,Fr(i)),o=mr(o,Fr(a)),o}getBeforeBody(e,t){return av(hn(t.callbacks,"beforeBody",this,e))}getBody(e,t){const{callbacks:n}=t,s=[];return Je(e,i=>{const a={before:[],lines:[],after:[]},o=ov(n,i);mr(a.before,Fr(hn(o,"beforeLabel",this,i))),mr(a.lines,hn(o,"label",this,i)),mr(a.after,Fr(hn(o,"afterLabel",this,i))),s.push(a)}),s}getAfterBody(e,t){return av(hn(t.callbacks,"afterBody",this,e))}getFooter(e,t){const{callbacks:n}=t,s=hn(n,"beforeFooter",this,e),i=hn(n,"footer",this,e),a=hn(n,"afterFooter",this,e);let o=[];return o=mr(o,Fr(s)),o=mr(o,Fr(i)),o=mr(o,Fr(a)),o}_createItems(e){const t=this._active,n=this.chart.data,s=[],i=[],a=[];let o=[],l,c;for(l=0,c=t.length;l<c;++l)o.push(iN(this.chart,t[l]));return e.filter&&(o=o.filter((u,d,h)=>e.filter(u,d,h,n))),e.itemSort&&(o=o.sort((u,d)=>e.itemSort(u,d,n))),Je(o,u=>{const d=ov(e.callbacks,u);s.push(hn(d,"labelColor",this,u)),i.push(hn(d,"labelPointStyle",this,u)),a.push(hn(d,"labelTextColor",this,u))}),this.labelColors=s,this.labelPointStyles=i,this.labelTextColors=a,this.dataPoints=o,o}update(e,t){const n=this.options.setContext(this.getContext()),s=this._active;let i,a=[];if(!s.length)this.opacity!==0&&(i={opacity:0});else{const o=No[n.position].call(this,s,this._eventPosition);a=this._createItems(n),this.title=this.getTitle(a,n),this.beforeBody=this.getBeforeBody(a,n),this.body=this.getBody(a,n),this.afterBody=this.getAfterBody(a,n),this.footer=this.getFooter(a,n);const l=this._size=rv(this,n),c=Object.assign({},o,l),u=sv(this.chart,n,c),d=iv(n,c,u,this.chart);this.xAlign=u.xAlign,this.yAlign=u.yAlign,i={opacity:1,x:d.x,y:d.y,width:l.width,height:l.height,caretX:o.x,caretY:o.y}}this._tooltipItems=a,this.$context=void 0,i&&this._resolveAnimations().update(this,i),e&&n.external&&n.external.call(this,{chart:this.chart,tooltip:this,replay:t})}drawCaret(e,t,n,s){const i=this.getCaretPosition(e,n,s);t.lineTo(i.x1,i.y1),t.lineTo(i.x2,i.y2),t.lineTo(i.x3,i.y3)}getCaretPosition(e,t,n){const{xAlign:s,yAlign:i}=this,{caretSize:a,cornerRadius:o}=n,{topLeft:l,topRight:c,bottomLeft:u,bottomRight:d}=ci(o),{x:h,y:f}=e,{width:p,height:m}=t;let g,b,_,y,w,v;return i==="center"?(w=f+m/2,s==="left"?(g=h,b=g-a,y=w+a,v=w-a):(g=h+p,b=g+a,y=w-a,v=w+a),_=g):(s==="left"?b=h+Math.max(l,u)+a:s==="right"?b=h+p-Math.max(c,d)-a:b=this.caretX,i==="top"?(y=f,w=y-a,g=b-a,_=b+a):(y=f+m,w=y+a,g=b+a,_=b-a),v=y),{x1:g,x2:b,x3:_,y1:y,y2:w,y3:v}}drawTitle(e,t,n){const s=this.title,i=s.length;let a,o,l;if(i){const c=ca(n.rtl,this.x,this.width);for(e.x=iu(this,n.titleAlign,n),t.textAlign=c.textAlign(n.titleAlign),t.textBaseline="middle",a=Ot(n.titleFont),o=n.titleSpacing,t.fillStyle=n.titleColor,t.font=a.string,l=0;l<i;++l)t.fillText(s[l],c.x(e.x),e.y+a.lineHeight/2),e.y+=a.lineHeight+o,l+1===i&&(e.y+=n.titleMarginBottom-o)}}_drawColorBox(e,t,n,s,i){const a=this.labelColors[n],o=this.labelPointStyles[n],{boxHeight:l,boxWidth:c}=i,u=Ot(i.bodyFont),d=iu(this,"left",i),h=s.x(d),f=l<u.lineHeight?(u.lineHeight-l)/2:0,p=t.y+f;if(i.usePointStyle){const m={radius:Math.min(c,l)/2,pointStyle:o.pointStyle,rotation:o.rotation,borderWidth:1},g=s.leftForLtr(h,c)+c/2,b=p+l/2;e.strokeStyle=i.multiKeyBackground,e.fillStyle=i.multiKeyBackground,dg(e,m,g,b),e.strokeStyle=a.borderColor,e.fillStyle=a.backgroundColor,dg(e,m,g,b)}else{e.lineWidth=je(a.borderWidth)?Math.max(...Object.values(a.borderWidth)):a.borderWidth||1,e.strokeStyle=a.borderColor,e.setLineDash(a.borderDash||[]),e.lineDashOffset=a.borderDashOffset||0;const m=s.leftForLtr(h,c),g=s.leftForLtr(s.xPlus(h,1),c-2),b=ci(a.borderRadius);Object.values(b).some(_=>_!==0)?(e.beginPath(),e.fillStyle=i.multiKeyBackground,_l(e,{x:m,y:p,w:c,h:l,radius:b}),e.fill(),e.stroke(),e.fillStyle=a.backgroundColor,e.beginPath(),_l(e,{x:g,y:p+1,w:c-2,h:l-2,radius:b}),e.fill()):(e.fillStyle=i.multiKeyBackground,e.fillRect(m,p,c,l),e.strokeRect(m,p,c,l),e.fillStyle=a.backgroundColor,e.fillRect(g,p+1,c-2,l-2))}e.fillStyle=this.labelTextColors[n]}drawBody(e,t,n){const{body:s}=this,{bodySpacing:i,bodyAlign:a,displayColors:o,boxHeight:l,boxWidth:c,boxPadding:u}=n,d=Ot(n.bodyFont);let h=d.lineHeight,f=0;const p=ca(n.rtl,this.x,this.width),m=function(k){t.fillText(k,p.x(e.x+f),e.y+h/2),e.y+=h+i},g=p.textAlign(a);let b,_,y,w,v,x,S;for(t.textAlign=a,t.textBaseline="middle",t.font=d.string,e.x=iu(this,g,n),t.fillStyle=n.bodyColor,Je(this.beforeBody,m),f=o&&g!=="right"?a==="center"?c/2+u:c+2+u:0,w=0,x=s.length;w<x;++w){for(b=s[w],_=this.labelTextColors[w],t.fillStyle=_,Je(b.before,m),y=b.lines,o&&y.length&&(this._drawColorBox(t,e,w,p,n),h=Math.max(d.lineHeight,l)),v=0,S=y.length;v<S;++v)m(y[v]),h=d.lineHeight;Je(b.after,m)}f=0,h=d.lineHeight,Je(this.afterBody,m),e.y-=i}drawFooter(e,t,n){const s=this.footer,i=s.length;let a,o;if(i){const l=ca(n.rtl,this.x,this.width);for(e.x=iu(this,n.footerAlign,n),e.y+=n.footerMarginTop,t.textAlign=l.textAlign(n.footerAlign),t.textBaseline="middle",a=Ot(n.footerFont),t.fillStyle=n.footerColor,t.font=a.string,o=0;o<i;++o)t.fillText(s[o],l.x(e.x),e.y+a.lineHeight/2),e.y+=a.lineHeight+n.footerSpacing}}drawBackground(e,t,n,s){const{xAlign:i,yAlign:a}=this,{x:o,y:l}=e,{width:c,height:u}=n,{topLeft:d,topRight:h,bottomLeft:f,bottomRight:p}=ci(s.cornerRadius);t.fillStyle=s.backgroundColor,t.strokeStyle=s.borderColor,t.lineWidth=s.borderWidth,t.beginPath(),t.moveTo(o+d,l),a==="top"&&this.drawCaret(e,t,n,s),t.lineTo(o+c-h,l),t.quadraticCurveTo(o+c,l,o+c,l+h),a==="center"&&i==="right"&&this.drawCaret(e,t,n,s),t.lineTo(o+c,l+u-p),t.quadraticCurveTo(o+c,l+u,o+c-p,l+u),a==="bottom"&&this.drawCaret(e,t,n,s),t.lineTo(o+f,l+u),t.quadraticCurveTo(o,l+u,o,l+u-f),a==="center"&&i==="left"&&this.drawCaret(e,t,n,s),t.lineTo(o,l+d),t.quadraticCurveTo(o,l,o+d,l),t.closePath(),t.fill(),s.borderWidth>0&&t.stroke()}_updateAnimationTarget(e){const t=this.chart,n=this.$animations,s=n&&n.x,i=n&&n.y;if(s||i){const a=No[e.position].call(this,this._active,this._eventPosition);if(!a)return;const o=this._size=rv(this,e),l=Object.assign({},a,this._size),c=sv(t,e,l),u=iv(e,l,c,t);(s._to!==u.x||i._to!==u.y)&&(this.xAlign=c.xAlign,this.yAlign=c.yAlign,this.width=o.width,this.height=o.height,this.caretX=a.x,this.caretY=a.y,this._resolveAnimations().update(this,u))}}_willRender(){return!!this.opacity}draw(e){const t=this.options.setContext(this.getContext());let n=this.opacity;if(!n)return;this._updateAnimationTarget(t);const s={width:this.width,height:this.height},i={x:this.x,y:this.y};n=Math.abs(n)<.001?0:n;const a=Xt(t.padding),o=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;t.enabled&&o&&(e.save(),e.globalAlpha=n,this.drawBackground(i,e,s,t),jS(e,t.textDirection),i.y+=a.top,this.drawTitle(i,e,t),this.drawBody(i,e,t),this.drawFooter(i,e,t),DS(e,t.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,t){const n=this._active,s=e.map(({datasetIndex:o,index:l})=>{const c=this.chart.getDatasetMeta(o);if(!c)throw new Error("Cannot find a dataset at index "+o);return{datasetIndex:o,element:c.data[l],index:l}}),i=!_d(n,s),a=this._positionChanged(s,t);(i||a)&&(this._active=s,this._eventPosition=t,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,t,n=!0){if(t&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const s=this.options,i=this._active||[],a=this._getActiveElements(e,i,t,n),o=this._positionChanged(a,e),l=t||!_d(a,i)||o;return l&&(this._active=a,(s.enabled||s.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,t))),l}_getActiveElements(e,t,n,s){const i=this.options;if(e.type==="mouseout")return[];if(!s)return t.filter(o=>this.chart.data.datasets[o.datasetIndex]&&this.chart.getDatasetMeta(o.datasetIndex).controller.getParsed(o.index)!==void 0);const a=this.chart.getElementsAtEventForMode(e,i.mode,i,n);return i.reverse&&a.reverse(),a}_positionChanged(e,t){const{caretX:n,caretY:s,options:i}=this,a=No[i.position].call(this,e,t);return a!==!1&&(n!==a.x||s!==a.y)}}M(_g,"positioners",No);var hN={id:"tooltip",_element:_g,positioners:No,afterInit(r,e,t){t&&(r.tooltip=new _g({chart:r,options:t}))},beforeUpdate(r,e,t){r.tooltip&&r.tooltip.initialize(t)},reset(r,e,t){r.tooltip&&r.tooltip.initialize(t)},afterDraw(r){const e=r.tooltip;if(e&&e._willRender()){const t={tooltip:e};if(r.notifyPlugins("beforeTooltipDraw",{...t,cancelable:!0})===!1)return;e.draw(r.ctx),r.notifyPlugins("afterTooltipDraw",t)}},afterEvent(r,e){if(r.tooltip){const t=e.replay;r.tooltip.handleEvent(e.event,t,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(r,e)=>e.bodyFont.size,boxWidth:(r,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:u1},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:r=>r!=="filter"&&r!=="itemSort"&&r!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},fN=Object.freeze({__proto__:null,Colors:PM,Decimation:TM,Filler:JM,Legend:tN,SubTitle:sN,Title:rN,Tooltip:hN});const pN=(r,e,t,n)=>(typeof e=="string"?(t=r.push(e)-1,n.unshift({index:t,label:e})):isNaN(e)&&(t=null),t);function mN(r,e,t,n){const s=r.indexOf(e);if(s===-1)return pN(r,e,t,n);const i=r.lastIndexOf(e);return s!==i?t:s}const gN=(r,e)=>r===null?null:Nt(Math.round(r),0,e);function lv(r){const e=this.getLabels();return r>=0&&r<e.length?e[r]:r}class yg extends Ai{constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const t=this._addedLabels;if(t.length){const n=this.getLabels();for(const{index:s,label:i}of t)n[s]===i&&n.splice(s,1);this._addedLabels=[]}super.init(e)}parse(e,t){if(Ne(e))return null;const n=this.getLabels();return t=isFinite(t)&&n[t]===e?t:mN(n,e,Se(t,e),this._addedLabels),gN(t,n.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let{min:n,max:s}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(n=0),t||(s=this.getLabels().length-1)),this.min=n,this.max=s}buildTicks(){const e=this.min,t=this.max,n=this.options.offset,s=[];let i=this.getLabels();i=e===0&&t===i.length-1?i:i.slice(e,t+1),this._valueRange=Math.max(i.length-(n?0:1),1),this._startValue=this.min-(n?.5:0);for(let a=e;a<=t;a++)s.push({value:a});return s}getLabelForValue(e){return lv.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}M(yg,"id","category"),M(yg,"defaults",{ticks:{callback:lv}});function bN(r,e){const t=[],{bounds:s,step:i,min:a,max:o,precision:l,count:c,maxTicks:u,maxDigits:d,includeBounds:h}=r,f=i||1,p=u-1,{min:m,max:g}=e,b=!Ne(a),_=!Ne(o),y=!Ne(c),w=(g-m)/(d+1);let v=rw((g-m)/p/f)*f,x,S,k,R;if(v<1e-14&&!b&&!_)return[{value:m},{value:g}];R=Math.ceil(g/v)-Math.floor(m/v),R>p&&(v=rw(R*v/p/f)*f),Ne(l)||(x=Math.pow(10,l),v=Math.ceil(v*x)/x),s==="ticks"?(S=Math.floor(m/v)*v,k=Math.ceil(g/v)*v):(S=m,k=g),b&&_&&i&&uI((o-a)/i,v/1e3)?(R=Math.round(Math.min((o-a)/v,u)),v=(o-a)/R,S=a,k=o):y?(S=b?a:S,k=_?o:k,R=c-1,v=(k-S)/R):(R=(k-S)/v,Xo(R,Math.round(R),v/1e3)?R=Math.round(R):R=Math.ceil(R));const D=Math.max(sw(v),sw(S));x=Math.pow(10,Ne(l)?D:l),S=Math.round(S*x)/x,k=Math.round(k*x)/x;let C=0;for(b&&(h&&S!==a?(t.push({value:a}),S<a&&C++,Xo(Math.round((S+C*v)*x)/x,a,cv(a,w,r))&&C++):S<a&&C++);C<R;++C){const N=Math.round((S+C*v)*x)/x;if(_&&N>o)break;t.push({value:N})}return _&&h&&k!==o?t.length&&Xo(t[t.length-1].value,o,cv(o,w,r))?t[t.length-1].value=o:t.push({value:o}):(!_||k===o)&&t.push({value:k}),t}function cv(r,e,{horizontal:t,minRotation:n}){const s=Kn(n),i=(t?Math.sin(s):Math.cos(s))||.001,a=.75*e*(""+r).length;return Math.min(e/i,a)}class Pd extends Ai{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,t){return Ne(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:t,maxDefined:n}=this.getUserBounds();let{min:s,max:i}=this;const a=l=>s=t?s:l,o=l=>i=n?i:l;if(e){const l=Ar(s),c=Ar(i);l<0&&c<0?o(0):l>0&&c>0&&a(0)}if(s===i){let l=i===0?1:Math.abs(i*.05);o(i+l),e||a(s-l)}this.min=s,this.max=i}getTickLimit(){const e=this.options.ticks;let{maxTicksLimit:t,stepSize:n}=e,s;return n?(s=Math.ceil(this.max/n)-Math.floor(this.min/n)+1,s>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${n} would result generating up to ${s} ticks. Limiting to 1000.`),s=1e3)):(s=this.computeTickLimit(),t=t||11),t&&(s=Math.min(t,s)),s}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,t=e.ticks;let n=this.getTickLimit();n=Math.max(2,n);const s={maxTicks:n,bounds:e.bounds,min:e.min,max:e.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:t.includeBounds!==!1},i=this._range||this,a=bN(s,i);return e.bounds==="ticks"&&wS(a,this,"value"),e.reverse?(a.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),a}configure(){const e=this.ticks;let t=this.min,n=this.max;if(super.configure(),this.options.offset&&e.length){const s=(n-t)/Math.max(e.length-1,1)/2;t-=s,n+=s}this._startValue=t,this._endValue=n,this._valueRange=n-t}getLabelForValue(e){return gc(e,this.chart.options.locale,this.options.ticks.format)}}class wg extends Pd{determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=gt(e)?e:0,this.max=gt(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),t=e?this.width:this.height,n=Kn(this.options.ticks.minRotation),s=(e?Math.sin(n):Math.cos(n))||.001,i=this._resolveTickFontOptions(0);return Math.ceil(t/Math.min(40,i.lineHeight/s))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}M(wg,"id","linear"),M(wg,"defaults",{ticks:{callback:Ah.formatters.numeric}});const wl=r=>Math.floor(xs(r)),Js=(r,e)=>Math.pow(10,wl(r)+e);function uv(r){return r/Math.pow(10,wl(r))===1}function dv(r,e,t){const n=Math.pow(10,t),s=Math.floor(r/n);return Math.ceil(e/n)-s}function _N(r,e){const t=e-r;let n=wl(t);for(;dv(r,e,n)>10;)n++;for(;dv(r,e,n)<10;)n--;return Math.min(n,wl(r))}function yN(r,{min:e,max:t}){e=Pn(r.min,e);const n=[],s=wl(e);let i=_N(e,t),a=i<0?Math.pow(10,Math.abs(i)):1;const o=Math.pow(10,i),l=s>i?Math.pow(10,s):0,c=Math.round((e-l)*a)/a,u=Math.floor((e-l)/o/10)*o*10;let d=Math.floor((c-u)/Math.pow(10,i)),h=Pn(r.min,Math.round((l+u+d*Math.pow(10,i))*a)/a);for(;h<t;)n.push({value:h,major:uv(h),significand:d}),d>=10?d=d<15?15:20:d++,d>=20&&(i++,d=2,a=i>=0?1:a),h=Math.round((l+u+d*Math.pow(10,i))*a)/a;const f=Pn(r.max,h);return n.push({value:f,major:uv(f),significand:d}),n}class vg extends Ai{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,t){const n=Pd.prototype.parse.apply(this,[e,t]);if(n===0){this._zero=!0;return}return gt(n)&&n>0?n:null}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=gt(e)?Math.max(0,e):null,this.max=gt(t)?Math.max(0,t):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!gt(this._userMin)&&(this.min=e===Js(this.min,0)?Js(this.min,-1):Js(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let n=this.min,s=this.max;const i=o=>n=e?n:o,a=o=>s=t?s:o;n===s&&(n<=0?(i(1),a(10)):(i(Js(n,-1)),a(Js(s,1)))),n<=0&&i(Js(s,-1)),s<=0&&a(Js(n,1)),this.min=n,this.max=s}buildTicks(){const e=this.options,t={min:this._userMin,max:this._userMax},n=yN(t,this);return e.bounds==="ticks"&&wS(n,this,"value"),e.reverse?(n.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),n}getLabelForValue(e){return e===void 0?"0":gc(e,this.chart.options.locale,this.options.ticks.format)}configure(){const e=this.min;super.configure(),this._startValue=xs(e),this._valueRange=xs(this.max)-xs(e)}getPixelForValue(e){return(e===void 0||e===0)&&(e=this.min),e===null||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(xs(e)-this._startValue)/this._valueRange)}getValueForPixel(e){const t=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+t*this._valueRange)}}M(vg,"id","logarithmic"),M(vg,"defaults",{ticks:{callback:Ah.formatters.logarithmic,major:{enabled:!0}}});function xg(r){const e=r.ticks;if(e.display&&r.display){const t=Xt(e.backdropPadding);return Se(e.font&&e.font.size,ut.font.size)+t.height}return 0}function wN(r,e,t){return t=ct(t)?t:[t],{w:EI(r,e.string,t),h:t.length*e.lineHeight}}function hv(r,e,t,n,s){return r===n||r===s?{start:e-t/2,end:e+t/2}:r<n||r>s?{start:e-t,end:e}:{start:e,end:e+t}}function vN(r){const e={l:r.left+r._padding.left,r:r.right-r._padding.right,t:r.top+r._padding.top,b:r.bottom-r._padding.bottom},t=Object.assign({},e),n=[],s=[],i=r._pointLabels.length,a=r.options.pointLabels,o=a.centerPointLabels?it/i:0;for(let l=0;l<i;l++){const c=a.setContext(r.getPointLabelContext(l));s[l]=c.padding;const u=r.getPointPosition(l,r.drawingArea+s[l],o),d=Ot(c.font),h=wN(r.ctx,d,r._pointLabels[l]);n[l]=h;const f=On(r.getIndexAngle(l)+o),p=Math.round($b(f)),m=hv(p,u.x,h.w,0,180),g=hv(p,u.y,h.h,90,270);xN(t,e,f,m,g)}r.setCenterPoint(e.l-t.l,t.r-e.r,e.t-t.t,t.b-e.b),r._pointLabelItems=PN(r,n,s)}function xN(r,e,t,n,s){const i=Math.abs(Math.sin(t)),a=Math.abs(Math.cos(t));let o=0,l=0;n.start<e.l?(o=(e.l-n.start)/i,r.l=Math.min(r.l,e.l-o)):n.end>e.r&&(o=(n.end-e.r)/i,r.r=Math.max(r.r,e.r+o)),s.start<e.t?(l=(e.t-s.start)/a,r.t=Math.min(r.t,e.t-l)):s.end>e.b&&(l=(s.end-e.b)/a,r.b=Math.max(r.b,e.b+l))}function kN(r,e,t){const n=r.drawingArea,{extra:s,additionalAngle:i,padding:a,size:o}=t,l=r.getPointPosition(e,n+s+a,i),c=Math.round($b(On(l.angle+wt))),u=ON(l.y,o.h,c),d=AN(c),h=EN(l.x,o.w,d);return{visible:!0,x:l.x,y:u,textAlign:d,left:h,top:u,right:h+o.w,bottom:u+o.h}}function SN(r,e){if(!e)return!0;const{left:t,top:n,right:s,bottom:i}=r;return!(Yr({x:t,y:n},e)||Yr({x:t,y:i},e)||Yr({x:s,y:n},e)||Yr({x:s,y:i},e))}function PN(r,e,t){const n=[],s=r._pointLabels.length,i=r.options,{centerPointLabels:a,display:o}=i.pointLabels,l={extra:xg(i)/2,additionalAngle:a?it/s:0};let c;for(let u=0;u<s;u++){l.padding=t[u],l.size=e[u];const d=kN(r,u,l);n.push(d),o==="auto"&&(d.visible=SN(d,c),d.visible&&(c=d))}return n}function AN(r){return r===0||r===180?"center":r<180?"left":"right"}function EN(r,e,t){return t==="right"?r-=e:t==="center"&&(r-=e/2),r}function ON(r,e,t){return t===90||t===270?r-=e/2:(t>270||t<90)&&(r-=e),r}function TN(r,e,t){const{left:n,top:s,right:i,bottom:a}=t,{backdropColor:o}=e;if(!Ne(o)){const l=ci(e.borderRadius),c=Xt(e.backdropPadding);r.fillStyle=o;const u=n-c.left,d=s-c.top,h=i-n+c.width,f=a-s+c.height;Object.values(l).some(p=>p!==0)?(r.beginPath(),_l(r,{x:u,y:d,w:h,h:f,radius:l}),r.fill()):r.fillRect(u,d,h,f)}}function RN(r,e){const{ctx:t,options:{pointLabels:n}}=r;for(let s=e-1;s>=0;s--){const i=r._pointLabelItems[s];if(!i.visible)continue;const a=n.setContext(r.getPointLabelContext(s));TN(t,a,i);const o=Ot(a.font),{x:l,y:c,textAlign:u}=i;gi(t,r._pointLabels[s],l,c+o.lineHeight/2,o,{color:a.color,textAlign:u,textBaseline:"middle"})}}function d1(r,e,t,n){const{ctx:s}=r;if(t)s.arc(r.xCenter,r.yCenter,e,0,st);else{let i=r.getPointPosition(0,e);s.moveTo(i.x,i.y);for(let a=1;a<n;a++)i=r.getPointPosition(a,e),s.lineTo(i.x,i.y)}}function IN(r,e,t,n,s){const i=r.ctx,a=e.circular,{color:o,lineWidth:l}=e;!a&&!n||!o||!l||t<0||(i.save(),i.strokeStyle=o,i.lineWidth=l,i.setLineDash(s.dash||[]),i.lineDashOffset=s.dashOffset,i.beginPath(),d1(r,t,a,n),i.closePath(),i.stroke(),i.restore())}function CN(r,e,t){return Fs(r,{label:t,index:e,type:"pointLabel"})}class Lo extends Pd{constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const e=this._padding=Xt(xg(this.options)/2),t=this.width=this.maxWidth-e.width,n=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+t/2+e.left),this.yCenter=Math.floor(this.top+n/2+e.top),this.drawingArea=Math.floor(Math.min(t,n)/2)}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!1);this.min=gt(e)&&!isNaN(e)?e:0,this.max=gt(t)&&!isNaN(t)?t:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/xg(this.options))}generateTickLabels(e){Pd.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map((t,n)=>{const s=nt(this.options.pointLabels.callback,[t,n],this);return s||s===0?s:""}).filter((t,n)=>this.chart.getDataVisibility(n))}fit(){const e=this.options;e.display&&e.pointLabels.display?vN(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,t,n,s){this.xCenter+=Math.floor((e-t)/2),this.yCenter+=Math.floor((n-s)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,t,n,s))}getIndexAngle(e){const t=st/(this._pointLabels.length||1),n=this.options.startAngle||0;return On(e*t+Kn(n))}getDistanceFromCenterForValue(e){if(Ne(e))return NaN;const t=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*t:(e-this.min)*t}getValueForDistanceFromCenter(e){if(Ne(e))return NaN;const t=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-t:this.min+t}getPointLabelContext(e){const t=this._pointLabels||[];if(e>=0&&e<t.length){const n=t[e];return CN(this.getContext(),e,n)}}getPointPosition(e,t,n=0){const s=this.getIndexAngle(e)-wt+n;return{x:Math.cos(s)*t+this.xCenter,y:Math.sin(s)*t+this.yCenter,angle:s}}getPointPositionForValue(e,t){return this.getPointPosition(e,this.getDistanceFromCenterForValue(t))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){const{left:t,top:n,right:s,bottom:i}=this._pointLabelItems[e];return{left:t,top:n,right:s,bottom:i}}drawBackground(){const{backgroundColor:e,grid:{circular:t}}=this.options;if(e){const n=this.ctx;n.save(),n.beginPath(),d1(this,this.getDistanceFromCenterForValue(this._endValue),t,this._pointLabels.length),n.closePath(),n.fillStyle=e,n.fill(),n.restore()}}drawGrid(){const e=this.ctx,t=this.options,{angleLines:n,grid:s,border:i}=t,a=this._pointLabels.length;let o,l,c;if(t.pointLabels.display&&RN(this,a),s.display&&this.ticks.forEach((u,d)=>{if(d!==0||d===0&&this.min<0){l=this.getDistanceFromCenterForValue(u.value);const h=this.getContext(d),f=s.setContext(h),p=i.setContext(h);IN(this,f,l,a,p)}}),n.display){for(e.save(),o=a-1;o>=0;o--){const u=n.setContext(this.getPointLabelContext(o)),{color:d,lineWidth:h}=u;!h||!d||(e.lineWidth=h,e.strokeStyle=d,e.setLineDash(u.borderDash),e.lineDashOffset=u.borderDashOffset,l=this.getDistanceFromCenterForValue(t.reverse?this.min:this.max),c=this.getPointPosition(o,l),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(c.x,c.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){const e=this.ctx,t=this.options,n=t.ticks;if(!n.display)return;const s=this.getIndexAngle(0);let i,a;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(s),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach((o,l)=>{if(l===0&&this.min>=0&&!t.reverse)return;const c=n.setContext(this.getContext(l)),u=Ot(c.font);if(i=this.getDistanceFromCenterForValue(this.ticks[l].value),c.showLabelBackdrop){e.font=u.string,a=e.measureText(o.label).width,e.fillStyle=c.backdropColor;const d=Xt(c.backdropPadding);e.fillRect(-a/2-d.left,-i-u.size/2-d.top,a+d.width,u.size+d.height)}gi(e,o.label,0,-i,u,{color:c.color,strokeColor:c.textStrokeColor,strokeWidth:c.textStrokeWidth})}),e.restore()}drawTitle(){}}M(Lo,"id","radialLinear"),M(Lo,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Ah.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(e){return e},padding:5,centerPointLabels:!1}}),M(Lo,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),M(Lo,"descriptors",{angleLines:{_fallback:"grid"}});const Ih={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},gn=Object.keys(Ih);function fv(r,e){return r-e}function pv(r,e){if(Ne(e))return null;const t=r._adapter,{parser:n,round:s,isoWeekday:i}=r._parseOpts;let a=e;return typeof n=="function"&&(a=n(a)),gt(a)||(a=typeof n=="string"?t.parse(a,n):t.parse(a)),a===null?null:(s&&(a=s==="week"&&(Ea(i)||i===!0)?t.startOf(a,"isoWeek",i):t.startOf(a,s)),+a)}function mv(r,e,t,n){const s=gn.length;for(let i=gn.indexOf(r);i<s-1;++i){const a=Ih[gn[i]],o=a.steps?a.steps:Number.MAX_SAFE_INTEGER;if(a.common&&Math.ceil((t-e)/(o*a.size))<=n)return gn[i]}return gn[s-1]}function $N(r,e,t,n,s){for(let i=gn.length-1;i>=gn.indexOf(t);i--){const a=gn[i];if(Ih[a].common&&r._adapter.diff(s,n,a)>=e-1)return a}return gn[t?gn.indexOf(t):0]}function MN(r){for(let e=gn.indexOf(r)+1,t=gn.length;e<t;++e)if(Ih[gn[e]].common)return gn[e]}function gv(r,e,t){if(!t)r[e]=!0;else if(t.length){const{lo:n,hi:s}=Mb(t,e),i=t[n]>=e?t[n]:t[s];r[i]=!0}}function NN(r,e,t,n){const s=r._adapter,i=+s.startOf(e[0].value,n),a=e[e.length-1].value;let o,l;for(o=i;o<=a;o=+s.add(o,1,n))l=t[o],l>=0&&(e[l].major=!0);return e}function bv(r,e,t){const n=[],s={},i=e.length;let a,o;for(a=0;a<i;++a)o=e[a],s[o]=a,n.push({value:o,major:!1});return i===0||!t?n:NN(r,n,s,t)}class vl extends Ai{constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,t={}){const n=e.time||(e.time={}),s=this._adapter=new HC._date(e.adapters.date);s.init(t),Ko(n.displayFormats,s.formats()),this._parseOpts={parser:n.parser,round:n.round,isoWeekday:n.isoWeekday},super.init(e),this._normalized=t.normalized}parse(e,t){return e===void 0?null:pv(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,t=this._adapter,n=e.time.unit||"day";let{min:s,max:i,minDefined:a,maxDefined:o}=this.getUserBounds();function l(c){!a&&!isNaN(c.min)&&(s=Math.min(s,c.min)),!o&&!isNaN(c.max)&&(i=Math.max(i,c.max))}(!a||!o)&&(l(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&l(this.getMinMax(!1))),s=gt(s)&&!isNaN(s)?s:+t.startOf(Date.now(),n),i=gt(i)&&!isNaN(i)?i:+t.endOf(Date.now(),n)+1,this.min=Math.min(s,i-1),this.max=Math.max(s+1,i)}_getLabelBounds(){const e=this.getLabelTimestamps();let t=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return e.length&&(t=e[0],n=e[e.length-1]),{min:t,max:n}}buildTicks(){const e=this.options,t=e.time,n=e.ticks,s=n.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&s.length&&(this.min=this._userMin||s[0],this.max=this._userMax||s[s.length-1]);const i=this.min,a=this.max,o=pI(s,i,a);return this._unit=t.unit||(n.autoSkip?mv(t.minUnit,this.min,this.max,this._getLabelCapacity(i)):$N(this,o.length,t.minUnit,this.min,this.max)),this._majorUnit=!n.major.enabled||this._unit==="year"?void 0:MN(this._unit),this.initOffsets(s),e.reverse&&o.reverse(),bv(this,o,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let t=0,n=0,s,i;this.options.offset&&e.length&&(s=this.getDecimalForValue(e[0]),e.length===1?t=1-s:t=(this.getDecimalForValue(e[1])-s)/2,i=this.getDecimalForValue(e[e.length-1]),e.length===1?n=i:n=(i-this.getDecimalForValue(e[e.length-2]))/2);const a=e.length<3?.5:.25;t=Nt(t,0,a),n=Nt(n,0,a),this._offsets={start:t,end:n,factor:1/(t+1+n)}}_generate(){const e=this._adapter,t=this.min,n=this.max,s=this.options,i=s.time,a=i.unit||mv(i.minUnit,t,n,this._getLabelCapacity(t)),o=Se(s.ticks.stepSize,1),l=a==="week"?i.isoWeekday:!1,c=Ea(l)||l===!0,u={};let d=t,h,f;if(c&&(d=+e.startOf(d,"isoWeek",l)),d=+e.startOf(d,c?"day":a),e.diff(n,t,a)>1e5*o)throw new Error(t+" and "+n+" are too far apart with stepSize of "+o+" "+a);const p=s.ticks.source==="data"&&this.getDataTimestamps();for(h=d,f=0;h<n;h=+e.add(h,o,a),f++)gv(u,h,p);return(h===n||s.bounds==="ticks"||f===1)&&gv(u,h,p),Object.keys(u).sort(fv).map(m=>+m)}getLabelForValue(e){const t=this._adapter,n=this.options.time;return n.tooltipFormat?t.format(e,n.tooltipFormat):t.format(e,n.displayFormats.datetime)}format(e,t){const s=this.options.time.displayFormats,i=this._unit,a=t||s[i];return this._adapter.format(e,a)}_tickFormatFunction(e,t,n,s){const i=this.options,a=i.ticks.callback;if(a)return nt(a,[e,t,n],this);const o=i.time.displayFormats,l=this._unit,c=this._majorUnit,u=l&&o[l],d=c&&o[c],h=n[t],f=c&&d&&h&&h.major;return this._adapter.format(e,s||(f?d:u))}generateTickLabels(e){let t,n,s;for(t=0,n=e.length;t<n;++t)s=e[t],s.label=this._tickFormatFunction(s.value,t,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const t=this._offsets,n=this.getDecimalForValue(e);return this.getPixelForDecimal((t.start+n)*t.factor)}getValueForPixel(e){const t=this._offsets,n=this.getDecimalForPixel(e)/t.factor-t.end;return this.min+n*(this.max-this.min)}_getLabelSize(e){const t=this.options.ticks,n=this.ctx.measureText(e).width,s=Kn(this.isHorizontal()?t.maxRotation:t.minRotation),i=Math.cos(s),a=Math.sin(s),o=this._resolveTickFontOptions(0).size;return{w:n*i+o*a,h:n*a+o*i}}_getLabelCapacity(e){const t=this.options.time,n=t.displayFormats,s=n[t.unit]||n.millisecond,i=this._tickFormatFunction(e,0,bv(this,[e],this._majorUnit),s),a=this._getLabelSize(i),o=Math.floor(this.isHorizontal()?this.width/a.w:this.height/a.h)-1;return o>0?o:1}getDataTimestamps(){let e=this._cache.data||[],t,n;if(e.length)return e;const s=this.getMatchingVisibleMetas();if(this._normalized&&s.length)return this._cache.data=s[0].controller.getAllParsedValues(this);for(t=0,n=s.length;t<n;++t)e=e.concat(s[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let t,n;if(e.length)return e;const s=this.getLabels();for(t=0,n=s.length;t<n;++t)e.push(pv(this,s[t]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return kS(e.sort(fv))}}M(vl,"id","time"),M(vl,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function au(r,e,t){let n=0,s=r.length-1,i,a,o,l;t?(e>=r[n].pos&&e<=r[s].pos&&({lo:n,hi:s}=Xr(r,"pos",e)),{pos:i,time:o}=r[n],{pos:a,time:l}=r[s]):(e>=r[n].time&&e<=r[s].time&&({lo:n,hi:s}=Xr(r,"time",e)),{time:i,pos:o}=r[n],{time:a,pos:l}=r[s]);const c=a-i;return c?o+(l-o)*(e-i)/c:o}class kg extends vl{constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(e);this._minPos=au(t,this.min),this._tableRange=au(t,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:t,max:n}=this,s=[],i=[];let a,o,l,c,u;for(a=0,o=e.length;a<o;++a)c=e[a],c>=t&&c<=n&&s.push(c);if(s.length<2)return[{time:t,pos:0},{time:n,pos:1}];for(a=0,o=s.length;a<o;++a)u=s[a+1],l=s[a-1],c=s[a],Math.round((u+l)/2)!==c&&i.push({time:c,pos:a/(o-1)});return i}_generate(){const e=this.min,t=this.max;let n=super.getDataTimestamps();return(!n.includes(e)||!n.length)&&n.splice(0,0,e),(!n.includes(t)||n.length===1)&&n.push(t),n.sort((s,i)=>s-i)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const t=this.getDataTimestamps(),n=this.getLabelTimestamps();return t.length&&n.length?e=this.normalize(t.concat(n)):e=t.length?t:n,e=this._cache.all=e,e}getDecimalForValue(e){return(au(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const t=this._offsets,n=this.getDecimalForPixel(e)/t.factor-t.end;return au(this._table,n*this._tableRange+this._minPos,!0)}}M(kg,"id","timeseries"),M(kg,"defaults",vl.defaults);var LN=Object.freeze({__proto__:null,CategoryScale:yg,LinearScale:wg,LogarithmicScale:vg,RadialLinearScale:Lo,TimeScale:vl,TimeSeriesScale:kg});const jN=[qC,_M,fN,LN];Wr.register(...jN);function DN(r){return typeof r=="function"}function FN(r){return r!==null&&typeof r=="object"}const zN=["string","number","bigint","boolean"];function Sg(r){return r==null||zN.includes(typeof r)?!0:Array.isArray(r)?r.every(e=>Sg(e)):typeof r=="object"?Object.getPrototypeOf(r)===Object.prototype:!1}const xl=Symbol("box"),Vb=Symbol("is-writable");function BN(r){return FN(r)&&xl in r}function UN(r){return me.isBox(r)&&Vb in r}function me(r){let e=rn(xh(r));return{[xl]:!0,[Vb]:!0,get current(){return A(e)},set current(t){de(e,t,!0)}}}function qN(r,e){const t=ze(r);return e?{[xl]:!0,[Vb]:!0,get current(){return A(t)},set current(n){e(n)}}:{[xl]:!0,get current(){return r()}}}function HN(r){return me.isBox(r)?r:DN(r)?me.with(r):me(r)}function WN(r){return Object.entries(r).reduce((e,[t,n])=>me.isBox(n)?(me.isWritableBox(n)?Object.defineProperty(e,t,{get(){return n.current},set(s){n.current=s}}):Object.defineProperty(e,t,{get(){return n.current}}),e):Object.assign(e,{[t]:n}),{})}function VN(r){return me.isWritableBox(r)?{[xl]:!0,get current(){return r.current}}:r}me.from=HN;me.with=qN;me.flatten=WN;me.readonly=VN;me.isBox=BN;me.isWritableBox=UN;function GN(...r){return function(e){var t;for(const n of r)if(n){if(e.defaultPrevented)return;typeof n=="function"?n.call(this,e):(t=n.current)==null||t.call(this,e)}}}var ji={},Xf,_v;function ZN(){if(_v)return Xf;_v=1;var r=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,e=/\n/g,t=/^\s*/,n=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,s=/^:\s*/,i=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,a=/^[;\s]*/,o=/^\s+|\s+$/g,l=`
`,c="/",u="*",d="",h="comment",f="declaration";Xf=function(m,g){if(typeof m!="string")throw new TypeError("First argument must be a string");if(!m)return[];g=g||{};var b=1,_=1;function y($){var P=$.match(e);P&&(b+=P.length);var E=$.lastIndexOf(l);_=~E?$.length-E:_+$.length}function w(){var $={line:b,column:_};return function(P){return P.position=new v($),k(),P}}function v($){this.start=$,this.end={line:b,column:_},this.source=g.source}v.prototype.content=m;function x($){var P=new Error(g.source+":"+b+":"+_+": "+$);if(P.reason=$,P.filename=g.source,P.line=b,P.column=_,P.source=m,!g.silent)throw P}function S($){var P=$.exec(m);if(P){var E=P[0];return y(E),m=m.slice(E.length),P}}function k(){S(t)}function R($){var P;for($=$||[];P=D();)P!==!1&&$.push(P);return $}function D(){var $=w();if(!(c!=m.charAt(0)||u!=m.charAt(1))){for(var P=2;d!=m.charAt(P)&&(u!=m.charAt(P)||c!=m.charAt(P+1));)++P;if(P+=2,d===m.charAt(P-1))return x("End of comment missing");var E=m.slice(2,P-2);return _+=2,y(E),m=m.slice(P),_+=2,$({type:h,comment:E})}}function C(){var $=w(),P=S(n);if(P){if(D(),!S(s))return x("property missing ':'");var E=S(i),O=$({type:f,property:p(P[0].replace(r,d)),value:E?p(E[0].replace(r,d)):d});return S(a),O}}function N(){var $=[];R($);for(var P;P=C();)P!==!1&&($.push(P),R($));return $}return k(),N()};function p(m){return m?m.replace(o,d):d}return Xf}var yv;function JN(){if(yv)return ji;yv=1;var r=ji&&ji.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ji,"__esModule",{value:!0}),ji.default=t;var e=r(ZN());function t(n,s){var i=null;if(!n||typeof n!="string")return i;var a=(0,e.default)(n),o=typeof s=="function";return a.forEach(function(l){if(l.type==="declaration"){var c=l.property,u=l.value;o?s(c,u,l):u&&(i=i||{},i[c]=u)}}),i}return ji}var KN=JN();const wv=Pi(KN),XN=wv.default||wv,YN=/\d/,QN=["-","_","/","."];function eL(r=""){if(!YN.test(r))return r!==r.toLowerCase()}function tL(r){const e=[];let t="",n,s;for(const i of r){const a=QN.includes(i);if(a===!0){e.push(t),t="",n=void 0;continue}const o=eL(i);if(s===!1){if(n===!1&&o===!0){e.push(t),t=i,n=o;continue}if(n===!0&&o===!1&&t.length>1){const l=t.at(-1);e.push(t.slice(0,Math.max(0,t.length-1))),t=l+i,n=o;continue}}t+=i,n=o,s=a}return e.push(t),e}function h1(r){return r?tL(r).map(e=>rL(e)).join(""):""}function nL(r){return sL(h1(r||""))}function rL(r){return r?r[0].toUpperCase()+r.slice(1):""}function sL(r){return r?r[0].toLowerCase()+r.slice(1):""}function ou(r){if(!r)return{};const e={};function t(n,s){if(n.startsWith("-moz-")||n.startsWith("-webkit-")||n.startsWith("-ms-")||n.startsWith("-o-")){e[h1(n)]=s;return}if(n.startsWith("--")){e[n]=s;return}e[nL(n)]=s}return XN(r,t),e}function f1(...r){return(...e)=>{for(const t of r)typeof t=="function"&&t(...e)}}function iL(r,e,t,n){const s=Array.isArray(e)?e:[e];return s.forEach(i=>r.addEventListener(i,t,n)),()=>{s.forEach(i=>r.removeEventListener(i,t,n))}}function aL(r,e){const t=RegExp(r,"g");return n=>{if(typeof n!="string")throw new TypeError(`expected an argument of type string, but got ${typeof n}`);return n.match(t)?n.replace(t,e):n}}const oL=aL(/[A-Z]/,r=>`-${r.toLowerCase()}`);function lL(r){if(!r||typeof r!="object"||Array.isArray(r))throw new TypeError(`expected an argument of type object, but got ${typeof r}`);return Object.keys(r).map(e=>`${oL(e)}: ${r[e]};`).join(`
`)}function p1(r={}){return lL(r).replace(`
`," ")}const cL={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",transform:"translateX(-100%)"};p1(cL);function uL(r){var e;return r.length>2&&r.startsWith("on")&&r[2]===((e=r[2])==null?void 0:e.toLowerCase())}function Ei(...r){const e={...r[0]};for(let t=1;t<r.length;t++){const n=r[t];for(const s in n){const i=e[s],a=n[s],o=typeof i=="function",l=typeof a=="function";if(o&&uL(s)){const c=i,u=a;e[s]=GN(c,u)}else if(o&&l)e[s]=f1(i,a);else if(s==="class"){const c=Sg(i),u=Sg(a);c&&u?e[s]=Zo(i,a):c?e[s]=Zo(i):u&&(e[s]=Zo(a))}else if(s==="style"){const c=typeof i=="object",u=typeof a=="object",d=typeof i=="string",h=typeof a=="string";if(c&&u)e[s]={...i,...a};else if(c&&h){const f=ou(a);e[s]={...i,...f}}else if(d&&u){const f=ou(i);e[s]={...f,...a}}else if(d&&h){const f=ou(i),p=ou(a);e[s]={...f,...p}}else c?e[s]=i:u?e[s]=a:d?e[s]=i:h&&(e[s]=a)}else e[s]=a!==void 0?a:i}}return typeof e.style=="object"&&(e.style=p1(e.style).replaceAll(`
`," ")),e.hidden!==!0&&(e.hidden=void 0,delete e.hidden),e.disabled!==!0&&(e.disabled=void 0,delete e.disabled),e}const dL=typeof window<"u"?window:void 0;function hL(r){let e=r.activeElement;for(;e!=null&&e.shadowRoot;){const t=e.shadowRoot.activeElement;if(t===e)break;e=t}return e}var wr,vr,Gr,ba,ad;const py=class py extends Map{constructor(t){super();ye(this,ba);ye(this,wr,new Map);ye(this,vr,qr(0));ye(this,Gr,qr(0));if(t){for(var[n,s]of t)super.set(n,s);F(this,Gr).v=super.size}}has(t){var n=F(this,wr),s=n.get(t);if(s===void 0){var i=super.get(t);if(i!==void 0)s=qr(0),n.set(t,s);else return A(F(this,vr)),!1}return A(s),!0}forEach(t,n){Us(this,ba,ad).call(this),super.forEach(t,n)}get(t){var n=F(this,wr),s=n.get(t);if(s===void 0){var i=super.get(t);if(i!==void 0)s=qr(0),n.set(t,s);else{A(F(this,vr));return}}return A(s),super.get(t)}set(t,n){var d;var s=F(this,wr),i=s.get(t),a=super.get(t),o=super.set(t,n),l=F(this,vr);if(i===void 0)s.set(t,qr(0)),de(F(this,Gr),super.size),Vi(l);else if(a!==n){Vi(i);var c=l.reactions===null?null:new Set(l.reactions),u=c===null||!((d=i.reactions)!=null&&d.every(h=>c.has(h)));u&&Vi(l)}return o}delete(t){var n=F(this,wr),s=n.get(t),i=super.delete(t);return s!==void 0&&(n.delete(t),de(F(this,Gr),super.size),de(s,-1),Vi(F(this,vr))),i}clear(){if(super.size!==0){super.clear();var t=F(this,wr);de(F(this,Gr),0);for(var n of t.values())de(n,-1);Vi(F(this,vr)),t.clear()}}keys(){return A(F(this,vr)),super.keys()}values(){return Us(this,ba,ad).call(this),super.values()}entries(){return Us(this,ba,ad).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return A(F(this,Gr)),super.size}};wr=new WeakMap,vr=new WeakMap,Gr=new WeakMap,ba=new WeakSet,ad=function(){A(F(this,vr));var t=F(this,wr);if(F(this,Gr).v!==t.size)for(var n of vy(py.prototype,this,"keys").call(this))t.has(n)||t.set(n,qr(0));for(var[,s]of F(this,wr))A(s)};let Ad=py;var _a,Hl;class fL{constructor(e={}){ye(this,_a);ye(this,Hl);const{window:t=dL,document:n=t==null?void 0:t.document}=e;t!==void 0&&(Qa(this,_a,n),Qa(this,Hl,NO(s=>{const i=ms(t,"focusin",s),a=ms(t,"focusout",s);return()=>{i(),a()}})))}get current(){var e;return(e=F(this,Hl))==null||e.call(this),F(this,_a)?hL(F(this,_a)):null}}_a=new WeakMap,Hl=new WeakMap;new fL;function pL(r,e){switch(r){case"post":Os(e);break;case"pre":lO(e);break}}function m1(r,e,t,n={}){const{lazy:s=!1}=n;let i=!s,a=Array.isArray(r)?[]:void 0;pL(e,()=>{const o=Array.isArray(r)?r.map(c=>c()):r();if(!i){i=!0,a=o;return}const l=vh(()=>t(o,a));return a=o,l})}function As(r,e,t){m1(r,"post",e,t)}function mL(r,e,t){m1(r,"pre",e,t)}As.pre=mL;var Wl,Zr;class g1{constructor(e){ye(this,Wl);ye(this,Zr);Qa(this,Wl,e),Qa(this,Zr,Symbol(e))}get key(){return F(this,Zr)}exists(){return cO(F(this,Zr))}get(){const e=Sy(F(this,Zr));if(e===void 0)throw new Error(`Context "${F(this,Wl)}" not found`);return e}getOr(e){const t=Sy(F(this,Zr));return t===void 0?e:t}set(e){return uO(F(this,Zr),e)}}Wl=new WeakMap,Zr=new WeakMap;function gL(r){Os(()=>()=>{r()})}function Oi({id:r,ref:e,deps:t=()=>!0,onRefChange:n,getRootNode:s}){As([()=>r.current,t],([i])=>{const a=(s==null?void 0:s())??document,o=a==null?void 0:a.getElementById(i);o?e.current=o:e.current=null,n==null||n(e.current)}),gL(()=>{e.current=null,n==null||n(null)})}function bL(r){Ek().then(r)}function _L({layout:r,panesArray:e,pivotIndices:t}){let n=0,s=100,i=0,a=0;const o=t[0];for(let d=0;d<e.length;d++){const h=e[d].constraints,{maxSize:f=100,minSize:p=0}=h;d===o?(n=p,s=f):(i+=p,a+=f)}const l=Math.min(s,100-i),c=Math.max(n,100-a),u=r[o];return{valueMax:l,valueMin:c,valueNow:u}}function rt(r,e="Assertion failed!"){if(!r)throw console.error(e),new Error(e)}const yL=100,Gb=10;function An(r,e,t=Gb){return kl(r,e,t)===0}function kl(r,e,t=Gb){const n=vv(r,t),s=vv(e,t);return Math.sign(n-s)}function co(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function vv(r,e){return Number.parseFloat(r.toFixed(e))}const Ch=typeof document<"u";function wL(r){return r instanceof HTMLElement}function b1(r){return r.type==="keydown"}function _1(r){return r.type.startsWith("mouse")}function y1(r){return r.type.startsWith("touch")}function Qi({paneConstraints:r,paneIndex:e,initialSize:t}){const n=r[e];rt(n!=null,"Pane constraints should not be null.");const{collapsedSize:s=0,collapsible:i,maxSize:a=100,minSize:o=0}=n;let l=t;return kl(l,o)<0&&(l=vL(l,i,s,o)),l=Math.min(a,l),Number.parseFloat(l.toFixed(Gb))}function vL(r,e,t,n){if(!e)return n;const s=(t+n)/2;return kl(r,s)<0?t:n}function di(){}function xL({groupId:r,layout:e,panesArray:t}){const n=bc(r);for(let s=0;s<t.length-1;s++){const{valueMax:i,valueMin:a,valueNow:o}=_L({layout:e,panesArray:t,pivotIndices:[s,s+1]}),l=n[s];if(wL(l)){const c=t[s];l.setAttribute("aria-controls",c.opts.id.current),l.setAttribute("aria-valuemax",`${Math.round(i)}`),l.setAttribute("aria-valuemin",`${Math.round(a)}`),l.setAttribute("aria-valuenow",o!=null?`${Math.round(o)}`:"")}}return()=>{n.forEach(s=>{s.removeAttribute("aria-controls"),s.removeAttribute("aria-valuemax"),s.removeAttribute("aria-valuemin"),s.removeAttribute("aria-valuenow")})}}function bc(r){return Ch?Array.from(document.querySelectorAll(`[data-pane-resizer-id][data-pane-group-id="${r}"]`)):[]}function w1(r,e){return Ch?bc(r).findIndex(s=>s.getAttribute("data-pane-resizer-id")===e)??null:null}function xv(r,e){const t=w1(r,e);return t!=null?[t,t+1]:[-1,-1]}function Di(r,e,t){const n=r.map(c=>c.constraints),s=Gi(r,e),i=n[s],o=s===r.length-1?[s-1,s]:[s,s+1],l=t[s];return{...i,paneSize:l,pivotIndices:o}}function Gi(r,e){return r.findIndex(t=>t.opts.id.current===e.opts.id.current)}function uo(r,e,t){for(let n=0;n<e.length;n++){const s=e[n],i=r[n];rt(i);const{collapsedSize:a=0,collapsible:o}=i.constraints,l=t[i.opts.id.current];if(!(l==null||s!==l))continue;t[i.opts.id.current]=s;const{onCollapse:c,onExpand:u,onResize:d}=i.callbacks;d==null||d(s,l),o&&(c||u)&&(u&&(l==null||l===a)&&s!==a&&u(),c&&(l==null||l!==a)&&s===a&&c())}}function kL({panesArray:r}){const e=Array(r.length),t=r.map(i=>i.constraints);let n=0,s=100;for(let i=0;i<r.length;i++){const a=t[i];rt(a);const{defaultSize:o}=a;o!=null&&(n++,e[i]=o,s-=o)}for(let i=0;i<r.length;i++){const a=t[i];rt(a);const{defaultSize:o}=a;if(o!=null)continue;const l=r.length-n,c=s/l;n++,e[i]=c,s-=c}return e}function SL({layout:r,paneConstraints:e}){const t=[...r],n=t.reduce((i,a)=>i+a,0);if(t.length!==e.length)throw new Error(`Invalid ${e.length} pane layout: ${t.map(i=>`${i}%`).join(", ")}`);if(!An(n,100))for(let i=0;i<e.length;i++){const a=t[i];rt(a!=null);const o=100/n*a;t[i]=o}let s=0;for(let i=0;i<e.length;i++){const a=t[i];rt(a!=null);const o=Qi({paneConstraints:e,paneIndex:i,initialSize:a});a!==o&&(s+=a-o,t[i]=o)}if(!An(s,0))for(let i=0;i<e.length;i++){const a=t[i];rt(a!=null);const o=a+s,l=Qi({paneConstraints:e,paneIndex:i,initialSize:o});if(a!==l&&(s-=l-a,t[i]=l,An(s,0)))break}return t}function PL(r){if(!Ch)return null;const e=document.querySelector(`[data-pane-group][data-pane-group-id="${r}"]`);return e||null}function Zb(r){if(!Ch)return null;const e=document.querySelector(`[data-pane-resizer-id="${r}"]`);return e||null}function AL(r,e,t,n){const s=t==="horizontal",i=Zb(e);rt(i);const a=i.getAttribute("data-pane-group-id");rt(a);const{initialCursorPosition:o}=n,l=v1(t,r),c=PL(a);rt(c);const u=c.getBoundingClientRect(),d=s?u.width:u.height;return(l-o)/d*100}function EL(r,e,t,n,s){if(b1(r)){const i=t==="horizontal";let a=0;r.shiftKey?a=100:s!=null?a=s:a=10;let o=0;switch(r.key){case"ArrowDown":o=i?0:a;break;case"ArrowLeft":o=i?-a:0;break;case"ArrowRight":o=i?a:0;break;case"ArrowUp":o=i?0:-a;break;case"End":o=100;break;case"Home":o=-100;break}return o}else return n==null?0:AL(r,e,t,n)}function v1(r,e){const t=r==="horizontal";if(_1(e))return t?e.clientX:e.clientY;if(y1(e)){const n=e.touches[0];return rt(n),t?n.screenX:n.screenY}else throw new Error(`Unsupported event type "${e.type}"`)}function OL(r,e,t){var l,c;const n=Zb(e),s=bc(r),i=n?s.indexOf(n):-1,a=((l=t[i])==null?void 0:l.opts.id.current)??null,o=((c=t[i+1])==null?void 0:c.opts.id.current)??null;return[a,o]}let kv=0;function Ed(r="paneforge"){return kv++,`${r}-${kv}`}function ho({delta:r,layout:e,paneConstraints:t,pivotIndices:n,trigger:s}){if(An(r,0))return e;const i=[...e],[a,o]=n;let l=0;if(s==="keyboard"){{const u=r<0?o:a,d=t[u];if(rt(d),d.collapsible){const h=e[u];rt(h!=null);const f=t[u];rt(f);const{collapsedSize:p=0,minSize:m=0}=f;if(An(h,p)){const g=m-h;kl(g,Math.abs(r))>0&&(r=r<0?0-g:g)}}}{const u=r<0?a:o,d=t[u];rt(d);const{collapsible:h}=d;if(h){const f=e[u];rt(f!=null);const p=t[u];rt(p);const{collapsedSize:m=0,minSize:g=0}=p;if(An(f,g)){const b=f-m;kl(b,Math.abs(r))>0&&(r=r<0?0-b:b)}}}}{const u=r<0?1:-1;let d=r<0?o:a,h=0;for(;;){const p=e[d];rt(p!=null);const g=Qi({paneConstraints:t,paneIndex:d,initialSize:100})-p;if(h+=g,d+=u,d<0||d>=t.length)break}const f=Math.min(Math.abs(r),Math.abs(h));r=r<0?0-f:f}{let d=r<0?a:o;for(;d>=0&&d<t.length;){const h=Math.abs(r)-Math.abs(l),f=e[d];rt(f!=null);const p=f-h,m=Qi({paneConstraints:t,paneIndex:d,initialSize:p});if(!An(f,m)&&(l+=f-m,i[d]=m,l.toPrecision(3).localeCompare(Math.abs(r).toPrecision(3),void 0,{numeric:!0})>=0))break;r<0?d--:d++}}if(An(l,0))return e;{const u=r<0?o:a,d=e[u];rt(d!=null);const h=d+l,f=Qi({paneConstraints:t,paneIndex:u,initialSize:h});if(i[u]=f,!An(f,h)){let p=h-f,g=r<0?o:a;for(;g>=0&&g<t.length;){const b=i[g];rt(b!=null);const _=b+p,y=Qi({paneConstraints:t,paneIndex:g,initialSize:_});if(An(b,y)||(p-=y-b,i[g]=y),An(p,0))break;r>0?g--:g++}}}const c=i.reduce((u,d)=>d+u,0);return An(c,100)?i:e}let Pg=null,si=null;function x1(r){switch(r){case"horizontal":return"ew-resize";case"horizontal-max":return"w-resize";case"horizontal-min":return"e-resize";case"vertical":return"ns-resize";case"vertical-max":return"n-resize";case"vertical-min":return"s-resize"}}function TL(){si!==null&&(document.head.removeChild(si),Pg=null,si=null)}function Yf(r){if(Pg===r)return;Pg=r;const e=x1(r);si===null&&(si=document.createElement("style"),document.head.appendChild(si)),si.innerHTML=`*{cursor: ${e}!important;}`}function RL({defaultSize:r,dragState:e,layout:t,panesArray:n,paneIndex:s,precision:i=3}){const a=t[s];let o;return a==null?o=r??"1":n.length===1?o="1":o=a.toPrecision(i),{flexBasis:0,flexGrow:o,flexShrink:1,overflow:"hidden",pointerEvents:e!==null?"none":void 0}}function Sv(r){try{if(typeof localStorage>"u")throw new TypeError("localStorage is not supported in this environment");r.getItem=e=>localStorage.getItem(e),r.setItem=(e,t)=>localStorage.setItem(e,t)}catch(e){console.error(e),r.getItem=()=>null,r.setItem=()=>{}}}function k1(r){return`paneforge:${r}`}function S1(r){return r.map(t=>t.opts.order.current?`${t.opts.order.current}:${JSON.stringify(t.constraints)}`:JSON.stringify(t.constraints)).sort().join(",")}function P1(r,e){try{const t=k1(r),n=e.getItem(t),s=JSON.parse(n||"");if(typeof s=="object"&&s!==null)return s}catch{}return null}function IL(r,e,t){const n=P1(r,t)||{},s=S1(e);return n[s]||null}function CL(r,e,t,n,s){const i=k1(r),a=S1(e),o=P1(r,s)||{};o[a]={expandToSizes:Object.fromEntries(t.entries()),layout:n};try{s.setItem(i,JSON.stringify(o))}catch(l){console.error(l)}}const Pv={};function $L(r,e=10){let t=null;return(...s)=>{t!==null&&clearTimeout(t),t=setTimeout(()=>{r(...s)},e)}}function ML({autoSaveId:r,layout:e,storage:t,panesArray:n,paneSizeBeforeCollapse:s}){if(e.length===0||e.length!==n.length)return;let i=Pv[r];i==null&&(i=$L(CL,yL),Pv[r]=i);const a=[...n],o=new Map(s);i(r,a,o,e,t)}const jo={getItem:r=>(Sv(jo),jo.getItem(r)),setItem:(r,e)=>{Sv(jo),jo.setItem(r,e)}};var Vl,Gl,Zl,Jl,Kl,Xl,oh,Yl;class NL{constructor(e){M(this,"opts");ye(this,Vl,rn(null));ye(this,Gl,rn([]));ye(this,Zl,rn([]));ye(this,Jl,rn(!1));ye(this,Kl,rn(xh({})));M(this,"paneSizeBeforeCollapseMap",new Map);ye(this,Xl,rn(0));M(this,"setLayout",e=>{this.layout=e});M(this,"registerResizeHandle",e=>t=>{var g,b;t.preventDefault();const n=this.opts.direction.current,s=this.dragState,i=this.opts.id.current,a=this.opts.keyboardResizeBy.current,o=this.layout,l=this.panesArray,{initialLayout:c}=s??{},u=xv(i,e);let d=EL(t,e,n,s,a);if(d===0)return;const h=n==="horizontal";document.dir==="rtl"&&h&&(d=-d);const f=l.map(_=>_.constraints),p=ho({delta:d,layout:c??o,paneConstraints:f,pivotIndices:u,trigger:b1(t)?"keyboard":"mouse-or-touch"}),m=!co(o,p);(_1(t)||y1(t))&&this.prevDelta!==d&&(this.prevDelta=d,Yf(m?h?"horizontal":"vertical":h?d<0?"horizontal-min":"horizontal-max":d<0?"vertical-min":"vertical-max")),m&&(this.setLayout(p),(b=(g=this.opts.onLayout).current)==null||b.call(g,p),uo(l,p,this.paneIdToLastNotifiedSizeMap))});M(this,"resizePane",(e,t)=>{var d,h;const n=this.layout,s=this.panesArray,i=s.map(f=>f.constraints),{paneSize:a,pivotIndices:o}=Di(s,e,n);rt(a!=null);const c=Gi(s,e)===s.length-1?a-t:t-a,u=ho({delta:c,layout:n,paneConstraints:i,pivotIndices:o,trigger:"imperative-api"});co(n,u)||(this.setLayout(u),(h=(d=this.opts.onLayout).current)==null||h.call(d,u),uo(s,u,this.paneIdToLastNotifiedSizeMap))});M(this,"startDragging",(e,t)=>{const n=this.opts.direction.current,s=this.layout,i=Zb(e);rt(i);const a=v1(n,t);this.dragState={dragHandleId:e,dragHandleRect:i.getBoundingClientRect(),initialCursorPosition:a,initialLayout:s}});M(this,"stopDragging",()=>{TL(),this.dragState=null});M(this,"isPaneCollapsed",e=>{const t=this.panesArray,n=this.layout,{collapsedSize:s=0,collapsible:i,paneSize:a}=Di(t,e,n);return i===!0&&a===s});M(this,"expandPane",e=>{var p,m;const t=this.layout,n=this.panesArray;if(!e.constraints.collapsible)return;const s=n.map(g=>g.constraints),{collapsedSize:i=0,paneSize:a,minSize:o=0,pivotIndices:l}=Di(n,e,t);if(a!==i)return;const c=this.paneSizeBeforeCollapseMap.get(e.opts.id.current),u=c!=null&&c>=o?c:o,h=Gi(n,e)===n.length-1?a-u:u-a,f=ho({delta:h,layout:t,paneConstraints:s,pivotIndices:l,trigger:"imperative-api"});co(t,f)||(this.setLayout(f),(m=(p=this.opts.onLayout).current)==null||m.call(p,f),uo(n,f,this.paneIdToLastNotifiedSizeMap))});M(this,"collapsePane",e=>{var d,h;const t=this.layout,n=this.panesArray;if(!e.constraints.collapsible)return;const s=n.map(f=>f.constraints),{collapsedSize:i=0,paneSize:a,pivotIndices:o}=Di(n,e,t);if(rt(a!=null),a===i)return;this.paneSizeBeforeCollapseMap.set(e.opts.id.current,a);const c=Gi(n,e)===n.length-1?a-i:i-a,u=ho({delta:c,layout:t,paneConstraints:s,pivotIndices:o,trigger:"imperative-api"});co(t,u)||(this.layout=u,(h=(d=this.opts.onLayout).current)==null||h.call(d,u),uo(n,u,this.paneIdToLastNotifiedSizeMap))});M(this,"getPaneSize",e=>Di(this.panesArray,e,this.layout).paneSize);M(this,"getPaneStyle",(e,t)=>{const n=this.panesArray,s=this.layout,i=this.dragState,a=Gi(n,e);return RL({defaultSize:t,dragState:i,layout:s,panesArray:n,paneIndex:a})});M(this,"isPaneExpanded",e=>{const{collapsedSize:t=0,collapsible:n,paneSize:s}=Di(this.panesArray,e,this.layout);return!n||s>t});M(this,"registerPane",e=>{const t=[...this.panesArray,e];return t.sort((n,s)=>{const i=n.opts.order.current,a=s.opts.order.current;return i==null&&a==null?0:i==null?-1:a==null?1:i-a}),this.panesArray=t,this.panesArrayChanged=!0,()=>{const n=[...this.panesArray],s=Gi(this.panesArray,e);s<0||(n.splice(s,1),this.panesArray=n,delete this.paneIdToLastNotifiedSizeMap[e.opts.id.current],this.panesArrayChanged=!0)}});ye(this,oh,()=>{const e=this.opts.id.current,t=bc(e),n=this.panesArray,s=t.map(i=>{const a=i.getAttribute("data-pane-resizer-id");if(!a)return di;const[o,l]=OL(e,a,n);if(o==null||l==null)return di;const u=iL(i,"keydown",d=>{if(d.defaultPrevented||d.key!=="Enter")return;d.preventDefault();const h=this.panesArray,f=h.findIndex(v=>v.opts.id.current===o);if(f<0)return;const p=h[f];rt(p);const m=this.layout,g=m[f],{collapsedSize:b=0,collapsible:_,minSize:y=0}=p.constraints;if(!(g!=null&&_))return;const w=ho({delta:An(g,b)?y-g:b-g,layout:m,paneConstraints:h.map(v=>v.constraints),pivotIndices:xv(e,a),trigger:"keyboard"});m!==w&&(this.layout=w)});return()=>{u()}});return()=>{for(const i of s)i()}});ye(this,Yl,ze(()=>({id:this.opts.id.current,"data-pane-group":"","data-direction":this.opts.direction.current,"data-pane-group-id":this.opts.id.current,style:{display:"flex",flexDirection:this.opts.direction.current==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"}})));this.opts=e,Oi(e),As([()=>this.opts.id.current,()=>this.layout,()=>this.panesArray],()=>xL({groupId:this.opts.id.current,layout:this.layout,panesArray:this.panesArray})),Os(()=>vh(()=>F(this,oh).call(this))),As([()=>this.opts.autoSaveId.current,()=>this.layout,()=>this.opts.storage.current],()=>{this.opts.autoSaveId.current&&ML({autoSaveId:this.opts.autoSaveId.current,layout:this.layout,storage:this.opts.storage.current,panesArray:this.panesArray,paneSizeBeforeCollapse:this.paneSizeBeforeCollapseMap})}),As(()=>this.panesArrayChanged,()=>{var i,a;if(!this.panesArrayChanged)return;this.panesArrayChanged=!1;const t=this.layout;let n=null;if(this.opts.autoSaveId.current){const o=IL(this.opts.autoSaveId.current,this.panesArray,this.opts.storage.current);o&&(this.paneSizeBeforeCollapseMap=new Map(Object.entries(o.expandToSizes)),n=o.layout)}n==null&&(n=kL({panesArray:this.panesArray}));const s=SL({layout:n,paneConstraints:this.panesArray.map(o=>o.constraints)});co(t,s)||(this.layout=s,(a=(i=this.opts.onLayout).current)==null||a.call(i,s),uo(this.panesArray,s,this.paneIdToLastNotifiedSizeMap))})}get dragState(){return A(F(this,Vl))}set dragState(e){de(F(this,Vl),e)}get layout(){return A(F(this,Gl))}set layout(e){de(F(this,Gl),e)}get panesArray(){return A(F(this,Zl))}set panesArray(e){de(F(this,Zl),e)}get panesArrayChanged(){return A(F(this,Jl))}set panesArrayChanged(e){de(F(this,Jl),e,!0)}get paneIdToLastNotifiedSizeMap(){return A(F(this,Kl))}set paneIdToLastNotifiedSizeMap(e){de(F(this,Kl),e,!0)}get prevDelta(){return A(F(this,Xl))}set prevDelta(e){de(F(this,Xl),e,!0)}get props(){return A(F(this,Yl))}set props(e){de(F(this,Yl),e)}}Vl=new WeakMap,Gl=new WeakMap,Zl=new WeakMap,Jl=new WeakMap,Kl=new WeakMap,Xl=new WeakMap,oh=new WeakMap,Yl=new WeakMap;const LL=["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","End","Home"];var Ql,ya,ec,wa,lh,ch,uh,dh,hh,fh,ph,mh,tc;class jL{constructor(e,t){M(this,"opts");M(this,"group");ye(this,Ql,ze(()=>{var e;return((e=this.group.dragState)==null?void 0:e.dragHandleId)===this.opts.id.current}));ye(this,ya,rn(!1));M(this,"resizeHandler",null);ye(this,ec,e=>{e.preventDefault(),!this.opts.disabled.current&&(this.group.startDragging(this.opts.id.current,e),this.opts.onDraggingChange.current(!0))});ye(this,wa,()=>{const e=this.opts.ref.current;e&&(e.blur(),this.group.stopDragging(),this.opts.onDraggingChange.current(!1))});ye(this,lh,e=>{if(this.opts.disabled.current||!this.resizeHandler||e.defaultPrevented)return;if(LL.includes(e.key)){e.preventDefault(),this.resizeHandler(e);return}if(e.key!=="F6")return;e.preventDefault();const t=bc(this.group.opts.id.current),n=w1(this.group.opts.id.current,this.opts.id.current);if(n===null)return;let s=0;e.shiftKey?n>0?s=n-1:s=t.length-1:n+1<t.length?s=n+1:s=0,t[s].focus()});ye(this,ch,()=>{de(F(this,ya),!1)});ye(this,uh,()=>{de(F(this,ya),!0)});ye(this,dh,e=>{F(this,ec).call(this,e)});ye(this,hh,()=>{F(this,wa).call(this)});ye(this,fh,()=>{F(this,wa).call(this)});ye(this,ph,()=>{F(this,wa).call(this)});ye(this,mh,e=>{F(this,ec).call(this,e)});ye(this,tc,ze(()=>({id:this.opts.id.current,role:"separator","data-direction":this.group.opts.direction.current,"data-pane-group-id":this.group.opts.id.current,"data-active":A(F(this,Ql))?"pointer":A(F(this,ya))?"keyboard":void 0,"data-enabled":!this.opts.disabled.current,"data-pane-resizer-id":this.opts.id.current,"data-pane-resizer":"",tabIndex:this.opts.tabIndex.current,style:{cursor:x1(this.group.opts.direction.current),touchAction:"none",userSelect:"none","-webkit-user-select":"none","-webkit-touch-callout":"none"},onkeydown:F(this,lh),onblur:F(this,ch),onfocus:F(this,uh),onmousedown:F(this,dh),onmouseup:F(this,hh),ontouchcancel:F(this,fh),ontouchend:F(this,ph),ontouchstart:F(this,mh)})));this.opts=e,this.group=t,Oi(e),Os(()=>{this.opts.disabled.current?this.resizeHandler=null:this.resizeHandler=this.group.registerResizeHandle(this.opts.id.current)}),Os(()=>{const n=this.opts.ref.current;if(!n)return;const s=this.opts.disabled.current,i=this.resizeHandler,a=A(F(this,Ql));if(s||i===null||!a)return;const o=u=>{i(u)},l=u=>{i(u)},c=()=>{n.blur(),this.group.stopDragging(),this.opts.onDraggingChange.current(!1)};return f1(ms(document.body,"contextmenu",c),ms(document.body,"mousemove",o),ms(document.body,"touchmove",o,{passive:!1}),ms(document.body,"mouseleave",l),ms(window,"mouseup",c),ms(window,"touchend",c))})}get props(){return A(F(this,tc))}set props(e){de(F(this,tc),e)}}Ql=new WeakMap,ya=new WeakMap,ec=new WeakMap,wa=new WeakMap,lh=new WeakMap,ch=new WeakMap,uh=new WeakMap,dh=new WeakMap,hh=new WeakMap,fh=new WeakMap,ph=new WeakMap,mh=new WeakMap,tc=new WeakMap;var Jr,nc,rc,sc,va,gh,ic;class DL{constructor(e,t){M(this,"opts");M(this,"group");ye(this,Jr,rn(""));ye(this,nc,ze(()=>({onCollapse:this.opts.onCollapse.current,onExpand:this.opts.onExpand.current,onResize:this.opts.onResize.current})));ye(this,rc,ze(()=>({collapsedSize:this.opts.collapsedSize.current,collapsible:this.opts.collapsible.current,defaultSize:this.opts.defaultSize.current,maxSize:this.opts.maxSize.current,minSize:this.opts.minSize.current})));ye(this,sc,e=>{de(F(this,Jr),e,!0),bL(()=>{if(this.opts.ref.current){const t=this.opts.ref.current;if(!(getComputedStyle(t).transitionDuration!=="0s")){de(F(this,Jr),"");return}const i=a=>{a.propertyName==="flex-grow"&&(de(F(this,Jr),""),t.removeEventListener("transitionend",i))};t.addEventListener("transitionend",i)}else de(F(this,Jr),"")})});M(this,"pane",{collapse:()=>{F(this,sc).call(this,"collapsing"),this.group.collapsePane(this)},expand:()=>{F(this,sc).call(this,"expanding"),this.group.expandPane(this)},getSize:()=>this.group.getPaneSize(this),isCollapsed:()=>this.group.isPaneCollapsed(this),isExpanded:()=>this.group.isPaneExpanded(this),resize:e=>this.group.resizePane(this,e),getId:()=>this.opts.id.current});ye(this,va,ze(()=>this.group.isPaneCollapsed(this)));ye(this,gh,ze(()=>A(F(this,Jr))!==""?A(F(this,Jr)):A(F(this,va))?"collapsed":"expanded"));ye(this,ic,ze(()=>({id:this.opts.id.current,style:this.group.getPaneStyle(this,this.opts.defaultSize.current),"data-pane":"","data-pane-id":this.opts.id.current,"data-pane-group-id":this.group.opts.id.current,"data-collapsed":A(F(this,va))?"":void 0,"data-expanded":A(F(this,va))?void 0:"","data-pane-state":A(F(this,gh))})));this.opts=e,this.group=t,Oi(e),Tk(()=>this.group.registerPane(this)),As(()=>xO(this.constraints),()=>{this.group.panesArrayChanged=!0})}get callbacks(){return A(F(this,nc))}set callbacks(e){de(F(this,nc),e)}get constraints(){return A(F(this,rc))}set constraints(e){de(F(this,rc),e)}get props(){return A(F(this,ic))}set props(e){de(F(this,ic),e)}}Jr=new WeakMap,nc=new WeakMap,rc=new WeakMap,sc=new WeakMap,va=new WeakMap,gh=new WeakMap,ic=new WeakMap;const Jb=new g1("PaneGroup");function FL(r){return Jb.set(new NL(r))}function zL(r){return new jL(r,Jb.get())}function BL(r){return new DL(r,Jb.get())}var UL=pe("<div><!></div>");function qL(r,e){at(e,!0);let t=se(e,"autoSaveId",3,null),n=se(e,"id",19,Ed),s=se(e,"keyboardResizeBy",3,null),i=se(e,"onLayoutChange",3,di),a=se(e,"storage",3,jo),o=se(e,"ref",15,null),l=Tt(e,["$$slots","$$events","$$legacy","autoSaveId","direction","id","keyboardResizeBy","onLayoutChange","storage","ref","child","children"]);const c=FL({id:me.with(()=>n()??Ed()),ref:me.with(()=>o(),_=>o(_)),autoSaveId:me.with(()=>t()),direction:me.with(()=>e.direction),keyboardResizeBy:me.with(()=>s()),onLayout:me.with(()=>i()),storage:me.with(()=>a())}),u=()=>c.layout,d=c.setLayout,h=()=>c.opts.id.current,f=ze(()=>Ei(l,c.props));var p=Fe(),m=ke(p);{var g=_=>{var y=Fe(),w=ke(y);kt(w,()=>e.child,()=>({props:A(f)})),q(_,y)},b=_=>{var y=UL();let w;var v=B(y);kt(v,()=>e.children??Rn),z(y),Ue(()=>w=jt(y,w,{...A(f)})),q(_,y)};Qe(m,_=>{e.child?_(g):_(b,!1)})}return q(r,p),ot({getLayout:u,setLayout:d,getId:h})}var HL=pe("<div><!></div>");function Od(r,e){at(e,!0);let t=se(e,"id",19,Ed),n=se(e,"ref",15,null),s=se(e,"onCollapse",3,di),i=se(e,"onExpand",3,di),a=se(e,"onResize",3,di),o=Tt(e,["$$slots","$$events","$$legacy","id","ref","collapsedSize","collapsible","defaultSize","maxSize","minSize","onCollapse","onExpand","onResize","order","child","children"]);const l=BL({id:me.with(()=>t()),ref:me.with(()=>n(),v=>n(v)),collapsedSize:me.with(()=>e.collapsedSize),collapsible:me.with(()=>e.collapsible),defaultSize:me.with(()=>e.defaultSize),maxSize:me.with(()=>e.maxSize),minSize:me.with(()=>e.minSize),onCollapse:me.with(()=>s()),onExpand:me.with(()=>i()),onResize:me.with(()=>a()),order:me.with(()=>e.order)}),c=l.pane.collapse,u=l.pane.expand,d=l.pane.getSize,h=l.pane.isCollapsed,f=l.pane.isExpanded,p=l.pane.resize,m=l.pane.getId,g=ze(()=>Ei(o,l.props));var b=Fe(),_=ke(b);{var y=v=>{var x=Fe(),S=ke(x);kt(S,()=>e.child,()=>({props:A(g)})),q(v,x)},w=v=>{var x=HL();let S;var k=B(x);kt(k,()=>e.children??Rn),z(x),Ue(()=>S=jt(x,S,{...A(g)})),q(v,x)};Qe(_,v=>{e.child?v(y):v(w,!1)})}return q(r,b),ot({collapse:c,expand:u,getSize:d,isCollapsed:h,isExpanded:f,resize:p,getId:m})}var WL=pe("<div><!></div>");function VL(r,e){at(e,!0);let t=se(e,"id",19,Ed),n=se(e,"ref",15,null),s=se(e,"disabled",3,!1),i=se(e,"onDraggingChange",3,di),a=se(e,"tabindex",3,0),o=Tt(e,["$$slots","$$events","$$legacy","id","ref","disabled","onDraggingChange","tabindex","child","children"]);const l=zL({id:me.with(()=>t()),ref:me.with(()=>n(),p=>n(p)),disabled:me.with(()=>s()),onDraggingChange:me.with(()=>i()),tabIndex:me.with(()=>a())}),c=ze(()=>Ei(o,l.props));var u=Fe(),d=ke(u);{var h=p=>{var m=Fe(),g=ke(m);kt(g,()=>e.child,()=>({props:A(c)})),q(p,m)},f=p=>{var m=WL();let g;var b=B(m);kt(b,()=>e.children??Rn),z(m),Ue(()=>g=jt(m,g,{...A(c)})),q(p,m)};Qe(d,p=>{e.child?p(h):p(f,!1)})}q(r,u),ot()}/**
 * @license @lucide/svelte v0.488.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const GL={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var ZL=_k("<svg><!><!></svg>");function JL(r,e){at(e,!0);const t=se(e,"color",3,"currentColor"),n=se(e,"size",3,24),s=se(e,"strokeWidth",3,2),i=se(e,"absoluteStrokeWidth",3,!1),a=se(e,"iconNode",19,()=>[]),o=Tt(e,["$$slots","$$events","$$legacy","name","color","size","strokeWidth","absoluteStrokeWidth","iconNode","children"]);var l=ZL();let c;var u=B(l);jn(u,17,a,Er,(h,f)=>{let p=()=>A(f)[0],m=()=>A(f)[1];var g=Fe(),b=ke(g);Ik(b,p,!0,(_,y)=>{let w;Ue(()=>w=jt(_,w,{...m()}))}),q(h,g)});var d=V(u);kt(d,()=>e.children??Rn),z(l),Ue(h=>c=jt(l,c,{...GL,...o,width:n(),height:n(),stroke:t(),"stroke-width":h,class:["lucide-icon lucide",e.name&&`lucide-${e.name}`,e.class]}),[()=>i()?Number(s())*24/Number(n()):s()]),q(r,l),ot()}function KL(r,e){at(e,!0);let t=Tt(e,["$$slots","$$events","$$legacy"]);JL(r,Ir({name:"grip-vertical"},()=>t,{iconNode:[["circle",{cx:"9",cy:"12",r:"1"}],["circle",{cx:"9",cy:"5",r:"1"}],["circle",{cx:"9",cy:"19",r:"1"}],["circle",{cx:"15",cy:"12",r:"1"}],["circle",{cx:"15",cy:"5",r:"1"}],["circle",{cx:"15",cy:"19",r:"1"}]],children:(s,i)=>{var a=Fe(),o=ke(a);kt(o,()=>e.children??Rn),q(s,a)},$$slots:{default:!0}})),ot()}var XL=pe('<div class="bg-border z-10 flex h-4 w-3 items-center justify-center rounded-sm border"><!></div>');function A1(r,e){at(e,!0);let t=se(e,"ref",15,null),n=se(e,"withHandle",3,!1),s=Tt(e,["$$slots","$$events","$$legacy","ref","class","withHandle"]);var i=Fe(),a=ke(i);const o=ze(()=>zn("bg-border focus-visible:ring-ring relative flex w-px items-center justify-center after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-offset-1 data-[direction=vertical]:h-px data-[direction=vertical]:w-full data-[direction=vertical]:after:left-0 data-[direction=vertical]:after:h-1 data-[direction=vertical]:after:w-full data-[direction=vertical]:after:-translate-y-1/2 data-[direction=vertical]:after:translate-x-0 [&[data-direction=vertical]>div]:rotate-90",e.class));fc(a,()=>VL,(l,c)=>{c(l,Ir({get class(){return A(o)}},()=>s,{get ref(){return t()},set ref(u){t(u)},children:(u,d)=>{var h=Fe(),f=ke(h);{var p=m=>{var g=XL(),b=B(g);KL(b,{class:"size-2.5"}),z(g),q(m,g)};Qe(f,m=>{n()&&m(p)})}q(u,h)},$$slots:{default:!0}}))}),q(r,i),ot()}function E1(r,e){at(e,!0),se(e,"ref",11,null);let t=se(e,"this",15),n=Tt(e,["$$slots","$$events","$$legacy","ref","this","class"]);var s=Fe(),i=ke(s);const a=ze(()=>zn("flex h-full w-full data-[direction=vertical]:flex-col",e.class));fc(i,()=>qL,(o,l)=>{es(l(o,Ir({get class(){return A(a)}},()=>n)),c=>t(c),()=>t())}),q(r,s),ot()}var YL=pe('<div class="text-center py-8 text-muted-foreground"><p>æ²¡æå¯ç¨çééãè¯·åçæä¸ä¸ªä¿¡å·ã</p></div>'),QL=pe('<div role="button" tabindex="0"><div class="flex justify-between items-center mb-2"><h3 class="text-sm"> </h3> <button class="h-8 w-8 flex items-center justify-center rounded-full text-destructive hover:bg-destructive/10"><span class="text-xl">Ã</span></button></div> <div class="h-8"><canvas></canvas></div></div>'),e2=pe('<div class="box"></div>'),t2=pe('<div class="space-y-1 col-span-2"><div class="text-xs text-muted-foreground">æºéé</div> <div class="text-sm"></div></div>'),n2=pe('<div class="space-y-1 col-span-2"><div class="text-xs text-muted-foreground">å¤çæ¹æ³</div> <div class="text-sm"> </div></div> <!>',1),r2=pe('<h3 class="text-lg font-semibold mb-4"> </h3> <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4"><div class="space-y-1"><div class="text-xs text-muted-foreground">ID</div> <div class="text-sm font-medium truncate"> </div></div> <div class="space-y-1"><div class="text-xs text-muted-foreground">åå»ºæ¶é´</div> <div class="text-sm"> </div></div> <div class="space-y-1"><div class="text-xs text-muted-foreground">æ´æ°æ¶é´</div> <div class="text-sm"> </div></div> <div class="space-y-1"><div class="text-xs text-muted-foreground">éæ ·ç</div> <div class="text-sm"> </div></div> <div class="space-y-1"><div class="text-xs text-muted-foreground">Length</div> <div class="text-sm"> </div></div> <div class="space-y-1"><div class="text-xs text-muted-foreground">Duration</div> <div class="text-sm"> </div></div> <div class="space-y-1"><div class="text-xs text-muted-foreground">æå°å¼/æå¤§å¼</div> <div class="text-sm"> </div></div> <div class="space-y-1"><div class="text-xs text-muted-foreground">å¹³åå¼/åæ¹æ ¹</div> <div class="text-sm"> </div></div> <!></div> <div class="h-64 mt-4"><canvas id="detail-chart"></canvas></div>',1),s2=pe('<div class="text-center py-8 text-muted-foreground"><p>è¯·éæ©ä¸ä¸ªééä»¥æ¥çè¯¦æã</p></div>'),i2=pe("<!> <!> <!>",1),a2=pe('<div class="box-fill"><!></div>');function o2(r,e){at(e,!1);const[t,n]=Sh(),s=()=>Ph(Na,"$channels",t);let i=se(e,"selectedChannelId",12,null),a={};wO(()=>{s().length>0&&o()}),Tk(()=>()=>{Object.values(a).forEach(g=>g.destroy())});function o(){if(s().forEach(g=>{const b=`chart-${g.id}`,_=document.getElementById(b);if(_){a[b]&&a[b].destroy();const y=_.getContext("2d");a[b]=l(y,g,!1)}}),i()){const g=s().find(b=>b.id===i());if(g){const b="detail-chart",_=document.getElementById(b);if(_){a[b]&&a[b].destroy();const y=_.getContext("2d");a[b]=l(y,g,!0)}}}}function l(g,b,_=!1){const y=b.data,w=Array.from({length:y.length},(x,S)=>S),v=b.processingMethod==="calculateFFT"||b.processingMethod==="calculatePowerSpectrum";return new Wr(g,{type:v?"bar":"line",data:{labels:w,datasets:[{label:b.name,data:y,borderColor:"rgb(75, 192, 192)",backgroundColor:"rgba(75, 192, 192, 0.2)",borderWidth:1,pointRadius:_?1:0}]},options:{responsive:!0,maintainAspectRatio:!1,animation:!1,scales:{x:{title:{display:_,text:v?"é¢ç (Hz)":"æ ·æ¬"},display:_},y:{title:{display:_,text:"å¹åº¦"},display:_}},plugins:{legend:{display:_},tooltip:{enabled:_}}}})}function c(g){i(g),setTimeout(o,0)}function u(g){confirm("æ¨ç¡®å®è¦å é¤æ­¤ééåï¼")&&(jO(g),i()===g&&i(null))}function d(g){return new Date(g).toLocaleString()}kh();var h=a2(),f=B(h);{var p=g=>{var b=YL();q(g,b)},m=g=>{E1(g,{direction:"horizontal",class:"box-fill",children:(b,_)=>{var y=i2(),w=ke(y);Od(w,{class:"box-scroll h-full",minSize:20,children:(S,k)=>{var R=e2();jn(R,5,s,D=>D.id,(D,C)=>{var N=QL(),$=B(N),P=B($),E=B(P,!0);z(P);var O=V(P,2);z($);var I=V($,2),T=B(I);z(I),z(N),Ue(()=>{vb(N,1,`p-2 ${i()===A(C).id?"bg-primary/5":""} cursor-pointer hover:bg-accent/50 transition-colors border-b`),li(N,"aria-pressed",i()===A(C).id),yt(E,A(C).name),li(O,"aria-label",`Delete channel ${A(C).name??""}`),li(T,"id",`chart-${A(C).id}`)}),la("click",O,j=>{j.stopPropagation(),u(A(C).id)}),la("click",N,()=>c(A(C).id)),la("keydown",N,j=>j.key==="Enter"&&c(A(C).id)),q(D,N)}),z(R),q(S,R)},$$slots:{default:!0}});var v=V(w,2);A1(v,{withHandle:!0});var x=V(v,2);Od(x,{class:"box-scroll h-full p-4",minSize:20,children:(S,k)=>{var R=Fe(),D=ke(R);{var C=$=>{var P=Fe(),E=ke(P);jn(E,1,s,O=>O.id,(O,I)=>{var T=Fe(),j=ke(T);{var W=ee=>{var Z=r2(),X=ke(Z),U=B(X);z(X);var G=V(X,2),le=B(G),he=V(B(le),2),Dt=B(he,!0);z(he),z(le);var vt=V(le,2),lt=V(B(vt),2),_t=B(lt,!0);z(lt),z(vt);var Ut=V(vt,2),hr=V(B(Ut),2),dn=B(hr,!0);z(hr),z(Ut);var qt=V(Ut,2),Cn=V(B(qt),2),Ci=B(Cn);z(Cn),z(qt);var ss=V(qt,2),jc=V(B(ss),2),Y=B(jc);z(jc),z(ss);var is=V(ss,2),ge=V(B(is),2),ce=B(ge);z(ge),z(is);var we=V(is,2),te=V(B(we),2),J=B(te);z(te),z(we);var be=V(we,2),_e=V(B(be),2),Ht=B(_e);z(_e),z(be);var Dc=V(be,2);{var Fc=Ka=>{var zc=n2(),Xa=ke(zc),Bc=V(B(Xa),2),gf=B(Bc,!0);z(Bc),z(Xa);var bf=V(Xa,2);{var _f=Ya=>{var yf=t2(),my=V(B(yf),2);jn(my,5,()=>A(I).sourceChannelIds,Er,(OE,TE)=>{var gy=Fe(),RE=ke(gy);jn(RE,1,s,Er,(IE,by)=>{var _y=Fe(),CE=ke(_y);{var $E=wf=>{var yy=ni();Ue(()=>yt(yy,A(by).name)),q(wf,yy)};Qe(CE,wf=>{A(by).id===A(TE)&&wf($E)})}q(IE,_y)}),q(OE,gy)}),z(my),z(yf),q(Ya,yf)};Qe(bf,Ya=>{A(I).sourceChannelIds.length>0&&Ya(_f)})}Ue(()=>yt(gf,A(I).processingMethod)),q(Ka,zc)};Qe(Dc,Ka=>{A(I).processingMethod&&Ka(Fc)})}z(G),Jn(2),Ue((Ka,zc,Xa,Bc,gf,bf,_f,Ya)=>{yt(U,`${A(I).name??""} è¯¦æ`),yt(Dt,A(I).id),yt(_t,Ka),yt(dn,zc),yt(Ci,`${A(I).sampleRate??""} Hz`),yt(Y,`${Xa??""} ä¸ªæ ·æ¬`),yt(ce,`${Bc??""} s`),yt(J,`${gf??""} / ${bf??""}`),yt(Ht,`${_f??""} / ${Ya??""}`)},[()=>d(A(I).createdAt),()=>d(A(I).updatedAt),()=>A(I).getStats().length,()=>A(I).getStats().duration.toFixed(3),()=>A(I).getStats().min.toFixed(3),()=>A(I).getStats().max.toFixed(3),()=>A(I).getStats().mean.toFixed(3),()=>A(I).getStats().rms.toFixed(3)],hc),q(ee,Z)};Qe(j,ee=>{A(I).id===i()&&ee(W)})}q(O,T)}),q($,P)},N=$=>{var P=s2();q($,P)};Qe(D,$=>{i()?$(C):$(N,!1)})}q(S,R)},$$slots:{default:!0}}),q(b,y)},$$slots:{default:!0}})};Qe(f,g=>{s().length===0?g(p):g(m,!1)})}z(h),q(r,h),ot(),n()}const Ag="RFC3986",Eg={RFC1738:r=>String(r).replace(/%20/g,"+"),RFC3986:r=>String(r)},l2="RFC1738",c2=Array.isArray,fr=(()=>{const r=[];for(let e=0;e<256;++e)r.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return r})(),Qf=1024,u2=(r,e,t,n,s)=>{if(r.length===0)return r;let i=r;if(typeof r=="symbol"?i=Symbol.prototype.toString.call(r):typeof r!="string"&&(i=String(r)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let a="";for(let o=0;o<i.length;o+=Qf){const l=i.length>=Qf?i.slice(o,o+Qf):i,c=[];for(let u=0;u<l.length;++u){let d=l.charCodeAt(u);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||s===l2&&(d===40||d===41)){c[c.length]=l.charAt(u);continue}if(d<128){c[c.length]=fr[d];continue}if(d<2048){c[c.length]=fr[192|d>>6]+fr[128|d&63];continue}if(d<55296||d>=57344){c[c.length]=fr[224|d>>12]+fr[128|d>>6&63]+fr[128|d&63];continue}u+=1,d=65536+((d&1023)<<10|l.charCodeAt(u)&1023),c[c.length]=fr[240|d>>18]+fr[128|d>>12&63]+fr[128|d>>6&63]+fr[128|d&63]}a+=c.join("")}return a};function d2(r){return!r||typeof r!="object"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))}function Av(r,e){if(c2(r)){const t=[];for(let n=0;n<r.length;n+=1)t.push(e(r[n]));return t}return e(r)}const h2=Object.prototype.hasOwnProperty,O1={brackets(r){return String(r)+"[]"},comma:"comma",indices(r,e){return String(r)+"["+e+"]"},repeat(r){return String(r)}},_r=Array.isArray,f2=Array.prototype.push,T1=function(r,e){f2.apply(r,_r(e)?e:[e])},p2=Date.prototype.toISOString,At={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:u2,encodeValuesOnly:!1,format:Ag,formatter:Eg[Ag],indices:!1,serializeDate(r){return p2.call(r)},skipNulls:!1,strictNullHandling:!1};function m2(r){return typeof r=="string"||typeof r=="number"||typeof r=="boolean"||typeof r=="symbol"||typeof r=="bigint"}const ep={};function R1(r,e,t,n,s,i,a,o,l,c,u,d,h,f,p,m,g,b){let _=r,y=b,w=0,v=!1;for(;(y=y.get(ep))!==void 0&&!v;){const D=y.get(r);if(w+=1,typeof D<"u"){if(D===w)throw new RangeError("Cyclic object value");v=!0}typeof y.get(ep)>"u"&&(w=0)}if(typeof c=="function"?_=c(e,_):_ instanceof Date?_=h==null?void 0:h(_):t==="comma"&&_r(_)&&(_=Av(_,function(D){return D instanceof Date?h==null?void 0:h(D):D})),_===null){if(i)return l&&!m?l(e,At.encoder,g,"key",f):e;_=""}if(m2(_)||d2(_)){if(l){const D=m?e:l(e,At.encoder,g,"key",f);return[(p==null?void 0:p(D))+"="+(p==null?void 0:p(l(_,At.encoder,g,"value",f)))]}return[(p==null?void 0:p(e))+"="+(p==null?void 0:p(String(_)))]}const x=[];if(typeof _>"u")return x;let S;if(t==="comma"&&_r(_))m&&l&&(_=Av(_,l)),S=[{value:_.length>0?_.join(",")||null:void 0}];else if(_r(c))S=c;else{const D=Object.keys(_);S=u?D.sort(u):D}const k=o?String(e).replace(/\./g,"%2E"):String(e),R=n&&_r(_)&&_.length===1?k+"[]":k;if(s&&_r(_)&&_.length===0)return R+"[]";for(let D=0;D<S.length;++D){const C=S[D],N=typeof C=="object"&&typeof C.value<"u"?C.value:_[C];if(a&&N===null)continue;const $=d&&o?C.replace(/\./g,"%2E"):C,P=_r(_)?typeof t=="function"?t(R,$):R:R+(d?"."+$:"["+$+"]");b.set(r,w);const E=new WeakMap;E.set(ep,b),T1(x,R1(N,P,t,n,s,i,a,o,t==="comma"&&m&&_r(_)?null:l,c,u,d,h,f,p,m,g,E))}return x}function g2(r=At){if(typeof r.allowEmptyArrays<"u"&&typeof r.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof r.encodeDotInKeys<"u"&&typeof r.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(r.encoder!==null&&typeof r.encoder<"u"&&typeof r.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=r.charset||At.charset;if(typeof r.charset<"u"&&r.charset!=="utf-8"&&r.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Ag;if(typeof r.format<"u"){if(!h2.call(Eg,r.format))throw new TypeError("Unknown format option provided.");t=r.format}const n=Eg[t];let s=At.filter;(typeof r.filter=="function"||_r(r.filter))&&(s=r.filter);let i;if(r.arrayFormat&&r.arrayFormat in O1?i=r.arrayFormat:"indices"in r?i=r.indices?"indices":"repeat":i=At.arrayFormat,"commaRoundTrip"in r&&typeof r.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a=typeof r.allowDots>"u"?r.encodeDotInKeys?!0:At.allowDots:!!r.allowDots;return{addQueryPrefix:typeof r.addQueryPrefix=="boolean"?r.addQueryPrefix:At.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof r.allowEmptyArrays=="boolean"?!!r.allowEmptyArrays:At.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof r.charsetSentinel=="boolean"?r.charsetSentinel:At.charsetSentinel,commaRoundTrip:!!r.commaRoundTrip,delimiter:typeof r.delimiter>"u"?At.delimiter:r.delimiter,encode:typeof r.encode=="boolean"?r.encode:At.encode,encodeDotInKeys:typeof r.encodeDotInKeys=="boolean"?r.encodeDotInKeys:At.encodeDotInKeys,encoder:typeof r.encoder=="function"?r.encoder:At.encoder,encodeValuesOnly:typeof r.encodeValuesOnly=="boolean"?r.encodeValuesOnly:At.encodeValuesOnly,filter:s,format:t,formatter:n,serializeDate:typeof r.serializeDate=="function"?r.serializeDate:At.serializeDate,skipNulls:typeof r.skipNulls=="boolean"?r.skipNulls:At.skipNulls,sort:typeof r.sort=="function"?r.sort:null,strictNullHandling:typeof r.strictNullHandling=="boolean"?r.strictNullHandling:At.strictNullHandling}}function b2(r,e={}){let t=r;const n=g2(e);let s,i;typeof n.filter=="function"?(i=n.filter,t=i("",t)):_r(n.filter)&&(i=n.filter,s=i);const a=[];if(typeof t!="object"||t===null)return"";const o=O1[n.arrayFormat],l=o==="comma"&&n.commaRoundTrip;s||(s=Object.keys(t)),n.sort&&s.sort(n.sort);const c=new WeakMap;for(let h=0;h<s.length;++h){const f=s[h];n.skipNulls&&t[f]===null||T1(a,R1(t[f],f,o,l,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,c))}const u=a.join(n.delimiter);let d=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),u.length>0?d+u:""}const Zi="4.95.0";let Ev=!1,tl,I1,C1,Og,$1,M1,N1,L1,j1;function _2(r,e={auto:!1}){if(Ev)throw new Error(`you must \`import 'openai/shims/${r.kind}'\` before importing anything else from openai`);if(tl)throw new Error(`can't \`import 'openai/shims/${r.kind}'\` after \`import 'openai/shims/${tl}'\``);Ev=e.auto,tl=r.kind,I1=r.fetch,C1=r.FormData,Og=r.File,$1=r.ReadableStream,M1=r.getMultipartRequestOptions,N1=r.getDefaultAgent,L1=r.fileFromPath,j1=r.isFsReadStream}let y2=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function w2({manuallyImported:r}={}){const e=r?"You may need to use polyfills":"Add one of these imports before your first `import â¦ from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,n,s,i;try{t=fetch,n=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new y2(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}const D1=()=>{tl||_2(w2(),{auto:!0})};D1();class ve extends Error{}let yn=class Tg extends ve{constructor(e,t,n,s){super(`${Tg.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"],this.error=t;const i=t;this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,n){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e||!s)return new $h({message:n,cause:Ig(t)});const i=t==null?void 0:t.error;return e===400?new F1(e,i,n,s):e===401?new z1(e,i,n,s):e===403?new B1(e,i,n,s):e===404?new U1(e,i,n,s):e===409?new q1(e,i,n,s):e===422?new H1(e,i,n,s):e===429?new W1(e,i,n,s):e>=500?new V1(e,i,n,s):new Tg(e,i,n,s)}},bn=class extends yn{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},$h=class extends yn{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},_c=class extends $h{constructor({message:e}={}){super({message:e??"Request timed out."})}},F1=class extends yn{},z1=class extends yn{},B1=class extends yn{},U1=class extends yn{},q1=class extends yn{},H1=class extends yn{},W1=class extends yn{},V1=class extends yn{};class G1 extends ve{constructor(){super("Could not parse response content as the length limit was reached")}}class Z1 extends ve{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var lu=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Ks=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},vn;let Mh=class{constructor(){vn.set(this,void 0),this.buffer=new Uint8Array,lu(this,vn,null,"f")}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e;let n=new Uint8Array(this.buffer.length+t.length);n.set(this.buffer),n.set(t,this.buffer.length),this.buffer=n;const s=[];let i;for(;(i=v2(this.buffer,Ks(this,vn,"f")))!=null;){if(i.carriage&&Ks(this,vn,"f")==null){lu(this,vn,i.index,"f");continue}if(Ks(this,vn,"f")!=null&&(i.index!==Ks(this,vn,"f")+1||i.carriage)){s.push(this.decodeText(this.buffer.slice(0,Ks(this,vn,"f")-1))),this.buffer=this.buffer.slice(Ks(this,vn,"f")),lu(this,vn,null,"f");continue}const a=Ks(this,vn,"f")!==null?i.preceding-1:i.preceding,o=this.decodeText(this.buffer.slice(0,a));s.push(o),this.buffer=this.buffer.slice(i.index),lu(this,vn,null,"f")}return s}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new ve(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new ve(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new ve("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}};vn=new WeakMap;Mh.NEWLINE_CHARS=new Set([`
`,"\r"]);Mh.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function v2(r,e){for(let s=e??0;s<r.length;s++){if(r[s]===10)return{preceding:s,index:s+1,carriage:!1};if(r[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function x2(r){for(let n=0;n<r.length-1;n++){if(r[n]===10&&r[n+1]===10||r[n]===13&&r[n+1]===13)return n+2;if(r[n]===13&&r[n+1]===10&&n+3<r.length&&r[n+2]===13&&r[n+3]===10)return n+4}return-1}function J1(r){if(r[Symbol.asyncIterator])return r;const e=r.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}let Sl=class Do{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;async function*s(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(const a of k2(e,t))if(!i){if(a.data.startsWith("[DONE]")){i=!0;continue}if(a.event===null||a.event.startsWith("response.")||a.event.startsWith("transcript.")){let o;try{o=JSON.parse(a.data)}catch(l){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),l}if(o&&o.error)throw new yn(void 0,o.error,void 0,sP(e.headers));yield o}else{let o;try{o=JSON.parse(a.data)}catch(l){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),l}if(a.event=="error")throw new yn(void 0,o.error,o.message,void 0);yield{event:a.event,data:o}}}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new Do(s,t)}static fromReadableStream(e,t){let n=!1;async function*s(){const a=new Mh,o=J1(e);for await(const l of o)for(const c of a.decode(l))yield c;for(const l of a.flush())yield l}async function*i(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(const o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new Do(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=n.next();e.push(a),t.push(a)}return i.shift()}});return[new Do(()=>s(e),this.controller),new Do(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new $1({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:a}=await t.next();if(a)return s.close();const o=n.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}};async function*k2(r,e){if(!r.body)throw e.abort(),new ve("Attempted to iterate over a response with no body");const t=new P2,n=new Mh,s=J1(r.body);for await(const i of S2(s))for(const a of n.decode(i)){const o=t.decode(a);o&&(yield o)}for(const i of n.flush()){const a=t.decode(i);a&&(yield a)}}async function*S2(r){let e=new Uint8Array;for await(const t of r){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+n.length);s.set(e),s.set(n,e.length),e=s;let i;for(;(i=x2(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}let P2=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=A2(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function A2(r,e){const t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}const K1=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function",X1=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&Nh(r),Nh=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",E2=r=>X1(r)||K1(r)||j1(r);async function Y1(r,e,t){var s;if(r=await r,X1(r))return r;if(K1(r)){const i=await r.blob();e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=Nh(i)?[await i.arrayBuffer()]:[i];return new Og(a,e,t)}const n=await O2(r);if(e||(e=R2(r)??"unknown_file"),!(t!=null&&t.type)){const i=(s=n[0])==null?void 0:s.type;typeof i=="string"&&(t={...t,type:i})}return new Og(n,e,t)}async function O2(r){var t;let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(Nh(r))e.push(await r.arrayBuffer());else if(I2(r))for await(const n of r)e.push(n);else throw new Error(`Unexpected data type: ${typeof r}; constructor: ${(t=r==null?void 0:r.constructor)==null?void 0:t.name}; props: ${T2(r)}`);return e}function T2(r){return`[${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}function R2(r){var e;return tp(r.name)||tp(r.filename)||((e=tp(r.path))==null?void 0:e.split(/[\\/]/).pop())}const tp=r=>{if(typeof r=="string")return r;if(typeof Buffer<"u"&&r instanceof Buffer)return String(r)},I2=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",Ov=r=>r&&typeof r=="object"&&r.body&&r[Symbol.toStringTag]==="MultipartBody",Ra=async r=>{const e=await C2(r.body);return M1(e,r)},C2=async r=>{const e=new C1;return await Promise.all(Object.entries(r||{}).map(([t,n])=>Rg(e,t,n))),e},Rg=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(E2(t)){const n=await Y1(t);r.append(e,n)}else if(Array.isArray(t))await Promise.all(t.map(n=>Rg(r,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,s])=>Rg(r,`${e}[${n}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var ua={},$2=function(r,e,t,n,s){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t},M2=function(r,e,t,n){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},cu;D1();async function Q1(r){var a;const{response:e}=r;if(r.options.stream)return Es("response",e.status,e.url,e.headers,e.body),r.options.__streamClass?r.options.__streamClass.fromSSEResponse(e,r.controller):Sl.fromSSEResponse(e,r.controller);if(e.status===204)return null;if(r.options.__binaryResponse)return e;const t=e.headers.get("content-type"),n=(a=t==null?void 0:t.split(";")[0])==null?void 0:a.trim();if((n==null?void 0:n.includes("application/json"))||(n==null?void 0:n.endsWith("+json"))){const o=await e.json();return Es("response",e.status,e.url,e.headers,o),eP(o,e)}const i=await e.text();return Es("response",e.status,e.url,e.headers,i),i}function eP(r,e){return!r||typeof r!="object"||Array.isArray(r)?r:Object.defineProperty(r,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}let tP=class nP extends Promise{constructor(e,t=Q1){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new nP(this.responsePromise,async t=>eP(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},N2=class{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=np("maxRetries",t),this.timeout=np("timeout",n),this.httpAgent=s,this.fetch=i??I1}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...z2(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${H2()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(async s=>{const i=s&&Nh(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var m;const n={...e},{method:s,path:i,query:a,headers:o={}}=n,l=ArrayBuffer.isView(n.body)||n.__binaryRequest&&typeof n.body=="string"?n.body:Ov(n.body)?n.body.body:n.body?JSON.stringify(n.body,null,2):null,c=this.calculateContentLength(l),u=this.buildURL(i,a);"timeout"in n&&np("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const d=n.httpAgent??this.httpAgent??N1(u),h=n.timeout+1e3;typeof((m=d==null?void 0:d.options)==null?void 0:m.timeout)=="number"&&h>(d.options.timeout??0)&&(d.options.timeout=h),this.idempotencyHeader&&s!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);const f=this.buildHeaders({options:n,headers:o,contentLength:c,retryCount:t});return{req:{method:s,...l&&{body:l},headers:f,...d&&{agent:d},signal:n.signal??null},url:u,timeout:n.timeout}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:s}){const i={};n&&(i["content-length"]=n);const a=this.defaultHeaders(e);return Cv(i,a),Cv(i,t),Ov(e.body)&&tl!=="node"&&delete i["content-type"],du(a,"x-stainless-retry-count")===void 0&&du(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),du(a,"x-stainless-timeout")===void 0&&du(t,"x-stainless-timeout")===void 0&&e.timeout&&(i["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,s){return yn.generate(e,t,n,s)}request(e,t=null){return new tP(this.makeRequest(e,t))}async makeRequest(e,t){var d,h;const n=await e,s=n.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(n);const{req:i,url:a,timeout:o}=this.buildRequest(n,{retryCount:s-t});if(await this.prepareRequest(i,{url:a,options:n}),Es("request",a,n,i.headers),(d=n.signal)!=null&&d.aborted)throw new bn;const l=new AbortController,c=await this.fetchWithTimeout(a,i,o,l).catch(Ig);if(c instanceof Error){if((h=n.signal)!=null&&h.aborted)throw new bn;if(t)return this.retryRequest(n,t);throw c.name==="AbortError"?new _c:new $h({cause:c})}const u=sP(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){const _=`retrying, ${t} attempts remaining`;return Es(`response (error; ${_})`,c.status,a,u),this.retryRequest(n,t,u)}const f=await c.text().catch(_=>Ig(_).message),p=B2(f),m=p?void 0:f;throw Es(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,a,u,m),this.makeStatusError(c.status,p,m,u)}return{response:c,options:n,controller:l}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new L2(this,n,e)}buildURL(e,t){const n=q2(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return iP(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new ve(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,s){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),n),l={signal:s.signal,...a};return l.method&&(l.method=l.method.toUpperCase()),this.fetch.call(void 0,e,l).finally(()=>{clearTimeout(o)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){let s;const i=n==null?void 0:n["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(s=o)}const a=n==null?void 0:n["retry-after"];if(a&&!s){const o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await yc(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Zi}`}},rP=class{constructor(e,t,n,s){cu.set(this,void 0),$2(this,cu,e),this.options=s,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new ve("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of n)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await M2(this,cu,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(cu=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}},L2=class extends tP{constructor(e,t,n){super(t,async s=>new n(e,s.response,await Q1(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}};const sP=r=>new Proxy(Object.fromEntries(r.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),j2={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},bt=r=>typeof r=="object"&&r!==null&&!iP(r)&&Object.keys(r).every(e=>aP(j2,e)),D2=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Zi,"X-Stainless-OS":Rv(Deno.build.os),"X-Stainless-Arch":Tv(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Zi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Zi,"X-Stainless-OS":Rv(process.platform),"X-Stainless-Arch":Tv(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const r=F2();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Zi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Zi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function F2(){if(typeof navigator>"u"||!navigator)return null;const r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of r){const n=t.exec(navigator.userAgent);if(n){const s=n[1]||0,i=n[2]||0,a=n[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const Tv=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",Rv=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown");let Iv;const z2=()=>Iv??(Iv=D2()),B2=r=>{try{return JSON.parse(r)}catch{return}},U2=/^[a-z][a-z0-9+.-]*:/i,q2=r=>U2.test(r),yc=r=>new Promise(e=>setTimeout(e,r)),np=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new ve(`${r} must be an integer`);if(e<0)throw new ve(`${r} must be a positive integer`);return e},Ig=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null)try{return new Error(JSON.stringify(r))}catch{}return new Error(r)},uu=r=>{var e,t,n,s;if(typeof process<"u")return((e=ua==null?void 0:ua[r])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(s=(n=(t=Deno.env)==null?void 0:t.get)==null?void 0:n.call(t,r))==null?void 0:s.trim()};function iP(r){if(!r)return!0;for(const e in r)return!1;return!0}function aP(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function Cv(r,e){for(const t in e){if(!aP(e,t))continue;const n=t.toLowerCase();if(!n)continue;const s=e[t];s===null?delete r[n]:s!==void 0&&(r[n]=s)}}const $v=new Set(["authorization","api-key"]);function Es(r,...e){if(typeof process<"u"&&(ua==null?void 0:ua.DEBUG)==="true"){const t=e.map(n=>{if(!n)return n;if(n.headers){const i={...n,headers:{...n.headers}};for(const a in n.headers)$v.has(a.toLowerCase())&&(i.headers[a]="REDACTED");return i}let s=null;for(const i in n)$v.has(i.toLowerCase())&&(s??(s={...n}),s[i]="REDACTED");return s??n});console.log(`OpenAI:DEBUG:${r}`,...t)}}const H2=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)}),W2=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",V2=r=>typeof(r==null?void 0:r.get)=="function",du=(r,e)=>{var n;const t=e.toLowerCase();if(V2(r)){const s=((n=e[0])==null?void 0:n.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,a,o)=>a+o.toUpperCase());for(const i of[e,t,e.toUpperCase(),s]){const a=r.get(i);if(a)return a}}for(const[s,i]of Object.entries(r))if(s.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i},G2=r=>{if(typeof Buffer<"u"){const e=Buffer.from(r,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(r),t=e.length,n=new Uint8Array(t);for(let s=0;s<t;s++)n[s]=e.charCodeAt(s);return Array.from(new Float32Array(n.buffer))}};function rp(r){return r!=null&&typeof r=="object"&&!Array.isArray(r)}let Lh=class extends rP{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}};class Bt extends rP{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var n;const e=this.getPaginatedItems();if(!e.length)return null;const t=(n=e[e.length-1])==null?void 0:n.id;return t?{params:{after:t}}:null}}let Re=class{constructor(e){this._client=e}},oP=class extends Re{list(e,t={},n){return bt(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,Z2,{query:t,...n})}},jh=class extends Re{constructor(){super(...arguments),this.messages=new oP(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return bt(e)?this.list({},e):this._client.getAPIList("/chat/completions",Dh,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}};class Dh extends Bt{}class Z2 extends Bt{}jh.ChatCompletionsPage=Dh;jh.Messages=oP;let Fh=class extends Re{constructor(){super(...arguments),this.completions=new jh(this._client)}};Fh.Completions=jh;Fh.ChatCompletionsPage=Dh;class lP extends Re{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t==null?void 0:t.headers},__binaryResponse:!0})}}class cP extends Re{create(e,t){return this._client.post("/audio/transcriptions",Ra({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}}class uP extends Re{create(e,t){return this._client.post("/audio/translations",Ra({body:e,...t,__metadata:{model:e.model}}))}}class wc extends Re{constructor(){super(...arguments),this.transcriptions=new cP(this._client),this.translations=new uP(this._client),this.speech=new lP(this._client)}}wc.Transcriptions=cP;wc.Translations=uP;wc.Speech=lP;let Kb=class extends Re{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return bt(e)?this.list({},e):this._client.getAPIList("/batches",Xb,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}};class Xb extends Bt{}Kb.BatchesPage=Xb;class Yb extends Re{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return bt(e)?this.list({},e):this._client.getAPIList("/assistants",Qb,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Qb extends Bt{}Yb.AssistantsPage=Qb;function Mv(r){return typeof r.parse=="function"}const da=r=>(r==null?void 0:r.role)==="assistant",dP=r=>(r==null?void 0:r.role)==="function",hP=r=>(r==null?void 0:r.role)==="tool";var Vn=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},ht=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Cg,od,ld,Fo,zo,cd,Bo,zr,Uo,Td,Rd,Ji,fP;class e_{constructor(){Cg.add(this),this.controller=new AbortController,od.set(this,void 0),ld.set(this,()=>{}),Fo.set(this,()=>{}),zo.set(this,void 0),cd.set(this,()=>{}),Bo.set(this,()=>{}),zr.set(this,{}),Uo.set(this,!1),Td.set(this,!1),Rd.set(this,!1),Ji.set(this,!1),Vn(this,od,new Promise((e,t)=>{Vn(this,ld,e,"f"),Vn(this,Fo,t,"f")}),"f"),Vn(this,zo,new Promise((e,t)=>{Vn(this,cd,e,"f"),Vn(this,Bo,t,"f")}),"f"),ht(this,od,"f").catch(()=>{}),ht(this,zo,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},ht(this,Cg,"m",fP).bind(this))},0)}_connected(){this.ended||(ht(this,ld,"f").call(this),this._emit("connect"))}get ended(){return ht(this,Uo,"f")}get errored(){return ht(this,Td,"f")}get aborted(){return ht(this,Rd,"f")}abort(){this.controller.abort()}on(e,t){return(ht(this,zr,"f")[e]||(ht(this,zr,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=ht(this,zr,"f")[e];if(!n)return this;const s=n.findIndex(i=>i.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(ht(this,zr,"f")[e]||(ht(this,zr,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{Vn(this,Ji,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){Vn(this,Ji,!0,"f"),await ht(this,zo,"f")}_emit(e,...t){if(ht(this,Uo,"f"))return;e==="end"&&(Vn(this,Uo,!0,"f"),ht(this,cd,"f").call(this));const n=ht(this,zr,"f")[e];if(n&&(ht(this,zr,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!ht(this,Ji,"f")&&!(n!=null&&n.length)&&Promise.reject(s),ht(this,Fo,"f").call(this,s),ht(this,Bo,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!ht(this,Ji,"f")&&!(n!=null&&n.length)&&Promise.reject(s),ht(this,Fo,"f").call(this,s),ht(this,Bo,"f").call(this,s),this._emit("end")}}_emitFinal(){}}od=new WeakMap,ld=new WeakMap,Fo=new WeakMap,zo=new WeakMap,cd=new WeakMap,Bo=new WeakMap,zr=new WeakMap,Uo=new WeakMap,Td=new WeakMap,Rd=new WeakMap,Ji=new WeakMap,Cg=new WeakSet,fP=function(e){if(Vn(this,Td,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new bn),e instanceof bn)return Vn(this,Rd,!0,"f"),this._emit("abort",e);if(e instanceof ve)return this._emit("error",e);if(e instanceof Error){const t=new ve(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new ve(String(e)))};function J2(r,e){const t={...r};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function t_(r){return(r==null?void 0:r.$brand)==="auto-parseable-response-format"}function K2(r,{parser:e,callback:t}){const n={...r};return Object.defineProperties(n,{$brand:{value:"auto-parseable-tool",enumerable:!1},$parseRaw:{value:e,enumerable:!1},$callback:{value:t,enumerable:!1}}),n}function vc(r){return(r==null?void 0:r.$brand)==="auto-parseable-tool"}function X2(r,e){return!e||!pP(e)?{...r,choices:r.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:n_(r,e)}function n_(r,e){const t=r.choices.map(n=>{var s;if(n.finish_reason==="length")throw new G1;if(n.finish_reason==="content_filter")throw new Z1;return{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:((s=n.message.tool_calls)==null?void 0:s.map(i=>Q2(e,i)))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?Y2(e,n.message.content):null}}});return{...r,choices:t}}function Y2(r,e){var t,n;return((t=r.response_format)==null?void 0:t.type)!=="json_schema"?null:((n=r.response_format)==null?void 0:n.type)==="json_schema"?"$parseRaw"in r.response_format?r.response_format.$parseRaw(e):JSON.parse(e):null}function Q2(r,e){var n;const t=(n=r.tools)==null?void 0:n.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:vc(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function ej(r,e){var n;if(!r)return!1;const t=(n=r.tools)==null?void 0:n.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return vc(t)||(t==null?void 0:t.function.strict)||!1}function pP(r){var e;return t_(r.response_format)?!0:((e=r.tools)==null?void 0:e.some(t=>vc(t)||t.type==="function"&&t.function.strict===!0))??!1}function tj(r){for(const e of r??[]){if(e.type!=="function")throw new ve(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new ve(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var mn=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Gt,$g,Id,Mg,Ng,Lg,mP,jg;const Nv=10;class gP extends e_{constructor(){super(...arguments),Gt.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(n=e.choices[0])==null?void 0:n.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(dP(e)||hP(e))&&e.content)this._emit("functionCallResult",e.content);else if(da(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(da(e)&&e.tool_calls)for(const n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new ve("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),mn(this,Gt,"m",$g).call(this)}async finalMessage(){return await this.done(),mn(this,Gt,"m",Id).call(this)}async finalFunctionCall(){return await this.done(),mn(this,Gt,"m",Mg).call(this)}async finalFunctionCallResult(){return await this.done(),mn(this,Gt,"m",Ng).call(this)}async totalUsage(){return await this.done(),mn(this,Gt,"m",Lg).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=mn(this,Gt,"m",Id).call(this);t&&this._emit("finalMessage",t);const n=mn(this,Gt,"m",$g).call(this);n&&this._emit("finalContent",n);const s=mn(this,Gt,"m",Mg).call(this);s&&this._emit("finalFunctionCall",s);const i=mn(this,Gt,"m",Ng).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",mn(this,Gt,"m",Lg).call(this))}async _createChatCompletion(e,t,n){const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),mn(this,Gt,"m",mP).call(this,t);const i=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(n_(i,t))}async _runChatCompletion(e,t,n){for(const s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){var h;const s="function",{function_call:i="auto",stream:a,...o}=t,l=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:c=Nv}=n||{},u={};for(const f of t.functions)u[f.name||f.function.name]=f;const d=t.functions.map(f=>({name:f.name||f.function.name,parameters:f.parameters,description:f.description}));for(const f of t.messages)this._addMessage(f,!1);for(let f=0;f<c;++f){const m=(h=(await this._createChatCompletion(e,{...o,function_call:i,functions:d,messages:[...this.messages]},n)).choices[0])==null?void 0:h.message;if(!m)throw new ve("missing message in ChatCompletion response");if(!m.function_call)return;const{name:g,arguments:b}=m.function_call,_=u[g];if(_){if(l&&l!==g){const x=`Invalid function_call: ${JSON.stringify(g)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,name:g,content:x});continue}}else{const x=`Invalid function_call: ${JSON.stringify(g)}. Available options are: ${d.map(S=>JSON.stringify(S.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:g,content:x});continue}let y;try{y=Mv(_)?await _.parse(b):b}catch(x){this._addMessage({role:s,name:g,content:x instanceof Error?x.message:String(x)});continue}const w=await _.function(y,this),v=mn(this,Gt,"m",jg).call(this,w);if(this._addMessage({role:s,name:g,content:v}),l)return}}async _runTools(e,t,n){var f,p,m;const s="tool",{tool_choice:i="auto",stream:a,...o}=t,l=typeof i!="string"&&((f=i==null?void 0:i.function)==null?void 0:f.name),{maxChatCompletions:c=Nv}=n||{},u=t.tools.map(g=>{if(vc(g)){if(!g.$callback)throw new ve("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:g.$callback,name:g.function.name,description:g.function.description||"",parameters:g.function.parameters,parse:g.$parseRaw,strict:!0}}}return g}),d={};for(const g of u)g.type==="function"&&(d[g.function.name||g.function.function.name]=g.function);const h="tools"in t?u.map(g=>g.type==="function"?{type:"function",function:{name:g.function.name||g.function.function.name,parameters:g.function.parameters,description:g.function.description,strict:g.function.strict}}:g):void 0;for(const g of t.messages)this._addMessage(g,!1);for(let g=0;g<c;++g){const _=(p=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:h,messages:[...this.messages]},n)).choices[0])==null?void 0:p.message;if(!_)throw new ve("missing message in ChatCompletion response");if(!((m=_.tool_calls)!=null&&m.length))return;for(const y of _.tool_calls){if(y.type!=="function")continue;const w=y.id,{name:v,arguments:x}=y.function,S=d[v];if(S){if(l&&l!==v){const C=`Invalid tool_call: ${JSON.stringify(v)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,tool_call_id:w,content:C});continue}}else{const C=`Invalid tool_call: ${JSON.stringify(v)}. Available options are: ${Object.keys(d).map(N=>JSON.stringify(N)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:w,content:C});continue}let k;try{k=Mv(S)?await S.parse(x):x}catch(C){const N=C instanceof Error?C.message:String(C);this._addMessage({role:s,tool_call_id:w,content:N});continue}const R=await S.function(k,this),D=mn(this,Gt,"m",jg).call(this,R);if(this._addMessage({role:s,tool_call_id:w,content:D}),l)return}}}}Gt=new WeakSet,$g=function(){return mn(this,Gt,"m",Id).call(this).content??null},Id=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(da(t)){const{function_call:n,...s}=t,i={...s,content:t.content??null,refusal:t.refusal??null};return n&&(i.function_call=n),i}}throw new ve("stream ended without producing a ChatCompletionMessage with role=assistant")},Mg=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){const s=this.messages[n];if(da(s)&&(s!=null&&s.function_call))return s.function_call;if(da(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},Ng=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(dP(t)&&t.content!=null||hP(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>{var s;return n.role==="assistant"&&((s=n.tool_calls)==null?void 0:s.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},Lg=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},mP=function(e){if(e.n!=null&&e.n>1)throw new ve("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},jg=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Pl extends gP{static runFunctions(e,t,n){const s=new Pl,i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,n){const s=new Pl,i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e,t=!0){super._addMessage(e,t),da(e)&&e.content&&this._emit("content",e.content)}}const bP=1,_P=2,yP=4,wP=8,vP=16,xP=32,kP=64,SP=128,PP=256,AP=SP|PP,EP=vP|xP|AP|kP,OP=bP|_P|EP,TP=yP|wP,nj=OP|TP,Ct={STR:bP,NUM:_P,ARR:yP,OBJ:wP,NULL:vP,BOOL:xP,NAN:kP,INFINITY:SP,MINUS_INFINITY:PP,INF:AP,SPECIAL:EP,ATOM:OP,COLLECTION:TP,ALL:nj};class rj extends Error{}class sj extends Error{}function ij(r,e=Ct.ALL){if(typeof r!="string")throw new TypeError(`expecting str, got ${typeof r}`);if(!r.trim())throw new Error(`${r} is empty`);return aj(r.trim(),e)}const aj=(r,e)=>{const t=r.length;let n=0;const s=h=>{throw new rj(`${h} at position ${n}`)},i=h=>{throw new sj(`${h} at position ${n}`)},a=()=>(d(),n>=t&&s("Unexpected end of input"),r[n]==='"'?o():r[n]==="{"?l():r[n]==="["?c():r.substring(n,n+4)==="null"||Ct.NULL&e&&t-n<4&&"null".startsWith(r.substring(n))?(n+=4,null):r.substring(n,n+4)==="true"||Ct.BOOL&e&&t-n<4&&"true".startsWith(r.substring(n))?(n+=4,!0):r.substring(n,n+5)==="false"||Ct.BOOL&e&&t-n<5&&"false".startsWith(r.substring(n))?(n+=5,!1):r.substring(n,n+8)==="Infinity"||Ct.INFINITY&e&&t-n<8&&"Infinity".startsWith(r.substring(n))?(n+=8,1/0):r.substring(n,n+9)==="-Infinity"||Ct.MINUS_INFINITY&e&&1<t-n&&t-n<9&&"-Infinity".startsWith(r.substring(n))?(n+=9,-1/0):r.substring(n,n+3)==="NaN"||Ct.NAN&e&&t-n<3&&"NaN".startsWith(r.substring(n))?(n+=3,NaN):u()),o=()=>{const h=n;let f=!1;for(n++;n<t&&(r[n]!=='"'||f&&r[n-1]==="\\");)f=r[n]==="\\"?!f:!1,n++;if(r.charAt(n)=='"')try{return JSON.parse(r.substring(h,++n-Number(f)))}catch(p){i(String(p))}else if(Ct.STR&e)try{return JSON.parse(r.substring(h,n-Number(f))+'"')}catch{return JSON.parse(r.substring(h,r.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},l=()=>{n++,d();const h={};try{for(;r[n]!=="}";){if(d(),n>=t&&Ct.OBJ&e)return h;const f=o();d(),n++;try{const p=a();Object.defineProperty(h,f,{value:p,writable:!0,enumerable:!0,configurable:!0})}catch(p){if(Ct.OBJ&e)return h;throw p}d(),r[n]===","&&n++}}catch{if(Ct.OBJ&e)return h;s("Expected '}' at end of object")}return n++,h},c=()=>{n++;const h=[];try{for(;r[n]!=="]";)h.push(a()),d(),r[n]===","&&n++}catch{if(Ct.ARR&e)return h;s("Expected ']' at end of array")}return n++,h},u=()=>{if(n===0){r==="-"&&Ct.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(r)}catch(f){if(Ct.NUM&e)try{return r[r.length-1]==="."?JSON.parse(r.substring(0,r.lastIndexOf("."))):JSON.parse(r.substring(0,r.lastIndexOf("e")))}catch{}i(String(f))}}const h=n;for(r[n]==="-"&&n++;r[n]&&!",]}".includes(r[n]);)n++;n==t&&!(Ct.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(r.substring(h,n))}catch{r.substring(h,n)==="-"&&Ct.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(r.substring(h,r.lastIndexOf("e")))}catch(p){i(String(p))}}},d=()=>{for(;n<t&&` 
\r	`.includes(r[n]);)n++};return a()},Lv=r=>ij(r,Ct.ALL^Ct.NUM);var Fi=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Ye=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Pt,Mr,zi,ls,sp,hu,ip,ap,op,fu,lp,jv;class Al extends gP{constructor(e){super(),Pt.add(this),Mr.set(this,void 0),zi.set(this,void 0),ls.set(this,void 0),Fi(this,Mr,e,"f"),Fi(this,zi,[],"f")}get currentChatCompletionSnapshot(){return Ye(this,ls,"f")}static fromReadableStream(e){const t=new Al(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const s=new Al(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,n){var a;super._createChatCompletion;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Ye(this,Pt,"m",sp).call(this);const i=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of i)Ye(this,Pt,"m",ip).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new bn;return this._addChatCompletion(Ye(this,Pt,"m",fu).call(this))}async _fromReadableStream(e,t){var a;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),Ye(this,Pt,"m",sp).call(this),this._connected();const s=Sl.fromReadableStream(e,this.controller);let i;for await(const o of s)i&&i!==o.id&&this._addChatCompletion(Ye(this,Pt,"m",fu).call(this)),Ye(this,Pt,"m",ip).call(this,o),i=o.id;if((a=s.controller.signal)!=null&&a.aborted)throw new bn;return this._addChatCompletion(Ye(this,Pt,"m",fu).call(this))}[(Mr=new WeakMap,zi=new WeakMap,ls=new WeakMap,Pt=new WeakSet,sp=function(){this.ended||Fi(this,ls,void 0,"f")},hu=function(t){let n=Ye(this,zi,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Ye(this,zi,"f")[t.index]=n,n)},ip=function(t){var s,i,a,o,l,c,u,d,h,f,p,m,g,b,_;if(this.ended)return;const n=Ye(this,Pt,"m",jv).call(this,t);this._emit("chunk",t,n);for(const y of t.choices){const w=n.choices[y.index];y.delta.content!=null&&((s=w.message)==null?void 0:s.role)==="assistant"&&((i=w.message)!=null&&i.content)&&(this._emit("content",y.delta.content,w.message.content),this._emit("content.delta",{delta:y.delta.content,snapshot:w.message.content,parsed:w.message.parsed})),y.delta.refusal!=null&&((a=w.message)==null?void 0:a.role)==="assistant"&&((o=w.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:y.delta.refusal,snapshot:w.message.refusal}),((l=y.logprobs)==null?void 0:l.content)!=null&&((c=w.message)==null?void 0:c.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(u=y.logprobs)==null?void 0:u.content,snapshot:((d=w.logprobs)==null?void 0:d.content)??[]}),((h=y.logprobs)==null?void 0:h.refusal)!=null&&((f=w.message)==null?void 0:f.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(p=y.logprobs)==null?void 0:p.refusal,snapshot:((m=w.logprobs)==null?void 0:m.refusal)??[]});const v=Ye(this,Pt,"m",hu).call(this,w);w.finish_reason&&(Ye(this,Pt,"m",op).call(this,w),v.current_tool_call_index!=null&&Ye(this,Pt,"m",ap).call(this,w,v.current_tool_call_index));for(const x of y.delta.tool_calls??[])v.current_tool_call_index!==x.index&&(Ye(this,Pt,"m",op).call(this,w),v.current_tool_call_index!=null&&Ye(this,Pt,"m",ap).call(this,w,v.current_tool_call_index)),v.current_tool_call_index=x.index;for(const x of y.delta.tool_calls??[]){const S=(g=w.message.tool_calls)==null?void 0:g[x.index];S!=null&&S.type&&((S==null?void 0:S.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(b=S.function)==null?void 0:b.name,index:x.index,arguments:S.function.arguments,parsed_arguments:S.function.parsed_arguments,arguments_delta:((_=x.function)==null?void 0:_.arguments)??""}):(S==null||S.type,void 0))}}},ap=function(t,n){var a,o,l;if(Ye(this,Pt,"m",hu).call(this,t).done_tool_calls.has(n))return;const i=(a=t.message.tool_calls)==null?void 0:a[n];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){const c=(l=(o=Ye(this,Mr,"f"))==null?void 0:o.tools)==null?void 0:l.find(u=>u.type==="function"&&u.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:n,arguments:i.function.arguments,parsed_arguments:vc(c)?c.$parseRaw(i.function.arguments):c!=null&&c.function.strict?JSON.parse(i.function.arguments):null})}else i.type},op=function(t){var s,i;const n=Ye(this,Pt,"m",hu).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;const a=Ye(this,Pt,"m",lp).call(this);this._emit("content.done",{content:t.message.content,parsed:a?a.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(s=t.logprobs)!=null&&s.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(i=t.logprobs)!=null&&i.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},fu=function(){if(this.ended)throw new ve("stream has ended, this shouldn't happen");const t=Ye(this,ls,"f");if(!t)throw new ve("request ended without sending any chunks");return Fi(this,ls,void 0,"f"),Fi(this,zi,[],"f"),oj(t,Ye(this,Mr,"f"))},lp=function(){var n;const t=(n=Ye(this,Mr,"f"))==null?void 0:n.response_format;return t_(t)?t:null},jv=function(t){var n,s,i,a;let o=Ye(this,ls,"f");const{choices:l,...c}=t;o?Object.assign(o,c):o=Fi(this,ls,{...c,choices:[]},"f");for(const{delta:u,finish_reason:d,index:h,logprobs:f=null,...p}of t.choices){let m=o.choices[h];if(m||(m=o.choices[h]={finish_reason:d,index:h,message:{},logprobs:f,...p}),f)if(!m.logprobs)m.logprobs=Object.assign({},f);else{const{content:x,refusal:S,...k}=f;Object.assign(m.logprobs,k),x&&((n=m.logprobs).content??(n.content=[]),m.logprobs.content.push(...x)),S&&((s=m.logprobs).refusal??(s.refusal=[]),m.logprobs.refusal.push(...S))}if(d&&(m.finish_reason=d,Ye(this,Mr,"f")&&pP(Ye(this,Mr,"f")))){if(d==="length")throw new G1;if(d==="content_filter")throw new Z1}if(Object.assign(m,p),!u)continue;const{content:g,refusal:b,function_call:_,role:y,tool_calls:w,...v}=u;if(Object.assign(m.message,v),b&&(m.message.refusal=(m.message.refusal||"")+b),y&&(m.message.role=y),_&&(m.message.function_call?(_.name&&(m.message.function_call.name=_.name),_.arguments&&((i=m.message.function_call).arguments??(i.arguments=""),m.message.function_call.arguments+=_.arguments)):m.message.function_call=_),g&&(m.message.content=(m.message.content||"")+g,!m.message.refusal&&Ye(this,Pt,"m",lp).call(this)&&(m.message.parsed=Lv(m.message.content))),w){m.message.tool_calls||(m.message.tool_calls=[]);for(const{index:x,id:S,type:k,function:R,...D}of w){const C=(a=m.message.tool_calls)[x]??(a[x]={});Object.assign(C,D),S&&(C.id=S),k&&(C.type=k),R&&(C.function??(C.function={name:R.name??"",arguments:""})),R!=null&&R.name&&(C.function.name=R.name),R!=null&&R.arguments&&(C.function.arguments+=R.arguments,ej(Ye(this,Mr,"f"),C)&&(C.function.parsed_arguments=Lv(C.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Sl(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function oj(r,e){const{id:t,choices:n,created:s,model:i,system_fingerprint:a,...o}=r,l={...o,id:t,choices:n.map(({message:c,finish_reason:u,index:d,logprobs:h,...f})=>{if(!u)throw new ve(`missing finish_reason for choice ${d}`);const{content:p=null,function_call:m,tool_calls:g,...b}=c,_=c.role;if(!_)throw new ve(`missing role for choice ${d}`);if(m){const{arguments:y,name:w}=m;if(y==null)throw new ve(`missing function_call.arguments for choice ${d}`);if(!w)throw new ve(`missing function_call.name for choice ${d}`);return{...f,message:{content:p,function_call:{arguments:y,name:w},role:_,refusal:c.refusal??null},finish_reason:u,index:d,logprobs:h}}return g?{...f,index:d,finish_reason:u,logprobs:h,message:{...b,role:_,content:p,refusal:c.refusal??null,tool_calls:g.map((y,w)=>{const{function:v,type:x,id:S,...k}=y,{arguments:R,name:D,...C}=v||{};if(S==null)throw new ve(`missing choices[${d}].tool_calls[${w}].id
${pu(r)}`);if(x==null)throw new ve(`missing choices[${d}].tool_calls[${w}].type
${pu(r)}`);if(D==null)throw new ve(`missing choices[${d}].tool_calls[${w}].function.name
${pu(r)}`);if(R==null)throw new ve(`missing choices[${d}].tool_calls[${w}].function.arguments
${pu(r)}`);return{...k,id:S,type:x,function:{...C,name:D,arguments:R}}})}}:{...f,message:{...b,content:p,role:_,refusal:c.refusal??null},finish_reason:u,index:d,logprobs:h}}),created:s,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return X2(l,e)}function pu(r){return JSON.stringify(r)}class ha extends Al{static fromReadableStream(e){const t=new ha(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,n){const s=new ha(null),i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,n){const s=new ha(t),i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}}let RP=class extends Re{parse(e,t){return tj(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(n=>n_(n,e))}runFunctions(e,t){return e.stream?ha.runFunctions(this._client,e,t):Pl.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?ha.runTools(this._client,e,t):Pl.runTools(this._client,e,t)}stream(e,t){return Al.createChatCompletion(this._client,e,t)}};class Dg extends Re{constructor(){super(...arguments),this.completions=new RP(this._client)}}(function(r){r.Completions=RP})(Dg||(Dg={}));class IP extends Re{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class CP extends Re{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class zh extends Re{constructor(){super(...arguments),this.sessions=new IP(this._client),this.transcriptionSessions=new CP(this._client)}}zh.Sessions=IP;zh.TranscriptionSessions=CP;var ue=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},wn=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},zt,Fg,yr,ud,Zn,ii,ea,ti,Cd,Sn,dd,hd,nl,qo,Ho,Dv,Fv,zv,Bv,Uv,qv,Hv;class Xn extends e_{constructor(){super(...arguments),zt.add(this),Fg.set(this,[]),yr.set(this,{}),ud.set(this,{}),Zn.set(this,void 0),ii.set(this,void 0),ea.set(this,void 0),ti.set(this,void 0),Cd.set(this,void 0),Sn.set(this,void 0),dd.set(this,void 0),hd.set(this,void 0),nl.set(this,void 0)}[(Fg=new WeakMap,yr=new WeakMap,ud=new WeakMap,Zn=new WeakMap,ii=new WeakMap,ea=new WeakMap,ti=new WeakMap,Cd=new WeakMap,Sn=new WeakMap,dd=new WeakMap,hd=new WeakMap,nl=new WeakMap,zt=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Xn;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var i;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=Sl.fromReadableStream(e,this.controller);for await(const a of s)ue(this,zt,"m",qo).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new bn;return this._addRun(ue(this,zt,"m",Ho).call(this))}toReadableStream(){return new Sl(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,s,i){const a=new Xn;return a._run(()=>a._runToolAssistantStream(e,t,n,s,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,n,s,i){var c;const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},l=await e.submitToolOutputs(t,n,o,{...i,signal:this.controller.signal});this._connected();for await(const u of l)ue(this,zt,"m",qo).call(this,u);if((c=l.controller.signal)!=null&&c.aborted)throw new bn;return this._addRun(ue(this,zt,"m",Ho).call(this))}static createThreadAssistantStream(e,t,n){const s=new Xn;return s._run(()=>s._threadAssistantStream(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,n,s){const i=new Xn;return i._run(()=>i._runAssistantStream(e,t,n,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return ue(this,dd,"f")}currentRun(){return ue(this,hd,"f")}currentMessageSnapshot(){return ue(this,Zn,"f")}currentRunStepSnapshot(){return ue(this,nl,"f")}async finalRunSteps(){return await this.done(),Object.values(ue(this,yr,"f"))}async finalMessages(){return await this.done(),Object.values(ue(this,ud,"f"))}async finalRun(){if(await this.done(),!ue(this,ii,"f"))throw Error("Final run was not received.");return ue(this,ii,"f")}async _createThreadAssistantStream(e,t,n){var o;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i={...t,stream:!0},a=await e.createAndRun(i,{...n,signal:this.controller.signal});this._connected();for await(const l of a)ue(this,zt,"m",qo).call(this,l);if((o=a.controller.signal)!=null&&o.aborted)throw new bn;return this._addRun(ue(this,zt,"m",Ho).call(this))}async _createAssistantStream(e,t,n,s){var l;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...n,stream:!0},o=await e.create(t,a,{...s,signal:this.controller.signal});this._connected();for await(const c of o)ue(this,zt,"m",qo).call(this,c);if((l=o.controller.signal)!=null&&l.aborted)throw new bn;return this._addRun(ue(this,zt,"m",Ho).call(this))}static accumulateDelta(e,t){for(const[n,s]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=s;continue}let i=e[n];if(i==null){e[n]=s;continue}if(n==="index"||n==="type"){e[n]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(rp(i)&&rp(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}for(const a of s){if(!rp(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);const o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const l=i[o];l==null?i.push(a):i[o]=this.accumulateDelta(l,a)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${i}`);e[n]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,s){return await this._createAssistantStream(t,e,n,s)}async _runToolAssistantStream(e,t,n,s,i){return await this._createToolAssistantStream(n,e,t,s,i)}}qo=function(e){if(!this.ended)switch(wn(this,dd,e,"f"),ue(this,zt,"m",zv).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":ue(this,zt,"m",Hv).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":ue(this,zt,"m",Fv).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":ue(this,zt,"m",Dv).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Ho=function(){if(this.ended)throw new ve("stream has ended, this shouldn't happen");if(!ue(this,ii,"f"))throw Error("Final run has not been received");return ue(this,ii,"f")},Dv=function(e){const[t,n]=ue(this,zt,"m",Uv).call(this,e,ue(this,Zn,"f"));wn(this,Zn,t,"f"),ue(this,ud,"f")[t.id]=t;for(const s of n){const i=t.content[s.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=t.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=ue(this,ea,"f")){if(ue(this,ti,"f"))switch(ue(this,ti,"f").type){case"text":this._emit("textDone",ue(this,ti,"f").text,ue(this,Zn,"f"));break;case"image_file":this._emit("imageFileDone",ue(this,ti,"f").image_file,ue(this,Zn,"f"));break}wn(this,ea,s.index,"f")}wn(this,ti,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(ue(this,ea,"f")!==void 0){const s=e.data.content[ue(this,ea,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,ue(this,Zn,"f"));break;case"text":this._emit("textDone",s.text,ue(this,Zn,"f"));break}}ue(this,Zn,"f")&&this._emit("messageDone",e.data),wn(this,Zn,void 0,"f")}},Fv=function(e){const t=ue(this,zt,"m",Bv).call(this,e);switch(wn(this,nl,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const i of n.step_details.tool_calls)i.index==ue(this,Cd,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(ue(this,Sn,"f")&&this._emit("toolCallDone",ue(this,Sn,"f")),wn(this,Cd,i.index,"f"),wn(this,Sn,t.step_details.tool_calls[i.index],"f"),ue(this,Sn,"f")&&this._emit("toolCallCreated",ue(this,Sn,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":wn(this,nl,void 0,"f"),e.data.step_details.type=="tool_calls"&&ue(this,Sn,"f")&&(this._emit("toolCallDone",ue(this,Sn,"f")),wn(this,Sn,void 0,"f")),this._emit("runStepDone",e.data,t);break}},zv=function(e){ue(this,Fg,"f").push(e),this._emit("event",e)},Bv=function(e){switch(e.event){case"thread.run.step.created":return ue(this,yr,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=ue(this,yr,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const s=Xn.accumulateDelta(t,n.delta);ue(this,yr,"f")[e.data.id]=s}return ue(this,yr,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":ue(this,yr,"f")[e.data.id]=e.data;break}if(ue(this,yr,"f")[e.data.id])return ue(this,yr,"f")[e.data.id];throw new Error("No snapshot available")},Uv=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const i of s.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=ue(this,zt,"m",qv).call(this,i,a)}else t.content[i.index]=i,n.push(i);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},qv=function(e,t){return Xn.accumulateDelta(t,e)},Hv=function(e){switch(wn(this,hd,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":wn(this,ii,e.data,"f"),ue(this,Sn,"f")&&(this._emit("toolCallDone",ue(this,Sn,"f")),wn(this,Sn,void 0,"f"));break}};let r_=class extends Re{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return bt(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,s_,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}};class s_ extends Bt{}r_.MessagesPage=s_;class i_ extends Re{retrieve(e,t,n,s={},i){return bt(s)?this.retrieve(e,t,n,{},s):this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,t,n={},s){return bt(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,a_,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class a_ extends Bt{}i_.RunStepsPage=a_;let xc=class extends Re{constructor(){super(...arguments),this.steps=new i_(this._client)}create(e,t,n){const{include:s,...i}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:i,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return bt(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,o_,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t,n);return await this.poll(e,s.id,n)}createAndStream(e,t,n){return Xn.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...n,headers:{...n==null?void 0:n.headers,...s}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const l=a.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(o=c)}}await yc(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,n){return Xn.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,s){const i=await this.submitToolOutputs(e,t,n,s);return await this.poll(e,i.id,s)}submitToolOutputsStream(e,t,n,s){return Xn.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,s)}};class o_ extends Bt{}xc.RunsPage=o_;xc.Steps=i_;xc.RunStepsPage=a_;class za extends Re{constructor(){super(...arguments),this.runs=new xc(this._client),this.messages=new r_(this._client)}create(e={},t){return bt(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return Xn.createThreadAssistantStream(e,this._client.beta.threads,t)}}za.Runs=xc;za.RunsPage=o_;za.Messages=r_;za.MessagesPage=s_;let Ba=class extends Re{constructor(){super(...arguments),this.realtime=new zh(this._client),this.chat=new Dg(this._client),this.assistants=new Yb(this._client),this.threads=new za(this._client)}};Ba.Realtime=zh;Ba.Assistants=Yb;Ba.AssistantsPage=Qb;Ba.Threads=za;let $P=class extends Re{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}};class MP extends Re{create(e,t){const n=!!e.encoding_format;let s=n?e.encoding_format:"base64";n&&Es("Request","User defined encoding_format:",e.encoding_format);const i=this._client.post("/embeddings",{body:{...e,encoding_format:s},...t});return n?i:(Es("response","Decoding base64 embeddings to float32 array"),i._thenUnwrap(a=>(a&&a.data&&a.data.forEach(o=>{const l=o.embedding;o.embedding=G2(l)}),a)))}}class l_ extends Re{retrieve(e,t,n,s){return this._client.get(`/evals/${e}/runs/${t}/output_items/${n}`,s)}list(e,t,n={},s){return bt(n)?this.list(e,t,{},n):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,c_,{query:n,...s})}}class c_ extends Bt{}l_.OutputItemListResponsesPage=c_;class kc extends Re{constructor(){super(...arguments),this.outputItems=new l_(this._client)}create(e,t,n){return this._client.post(`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){return this._client.get(`/evals/${e}/runs/${t}`,n)}list(e,t={},n){return bt(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,u_,{query:t,...n})}del(e,t,n){return this._client.delete(`/evals/${e}/runs/${t}`,n)}cancel(e,t,n){return this._client.post(`/evals/${e}/runs/${t}`,n)}}class u_ extends Bt{}kc.RunListResponsesPage=u_;kc.OutputItems=l_;kc.OutputItemListResponsesPage=c_;class Sc extends Re{constructor(){super(...arguments),this.runs=new kc(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,n){return this._client.post(`/evals/${e}`,{body:t,...n})}list(e={},t){return bt(e)?this.list({},e):this._client.getAPIList("/evals",d_,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}}class d_ extends Bt{}Sc.EvalListResponsesPage=d_;Sc.Runs=kc;Sc.RunListResponsesPage=u_;let h_=class extends Re{create(e,t){return this._client.post("/files",Ra({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return bt(e)?this.list({},e):this._client.getAPIList("/files",f_,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),i=Date.now();let a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await yc(t),a=await this.retrieve(e),Date.now()-i>n)throw new _c({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}};class f_ extends Bt{}h_.FileObjectsPage=f_;class p_ extends Re{create(e,t,n){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,m_,{body:t,method:"post",...n})}retrieve(e,t={},n){return bt(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}del(e,t){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions`,t)}}class m_ extends Lh{}p_.PermissionCreateResponsesPage=m_;let Bh=class extends Re{constructor(){super(...arguments),this.permissions=new p_(this._client)}};Bh.Permissions=p_;Bh.PermissionCreateResponsesPage=m_;class g_ extends Re{list(e,t={},n){return bt(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,b_,{query:t,...n})}}class b_ extends Bt{}g_.FineTuningJobCheckpointsPage=b_;class Ua extends Re{constructor(){super(...arguments),this.checkpoints=new g_(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return bt(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",__,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return bt(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,y_,{query:t,...n})}}class __ extends Bt{}class y_ extends Bt{}Ua.FineTuningJobsPage=__;Ua.FineTuningJobEventsPage=y_;Ua.Checkpoints=g_;Ua.FineTuningJobCheckpointsPage=b_;class qa extends Re{constructor(){super(...arguments),this.jobs=new Ua(this._client),this.checkpoints=new Bh(this._client)}}qa.Jobs=Ua;qa.FineTuningJobsPage=__;qa.FineTuningJobEventsPage=y_;qa.Checkpoints=Bh;class NP extends Re{createVariation(e,t){return this._client.post("/images/variations",Ra({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",Ra({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}let w_=class extends Re{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",v_,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}};class v_ extends Lh{}w_.ModelsPage=v_;class LP extends Re{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function lj(r,e){return!e||!uj(e)?{...r,output_parsed:null,output:r.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(n=>({...n,parsed:null}))}:t)}:jP(r,e)}function jP(r,e){const t=r.output.map(s=>{if(s.type==="function_call")return{...s,parsed_arguments:fj(e,s)};if(s.type==="message"){const i=s.content.map(a=>a.type==="output_text"?{...a,parsed:cj(e,a.text)}:a);return{...s,content:i}}return s}),n=Object.assign({},r,{output:t});return Object.getOwnPropertyDescriptor(r,"output_text")||DP(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(const s of n.output)if(s.type==="message"){for(const i of s.content)if(i.type==="output_text"&&i.parsed!==null)return i.parsed}return null}}),n}function cj(r,e){var t,n,s,i;return((n=(t=r.text)==null?void 0:t.format)==null?void 0:n.type)!=="json_schema"?null:"$parseRaw"in((s=r.text)==null?void 0:s.format)?((i=r.text)==null?void 0:i.format).$parseRaw(e):JSON.parse(e)}function uj(r){var e;return!!t_((e=r.text)==null?void 0:e.format)}function dj(r){return(r==null?void 0:r.$brand)==="auto-parseable-tool"}function hj(r,e){return r.find(t=>t.type==="function"&&t.name===e)}function fj(r,e){const t=hj(r.tools??[],e.name);return{...e,...e,parsed_arguments:dj(t)?t.$parseRaw(e.arguments):t!=null&&t.strict?JSON.parse(e.arguments):null}}function DP(r){const e=[];for(const t of r.output)if(t.type==="message")for(const n of t.content)n.type==="output_text"&&e.push(n.text);r.output_text=e.join("")}class FP extends Re{list(e,t={},n){return bt(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,mj,{query:t,...n})}}var Bi=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},cs=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Ui,mu,us,gu,Wv,Vv,Gv,Zv;class x_ extends e_{constructor(e){super(),Ui.add(this),mu.set(this,void 0),us.set(this,void 0),gu.set(this,void 0),Bi(this,mu,e,"f")}static createResponse(e,t,n){const s=new x_(t);return s._run(()=>s._createResponse(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createResponse(e,t,n){var a;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),cs(this,Ui,"m",Wv).call(this);const i=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of i)cs(this,Ui,"m",Vv).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new bn;return cs(this,Ui,"m",Gv).call(this)}[(mu=new WeakMap,us=new WeakMap,gu=new WeakMap,Ui=new WeakSet,Wv=function(){this.ended||Bi(this,us,void 0,"f")},Vv=function(t){if(this.ended)return;const n=cs(this,Ui,"m",Zv).call(this,t);switch(this._emit("event",t),t.type){case"response.output_text.delta":{const s=n.output[t.output_index];if(!s)throw new ve(`missing output at index ${t.output_index}`);if(s.type==="message"){const i=s.content[t.content_index];if(!i)throw new ve(`missing content at index ${t.content_index}`);if(i.type!=="output_text")throw new ve(`expected content to be 'output_text', got ${i.type}`);this._emit("response.output_text.delta",{...t,snapshot:i.text})}break}case"response.function_call_arguments.delta":{const s=n.output[t.output_index];if(!s)throw new ve(`missing output at index ${t.output_index}`);s.type==="function_call"&&this._emit("response.function_call_arguments.delta",{...t,snapshot:s.arguments});break}default:this._emit(t.type,t);break}},Gv=function(){if(this.ended)throw new ve("stream has ended, this shouldn't happen");const t=cs(this,us,"f");if(!t)throw new ve("request ended without sending any events");Bi(this,us,void 0,"f");const n=pj(t,cs(this,mu,"f"));return Bi(this,gu,n,"f"),n},Zv=function(t){let n=cs(this,us,"f");if(!n){if(t.type!=="response.created")throw new ve(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return n=Bi(this,us,t.response,"f"),n}switch(t.type){case"response.output_item.added":{n.output.push(t.item);break}case"response.content_part.added":{const s=n.output[t.output_index];if(!s)throw new ve(`missing output at index ${t.output_index}`);s.type==="message"&&s.content.push(t.part);break}case"response.output_text.delta":{const s=n.output[t.output_index];if(!s)throw new ve(`missing output at index ${t.output_index}`);if(s.type==="message"){const i=s.content[t.content_index];if(!i)throw new ve(`missing content at index ${t.content_index}`);if(i.type!=="output_text")throw new ve(`expected content to be 'output_text', got ${i.type}`);i.text+=t.delta}break}case"response.function_call_arguments.delta":{const s=n.output[t.output_index];if(!s)throw new ve(`missing output at index ${t.output_index}`);s.type==="function_call"&&(s.arguments+=t.delta);break}case"response.completed":{Bi(this,us,t.response,"f");break}}return n},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=cs(this,gu,"f");if(!e)throw new ve("stream ended without producing a ChatCompletion");return e}}function pj(r,e){return lj(r,e)}class k_ extends Re{constructor(){super(...arguments),this.inputItems=new FP(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&DP(n),n))}retrieve(e,t={},n){return bt(t)?this.retrieve(e,{},t):this._client.get(`/responses/${e}`,{query:t,...n})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t==null?void 0:t.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(n=>jP(n,e))}stream(e,t){return x_.createResponse(this._client,e,t)}}class mj extends Bt{}k_.InputItems=FP;class zP extends Re{create(e,t,n){return this._client.post(`/uploads/${e}/parts`,Ra({body:t,...n}))}}class S_ extends Re{constructor(){super(...arguments),this.parts=new zP(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}}S_.Parts=zP;const gj=async r=>{const e=await Promise.allSettled(r),t=e.filter(s=>s.status==="rejected");if(t.length){for(const s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const n=[];for(const s of e)s.status==="fulfilled"&&n.push(s.value);return n};class Uh extends Re{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return bt(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,qh,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t,n);return await this.poll(e,s.id,n)}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const i=await this.retrieve(e,t,{...n,headers:s}).withResponse(),a=i.data;switch(a.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const l=i.response.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(o=c)}}await yc(o);break;case"failed":case"completed":return a}}}async upload(e,t,n){const s=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:s.id},n)}async uploadAndPoll(e,t,n){const s=await this.upload(e,t,n);return await this.poll(e,s.id,n)}content(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,P_,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class qh extends Bt{}class P_ extends Lh{}Uh.VectorStoreFilesPage=qh;Uh.FileContentResponsesPage=P_;class BP extends Re{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t);return await this.poll(e,s.id,n)}listFiles(e,t,n={},s){return bt(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,qh,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...n,headers:s}).withResponse();switch(i.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const l=a.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(o=c)}}await yc(o);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const i=(s==null?void 0:s.maxConcurrency)??5,a=Math.min(i,t.length),o=this._client,l=t.values(),c=[...n];async function u(h){for(let f of h){const p=await o.files.create({file:f,purpose:"assistants"},s);c.push(p.id)}}const d=Array(a).fill(l).map(u);return await gj(d),await this.createAndPoll(e,{file_ids:c})}}class zs extends Re{constructor(){super(...arguments),this.files=new Uh(this._client),this.fileBatches=new BP(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return bt(e)?this.list({},e):this._client.getAPIList("/vector_stores",A_,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}search(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/search`,E_,{body:t,method:"post",...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class A_ extends Bt{}class E_ extends Lh{}zs.VectorStoresPage=A_;zs.VectorStoreSearchResponsesPage=E_;zs.Files=Uh;zs.VectorStoreFilesPage=qh;zs.FileContentResponsesPage=P_;zs.FileBatches=BP;var UP;let Ae=class extends N2{constructor({baseURL:e=uu("OPENAI_BASE_URL"),apiKey:t=uu("OPENAI_API_KEY"),organization:n=uu("OPENAI_ORG_ID")??null,project:s=uu("OPENAI_PROJECT_ID")??null,...i}={}){if(t===void 0)throw new ve("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:t,organization:n,project:s,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&W2())throw new ve(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new $P(this),this.chat=new Fh(this),this.embeddings=new MP(this),this.files=new h_(this),this.images=new NP(this),this.audio=new wc(this),this.moderations=new LP(this),this.models=new w_(this),this.fineTuning=new qa(this),this.vectorStores=new zs(this),this.beta=new Ba(this),this.batches=new Kb(this),this.uploads=new S_(this),this.responses=new k_(this),this.evals=new Sc(this),this._options=a,this.apiKey=t,this.organization=n,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return b2(e,{arrayFormat:"brackets"})}};UP=Ae;Ae.OpenAI=UP;Ae.DEFAULT_TIMEOUT=6e5;Ae.OpenAIError=ve;Ae.APIError=yn;Ae.APIConnectionError=$h;Ae.APIConnectionTimeoutError=_c;Ae.APIUserAbortError=bn;Ae.NotFoundError=U1;Ae.ConflictError=q1;Ae.RateLimitError=W1;Ae.BadRequestError=F1;Ae.AuthenticationError=z1;Ae.InternalServerError=V1;Ae.PermissionDeniedError=B1;Ae.UnprocessableEntityError=H1;Ae.toFile=Y1;Ae.fileFromPath=L1;Ae.Completions=$P;Ae.Chat=Fh;Ae.ChatCompletionsPage=Dh;Ae.Embeddings=MP;Ae.Files=h_;Ae.FileObjectsPage=f_;Ae.Images=NP;Ae.Audio=wc;Ae.Moderations=LP;Ae.Models=w_;Ae.ModelsPage=v_;Ae.FineTuning=qa;Ae.VectorStores=zs;Ae.VectorStoresPage=A_;Ae.VectorStoreSearchResponsesPage=E_;Ae.Beta=Ba;Ae.Batches=Kb;Ae.BatchesPage=Xb;Ae.Uploads=S_;Ae.Responses=k_;Ae.Evals=Sc;Ae.EvalListResponsesPage=d_;function Jv(r,e=O_){r=r.trim();const t=/```(json)?(.*)```/s.exec(r);return e(t?t[2]:r)}function O_(r){if(typeof r>"u")return null;try{return JSON.parse(r)}catch{}let e="";const t=[];let n=!1,s=!1;for(let i of r){if(n)i==='"'&&!s?n=!1:i===`
`&&!s?i="\\n":i==="\\"?s=!s:s=!1;else if(i==='"')n=!0,s=!1;else if(i==="{")t.push("}");else if(i==="[")t.push("]");else if(i==="}"||i==="]")if(t&&t[t.length-1]===i)t.pop();else return null;e+=i}n&&(e+='"');for(let i=t.length-1;i>=0;i-=1)e+=t[i];try{return JSON.parse(e)}catch{return null}}var cp,Kv;function bj(){return Kv||(Kv=1,cp=function(r,e){if(typeof r!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,r.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}),cp}var _j=bj();const yj=Pi(_j);var bu={exports:{}},Xv;function wj(){if(Xv)return bu.exports;Xv=1;const r=/[\p{Lu}]/u,e=/[\p{Ll}]/u,t=/^[\p{Lu}](?![\p{Lu}])/gu,n=/([\p{Alpha}\p{N}_]|$)/u,s=/[_.\- ]+/,i=new RegExp("^"+s.source),a=new RegExp(s.source+n.source,"gu"),o=new RegExp("\\d+"+n.source,"gu"),l=(h,f,p)=>{let m=!1,g=!1,b=!1;for(let _=0;_<h.length;_++){const y=h[_];m&&r.test(y)?(h=h.slice(0,_)+"-"+h.slice(_),m=!1,b=g,g=!0,_++):g&&b&&e.test(y)?(h=h.slice(0,_-1)+"-"+h.slice(_-1),b=g,g=!1,m=!0):(m=f(y)===y&&p(y)!==y,b=g,g=p(y)===y&&f(y)!==y)}return h},c=(h,f)=>(t.lastIndex=0,h.replace(t,p=>f(p))),u=(h,f)=>(a.lastIndex=0,o.lastIndex=0,h.replace(a,(p,m)=>f(m)).replace(o,p=>f(p))),d=(h,f)=>{if(!(typeof h=="string"||Array.isArray(h)))throw new TypeError("Expected the input to be `string | string[]`");if(f={pascalCase:!1,preserveConsecutiveUppercase:!1,...f},Array.isArray(h)?h=h.map(b=>b.trim()).filter(b=>b.length).join("-"):h=h.trim(),h.length===0)return"";const p=f.locale===!1?b=>b.toLowerCase():b=>b.toLocaleLowerCase(f.locale),m=f.locale===!1?b=>b.toUpperCase():b=>b.toLocaleUpperCase(f.locale);return h.length===1?f.pascalCase?m(h):p(h):(h!==p(h)&&(h=l(h,p,m)),h=h.replace(i,""),f.preserveConsecutiveUppercase?h=c(h,p):h=p(h),f.pascalCase&&(h=m(h.charAt(0))+h.slice(1)),u(h,m))};return bu.exports=d,bu.exports.default=d,bu.exports}wj();function vj(r,e){return(e==null?void 0:e[r])||yj(r)}function xj(r,e,t){const n={};for(const s in r)Object.hasOwn(r,s)&&(n[e(s,t)]=r[s]);return n}function Yv(r){return Array.isArray(r)?[...r]:{...r}}function kj(r,e){const t=Yv(r);for(const[n,s]of Object.entries(e)){const[i,...a]=n.split(".").reverse();let o=t;for(const l of a.reverse()){if(o[l]===void 0)break;o[l]=Yv(o[l]),o=o[l]}o[i]!==void 0&&(o[i]={lc:1,type:"secret",id:[s]})}return t}function qP(r){const e=Object.getPrototypeOf(r);return typeof r.lc_name=="function"&&(typeof e.lc_name!="function"||r.lc_name()!==e.lc_name())?r.lc_name():r.name}class bi{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,qP(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([n])=>{var s;return(s=this.lc_serializable_keys)==null?void 0:s.includes(n)})):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof bi||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},n=Object.keys(this.lc_kwargs).reduce((s,i)=>(s[i]=i in this?this[i]:this.lc_kwargs[i],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(t,Reflect.get(s,"lc_secrets",this)),Object.assign(n,Reflect.get(s,"lc_attributes",this));return Object.keys(t).forEach(s=>{let i=this,a=n;const[o,...l]=s.split(".").reverse();for(const c of l.reverse()){if(!(c in i)||i[c]===void 0)return;(!(c in a)||a[c]===void 0)&&(typeof i[c]=="object"&&i[c]!=null?a[c]={}:Array.isArray(i[c])&&(a[c]=[])),i=i[c],a=a[c]}o in i&&i[o]!==void 0&&(a[o]=a[o]||i[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:xj(Object.keys(t).length?kj(n,t):n,vj,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}function Ha(r,e){return typeof r=="string"?r===""?e:typeof e=="string"?r+e:[{type:"text",text:r},...e]:Array.isArray(e)?Hh(r,e)??[...r,...e]:e===""?r:[...r,{type:"text",text:e}]}function Sj(r,e){return r==="error"||e==="error"?"error":"success"}function Pj(r,e){function t(n,s){if(typeof n!="object"||n===null||n===void 0)return n;if(s>=e)return Array.isArray(n)?"[Array]":"[Object]";if(Array.isArray(n))return n.map(a=>t(a,s+1));const i={};for(const a of Object.keys(n))i[a]=t(n[a],s+1);return i}return JSON.stringify(t(r,0),null,2)}class Wa extends bi{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const t=Pj(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}}function ln(r,e){const t={...r};for(const[n,s]of Object.entries(e))if(t[n]==null)t[n]=s;else{if(s==null)continue;if(typeof t[n]!=typeof s||Array.isArray(t[n])!==Array.isArray(s))throw new Error(`field[${n}] already exists in the message chunk, but with a different type.`);if(typeof t[n]=="string"){if(n==="type")continue;t[n]+=s}else if(typeof t[n]=="object"&&!Array.isArray(t[n]))t[n]=ln(t[n],s);else if(Array.isArray(t[n]))t[n]=Hh(t[n],s);else{if(t[n]===s)continue;console.warn(`field[${n}] already exists in this message chunk and value has unsupported type.`)}}return t}function Hh(r,e){if(!(r===void 0&&e===void 0)){if(r===void 0||e===void 0)return r||e;{const t=[...r];for(const n of e)if(typeof n=="object"&&"index"in n&&typeof n.index=="number"){const s=t.findIndex(i=>i.index===n.index);s!==-1?t[s]=ln(t[s],n):t.push(n)}else{if(typeof n=="object"&&"text"in n&&n.text==="")continue;t.push(n)}return t}}}function Aj(r,e){if(!r&&!e)throw new Error("Cannot merge two undefined objects.");if(!r||!e)return r||e;if(typeof r!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof r}
Right ${typeof e}`);if(typeof r=="string"&&typeof e=="string")return r+e;if(Array.isArray(r)&&Array.isArray(e))return Hh(r,e);if(typeof r=="object"&&typeof e=="object")return ln(r,e);if(r===e)return r;throw new Error(`Can not merge objects of different types.
Left ${r}
Right ${e}`)}class Va extends Wa{}function Ej(r){return typeof r.role=="string"}function Wh(r){return typeof(r==null?void 0:r._getType)=="function"}function Oj(r){return Wh(r)&&typeof r.concat=="function"}function Tj(r){return r!=null&&typeof r=="object"&&"lc_direct_tool_output"in r&&r.lc_direct_tool_output===!0}class zg extends Wa{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,n){typeof e=="string"&&(e={content:e,name:n,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}class Vh extends Va{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new Vh({content:Ha(this.content,e.content),additional_kwargs:ln(this.additional_kwargs,e.additional_kwargs),response_metadata:ln(this.response_metadata,e.response_metadata),artifact:Aj(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:Sj(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}function Rj(r){const e=[],t=[];for(const n of r)if(n.function){const s=n.function.name;try{const i=JSON.parse(n.function.arguments),a={name:s||"",args:i||{},id:n.id};e.push(a)}catch{t.push({name:s,args:n.function.arguments,id:n.id,error:"Malformed args."})}}else continue;return[e,t]}class ar extends Wa{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){var s;let n;if(typeof e=="string")n={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{n=e;const i=(s=n.additional_kwargs)==null?void 0:s.tool_calls,a=n.tool_calls;i!=null&&i.length>0&&(a===void 0||a.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(i!=null&&a===void 0){const[o,l]=Rj(i);n.tool_calls=o??[],n.invalid_tool_calls=l??[]}else n.tool_calls=n.tool_calls??[],n.invalid_tool_calls=n.invalid_tool_calls??[]}catch{n.tool_calls=[],n.invalid_tool_calls=[]}}super(n),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof n!="string"&&(this.tool_calls=n.tool_calls??this.tool_calls,this.invalid_tool_calls=n.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=n.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}function rs(r){return r._getType()==="ai"}function Qv(r){return r._getType()==="ai"}class mt extends Va{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{const n=[],s=[];for(const i of e.tool_call_chunks){let a={};try{if(a=O_(i.args||"{}"),a===null||typeof a!="object"||Array.isArray(a))throw new Error("Malformed tool call chunk args.");n.push({name:i.name??"",args:a,id:i.id,type:"tool_call"})}catch{s.push({name:i.name,args:i.args,id:i.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:n,invalid_tool_calls:s,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){var n,s,i,a,o,l,c,u,d,h,f,p,m,g,b,_,y,w,v,x,S,k,R,D,C,N,$,P,E,O,I,T,j,W,ee,Z,X,U,G,le;const t={content:Ha(this.content,e.content),additional_kwargs:ln(this.additional_kwargs,e.additional_kwargs),response_metadata:ln(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const he=Hh(this.tool_call_chunks,e.tool_call_chunks);he!==void 0&&he.length>0&&(t.tool_call_chunks=he)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){const he={...(((s=(n=this.usage_metadata)==null?void 0:n.input_token_details)==null?void 0:s.audio)!==void 0||((a=(i=e.usage_metadata)==null?void 0:i.input_token_details)==null?void 0:a.audio)!==void 0)&&{audio:(((l=(o=this.usage_metadata)==null?void 0:o.input_token_details)==null?void 0:l.audio)??0)+(((u=(c=e.usage_metadata)==null?void 0:c.input_token_details)==null?void 0:u.audio)??0)},...(((h=(d=this.usage_metadata)==null?void 0:d.input_token_details)==null?void 0:h.cache_read)!==void 0||((p=(f=e.usage_metadata)==null?void 0:f.input_token_details)==null?void 0:p.cache_read)!==void 0)&&{cache_read:(((g=(m=this.usage_metadata)==null?void 0:m.input_token_details)==null?void 0:g.cache_read)??0)+(((_=(b=e.usage_metadata)==null?void 0:b.input_token_details)==null?void 0:_.cache_read)??0)},...(((w=(y=this.usage_metadata)==null?void 0:y.input_token_details)==null?void 0:w.cache_creation)!==void 0||((x=(v=e.usage_metadata)==null?void 0:v.input_token_details)==null?void 0:x.cache_creation)!==void 0)&&{cache_creation:(((k=(S=this.usage_metadata)==null?void 0:S.input_token_details)==null?void 0:k.cache_creation)??0)+(((D=(R=e.usage_metadata)==null?void 0:R.input_token_details)==null?void 0:D.cache_creation)??0)}},Dt={...(((N=(C=this.usage_metadata)==null?void 0:C.output_token_details)==null?void 0:N.audio)!==void 0||((P=($=e.usage_metadata)==null?void 0:$.output_token_details)==null?void 0:P.audio)!==void 0)&&{audio:(((O=(E=this.usage_metadata)==null?void 0:E.output_token_details)==null?void 0:O.audio)??0)+(((T=(I=e.usage_metadata)==null?void 0:I.output_token_details)==null?void 0:T.audio)??0)},...(((W=(j=this.usage_metadata)==null?void 0:j.output_token_details)==null?void 0:W.reasoning)!==void 0||((Z=(ee=e.usage_metadata)==null?void 0:ee.output_token_details)==null?void 0:Z.reasoning)!==void 0)&&{reasoning:(((U=(X=this.usage_metadata)==null?void 0:X.output_token_details)==null?void 0:U.reasoning)??0)+(((le=(G=e.usage_metadata)==null?void 0:G.output_token_details)==null?void 0:le.reasoning)??0)}},vt=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},lt=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},_t={input_tokens:vt.input_tokens+lt.input_tokens,output_tokens:vt.output_tokens+lt.output_tokens,total_tokens:vt.total_tokens+lt.total_tokens,...Object.keys(he).length>0&&{input_token_details:he},...Object.keys(Dt).length>0&&{output_token_details:Dt}};t.usage_metadata=_t}return new mt(t)}}class Ti extends Wa{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return Ti}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}}class Pc extends Va{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new Pc({content:Ha(this.content,e.content),additional_kwargs:ln(this.additional_kwargs,e.additional_kwargs),response_metadata:ln(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}class Ac extends Va{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new Ac({content:Ha(this.content,e.content),additional_kwargs:ln(this.additional_kwargs,e.additional_kwargs),response_metadata:ln(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}class _i extends Wa{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class Ec extends Va{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new Ec({content:Ha(this.content,e.content),additional_kwargs:ln(this.additional_kwargs,e.additional_kwargs),response_metadata:ln(this.response_metadata,e.response_metadata),id:this.id??e.id})}}class Bg extends Wa{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class yi extends Va{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new yi({content:Ha(this.content,e.content),additional_kwargs:ln(this.additional_kwargs,e.additional_kwargs),response_metadata:ln(this.response_metadata,e.response_metadata),id:this.id??e.id})}}function HP(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function T_(r){return!!(r&&typeof r=="object"&&"type"in r&&r.type==="tool_call")}class Ug extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}function Ij(r){return T_(r)?r:typeof r.id=="string"&&r.type==="function"&&typeof r.function=="object"&&r.function!==null&&"arguments"in r.function&&typeof r.function.arguments=="string"&&"name"in r.function&&typeof r.function.name=="string"?{id:r.id,args:JSON.parse(r.function.arguments),name:r.function.name,type:"tool_call"}:r}function Cj(r){return typeof r=="object"&&r!=null&&r.lc===1&&Array.isArray(r.id)&&r.kwargs!=null&&typeof r.kwargs=="object"}function up(r){let e,t;if(Cj(r)){const n=r.id.at(-1);n==="HumanMessage"||n==="HumanMessageChunk"?e="user":n==="AIMessage"||n==="AIMessageChunk"?e="assistant":n==="SystemMessage"||n==="SystemMessageChunk"?e="system":n==="FunctionMessage"||n==="FunctionMessageChunk"?e="function":n==="ToolMessage"||n==="ToolMessageChunk"?e="tool":e="unknown",t=r.kwargs}else{const{type:n,...s}=r;e=n,t=s}if(e==="human"||e==="user")return new _i(t);if(e==="ai"||e==="assistant"){const{tool_calls:n,...s}=t;if(!Array.isArray(n))return new ar(t);const i=n.map(Ij);return new ar({...s,tool_calls:i})}else{if(e==="system")return new Bg(t);if(e==="developer")return new Bg({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in t)return new zg({...t,content:t.content,tool_call_id:t.tool_call_id,name:t.name});throw HP(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(r,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function Wo(r){if(typeof r=="string")return new _i(r);if(Wh(r))return r;if(Array.isArray(r)){const[e,t]=r;return up({type:e,content:t})}else if(Ej(r)){const{role:e,...t}=r;return up({...t,type:e})}else return up(r)}function WP(r,e="Human",t="AI"){const n=[];for(const s of r){let i;if(s._getType()==="human")i=e;else if(s._getType()==="ai")i=t;else if(s._getType()==="system")i="System";else if(s._getType()==="function")i="Function";else if(s._getType()==="tool")i="Tool";else if(s._getType()==="generic")i=s.role;else throw new Error(`Got unsupported message type: ${s._getType()}`);const a=s.name?`${s.name}, `:"",o=typeof s.content=="string"?s.content:JSON.stringify(s.content,null,2);n.push(`${i}: ${a}${o}`)}return n.join(`
`)}function $j(r){var t;const e=r._getType();if(e==="human")return new Ec({...r});if(e==="ai"){let n={...r};return"tool_calls"in n&&(n={...n,tool_call_chunks:(t=n.tool_calls)==null?void 0:t.map(s=>({...s,type:"tool_call_chunk",index:void 0,args:JSON.stringify(s.args)}))}),new mt({...n})}else{if(e==="system")return new yi({...r});if(e==="function")return new Ac({...r});if(Ti.isInstance(r))return new Pc({...r});throw new Error("Unknown message type.")}}var Be;(function(r){r.assertEqual=s=>s;function e(s){}r.assertIs=e;function t(s){throw new Error}r.assertNever=t,r.arrayToEnum=s=>{const i={};for(const a of s)i[a]=a;return i},r.getValidEnumValues=s=>{const i=r.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),a={};for(const o of i)a[o]=s[o];return r.objectValues(a)},r.objectValues=s=>r.objectKeys(s).map(function(i){return s[i]}),r.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const i=[];for(const a in s)Object.prototype.hasOwnProperty.call(s,a)&&i.push(a);return i},r.find=(s,i)=>{for(const a of s)if(i(a))return a},r.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function n(s,i=" | "){return s.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}r.joinValues=n,r.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(Be||(Be={}));var qg;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(qg||(qg={}));const Q=Be.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Vr=r=>{switch(typeof r){case"undefined":return Q.undefined;case"string":return Q.string;case"number":return isNaN(r)?Q.nan:Q.number;case"boolean":return Q.boolean;case"function":return Q.function;case"bigint":return Q.bigint;case"symbol":return Q.symbol;case"object":return Array.isArray(r)?Q.array:r===null?Q.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?Q.promise:typeof Map<"u"&&r instanceof Map?Q.map:typeof Set<"u"&&r instanceof Set?Q.set:typeof Date<"u"&&r instanceof Date?Q.date:Q.object;default:return Q.unknown}},H=Be.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Mj=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:");class Tn extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(i){return i.message},n={_errors:[]},s=i=>{for(const a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)n._errors.push(t(a));else{let o=n,l=0;for(;l<a.path.length;){const c=a.path[l];l===a.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(a))):o[c]=o[c]||{_errors:[]},o=o[c],l++}}};return s(this),n}static assert(e){if(!(e instanceof Tn))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Be.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},n=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):n.push(e(s));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}Tn.create=r=>new Tn(r);const Ia=(r,e)=>{let t;switch(r.code){case H.invalid_type:r.received===Q.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case H.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,Be.jsonStringifyReplacer)}`;break;case H.unrecognized_keys:t=`Unrecognized key(s) in object: ${Be.joinValues(r.keys,", ")}`;break;case H.invalid_union:t="Invalid input";break;case H.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${Be.joinValues(r.options)}`;break;case H.invalid_enum_value:t=`Invalid enum value. Expected ${Be.joinValues(r.options)}, received '${r.received}'`;break;case H.invalid_arguments:t="Invalid function arguments";break;case H.invalid_return_type:t="Invalid function return type";break;case H.invalid_date:t="Invalid date";break;case H.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:Be.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case H.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case H.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case H.custom:t="Invalid input";break;case H.invalid_intersection_types:t="Intersection results could not be merged";break;case H.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case H.not_finite:t="Number must be finite";break;default:t=e.defaultError,Be.assertNever(r)}return{message:t}};let VP=Ia;function Nj(r){VP=r}function $d(){return VP}const Md=r=>{const{data:e,path:t,errorMaps:n,issueData:s}=r,i=[...t,...s.path||[]],a={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let o="";const l=n.filter(c=>!!c).slice().reverse();for(const c of l)o=c(a,{data:e,defaultError:o}).message;return{...s,path:i,message:o}},Lj=[];function K(r,e){const t=$d(),n=Md({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===Ia?void 0:Ia].filter(s=>!!s)});r.common.issues.push(n)}class Yt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const s of t){if(s.status==="aborted")return xe;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const s of t){const i=await s.key,a=await s.value;n.push({key:i,value:a})}return Yt.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const s of t){const{key:i,value:a}=s;if(i.status==="aborted"||a.status==="aborted")return xe;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value<"u"||s.alwaysSet)&&(n[i.value]=a.value)}return{status:e.value,value:n}}}const xe=Object.freeze({status:"aborted"}),ta=r=>({status:"dirty",value:r}),cn=r=>({status:"valid",value:r}),Hg=r=>r.status==="aborted",Wg=r=>r.status==="dirty",wi=r=>r.status==="valid",El=r=>typeof Promise<"u"&&r instanceof Promise;function Nd(r,e,t,n){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(r)}function GP(r,e,t,n,s){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t}var oe;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(oe||(oe={}));var Vo,Go;class Or{constructor(e,t,n,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const e0=(r,e)=>{if(wi(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Tn(r.common.issues);return this._error=t,this._error}}};function Pe(r){if(!r)return{};const{errorMap:e,invalid_type_error:t,required_error:n,description:s}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(a,o)=>{var l,c;const{message:u}=r;return a.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:(l=u??n)!==null&&l!==void 0?l:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(c=u??t)!==null&&c!==void 0?c:o.defaultError}},description:s}}class Te{get description(){return this._def.description}_getType(e){return Vr(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Vr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Yt,ctx:{common:e.parent.common,data:e.data,parsedType:Vr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(El(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;const s={common:{issues:[],async:(n=t==null?void 0:t.async)!==null&&n!==void 0?n:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Vr(e)},i=this._parseSync({data:e,path:s.path,parent:s});return e0(s,i)}"~validate"(e){var t,n;const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Vr(e)};if(!this["~standard"].async)try{const i=this._parseSync({data:e,path:[],parent:s});return wi(i)?{value:i.value}:{issues:s.common.issues}}catch(i){!((n=(t=i==null?void 0:i.message)===null||t===void 0?void 0:t.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:s}).then(i=>wi(i)?{value:i.value}:{issues:s.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Vr(e)},s=this._parse({data:e,path:n.path,parent:n}),i=await(El(s)?s:Promise.resolve(s));return e0(n,i)}refine(e,t){const n=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{const a=e(s),o=()=>i.addIssue({code:H.custom,...n(s)});return typeof Promise<"u"&&a instanceof Promise?a.then(l=>l?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof t=="function"?t(n,s):t),!1))}_refinement(e){return new or({schema:this,typeName:L.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return rr.create(this,this._def)}nullable(){return Ms.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return nr.create(this)}promise(){return $a.create(this,this._def)}or(e){return Il.create([this,e],this._def)}and(e){return Cl.create(this,e,this._def)}transform(e){return new or({...Pe(this._def),schema:this,typeName:L.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new jl({...Pe(this._def),innerType:this,defaultValue:t,typeName:L.ZodDefault})}brand(){return new R_({typeName:L.ZodBranded,type:this,...Pe(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Dl({...Pe(this._def),innerType:this,catchValue:t,typeName:L.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Oc.create(this,e)}readonly(){return Fl.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const jj=/^c[^\s-]{8,}$/i,Dj=/^[0-9a-z]+$/,Fj=/^[0-9A-HJKMNP-TV-Z]{26}$/i,zj=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Bj=/^[a-z0-9_-]{21}$/i,Uj=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,qj=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Hj=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Wj="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let dp;const Vj=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Gj=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Zj=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Jj=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Kj=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Xj=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ZP="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Yj=new RegExp(`^${ZP}$`);function JP(r){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Qj(r){return new RegExp(`^${JP(r)}$`)}function KP(r){let e=`${ZP}T${JP(r)}`;const t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function eD(r,e){return!!((e==="v4"||!e)&&Vj.test(r)||(e==="v6"||!e)&&Zj.test(r))}function tD(r,e){if(!Uj.test(r))return!1;try{const[t]=r.split("."),n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(n));return!(typeof s!="object"||s===null||!s.typ||!s.alg||e&&s.alg!==e)}catch{return!1}}function nD(r,e){return!!((e==="v4"||!e)&&Gj.test(r)||(e==="v6"||!e)&&Jj.test(r))}class Yn extends Te{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==Q.string){const i=this._getOrReturnCtx(e);return K(i,{code:H.invalid_type,expected:Q.string,received:i.parsedType}),xe}const n=new Yt;let s;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),K(s,{code:H.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),K(s,{code:H.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="length"){const a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(s=this._getOrReturnCtx(e,s),a?K(s,{code:H.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&K(s,{code:H.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),n.dirty())}else if(i.kind==="email")Hj.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"email",code:H.invalid_string,message:i.message}),n.dirty());else if(i.kind==="emoji")dp||(dp=new RegExp(Wj,"u")),dp.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"emoji",code:H.invalid_string,message:i.message}),n.dirty());else if(i.kind==="uuid")zj.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"uuid",code:H.invalid_string,message:i.message}),n.dirty());else if(i.kind==="nanoid")Bj.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"nanoid",code:H.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid")jj.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"cuid",code:H.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid2")Dj.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"cuid2",code:H.invalid_string,message:i.message}),n.dirty());else if(i.kind==="ulid")Fj.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"ulid",code:H.invalid_string,message:i.message}),n.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),K(s,{validation:"url",code:H.invalid_string,message:i.message}),n.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"regex",code:H.invalid_string,message:i.message}),n.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),K(s,{code:H.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),n.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),K(s,{code:H.invalid_string,validation:{startsWith:i.value},message:i.message}),n.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),K(s,{code:H.invalid_string,validation:{endsWith:i.value},message:i.message}),n.dirty()):i.kind==="datetime"?KP(i).test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{code:H.invalid_string,validation:"datetime",message:i.message}),n.dirty()):i.kind==="date"?Yj.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{code:H.invalid_string,validation:"date",message:i.message}),n.dirty()):i.kind==="time"?Qj(i).test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{code:H.invalid_string,validation:"time",message:i.message}),n.dirty()):i.kind==="duration"?qj.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"duration",code:H.invalid_string,message:i.message}),n.dirty()):i.kind==="ip"?eD(e.data,i.version)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"ip",code:H.invalid_string,message:i.message}),n.dirty()):i.kind==="jwt"?tD(e.data,i.alg)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"jwt",code:H.invalid_string,message:i.message}),n.dirty()):i.kind==="cidr"?nD(e.data,i.version)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"cidr",code:H.invalid_string,message:i.message}),n.dirty()):i.kind==="base64"?Kj.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"base64",code:H.invalid_string,message:i.message}),n.dirty()):i.kind==="base64url"?Xj.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"base64url",code:H.invalid_string,message:i.message}),n.dirty()):Be.assertNever(i);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(s=>e.test(s),{validation:t,code:H.invalid_string,...oe.errToObj(n)})}_addCheck(e){return new Yn({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...oe.errToObj(e)})}url(e){return this._addCheck({kind:"url",...oe.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...oe.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...oe.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...oe.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...oe.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...oe.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...oe.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...oe.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...oe.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...oe.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...oe.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...oe.errToObj(e)})}datetime(e){var t,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(n=e==null?void 0:e.local)!==null&&n!==void 0?n:!1,...oe.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...oe.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...oe.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...oe.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...oe.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...oe.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...oe.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...oe.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...oe.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...oe.errToObj(t)})}nonempty(e){return this.min(1,oe.errToObj(e))}trim(){return new Yn({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Yn({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Yn({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Yn.create=r=>{var e;return new Yn({checks:[],typeName:L.ZodString,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...Pe(r)})};function rD(r,e){const t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=t>n?t:n,i=parseInt(r.toFixed(s).replace(".","")),a=parseInt(e.toFixed(s).replace(".",""));return i%a/Math.pow(10,s)}class Is extends Te{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==Q.number){const i=this._getOrReturnCtx(e);return K(i,{code:H.invalid_type,expected:Q.number,received:i.parsedType}),xe}let n;const s=new Yt;for(const i of this._def.checks)i.kind==="int"?Be.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),K(n,{code:H.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),K(n,{code:H.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),K(n,{code:H.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?rD(e.data,i.value)!==0&&(n=this._getOrReturnCtx(e,n),K(n,{code:H.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),K(n,{code:H.not_finite,message:i.message}),s.dirty()):Be.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,oe.toString(t))}gt(e,t){return this.setLimit("min",e,!1,oe.toString(t))}lte(e,t){return this.setLimit("max",e,!0,oe.toString(t))}lt(e,t){return this.setLimit("max",e,!1,oe.toString(t))}setLimit(e,t,n,s){return new Is({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:oe.toString(s)}]})}_addCheck(e){return new Is({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:oe.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:oe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:oe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:oe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:oe.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:oe.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:oe.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:oe.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:oe.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Be.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Is.create=r=>new Is({checks:[],typeName:L.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...Pe(r)});class Cs extends Te{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==Q.bigint)return this._getInvalidInput(e);let n;const s=new Yt;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),K(n,{code:H.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),K(n,{code:H.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),K(n,{code:H.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):Be.assertNever(i);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return K(t,{code:H.invalid_type,expected:Q.bigint,received:t.parsedType}),xe}gte(e,t){return this.setLimit("min",e,!0,oe.toString(t))}gt(e,t){return this.setLimit("min",e,!1,oe.toString(t))}lte(e,t){return this.setLimit("max",e,!0,oe.toString(t))}lt(e,t){return this.setLimit("max",e,!1,oe.toString(t))}setLimit(e,t,n,s){return new Cs({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:oe.toString(s)}]})}_addCheck(e){return new Cs({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:oe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:oe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:oe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:oe.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:oe.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Cs.create=r=>{var e;return new Cs({checks:[],typeName:L.ZodBigInt,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...Pe(r)})};class Ol extends Te{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==Q.boolean){const n=this._getOrReturnCtx(e);return K(n,{code:H.invalid_type,expected:Q.boolean,received:n.parsedType}),xe}return cn(e.data)}}Ol.create=r=>new Ol({typeName:L.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...Pe(r)});class vi extends Te{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==Q.date){const i=this._getOrReturnCtx(e);return K(i,{code:H.invalid_type,expected:Q.date,received:i.parsedType}),xe}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return K(i,{code:H.invalid_date}),xe}const n=new Yt;let s;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),K(s,{code:H.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),n.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),K(s,{code:H.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),n.dirty()):Be.assertNever(i);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new vi({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:oe.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:oe.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}vi.create=r=>new vi({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:L.ZodDate,...Pe(r)});class Ld extends Te{_parse(e){if(this._getType(e)!==Q.symbol){const n=this._getOrReturnCtx(e);return K(n,{code:H.invalid_type,expected:Q.symbol,received:n.parsedType}),xe}return cn(e.data)}}Ld.create=r=>new Ld({typeName:L.ZodSymbol,...Pe(r)});class Tl extends Te{_parse(e){if(this._getType(e)!==Q.undefined){const n=this._getOrReturnCtx(e);return K(n,{code:H.invalid_type,expected:Q.undefined,received:n.parsedType}),xe}return cn(e.data)}}Tl.create=r=>new Tl({typeName:L.ZodUndefined,...Pe(r)});class Rl extends Te{_parse(e){if(this._getType(e)!==Q.null){const n=this._getOrReturnCtx(e);return K(n,{code:H.invalid_type,expected:Q.null,received:n.parsedType}),xe}return cn(e.data)}}Rl.create=r=>new Rl({typeName:L.ZodNull,...Pe(r)});class Ca extends Te{constructor(){super(...arguments),this._any=!0}_parse(e){return cn(e.data)}}Ca.create=r=>new Ca({typeName:L.ZodAny,...Pe(r)});class hi extends Te{constructor(){super(...arguments),this._unknown=!0}_parse(e){return cn(e.data)}}hi.create=r=>new hi({typeName:L.ZodUnknown,...Pe(r)});class ts extends Te{_parse(e){const t=this._getOrReturnCtx(e);return K(t,{code:H.invalid_type,expected:Q.never,received:t.parsedType}),xe}}ts.create=r=>new ts({typeName:L.ZodNever,...Pe(r)});class jd extends Te{_parse(e){if(this._getType(e)!==Q.undefined){const n=this._getOrReturnCtx(e);return K(n,{code:H.invalid_type,expected:Q.void,received:n.parsedType}),xe}return cn(e.data)}}jd.create=r=>new jd({typeName:L.ZodVoid,...Pe(r)});class nr extends Te{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),s=this._def;if(t.parsedType!==Q.array)return K(t,{code:H.invalid_type,expected:Q.array,received:t.parsedType}),xe;if(s.exactLength!==null){const a=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(a||o)&&(K(t,{code:a?H.too_big:H.too_small,minimum:o?s.exactLength.value:void 0,maximum:a?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(K(t,{code:H.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(K(t,{code:H.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>s.type._parseAsync(new Or(t,a,t.path,o)))).then(a=>Yt.mergeArray(n,a));const i=[...t.data].map((a,o)=>s.type._parseSync(new Or(t,a,t.path,o)));return Yt.mergeArray(n,i)}get element(){return this._def.type}min(e,t){return new nr({...this._def,minLength:{value:e,message:oe.toString(t)}})}max(e,t){return new nr({...this._def,maxLength:{value:e,message:oe.toString(t)}})}length(e,t){return new nr({...this._def,exactLength:{value:e,message:oe.toString(t)}})}nonempty(e){return this.min(1,e)}}nr.create=(r,e)=>new nr({type:r,minLength:null,maxLength:null,exactLength:null,typeName:L.ZodArray,...Pe(e)});function Ki(r){if(r instanceof pt){const e={};for(const t in r.shape){const n=r.shape[t];e[t]=rr.create(Ki(n))}return new pt({...r._def,shape:()=>e})}else return r instanceof nr?new nr({...r._def,type:Ki(r.element)}):r instanceof rr?rr.create(Ki(r.unwrap())):r instanceof Ms?Ms.create(Ki(r.unwrap())):r instanceof Tr?Tr.create(r.items.map(e=>Ki(e))):r}class pt extends Te{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=Be.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==Q.object){const c=this._getOrReturnCtx(e);return K(c,{code:H.invalid_type,expected:Q.object,received:c.parsedType}),xe}const{status:n,ctx:s}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof ts&&this._def.unknownKeys==="strip"))for(const c in s.data)a.includes(c)||o.push(c);const l=[];for(const c of a){const u=i[c],d=s.data[c];l.push({key:{status:"valid",value:c},value:u._parse(new Or(s,d,s.path,c)),alwaysSet:c in s.data})}if(this._def.catchall instanceof ts){const c=this._def.unknownKeys;if(c==="passthrough")for(const u of o)l.push({key:{status:"valid",value:u},value:{status:"valid",value:s.data[u]}});else if(c==="strict")o.length>0&&(K(s,{code:H.unrecognized_keys,keys:o}),n.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const u of o){const d=s.data[u];l.push({key:{status:"valid",value:u},value:c._parse(new Or(s,d,s.path,u)),alwaysSet:u in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const c=[];for(const u of l){const d=await u.key,h=await u.value;c.push({key:d,value:h,alwaysSet:u.alwaysSet})}return c}).then(c=>Yt.mergeObjectSync(n,c)):Yt.mergeObjectSync(n,l)}get shape(){return this._def.shape()}strict(e){return oe.errToObj,new pt({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var s,i,a,o;const l=(a=(i=(s=this._def).errorMap)===null||i===void 0?void 0:i.call(s,t,n).message)!==null&&a!==void 0?a:n.defaultError;return t.code==="unrecognized_keys"?{message:(o=oe.errToObj(e).message)!==null&&o!==void 0?o:l}:{message:l}}}:{}})}strip(){return new pt({...this._def,unknownKeys:"strip"})}passthrough(){return new pt({...this._def,unknownKeys:"passthrough"})}extend(e){return new pt({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new pt({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:L.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new pt({...this._def,catchall:e})}pick(e){const t={};return Be.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])}),new pt({...this._def,shape:()=>t})}omit(e){const t={};return Be.objectKeys(this.shape).forEach(n=>{e[n]||(t[n]=this.shape[n])}),new pt({...this._def,shape:()=>t})}deepPartial(){return Ki(this)}partial(e){const t={};return Be.objectKeys(this.shape).forEach(n=>{const s=this.shape[n];e&&!e[n]?t[n]=s:t[n]=s.optional()}),new pt({...this._def,shape:()=>t})}required(e){const t={};return Be.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])t[n]=this.shape[n];else{let i=this.shape[n];for(;i instanceof rr;)i=i._def.innerType;t[n]=i}}),new pt({...this._def,shape:()=>t})}keyof(){return XP(Be.objectKeys(this.shape))}}pt.create=(r,e)=>new pt({shape:()=>r,unknownKeys:"strip",catchall:ts.create(),typeName:L.ZodObject,...Pe(e)});pt.strictCreate=(r,e)=>new pt({shape:()=>r,unknownKeys:"strict",catchall:ts.create(),typeName:L.ZodObject,...Pe(e)});pt.lazycreate=(r,e)=>new pt({shape:r,unknownKeys:"strip",catchall:ts.create(),typeName:L.ZodObject,...Pe(e)});class Il extends Te{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;function s(i){for(const o of i)if(o.result.status==="valid")return o.result;for(const o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const a=i.map(o=>new Tn(o.ctx.common.issues));return K(t,{code:H.invalid_union,unionErrors:a}),xe}if(t.common.async)return Promise.all(n.map(async i=>{const a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(s);{let i;const a=[];for(const l of n){const c={...t,common:{...t.common,issues:[]},parent:null},u=l._parseSync({data:t.data,path:t.path,parent:c});if(u.status==="valid")return u;u.status==="dirty"&&!i&&(i={result:u,ctx:c}),c.common.issues.length&&a.push(c.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const o=a.map(l=>new Tn(l));return K(t,{code:H.invalid_union,unionErrors:o}),xe}}get options(){return this._def.options}}Il.create=(r,e)=>new Il({options:r,typeName:L.ZodUnion,...Pe(e)});const Br=r=>r instanceof Ml?Br(r.schema):r instanceof or?Br(r.innerType()):r instanceof Nl?[r.value]:r instanceof $s?r.options:r instanceof Ll?Be.objectValues(r.enum):r instanceof jl?Br(r._def.innerType):r instanceof Tl?[void 0]:r instanceof Rl?[null]:r instanceof rr?[void 0,...Br(r.unwrap())]:r instanceof Ms?[null,...Br(r.unwrap())]:r instanceof R_||r instanceof Fl?Br(r.unwrap()):r instanceof Dl?Br(r._def.innerType):[];class Gh extends Te{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Q.object)return K(t,{code:H.invalid_type,expected:Q.object,received:t.parsedType}),xe;const n=this.discriminator,s=t.data[n],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(K(t,{code:H.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),xe)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){const s=new Map;for(const i of t){const a=Br(i.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of a){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,i)}}return new Gh({typeName:L.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...Pe(n)})}}function Vg(r,e){const t=Vr(r),n=Vr(e);if(r===e)return{valid:!0,data:r};if(t===Q.object&&n===Q.object){const s=Be.objectKeys(e),i=Be.objectKeys(r).filter(o=>s.indexOf(o)!==-1),a={...r,...e};for(const o of i){const l=Vg(r[o],e[o]);if(!l.valid)return{valid:!1};a[o]=l.data}return{valid:!0,data:a}}else if(t===Q.array&&n===Q.array){if(r.length!==e.length)return{valid:!1};const s=[];for(let i=0;i<r.length;i++){const a=r[i],o=e[i],l=Vg(a,o);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return t===Q.date&&n===Q.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class Cl extends Te{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=(i,a)=>{if(Hg(i)||Hg(a))return xe;const o=Vg(i.value,a.value);return o.valid?((Wg(i)||Wg(a))&&t.dirty(),{status:t.value,value:o.data}):(K(n,{code:H.invalid_intersection_types}),xe)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([i,a])=>s(i,a)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}Cl.create=(r,e,t)=>new Cl({left:r,right:e,typeName:L.ZodIntersection,...Pe(t)});class Tr extends Te{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Q.array)return K(n,{code:H.invalid_type,expected:Q.array,received:n.parsedType}),xe;if(n.data.length<this._def.items.length)return K(n,{code:H.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),xe;!this._def.rest&&n.data.length>this._def.items.length&&(K(n,{code:H.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...n.data].map((a,o)=>{const l=this._def.items[o]||this._def.rest;return l?l._parse(new Or(n,a,n.path,o)):null}).filter(a=>!!a);return n.common.async?Promise.all(i).then(a=>Yt.mergeArray(t,a)):Yt.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new Tr({...this._def,rest:e})}}Tr.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Tr({items:r,typeName:L.ZodTuple,rest:null,...Pe(e)})};class $l extends Te{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Q.object)return K(n,{code:H.invalid_type,expected:Q.object,received:n.parsedType}),xe;const s=[],i=this._def.keyType,a=this._def.valueType;for(const o in n.data)s.push({key:i._parse(new Or(n,o,n.path,o)),value:a._parse(new Or(n,n.data[o],n.path,o)),alwaysSet:o in n.data});return n.common.async?Yt.mergeObjectAsync(t,s):Yt.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof Te?new $l({keyType:e,valueType:t,typeName:L.ZodRecord,...Pe(n)}):new $l({keyType:Yn.create(),valueType:e,typeName:L.ZodRecord,...Pe(t)})}}class Dd extends Te{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Q.map)return K(n,{code:H.invalid_type,expected:Q.map,received:n.parsedType}),xe;const s=this._def.keyType,i=this._def.valueType,a=[...n.data.entries()].map(([o,l],c)=>({key:s._parse(new Or(n,o,n.path,[c,"key"])),value:i._parse(new Or(n,l,n.path,[c,"value"]))}));if(n.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const l of a){const c=await l.key,u=await l.value;if(c.status==="aborted"||u.status==="aborted")return xe;(c.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(c.value,u.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const l of a){const c=l.key,u=l.value;if(c.status==="aborted"||u.status==="aborted")return xe;(c.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(c.value,u.value)}return{status:t.value,value:o}}}}Dd.create=(r,e,t)=>new Dd({valueType:e,keyType:r,typeName:L.ZodMap,...Pe(t)});class xi extends Te{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Q.set)return K(n,{code:H.invalid_type,expected:Q.set,received:n.parsedType}),xe;const s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(K(n,{code:H.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(K(n,{code:H.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const i=this._def.valueType;function a(l){const c=new Set;for(const u of l){if(u.status==="aborted")return xe;u.status==="dirty"&&t.dirty(),c.add(u.value)}return{status:t.value,value:c}}const o=[...n.data.values()].map((l,c)=>i._parse(new Or(n,l,n.path,c)));return n.common.async?Promise.all(o).then(l=>a(l)):a(o)}min(e,t){return new xi({...this._def,minSize:{value:e,message:oe.toString(t)}})}max(e,t){return new xi({...this._def,maxSize:{value:e,message:oe.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}xi.create=(r,e)=>new xi({valueType:r,minSize:null,maxSize:null,typeName:L.ZodSet,...Pe(e)});class fa extends Te{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Q.function)return K(t,{code:H.invalid_type,expected:Q.function,received:t.parsedType}),xe;function n(o,l){return Md({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,$d(),Ia].filter(c=>!!c),issueData:{code:H.invalid_arguments,argumentsError:l}})}function s(o,l){return Md({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,$d(),Ia].filter(c=>!!c),issueData:{code:H.invalid_return_type,returnTypeError:l}})}const i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof $a){const o=this;return cn(async function(...l){const c=new Tn([]),u=await o._def.args.parseAsync(l,i).catch(f=>{throw c.addIssue(n(l,f)),c}),d=await Reflect.apply(a,this,u);return await o._def.returns._def.type.parseAsync(d,i).catch(f=>{throw c.addIssue(s(d,f)),c})})}else{const o=this;return cn(function(...l){const c=o._def.args.safeParse(l,i);if(!c.success)throw new Tn([n(l,c.error)]);const u=Reflect.apply(a,this,c.data),d=o._def.returns.safeParse(u,i);if(!d.success)throw new Tn([s(u,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new fa({...this._def,args:Tr.create(e).rest(hi.create())})}returns(e){return new fa({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new fa({args:e||Tr.create([]).rest(hi.create()),returns:t||hi.create(),typeName:L.ZodFunction,...Pe(n)})}}class Ml extends Te{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Ml.create=(r,e)=>new Ml({getter:r,typeName:L.ZodLazy,...Pe(e)});class Nl extends Te{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return K(t,{received:t.data,code:H.invalid_literal,expected:this._def.value}),xe}return{status:"valid",value:e.data}}get value(){return this._def.value}}Nl.create=(r,e)=>new Nl({value:r,typeName:L.ZodLiteral,...Pe(e)});function XP(r,e){return new $s({values:r,typeName:L.ZodEnum,...Pe(e)})}class $s extends Te{constructor(){super(...arguments),Vo.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),n=this._def.values;return K(t,{expected:Be.joinValues(n),received:t.parsedType,code:H.invalid_type}),xe}if(Nd(this,Vo)||GP(this,Vo,new Set(this._def.values)),!Nd(this,Vo).has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return K(t,{received:t.data,code:H.invalid_enum_value,options:n}),xe}return cn(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return $s.create(e,{...this._def,...t})}exclude(e,t=this._def){return $s.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}}Vo=new WeakMap;$s.create=XP;class Ll extends Te{constructor(){super(...arguments),Go.set(this,void 0)}_parse(e){const t=Be.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==Q.string&&n.parsedType!==Q.number){const s=Be.objectValues(t);return K(n,{expected:Be.joinValues(s),received:n.parsedType,code:H.invalid_type}),xe}if(Nd(this,Go)||GP(this,Go,new Set(Be.getValidEnumValues(this._def.values))),!Nd(this,Go).has(e.data)){const s=Be.objectValues(t);return K(n,{received:n.data,code:H.invalid_enum_value,options:s}),xe}return cn(e.data)}get enum(){return this._def.values}}Go=new WeakMap;Ll.create=(r,e)=>new Ll({values:r,typeName:L.ZodNativeEnum,...Pe(e)});class $a extends Te{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Q.promise&&t.common.async===!1)return K(t,{code:H.invalid_type,expected:Q.promise,received:t.parsedType}),xe;const n=t.parsedType===Q.promise?t.data:Promise.resolve(t.data);return cn(n.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}$a.create=(r,e)=>new $a({type:r,typeName:L.ZodPromise,...Pe(e)});class or extends Te{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===L.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:a=>{K(n,a),a.fatal?t.abort():t.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){const a=s.transform(n.data,i);if(n.common.async)return Promise.resolve(a).then(async o=>{if(t.value==="aborted")return xe;const l=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return l.status==="aborted"?xe:l.status==="dirty"||t.value==="dirty"?ta(l.value):l});{if(t.value==="aborted")return xe;const o=this._def.schema._parseSync({data:a,path:n.path,parent:n});return o.status==="aborted"?xe:o.status==="dirty"||t.value==="dirty"?ta(o.value):o}}if(s.type==="refinement"){const a=o=>{const l=s.refinement(o,i);if(n.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?xe:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?xe:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(n.common.async===!1){const a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!wi(a))return a;const o=s.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>wi(a)?Promise.resolve(s.transform(a.value,i)).then(o=>({status:t.value,value:o})):a);Be.assertNever(s)}}or.create=(r,e,t)=>new or({schema:r,typeName:L.ZodEffects,effect:e,...Pe(t)});or.createWithPreprocess=(r,e,t)=>new or({schema:e,effect:{type:"preprocess",transform:r},typeName:L.ZodEffects,...Pe(t)});class rr extends Te{_parse(e){return this._getType(e)===Q.undefined?cn(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}rr.create=(r,e)=>new rr({innerType:r,typeName:L.ZodOptional,...Pe(e)});class Ms extends Te{_parse(e){return this._getType(e)===Q.null?cn(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ms.create=(r,e)=>new Ms({innerType:r,typeName:L.ZodNullable,...Pe(e)});class jl extends Te{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===Q.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}jl.create=(r,e)=>new jl({innerType:r,typeName:L.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Pe(e)});class Dl extends Te{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return El(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Tn(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Tn(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}Dl.create=(r,e)=>new Dl({innerType:r,typeName:L.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Pe(e)});class Fd extends Te{_parse(e){if(this._getType(e)!==Q.nan){const n=this._getOrReturnCtx(e);return K(n,{code:H.invalid_type,expected:Q.nan,received:n.parsedType}),xe}return{status:"valid",value:e.data}}}Fd.create=r=>new Fd({typeName:L.ZodNaN,...Pe(r)});const sD=Symbol("zod_brand");class R_ extends Te{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class Oc extends Te{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?xe:i.status==="dirty"?(t.dirty(),ta(i.value)):this._def.out._parseAsync({data:i.value,path:n.path,parent:n})})();{const s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?xe:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,t){return new Oc({in:e,out:t,typeName:L.ZodPipeline})}}class Fl extends Te{_parse(e){const t=this._def.innerType._parse(e),n=s=>(wi(s)&&(s.value=Object.freeze(s.value)),s);return El(t)?t.then(s=>n(s)):n(t)}unwrap(){return this._def.innerType}}Fl.create=(r,e)=>new Fl({innerType:r,typeName:L.ZodReadonly,...Pe(e)});function t0(r,e){const t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function YP(r,e={},t){return r?Ca.create().superRefine((n,s)=>{var i,a;const o=r(n);if(o instanceof Promise)return o.then(l=>{var c,u;if(!l){const d=t0(e,n),h=(u=(c=d.fatal)!==null&&c!==void 0?c:t)!==null&&u!==void 0?u:!0;s.addIssue({code:"custom",...d,fatal:h})}});if(!o){const l=t0(e,n),c=(a=(i=l.fatal)!==null&&i!==void 0?i:t)!==null&&a!==void 0?a:!0;s.addIssue({code:"custom",...l,fatal:c})}}):Ca.create()}const iD={object:pt.lazycreate};var L;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(L||(L={}));const aD=(r,e={message:`Input not instance of ${r.name}`})=>YP(t=>t instanceof r,e),QP=Yn.create,eA=Is.create,oD=Fd.create,lD=Cs.create,tA=Ol.create,cD=vi.create,uD=Ld.create,dD=Tl.create,hD=Rl.create,fD=Ca.create,pD=hi.create,mD=ts.create,gD=jd.create,bD=nr.create,_D=pt.create,yD=pt.strictCreate,wD=Il.create,vD=Gh.create,xD=Cl.create,kD=Tr.create,SD=$l.create,PD=Dd.create,AD=xi.create,ED=fa.create,OD=Ml.create,TD=Nl.create,RD=$s.create,ID=Ll.create,CD=$a.create,n0=or.create,$D=rr.create,MD=Ms.create,ND=or.createWithPreprocess,LD=Oc.create,jD=()=>QP().optional(),DD=()=>eA().optional(),FD=()=>tA().optional(),zD={string:r=>Yn.create({...r,coerce:!0}),number:r=>Is.create({...r,coerce:!0}),boolean:r=>Ol.create({...r,coerce:!0}),bigint:r=>Cs.create({...r,coerce:!0}),date:r=>vi.create({...r,coerce:!0})},BD=xe;var He=Object.freeze({__proto__:null,defaultErrorMap:Ia,setErrorMap:Nj,getErrorMap:$d,makeIssue:Md,EMPTY_PATH:Lj,addIssueToContext:K,ParseStatus:Yt,INVALID:xe,DIRTY:ta,OK:cn,isAborted:Hg,isDirty:Wg,isValid:wi,isAsync:El,get util(){return Be},get objectUtil(){return qg},ZodParsedType:Q,getParsedType:Vr,ZodType:Te,datetimeRegex:KP,ZodString:Yn,ZodNumber:Is,ZodBigInt:Cs,ZodBoolean:Ol,ZodDate:vi,ZodSymbol:Ld,ZodUndefined:Tl,ZodNull:Rl,ZodAny:Ca,ZodUnknown:hi,ZodNever:ts,ZodVoid:jd,ZodArray:nr,ZodObject:pt,ZodUnion:Il,ZodDiscriminatedUnion:Gh,ZodIntersection:Cl,ZodTuple:Tr,ZodRecord:$l,ZodMap:Dd,ZodSet:xi,ZodFunction:fa,ZodLazy:Ml,ZodLiteral:Nl,ZodEnum:$s,ZodNativeEnum:Ll,ZodPromise:$a,ZodEffects:or,ZodTransformer:or,ZodOptional:rr,ZodNullable:Ms,ZodDefault:jl,ZodCatch:Dl,ZodNaN:Fd,BRAND:sD,ZodBranded:R_,ZodPipeline:Oc,ZodReadonly:Fl,custom:YP,Schema:Te,ZodSchema:Te,late:iD,get ZodFirstPartyTypeKind(){return L},coerce:zD,any:fD,array:bD,bigint:lD,boolean:tA,date:cD,discriminatedUnion:vD,effect:n0,enum:RD,function:ED,instanceof:aD,intersection:xD,lazy:OD,literal:TD,map:PD,nan:oD,nativeEnum:ID,never:mD,null:hD,nullable:MD,number:eA,object:_D,oboolean:FD,onumber:DD,optional:$D,ostring:jD,pipeline:LD,preprocess:ND,promise:CD,record:SD,set:AD,strictObject:yD,string:QP,symbol:uD,transformer:n0,tuple:kD,undefined:dD,union:wD,unknown:pD,void:gD,NEVER:BD,ZodIssueCode:H,quotelessJson:Mj,ZodError:Tn}),fo={exports:{}},hp={},fp,r0;function UD(){if(r0)return fp;r0=1;function r(e,t){typeof t=="boolean"&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return fp=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(n===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1);else return!1;var s=this;return this._timer=setTimeout(function(){s._attempts++,s._operationTimeoutCb&&(s._timeout=setTimeout(function(){s._operationTimeoutCb(s._attempts)},s._operationTimeout),s._options.unref&&s._timeout.unref()),s._fn(s._attempts)},n),this._options.unref&&this._timer.unref(),!0},r.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},r.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},r.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},t=null,n=0,s=0;s<this._errors.length;s++){var i=this._errors[s],a=i.message,o=(e[a]||0)+1;e[a]=o,o>=n&&(t=i,n=o)}return t},fp}var s0;function qD(){return s0||(s0=1,function(r){var e=UD();r.operation=function(t){var n=r.timeouts(t);return new e(n,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},r.timeouts=function(t){if(t instanceof Array)return[].concat(t);var n={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var s in t)n[s]=t[s];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var i=[],a=0;a<n.retries;a++)i.push(this.createTimeout(a,n));return t&&t.forever&&!i.length&&i.push(this.createTimeout(a,n)),i.sort(function(o,l){return o-l}),i},r.createTimeout=function(t,n){var s=n.randomize?Math.random()+1:1,i=Math.round(s*Math.max(n.minTimeout,1)*Math.pow(n.factor,t));return i=Math.min(i,n.maxTimeout),i},r.wrap=function(t,n,s){if(n instanceof Array&&(s=n,n=null),!s){s=[];for(var i in t)typeof t[i]=="function"&&s.push(i)}for(var a=0;a<s.length;a++){var o=s[a],l=t[o];t[o]=(function(u){var d=r.operation(n),h=Array.prototype.slice.call(arguments,1),f=h.pop();h.push(function(p){d.retry(p)||(p&&(arguments[0]=d.mainError()),f.apply(this,arguments))}),d.attempt(function(){u.apply(t,h)})}).bind(t,l),t[o].options=n}}}(hp)),hp}var pp,i0;function HD(){return i0||(i0=1,pp=qD()),pp}var a0;function WD(){if(a0)return fo.exports;a0=1;const r=HD(),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class t extends Error{constructor(o){super(),o instanceof Error?(this.originalError=o,{message:o}=o):(this.originalError=new Error(o),this.originalError.stack=this.stack),this.name="AbortError",this.message=o}}const n=(a,o,l)=>{const c=l.retries-(o-1);return a.attemptNumber=o,a.retriesLeft=c,a},s=a=>e.includes(a),i=(a,o)=>new Promise((l,c)=>{o={onFailedAttempt:()=>{},retries:10,...o};const u=r.operation(o);u.attempt(async d=>{try{l(await a(d))}catch(h){if(!(h instanceof Error)){c(new TypeError(`Non-error was thrown: "${h}". You should only throw errors.`));return}if(h instanceof t)u.stop(),c(h.originalError);else if(h instanceof TypeError&&!s(h.message))u.stop(),c(h);else{n(h,d,o);try{await o.onFailedAttempt(h)}catch(f){c(f);return}u.retry(h)||c(u.mainError())}}})});return fo.exports=i,fo.exports.default=i,fo.exports.AbortError=t,fo.exports}var VD=WD();const zd=Pi(VD),GD=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function rl(r){return typeof r=="string"&&GD.test(r)}var Ft=[];for(var mp=0;mp<256;++mp)Ft.push((mp+256).toString(16).slice(1));function ZD(r,e=0){return(Ft[r[e+0]]+Ft[r[e+1]]+Ft[r[e+2]]+Ft[r[e+3]]+"-"+Ft[r[e+4]]+Ft[r[e+5]]+"-"+Ft[r[e+6]]+Ft[r[e+7]]+"-"+Ft[r[e+8]]+Ft[r[e+9]]+"-"+Ft[r[e+10]]+Ft[r[e+11]]+Ft[r[e+12]]+Ft[r[e+13]]+Ft[r[e+14]]+Ft[r[e+15]]).toLowerCase()}var _u,JD=new Uint8Array(16);function KD(){if(!_u&&(_u=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!_u))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return _u(JD)}var XD=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const o0={randomUUID:XD};function sn(r,e,t){if(o0.randomUUID&&!r)return o0.randomUUID();r=r||{};var n=r.random||(r.rng||KD)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,ZD(n)}var yu={},gp={exports:{}},l0;function YD(){return l0||(l0=1,function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function s(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function i(l,c,u,d,h){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new s(u,d||l,h),p=t?t+c:c;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],f]:l._events[p].push(f):(l._events[p]=f,l._eventsCount++),l}function a(l,c){--l._eventsCount===0?l._events=new n:delete l._events[c]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],u,d;if(this._eventsCount===0)return c;for(d in u=this._events)e.call(u,d)&&c.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},o.prototype.listeners=function(c){var u=t?t+c:c,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,f=d.length,p=new Array(f);h<f;h++)p[h]=d[h].fn;return p},o.prototype.listenerCount=function(c){var u=t?t+c:c,d=this._events[u];return d?d.fn?1:d.length:0},o.prototype.emit=function(c,u,d,h,f,p){var m=t?t+c:c;if(!this._events[m])return!1;var g=this._events[m],b=arguments.length,_,y;if(g.fn){switch(g.once&&this.removeListener(c,g.fn,void 0,!0),b){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,u),!0;case 3:return g.fn.call(g.context,u,d),!0;case 4:return g.fn.call(g.context,u,d,h),!0;case 5:return g.fn.call(g.context,u,d,h,f),!0;case 6:return g.fn.call(g.context,u,d,h,f,p),!0}for(y=1,_=new Array(b-1);y<b;y++)_[y-1]=arguments[y];g.fn.apply(g.context,_)}else{var w=g.length,v;for(y=0;y<w;y++)switch(g[y].once&&this.removeListener(c,g[y].fn,void 0,!0),b){case 1:g[y].fn.call(g[y].context);break;case 2:g[y].fn.call(g[y].context,u);break;case 3:g[y].fn.call(g[y].context,u,d);break;case 4:g[y].fn.call(g[y].context,u,d,h);break;default:if(!_)for(v=1,_=new Array(b-1);v<b;v++)_[v-1]=arguments[v];g[y].fn.apply(g[y].context,_)}}return!0},o.prototype.on=function(c,u,d){return i(this,c,u,d,!1)},o.prototype.once=function(c,u,d){return i(this,c,u,d,!0)},o.prototype.removeListener=function(c,u,d,h){var f=t?t+c:c;if(!this._events[f])return this;if(!u)return a(this,f),this;var p=this._events[f];if(p.fn)p.fn===u&&(!h||p.once)&&(!d||p.context===d)&&a(this,f);else{for(var m=0,g=[],b=p.length;m<b;m++)(p[m].fn!==u||h&&!p[m].once||d&&p[m].context!==d)&&g.push(p[m]);g.length?this._events[f]=g.length===1?g[0]:g:a(this,f)}return this},o.prototype.removeAllListeners=function(c){var u;return c?(u=t?t+c:c,this._events[u]&&a(this,u)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,r.exports=o}(gp)),gp.exports}var po={exports:{}},bp,c0;function QD(){return c0||(c0=1,bp=(r,e)=>(e=e||(()=>{}),r.then(t=>new Promise(n=>{n(e())}).then(()=>t),t=>new Promise(n=>{n(e())}).then(()=>{throw t})))),bp}var u0;function eF(){if(u0)return po.exports;u0=1;const r=QD();class e extends Error{constructor(s){super(s),this.name="TimeoutError"}}const t=(n,s,i)=>new Promise((a,o)=>{if(typeof s!="number"||s<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(s===1/0){a(n);return}const l=setTimeout(()=>{if(typeof i=="function"){try{a(i())}catch(d){o(d)}return}const c=typeof i=="string"?i:`Promise timed out after ${s} milliseconds`,u=i instanceof Error?i:new e(c);typeof n.cancel=="function"&&n.cancel(),o(u)},s);r(n.then(a,o),()=>{clearTimeout(l)})});return po.exports=t,po.exports.default=t,po.exports.TimeoutError=e,po.exports}var wu={},vu={},d0;function tF(){if(d0)return vu;d0=1,Object.defineProperty(vu,"__esModule",{value:!0});function r(e,t,n){let s=0,i=e.length;for(;i>0;){const a=i/2|0;let o=s+a;n(e[o],t)<=0?(s=++o,i-=a+1):i=a}return s}return vu.default=r,vu}var h0;function nF(){if(h0)return wu;h0=1,Object.defineProperty(wu,"__esModule",{value:!0});const r=tF();class e{constructor(){this._queue=[]}enqueue(n,s){s=Object.assign({priority:0},s);const i={priority:s.priority,run:n};if(this.size&&this._queue[this.size-1].priority>=s.priority){this._queue.push(i);return}const a=r.default(this._queue,i,(o,l)=>l.priority-o.priority);this._queue.splice(a,0,i)}dequeue(){const n=this._queue.shift();return n==null?void 0:n.run}filter(n){return this._queue.filter(s=>s.priority===n.priority).map(s=>s.run)}get size(){return this._queue.length}}return wu.default=e,wu}var f0;function rF(){if(f0)return yu;f0=1,Object.defineProperty(yu,"__esModule",{value:!0});const r=YD(),e=eF(),t=nF(),n=()=>{},s=new e.TimeoutError;class i extends r{constructor(o){var l,c,u,d;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=n,this._resolveIdle=n,o=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:t.default},o),!(typeof o.intervalCap=="number"&&o.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(c=(l=o.intervalCap)===null||l===void 0?void 0:l.toString())!==null&&c!==void 0?c:""}\` (${typeof o.intervalCap})`);if(o.interval===void 0||!(Number.isFinite(o.interval)&&o.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(d=(u=o.interval)===null||u===void 0?void 0:u.toString())!==null&&d!==void 0?d:""}\` (${typeof o.interval})`);this._carryoverConcurrencyCount=o.carryoverConcurrencyCount,this._isIntervalIgnored=o.intervalCap===1/0||o.interval===0,this._intervalCap=o.intervalCap,this._interval=o.interval,this._queue=new o.queueClass,this._queueClass=o.queueClass,this.concurrency=o.concurrency,this._timeout=o.timeout,this._throwOnTimeout=o.throwOnTimeout===!0,this._isPaused=o.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=n,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=n,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const o=Date.now();if(this._intervalId===void 0){const l=this._intervalEnd-o;if(l<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},l)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const o=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const l=this._queue.dequeue();return l?(this.emit("active"),l(),o&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(o){if(!(typeof o=="number"&&o>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${o}\` (${typeof o})`);this._concurrency=o,this._processQueue()}async add(o,l={}){return new Promise((c,u)=>{const d=async()=>{this._pendingCount++,this._intervalCount++;try{const h=this._timeout===void 0&&l.timeout===void 0?o():e.default(Promise.resolve(o()),l.timeout===void 0?this._timeout:l.timeout,()=>{(l.throwOnTimeout===void 0?this._throwOnTimeout:l.throwOnTimeout)&&u(s)});c(await h)}catch(h){u(h)}this._next()};this._queue.enqueue(d,l),this._tryToStartAnother(),this.emit("add")})}async addAll(o,l){return Promise.all(o.map(async c=>this.add(c,l)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(o=>{const l=this._resolveEmpty;this._resolveEmpty=()=>{l(),o()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(o=>{const l=this._resolveIdle;this._resolveIdle=()=>{l(),o()}})}get size(){return this._queue.size}sizeBy(o){return this._queue.filter(o).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(o){this._timeout=o}}return yu.default=i,yu}var sF=rF();const Qr=Pi(sF),iF=(...r)=>fetch(...r),aF=Symbol.for("ls:fetch_implementation"),fe=()=>globalThis[aF]??iF,oF=[400,401,403,404,405,406,407,408],lF=[409];let p0=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in Qr?this.queue=new Qr.default({concurrency:this.maxConcurrency}):this.queue=new Qr({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...t){const n=this.onFailedResponseHook;return this.queue.add(()=>zd(()=>e(...t).catch(s=>{throw s instanceof Error?s:new Error(s)}),{async onFailedAttempt(s){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.message.startsWith("AbortError")||(s==null?void 0:s.code)==="ECONNABORTED")throw s;const i=s==null?void 0:s.response,a=i==null?void 0:i.status;if(a){if(oF.includes(+a))throw s;if(lF.includes(+a))return;n&&await n(i)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>fe()(...e).then(t=>t.ok?t:Promise.reject(t)))}};function m0(r){return typeof(r==null?void 0:r._getType)=="function"}function g0(r){const e={type:r._getType(),data:{content:r.content}};return r!=null&&r.additional_kwargs&&Object.keys(r.additional_kwargs).length>0&&(e.data.additional_kwargs={...r.additional_kwargs}),e}function Ee(r,e){if(!rl(r)){const t=e!==void 0?`Invalid UUID for ${e}: ${r}`:`Invalid UUID: ${r}`;throw new Error(t)}return r}const b0={};function nA(r){b0[r]||(console.warn(r),b0[r]=!0)}var xu={exports:{}},_p,_0;function Zh(){if(_0)return _p;_0=1;const r="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,n=16,s=e-6;return _p={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:s,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:r,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},_p}var yp,y0;function Jh(){if(y0)return yp;y0=1;var r={};return yp=typeof process=="object"&&r&&r.NODE_DEBUG&&/\bsemver\b/i.test(r.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{},yp}var w0;function Tc(){return w0||(w0=1,function(r,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:s}=Zh(),i=Jh();e=r.exports={};const a=e.re=[],o=e.safeRe=[],l=e.src=[],c=e.safeSrc=[],u=e.t={};let d=0;const h="[a-zA-Z0-9-]",f=[["\\s",1],["\\d",s],[h,n]],p=g=>{for(const[b,_]of f)g=g.split(`${b}*`).join(`${b}{0,${_}}`).split(`${b}+`).join(`${b}{1,${_}}`);return g},m=(g,b,_)=>{const y=p(b),w=d++;i(g,w,b),u[g]=w,l[w]=b,c[w]=y,a[w]=new RegExp(b,_?"g":void 0),o[w]=new RegExp(y,_?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${h}*`),m("MAINVERSION",`(${l[u.NUMERICIDENTIFIER]})\\.(${l[u.NUMERICIDENTIFIER]})\\.(${l[u.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${l[u.NUMERICIDENTIFIERLOOSE]})\\.(${l[u.NUMERICIDENTIFIERLOOSE]})\\.(${l[u.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${l[u.NUMERICIDENTIFIER]}|${l[u.NONNUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${l[u.NUMERICIDENTIFIERLOOSE]}|${l[u.NONNUMERICIDENTIFIER]})`),m("PRERELEASE",`(?:-(${l[u.PRERELEASEIDENTIFIER]}(?:\\.${l[u.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${l[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[u.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${h}+`),m("BUILD",`(?:\\+(${l[u.BUILDIDENTIFIER]}(?:\\.${l[u.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${l[u.MAINVERSION]}${l[u.PRERELEASE]}?${l[u.BUILD]}?`),m("FULL",`^${l[u.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${l[u.MAINVERSIONLOOSE]}${l[u.PRERELEASELOOSE]}?${l[u.BUILD]}?`),m("LOOSE",`^${l[u.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${l[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${l[u.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${l[u.XRANGEIDENTIFIER]})(?:\\.(${l[u.XRANGEIDENTIFIER]})(?:\\.(${l[u.XRANGEIDENTIFIER]})(?:${l[u.PRERELEASE]})?${l[u.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${l[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[u.XRANGEIDENTIFIERLOOSE]})(?:${l[u.PRERELEASELOOSE]})?${l[u.BUILD]}?)?)?`),m("XRANGE",`^${l[u.GTLT]}\\s*${l[u.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${l[u.GTLT]}\\s*${l[u.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),m("COERCE",`${l[u.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",l[u.COERCEPLAIN]+`(?:${l[u.PRERELEASE]})?(?:${l[u.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",l[u.COERCE],!0),m("COERCERTLFULL",l[u.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${l[u.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",m("TILDE",`^${l[u.LONETILDE]}${l[u.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${l[u.LONETILDE]}${l[u.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${l[u.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",m("CARET",`^${l[u.LONECARET]}${l[u.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${l[u.LONECARET]}${l[u.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${l[u.GTLT]}\\s*(${l[u.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${l[u.GTLT]}\\s*(${l[u.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${l[u.GTLT]}\\s*(${l[u.LOOSEPLAIN]}|${l[u.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${l[u.XRANGEPLAIN]})\\s+-\\s+(${l[u.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${l[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[u.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(xu,xu.exports)),xu.exports}var wp,v0;function I_(){if(v0)return wp;v0=1;const r=Object.freeze({loose:!0}),e=Object.freeze({});return wp=n=>n?typeof n!="object"?r:n:e,wp}var vp,x0;function rA(){if(x0)return vp;x0=1;const r=/^[0-9]+$/,e=(n,s)=>{const i=r.test(n),a=r.test(s);return i&&a&&(n=+n,s=+s),n===s?0:i&&!a?-1:a&&!i?1:n<s?-1:1};return vp={compareIdentifiers:e,rcompareIdentifiers:(n,s)=>e(s,n)},vp}var xp,k0;function un(){if(k0)return xp;k0=1;const r=Jh(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=Zh(),{safeRe:n,safeSrc:s,t:i}=Tc(),a=I_(),{compareIdentifiers:o}=rA();class l{constructor(u,d){if(d=a(d),u instanceof l){if(u.loose===!!d.loose&&u.includePrerelease===!!d.includePrerelease)return u;u=u.version}else if(typeof u!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof u}".`);if(u.length>e)throw new TypeError(`version is longer than ${e} characters`);r("SemVer",u,d),this.options=d,this.loose=!!d.loose,this.includePrerelease=!!d.includePrerelease;const h=u.trim().match(d.loose?n[i.LOOSE]:n[i.FULL]);if(!h)throw new TypeError(`Invalid Version: ${u}`);if(this.raw=u,this.major=+h[1],this.minor=+h[2],this.patch=+h[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");h[4]?this.prerelease=h[4].split(".").map(f=>{if(/^[0-9]+$/.test(f)){const p=+f;if(p>=0&&p<t)return p}return f}):this.prerelease=[],this.build=h[5]?h[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(u){if(r("SemVer.compare",this.version,this.options,u),!(u instanceof l)){if(typeof u=="string"&&u===this.version)return 0;u=new l(u,this.options)}return u.version===this.version?0:this.compareMain(u)||this.comparePre(u)}compareMain(u){return u instanceof l||(u=new l(u,this.options)),o(this.major,u.major)||o(this.minor,u.minor)||o(this.patch,u.patch)}comparePre(u){if(u instanceof l||(u=new l(u,this.options)),this.prerelease.length&&!u.prerelease.length)return-1;if(!this.prerelease.length&&u.prerelease.length)return 1;if(!this.prerelease.length&&!u.prerelease.length)return 0;let d=0;do{const h=this.prerelease[d],f=u.prerelease[d];if(r("prerelease compare",d,h,f),h===void 0&&f===void 0)return 0;if(f===void 0)return 1;if(h===void 0)return-1;if(h===f)continue;return o(h,f)}while(++d)}compareBuild(u){u instanceof l||(u=new l(u,this.options));let d=0;do{const h=this.build[d],f=u.build[d];if(r("build compare",d,h,f),h===void 0&&f===void 0)return 0;if(f===void 0)return 1;if(h===void 0)return-1;if(h===f)continue;return o(h,f)}while(++d)}inc(u,d,h){if(u.startsWith("pre")){if(!d&&h===!1)throw new Error("invalid increment argument: identifier is empty");if(d){const f=new RegExp(`^${this.options.loose?s[i.PRERELEASELOOSE]:s[i.PRERELEASE]}$`),p=`-${d}`.match(f);if(!p||p[1]!==d)throw new Error(`invalid identifier: ${d}`)}}switch(u){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",d,h);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",d,h);break;case"prepatch":this.prerelease.length=0,this.inc("patch",d,h),this.inc("pre",d,h);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",d,h),this.inc("pre",d,h);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const f=Number(h)?1:0;if(this.prerelease.length===0)this.prerelease=[f];else{let p=this.prerelease.length;for(;--p>=0;)typeof this.prerelease[p]=="number"&&(this.prerelease[p]++,p=-2);if(p===-1){if(d===this.prerelease.join(".")&&h===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(f)}}if(d){let p=[d,f];h===!1&&(p=[d]),o(this.prerelease[0],d)===0?isNaN(this.prerelease[1])&&(this.prerelease=p):this.prerelease=p}break}default:throw new Error(`invalid increment argument: ${u}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return xp=l,xp}var kp,S0;function Ga(){if(S0)return kp;S0=1;const r=un();return kp=(t,n,s=!1)=>{if(t instanceof r)return t;try{return new r(t,n)}catch(i){if(!s)return null;throw i}},kp}var Sp,P0;function cF(){if(P0)return Sp;P0=1;const r=Ga();return Sp=(t,n)=>{const s=r(t,n);return s?s.version:null},Sp}var Pp,A0;function uF(){if(A0)return Pp;A0=1;const r=Ga();return Pp=(t,n)=>{const s=r(t.trim().replace(/^[=v]+/,""),n);return s?s.version:null},Pp}var Ap,E0;function dF(){if(E0)return Ap;E0=1;const r=un();return Ap=(t,n,s,i,a)=>{typeof s=="string"&&(a=i,i=s,s=void 0);try{return new r(t instanceof r?t.version:t,s).inc(n,i,a).version}catch{return null}},Ap}var Ep,O0;function hF(){if(O0)return Ep;O0=1;const r=Ga();return Ep=(t,n)=>{const s=r(t,null,!0),i=r(n,null,!0),a=s.compare(i);if(a===0)return null;const o=a>0,l=o?s:i,c=o?i:s,u=!!l.prerelease.length;if(!!c.prerelease.length&&!u){if(!c.patch&&!c.minor)return"major";if(c.compareMain(l)===0)return c.minor&&!c.patch?"minor":"patch"}const h=u?"pre":"";return s.major!==i.major?h+"major":s.minor!==i.minor?h+"minor":s.patch!==i.patch?h+"patch":"prerelease"},Ep}var Op,T0;function fF(){if(T0)return Op;T0=1;const r=un();return Op=(t,n)=>new r(t,n).major,Op}var Tp,R0;function pF(){if(R0)return Tp;R0=1;const r=un();return Tp=(t,n)=>new r(t,n).minor,Tp}var Rp,I0;function mF(){if(I0)return Rp;I0=1;const r=un();return Rp=(t,n)=>new r(t,n).patch,Rp}var Ip,C0;function gF(){if(C0)return Ip;C0=1;const r=Ga();return Ip=(t,n)=>{const s=r(t,n);return s&&s.prerelease.length?s.prerelease:null},Ip}var Cp,$0;function ur(){if($0)return Cp;$0=1;const r=un();return Cp=(t,n,s)=>new r(t,s).compare(new r(n,s)),Cp}var $p,M0;function bF(){if(M0)return $p;M0=1;const r=ur();return $p=(t,n,s)=>r(n,t,s),$p}var Mp,N0;function _F(){if(N0)return Mp;N0=1;const r=ur();return Mp=(t,n)=>r(t,n,!0),Mp}var Np,L0;function C_(){if(L0)return Np;L0=1;const r=un();return Np=(t,n,s)=>{const i=new r(t,s),a=new r(n,s);return i.compare(a)||i.compareBuild(a)},Np}var Lp,j0;function yF(){if(j0)return Lp;j0=1;const r=C_();return Lp=(t,n)=>t.sort((s,i)=>r(s,i,n)),Lp}var jp,D0;function wF(){if(D0)return jp;D0=1;const r=C_();return jp=(t,n)=>t.sort((s,i)=>r(i,s,n)),jp}var Dp,F0;function Kh(){if(F0)return Dp;F0=1;const r=ur();return Dp=(t,n,s)=>r(t,n,s)>0,Dp}var Fp,z0;function $_(){if(z0)return Fp;z0=1;const r=ur();return Fp=(t,n,s)=>r(t,n,s)<0,Fp}var zp,B0;function sA(){if(B0)return zp;B0=1;const r=ur();return zp=(t,n,s)=>r(t,n,s)===0,zp}var Bp,U0;function iA(){if(U0)return Bp;U0=1;const r=ur();return Bp=(t,n,s)=>r(t,n,s)!==0,Bp}var Up,q0;function M_(){if(q0)return Up;q0=1;const r=ur();return Up=(t,n,s)=>r(t,n,s)>=0,Up}var qp,H0;function N_(){if(H0)return qp;H0=1;const r=ur();return qp=(t,n,s)=>r(t,n,s)<=0,qp}var Hp,W0;function aA(){if(W0)return Hp;W0=1;const r=sA(),e=iA(),t=Kh(),n=M_(),s=$_(),i=N_();return Hp=(o,l,c,u)=>{switch(l){case"===":return typeof o=="object"&&(o=o.version),typeof c=="object"&&(c=c.version),o===c;case"!==":return typeof o=="object"&&(o=o.version),typeof c=="object"&&(c=c.version),o!==c;case"":case"=":case"==":return r(o,c,u);case"!=":return e(o,c,u);case">":return t(o,c,u);case">=":return n(o,c,u);case"<":return s(o,c,u);case"<=":return i(o,c,u);default:throw new TypeError(`Invalid operator: ${l}`)}},Hp}var Wp,V0;function vF(){if(V0)return Wp;V0=1;const r=un(),e=Ga(),{safeRe:t,t:n}=Tc();return Wp=(i,a)=>{if(i instanceof r)return i;if(typeof i=="number"&&(i=String(i)),typeof i!="string")return null;a=a||{};let o=null;if(!a.rtl)o=i.match(a.includePrerelease?t[n.COERCEFULL]:t[n.COERCE]);else{const f=a.includePrerelease?t[n.COERCERTLFULL]:t[n.COERCERTL];let p;for(;(p=f.exec(i))&&(!o||o.index+o[0].length!==i.length);)(!o||p.index+p[0].length!==o.index+o[0].length)&&(o=p),f.lastIndex=p.index+p[1].length+p[2].length;f.lastIndex=-1}if(o===null)return null;const l=o[2],c=o[3]||"0",u=o[4]||"0",d=a.includePrerelease&&o[5]?`-${o[5]}`:"",h=a.includePrerelease&&o[6]?`+${o[6]}`:"";return e(`${l}.${c}.${u}${d}${h}`,a)},Wp}var Vp,G0;function xF(){if(G0)return Vp;G0=1;class r{constructor(){this.max=1e3,this.map=new Map}get(t){const n=this.map.get(t);if(n!==void 0)return this.map.delete(t),this.map.set(t,n),n}delete(t){return this.map.delete(t)}set(t,n){if(!this.delete(t)&&n!==void 0){if(this.map.size>=this.max){const i=this.map.keys().next().value;this.delete(i)}this.map.set(t,n)}return this}}return Vp=r,Vp}var Gp,Z0;function dr(){if(Z0)return Gp;Z0=1;const r=/\s+/g;class e{constructor(E,O){if(O=s(O),E instanceof e)return E.loose===!!O.loose&&E.includePrerelease===!!O.includePrerelease?E:new e(E.raw,O);if(E instanceof i)return this.raw=E.value,this.set=[[E]],this.formatted=void 0,this;if(this.options=O,this.loose=!!O.loose,this.includePrerelease=!!O.includePrerelease,this.raw=E.trim().replace(r," "),this.set=this.raw.split("||").map(I=>this.parseRange(I.trim())).filter(I=>I.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const I=this.set[0];if(this.set=this.set.filter(T=>!m(T[0])),this.set.length===0)this.set=[I];else if(this.set.length>1){for(const T of this.set)if(T.length===1&&g(T[0])){this.set=[T];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let E=0;E<this.set.length;E++){E>0&&(this.formatted+="||");const O=this.set[E];for(let I=0;I<O.length;I++)I>0&&(this.formatted+=" "),this.formatted+=O[I].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(E){const I=((this.options.includePrerelease&&f)|(this.options.loose&&p))+":"+E,T=n.get(I);if(T)return T;const j=this.options.loose,W=j?l[c.HYPHENRANGELOOSE]:l[c.HYPHENRANGE];E=E.replace(W,N(this.options.includePrerelease)),a("hyphen replace",E),E=E.replace(l[c.COMPARATORTRIM],u),a("comparator trim",E),E=E.replace(l[c.TILDETRIM],d),a("tilde trim",E),E=E.replace(l[c.CARETTRIM],h),a("caret trim",E);let ee=E.split(" ").map(G=>_(G,this.options)).join(" ").split(/\s+/).map(G=>C(G,this.options));j&&(ee=ee.filter(G=>(a("loose invalid filter",G,this.options),!!G.match(l[c.COMPARATORLOOSE])))),a("range list",ee);const Z=new Map,X=ee.map(G=>new i(G,this.options));for(const G of X){if(m(G))return[G];Z.set(G.value,G)}Z.size>1&&Z.has("")&&Z.delete("");const U=[...Z.values()];return n.set(I,U),U}intersects(E,O){if(!(E instanceof e))throw new TypeError("a Range is required");return this.set.some(I=>b(I,O)&&E.set.some(T=>b(T,O)&&I.every(j=>T.every(W=>j.intersects(W,O)))))}test(E){if(!E)return!1;if(typeof E=="string")try{E=new o(E,this.options)}catch{return!1}for(let O=0;O<this.set.length;O++)if($(this.set[O],E,this.options))return!0;return!1}}Gp=e;const t=xF(),n=new t,s=I_(),i=Xh(),a=Jh(),o=un(),{safeRe:l,t:c,comparatorTrimReplace:u,tildeTrimReplace:d,caretTrimReplace:h}=Tc(),{FLAG_INCLUDE_PRERELEASE:f,FLAG_LOOSE:p}=Zh(),m=P=>P.value==="<0.0.0-0",g=P=>P.value==="",b=(P,E)=>{let O=!0;const I=P.slice();let T=I.pop();for(;O&&I.length;)O=I.every(j=>T.intersects(j,E)),T=I.pop();return O},_=(P,E)=>(a("comp",P,E),P=x(P,E),a("caret",P),P=w(P,E),a("tildes",P),P=k(P,E),a("xrange",P),P=D(P,E),a("stars",P),P),y=P=>!P||P.toLowerCase()==="x"||P==="*",w=(P,E)=>P.trim().split(/\s+/).map(O=>v(O,E)).join(" "),v=(P,E)=>{const O=E.loose?l[c.TILDELOOSE]:l[c.TILDE];return P.replace(O,(I,T,j,W,ee)=>{a("tilde",P,I,T,j,W,ee);let Z;return y(T)?Z="":y(j)?Z=`>=${T}.0.0 <${+T+1}.0.0-0`:y(W)?Z=`>=${T}.${j}.0 <${T}.${+j+1}.0-0`:ee?(a("replaceTilde pr",ee),Z=`>=${T}.${j}.${W}-${ee} <${T}.${+j+1}.0-0`):Z=`>=${T}.${j}.${W} <${T}.${+j+1}.0-0`,a("tilde return",Z),Z})},x=(P,E)=>P.trim().split(/\s+/).map(O=>S(O,E)).join(" "),S=(P,E)=>{a("caret",P,E);const O=E.loose?l[c.CARETLOOSE]:l[c.CARET],I=E.includePrerelease?"-0":"";return P.replace(O,(T,j,W,ee,Z)=>{a("caret",P,T,j,W,ee,Z);let X;return y(j)?X="":y(W)?X=`>=${j}.0.0${I} <${+j+1}.0.0-0`:y(ee)?j==="0"?X=`>=${j}.${W}.0${I} <${j}.${+W+1}.0-0`:X=`>=${j}.${W}.0${I} <${+j+1}.0.0-0`:Z?(a("replaceCaret pr",Z),j==="0"?W==="0"?X=`>=${j}.${W}.${ee}-${Z} <${j}.${W}.${+ee+1}-0`:X=`>=${j}.${W}.${ee}-${Z} <${j}.${+W+1}.0-0`:X=`>=${j}.${W}.${ee}-${Z} <${+j+1}.0.0-0`):(a("no pr"),j==="0"?W==="0"?X=`>=${j}.${W}.${ee}${I} <${j}.${W}.${+ee+1}-0`:X=`>=${j}.${W}.${ee}${I} <${j}.${+W+1}.0-0`:X=`>=${j}.${W}.${ee} <${+j+1}.0.0-0`),a("caret return",X),X})},k=(P,E)=>(a("replaceXRanges",P,E),P.split(/\s+/).map(O=>R(O,E)).join(" ")),R=(P,E)=>{P=P.trim();const O=E.loose?l[c.XRANGELOOSE]:l[c.XRANGE];return P.replace(O,(I,T,j,W,ee,Z)=>{a("xRange",P,I,T,j,W,ee,Z);const X=y(j),U=X||y(W),G=U||y(ee),le=G;return T==="="&&le&&(T=""),Z=E.includePrerelease?"-0":"",X?T===">"||T==="<"?I="<0.0.0-0":I="*":T&&le?(U&&(W=0),ee=0,T===">"?(T=">=",U?(j=+j+1,W=0,ee=0):(W=+W+1,ee=0)):T==="<="&&(T="<",U?j=+j+1:W=+W+1),T==="<"&&(Z="-0"),I=`${T+j}.${W}.${ee}${Z}`):U?I=`>=${j}.0.0${Z} <${+j+1}.0.0-0`:G&&(I=`>=${j}.${W}.0${Z} <${j}.${+W+1}.0-0`),a("xRange return",I),I})},D=(P,E)=>(a("replaceStars",P,E),P.trim().replace(l[c.STAR],"")),C=(P,E)=>(a("replaceGTE0",P,E),P.trim().replace(l[E.includePrerelease?c.GTE0PRE:c.GTE0],"")),N=P=>(E,O,I,T,j,W,ee,Z,X,U,G,le)=>(y(I)?O="":y(T)?O=`>=${I}.0.0${P?"-0":""}`:y(j)?O=`>=${I}.${T}.0${P?"-0":""}`:W?O=`>=${O}`:O=`>=${O}${P?"-0":""}`,y(X)?Z="":y(U)?Z=`<${+X+1}.0.0-0`:y(G)?Z=`<${X}.${+U+1}.0-0`:le?Z=`<=${X}.${U}.${G}-${le}`:P?Z=`<${X}.${U}.${+G+1}-0`:Z=`<=${Z}`,`${O} ${Z}`.trim()),$=(P,E,O)=>{for(let I=0;I<P.length;I++)if(!P[I].test(E))return!1;if(E.prerelease.length&&!O.includePrerelease){for(let I=0;I<P.length;I++)if(a(P[I].semver),P[I].semver!==i.ANY&&P[I].semver.prerelease.length>0){const T=P[I].semver;if(T.major===E.major&&T.minor===E.minor&&T.patch===E.patch)return!0}return!1}return!0};return Gp}var Zp,J0;function Xh(){if(J0)return Zp;J0=1;const r=Symbol("SemVer ANY");class e{static get ANY(){return r}constructor(u,d){if(d=t(d),u instanceof e){if(u.loose===!!d.loose)return u;u=u.value}u=u.trim().split(/\s+/).join(" "),a("comparator",u,d),this.options=d,this.loose=!!d.loose,this.parse(u),this.semver===r?this.value="":this.value=this.operator+this.semver.version,a("comp",this)}parse(u){const d=this.options.loose?n[s.COMPARATORLOOSE]:n[s.COMPARATOR],h=u.match(d);if(!h)throw new TypeError(`Invalid comparator: ${u}`);this.operator=h[1]!==void 0?h[1]:"",this.operator==="="&&(this.operator=""),h[2]?this.semver=new o(h[2],this.options.loose):this.semver=r}toString(){return this.value}test(u){if(a("Comparator.test",u,this.options.loose),this.semver===r||u===r)return!0;if(typeof u=="string")try{u=new o(u,this.options)}catch{return!1}return i(u,this.operator,this.semver,this.options)}intersects(u,d){if(!(u instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new l(u.value,d).test(this.value):u.operator===""?u.value===""?!0:new l(this.value,d).test(u.semver):(d=t(d),d.includePrerelease&&(this.value==="<0.0.0-0"||u.value==="<0.0.0-0")||!d.includePrerelease&&(this.value.startsWith("<0.0.0")||u.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&u.operator.startsWith(">")||this.operator.startsWith("<")&&u.operator.startsWith("<")||this.semver.version===u.semver.version&&this.operator.includes("=")&&u.operator.includes("=")||i(this.semver,"<",u.semver,d)&&this.operator.startsWith(">")&&u.operator.startsWith("<")||i(this.semver,">",u.semver,d)&&this.operator.startsWith("<")&&u.operator.startsWith(">")))}}Zp=e;const t=I_(),{safeRe:n,t:s}=Tc(),i=aA(),a=Jh(),o=un(),l=dr();return Zp}var Jp,K0;function Yh(){if(K0)return Jp;K0=1;const r=dr();return Jp=(t,n,s)=>{try{n=new r(n,s)}catch{return!1}return n.test(t)},Jp}var Kp,X0;function kF(){if(X0)return Kp;X0=1;const r=dr();return Kp=(t,n)=>new r(t,n).set.map(s=>s.map(i=>i.value).join(" ").trim().split(" ")),Kp}var Xp,Y0;function SF(){if(Y0)return Xp;Y0=1;const r=un(),e=dr();return Xp=(n,s,i)=>{let a=null,o=null,l=null;try{l=new e(s,i)}catch{return null}return n.forEach(c=>{l.test(c)&&(!a||o.compare(c)===-1)&&(a=c,o=new r(a,i))}),a},Xp}var Yp,Q0;function PF(){if(Q0)return Yp;Q0=1;const r=un(),e=dr();return Yp=(n,s,i)=>{let a=null,o=null,l=null;try{l=new e(s,i)}catch{return null}return n.forEach(c=>{l.test(c)&&(!a||o.compare(c)===1)&&(a=c,o=new r(a,i))}),a},Yp}var Qp,ex;function AF(){if(ex)return Qp;ex=1;const r=un(),e=dr(),t=Kh();return Qp=(s,i)=>{s=new e(s,i);let a=new r("0.0.0");if(s.test(a)||(a=new r("0.0.0-0"),s.test(a)))return a;a=null;for(let o=0;o<s.set.length;++o){const l=s.set[o];let c=null;l.forEach(u=>{const d=new r(u.semver.version);switch(u.operator){case">":d.prerelease.length===0?d.patch++:d.prerelease.push(0),d.raw=d.format();case"":case">=":(!c||t(d,c))&&(c=d);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${u.operator}`)}}),c&&(!a||t(a,c))&&(a=c)}return a&&s.test(a)?a:null},Qp}var em,tx;function EF(){if(tx)return em;tx=1;const r=dr();return em=(t,n)=>{try{return new r(t,n).range||"*"}catch{return null}},em}var tm,nx;function L_(){if(nx)return tm;nx=1;const r=un(),e=Xh(),{ANY:t}=e,n=dr(),s=Yh(),i=Kh(),a=$_(),o=N_(),l=M_();return tm=(u,d,h,f)=>{u=new r(u,f),d=new n(d,f);let p,m,g,b,_;switch(h){case">":p=i,m=o,g=a,b=">",_=">=";break;case"<":p=a,m=l,g=i,b="<",_="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(u,d,f))return!1;for(let y=0;y<d.set.length;++y){const w=d.set[y];let v=null,x=null;if(w.forEach(S=>{S.semver===t&&(S=new e(">=0.0.0")),v=v||S,x=x||S,p(S.semver,v.semver,f)?v=S:g(S.semver,x.semver,f)&&(x=S)}),v.operator===b||v.operator===_||(!x.operator||x.operator===b)&&m(u,x.semver))return!1;if(x.operator===_&&g(u,x.semver))return!1}return!0},tm}var nm,rx;function OF(){if(rx)return nm;rx=1;const r=L_();return nm=(t,n,s)=>r(t,n,">",s),nm}var rm,sx;function TF(){if(sx)return rm;sx=1;const r=L_();return rm=(t,n,s)=>r(t,n,"<",s),rm}var sm,ix;function RF(){if(ix)return sm;ix=1;const r=dr();return sm=(t,n,s)=>(t=new r(t,s),n=new r(n,s),t.intersects(n,s)),sm}var im,ax;function IF(){if(ax)return im;ax=1;const r=Yh(),e=ur();return im=(t,n,s)=>{const i=[];let a=null,o=null;const l=t.sort((h,f)=>e(h,f,s));for(const h of l)r(h,n,s)?(o=h,a||(a=h)):(o&&i.push([a,o]),o=null,a=null);a&&i.push([a,null]);const c=[];for(const[h,f]of i)h===f?c.push(h):!f&&h===l[0]?c.push("*"):f?h===l[0]?c.push(`<=${f}`):c.push(`${h} - ${f}`):c.push(`>=${h}`);const u=c.join(" || "),d=typeof n.raw=="string"?n.raw:String(n);return u.length<d.length?u:n},im}var am,ox;function CF(){if(ox)return am;ox=1;const r=dr(),e=Xh(),{ANY:t}=e,n=Yh(),s=ur(),i=(d,h,f={})=>{if(d===h)return!0;d=new r(d,f),h=new r(h,f);let p=!1;e:for(const m of d.set){for(const g of h.set){const b=l(m,g,f);if(p=p||b!==null,b)continue e}if(p)return!1}return!0},a=[new e(">=0.0.0-0")],o=[new e(">=0.0.0")],l=(d,h,f)=>{if(d===h)return!0;if(d.length===1&&d[0].semver===t){if(h.length===1&&h[0].semver===t)return!0;f.includePrerelease?d=a:d=o}if(h.length===1&&h[0].semver===t){if(f.includePrerelease)return!0;h=o}const p=new Set;let m,g;for(const k of d)k.operator===">"||k.operator===">="?m=c(m,k,f):k.operator==="<"||k.operator==="<="?g=u(g,k,f):p.add(k.semver);if(p.size>1)return null;let b;if(m&&g){if(b=s(m.semver,g.semver,f),b>0)return null;if(b===0&&(m.operator!==">="||g.operator!=="<="))return null}for(const k of p){if(m&&!n(k,String(m),f)||g&&!n(k,String(g),f))return null;for(const R of h)if(!n(k,String(R),f))return!1;return!0}let _,y,w,v,x=g&&!f.includePrerelease&&g.semver.prerelease.length?g.semver:!1,S=m&&!f.includePrerelease&&m.semver.prerelease.length?m.semver:!1;x&&x.prerelease.length===1&&g.operator==="<"&&x.prerelease[0]===0&&(x=!1);for(const k of h){if(v=v||k.operator===">"||k.operator===">=",w=w||k.operator==="<"||k.operator==="<=",m){if(S&&k.semver.prerelease&&k.semver.prerelease.length&&k.semver.major===S.major&&k.semver.minor===S.minor&&k.semver.patch===S.patch&&(S=!1),k.operator===">"||k.operator===">="){if(_=c(m,k,f),_===k&&_!==m)return!1}else if(m.operator===">="&&!n(m.semver,String(k),f))return!1}if(g){if(x&&k.semver.prerelease&&k.semver.prerelease.length&&k.semver.major===x.major&&k.semver.minor===x.minor&&k.semver.patch===x.patch&&(x=!1),k.operator==="<"||k.operator==="<="){if(y=u(g,k,f),y===k&&y!==g)return!1}else if(g.operator==="<="&&!n(g.semver,String(k),f))return!1}if(!k.operator&&(g||m)&&b!==0)return!1}return!(m&&w&&!g&&b!==0||g&&v&&!m&&b!==0||S||x)},c=(d,h,f)=>{if(!d)return h;const p=s(d.semver,h.semver,f);return p>0?d:p<0||h.operator===">"&&d.operator===">="?h:d},u=(d,h,f)=>{if(!d)return h;const p=s(d.semver,h.semver,f);return p<0?d:p>0||h.operator==="<"&&d.operator==="<="?h:d};return am=i,am}var om,lx;function $F(){if(lx)return om;lx=1;const r=Tc(),e=Zh(),t=un(),n=rA(),s=Ga(),i=cF(),a=uF(),o=dF(),l=hF(),c=fF(),u=pF(),d=mF(),h=gF(),f=ur(),p=bF(),m=_F(),g=C_(),b=yF(),_=wF(),y=Kh(),w=$_(),v=sA(),x=iA(),S=M_(),k=N_(),R=aA(),D=vF(),C=Xh(),N=dr(),$=Yh(),P=kF(),E=SF(),O=PF(),I=AF(),T=EF(),j=L_(),W=OF(),ee=TF(),Z=RF(),X=IF(),U=CF();return om={parse:s,valid:i,clean:a,inc:o,diff:l,major:c,minor:u,patch:d,prerelease:h,compare:f,rcompare:p,compareLoose:m,compareBuild:g,sort:b,rsort:_,gt:y,lt:w,eq:v,neq:x,gte:S,lte:k,cmp:R,coerce:D,Comparator:C,Range:N,satisfies:$,toComparators:P,maxSatisfying:E,minSatisfying:O,minVersion:I,validRange:T,outside:j,gtr:W,ltr:ee,intersects:Z,simplifyRange:X,subset:U,SemVer:t,re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:n.compareIdentifiers,rcompareIdentifiers:n.rcompareIdentifiers},om}$F();function ds(r){if(!r||r.split("/").length>2||r.startsWith("/")||r.endsWith("/")||r.split(":").length>2)throw new Error(`Invalid identifier format: ${r}`);const[e,t]=r.split(":"),n=t||"latest";if(e.includes("/")){const[s,i]=e.split("/",2);if(!s||!i)throw new Error(`Invalid identifier format: ${r}`);return[s,i,n]}else{if(!e)throw new Error(`Invalid identifier format: ${r}`);return["-",e,n]}}class MF extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}}async function Ie(r,e,t){let n;if(r.ok){t&&(n=await r.text());return}n=await r.text();const s=`Failed to ${e}. Received status [${r.status}]: ${r.statusText}. Server response: ${n}`;throw r.status===409?new MF(s):new Error(s)}var cx="[...]",NF={result:"[Circular]"},Bd=[],na=[];const LF=new TextEncoder;function jF(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function ku(r){return LF.encode(r)}function xn(r,e,t,n){var s;try{const i=JSON.stringify(r,e,t);return ku(i)}catch(i){if(!((s=i.message)!=null&&s.includes("Converting circular structure to JSON")))return console.warn("[WARNING]: LangSmith received unserializable value."),ku("[Unserializable]");console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),typeof n>"u"&&(n=jF()),Gg(r,"",0,[],void 0,0,n);let a;try{na.length===0?a=JSON.stringify(r,e,t):a=JSON.stringify(r,DF(e),t)}catch{return ku("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;Bd.length!==0;){const o=Bd.pop();o.length===4?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}}return ku(a)}}function lm(r,e,t,n){var s=Object.getOwnPropertyDescriptor(n,t);s.get!==void 0?s.configurable?(Object.defineProperty(n,t,{value:r}),Bd.push([n,t,e,s])):na.push([e,t,r]):(n[t]=r,Bd.push([n,t,e]))}function Gg(r,e,t,n,s,i,a){i+=1;var o;if(typeof r=="object"&&r!==null){for(o=0;o<n.length;o++)if(n[o]===r){lm(NF,r,e,s);return}if(typeof a.depthLimit<"u"&&i>a.depthLimit){lm(cx,r,e,s);return}if(typeof a.edgesLimit<"u"&&t+1>a.edgesLimit){lm(cx,r,e,s);return}if(n.push(r),Array.isArray(r))for(o=0;o<r.length;o++)Gg(r[o],o,o,n,r,i,a);else{var l=Object.keys(r);for(o=0;o<l.length;o++){var c=l[o];Gg(r[c],c,o,n,r,i,a)}}n.pop()}}function DF(r){return r=typeof r<"u"?r:function(e,t){return t},function(e,t){if(na.length>0)for(var n=0;n<na.length;n++){var s=na[n];if(s[1]===e&&s[0]===t){t=s[2],na.splice(n,1);break}}return r.call(this,e,t)}}function ux(r){const e=cA(),t=XF(),n=r.extra??{},s=n.metadata;return r.extra={...n,runtime:{...e,...n==null?void 0:n.runtime},metadata:{...t,...t.revision_id||r.revision_id?{revision_id:r.revision_id??t.revision_id}:{},...s}},r}const FF=r=>{const e=(r==null?void 0:r.toString())??_s("TRACING_SAMPLING_RATE");if(e===void 0)return;const t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t},zF=r=>{const t=r.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};async function BF(r){const e=[];for await(const t of r)e.push(t);return e}function cm(r){if(r!==void 0)return r.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const UF=async r=>{if((r==null?void 0:r.status)===429){const e=parseInt(r.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};function dx(r){return typeof r=="number"?Number(r.toFixed(4)):r}class qF{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;const n=new Promise(i=>{t=i}),s=xn(e.item).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:t,itemPromise:n,size:s}),this.sizeBytes+=s,n}pop(e){var s;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const t=[];let n=0;for(;n+(((s=this.peek())==null?void 0:s.size)??0)<e&&this.items.length>0;){const i=this.items.shift();i&&(t.push(i),n+=i.size,this.sizeBytes-=i.size)}if(t.length===0&&this.items.length>0){const i=this.items.shift();t.push(i),n+=i.size,this.sizeBytes-=i.size}return[t.map(i=>({action:i.action,item:i.payload})),()=>t.forEach(i=>i.itemPromiseResolve())]}}const HF=20971520,WF=2500;class zl{constructor(e={}){var n;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new qF}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:fi("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1});const t=zl.getDefaultClientConfig();if(this.tracingSampleRate=FF(e.tracingSamplingRate),this.apiUrl=cm(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=cm(e.apiKey??t.apiKey),this.webUrl=cm(e.webUrl??t.webUrl),(n=this.webUrl)!=null&&n.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new p0(e.callerOptions??{}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.batchIngestCaller=new p0({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:UF}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode}static getDefaultClientConfig(){const e=_s("API_KEY"),t=_s("ENDPOINT")??"https://api.smith.langchain.com",n=_s("HIDE_INPUTS")==="true",s=_s("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:zF(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${oA}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const t={...e};return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){const n=(t==null?void 0:t.toString())??"",s=`${this.apiUrl}${e}?${n}`,i=await this.caller.call(fe(),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(i,`Failed to fetch ${e}`),i}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,n){let s=Number(t.get("offset"))||0;const i=Number(t.get("limit"))||100;for(;;){t.set("offset",String(s)),t.set("limit",String(i));const a=`${this.apiUrl}${e}?${t}`,o=await this.caller.call(fe(),a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(o,`Failed to fetch ${e}`);const l=n?n(await o.json()):await o.json();if(l.length===0||(yield l,l.length<i))break;s+=l.length}}async*_getCursorPaginatedList(e,t=null,n="POST",s="runs"){const i=t?{...t}:{};for(;;){const o=await(await this.caller.call(fe(),`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(i)})).json();if(!o||!o[s])break;yield o[s];const l=o.cursors;if(!l||!l.next)break;i.cursor=l.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){const n=[];for(const s of e)this.filteredPostUuids.has(s.id)?this.filteredPostUuids.delete(s.id):n.push(s);return n}else{const n=[];for(const s of e){const i=s.trace_id??s.id;this.filteredPostUuids.has(i)||(s.id===i?this._shouldSample()?n.push(s):this.filteredPostUuids.add(i):n.push(s))}return n}}async _getBatchSizeLimitBytes(){var t;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((t=e.batch_ingest_config)==null?void 0:t.size_limit_bytes)??HF}async _getMultiPartSupport(){var t;return((t=(await this._ensureServerInfo()).instance_flags)==null?void 0:t.dataset_examples_multipart_enabled)??!1}drainAutoBatchQueue(e){const t=[];for(;this.autoBatchQueue.items.length>0;){const[n,s]=this.autoBatchQueue.pop(e);if(!n.length){s();break}const i=this._processBatch(n,s).catch(console.error);t.push(i)}return Promise.all(t)}async _processBatch(e,t){var n;if(!e.length){t();return}try{const s={runCreates:e.filter(a=>a.action==="create").map(a=>a.item),runUpdates:e.filter(a=>a.action==="update").map(a=>a.item)},i=await this._ensureServerInfo();(n=i==null?void 0:i.batch_ingest_config)!=null&&n.use_multipart_endpoint?await this.multipartIngestRuns(s):await this.batchIngestRuns(s)}finally{t()}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=ux(e.item));const t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;const n=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>n&&this.drainAutoBatchQueue(n),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(n)},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){const e=await fe()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(WF),...this.fetchOptions});return await Ie(e,"get server info"),e.json()}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch{console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to batch operations and default limits.")}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},n=e.project_name;delete e.project_name;const s=this.prepareRunCreateOrUpdateInputs({session_name:n,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){this.processRunOperation({action:"create",item:s}).catch(console.error);return}const i=ux(s),a=await this.caller.call(fe(),`${this.apiUrl}/runs`,{method:"POST",headers:t,body:xn(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(a,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let n=(e==null?void 0:e.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[],s=(t==null?void 0:t.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[];if(n.length>0&&s.length>0){const o=n.reduce((c,u)=>(u.id&&(c[u.id]=u),c),{}),l=[];for(const c of s)c.id!==void 0&&o[c.id]?o[c.id]={...o[c.id],...c}:l.push(c);n=Object.values(o),s=l}const i={post:n,patch:s};if(!i.post.length&&!i.patch.length)return;const a={post:[],patch:[]};for(const o of["post","patch"]){const l=o,c=i[l].reverse();let u=c.pop();for(;u!==void 0;)a[l].push(u),u=c.pop()}(a.post.length>0||a.patch.length>0)&&await this._postBatchIngestRuns(xn(a))}async _postBatchIngestRuns(e){const t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},n=await this.batchIngestCaller.call(fe(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(n,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;const n={};let s=[];for(const u of e??[]){const d=this.prepareRunCreateOrUpdateInputs(u);d.id!==void 0&&d.attachments!==void 0&&(n[d.id]=d.attachments),delete d.attachments,s.push(d)}let i=[];for(const u of t??[])i.push(this.prepareRunCreateOrUpdateInputs(u));if(s.find(u=>u.trace_id===void 0||u.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(i.find(u=>u.trace_id===void 0||u.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(s.length>0&&i.length>0){const u=s.reduce((h,f)=>(f.id&&(h[f.id]=f),h),{}),d=[];for(const h of i)h.id!==void 0&&u[h.id]?u[h.id]={...u[h.id],...h}:d.push(h);s=Object.values(u),i=d}if(s.length===0&&i.length===0)return;const l=[],c=[];for(const[u,d]of[["post",s],["patch",i]])for(const h of d){const{inputs:f,outputs:p,events:m,attachments:g,...b}=h,_={inputs:f,outputs:p,events:m},y=xn(b);c.push({name:`${u}.${b.id}`,payload:new Blob([y],{type:`application/json; length=${y.length}`})});for(const[w,v]of Object.entries(_)){if(v===void 0)continue;const x=xn(v);c.push({name:`${u}.${b.id}.${w}`,payload:new Blob([x],{type:`application/json; length=${x.length}`})})}if(b.id!==void 0){const w=n[b.id];if(w){delete n[b.id];for(const[v,x]of Object.entries(w)){let S,k;if(Array.isArray(x)?[S,k]=x:(S=x.mimeType,k=x.data),v.includes(".")){console.warn(`Skipping attachment '${v}' for run ${b.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}c.push({name:`attachment.${b.id}.${v}`,payload:new Blob([k],{type:`${S}; length=${k.byteLength}`})})}}}l.push(`trace=${b.trace_id},id=${b.id}`)}await this._sendMultipartRequest(c,l.join("; "))}async _sendMultipartRequest(e,t){try{const n="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),s=[];for(const l of e)s.push(new Blob([`--${n}\r
`])),s.push(new Blob([`Content-Disposition: form-data; name="${l.name}"\r
`,`Content-Type: ${l.payload.type}\r
\r
`])),s.push(l.payload),s.push(new Blob([`\r
`]));s.push(new Blob([`--${n}--\r
`]));const a=await new Blob(s).arrayBuffer(),o=await this.batchIngestCaller.call(fe(),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers,"Content-Type":`multipart/form-data; boundary=${n}`},body:a,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(o,"ingest multipart runs",!0)}catch(n){console.warn(`${n.message.trim()}

Context: ${t}`)}}async updateRun(e,t){Ee(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));const n={...t,id:e};if(!this._filterForSampling([n],!0).length)return;if(this.autoBatchTracing&&n.trace_id!==void 0&&n.dotted_order!==void 0){if(t.end_time!==void 0&&n.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:n}).catch(console.error);return}else this.processRunOperation({action:"update",item:n}).catch(console.error);return}const s={...this.headers,"Content-Type":"application/json"},i=await this.caller.call(fe(),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:s,body:xn(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(i,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){Ee(e);let n=await this._get(`/runs/${e}`);return t&&n.child_run_ids&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:t,projectOpts:n}){if(t!==void 0){let s;t.session_id?s=t.session_id:n!=null&&n.projectName?s=(await this.readProject({projectName:n==null?void 0:n.projectName})).id:n!=null&&n.projectId?s=n==null?void 0:n.projectId:s=(await this.readProject({projectName:_s("PROJECT")||"default"})).id;const i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${s}/r/${t.id}?poll=true`}else if(e!==void 0){const s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await BF(this.listRuns({id:e.child_run_ids})),n={},s={};t.sort((i,a)=>((i==null?void 0:i.dotted_order)??"").localeCompare((a==null?void 0:a.dotted_order)??""));for(const i of t){if(i.parent_run_id===null||i.parent_run_id===void 0)throw new Error(`Child run ${i.id} has no parent`);i.parent_run_id in n||(n[i.parent_run_id]=[]),n[i.parent_run_id].push(i),s[i.id]=i}e.child_runs=n[e.id]||[];for(const i in n)i!==e.id&&(s[i].child_runs=n[i]);return e}async*listRuns(e){const{projectId:t,projectName:n,parentRunId:s,traceId:i,referenceExampleId:a,startTime:o,executionOrder:l,isRoot:c,runType:u,error:d,id:h,query:f,filter:p,traceFilter:m,treeFilter:g,limit:b,select:_}=e;let y=[];if(t&&(y=Array.isArray(t)?t:[t]),n){const S=Array.isArray(n)?n:[n],k=await Promise.all(S.map(R=>this.readProject({projectName:R}).then(D=>D.id)));y.push(...k)}const w=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],v={session:y.length?y:null,run_type:u,reference_example:a,query:f,filter:p,trace_filter:m,tree_filter:g,execution_order:l,parent_run:s,start_time:o?o.toISOString():null,error:d,id:h,limit:b,trace:i,select:_||w,is_root:c};let x=0;for await(const S of this._getCursorPaginatedList("/runs/query",v))if(b){if(x>=b)break;if(S.length+x>b){yield*S.slice(0,b-x);break}x+=S.length,yield*S}else yield*S}async getRunStats({id:e,trace:t,parentRun:n,runType:s,projectNames:i,projectIds:a,referenceExampleIds:o,startTime:l,endTime:c,error:u,query:d,filter:h,traceFilter:f,treeFilter:p,isRoot:m,dataSourceType:g}){let b=a||[];i&&(b=[...a||[],...await Promise.all(i.map(x=>this.readProject({projectName:x}).then(S=>S.id)))]);const y=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:n,run_type:s,session:b,reference_example:o,start_time:l,end_time:c,error:u,query:d,filter:h,trace_filter:f,tree_filter:p,is_root:m,data_source_type:g}).filter(([x,S])=>S!==void 0));return await(await this.caller.call(fe(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(y),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:t}={}){const n={run_id:e,share_token:t||sn()};Ee(e);const i=await(await this.caller.call(fe(),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(i===null||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){Ee(e);const t=await this.caller.call(fe(),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(t,"unshare run",!0)}async readRunSharedLink(e){Ee(e);const n=await(await this.caller.call(fe(),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(n===null||!("share_token"in n)))return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const n=new URLSearchParams({share_token:e});if(t!==void 0)for(const a of t)n.append("id",a);return Ee(e),await(await this.caller.call(fe(),`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),Ee(e);const s=await(await this.caller.call(fe(),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const n={dataset_id:e};Ee(e);const i=await(await this.caller.call(fe(),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async unshareDataset(e){Ee(e);const t=await this.caller.call(fe(),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(t,"unshare dataset",!0)}async readSharedDataset(e){return Ee(e),await(await this.caller.call(fe(),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,t){const n={};t!=null&&t.exampleIds&&(n.id=t.exampleIds);const s=new URLSearchParams;Object.entries(n).forEach(([o,l])=>{Array.isArray(l)?l.forEach(c=>s.append(o,c)):s.append(o,l)});const i=await this.caller.call(fe(),`${this.apiUrl}/public/${e}/examples?${s.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),a=await i.json();if(!i.ok)throw"detail"in a?new Error(`Failed to list shared examples.
Status: ${i.status}
Message: ${a.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${i.status} ${i.statusText}`);return a.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:n=null,upsert:s=!1,projectExtra:i=null,referenceDatasetId:a=null}){const o=s?"?upsert=true":"",l=`${this.apiUrl}/sessions${o}`,c=i||{};n&&(c.metadata=n);const u={name:e,extra:c,description:t};a!==null&&(u.reference_dataset_id=a);const d=await this.caller.call(fe(),l,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(d,"create project"),await d.json()}async updateProject(e,{name:t=null,description:n=null,metadata:s=null,projectExtra:i=null,endTime:a=null}){const o=`${this.apiUrl}/sessions/${e}`;let l=i;s&&(l={...l||{},metadata:s});const c={name:t,extra:l,description:n,end_time:a?new Date(a).toISOString():null},u=await this.caller.call(fe(),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(u,"update project"),await u.json()}async hasProject({projectId:e,projectName:t}){let n="/sessions";const s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Ee(e),n+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");const i=await this.caller.call(fe(),`${this.apiUrl}${n}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const a=await i.json();return i.ok?Array.isArray(a)?a.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:n}){let s="/sessions";const i=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Ee(e),s+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide projectName or projectId");n!==void 0&&i.append("include_stats",n.toString());const a=await this._get(s,i);let o;if(Array.isArray(a)){if(a.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=a[0]}else o=a;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");const n=await this.readProject({projectId:e,projectName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${n.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");const n=await this.readDataset({datasetId:e,datasetName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${n.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:n,referenceDatasetId:s,referenceDatasetName:i,referenceFree:a,metadata:o}={}){const l=new URLSearchParams;if(e!==void 0)for(const c of e)l.append("id",c);if(t!==void 0&&l.append("name",t),n!==void 0&&l.append("name_contains",n),s!==void 0)l.append("reference_dataset",s);else if(i!==void 0){const c=await this.readDataset({datasetName:i});l.append("reference_dataset",c.id)}a!==void 0&&l.append("reference_free",a.toString()),o!==void 0&&l.append("metadata",JSON.stringify(o));for await(const c of this._getPaginated("/sessions",l))yield*c}async deleteProject({projectId:e,projectName:t}){let n;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?n=(await this.readProject({projectName:t})).id:n=e,Ee(n);const s=await this.caller.call(fe(),`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(s,`delete session ${n} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:n,outputKeys:s,description:i,dataType:a,name:o}){const l=`${this.apiUrl}/datasets/upload`,c=new FormData;c.append("file",e,t),n.forEach(h=>{c.append("input_keys",h)}),s.forEach(h=>{c.append("output_keys",h)}),i&&c.append("description",i),a&&c.append("data_type",a),o&&c.append("name",o);const u=await this.caller.call(fe(),l,{method:"POST",headers:this.headers,body:c,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(u,"upload CSV"),await u.json()}async createDataset(e,{description:t,dataType:n,inputsSchema:s,outputsSchema:i,metadata:a}={}){const o={name:e,description:t,extra:a?{metadata:a}:void 0};n&&(o.data_type=n),s&&(o.inputs_schema_definition=s),i&&(o.outputs_schema_definition=i);const l=await this.caller.call(fe(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(l,"create dataset"),await l.json()}async readDataset({datasetId:e,datasetName:t}){let n="/datasets";const s=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)Ee(e),n+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");const i=await this._get(n,s);let a;if(Array.isArray(i)){if(i.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);a=i[0]}else a=i;return a}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(n){if(n instanceof Error&&n.message.toLocaleLowerCase().includes("not found"))return!1;throw n}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:n,toVersion:s}){let i=e;if(i===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(i!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");i===void 0&&(i=(await this.readDataset({datasetName:t})).id);const a=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${i}/versions/diff`,a)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const n="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${n}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:n,datasetName:s,datasetNameContains:i,metadata:a}={}){const o="/datasets",l=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(n!==void 0)for(const c of n)l.append("id",c);s!==void 0&&l.append("name",s),i!==void 0&&l.append("name_contains",i),a!==void 0&&l.append("metadata",JSON.stringify(a));for await(const c of this._getPaginated(o,l))yield*c}async updateDataset(e){const{datasetId:t,datasetName:n,...s}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");const i=t??(await this.readDataset({datasetName:n})).id;Ee(i);const a=await this.caller.call(fe(),`${this.apiUrl}/datasets/${i}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(a,"update dataset"),await a.json()}async updateDatasetTag(e){const{datasetId:t,datasetName:n,asOf:s,tag:i}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");const a=t??(await this.readDataset({datasetName:n})).id;Ee(a);const o=await this.caller.call(fe(),`${this.apiUrl}/datasets/${a}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:typeof s=="string"?s:s.toISOString(),tag:i}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(o,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:t}){let n="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(await this.readDataset({datasetName:t})).id),s!==void 0)Ee(s),n+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");const i=await this.caller.call(fe(),this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(i,`delete ${n}`),await i.json()}async indexDataset({datasetId:e,datasetName:t,tag:n}){let s=e;if(!s&&!t)throw new Error("Must provide either datasetName or datasetId");if(s&&t)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(await this.readDataset({datasetName:t})).id),Ee(s);const i={tag:n},a=await this.caller.call(fe(),`${this.apiUrl}/datasets/${s}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(a,"index dataset"),await a.json()}async similarExamples(e,t,n,{filter:s}={}){const i={limit:n,inputs:e};s!==void 0&&(i.filter=s),Ee(t);const a=await this.caller.call(fe(),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(a,"fetch similar examples"),(await a.json()).examples}async createExample(e,t,n){var u;if(hx(e)&&(t!==void 0||n!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let s=t?n==null?void 0:n.datasetId:e.dataset_id;const i=t?n==null?void 0:n.datasetName:e.dataset_name;if(s===void 0&&i===void 0)throw new Error("Must provide either datasetName or datasetId");if(s!==void 0&&i!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");s===void 0&&(s=(await this.readDataset({datasetName:i})).id);const a=(t?n==null?void 0:n.createdAt:e.created_at)||new Date;let o;hx(e)?o=e:o={inputs:e,outputs:t,created_at:a==null?void 0:a.toISOString(),id:n==null?void 0:n.exampleId,metadata:n==null?void 0:n.metadata,split:n==null?void 0:n.split,source_run_id:n==null?void 0:n.sourceRunId,use_source_run_io:n==null?void 0:n.useSourceRunIO,use_source_run_attachments:n==null?void 0:n.useSourceRunAttachments,attachments:n==null?void 0:n.attachments};const l=await this._uploadExamplesMultipart(s,[o]);return await this.readExample(((u=l.example_ids)==null?void 0:u[0])??sn())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];const _=e;let y=_[0].dataset_id;const w=_[0].dataset_name;if(y===void 0&&w===void 0)throw new Error("Must provide either datasetName or datasetId");if(y!==void 0&&w!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");y===void 0&&(y=(await this.readDataset({datasetName:w})).id);const v=await this._uploadExamplesMultipart(y,_);return await Promise.all(v.example_ids.map(S=>this.readExample(S)))}const{inputs:t,outputs:n,metadata:s,splits:i,sourceRunIds:a,useSourceRunIOs:o,useSourceRunAttachments:l,attachments:c,exampleIds:u,datasetId:d,datasetName:h}=e;if(t===void 0)throw new Error("Must provide inputs when using legacy parameters");let f=d;const p=h;if(f===void 0&&p===void 0)throw new Error("Must provide either datasetName or datasetId");if(f!==void 0&&p!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");f===void 0&&(f=(await this.readDataset({datasetName:p})).id);const m=t.map((_,y)=>({dataset_id:f,inputs:_,outputs:n==null?void 0:n[y],metadata:s==null?void 0:s[y],split:i==null?void 0:i[y],id:u==null?void 0:u[y],attachments:c==null?void 0:c[y],source_run_id:a==null?void 0:a[y],use_source_run_io:o==null?void 0:o[y],use_source_run_attachments:l==null?void 0:l[y]})),g=await this._uploadExamplesMultipart(f,m);return await Promise.all(g.example_ids.map(_=>this.readExample(_)))}async createLLMExample(e,t,n){return this.createExample({input:e},{output:t},n)}async createChatExample(e,t,n){const s=e.map(a=>m0(a)?g0(a):a),i=m0(t)?g0(t):t;return this.createExample({input:s},{output:i},n)}async readExample(e){Ee(e);const t=`/examples/${e}`,n=await this._get(t),{attachment_urls:s,...i}=n,a=i;return s&&(a.attachments=Object.entries(s).reduce((o,[l,c])=>(o[l.slice(11)]={presigned_url:c.presigned_url,mime_type:c.mime_type},o),{})),a}async*listExamples({datasetId:e,datasetName:t,exampleIds:n,asOf:s,splits:i,inlineS3Urls:a,metadata:o,limit:l,offset:c,filter:u,includeAttachments:d}={}){let h;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)h=e;else if(t!==void 0)h=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const f=new URLSearchParams({dataset:h}),p=s?typeof s=="string"?s:s==null?void 0:s.toISOString():void 0;p&&f.append("as_of",p);const m=a??!0;if(f.append("inline_s3_urls",m.toString()),n!==void 0)for(const b of n)f.append("id",b);if(i!==void 0)for(const b of i)f.append("splits",b);if(o!==void 0){const b=JSON.stringify(o);f.append("metadata",b)}l!==void 0&&f.append("limit",l.toString()),c!==void 0&&f.append("offset",c.toString()),u!==void 0&&f.append("filter",u),d===!0&&["attachment_urls","outputs","metadata"].forEach(b=>f.append("select",b));let g=0;for await(const b of this._getPaginated("/examples",f)){for(const _ of b){const{attachment_urls:y,...w}=_,v=w;y&&(v.attachments=Object.entries(y).reduce((x,[S,k])=>(x[S.slice(11)]={presigned_url:k.presigned_url,mime_type:k.mime_type||void 0},x),{})),yield v,g++}if(l!==void 0&&g>=l)break}}async deleteExample(e){Ee(e);const t=`/examples/${e}`,n=await this.caller.call(fe(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(n,`delete ${t}`),await n.json()}async updateExample(e,t){let n;t?n=e:n=e.id,Ee(n);let s;t?s={id:n,...t}:s=e;let i;return s.dataset_id!==void 0?i=s.dataset_id:i=(await this.readExample(n)).dataset_id,this._updateExamplesMultipart(i,[s])}async updateExamples(e){let t;return e[0].dataset_id===void 0?t=(await this.readExample(e[0].id)).dataset_id:t=e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:n,tag:s}){let i;if(e?i=e:i=(await this.readDataset({datasetName:t})).id,Ee(i),n&&s||!n&&!s)throw new Error("Exactly one of asOf and tag must be specified.");const a=new URLSearchParams;n!==void 0&&a.append("as_of",typeof n=="string"?n:n.toISOString()),s!==void 0&&a.append("tag",s);const o=await this.caller.call(fe(),`${this.apiUrl}/datasets/${i}/version?${a.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(o,"read dataset version"),await o.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:n}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:t})).id:s=e,Ee(s);const i=new URLSearchParams,a=n?typeof n=="string"?n:n==null?void 0:n.toISOString():void 0;return a&&i.append("as_of",a),await this._get(`/datasets/${s}/splits`,i)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:n,exampleIds:s,remove:i=!1}){let a;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?a=(await this.readDataset({datasetName:t})).id:a=e,Ee(a);const o={split_name:n,examples:s.map(c=>(Ee(c),c)),remove:i},l=await this.caller.call(fe(),`${this.apiUrl}/datasets/${a}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(l,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:n,loadChildRuns:s,referenceExample:i}={loadChildRuns:!1}){nA("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let a;if(typeof e=="string")a=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)a=e;else throw new Error(`Invalid run type: ${typeof e}`);a.reference_example_id!==null&&a.reference_example_id!==void 0&&(i=await this.readExample(a.reference_example_id));const o=await t.evaluateRun(a,i),[l,c]=await this._logEvaluationFeedback(o,a,n);return c[0]}async createFeedback(e,t,{score:n,value:s,correction:i,comment:a,sourceInfo:o,feedbackSourceType:l="api",sourceRunId:c,feedbackId:u,feedbackConfig:d,projectId:h,comparativeExperimentId:f}){var _;if(!e&&!h)throw new Error("One of runId or projectId must be provided");if(e&&h)throw new Error("Only one of runId or projectId can be provided");const p={type:l??"api",metadata:o??{}};c!==void 0&&(p==null?void 0:p.metadata)!==void 0&&!p.metadata.__run&&(p.metadata.__run={run_id:c}),(p==null?void 0:p.metadata)!==void 0&&((_=p.metadata.__run)==null?void 0:_.run_id)!==void 0&&Ee(p.metadata.__run.run_id);const m={id:u??sn(),run_id:e,key:t,score:dx(n),value:s,correction:i,comment:a,feedback_source:p,comparative_experiment_id:f,feedbackConfig:d,session_id:h},g=`${this.apiUrl}/feedback`,b=await this.caller.call(fe(),g,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(m),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(b,"create feedback",!0),m}async updateFeedback(e,{score:t,value:n,correction:s,comment:i}){const a={};t!=null&&(a.score=dx(t)),n!=null&&(a.value=n),s!=null&&(a.correction=s),i!=null&&(a.comment=i),Ee(e);const o=await this.caller.call(fe(),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(o,"update feedback",!0)}async readFeedback(e){Ee(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){Ee(e);const t=`/feedback/${e}`,n=await this.caller.call(fe(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(n,`delete ${t}`),await n.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:n}={}){const s=new URLSearchParams;if(e&&s.append("run",e.join(",")),t)for(const i of t)s.append("key",i);if(n)for(const i of n)s.append("source",i);for await(const i of this._getPaginated("/feedback",s))yield*i}async createPresignedFeedbackToken(e,t,{expiration:n,feedbackConfig:s}={}){const i={run_id:e,feedback_key:t,feedback_config:s};return n?typeof n=="string"?i.expires_at=n:(n!=null&&n.hours||n!=null&&n.minutes||n!=null&&n.days)&&(i.expires_in=n):i.expires_in={hours:3},await(await this.caller.call(fe(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:n,createdAt:s,description:i,metadata:a,id:o}){var u;if(t.length===0)throw new Error("At least one experiment is required");if(n||(n=(await this.readProject({projectId:t[0]})).reference_dataset_id),!n==null)throw new Error("A reference dataset is required");const l={id:o,name:e,experiment_ids:t,reference_dataset_id:n,description:i,created_at:(u=s??new Date)==null?void 0:u.toISOString(),extra:{}};return a&&(l.extra.metadata=a),await(await this.caller.call(fe(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){Ee(e);const t=new URLSearchParams({run_id:e});for await(const n of this._getPaginated("/feedback/tokens",t))yield*n}_selectEvalResults(e){let t;return"results"in e?t=e.results:Array.isArray(e)?t=e:t=[e],t}async _logEvaluationFeedback(e,t,n){const s=this._selectEvalResults(e),i=[];for(const a of s){let o=n||{};a.evaluatorInfo&&(o={...a.evaluatorInfo,...o});let l=null;a.targetRunId?l=a.targetRunId:t&&(l=t.id),i.push(await this.createFeedback(l,a.key,{score:a.score,value:a.value,comment:a.comment,correction:a.correction,sourceInfo:o,sourceRunId:a.sourceRunId,feedbackConfig:a.feedbackConfig,feedbackSourceType:"model"}))}return[s,i]}async logEvaluationFeedback(e,t,n){const[s]=await this._logEvaluationFeedback(e,t,n);return s}async*listAnnotationQueues(e={}){const{queueIds:t,name:n,nameContains:s,limit:i}=e,a=new URLSearchParams;t&&t.forEach((l,c)=>{Ee(l,`queueIds[${c}]`),a.append("ids",l)}),n&&a.append("name",n),s&&a.append("name_contains",s),a.append("limit",(i!==void 0?Math.min(i,100):100).toString());let o=0;for await(const l of this._getPaginated("/annotation-queues",a))if(yield*l,o++,i!==void 0&&o>=i)break}async createAnnotationQueue(e){const{name:t,description:n,queueId:s}=e,i={name:t,description:n,id:s||sn()},a=await this.caller.call(fe(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(i).filter(([l,c])=>c!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(a,"create annotation queue"),await a.json()}async readAnnotationQueue(e){const t=await this.listAnnotationQueues({queueIds:[e]}).next();if(t.done)throw new Error(`Annotation queue with ID ${e} not found`);return t.value}async updateAnnotationQueue(e,t){const{name:n,description:s}=t,i=await this.caller.call(fe(),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:n,description:s}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(i,"update annotation queue")}async deleteAnnotationQueue(e){const t=await this.caller.call(fe(),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){const n=await this.caller.call(fe(),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((s,i)=>Ee(s,`runIds[${i}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(n,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){const n=`/annotation-queues/${Ee(e,"queueId")}/run`,s=await this.caller.call(fe(),`${this.apiUrl}${n}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(s,"get run from annotation queue"),await s.json()}async deleteRunFromAnnotationQueue(e,t){const n=await this.caller.call(fe(),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}/runs/${Ee(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(n,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){const t=await this.caller.call(fe(),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(t,"get size from annotation queue"),await t.json()}async _currentTenantIsOwner(e){const t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){const n=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${n.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){const t=await this.caller.call(fe(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await t.json();if(!t.ok){const s=typeof n.detail=="string"?n.detail:JSON.stringify(n.detail),i=new Error(`Error ${t.status}: ${t.statusText}
${s}`);throw i.statusCode=t.status,i}if(n.commits.length!==0)return n.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){const[n,s,i]=ds(e),a=await this.caller.call(fe(),`${this.apiUrl}/likes/${n}/${s}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(a,`${t?"like":"unlike"} prompt`),await a.json()}async _getPromptUrl(e){const[t,n,s]=ds(e);if(await this._currentTenantIsOwner(t)){const i=await this._getSettings();return s!=="latest"?`${this.getHostUrl()}/prompts/${n}/${s.substring(0,8)}?organizationId=${i.id}`:`${this.getHostUrl()}/prompts/${n}?organizationId=${i.id}`}else return s!=="latest"?`${this.getHostUrl()}/hub/${t}/${n}/${s.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${n}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,n=>n.commits))yield*t}async*listPrompts(e){const t=new URLSearchParams;t.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&t.append("is_public",e.isPublic.toString()),e!=null&&e.query&&t.append("query",e.query);for await(const n of this._getPaginated("/repos",t,s=>s.repos))yield*n}async getPrompt(e){const[t,n,s]=ds(e),i=await this.caller.call(fe(),`${this.apiUrl}/repos/${t}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(i.status===404)return null;await Ie(i,"get prompt");const a=await i.json();return a.repo?a.repo:null}async createPrompt(e,t){const n=await this._getSettings();if(t!=null&&t.isPublic&&!n.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[s,i,a]=ds(e);if(!await this._currentTenantIsOwner(s))throw await this._ownerConflictError("create a prompt",s);const o={repo_handle:i,...(t==null?void 0:t.description)&&{description:t.description},...(t==null?void 0:t.readme)&&{readme:t.readme},...(t==null?void 0:t.tags)&&{tags:t.tags},is_public:!!(t!=null&&t.isPublic)},l=await this.caller.call(fe(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(l,"create prompt");const{repo:c}=await l.json();return c}async createCommit(e,t,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[s,i,a]=ds(e),o=(n==null?void 0:n.parentCommitHash)==="latest"||!(n!=null&&n.parentCommitHash)?await this._getLatestCommitHash(`${s}/${i}`):n==null?void 0:n.parentCommitHash,l={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},c=await this.caller.call(fe(),`${this.apiUrl}/commits/${s}/${i}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(c,"create commit");const u=await c.json();return this._getPromptUrl(`${s}/${i}${u.commit_hash?`:${u.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){var o;if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const n=new FormData;for(const l of t){const c=l.id,u={...l.metadata&&{metadata:l.metadata},...l.split&&{split:l.split}},d=xn(u),h=new Blob([d],{type:"application/json"});if(n.append(c,h),l.inputs){const f=xn(l.inputs),p=new Blob([f],{type:"application/json"});n.append(`${c}.inputs`,p)}if(l.outputs){const f=xn(l.outputs),p=new Blob([f],{type:"application/json"});n.append(`${c}.outputs`,p)}if(l.attachments)for(const[f,p]of Object.entries(l.attachments)){let m,g;Array.isArray(p)?[m,g]=p:(m=p.mimeType,g=p.data);const b=new Blob([g],{type:`${m}; length=${g.byteLength}`});n.append(`${c}.attachment.${f}`,b)}if(l.attachments_operations){const f=xn(l.attachments_operations),p=new Blob([f],{type:"application/json"});n.append(`${c}.attachments_operations`,p)}}const s=e??((o=t[0])==null?void 0:o.dataset_id);return await(await this.caller.call(fe(),`${this.apiUrl}/v1/platform/datasets/${s}/examples`,{method:"PATCH",headers:this.headers,body:n})).json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const n=new FormData;for(const a of t){const o=(a.id??sn()).toString(),l={created_at:a.created_at,...a.metadata&&{metadata:a.metadata},...a.split&&{split:a.split},...a.source_run_id&&{source_run_id:a.source_run_id},...a.use_source_run_io&&{use_source_run_io:a.use_source_run_io},...a.use_source_run_attachments&&{use_source_run_attachments:a.use_source_run_attachments}},c=xn(l),u=new Blob([c],{type:"application/json"});if(n.append(o,u),a.inputs){const d=xn(a.inputs),h=new Blob([d],{type:"application/json"});n.append(`${o}.inputs`,h)}if(a.outputs){const d=xn(a.outputs),h=new Blob([d],{type:"application/json"});n.append(`${o}.outputs`,h)}if(a.attachments)for(const[d,h]of Object.entries(a.attachments)){let f,p;Array.isArray(h)?[f,p]=h:(f=h.mimeType,p=h.data);const m=new Blob([p],{type:`${f}; length=${p.byteLength}`});n.append(`${o}.attachment.${d}`,m)}}const s=await this.caller.call(fe(),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"POST",headers:this.headers,body:n});return await Ie(s,"upload examples"),await s.json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[n,s]=ds(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("update a prompt",n);const i={};if((t==null?void 0:t.description)!==void 0&&(i.description=t.description),(t==null?void 0:t.readme)!==void 0&&(i.readme=t.readme),(t==null?void 0:t.tags)!==void 0&&(i.tags=t.tags),(t==null?void 0:t.isPublic)!==void 0&&(i.is_public=t.isPublic),(t==null?void 0:t.isArchived)!==void 0&&(i.is_archived=t.isArchived),Object.keys(i).length===0)throw new Error("No valid update options provided");const a=await this.caller.call(fe(),`${this.apiUrl}/repos/${n}/${s}`,{method:"PATCH",body:JSON.stringify(i),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(a,"update prompt"),a.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[t,n,s]=ds(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return await(await this.caller.call(fe(),`${this.apiUrl}/repos/${t}/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,t){const[n,s,i]=ds(e),a=await this.caller.call(fe(),`${this.apiUrl}/commits/${n}/${s}/${i}${t!=null&&t.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(a,"pull prompt commit");const o=await a.json();return{owner:n,repo:s,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,t){const n=await this.pullPromptCommit(e,{includeModel:t==null?void 0:t.includeModel});return JSON.stringify(n.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(s=>s!=="object")&&await this.updatePrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}):await this.createPrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}),t!=null&&t.object?await this.createCommit(e,t==null?void 0:t.object,{parentCommitHash:t==null?void 0:t.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){const{sourceApiUrl:n=this.apiUrl,datasetName:s}=t,[i,a]=this.parseTokenOrUrl(e,n),o=new zl({apiUrl:i,apiKey:"placeholder"}),l=await o.readSharedDataset(a),c=s||l.name;try{if(await this.hasDataset({datasetId:c})){console.log(`Dataset ${c} already exists in your tenant. Skipping.`);return}}catch{}const u=await o.listSharedExamples(a),d=await this.createDataset(c,{description:l.description,dataType:l.data_type||"kv",inputsSchema:l.inputs_schema_definition??void 0,outputsSchema:l.outputs_schema_definition??void 0});try{await this.createExamples({inputs:u.map(h=>h.inputs),outputs:u.flatMap(h=>h.outputs?[h.outputs]:[]),datasetId:d.id})}catch(h){throw console.error(`An error occurred while creating dataset ${c}. You should delete it manually.`),h}}parseTokenOrUrl(e,t,n=2,s="dataset"){try{return Ee(e),[t,e]}catch{}try{const a=new URL(e).pathname.split("/").filter(o=>o!=="");if(a.length>=n){const o=a[a.length-n];return[t,o]}else throw new Error(`Invalid public ${s} URL: ${e}`)}catch{throw new Error(`Invalid public ${s} URL or token: ${e}`)}}awaitPendingTraceBatches(){return this.manualFlushMode?(console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve()):Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()])}}function hx(r){return"dataset_id"in r||"dataset_name"in r}const oA="0.3.18";var sl={};let Nr;const VF=()=>typeof window<"u"&&typeof window.document<"u",GF=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",ZF=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),lA=()=>typeof Deno<"u",JF=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!lA(),KF=()=>Nr||(VF()?Nr="browser":JF()?Nr="node":GF()?Nr="webworker":ZF()?Nr="jsdom":lA()?Nr="deno":Nr="other",Nr);let um;function cA(){if(um===void 0){const r=KF(),e=QF();um={library:"langsmith",runtime:r,sdk:"langsmith-js",sdk_version:oA,...e}}return um}function XF(){const r=YF()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[n,s]of Object.entries(r))(n.startsWith("LANGCHAIN_")||n.startsWith("LANGSMITH_"))&&typeof s=="string"&&!t.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[n]=s);return e}function YF(){try{return typeof process<"u"&&sl?Object.entries(sl).reduce((r,[e,t])=>(r[e]=String(t),r),{}):void 0}catch{return}}function fi(r){try{return typeof process<"u"?sl==null?void 0:sl[r]:void 0}catch{return}}function _s(r){return fi(`LANGSMITH_${r}`)||fi(`LANGCHAIN_${r}`)}let dm;function QF(){if(dm!==void 0)return dm;const r=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of r){const n=fi(t);n!==void 0&&(e[t]=n)}return dm=e,e}const ez=r=>!!["TRACING_V2","TRACING"].find(t=>_s(t)==="true"),hm=Symbol.for("lc:context_variables");function tz(r){return r.replace(/[-:.]/g,"")}function nz(r,e,t=1){const n=t.toFixed(0).slice(0,3).padStart(3,"0");return tz(`${new Date(r).toISOString().slice(0,-1)}${n}Z`)+e}class Ud{constructor(e,t,n){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=n}static fromHeader(e){const t=e.split(",");let n={},s=[],i;for(const a of t){const[o,l]=a.split("="),c=decodeURIComponent(l);o==="langsmith-metadata"?n=JSON.parse(c):o==="langsmith-tags"?s=c.split(","):o==="langsmith-project"&&(i=c)}return new Ud(n,s,i)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class En{constructor(e){var o;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),uA(e)){Object.assign(this,{...e});return}const t=En.getDefaultConfig(),{metadata:n,...s}=e,i=s.client??En.getSharedClient(),a={...n,...(o=s==null?void 0:s.extra)==null?void 0:o.metadata};if(s.extra={...s.extra,metadata:a},Object.assign(this,{...t,...s,client:i}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){const l=nz(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+l:this.dotted_order=l}}static getDefaultConfig(){return{id:sn(),run_type:"chain",project_name:_s("PROJECT")??fi("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:fi("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:fi("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return En.sharedClient||(En.sharedClient=new zl),En.sharedClient}createChild(e){var l,c,u,d,h,f;const t=this.child_execution_order+1,n=new En({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});hm in this&&(n[hm]=this[hm]);const s=Symbol.for("lc:child_config"),i=((l=e.extra)==null?void 0:l[s])??this.extra[s];if(sz(i)){const p={...i},m=rz(p.callbacks)?(u=(c=p.callbacks).copy)==null?void 0:u.call(c):void 0;m&&(Object.assign(m,{_parentRunId:n.id}),(f=(h=(d=m.handlers)==null?void 0:d.find(dA))==null?void 0:h.updateFromRunTree)==null||f.call(h,n),p.callbacks=m),n.extra[s]=p}const a=new Set;let o=this;for(;o!=null&&!a.has(o.id);)a.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(n),n}async end(e,t,n=Date.now(),s){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??n,s&&Object.keys(s).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...s}}:{metadata:s})}_convertToCreate(e,t,n=!0){var l;const s=e.extra??{};if(s.runtime||(s.runtime={}),t)for(const[c,u]of Object.entries(t))s.runtime[c]||(s.runtime[c]=u);let i,a;return n?(a=(l=e.parent_run)==null?void 0:l.id,i=[]):(i=e.child_runs.map(c=>this._convertToCreate(c,t,n)),a=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:s,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:i,parent_run_id:a,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments}}async postRun(e=!0){try{const t=cA(),n=await this._convertToCreate(this,t,!0);if(await this.client.createRun(n),!e){nA("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const s of this.child_runs)await s.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(){var e;try{const t={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:(e=this.parent_run)==null?void 0:e.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};await this.client.updateRun(this.id,t)}catch(t){console.error(`Error in patchRun for run ${this.id}`,t)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){var c,u,d,h;const n=e==null?void 0:e.callbacks;let s,i,a,o=ez();if(n){const f=((c=n==null?void 0:n.getParentRunId)==null?void 0:c.call(n))??"",p=(u=n==null?void 0:n.handlers)==null?void 0:u.find(m=>(m==null?void 0:m.name)=="langchain_tracer");s=(d=p==null?void 0:p.getRun)==null?void 0:d.call(p,f),i=p==null?void 0:p.projectName,a=p==null?void 0:p.client,o=o||!!p}return s?new En({name:s.name,id:s.id,trace_id:s.trace_id,dotted_order:s.dotted_order,client:a,tracingEnabled:o,project_name:i,tags:[...new Set(((s==null?void 0:s.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(h=s==null?void 0:s.extra)==null?void 0:h.metadata,...e==null?void 0:e.metadata}}}).createChild(t):new En({...t,client:a,tracingEnabled:o,project_name:i})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){var c;const n="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,s=n["langsmith-trace"];if(!s||typeof s!="string")return;const i=s.trim(),a=i.split(".").map(u=>{const[d,h]=u.split("Z");return{strTime:d,time:Date.parse(d+"Z"),uuid:h}}),o=a[0].uuid,l={...t,name:(t==null?void 0:t.name)??"parent",run_type:(t==null?void 0:t.run_type)??"chain",start_time:(t==null?void 0:t.start_time)??Date.now(),id:(c=a.at(-1))==null?void 0:c.uuid,trace_id:o,dotted_order:i};if(n.baggage&&typeof n.baggage=="string"){const u=Ud.fromHeader(n.baggage);l.metadata=u.metadata,l.tags=u.tags,l.project_name=u.project_name}return new En(l)}toHeaders(e){var n;const t={"langsmith-trace":this.dotted_order,baggage:new Ud((n=this.extra)==null?void 0:n.metadata,this.tags,this.project_name).toHeader()};if(e)for(const[s,i]of Object.entries(t))e.set(s,i);return t}}Object.defineProperty(En,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function uA(r){return r!==void 0&&typeof r.createChild=="function"&&typeof r.postRun=="function"}function dA(r){return typeof r=="object"&&r!=null&&typeof r.name=="string"&&r.name==="langchain_tracer"}function fx(r){return Array.isArray(r)&&r.some(e=>dA(e))}function rz(r){return typeof r=="object"&&r!=null&&Array.isArray(r.handlers)}function sz(r){var e;return r!==void 0&&typeof r.callbacks=="object"&&(fx((e=r.callbacks)==null?void 0:e.handlers)||fx(r.callbacks))}let iz=class{getStore(){}run(e,t){return t()}};const fm=Symbol.for("ls:tracing_async_local_storage"),az=new iz;let oz=class{getInstance(){return globalThis[fm]??az}initializeGlobalInstance(e){globalThis[fm]===void 0&&(globalThis[fm]=e)}};const lz=new oz,cz=()=>{const r=lz.getInstance().getStore();if(!uA(r))throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function and that tracing is enabled."].join(`
`));return r};function j_(r){return typeof r=="function"&&"langsmith:traceable"in r}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const uz=Object.prototype.hasOwnProperty;function Zg(r,e){return uz.call(r,e)}function Jg(r){if(Array.isArray(r)){const t=new Array(r.length);for(let n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(r);let e=[];for(let t in r)Zg(r,t)&&e.push(t);return e}function Sr(r){switch(typeof r){case"object":return JSON.parse(JSON.stringify(r));case"undefined":return null;default:return r}}function Kg(r){let e=0;const t=r.length;let n;for(;e<t;){if(n=r.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function qi(r){return r.indexOf("/")===-1&&r.indexOf("~")===-1?r:r.replace(/~/g,"~0").replace(/\//g,"~1")}function dz(r){return r.replace(/~1/g,"/").replace(/~0/g,"~")}function Xg(r){if(r===void 0)return!0;if(r){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(Xg(r[t]))return!0}else if(typeof r=="object"){const t=Jg(r),n=t.length;for(var e=0;e<n;e++)if(Xg(r[t[e]]))return!0}}return!1}function px(r,e){const t=[r];for(const n in e){const s=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof s<"u"&&t.push(`${n}: ${s}`)}return t.join(`
`)}class hz extends Error{constructor(e,t,n,s,i){super(px(e,{name:t,index:n,operation:s,tree:i})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.setPrototypeOf(this,new.target.prototype),this.message=px(e,{name:t,index:n,operation:s,tree:i})}}const xt=hz,ra={add:function(r,e,t){return r[e]=this.value,{newDocument:t}},remove:function(r,e,t){var n=r[e];return delete r[e],{newDocument:t,removed:n}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:function(r,e,t){let n=Yg(t,this.path);n&&(n=Sr(n));const s=il(t,{op:"remove",path:this.from}).removed;return il(t,{op:"add",path:this.path,value:s}),{newDocument:t,removed:n}},copy:function(r,e,t){const n=Yg(t,this.from);return il(t,{op:"add",path:this.path,value:Sr(n)}),{newDocument:t}},test:function(r,e,t){return{newDocument:t,test:Hd(r[e],this.value)}},_get:function(r,e,t){return this.value=r[e],{newDocument:t}}};var fz={add:function(r,e,t){return Kg(e)?r.splice(e,0,this.value):r[e]=this.value,{newDocument:t,index:e}},remove:function(r,e,t){var n=r.splice(e,1);return{newDocument:t,removed:n[0]}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:ra.move,copy:ra.copy,test:ra.test,_get:ra._get};function Yg(r,e){if(e=="")return r;var t={op:"_get",path:e};return il(r,t),t.value}function il(r,e,t=!1,n=!0,s=!0,i=0){if(t&&(typeof t=="function"?t(e,0,r,e.path):Qg(e,0)),e.path===""){let a={newDocument:r};if(e.op==="add")return a.newDocument=e.value,a;if(e.op==="replace")return a.newDocument=e.value,a.removed=r,a;if(e.op==="move"||e.op==="copy")return a.newDocument=Yg(r,e.from),e.op==="move"&&(a.removed=r),a;if(e.op==="test"){if(a.test=Hd(r,e.value),a.test===!1)throw new xt("Test operation failed","TEST_OPERATION_FAILED",i,e,r);return a.newDocument=r,a}else{if(e.op==="remove")return a.removed=r,a.newDocument=null,a;if(e.op==="_get")return e.value=r,a;if(t)throw new xt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,e,r);return a}}else{n||(r=Sr(r));const o=(e.path||"").split("/");let l=r,c=1,u=o.length,d,h,f;for(typeof t=="function"?f=t:f=Qg;;){if(h=o[c],h&&h.indexOf("~")!=-1&&(h=dz(h)),s&&(h=="__proto__"||h=="prototype"&&c>0&&o[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&d===void 0&&(l[h]===void 0?d=o.slice(0,c).join("/"):c==u-1&&(d=e.path),d!==void 0&&f(e,0,r,d)),c++,Array.isArray(l)){if(h==="-")h=l.length;else{if(t&&!Kg(h))throw new xt("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,e,r);Kg(h)&&(h=~~h)}if(c>=u){if(t&&e.op==="add"&&h>l.length)throw new xt("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,e,r);const p=fz[e.op].call(e,l,h,r);if(p.test===!1)throw new xt("Test operation failed","TEST_OPERATION_FAILED",i,e,r);return p}}else if(c>=u){const p=ra[e.op].call(e,l,h,r);if(p.test===!1)throw new xt("Test operation failed","TEST_OPERATION_FAILED",i,e,r);return p}if(l=l[h],t&&c<u&&(!l||typeof l!="object"))throw new xt("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,e,r)}}}function qd(r,e,t,n=!0,s=!0){if(t&&!Array.isArray(e))throw new xt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(r=Sr(r));const i=new Array(e.length);for(let a=0,o=e.length;a<o;a++)i[a]=il(r,e[a],t,!0,s,a),r=i[a].newDocument;return i.newDocument=r,i}function Qg(r,e,t,n){if(typeof r!="object"||r===null||Array.isArray(r))throw new xt("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,r,t);if(ra[r.op]){if(typeof r.path!="string")throw new xt("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,r,t);if(r.path.indexOf("/")!==0&&r.path.length>0)throw new xt('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,r,t);if((r.op==="move"||r.op==="copy")&&typeof r.from!="string")throw new xt("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&r.value===void 0)throw new xt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&Xg(r.value))throw new xt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,r,t);if(t){if(r.op=="add"){var s=r.path.split("/").length,i=n.split("/").length;if(s!==i+1&&s!==i)throw new xt("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,r,t)}else if(r.op==="replace"||r.op==="remove"||r.op==="_get"){if(r.path!==n)throw new xt("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,r,t)}else if(r.op==="move"||r.op==="copy"){var a={op:"_get",path:r.from,value:void 0},o=pz([a],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new xt("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,r,t)}}}else throw new xt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,r,t)}function pz(r,e,t){try{if(!Array.isArray(r))throw new xt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)qd(Sr(e),Sr(r),t||!0);else{t=t||Qg;for(var n=0;n<r.length;n++)t(r[n],n,e,void 0)}}catch(s){if(s instanceof xt)return s;throw s}}function Hd(r,e){if(r===e)return!0;if(r&&e&&typeof r=="object"&&typeof e=="object"){var t=Array.isArray(r),n=Array.isArray(e),s,i,a;if(t&&n){if(i=r.length,i!=e.length)return!1;for(s=i;s--!==0;)if(!Hd(r[s],e[s]))return!1;return!0}if(t!=n)return!1;var o=Object.keys(r);if(i=o.length,i!==Object.keys(e).length)return!1;for(s=i;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=i;s--!==0;)if(a=o[s],!Hd(r[a],e[a]))return!1;return!0}return r!==r&&e!==e}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2013-2021 Joachim Wester
 * MIT license
 */function hA(r,e,t,n,s){if(e!==r){typeof e.toJSON=="function"&&(e=e.toJSON());for(var i=Jg(e),a=Jg(r),o=!1,l=a.length-1;l>=0;l--){var c=a[l],u=r[c];if(Zg(e,c)&&!(e[c]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var d=e[c];typeof u=="object"&&u!=null&&typeof d=="object"&&d!=null&&Array.isArray(u)===Array.isArray(d)?hA(u,d,t,n+"/"+qi(c),s):u!==d&&(s&&t.push({op:"test",path:n+"/"+qi(c),value:Sr(u)}),t.push({op:"replace",path:n+"/"+qi(c),value:Sr(d)}))}else Array.isArray(r)===Array.isArray(e)?(s&&t.push({op:"test",path:n+"/"+qi(c),value:Sr(u)}),t.push({op:"remove",path:n+"/"+qi(c)}),o=!0):(s&&t.push({op:"test",path:n,value:r}),t.push({op:"replace",path:n,value:e}))}if(!(!o&&i.length==a.length))for(var l=0;l<i.length;l++){var c=i[l];!Zg(r,c)&&e[c]!==void 0&&t.push({op:"add",path:n+"/"+qi(c),value:Sr(e[c])})}}}function mz(r,e,t=!1){var n=[];return hA(r,e,n,"",t),n}var pm={};const gz=()=>typeof window<"u"&&typeof window.document<"u",bz=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",_z=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),D_=()=>typeof Deno<"u",yz=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!D_(),wz=()=>{let r;return gz()?r="browser":yz()?r="node":bz()?r="webworker":_z()?r="jsdom":D_()?r="deno":r="other",r};let mm;async function vz(){return mm===void 0&&(mm={library:"langchain-js",runtime:wz()}),mm}function _n(r){try{return typeof process<"u"?pm==null?void 0:pm[r]:D_()?Deno==null?void 0:Deno.env.get(r):void 0}catch{return}}class xz{}function kz(r){return"lc_prefer_streaming"in r&&r.lc_prefer_streaming}class Rc extends xz{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,qP(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:_n("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return bi.prototype.toJSON.call(this)}toJSONNotImplemented(){return bi.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends Rc{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:sn()}),Object.assign(this,e)}}return new t}}const Sz=r=>{const e=r;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"};function gm(r,e){return r&&!Array.isArray(r)&&typeof r=="object"?r:{[e]:r}}function Pz(r){return r.replace(/[-:.]/g,"")}function Az(r,e,t){const n=t.toFixed(0).slice(0,3).padStart(3,"0");return Pz(`${new Date(r).toISOString().slice(0,-1)}${n}Z`)+e}function mo(r){return typeof r._addRunToRunMap=="function"}class Ic extends Rc{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){const t=Az(e.start_time,e.id,e.execution_order),n={...e};if(n.parent_run_id!==void 0){const s=this.runMap.get(n.parent_run_id);s&&(this._addChildRun(s,n),s.child_execution_order=Math.max(s.child_execution_order,n.child_execution_order),n.trace_id=s.trace_id,s.dotted_order!==void 0&&(n.dotted_order=[s.dotted_order,t].join(".")))}else n.trace_id=n.id,n.dotted_order=t;return this.runMap.set(n.id,n),n}async _endTrace(e){var n;const t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await((n=this.onRunUpdate)==null?void 0:n.call(this,e))}_getExecutionOrder(e){const t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,n,s,i,a,o,l){const c=this._getExecutionOrder(s),u=Date.now(),d=o?{...i,metadata:o}:i,h={id:n,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:d??{},tags:a||[]};return this._addRunToRunMap(h)}async handleLLMStart(e,t,n,s,i,a,o,l){var u,d;const c=this.runMap.get(n)??this._createRunForLLMStart(e,t,n,s,i,a,o,l);return await((u=this.onRunCreate)==null?void 0:u.call(this,c)),await((d=this.onLLMStart)==null?void 0:d.call(this,c)),c}_createRunForChatModelStart(e,t,n,s,i,a,o,l){const c=this._getExecutionOrder(s),u=Date.now(),d=o?{...i,metadata:o}:i,h={id:n,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:d??{},tags:a||[]};return this._addRunToRunMap(h)}async handleChatModelStart(e,t,n,s,i,a,o,l){var u,d;const c=this.runMap.get(n)??this._createRunForChatModelStart(e,t,n,s,i,a,o,l);return await((u=this.onRunCreate)==null?void 0:u.call(this,c)),await((d=this.onLLMStart)==null?void 0:d.call(this,c)),c}async handleLLMEnd(e,t,n,s,i){var o;const a=this.runMap.get(t);if(!a||(a==null?void 0:a.run_type)!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.outputs=e,a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...i},await((o=this.onLLMEnd)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleLLMError(e,t,n,s,i){var o;const a=this.runMap.get(t);if(!a||(a==null?void 0:a.run_type)!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...i},await((o=this.onLLMError)==null?void 0:o.call(this,a)),await this._endTrace(a),a}_createRunForChainStart(e,t,n,s,i,a,o,l){const c=this._getExecutionOrder(s),u=Date.now(),d={id:n,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:t,execution_order:c,child_execution_order:c,run_type:o??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(d)}async handleChainStart(e,t,n,s,i,a,o,l){var u,d;const c=this.runMap.get(n)??this._createRunForChainStart(e,t,n,s,i,a,o,l);return await((u=this.onRunCreate)==null?void 0:u.call(this,c)),await((d=this.onChainStart)==null?void 0:d.call(this,c)),c}async handleChainEnd(e,t,n,s,i){var o;const a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=gm(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(a.inputs=gm(i.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleChainError(e,t,n,s,i){var o;const a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(a.inputs=gm(i.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,a)),await this._endTrace(a),a}_createRunForToolStart(e,t,n,s,i,a,o){const l=this._getExecutionOrder(s),c=Date.now(),u={id:n,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:t},execution_order:l,child_execution_order:l,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(u)}async handleToolStart(e,t,n,s,i,a,o){var c,u;const l=this.runMap.get(n)??this._createRunForToolStart(e,t,n,s,i,a,o);return await((c=this.onRunCreate)==null?void 0:c.call(this,l)),await((u=this.onToolStart)==null?void 0:u.call(this,l)),l}async handleToolEnd(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((s=this.onToolEnd)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleToolError(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((s=this.onToolError)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleAgentAction(e,t){var i;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="chain")return;const s=n;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((i=this.onAgentAction)==null?void 0:i.call(this,n))}async handleAgentEnd(e,t){var s;const n=this.runMap.get(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentEnd)==null?void 0:s.call(this,n)))}_createRunForRetrieverStart(e,t,n,s,i,a,o){const l=this._getExecutionOrder(s),c=Date.now(),u={id:n,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:t},execution_order:l,child_execution_order:l,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(u)}async handleRetrieverStart(e,t,n,s,i,a,o){var c,u;const l=this.runMap.get(n)??this._createRunForRetrieverStart(e,t,n,s,i,a,o);return await((c=this.onRunCreate)==null?void 0:c.call(this,l)),await((u=this.onRetrieverStart)==null?void 0:u.call(this,l)),l}async handleRetrieverEnd(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((s=this.onRetrieverEnd)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleRetrieverError(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((s=this.onRetrieverError)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleText(e,t){var s;const n=this.runMap.get(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((s=this.onText)==null?void 0:s.call(this,n)))}async handleLLMNewToken(e,t,n,s,i,a){var l;const o=this.runMap.get(n);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:a==null?void 0:a.chunk}}),await((l=this.onLLMNewToken)==null?void 0:l.call(this,o,e,{chunk:a==null?void 0:a.chunk})),o}}var fd={exports:{}};fd.exports;var mx;function Ez(){return mx||(mx=1,function(r){const t=(i=0)=>a=>`\x1B[${38+i};5;${a}m`,n=(i=0)=>(a,o,l)=>`\x1B[${38+i};2;${a};${o};${l}m`;function s(){const i=new Map,a={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};a.color.gray=a.color.blackBright,a.bgColor.bgGray=a.bgColor.bgBlackBright,a.color.grey=a.color.blackBright,a.bgColor.bgGrey=a.bgColor.bgBlackBright;for(const[o,l]of Object.entries(a)){for(const[c,u]of Object.entries(l))a[c]={open:`\x1B[${u[0]}m`,close:`\x1B[${u[1]}m`},l[c]=a[c],i.set(u[0],u[1]);Object.defineProperty(a,o,{value:l,enumerable:!1})}return Object.defineProperty(a,"codes",{value:i,enumerable:!1}),a.color.close="\x1B[39m",a.bgColor.close="\x1B[49m",a.color.ansi256=t(),a.color.ansi16m=n(),a.bgColor.ansi256=t(10),a.bgColor.ansi16m=n(10),Object.defineProperties(a,{rgbToAnsi256:{value:(o,l,c)=>o===l&&l===c?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(l/255*5)+Math.round(c/255*5),enumerable:!1},hexToRgb:{value:o=>{const l=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!l)return[0,0,0];let{colorString:c}=l.groups;c.length===3&&(c=c.split("").map(d=>d+d).join(""));const u=Number.parseInt(c,16);return[u>>16&255,u>>8&255,u&255]},enumerable:!1},hexToAnsi256:{value:o=>a.rgbToAnsi256(...a.hexToRgb(o)),enumerable:!1}}),a}Object.defineProperty(r,"exports",{enumerable:!0,get:s})}(fd)),fd.exports}var Oz=Ez();const fA=Pi(Oz);function en(r,e){return`${r.open}${e}${r.close}`}function Ln(r,e){try{return JSON.stringify(r,null,2)}catch{return e}}function gx(r){return typeof r=="string"?r.trim():r==null?r:Ln(r,r.toString())}function hs(r){if(!r.end_time)return"";const e=r.end_time-r.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:fn}=fA;class bx extends Ic{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let n=e;for(;n.parent_run_id;){const s=this.runMap.get(n.parent_run_id);if(s)t.push(s),n=s;else break}return t}getBreadcrumbs(e){const n=[...this.getParents(e).reverse(),e].map((s,i,a)=>{const o=`${s.execution_order}:${s.run_type}:${s.name}`;return i===a.length-1?en(fA.bold,o):o}).join(" > ");return en(fn.grey,n)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${en(fn.green,"[chain/start]")} [${t}] Entering Chain run with input: ${Ln(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${en(fn.cyan,"[chain/end]")} [${t}] [${hs(e)}] Exiting Chain run with output: ${Ln(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${en(fn.red,"[chain/error]")} [${t}] [${hs(e)}] Chain run errored with error: ${Ln(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${en(fn.green,"[llm/start]")} [${t}] Entering LLM run with input: ${Ln(n,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${en(fn.cyan,"[llm/end]")} [${t}] [${hs(e)}] Exiting LLM run with output: ${Ln(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${en(fn.red,"[llm/error]")} [${t}] [${hs(e)}] LLM run errored with error: ${Ln(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${en(fn.green,"[tool/start]")} [${t}] Entering Tool run with input: "${gx(e.inputs.input)}"`)}onToolEnd(e){var n;const t=this.getBreadcrumbs(e);console.log(`${en(fn.cyan,"[tool/end]")} [${t}] [${hs(e)}] Exiting Tool run with output: "${gx((n=e.outputs)==null?void 0:n.output)}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${en(fn.red,"[tool/error]")} [${t}] [${hs(e)}] Tool run errored with error: ${Ln(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${en(fn.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${Ln(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${en(fn.cyan,"[retriever/end]")} [${t}] [${hs(e)}] Exiting Retriever run with output: ${Ln(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${en(fn.red,"[retriever/error]")} [${t}] [${hs(e)}] Retriever run errored with error: ${Ln(e.error,"[error]")}`)}onAgentAction(e){const t=e,n=this.getBreadcrumbs(e);console.log(`${en(fn.blue,"[agent/action]")} [${n}] Agent selected action: ${Ln(t.actions[t.actions.length-1],"[action]")}`)}}let bm;const Tz=()=>{if(bm===void 0){const r=_n("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};bm=new zl(r)}return bm};class al extends Ic{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:n,client:s}=e;this.projectName=n??_n("LANGCHAIN_PROJECT")??_n("LANGCHAIN_SESSION"),this.exampleId=t,this.client=s??Tz();const i=al.getTraceableRunTree();i&&this.updateFromRunTree(i)}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await vz()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id,extra:e.extra,session_name:this.projectName};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let t=e;const n=new Set;for(;t.parent_run&&!(n.has(t.id)||(n.add(t.id),!t.parent_run));)t=t.parent_run;n.clear();const s=[t];for(;s.length>0;){const i=s.shift();!i||n.has(i.id)||(n.add(i.id),this.runMap.set(i.id,i),i.child_runs&&s.push(...i.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){const t={},n=[];for(const[s,i]of this.runMap){const a=new En({...i,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});t[s]=a,n.push([s,i.dotted_order])}n.sort((s,i)=>!s[1]||!i[1]?0:s[1].localeCompare(i[1]));for(const[s]of n){const i=this.runMap.get(s),a=t[s];if(!(!i||!a)&&i.parent_run_id){const o=t[i.parent_run_id];o&&(o.child_runs.push(a),a.parent_run=o)}}return t[e]}static getTraceableRunTree(){try{return cz()}catch{return}}}const pA=Symbol.for("ls:tracing_async_local_storage"),pd=Symbol.for("lc:context_variables"),Rz=r=>{globalThis[pA]=r},Bl=()=>globalThis[pA];let ol;function Iz(){const r="default"in Qr?Qr.default:Qr;return new r({autoStart:!0,concurrency:1})}function Cz(){return typeof ol>"u"&&(ol=Iz()),ol}async function Et(r,e){if(e===!0){const t=Bl();t!==void 0?await t.run(void 0,async()=>r()):await r()}else ol=Cz(),ol.add(async()=>{const t=Bl();t!==void 0?await t.run(void 0,async()=>r()):await r()})}const $z=r=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>_n(t)==="true");function mA(r){var n;const e=Bl();if(e===void 0)return;const t=e.getStore();return(n=t==null?void 0:t[pd])==null?void 0:n[r]}const Mz=Symbol("lc:configure_hooks"),Nz=()=>mA(Mz)||[];function F_(r){return r?Array.isArray(r)||"name"in r?{callbacks:r}:r:{}}class Lz{setHandler(e){return this.setHandlers([e])}}class Qh{constructor(e,t,n,s,i,a,o,l){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:l})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>Et(async()=>{var n;try{await((n=t.handleText)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleCustomEvent(e,t,n,s,i){await Promise.all(this.handlers.map(a=>Et(async()=>{var o;try{await((o=a.handleCustomEvent)==null?void 0:o.call(a,e,t,this.runId,this.tags,this.metadata))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}}class jz extends Qh{getChild(e){const t=new an(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>Et(async()=>{var n;if(!t.ignoreRetriever)try{await((n=t.handleRetrieverEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw s}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>Et(async()=>{var n;if(!t.ignoreRetriever)try{await((n=t.handleRetrieverError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${s}`),t.raiseError)throw e}},t.awaitHandlers)))}}class _x extends Qh{async handleLLMNewToken(e,t,n,s,i,a){await Promise.all(this.handlers.map(o=>Et(async()=>{var l;if(!o.ignoreLLM)try{await((l=o.handleLLMNewToken)==null?void 0:l.call(o,e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a))}catch(c){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${c}`),o.raiseError)throw c}},o.awaitHandlers)))}async handleLLMError(e,t,n,s,i){await Promise.all(this.handlers.map(a=>Et(async()=>{var o;if(!a.ignoreLLM)try{await((o=a.handleLLMError)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMError: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}async handleLLMEnd(e,t,n,s,i){await Promise.all(this.handlers.map(a=>Et(async()=>{var o;if(!a.ignoreLLM)try{await((o=a.handleLLMEnd)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMEnd: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}}class Dz extends Qh{getChild(e){const t=new an(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,n,s,i){await Promise.all(this.handlers.map(a=>Et(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainError)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainError: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}async handleChainEnd(e,t,n,s,i){await Promise.all(this.handlers.map(a=>Et(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainEnd)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainEnd: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>Et(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleAgentAction)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>Et(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleAgentEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}}class Fz extends Qh{getChild(e){const t=new an(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>Et(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleToolError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>Et(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleToolEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}}class an extends Lz{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(t==null?void 0:t.handlers)??this.handlers,this.inheritableHandlers=(t==null?void 0:t.inheritableHandlers)??this.inheritableHandlers,this.tags=(t==null?void 0:t.tags)??this.tags,this.inheritableTags=(t==null?void 0:t.inheritableTags)??this.inheritableTags,this.metadata=(t==null?void 0:t.metadata)??this.metadata,this.inheritableMetadata=(t==null?void 0:t.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,n=void 0,s=void 0,i=void 0,a=void 0,o=void 0,l=void 0){return Promise.all(t.map(async(c,u)=>{const d=u===0&&n?n:sn();return await Promise.all(this.handlers.map(h=>{if(!h.ignoreLLM)return mo(h)&&h._createRunForLLMStart(e,[c],d,this._parentRunId,i,this.tags,this.metadata,l),Et(async()=>{var f;try{await((f=h.handleLLMStart)==null?void 0:f.call(h,e,[c],d,this._parentRunId,i,this.tags,this.metadata,l))}catch(p){if((h.raiseError?console.error:console.warn)(`Error in handler ${h.constructor.name}, handleLLMStart: ${p}`),h.raiseError)throw p}},h.awaitHandlers)})),new _x(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,n=void 0,s=void 0,i=void 0,a=void 0,o=void 0,l=void 0){return Promise.all(t.map(async(c,u)=>{const d=u===0&&n?n:sn();return await Promise.all(this.handlers.map(h=>{if(!h.ignoreLLM)return mo(h)&&h._createRunForChatModelStart(e,[c],d,this._parentRunId,i,this.tags,this.metadata,l),Et(async()=>{var f,p;try{if(h.handleChatModelStart)await((f=h.handleChatModelStart)==null?void 0:f.call(h,e,[c],d,this._parentRunId,i,this.tags,this.metadata,l));else if(h.handleLLMStart){const m=WP(c);await((p=h.handleLLMStart)==null?void 0:p.call(h,e,[m],d,this._parentRunId,i,this.tags,this.metadata,l))}}catch(m){if((h.raiseError?console.error:console.warn)(`Error in handler ${h.constructor.name}, handleLLMStart: ${m}`),h.raiseError)throw m}},h.awaitHandlers)})),new _x(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,n=sn(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreChain)return mo(l)&&l._createRunForChainStart(e,t,n,this._parentRunId,this.tags,this.metadata,s,o),Et(async()=>{var c;try{await((c=l.handleChainStart)==null?void 0:c.call(l,e,t,n,this._parentRunId,this.tags,this.metadata,s,o))}catch(u){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleChainStart: ${u}`),l.raiseError)throw u}},l.awaitHandlers)})),new Dz(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,n=sn(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreAgent)return mo(l)&&l._createRunForToolStart(e,t,n,this._parentRunId,this.tags,this.metadata,o),Et(async()=>{var c;try{await((c=l.handleToolStart)==null?void 0:c.call(l,e,t,n,this._parentRunId,this.tags,this.metadata,o))}catch(u){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleToolStart: ${u}`),l.raiseError)throw u}},l.awaitHandlers)})),new Fz(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,n=sn(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreRetriever)return mo(l)&&l._createRunForRetrieverStart(e,t,n,this._parentRunId,this.tags,this.metadata,o),Et(async()=>{var c;try{await((c=l.handleRetrieverStart)==null?void 0:c.call(l,e,t,n,this._parentRunId,this.tags,this.metadata,o))}catch(u){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleRetrieverStart: ${u}`),l.raiseError)throw u}},l.awaitHandlers)})),new jz(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,n,s,i){await Promise.all(this.handlers.map(a=>Et(async()=>{var o;if(!a.ignoreCustomEvent)try{await((o=a.handleCustomEvent)==null?void 0:o.call(a,e,t,n,this.tags,this.metadata))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const n of e)this.addHandler(n,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const n=new an(this._parentRunId);for(const s of this.handlers){const i=this.inheritableHandlers.includes(s);n.addHandler(s,i)}for(const s of this.tags){const i=this.inheritableTags.includes(s);n.addTags([s],i)}for(const s of Object.keys(this.metadata)){const i=Object.keys(this.inheritableMetadata).includes(s);n.addMetadata({[s]:this.metadata[s]},i)}for(const s of e)n.handlers.filter(i=>i.name==="console_callback_handler").some(i=>i.name===s.name)||n.addHandler(s,t);return n}static fromHandlers(e){class t extends Rc{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:sn()}),Object.assign(this,e)}}const n=new this;return n.addHandler(new t),n}static configure(e,t,n,s,i,a,o){return this._configureSync(e,t,n,s,i,a,o)}static _configureSync(e,t,n,s,i,a,o){var h,f;let l;(e||t)&&(Array.isArray(e)||!e?(l=new an,l.setHandlers((e==null?void 0:e.map(Wd))??[],!0)):l=e,l=l.copy(Array.isArray(t)?t.map(Wd):t==null?void 0:t.handlers,!1));const c=_n("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),u=((h=al.getTraceableRunTree())==null?void 0:h.tracingEnabled)||$z(),d=u||(_n("LANGCHAIN_TRACING")??!1);if(c||d){if(l||(l=new an),c&&!l.handlers.some(p=>p.name===bx.prototype.name)){const p=new bx;l.addHandler(p,!0)}if(d&&!l.handlers.some(p=>p.name==="langchain_tracer")&&u){const p=new al;l.addHandler(p,!0),l._parentRunId=((f=al.getTraceableRunTree())==null?void 0:f.id)??l._parentRunId}}for(const{contextVar:p,inheritable:m=!0,handlerClass:g,envVar:b}of Nz()){const _=b&&_n(b)==="true"&&g;let y;const w=p!==void 0?mA(p):void 0;w&&Sz(w)?y=w:_&&(y=new g({})),y!==void 0&&(l||(l=new an),l.handlers.some(v=>v.name===y.name)||l.addHandler(y,m))}return(n||s)&&l&&(l.addTags(n??[]),l.addTags(s??[],!1)),(i||a)&&l&&(l.addMetadata(i??{}),l.addMetadata(a??{},!1)),l}}function Wd(r){return"name"in r?r:Rc.fromMethods(r)}class zz{getStore(){}run(e,t){return t()}enterWith(e){}}const Bz=new zz,yx=Symbol.for("lc:child_config");class Uz{getInstance(){return Bl()??Bz}getRunnableConfig(){var t,n;return(n=(t=this.getInstance().getStore())==null?void 0:t.extra)==null?void 0:n[yx]}runWithConfig(e,t,n){var u;const s=an._configureSync(e==null?void 0:e.callbacks,void 0,e==null?void 0:e.tags,void 0,e==null?void 0:e.metadata),i=this.getInstance(),a=i.getStore(),o=s==null?void 0:s.getParentRunId(),l=(u=s==null?void 0:s.handlers)==null?void 0:u.find(d=>(d==null?void 0:d.name)==="langchain_tracer");let c;return l&&o?c=l.convertToRunTree(o):n||(c=new En({name:"<runnable_lambda>",tracingEnabled:!1})),c&&(c.extra={...c.extra,[yx]:e}),a!==void 0&&a[pd]!==void 0&&(c===void 0&&(c={}),c[pd]=a[pd]),i.run(c,t)}initializeGlobalInstance(e){Bl()===void 0&&Rz(e)}}const Rr=new Uz,_m=25;async function sr(r){return an._configureSync(r==null?void 0:r.callbacks,void 0,r==null?void 0:r.tags,void 0,r==null?void 0:r.metadata)}function wx(...r){const e={};for(const t of r.filter(n=>!!n))for(const n of Object.keys(t))if(n==="metadata")e[n]={...e[n],...t[n]};else if(n==="tags"){const s=e[n]??[];e[n]=[...new Set(s.concat(t[n]??[]))]}else if(n==="configurable")e[n]={...e[n],...t[n]};else if(n==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(n==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(n==="callbacks"){const s=e.callbacks,i=t.callbacks;if(Array.isArray(i))if(!s)e.callbacks=i;else if(Array.isArray(s))e.callbacks=s.concat(i);else{const a=s.copy();for(const o of i)a.addHandler(Wd(o),!0);e.callbacks=a}else if(i)if(!s)e.callbacks=i;else if(Array.isArray(s)){const a=i.copy();for(const o of s)a.addHandler(Wd(o),!0);e.callbacks=a}else e.callbacks=new an(i._parentRunId,{handlers:s.handlers.concat(i.handlers),inheritableHandlers:s.inheritableHandlers.concat(i.inheritableHandlers),tags:Array.from(new Set(s.tags.concat(i.tags))),inheritableTags:Array.from(new Set(s.inheritableTags.concat(i.inheritableTags))),metadata:{...s.metadata,...i.metadata}})}else{const s=n;e[s]=t[s]??e[s]}return e}const qz=new Set(["string","number","boolean"]);function We(r){var n;const e=Rr.getRunnableConfig();let t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:s,runName:i,...a}=e;t=Object.entries(a).reduce((o,[l,c])=>(c!==void 0&&(o[l]=c),o),t)}if(r&&(t=Object.entries(r).reduce((s,[i,a])=>(a!==void 0&&(s[i]=a),s),t)),t!=null&&t.configurable)for(const s of Object.keys(t.configurable))qz.has(typeof t.configurable[s])&&!((n=t.metadata)!=null&&n[s])&&(t.metadata||(t.metadata={}),t.metadata[s]=t.configurable[s]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");const s=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,s])):t.signal=s,delete t.timeout}return t}function Mt(r={},{callbacks:e,maxConcurrency:t,recursionLimit:n,runName:s,configurable:i,runId:a}={}){const o=We(r);return e!==void 0&&(delete o.runName,o.callbacks=e),n!==void 0&&(o.recursionLimit=n),t!==void 0&&(o.maxConcurrency=t),s!==void 0&&(o.runName=s),i!==void 0&&(o.configurable={...o.configurable,...i}),a!==void 0&&delete o.runId,o}function Ns(r){return r?{configurable:r.configurable,recursionLimit:r.recursionLimit,callbacks:r.callbacks,tags:r.tags,metadata:r.metadata,maxConcurrency:r.maxConcurrency,timeout:r.timeout,signal:r.signal}:void 0}async function Ls(r,e){if(e===void 0)return r;let t;return Promise.race([r.catch(n=>{if(!(e!=null&&e.aborted))throw n}),new Promise((n,s)=>{t=()=>{s(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&s(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))}class In extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const t=e.getReader();return new In({start(n){return s();function s(){return t.read().then(({done:i,value:a})=>{if(i){n.close();return}return n.enqueue(a),s()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new In({async pull(t){const{value:n,done:s}=await e.next();s&&t.close(),t.enqueue(n)},async cancel(t){await e.return(t)}})}}function gA(r,e=2){const t=Array.from({length:e},()=>[]);return t.map(async function*(s){for(;;)if(s.length===0){const i=await r.next();for(const a of t)a.push(i)}else{if(s[0].done)return;yield s.shift().value}})}function ir(r,e){if(Array.isArray(r)&&Array.isArray(e))return r.concat(e);if(typeof r=="string"&&typeof e=="string")return r+e;if(typeof r=="number"&&typeof e=="number")return r+e;if("concat"in r&&typeof r.concat=="function")return r.concat(e);if(typeof r=="object"&&typeof e=="object"){const t={...r};for(const[n,s]of Object.entries(e))n in t&&!Array.isArray(t[n])?t[n]=ir(t[n],s):t[n]=s;return t}else throw new Error(`Cannot concat ${typeof r} and ${typeof e}`)}class Za{constructor(e){var t;Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??((t=this.config)==null?void 0:t.signal),this.setup=new Promise((n,s)=>{Rr.runWithConfig(Ns(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(n,s):this.firstResult.then(i=>n(void 0),s)},!0)})}async next(...e){var t;return(t=this.signal)==null||t.throwIfAborted(),this.firstResultUsed?Rr.runWithConfig(Ns(this.config),this.signal?async()=>Ls(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}async function Hz(r,e,t,n,...s){const i=new Za({generator:e,startSetup:t,signal:n}),a=await i.setup;return{output:r(i,a,...s),setup:a}}class bs{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),n=qd({},t);return new Ul({ops:t,state:n[n.length-1].newDocument})}}class Ul extends bs{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),n=qd(this.state,e.ops);return new Ul({ops:t,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){const t=qd({},e.ops);return new Ul({ops:e.ops,state:t[t.length-1].newDocument})}}const Wz=r=>r.name==="log_stream_tracer";async function vx(r,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:t}=r;if(["retriever","llm","prompt"].includes(r.run_type))return t;if(!(Object.keys(t).length===1&&(t==null?void 0:t.input)===""))return t.input}async function xx(r,e){const{outputs:t}=r;return e==="original"||["retriever","llm","prompt"].includes(r.run_type)?t:t!==void 0&&Object.keys(t).length===1&&(t==null?void 0:t.output)!==void 0?t.output:t}function Vz(r){return r!==void 0&&r.message!==void 0}class kx extends Ic{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=In.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||t.find(s=>{var i;return(i=this.includeTags)==null?void 0:i.includes(s)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&t.every(s=>{var i;return!((i=this.excludeTags)!=null&&i.includes(s))})),n}async*tapOutputIterable(e,t){for await(const n of t){if(e!==this.rootId){const s=this.keyMapByRunId[e];s&&await this.writer.write(new bs({ops:[{op:"add",path:`/logs/${s}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){var s;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new bs({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;const n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=await vx(e,this._schemaFormat)),await this.writer.write(new bs({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(t===void 0)return;const n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${t}/inputs`,value:await vx(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${t}/final_output`,value:await xx(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const s=new bs({ops:n});await this.writer.write(s)}finally{if(e.id===this.rootId){const t=new bs({ops:[{op:"replace",path:"/final_output",value:await xx(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,n){const s=this.keyMapByRunId[e.id];if(s===void 0)return;const i=e.inputs.messages!==void 0;let a;i?Vz(n==null?void 0:n.chunk)?a=n==null?void 0:n.chunk:a=new mt({id:`run-${e.id}`,content:t}):a=t;const o=new bs({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${s}/streamed_output/-`,value:a}]});await this.writer.write(o)}}const Sx="__run";class Ma{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new Ma({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class lr extends Ma{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new lr({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}function Su({name:r,serialized:e}){return r!==void 0?r:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const Gz=r=>r.name==="event_stream_tracer";class Zz extends Ic{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=In.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const t=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(n=n||t.find(s=>{var i;return(i=this.includeTags)==null?void 0:i.includes(s)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(n=n&&t.every(s=>{var i;return!((i=this.excludeTags)!=null&&i.includes(s))})),n}async*tapOutputIterable(e,t){const n=await t.next();if(n.done)return;const s=this.runInfoMap.get(e);if(s===void 0){yield n.value;return}function i(o,l){return o==="llm"&&typeof l=="string"?new Ma({text:l}):l}let a=this.tappedPromises.get(e);if(a===void 0){let o;a=new Promise(l=>{o=l}),this.tappedPromises.set(e,a);try{const l={event:`on_${s.runType}_stream`,run_id:e,name:s.name,tags:s.tags,metadata:s.metadata,data:{}};await this.send({...l,data:{chunk:i(s.runType,n.value)}},s),yield n.value;for await(const c of t)s.runType!=="tool"&&s.runType!=="retriever"&&await this.send({...l,data:{chunk:i(s.runType,c)}},s),yield c}finally{o()}}else{yield n.value;for await(const o of t)yield o}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){const n=this.tappedPromises.get(e.run_id);n!==void 0?n.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){var a,o;const t=Su(e),n=e.inputs.messages!==void 0?"chat_model":"llm",s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,s);const i=`on_${n}_start`;await this.send({event:i,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onLLMNewToken(e,t,n){const s=this.runInfoMap.get(e.id);let i,a;if(s===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(s.runType==="chat_model")a="on_chat_model_stream",(n==null?void 0:n.chunk)===void 0?i=new mt({content:t,id:`run-${e.id}`}):i=n.chunk.message;else if(s.runType==="llm")a="on_llm_stream",(n==null?void 0:n.chunk)===void 0?i=new Ma({text:t}):i=n.chunk;else throw new Error(`Unexpected run type ${s.runType}`);await this.send({event:a,data:{chunk:i},run_id:e.id,name:s.name,tags:s.tags,metadata:s.metadata},s)}}async onLLMEnd(e){var a,o,l;const t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let n;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const s=(a=e.outputs)==null?void 0:a.generations;let i;if(t.runType==="chat_model"){for(const c of s??[]){if(i!==void 0)break;i=(o=c[0])==null?void 0:o.message}n="on_chat_model_end"}else if(t.runType==="llm")i={generations:s==null?void 0:s.map(c=>c.map(u=>({text:u.text,generationInfo:u.generationInfo}))),llmOutput:((l=e.outputs)==null?void 0:l.llmOutput)??{}},n="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:n,data:{output:i,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){var a,o;const t=Su(e),n=e.run_type??"chain",s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:e.run_type};let i={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(i={},s.inputs={}):e.inputs.input!==void 0?(i.input=e.inputs.input,s.inputs=e.inputs.input):(i.input=e.inputs,s.inputs=e.inputs),this.runInfoMap.set(e.id,s),await this.send({event:`on_${n}_start`,data:i,name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onChainEnd(e){var o;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const n=`on_${e.run_type}_end`,s=e.inputs??t.inputs??{},a={output:((o=e.outputs)==null?void 0:o.output)??e.outputs,input:s};s.input&&Object.keys(s).length===1&&(a.input=s.input,t.inputs=s.input),await this.sendEndEvent({event:n,data:a,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){var s,i;const t=Su(e),n={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{}},n)}async onToolEnd(e){var s;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const n=((s=e.outputs)==null?void 0:s.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:n,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){var i,a;const t=Su(e),s={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,s),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:((a=e.extra)==null?void 0:a.metadata)??{}},s)}async onRetrieverEnd(e){var n;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((n=e.outputs)==null?void 0:n.documents)??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,n){const s=this.runInfoMap.get(n);if(s===void 0)throw new Error(`handleCustomEvent: Run ID ${n} not found in run map.`);await this.send({event:"on_custom_event",run_id:n,name:e,tags:s.tags,metadata:s.metadata,data:t},s)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const Jz=[400,401,402,403,404,405,406,407,409],Kz=r=>{var t,n;if(r.message.startsWith("Cancel")||r.message.startsWith("AbortError")||r.name==="AbortError"||(r==null?void 0:r.code)==="ECONNABORTED")throw r;const e=((t=r==null?void 0:r.response)==null?void 0:t.status)??(r==null?void 0:r.status);if(e&&Jz.includes(+e))throw r;if(((n=r==null?void 0:r.error)==null?void 0:n.code)==="insufficient_quota"){const s=new Error(r==null?void 0:r.message);throw s.name="InsufficientQuotaError",s}};class z_{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??Kz;const t="default"in Qr?Qr.default:Qr;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>zd(()=>e(...t).catch(n=>{throw n instanceof Error?n:new Error(n)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}class bA extends Ic{constructor({config:e,onStart:t,onEnd:n,onError:s}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=n,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function B_(r){return r?r.lc_runnable:!1}class Xz{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let n=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const s=e.tags??[];return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(t)),this.includeTags!==void 0&&(n=n||s.some(i=>{var a;return(a=this.includeTags)==null?void 0:a.includes(i)})),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(n=n&&s.every(i=>{var a;return!((a=this.excludeTags)!=null&&a.includes(i))})),n}}const Yz=Symbol("Let zodToJsonSchema decide on which parser to use"),Qz={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},eB=r=>({...Qz,...r}),tB=r=>{const e=eB(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function _A(r,e,t,n){n!=null&&n.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function Ke(r,e,t,n,s){r[e]=t,_A(r,e,n,s)}function nB(){return{}}function rB(r,e){var n,s,i;const t={type:"array"};return(n=r.type)!=null&&n._def&&((i=(s=r.type)==null?void 0:s._def)==null?void 0:i.typeName)!==L.ZodAny&&(t.items=Ge(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&Ke(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&Ke(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(Ke(t,"minItems",r.exactLength.value,r.exactLength.message,e),Ke(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function sB(r,e){const t={type:"integer",format:"int64"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?Ke(t,"minimum",n.value,n.message,e):Ke(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Ke(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Ke(t,"maximum",n.value,n.message,e):Ke(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Ke(t,"maximum",n.value,n.message,e));break;case"multipleOf":Ke(t,"multipleOf",n.value,n.message,e);break}return t}function iB(){return{type:"boolean"}}function yA(r,e){return Ge(r.type._def,e)}const aB=(r,e)=>Ge(r.innerType._def,e);function wA(r,e,t){const n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((s,i)=>wA(r,e,s))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return oB(r,e)}}const oB=(r,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const n of r.checks)switch(n.kind){case"min":Ke(t,"minimum",n.value,n.message,e);break;case"max":Ke(t,"maximum",n.value,n.message,e);break}return t};function lB(r,e){return{...Ge(r.innerType._def,e),default:r.defaultValue()}}function cB(r,e){return e.effectStrategy==="input"?Ge(r.schema._def,e):{}}function uB(r){return{type:"string",enum:Array.from(r.values)}}const dB=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function hB(r,e){const t=[Ge(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Ge(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(i=>{if(dB(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(n=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...l}=i;a=l}else n=void 0;s.push(a)}}),s.length?{allOf:s,...n}:void 0}function fB(r,e){const t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}let ym;const Bn={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(ym===void 0&&(ym=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),ym),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function vA(r,e){const t={type:"string"};if(r.checks)for(const n of r.checks)switch(n.kind){case"min":Ke(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e);break;case"max":Ke(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Un(t,"email",n.message,e);break;case"format:idn-email":Un(t,"idn-email",n.message,e);break;case"pattern:zod":tn(t,Bn.email,n.message,e);break}break;case"url":Un(t,"uri",n.message,e);break;case"uuid":Un(t,"uuid",n.message,e);break;case"regex":tn(t,n.regex,n.message,e);break;case"cuid":tn(t,Bn.cuid,n.message,e);break;case"cuid2":tn(t,Bn.cuid2,n.message,e);break;case"startsWith":tn(t,RegExp(`^${wm(n.value,e)}`),n.message,e);break;case"endsWith":tn(t,RegExp(`${wm(n.value,e)}$`),n.message,e);break;case"datetime":Un(t,"date-time",n.message,e);break;case"date":Un(t,"date",n.message,e);break;case"time":Un(t,"time",n.message,e);break;case"duration":Un(t,"duration",n.message,e);break;case"length":Ke(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e),Ke(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"includes":{tn(t,RegExp(wm(n.value,e)),n.message,e);break}case"ip":{n.version!=="v6"&&Un(t,"ipv4",n.message,e),n.version!=="v4"&&Un(t,"ipv6",n.message,e);break}case"base64url":tn(t,Bn.base64url,n.message,e);break;case"jwt":tn(t,Bn.jwt,n.message,e);break;case"cidr":{n.version!=="v6"&&tn(t,Bn.ipv4Cidr,n.message,e),n.version!=="v4"&&tn(t,Bn.ipv6Cidr,n.message,e);break}case"emoji":tn(t,Bn.emoji(),n.message,e);break;case"ulid":{tn(t,Bn.ulid,n.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Un(t,"binary",n.message,e);break}case"contentEncoding:base64":{Ke(t,"contentEncoding","base64",n.message,e);break}case"pattern:zod":{tn(t,Bn.base64,n.message,e);break}}break}case"nanoid":tn(t,Bn.nanoid,n.message,e)}return t}function wm(r,e){return e.patternStrategy==="escape"?mB(r):r}const pB=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function mB(r){let e="";for(let t=0;t<r.length;t++)pB.has(r[t])||(e+="\\"),e+=r[t];return e}function Un(r,e,t,n){var s;r.format||(s=r.anyOf)!=null&&s.some(i=>i.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):Ke(r,"format",e,t,n)}function tn(r,e,t,n){var s;r.pattern||(s=r.allOf)!=null&&s.some(i=>i.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:Px(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):Ke(r,"pattern",Px(e,n),t,n)}function Px(r,e){var l;if(!e.applyRegexFlags||!r.flags)return r.source;const t={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},n=t.i?r.source.toLowerCase():r.source;let s="",i=!1,a=!1,o=!1;for(let c=0;c<n.length;c++){if(i){s+=n[c],i=!1;continue}if(t.i){if(a){if(n[c].match(/[a-z]/)){o?(s+=n[c],s+=`${n[c-2]}-${n[c]}`.toUpperCase(),o=!1):n[c+1]==="-"&&((l=n[c+2])!=null&&l.match(/[a-z]/))?(s+=n[c],o=!0):s+=`${n[c]}${n[c].toUpperCase()}`;continue}}else if(n[c].match(/[a-z]/)){s+=`[${n[c]}${n[c].toUpperCase()}]`;continue}}if(t.m){if(n[c]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(n[c]==="$"){s+=`($|(?=[\r
]))`;continue}}if(t.s&&n[c]==="."){s+=a?`${n[c]}\r
`:`[${n[c]}\r
]`;continue}s+=n[c],n[c]==="\\"?i=!0:a&&n[c]==="]"?a=!1:!a&&n[c]==="["&&(a=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return s}function xA(r,e){var n,s,i,a,o,l;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((n=r.keyType)==null?void 0:n._def.typeName)===L.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((c,u)=>({...c,[u]:Ge(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",u]})??{}}),{}),additionalProperties:e.rejectedAdditionalProperties};const t={type:"object",additionalProperties:Ge(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(((s=r.keyType)==null?void 0:s._def.typeName)===L.ZodString&&((i=r.keyType._def.checks)!=null&&i.length)){const{type:c,...u}=vA(r.keyType._def,e);return{...t,propertyNames:u}}else{if(((a=r.keyType)==null?void 0:a._def.typeName)===L.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};if(((o=r.keyType)==null?void 0:o._def.typeName)===L.ZodBranded&&r.keyType._def.type._def.typeName===L.ZodString&&((l=r.keyType._def.type._def.checks)!=null&&l.length)){const{type:c,...u}=yA(r.keyType._def,e);return{...t,propertyNames:u}}}return t}function gB(r,e){if(e.mapStrategy==="record")return xA(r,e);const t=Ge(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=Ge(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function bB(r){const e=r.values,n=Object.keys(r.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(n.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function _B(){return{not:{}}}function yB(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Vd={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function wB(r,e){if(e.target==="openApi3")return Ax(r,e);const t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in Vd&&(!n._def.checks||!n._def.checks.length))){const n=t.reduce((s,i)=>{const a=Vd[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=t.reduce((s,i)=>{const a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===t.length){const s=n.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,s)=>[...n,...s._def.values.filter(i=>!n.includes(i))],[])};return Ax(r,e)}const Ax=(r,e)=>{const t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,s)=>Ge(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function vB(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"?{type:Vd[r.innerType._def.typeName],nullable:!0}:{type:[Vd[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=Ge(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const t=Ge(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function xB(r,e){const t={type:"number"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"int":t.type="integer",_A(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?Ke(t,"minimum",n.value,n.message,e):Ke(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Ke(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Ke(t,"maximum",n.value,n.message,e):Ke(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Ke(t,"maximum",n.value,n.message,e));break;case"multipleOf":Ke(t,"multipleOf",n.value,n.message,e);break}return t}function kB(r,e){const t=e.target==="openAi",n={type:"object",properties:{}},s=[],i=r.shape();for(const o in i){let l=i[o];if(l===void 0||l._def===void 0)continue;let c=PB(l);c&&t&&(l instanceof rr&&(l=l._def.innerType),l.isNullable()||(l=l.nullable()),c=!1);const u=Ge(l._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});u!==void 0&&(n.properties[o]=u,c||s.push(o))}s.length&&(n.required=s);const a=SB(r,e);return a!==void 0&&(n.additionalProperties=a),n}function SB(r,e){if(r.catchall._def.typeName!=="ZodNever")return Ge(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(r.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function PB(r){try{return r.isOptional()}catch{return!0}}const AB=(r,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return Ge(r.innerType._def,e);const t=Ge(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},EB=(r,e)=>{if(e.pipeStrategy==="input")return Ge(r.in._def,e);if(e.pipeStrategy==="output")return Ge(r.out._def,e);const t=Ge(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=Ge(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(s=>s!==void 0)}};function OB(r,e){return Ge(r.type._def,e)}function TB(r,e){const n={type:"array",uniqueItems:!0,items:Ge(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&Ke(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&Ke(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function RB(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>Ge(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:Ge(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>Ge(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function IB(){return{not:{}}}function CB(){return{}}const $B=(r,e)=>Ge(r.innerType._def,e),MB=(r,e,t)=>{switch(e){case L.ZodString:return vA(r,t);case L.ZodNumber:return xB(r,t);case L.ZodObject:return kB(r,t);case L.ZodBigInt:return sB(r,t);case L.ZodBoolean:return iB();case L.ZodDate:return wA(r,t);case L.ZodUndefined:return IB();case L.ZodNull:return yB(t);case L.ZodArray:return rB(r,t);case L.ZodUnion:case L.ZodDiscriminatedUnion:return wB(r,t);case L.ZodIntersection:return hB(r,t);case L.ZodTuple:return RB(r,t);case L.ZodRecord:return xA(r,t);case L.ZodLiteral:return fB(r,t);case L.ZodEnum:return uB(r);case L.ZodNativeEnum:return bB(r);case L.ZodNullable:return vB(r,t);case L.ZodOptional:return AB(r,t);case L.ZodMap:return gB(r,t);case L.ZodSet:return TB(r,t);case L.ZodLazy:return()=>r.getter()._def;case L.ZodPromise:return OB(r,t);case L.ZodNaN:case L.ZodNever:return _B();case L.ZodEffects:return cB(r,t);case L.ZodAny:return nB();case L.ZodUnknown:return CB();case L.ZodDefault:return lB(r,t);case L.ZodBranded:return yA(r,t);case L.ZodReadonly:return $B(r,t);case L.ZodCatch:return aB(r,t);case L.ZodPipeline:return EB(r,t);case L.ZodFunction:case L.ZodVoid:case L.ZodSymbol:return;default:return(n=>{})()}};function Ge(r,e,t=!1){var o;const n=e.seen.get(r);if(e.override){const l=(o=e.override)==null?void 0:o.call(e,r,e,n,t);if(l!==Yz)return l}if(n&&!t){const l=NB(n,e);if(l!==void 0)return l}const s={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,s);const i=MB(r,r.typeName,e),a=typeof i=="function"?Ge(i(),e):i;if(a&&jB(r,e,a),e.postProcess){const l=e.postProcess(a,r,e);return s.jsonSchema=a,l}return s.jsonSchema=a,a}const NB=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"relative":return{$ref:LB(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((t,n)=>e.currentPath[n]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},LB=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},jB=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t),js=(r,e)=>{const t=tB(e),n=void 0,s=e==null?void 0:e.name,i=Ge(r._def,t,!1)??{},a=s===void 0?n?{...i,[t.definitionPath]:n}:i:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...n,[s]:i}};return t.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in a||"oneOf"in a||"allOf"in a||"type"in a&&Array.isArray(a.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),a};function vm(r){return r.replace(/[^a-zA-Z-_0-9]/g,"_")}const DB=["*","_","`"];function FB(r){let e="";for(const[t,n]of Object.entries(r))e+=`	classDef ${t} ${n};
`;return e}function zB(r,e,t){const{firstNode:n,lastNode:s,nodeColors:i,withStyles:a=!0,curveStyle:o="linear",wrapLabelNWords:l=9}=t??{};let c=a?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(a){const f="default",p={[f]:"{0}({1})"};n!==void 0&&(p[n]="{0}([{1}]):::first"),s!==void 0&&(p[s]="{0}([{1}]):::last");for(const[m,g]of Object.entries(r)){const b=g.name.split(":").pop()??"";let y=DB.some(v=>b.startsWith(v)&&b.endsWith(v))?`<p>${b}</p>`:b;Object.keys(g.metadata??{}).length&&(y+=`<hr/><small><em>${Object.entries(g.metadata??{}).map(([v,x])=>`${v} = ${x}`).join(`
`)}</em></small>`);const w=(p[m]??p[f]).replace("{0}",vm(m)).replace("{1}",y);c+=`	${w}
`}}const u={};for(const f of e){const p=f.source.split(":"),m=f.target.split(":"),g=p.filter((b,_)=>b===m[_]).join(":");u[g]||(u[g]=[]),u[g].push(f)}const d=new Set;function h(f,p){const m=f.length===1&&f[0].source===f[0].target;if(p&&!m){const g=p.split(":").pop();if(d.has(g))throw new Error(`Found duplicate subgraph '${g}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(g),c+=`	subgraph ${g}
`}for(const g of f){const{source:b,target:_,data:y,conditional:w}=g;let v="";if(y!==void 0){let x=y;const S=x.split(" ");S.length>l&&(x=Array.from({length:Math.ceil(S.length/l)},(k,R)=>S.slice(R*l,(R+1)*l).join(" ")).join("&nbsp;<br>&nbsp;")),v=w?` -. &nbsp;${x}&nbsp; .-> `:` -- &nbsp;${x}&nbsp; --> `}else v=w?" -.-> ":" --> ";c+=`	${vm(b)}${v}${vm(_)};
`}for(const g in u)g.startsWith(`${p}:`)&&g!==p&&h(u[g],g);p&&!m&&(c+=`	end
`)}h(u[""]??[],"");for(const f in u)!f.includes(":")&&f!==""&&h(u[f],f);return a&&(c+=FB(i??{})),c}async function BB(r,e){let{backgroundColor:t="white"}=e??{};const n=btoa(r);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));const s=`https://mermaid.ink/img/${n}?bgColor=${t}`,i=await fetch(s);if(!i.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${i.status}`,`Status text: ${i.statusText}`].join(`
`));return await i.blob()}function UB(r,e){if(r!==void 0&&!rl(r))return r;if(B_(e))try{let t=e.getName();return t=t.startsWith("Runnable")?t.slice(8):t,t}catch{return e.getName()}else return e.name??"UnknownSchema"}function qB(r){return B_(r.data)?{type:"runnable",data:{id:r.data.lc_id,name:r.data.getName()}}:{type:"schema",data:{...js(r.data.schema),title:r.data.name}}}class ef{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=(e==null?void 0:e.nodes)??this.nodes,this.edges=(e==null?void 0:e.edges)??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((t,n)=>{e[t.id]=rl(t.id)?n:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...qB(t)})),edges:this.edges.map(t=>{const n={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(n.data=t.data),typeof t.conditional<"u"&&(n.conditional=t.conditional),n})}}addNode(e,t,n){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);const s=t??sn(),i={id:s,data:e,name:UB(t,e),metadata:n};return this.nodes[s]=i,i}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,n,s){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);const i={source:e.id,target:t.id,data:n,conditional:s};return this.edges.push(i),i}firstNode(){return Ex(this)}lastNode(){return Ox(this)}extend(e,t=""){let n=t;Object.values(e.nodes).map(c=>c.id).every(rl)&&(n="");const i=c=>n?`${n}:${c}`:c;Object.entries(e.nodes).forEach(([c,u])=>{this.nodes[i(c)]={...u,id:i(c)}});const a=e.edges.map(c=>({...c,source:i(c.source),target:i(c.target)}));this.edges=[...this.edges,...a];const o=e.firstNode(),l=e.lastNode();return[o?{id:i(o.id),data:o.data}:void 0,l?{id:i(l.id),data:l.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&Ex(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&Ox(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(s=>[s.id,s.name])),t=new Map;Object.values(e).forEach(s=>{t.set(s,(t.get(s)||0)+1)});const n=s=>{const i=e[s];return rl(s)&&t.get(i)===1?i:s};return new ef({nodes:Object.fromEntries(Object.entries(this.nodes).map(([s,i])=>[n(s),{...i,id:n(s)}])),edges:this.edges.map(s=>({...s,source:n(s.source),target:n(s.target)}))})}drawMermaid(e){const{withStyles:t,curveStyle:n,nodeColors:s={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:i}=e??{},a=this.reid(),o=a.firstNode(),l=a.lastNode();return zB(a.nodes,a.edges,{firstNode:o==null?void 0:o.id,lastNode:l==null?void 0:l.id,withStyles:t,curveStyle:n,nodeColors:s,wrapLabelNWords:i})}async drawMermaidPng(e){const t=this.drawMermaid(e);return BB(t,{backgroundColor:e==null?void 0:e.backgroundColor})}}function Ex(r,e=[]){const t=new Set(r.edges.filter(s=>!e.includes(s.source)).map(s=>s.target)),n=[];for(const s of Object.values(r.nodes))!e.includes(s.id)&&!t.has(s.id)&&n.push(s);return n.length===1?n[0]:void 0}function Ox(r,e=[]){const t=new Set(r.edges.filter(s=>!e.includes(s.target)).map(s=>s.source)),n=[];for(const s of Object.values(r.nodes))!e.includes(s.id)&&!t.has(s.id)&&n.push(s);return n.length===1?n[0]:void 0}function HB(r){const e=new TextEncoder,t=new ReadableStream({async start(n){for await(const s of r)n.enqueue(e.encode(`event: data
data: ${JSON.stringify(s)}

`));n.enqueue(e.encode(`event: end

`)),n.close()}});return In.fromReadableStream(t)}function Tx(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.iterator]=="function"&&typeof r.next=="function"}const WB=r=>r!=null&&typeof r=="object"&&"next"in r&&typeof r.next=="function";function eb(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.asyncIterator]=="function"}function*Rx(r,e){for(;;){const{value:t,done:n}=Rr.runWithConfig(Ns(r),e.next.bind(e),!0);if(n)break;yield t}}async function*tb(r,e){const t=e[Symbol.asyncIterator]();for(;;){const{value:n,done:s}=await Rr.runWithConfig(Ns(r),t.next.bind(e),!0);if(s)break;yield n}}function $t(r,e){return r&&!Array.isArray(r)&&!(r instanceof Date)&&typeof r=="object"?r:{[e]:r}}class Lt extends bi{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new pi({bound:this,kwargs:e,config:{}})}map(){return new Gd({bound:this})}withRetry(e){return new VB({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new pi({bound:this,config:e,kwargs:{}})}withFallbacks(e){const t=Array.isArray(e)?e:e.fallbacks;return new ZB({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(We);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const n=Object.fromEntries(Object.entries(e).filter(([s])=>s!=="runId"));return Array.from({length:t},(s,i)=>We(i===0?e:n))}return Array.from({length:t},()=>We(e))}async batch(e,t,n){var l;const s=this._getOptionsList(t??{},e.length),i=((l=s[0])==null?void 0:l.maxConcurrency)??(n==null?void 0:n.maxConcurrency),a=new z_({maxConcurrency:i,onFailedAttempt:c=>{throw c}}),o=e.map((c,u)=>a.call(async()=>{try{return await this.invoke(c,s[u])}catch(d){if(n!=null&&n.returnExceptions)return d;throw d}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const n=We(t),s=new Za({generator:this._streamIterator(e,n),config:n});return await s.setup,In.fromAsyncGenerator(s)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=We(e):t=We({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,delete n.timeout,delete n.signal,[t,n]}async _callWithConfig(e,t,n){const s=We(n),i=await sr(s),a=await(i==null?void 0:i.handleChainStart(this.toJSON(),$t(t,"input"),s.runId,s==null?void 0:s.runType,void 0,void 0,(s==null?void 0:s.runName)??this.getName()));delete s.runId;let o;try{const l=e.call(this,t,s,a);o=await Ls(l,n==null?void 0:n.signal)}catch(l){throw await(a==null?void 0:a.handleChainError(l)),l}return await(a==null?void 0:a.handleChainEnd($t(o,"output"))),o}async _batchWithConfig(e,t,n,s){var c;const i=this._getOptionsList(n??{},t.length),a=await Promise.all(i.map(sr)),o=await Promise.all(a.map(async(u,d)=>{const h=await(u==null?void 0:u.handleChainStart(this.toJSON(),$t(t[d],"input"),i[d].runId,i[d].runType,void 0,void 0,i[d].runName??this.getName()));return delete i[d].runId,h}));let l;try{const u=e.call(this,t,i,o,s);l=await Ls(u,(c=i==null?void 0:i[0])==null?void 0:c.signal)}catch(u){throw await Promise.all(o.map(d=>d==null?void 0:d.handleChainError(u))),u}return await Promise.all(o.map(u=>u==null?void 0:u.handleChainEnd($t(l,"output")))),l}async*_transformStreamWithConfig(e,t,n){let s,i=!0,a,o=!0;const l=We(n),c=await sr(l);async function*u(){for await(const h of e){if(i)if(s===void 0)s=h;else try{s=ir(s,h)}catch{s=void 0,i=!1}yield h}}let d;try{const h=await Hz(t.bind(this),u(),async()=>c==null?void 0:c.handleChainStart(this.toJSON(),{input:""},l.runId,l.runType,void 0,void 0,l.runName??this.getName()),n==null?void 0:n.signal,l);delete l.runId,d=h.setup;const f=d==null?void 0:d.handlers.find(Gz);let p=h.output;f!==void 0&&d!==void 0&&(p=f.tapOutputIterable(d.runId,p));const m=d==null?void 0:d.handlers.find(Wz);m!==void 0&&d!==void 0&&(p=m.tapOutputIterable(d.runId,p));for await(const g of p)if(yield g,o)if(a===void 0)a=g;else try{a=ir(a,g)}catch{a=void 0,o=!1}}catch(h){throw await(d==null?void 0:d.handleChainError(h,void 0,void 0,void 0,{inputs:$t(s,"input")})),h}await(d==null?void 0:d.handleChainEnd(a??{},void 0,void 0,void 0,{inputs:$t(s,"input")}))}getGraph(e){const t=new ef,n=t.addNode({name:`${this.getName()}Input`,schema:He.any()}),s=t.addNode(this),i=t.addNode({name:`${this.getName()}Output`,schema:He.any()});return t.addEdge(n,s),t.addEdge(s,i),t}pipe(e){return new Qn({first:this,last:ai(e)})}pick(e){return this.pipe(new JB(e))}assign(e){return this.pipe(new kA(new Ja({steps:e})))}async*transform(e,t){let n;for await(const s of e)n===void 0?n=s:n=ir(n,s);yield*this._streamIterator(n,We(t))}async*streamLog(e,t,n){const s=new kx({...n,autoClose:!1,_schemaFormat:"original"}),i=We(t);yield*this._streamLog(e,s,i)}async*_streamLog(e,t,n){const{callbacks:s}=n;if(s===void 0)n.callbacks=[t];else if(Array.isArray(s))n.callbacks=s.concat([t]);else{const l=s.copy();l.addHandler(t,!0),n.callbacks=l}const i=this.stream(e,n);async function a(){try{const l=await i;for await(const c of l){const u=new bs({ops:[{op:"add",path:"/streamed_output/-",value:c}]});await t.writer.write(u)}}finally{await t.writer.close()}}const o=a();try{for await(const l of t)yield l}finally{await o}}streamEvents(e,t,n){let s;if(t.version==="v1")s=this._streamEventsV1(e,t,n);else if(t.version==="v2")s=this._streamEventsV2(e,t,n);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?HB(s):In.fromAsyncGenerator(s)}async*_streamEventsV2(e,t,n){var p;const s=new Zz({...n,autoClose:!1}),i=We(t),a=i.runId??sn();i.runId=a;const o=i.callbacks;if(o===void 0)i.callbacks=[s];else if(Array.isArray(o))i.callbacks=o.concat(s);else{const m=o.copy();m.addHandler(s,!0),i.callbacks=m}const l=new AbortController,c=this;async function u(){try{let m;t!=null&&t.signal?"any"in AbortSignal?m=AbortSignal.any([l.signal,t.signal]):(m=t.signal,t.signal.addEventListener("abort",()=>{l.abort()},{once:!0})):m=l.signal;const g=await c.stream(e,{...i,signal:m}),b=s.tapOutputIterable(a,g);for await(const _ of b)if(l.signal.aborted)break}finally{await s.finish()}}const d=u();let h=!1,f;try{for await(const m of s){if(!h){m.data.input=e,h=!0,f=m.run_id,yield m;continue}m.run_id===f&&m.event.endsWith("_end")&&(p=m.data)!=null&&p.input&&delete m.data.input,yield m}}finally{l.abort(),await d}}async*_streamEventsV1(e,t,n){let s,i=!1;const a=We(t),o=a.tags??[],l=a.metadata??{},c=a.runName??this.getName(),u=new kx({...n,autoClose:!1,_schemaFormat:"streaming_events"}),d=new Xz({...n}),h=this._streamLog(e,u,a);for await(const p of h){if(s?s=s.concat(p):s=Ul.fromRunLogPatch(p),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!i){i=!0;const _={...s.state},y={run_id:_.id,event:`on_${_.type}_start`,name:c,tags:o,metadata:l,data:{input:e}};d.includeEvent(y,_.type)&&(yield y)}const m=p.ops.filter(_=>_.path.startsWith("/logs/")).map(_=>_.path.split("/")[2]),g=[...new Set(m)];for(const _ of g){let y,w={};const v=s.state.logs[_];if(v.end_time===void 0?v.streamed_output.length>0?y="stream":y="start":y="end",y==="start")v.inputs!==void 0&&(w.input=v.inputs);else if(y==="end")v.inputs!==void 0&&(w.input=v.inputs),w.output=v.final_output;else if(y==="stream"){const x=v.streamed_output.length;if(x!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${x} instead. Encountered in: "${v.name}"`);w={chunk:v.streamed_output[0]},v.streamed_output=[]}yield{event:`on_${v.type}_${y}`,name:v.name,run_id:v.id,tags:v.tags,metadata:v.metadata,data:w}}const{state:b}=s;if(b.streamed_output.length>0){const _=b.streamed_output.length;if(_!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${_} instead. Encountered in: "${b.name}"`);const y={chunk:b.streamed_output[0]};b.streamed_output=[];const w={event:`on_${b.type}_stream`,run_id:b.id,tags:o,metadata:l,name:c,data:y};d.includeEvent(w,b.type)&&(yield w)}}const f=s==null?void 0:s.state;if(f!==void 0){const p={event:`on_${f.type}_end`,name:c,run_id:f.id,tags:o,metadata:l,data:{output:f.final_output}};d.includeEvent(p,f.type)&&(yield p)}}static isRunnable(e){return B_(e)}withListeners({onStart:e,onEnd:t,onError:n}){return new pi({bound:this,config:{},configFactories:[s=>({callbacks:[new bA({config:s,onStart:e,onEnd:t,onError:n})]})]})}asTool(e){return KB(this,e)}}class pi extends Lt{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=wx(this.config,...e);return wx(t,...this.configFactories?await Promise.all(this.configFactories.map(async n=>await n(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(We(t),this.kwargs))}async batch(e,t,n){const s=Array.isArray(t)?await Promise.all(t.map(async i=>this._mergeConfig(We(i),this.kwargs))):await this._mergeConfig(We(t),this.kwargs);return this.bound.batch(e,s,n)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(We(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(We(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(We(t),this.kwargs))}streamEvents(e,t,n){const s=this,i=async function*(){yield*s.bound.streamEvents(e,{...await s._mergeConfig(We(t),s.kwargs),version:t.version},n)};return In.fromAsyncGenerator(i())}static isRunnableBinding(e){return e.bound&&Lt.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:n}){return new pi({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new bA({config:s,onStart:e,onEnd:t,onError:n})]})]})}}class Gd extends Lt{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new Gd({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,n){return this.bound.batch(e,Mt(t,{callbacks:n==null?void 0:n.getChild()}))}withListeners({onStart:e,onEnd:t,onError:n}){return new Gd({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:n})})}}class VB extends pi{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,n){const s=e>1?`retry:attempt:${e}`:void 0;return Mt(t,{callbacks:n==null?void 0:n.getChild(s)})}async _invoke(e,t,n){return zd(s=>super.invoke(e,this._patchConfigForRetry(s,t,n)),{onFailedAttempt:s=>this.onFailedAttempt(s,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,n,s){const i={};try{await zd(async a=>{const o=e.map((h,f)=>f).filter(h=>i[h.toString()]===void 0||i[h.toString()]instanceof Error),l=o.map(h=>e[h]),c=o.map(h=>this._patchConfigForRetry(a,t==null?void 0:t[h],n==null?void 0:n[h])),u=await super.batch(l,c,{...s,returnExceptions:!0});let d;for(let h=0;h<u.length;h+=1){const f=u[h],p=o[h];f instanceof Error&&d===void 0&&(d=f,d.input=l[h]),i[p.toString()]=f}if(d)throw d;return u},{onFailedAttempt:a=>this.onFailedAttempt(a,a.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(a){if((s==null?void 0:s.returnExceptions)!==!0)throw a}return Object.keys(i).sort((a,o)=>parseInt(a,10)-parseInt(o,10)).map(a=>i[parseInt(a,10)])}async batch(e,t,n){return this._batchWithConfig(this._batch.bind(this),e,t,n)}}class Qn extends Lt{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){var l;const n=We(t),s=await sr(n),i=await(s==null?void 0:s.handleChainStart(this.toJSON(),$t(e,"input"),n.runId,void 0,void 0,void 0,n==null?void 0:n.runName));delete n.runId;let a=e,o;try{const c=[this.first,...this.middle];for(let u=0;u<c.length;u+=1){const h=c[u].invoke(a,Mt(n,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${u+1}`)}));a=await Ls(h,t==null?void 0:t.signal)}if((l=t==null?void 0:t.signal)!=null&&l.aborted)throw new Error("Aborted");o=await this.last.invoke(a,Mt(n,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(c){throw await(i==null?void 0:i.handleChainError(c)),c}return await(i==null?void 0:i.handleChainEnd($t(o,"output"))),o}async batch(e,t,n){var l;const s=this._getOptionsList(t??{},e.length),i=await Promise.all(s.map(sr)),a=await Promise.all(i.map(async(c,u)=>{const d=await(c==null?void 0:c.handleChainStart(this.toJSON(),$t(e[u],"input"),s[u].runId,void 0,void 0,void 0,s[u].runName));return delete s[u].runId,d}));let o=e;try{for(let c=0;c<this.steps.length;c+=1){const d=this.steps[c].batch(o,a.map((h,f)=>{const p=h==null?void 0:h.getChild(this.omitSequenceTags?void 0:`seq:step:${c+1}`);return Mt(s[f],{callbacks:p})}),n);o=await Ls(d,(l=s[0])==null?void 0:l.signal)}}catch(c){throw await Promise.all(a.map(u=>u==null?void 0:u.handleChainError(c))),c}return await Promise.all(a.map(c=>c==null?void 0:c.handleChainEnd($t(o,"output")))),o}async*_streamIterator(e,t){var d;const n=await sr(t),{runId:s,...i}=t??{},a=await(n==null?void 0:n.handleChainStart(this.toJSON(),$t(e,"input"),s,void 0,void 0,void 0,i==null?void 0:i.runName)),o=[this.first,...this.middle,this.last];let l=!0,c;async function*u(){yield e}try{let h=o[0].transform(u(),Mt(i,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let f=1;f<o.length;f+=1)h=await o[f].transform(h,Mt(i,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:`seq:step:${f+1}`)}));for await(const f of h)if((d=t==null?void 0:t.signal)==null||d.throwIfAborted(),yield f,l)if(c===void 0)c=f;else try{c=ir(c,f)}catch{c=void 0,l=!1}}catch(h){throw await(a==null?void 0:a.handleChainError(h)),h}await(a==null?void 0:a.handleChainEnd($t(c,"output")))}getGraph(e){const t=new ef;let n=null;return this.steps.forEach((s,i)=>{const a=s.getGraph(e);i!==0&&a.trimFirstNode(),i!==this.steps.length-1&&a.trimLastNode(),t.extend(a);const o=a.firstNode();if(!o)throw new Error(`Runnable ${s} has no first node`);n&&t.addEdge(n,o),n=a.lastNode()}),t}pipe(e){return Qn.isRunnableSequence(e)?new Qn({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new Qn({first:this.first,middle:[...this.middle,this.last],last:ai(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&Lt.isRunnable(e)}static from([e,...t],n){let s={};return typeof n=="string"?s.name=n:n!==void 0&&(s=n),new Qn({...s,first:ai(e),middle:t.slice(0,-1).map(ai),last:ai(t[t.length-1])})}}class Ja extends Lt{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,n]of Object.entries(e.steps))this.steps[t]=ai(n)}static from(e){return new Ja({steps:e})}async invoke(e,t){const n=We(t),s=await sr(n),i=await(s==null?void 0:s.handleChainStart(this.toJSON(),{input:e},n.runId,void 0,void 0,void 0,n==null?void 0:n.runName));delete n.runId;const a={};try{const o=Object.entries(this.steps).map(async([l,c])=>{a[l]=await c.invoke(e,Mt(n,{callbacks:i==null?void 0:i.getChild(`map:key:${l}`)}))});await Ls(Promise.all(o),t==null?void 0:t.signal)}catch(o){throw await(i==null?void 0:i.handleChainError(o)),o}return await(i==null?void 0:i.handleChainEnd(a)),a}async*_transform(e,t,n){const s={...this.steps},i=gA(e,Object.keys(s).length),a=new Map(Object.entries(s).map(([o,l],c)=>{const u=l.transform(i[c],Mt(n,{callbacks:t==null?void 0:t.getChild(`map:key:${o}`)}));return[o,u.next().then(d=>({key:o,gen:u,result:d}))]}));for(;a.size;){const o=Promise.race(a.values()),{key:l,result:c,gen:u}=await Ls(o,n==null?void 0:n.signal);a.delete(l),c.done||(yield{[l]:c.value},a.set(l,u.next().then(d=>({key:l,gen:u,result:d}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=We(t),i=new Za({generator:this.transform(n(),s),config:s});return await i.setup,In.fromAsyncGenerator(i)}}class U_ extends Lt{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!j_(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){const[n]=this._getOptionsList(t??{},1),s=await sr(n),i=this.func(Mt(n,{callbacks:s}),e);return Ls(i,n==null?void 0:n.signal)}async*_streamIterator(e,t){var i,a;const[n]=this._getOptionsList(t??{},1),s=await this.invoke(e,t);if(eb(s)){for await(const o of s)(i=n==null?void 0:n.signal)==null||i.throwIfAborted(),yield o;return}if(WB(s)){for(;;){(a=n==null?void 0:n.signal)==null||a.throwIfAborted();const o=s.next();if(o.done)break;yield o.value}return}yield s}static from(e){return new U_({func:e})}}function GB(r){if(j_(r))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}class Ri extends Lt{static lc_name(){return"RunnableLambda"}constructor(e){if(j_(e.func))return U_.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),GB(e.func),this.func=e.func}static from(e){return new Ri({func:e})}async _invoke(e,t,n){return new Promise((s,i)=>{const a=Mt(t,{callbacks:n==null?void 0:n.getChild(),recursionLimit:((t==null?void 0:t.recursionLimit)??_m)-1});Rr.runWithConfig(Ns(a),async()=>{var o,l;try{let c=await this.func(e,{...a});if(c&&Lt.isRunnable(c)){if((t==null?void 0:t.recursionLimit)===0)throw new Error("Recursion limit reached.");c=await c.invoke(e,{...a,recursionLimit:(a.recursionLimit??_m)-1})}else if(eb(c)){let u;for await(const d of tb(a,c))if((o=t==null?void 0:t.signal)==null||o.throwIfAborted(),u===void 0)u=d;else try{u=ir(u,d)}catch{u=d}c=u}else if(Tx(c)){let u;for(const d of Rx(a,c))if((l=t==null?void 0:t.signal)==null||l.throwIfAborted(),u===void 0)u=d;else try{u=ir(u,d)}catch{u=d}c=u}s(c)}catch(c){i(c)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async*_transform(e,t,n){var o,l;let s;for await(const c of e)if(s===void 0)s=c;else try{s=ir(s,c)}catch{s=c}const i=Mt(n,{callbacks:t==null?void 0:t.getChild(),recursionLimit:((n==null?void 0:n.recursionLimit)??_m)-1}),a=await new Promise((c,u)=>{Rr.runWithConfig(Ns(i),async()=>{try{const d=await this.func(s,{...i,config:i});c(d)}catch(d){u(d)}})});if(a&&Lt.isRunnable(a)){if((n==null?void 0:n.recursionLimit)===0)throw new Error("Recursion limit reached.");const c=await a.stream(s,i);for await(const u of c)yield u}else if(eb(a))for await(const c of tb(i,a))(o=n==null?void 0:n.signal)==null||o.throwIfAborted(),yield c;else if(Tx(a))for(const c of Rx(i,a))(l=n==null?void 0:n.signal)==null||l.throwIfAborted(),yield c;else yield a}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=We(t),i=new Za({generator:this.transform(n(),s),config:s});return await i.setup,In.fromAsyncGenerator(i)}}class ZB extends Lt{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const n=We(t),s=await sr(n),{runId:i,...a}=n,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),$t(e,"input"),i,void 0,void 0,void 0,a==null?void 0:a.runName)),l=Mt(a,{callbacks:o==null?void 0:o.getChild()});return await Rr.runWithConfig(l,async()=>{var d;let u;for(const h of this.runnables()){(d=n==null?void 0:n.signal)==null||d.throwIfAborted();try{const f=await h.invoke(e,l);return await(o==null?void 0:o.handleChainEnd($t(f,"output"))),f}catch(f){u===void 0&&(u=f)}}throw u===void 0?new Error("No error stored at end of fallback."):(await(o==null?void 0:o.handleChainError(u)),u)})}async*_streamIterator(e,t){var d;const n=We(t),s=await sr(n),{runId:i,...a}=n,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),$t(e,"input"),i,void 0,void 0,void 0,a==null?void 0:a.runName));let l,c;for(const h of this.runnables()){(d=n==null?void 0:n.signal)==null||d.throwIfAborted();const f=Mt(a,{callbacks:o==null?void 0:o.getChild()});try{const p=await h.stream(e,f);c=tb(f,p);break}catch(p){l===void 0&&(l=p)}}if(c===void 0){const h=l??new Error("No error stored at end of fallback.");throw await(o==null?void 0:o.handleChainError(h)),h}let u;try{for await(const h of c){yield h;try{u=u===void 0?u:ir(u,h)}catch{u=void 0}}}catch(h){throw await(o==null?void 0:o.handleChainError(h)),h}await(o==null?void 0:o.handleChainEnd($t(u,"output")))}async batch(e,t,n){var l;if(n!=null&&n.returnExceptions)throw new Error("Not implemented.");const s=this._getOptionsList(t??{},e.length),i=await Promise.all(s.map(c=>sr(c))),a=await Promise.all(i.map(async(c,u)=>{const d=await(c==null?void 0:c.handleChainStart(this.toJSON(),$t(e[u],"input"),s[u].runId,void 0,void 0,void 0,s[u].runName));return delete s[u].runId,d}));let o;for(const c of this.runnables()){(l=s[0].signal)==null||l.throwIfAborted();try{const u=await c.batch(e,a.map((d,h)=>Mt(s[h],{callbacks:d==null?void 0:d.getChild()})),n);return await Promise.all(a.map((d,h)=>d==null?void 0:d.handleChainEnd($t(u[h],"output")))),u}catch(u){o===void 0&&(o=u)}}throw o?(await Promise.all(a.map(c=>c==null?void 0:c.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function ai(r){if(typeof r=="function")return new Ri({func:r});if(Lt.isRunnable(r))return r;if(!Array.isArray(r)&&typeof r=="object"){const e={};for(const[t,n]of Object.entries(r))e[t]=ai(n);return new Ja({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class kA extends Lt{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof Ja&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const n=await this.mapper.invoke(e,t);return{...e,...n}}async*_transform(e,t,n){const s=this.mapper.getStepsKeys(),[i,a]=gA(e),o=this.mapper.transform(a,Mt(n,{callbacks:t==null?void 0:t.getChild()})),l=o.next();for await(const c of i){if(typeof c!="object"||Array.isArray(c))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof c}`);const u=Object.fromEntries(Object.entries(c).filter(([d])=>!s.includes(d)));Object.keys(u).length>0&&(yield u)}yield(await l).value;for await(const c of o)yield c}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=We(t),i=new Za({generator:this.transform(n(),s),config:s});return await i.setup,In.fromAsyncGenerator(i)}}class JB extends Lt{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const t=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const n=await this._pick(t);n!==void 0&&(yield n)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=We(t),i=new Za({generator:this.transform(n(),s),config:s});return await i.setup,In.fromAsyncGenerator(i)}}class Ix extends pi{constructor(e){const t=Qn.from([Ri.from(async n=>{let s;if(T_(n))try{s=await this.schema.parseAsync(n.args)}catch{throw new Ug("Received tool input did not match expected schema",JSON.stringify(n.args))}else s=n;return s}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}function KB(r,e){var s;const t=e.name??r.getName(),n=e.description??((s=e.schema)==null?void 0:s.description);return e.schema.constructor===He.ZodString?new Ix({name:t,description:n,schema:He.object({input:He.string()}).transform(i=>i.input),bound:r}):new Ix({name:t,description:n,schema:e.schema,bound:r})}/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var XB=typeof window=="object"?window:{},Oe="0123456789abcdef".split(""),YB=[-2147483648,8388608,32768,128],qn=[24,16,8,0],It=[];function cr(r){r?(It[0]=It[16]=It[1]=It[2]=It[3]=It[4]=It[5]=It[6]=It[7]=It[8]=It[9]=It[10]=It[11]=It[12]=It[13]=It[14]=It[15]=0,this.blocks=It):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}cr.prototype.update=function(r){if(!this.finalized){var e=typeof r!="string";e&&r.constructor===XB.ArrayBuffer&&(r=new Uint8Array(r));for(var t,n=0,s,i=r.length||0,a=this.blocks;n<i;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),e)for(s=this.start;n<i&&s<64;++n)a[s>>2]|=r[n]<<qn[s++&3];else for(s=this.start;n<i&&s<64;++n)t=r.charCodeAt(n),t<128?a[s>>2]|=t<<qn[s++&3]:t<2048?(a[s>>2]|=(192|t>>6)<<qn[s++&3],a[s>>2]|=(128|t&63)<<qn[s++&3]):t<55296||t>=57344?(a[s>>2]|=(224|t>>12)<<qn[s++&3],a[s>>2]|=(128|t>>6&63)<<qn[s++&3],a[s>>2]|=(128|t&63)<<qn[s++&3]):(t=65536+((t&1023)<<10|r.charCodeAt(++n)&1023),a[s>>2]|=(240|t>>18)<<qn[s++&3],a[s>>2]|=(128|t>>12&63)<<qn[s++&3],a[s>>2]|=(128|t>>6&63)<<qn[s++&3],a[s>>2]|=(128|t&63)<<qn[s++&3]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=a[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};cr.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var r=this.blocks,e=this.lastByteIndex;r[16]=this.block,r[e>>2]|=YB[e&3],this.block=r[16],e>=56&&(this.hashed||this.hash(),r[0]=this.block,r[16]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=r[9]=r[10]=r[11]=r[12]=r[13]=r[14]=r[15]=0),r[14]=this.hBytes<<3|this.bytes>>>29,r[15]=this.bytes<<3,this.hash()}};cr.prototype.hash=function(){var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4,i,a,o,l=this.blocks;for(a=16;a<80;++a)o=l[a-3]^l[a-8]^l[a-14]^l[a-16],l[a]=o<<1|o>>>31;for(a=0;a<20;a+=5)i=e&t|~e&n,o=r<<5|r>>>27,s=o+i+s+1518500249+l[a]<<0,e=e<<30|e>>>2,i=r&e|~r&t,o=s<<5|s>>>27,n=o+i+n+1518500249+l[a+1]<<0,r=r<<30|r>>>2,i=s&r|~s&e,o=n<<5|n>>>27,t=o+i+t+1518500249+l[a+2]<<0,s=s<<30|s>>>2,i=n&s|~n&r,o=t<<5|t>>>27,e=o+i+e+1518500249+l[a+3]<<0,n=n<<30|n>>>2,i=t&n|~t&s,o=e<<5|e>>>27,r=o+i+r+1518500249+l[a+4]<<0,t=t<<30|t>>>2;for(;a<40;a+=5)i=e^t^n,o=r<<5|r>>>27,s=o+i+s+1859775393+l[a]<<0,e=e<<30|e>>>2,i=r^e^t,o=s<<5|s>>>27,n=o+i+n+1859775393+l[a+1]<<0,r=r<<30|r>>>2,i=s^r^e,o=n<<5|n>>>27,t=o+i+t+1859775393+l[a+2]<<0,s=s<<30|s>>>2,i=n^s^r,o=t<<5|t>>>27,e=o+i+e+1859775393+l[a+3]<<0,n=n<<30|n>>>2,i=t^n^s,o=e<<5|e>>>27,r=o+i+r+1859775393+l[a+4]<<0,t=t<<30|t>>>2;for(;a<60;a+=5)i=e&t|e&n|t&n,o=r<<5|r>>>27,s=o+i+s-1894007588+l[a]<<0,e=e<<30|e>>>2,i=r&e|r&t|e&t,o=s<<5|s>>>27,n=o+i+n-1894007588+l[a+1]<<0,r=r<<30|r>>>2,i=s&r|s&e|r&e,o=n<<5|n>>>27,t=o+i+t-1894007588+l[a+2]<<0,s=s<<30|s>>>2,i=n&s|n&r|s&r,o=t<<5|t>>>27,e=o+i+e-1894007588+l[a+3]<<0,n=n<<30|n>>>2,i=t&n|t&s|n&s,o=e<<5|e>>>27,r=o+i+r-1894007588+l[a+4]<<0,t=t<<30|t>>>2;for(;a<80;a+=5)i=e^t^n,o=r<<5|r>>>27,s=o+i+s-899497514+l[a]<<0,e=e<<30|e>>>2,i=r^e^t,o=s<<5|s>>>27,n=o+i+n-899497514+l[a+1]<<0,r=r<<30|r>>>2,i=s^r^e,o=n<<5|n>>>27,t=o+i+t-899497514+l[a+2]<<0,s=s<<30|s>>>2,i=n^s^r,o=t<<5|t>>>27,e=o+i+e-899497514+l[a+3]<<0,n=n<<30|n>>>2,i=t^n^s,o=e<<5|e>>>27,r=o+i+r-899497514+l[a+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+r<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+n<<0,this.h4=this.h4+s<<0};cr.prototype.hex=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4;return Oe[r>>28&15]+Oe[r>>24&15]+Oe[r>>20&15]+Oe[r>>16&15]+Oe[r>>12&15]+Oe[r>>8&15]+Oe[r>>4&15]+Oe[r&15]+Oe[e>>28&15]+Oe[e>>24&15]+Oe[e>>20&15]+Oe[e>>16&15]+Oe[e>>12&15]+Oe[e>>8&15]+Oe[e>>4&15]+Oe[e&15]+Oe[t>>28&15]+Oe[t>>24&15]+Oe[t>>20&15]+Oe[t>>16&15]+Oe[t>>12&15]+Oe[t>>8&15]+Oe[t>>4&15]+Oe[t&15]+Oe[n>>28&15]+Oe[n>>24&15]+Oe[n>>20&15]+Oe[n>>16&15]+Oe[n>>12&15]+Oe[n>>8&15]+Oe[n>>4&15]+Oe[n&15]+Oe[s>>28&15]+Oe[s>>24&15]+Oe[s>>20&15]+Oe[s>>16&15]+Oe[s>>12&15]+Oe[s>>8&15]+Oe[s>>4&15]+Oe[s&15]};cr.prototype.toString=cr.prototype.hex;cr.prototype.digest=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4;return[r>>24&255,r>>16&255,r>>8&255,r&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,n>>24&255,n>>16&255,n>>8&255,n&255,s>>24&255,s>>16&255,s>>8&255,s&255]};cr.prototype.array=cr.prototype.digest;cr.prototype.arrayBuffer=function(){this.finalize();var r=new ArrayBuffer(20),e=new DataView(r);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),r};const QB=r=>new cr(!0).update(r).hex(),Cx=(...r)=>QB(r.join("_"));class e4{}const t4=new Map;class q_ extends e4{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(Cx(e,t))??null)}async update(e,t,n){this.cache.set(Cx(e,t),n)}static global(){return new q_(t4)}}class SA extends bi{}class n4 extends SA{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new _i(this.value)]}}class r4 extends SA{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return WP(this.messages)}toChatMessages(){return this.messages}}var go={},$x;function s4(){if($x)return go;$x=1,go.byteLength=o,go.toByteArray=c,go.fromByteArray=h;for(var r=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,i=n.length;s<i;++s)r[s]=n[s],e[n.charCodeAt(s)]=s;e[45]=62,e[95]=63;function a(f){var p=f.length;if(p%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var m=f.indexOf("=");m===-1&&(m=p);var g=m===p?0:4-m%4;return[m,g]}function o(f){var p=a(f),m=p[0],g=p[1];return(m+g)*3/4-g}function l(f,p,m){return(p+m)*3/4-m}function c(f){var p,m=a(f),g=m[0],b=m[1],_=new t(l(f,g,b)),y=0,w=b>0?g-4:g,v;for(v=0;v<w;v+=4)p=e[f.charCodeAt(v)]<<18|e[f.charCodeAt(v+1)]<<12|e[f.charCodeAt(v+2)]<<6|e[f.charCodeAt(v+3)],_[y++]=p>>16&255,_[y++]=p>>8&255,_[y++]=p&255;return b===2&&(p=e[f.charCodeAt(v)]<<2|e[f.charCodeAt(v+1)]>>4,_[y++]=p&255),b===1&&(p=e[f.charCodeAt(v)]<<10|e[f.charCodeAt(v+1)]<<4|e[f.charCodeAt(v+2)]>>2,_[y++]=p>>8&255,_[y++]=p&255),_}function u(f){return r[f>>18&63]+r[f>>12&63]+r[f>>6&63]+r[f&63]}function d(f,p,m){for(var g,b=[],_=p;_<m;_+=3)g=(f[_]<<16&16711680)+(f[_+1]<<8&65280)+(f[_+2]&255),b.push(u(g));return b.join("")}function h(f){for(var p,m=f.length,g=m%3,b=[],_=16383,y=0,w=m-g;y<w;y+=_)b.push(d(f,y,y+_>w?w:y+_));return g===1?(p=f[m-1],b.push(r[p>>2]+r[p<<4&63]+"==")):g===2&&(p=(f[m-2]<<8)+f[m-1],b.push(r[p>>10]+r[p>>4&63]+r[p<<2&63]+"=")),b.join("")}return go}var i4=s4();const a4=Pi(i4);var o4=Object.defineProperty,l4=(r,e,t)=>e in r?o4(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,c4=(r,e,t)=>(l4(r,e+"",t),t);function u4(r,e){let t=Array.from({length:r.length},(n,s)=>({start:s,end:s+1}));for(;t.length>1;){let n=null;for(let s=0;s<t.length-1;s++){const i=r.slice(t[s].start,t[s+1].end),a=e.get(i.join(","));a!=null&&(n==null||a<n[0])&&(n=[a,s])}if(n!=null){const s=n[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function d4(r,e){return r.length===1?[e.get(r.join(","))]:u4(r,e).map(t=>e.get(r.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function h4(r){return r.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var nb=class{constructor(r,e){M(this,"specialTokens");M(this,"inverseSpecialTokens");M(this,"patStr");M(this,"textEncoder",new TextEncoder);M(this,"textDecoder",new TextDecoder("utf-8"));M(this,"rankMap",new Map);M(this,"textMap",new Map);this.patStr=r.pat_str;const t=r.bpe_ranks.split(`
`).filter(Boolean).reduce((n,s)=>{const[i,a,...o]=s.split(" "),l=Number.parseInt(a,10);return o.forEach((c,u)=>n[c]=l+u),n},{});for(const[n,s]of Object.entries(t)){const i=a4.toByteArray(n);this.rankMap.set(i.join(","),s),this.textMap.set(s,i)}this.specialTokens={...r.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[s,i])=>(n[i]=this.textEncoder.encode(s),n),{})}encode(r,e=[],t="all"){const n=new RegExp(this.patStr,"ug"),s=nb.specialTokenRegex(Object.keys(this.specialTokens)),i=[],a=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(c=>!a.has(c)):t);if(o.size>0){const c=nb.specialTokenRegex([...o]),u=r.match(c);if(u!=null)throw new Error(`The text contains a special token that is not allowed: ${u[0]}`)}let l=0;for(;;){let c=null,u=l;for(;s.lastIndex=u,c=s.exec(r),!(c==null||a.has(c[0]));)u=c.index+1;const d=(c==null?void 0:c.index)??r.length;for(const f of r.substring(l,d).matchAll(n)){const p=this.textEncoder.encode(f[0]),m=this.rankMap.get(p.join(","));if(m!=null){i.push(m);continue}i.push(...d4(p,this.rankMap))}if(c==null)break;let h=this.specialTokens[c[0]];i.push(h),l=c.index+c[0].length}return i}decode(r){const e=[];let t=0;for(let i=0;i<r.length;++i){const a=r[i],o=this.textMap.get(a)??this.inverseSpecialTokens[a];o!=null&&(e.push(o),t+=o.length)}const n=new Uint8Array(t);let s=0;for(const i of e)n.set(i,s),s+=i.length;return this.textDecoder.decode(n)}},PA=nb;c4(PA,"specialTokenRegex",r=>new RegExp(r.map(e=>h4(e)).join("|"),"g"));function f4(r){switch(r){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-preview":case"o1-preview-2024-09-12":case"o1-mini-2024-09-12":case"o3-mini":case"o3-mini-2025-01-31":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":return"o200k_base";default:throw new Error("Unknown model")}}const Pu={},p4=new z_({});async function m4(r){return r in Pu||(Pu[r]=p4.fetch(`https://tiktoken.pages.dev/js/${r}.json`).then(e=>e.json()).then(e=>new PA(e)).catch(e=>{throw delete Pu[r],e})),await Pu[r]}async function g4(r){return m4(f4(r))}const b4=r=>r.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":r.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":r.startsWith("gpt-4-32k")?"gpt-4-32k":r.startsWith("gpt-4-")?"gpt-4":r.startsWith("gpt-4o")?"gpt-4o":r;function Cc(r){return typeof r!="object"||!r?!1:!!("type"in r&&r.type==="function"&&"function"in r&&typeof r.function=="object"&&r.function&&"name"in r.function&&"parameters"in r.function)}const _4=()=>!1;class AA extends Lt{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??_4(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class y4 extends AA{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...n}){const{cache:s,...i}=n;super({callbacks:e??t,...i}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof s=="object"?this.cache=s:s?this.cache=q_.global():this.cache=void 0,this.caller=new z_(n??{})}async getNumTokens(e){if(typeof e!="string")return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await g4("modelName"in this?b4(this.modelName):"gpt2")}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}return t}static _convertInputToPromptValue(e){return typeof e=="string"?new n4(e):Array.isArray(e)?new r4(e.map(Wo)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const n={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(n).filter(([a,o])=>o!==void 0).map(([a,o])=>`${a}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}class Ds extends Lt{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){const n=We(t);return this.func&&await this.func(e,n),this._callWithConfig(s=>Promise.resolve(s),e,n)}async*transform(e,t){const n=We(t);let s,i=!0;for await(const a of this._transformStreamWithConfig(e,o=>o,n))if(yield a,i)if(s===void 0)s=a;else try{s=ir(s,a)}catch{s=void 0,i=!1}this.func&&s!==void 0&&await this.func(s,n)}static assign(e){return new kA(new Ja({steps:e}))}}function ki(r){var n;if(!r||typeof r!="object"||Array.isArray(r))return!1;const e=r;return e._def||Object.values(He.ZodFirstPartyTypeKind).includes(((n=e.constructor)==null?void 0:n.name)??"NOT_INCLUDED")?!0:typeof e.parse=="function"&&typeof e.parseAsync=="function"&&typeof e.safeParse=="function"&&typeof e.safeParseAsync=="function"}class xr extends y4{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]}),Object.defineProperty(this,"disableStreaming",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_separateRunnableConfigFromCallOptionsCompat(e){const[t,n]=super._separateRunnableConfigFromCallOptions(e);return n.signal=t.signal,[t,n]}async invoke(e,t){const n=xr._convertInputToPromptValue(e);return(await this.generatePrompt([n],t,t==null?void 0:t.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,n){throw new Error("Not implemented.")}async*_streamIterator(e,t){var n;if(this._streamResponseChunks===xr.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(e,t);else{const i=xr._convertInputToPromptValue(e).toChatMessages(),[a,o]=this._separateRunnableConfigFromCallOptionsCompat(t),l={...a.metadata,...this.getLsParams(o)},c=await an.configure(a.callbacks,this.callbacks,a.tags,this.tags,l,this.metadata,{verbose:this.verbose}),u={options:o,invocation_params:this==null?void 0:this.invocationParams(o),batch_size:1},d=await(c==null?void 0:c.handleChatModelStart(this.toJSON(),[i],a.runId,void 0,u,void 0,void 0,a.runName));let h,f;try{for await(const p of this._streamResponseChunks(i,o,d==null?void 0:d[0])){if(p.message.id==null){const m=(n=d==null?void 0:d.at(0))==null?void 0:n.runId;m!=null&&p.message._updateId(`run-${m}`)}p.message.response_metadata={...p.generationInfo,...p.message.response_metadata},yield p.message,h?h=h.concat(p):h=p,Qv(p.message)&&p.message.usage_metadata!==void 0&&(f={tokenUsage:{promptTokens:p.message.usage_metadata.input_tokens,completionTokens:p.message.usage_metadata.output_tokens,totalTokens:p.message.usage_metadata.total_tokens}})}}catch(p){throw await Promise.all((d??[]).map(m=>m==null?void 0:m.handleLLMError(p))),p}await Promise.all((d??[]).map(p=>p==null?void 0:p.handleLLMEnd({generations:[[h]],llmOutput:f})))}}getLsParams(e){const t=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:t}}async _generateUncached(e,t,n,s){var d,h;const i=e.map(f=>f.map(Wo));let a;if(s!==void 0&&s.length===i.length)a=s;else{const f={...n.metadata,...this.getLsParams(t)},p=await an.configure(n.callbacks,this.callbacks,n.tags,this.tags,f,this.metadata,{verbose:this.verbose}),m={options:t,invocation_params:this==null?void 0:this.invocationParams(t),batch_size:1};a=await(p==null?void 0:p.handleChatModelStart(this.toJSON(),i,n.runId,void 0,m,void 0,void 0,n.runName))}const o=[],l=[];if(!!(a!=null&&a[0].handlers.find(kz))&&!this.disableStreaming&&i.length===1&&this._streamResponseChunks!==xr.prototype._streamResponseChunks)try{const f=await this._streamResponseChunks(i[0],t,a==null?void 0:a[0]);let p,m;for await(const g of f){if(g.message.id==null){const b=(d=a==null?void 0:a.at(0))==null?void 0:d.runId;b!=null&&g.message._updateId(`run-${b}`)}p===void 0?p=g:p=ir(p,g),Qv(g.message)&&g.message.usage_metadata!==void 0&&(m={tokenUsage:{promptTokens:g.message.usage_metadata.input_tokens,completionTokens:g.message.usage_metadata.output_tokens,totalTokens:g.message.usage_metadata.total_tokens}})}if(p===void 0)throw new Error("Received empty response from chat model call.");o.push([p]),await(a==null?void 0:a[0].handleLLMEnd({generations:o,llmOutput:m}))}catch(f){throw await(a==null?void 0:a[0].handleLLMError(f)),f}else{const f=await Promise.allSettled(i.map((p,m)=>this._generate(p,{...t,promptIndex:m},a==null?void 0:a[m])));await Promise.all(f.map(async(p,m)=>{var g,b,_;if(p.status==="fulfilled"){const y=p.value;for(const w of y.generations){if(w.message.id==null){const v=(g=a==null?void 0:a.at(0))==null?void 0:g.runId;v!=null&&w.message._updateId(`run-${v}`)}w.message.response_metadata={...w.generationInfo,...w.message.response_metadata}}return y.generations.length===1&&(y.generations[0].message.response_metadata={...y.llmOutput,...y.generations[0].message.response_metadata}),o[m]=y.generations,l[m]=y.llmOutput,(b=a==null?void 0:a[m])==null?void 0:b.handleLLMEnd({generations:[y.generations],llmOutput:y.llmOutput})}else return await((_=a==null?void 0:a[m])==null?void 0:_.handleLLMError(p.reason)),Promise.reject(p.reason)}))}const u={generations:o,llmOutput:l.length?(h=this._combineLLMOutput)==null?void 0:h.call(this,...l):void 0};return Object.defineProperty(u,Sx,{value:a?{runIds:a==null?void 0:a.map(f=>f.runId)}:void 0,configurable:!0}),u}async _generateCached({messages:e,cache:t,llmStringKey:n,parsedOptions:s,handledOptions:i}){const a=e.map(g=>g.map(Wo)),o={...i.metadata,...this.getLsParams(s)},l=await an.configure(i.callbacks,this.callbacks,i.tags,this.tags,o,this.metadata,{verbose:this.verbose}),c={options:s,invocation_params:this==null?void 0:this.invocationParams(s),batch_size:1},u=await(l==null?void 0:l.handleChatModelStart(this.toJSON(),a,i.runId,void 0,c,void 0,void 0,i.runName)),d=[],f=(await Promise.allSettled(a.map(async(g,b)=>{const _=xr._convertInputToPromptValue(g).toString(),y=await t.lookup(_,n);return y==null&&d.push(b),y}))).map((g,b)=>({result:g,runManager:u==null?void 0:u[b]})).filter(({result:g})=>g.status==="fulfilled"&&g.value!=null||g.status==="rejected"),p=[];await Promise.all(f.map(async({result:g,runManager:b},_)=>{if(g.status==="fulfilled"){const y=g.value;return p[_]=y.map(w=>("message"in w&&Wh(w.message)&&rs(w.message)&&(w.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0}),w.generationInfo={...w.generationInfo,tokenUsage:{}},w)),y.length&&await(b==null?void 0:b.handleLLMNewToken(y[0].text)),b==null?void 0:b.handleLLMEnd({generations:[y]},void 0,void 0,void 0,{cached:!0})}else return await(b==null?void 0:b.handleLLMError(g.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(g.reason)}));const m={generations:p,missingPromptIndices:d,startedRunManagers:u};return Object.defineProperty(m,Sx,{value:u?{runIds:u==null?void 0:u.map(g=>g.runId)}:void 0,configurable:!0}),m}async generate(e,t,n){let s;Array.isArray(t)?s={stop:t}:s=t;const i=e.map(p=>p.map(Wo)),[a,o]=this._separateRunnableConfigFromCallOptionsCompat(s);if(a.callbacks=a.callbacks??n,!this.cache)return this._generateUncached(i,o,a);const{cache:l}=this,c=this._getSerializedCacheKeyParametersForCall(o),{generations:u,missingPromptIndices:d,startedRunManagers:h}=await this._generateCached({messages:i,cache:l,llmStringKey:c,parsedOptions:o,handledOptions:a});let f={};if(d.length>0){const p=await this._generateUncached(d.map(m=>i[m]),o,a,h!==void 0?d.map(m=>h==null?void 0:h[m]):void 0);await Promise.all(p.generations.map(async(m,g)=>{const b=d[g];u[b]=m;const _=xr._convertInputToPromptValue(i[b]).toString();return l.update(_,c,m)})),f=p.llmOutput??{}}return{generations:u,llmOutput:f}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,n){const s=e.map(i=>i.toChatMessages());return this.generate(s,t,n)}async call(e,t,n){return(await this.generate([e.map(Wo)],t,n)).generations[0][0].message}async callPrompt(e,t,n){const s=e.toChatMessages();return this.call(s,t,n)}async predictMessages(e,t,n){return this.call(e,t,n)}async predict(e,t,n){const s=new _i(e),i=await this.call([s],t,n);if(typeof i.content!="string")throw new Error("Cannot use predict when output is not a string.");return i.content}withStructuredOutput(e,t){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(t!=null&&t.strict)throw new Error('"strict" mode is not supported for this model by default.');const n=e,s=t==null?void 0:t.name,i=n.description??"A function available to call.",a=t==null?void 0:t.method,o=t==null?void 0:t.includeRaw;if(a==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let l=s??"extract",c;ki(n)?c=[{type:"function",function:{name:l,description:i,parameters:js(n)}}]:("name"in n&&(l=n.name),c=[{type:"function",function:{name:l,description:i,parameters:n}}]);const u=this.bindTools(c),d=Ri.from(m=>{if(!m.tool_calls||m.tool_calls.length===0)throw new Error("No tool calls found in the response.");const g=m.tool_calls.find(b=>b.name===l);if(!g)throw new Error(`No tool call found with name ${l}.`);return g.args});if(!o)return u.pipe(d).withConfig({runName:"StructuredOutput"});const h=Ds.assign({parsed:(m,g)=>d.invoke(m.raw,g)}),f=Ds.assign({parsed:()=>null}),p=h.withFallbacks({fallbacks:[f]});return Qn.from([{raw:u},p]).withConfig({runName:"StructuredOutputRunnable"})}}class EA extends Lt{parseResultWithPrompt(e,t,n){return this.parseResult(e,n)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(n,s)=>this.parseResult([{text:n}],s==null?void 0:s.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(n,s)=>this.parseResult([{message:n,text:this._baseMessageToString(n)}],s==null?void 0:s.callbacks),e,{...t,runType:"parser"})}}class OA extends EA{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,n){return this.parse(e,n)}_type(){throw new Error("_type not implemented")}}class ql extends Error{constructor(e,t,n,s=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=n,this.sendToLLM=s,s&&(n===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");HP(this,"OUTPUT_PARSING_FAILURE")}}function pa(r,e){const t=typeof r;if(t!==typeof e)return!1;if(Array.isArray(r)){if(!Array.isArray(e))return!1;const n=r.length;if(n!==e.length)return!1;for(let s=0;s<n;s++)if(!pa(r[s],e[s]))return!1;return!0}if(t==="object"){if(!r||!e)return r===e;const n=Object.keys(r),s=Object.keys(e);if(n.length!==s.length)return!1;for(const a of n)if(!pa(r[a],e[a]))return!1;return!0}return r===e}function Gn(r){return encodeURI(w4(r))}function w4(r){return r.replace(/~/g,"~0").replace(/\//g,"~1")}const v4={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},x4={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},k4={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};let S4=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function sa(r,e=Object.create(null),t=S4,n=""){if(r&&typeof r=="object"&&!Array.isArray(r)){const i=r.$id||r.id;if(i){const a=new URL(i,t.href);a.hash.length>1?e[a.href]=r:(a.hash="",n===""?t=a:sa(r,e,t))}}else if(r!==!0&&r!==!1)return e;const s=t.href+(n?"#"+n:"");if(e[s]!==void 0)throw new Error(`Duplicate schema URI "${s}".`);if(e[s]=r,r===!0||r===!1)return e;if(r.__absolute_uri__===void 0&&Object.defineProperty(r,"__absolute_uri__",{enumerable:!1,value:s}),r.$ref&&r.__absolute_ref__===void 0){const i=new URL(r.$ref,t.href);i.hash=i.hash,Object.defineProperty(r,"__absolute_ref__",{enumerable:!1,value:i.href})}if(r.$recursiveRef&&r.__absolute_recursive_ref__===void 0){const i=new URL(r.$recursiveRef,t.href);i.hash=i.hash,Object.defineProperty(r,"__absolute_recursive_ref__",{enumerable:!1,value:i.href})}if(r.$anchor){const i=new URL("#"+r.$anchor,t.href);e[i.href]=r}for(let i in r){if(k4[i])continue;const a=`${n}/${Gn(i)}`,o=r[i];if(Array.isArray(o)){if(v4[i]){const l=o.length;for(let c=0;c<l;c++)sa(o[c],e,t,`${a}/${c}`)}}else if(x4[i])for(let l in o)sa(o[l],e,t,`${a}/${Gn(l)}`);else sa(o,e,t,a)}return e}const P4=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,A4=[0,31,28,31,30,31,30,31,31,30,31,30,31],E4=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,O4=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,T4=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,R4=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,I4=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,C4=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,$4=/^(?:\/(?:[^~/]|~0|~1)*)*$/,M4=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,N4=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,L4=r=>{if(r[0]==='"')return!1;const[e,t,...n]=r.split("@");return!e||!t||n.length!==0||e.length>64||t.length>253||e[0]==="."||e.endsWith(".")||e.includes("..")||!/^[a-z0-9.-]+$/i.test(t)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(e)?!1:t.split(".").every(s=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(s))},j4=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,D4=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,F4=r=>r.length>1&&r.length<80&&(/^P\d+([.,]\d+)?W$/.test(r)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(r)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(r));function pr(r){return r.test.bind(r)}const Mx={date:TA,time:RA.bind(void 0,!1),"date-time":U4,duration:F4,uri:W4,"uri-reference":pr(T4),"uri-template":pr(R4),url:pr(I4),email:L4,hostname:pr(O4),ipv4:pr(j4),ipv6:pr(D4),regex:G4,uuid:pr(C4),"json-pointer":pr($4),"json-pointer-uri-fragment":pr(M4),"relative-json-pointer":pr(N4)};function z4(r){return r%4===0&&(r%100!==0||r%400===0)}function TA(r){const e=r.match(P4);if(!e)return!1;const t=+e[1],n=+e[2],s=+e[3];return n>=1&&n<=12&&s>=1&&s<=(n==2&&z4(t)?29:A4[n])}function RA(r,e){const t=e.match(E4);if(!t)return!1;const n=+t[1],s=+t[2],i=+t[3],a=!!t[5];return(n<=23&&s<=59&&i<=59||n==23&&s==59&&i==60)&&(!r||a)}const B4=/t|\s/i;function U4(r){const e=r.split(B4);return e.length==2&&TA(e[0])&&RA(!0,e[1])}const q4=/\/|:/,H4=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function W4(r){return q4.test(r)&&H4.test(r)}const V4=/[^\\]\\Z/;function G4(r){if(V4.test(r))return!1;try{return new RegExp(r,"u"),!0}catch{return!1}}function Z4(r){let e=0,t=r.length,n=0,s;for(;n<t;)e++,s=r.charCodeAt(n++),s>=55296&&s<=56319&&n<t&&(s=r.charCodeAt(n),(s&64512)==56320&&n++);return e}function ft(r,e,t="2019-09",n=sa(e),s=!0,i=null,a="#",o="#",l=Object.create(null)){if(e===!0)return{valid:!0,errors:[]};if(e===!1)return{valid:!1,errors:[{instanceLocation:a,keyword:"false",keywordLocation:a,error:"False boolean schema."}]};const c=typeof r;let u;switch(c){case"boolean":case"number":case"string":u=c;break;case"object":r===null?u="null":Array.isArray(r)?u="array":u="object";break;default:throw new Error(`Instances of "${c}" type are not supported.`)}const{$ref:d,$recursiveRef:h,$recursiveAnchor:f,type:p,const:m,enum:g,required:b,not:_,anyOf:y,allOf:w,oneOf:v,if:x,then:S,else:k,format:R,properties:D,patternProperties:C,additionalProperties:N,unevaluatedProperties:$,minProperties:P,maxProperties:E,propertyNames:O,dependentRequired:I,dependentSchemas:T,dependencies:j,prefixItems:W,items:ee,additionalItems:Z,unevaluatedItems:X,contains:U,minContains:G,maxContains:le,minItems:he,maxItems:Dt,uniqueItems:vt,minimum:lt,maximum:_t,exclusiveMinimum:Ut,exclusiveMaximum:hr,multipleOf:dn,minLength:qt,maxLength:Cn,pattern:Ci,__absolute_ref__:ss,__absolute_recursive_ref__:jc}=e,Y=[];if(f===!0&&i===null&&(i=e),h==="#"){const ge=i===null?n[jc]:i,ce=`${o}/$recursiveRef`,we=ft(r,i===null?e:i,t,n,s,ge,a,ce,l);we.valid||Y.push({instanceLocation:a,keyword:"$recursiveRef",keywordLocation:ce,error:"A subschema had errors."},...we.errors)}if(d!==void 0){const ce=n[ss||d];if(ce===void 0){let J=`Unresolved $ref "${d}".`;throw ss&&ss!==d&&(J+=`  Absolute URI "${ss}".`),J+=`
Known schemas:
- ${Object.keys(n).join(`
- `)}`,new Error(J)}const we=`${o}/$ref`,te=ft(r,ce,t,n,s,i,a,we,l);if(te.valid||Y.push({instanceLocation:a,keyword:"$ref",keywordLocation:we,error:"A subschema had errors."},...te.errors),t==="4"||t==="7")return{valid:Y.length===0,errors:Y}}if(Array.isArray(p)){let ge=p.length,ce=!1;for(let we=0;we<ge;we++)if(u===p[we]||p[we]==="integer"&&u==="number"&&r%1===0&&r===r){ce=!0;break}ce||Y.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${p.join('", "')}".`})}else p==="integer"?(u!=="number"||r%1||r!==r)&&Y.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${p}".`}):p!==void 0&&u!==p&&Y.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${p}".`});if(m!==void 0&&(u==="object"||u==="array"?pa(r,m)||Y.push({instanceLocation:a,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(m)}.`}):r!==m&&Y.push({instanceLocation:a,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(m)}.`})),g!==void 0&&(u==="object"||u==="array"?g.some(ge=>pa(r,ge))||Y.push({instanceLocation:a,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`}):g.some(ge=>r===ge)||Y.push({instanceLocation:a,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`})),_!==void 0){const ge=`${o}/not`;ft(r,_,t,n,s,i,a,ge).valid&&Y.push({instanceLocation:a,keyword:"not",keywordLocation:ge,error:'Instance matched "not" schema.'})}let is=[];if(y!==void 0){const ge=`${o}/anyOf`,ce=Y.length;let we=!1;for(let te=0;te<y.length;te++){const J=y[te],be=Object.create(l),_e=ft(r,J,t,n,s,f===!0?i:null,a,`${ge}/${te}`,be);Y.push(..._e.errors),we=we||_e.valid,_e.valid&&is.push(be)}we?Y.length=ce:Y.splice(ce,0,{instanceLocation:a,keyword:"anyOf",keywordLocation:ge,error:"Instance does not match any subschemas."})}if(w!==void 0){const ge=`${o}/allOf`,ce=Y.length;let we=!0;for(let te=0;te<w.length;te++){const J=w[te],be=Object.create(l),_e=ft(r,J,t,n,s,f===!0?i:null,a,`${ge}/${te}`,be);Y.push(..._e.errors),we=we&&_e.valid,_e.valid&&is.push(be)}we?Y.length=ce:Y.splice(ce,0,{instanceLocation:a,keyword:"allOf",keywordLocation:ge,error:"Instance does not match every subschema."})}if(v!==void 0){const ge=`${o}/oneOf`,ce=Y.length,we=v.filter((te,J)=>{const be=Object.create(l),_e=ft(r,te,t,n,s,f===!0?i:null,a,`${ge}/${J}`,be);return Y.push(..._e.errors),_e.valid&&is.push(be),_e.valid}).length;we===1?Y.length=ce:Y.splice(ce,0,{instanceLocation:a,keyword:"oneOf",keywordLocation:ge,error:`Instance does not match exactly one subschema (${we} matches).`})}if((u==="object"||u==="array")&&Object.assign(l,...is),x!==void 0){const ge=`${o}/if`;if(ft(r,x,t,n,s,i,a,ge,l).valid){if(S!==void 0){const we=ft(r,S,t,n,s,i,a,`${o}/then`,l);we.valid||Y.push({instanceLocation:a,keyword:"if",keywordLocation:ge,error:'Instance does not match "then" schema.'},...we.errors)}}else if(k!==void 0){const we=ft(r,k,t,n,s,i,a,`${o}/else`,l);we.valid||Y.push({instanceLocation:a,keyword:"if",keywordLocation:ge,error:'Instance does not match "else" schema.'},...we.errors)}}if(u==="object"){if(b!==void 0)for(const te of b)te in r||Y.push({instanceLocation:a,keyword:"required",keywordLocation:`${o}/required`,error:`Instance does not have required property "${te}".`});const ge=Object.keys(r);if(P!==void 0&&ge.length<P&&Y.push({instanceLocation:a,keyword:"minProperties",keywordLocation:`${o}/minProperties`,error:`Instance does not have at least ${P} properties.`}),E!==void 0&&ge.length>E&&Y.push({instanceLocation:a,keyword:"maxProperties",keywordLocation:`${o}/maxProperties`,error:`Instance does not have at least ${E} properties.`}),O!==void 0){const te=`${o}/propertyNames`;for(const J in r){const be=`${a}/${Gn(J)}`,_e=ft(J,O,t,n,s,i,be,te);_e.valid||Y.push({instanceLocation:a,keyword:"propertyNames",keywordLocation:te,error:`Property name "${J}" does not match schema.`},..._e.errors)}}if(I!==void 0){const te=`${o}/dependantRequired`;for(const J in I)if(J in r){const be=I[J];for(const _e of be)_e in r||Y.push({instanceLocation:a,keyword:"dependentRequired",keywordLocation:te,error:`Instance has "${J}" but does not have "${_e}".`})}}if(T!==void 0)for(const te in T){const J=`${o}/dependentSchemas`;if(te in r){const be=ft(r,T[te],t,n,s,i,a,`${J}/${Gn(te)}`,l);be.valid||Y.push({instanceLocation:a,keyword:"dependentSchemas",keywordLocation:J,error:`Instance has "${te}" but does not match dependant schema.`},...be.errors)}}if(j!==void 0){const te=`${o}/dependencies`;for(const J in j)if(J in r){const be=j[J];if(Array.isArray(be))for(const _e of be)_e in r||Y.push({instanceLocation:a,keyword:"dependencies",keywordLocation:te,error:`Instance has "${J}" but does not have "${_e}".`});else{const _e=ft(r,be,t,n,s,i,a,`${te}/${Gn(J)}`);_e.valid||Y.push({instanceLocation:a,keyword:"dependencies",keywordLocation:te,error:`Instance has "${J}" but does not match dependant schema.`},..._e.errors)}}}const ce=Object.create(null);let we=!1;if(D!==void 0){const te=`${o}/properties`;for(const J in D){if(!(J in r))continue;const be=`${a}/${Gn(J)}`,_e=ft(r[J],D[J],t,n,s,i,be,`${te}/${Gn(J)}`);if(_e.valid)l[J]=ce[J]=!0;else if(we=s,Y.push({instanceLocation:a,keyword:"properties",keywordLocation:te,error:`Property "${J}" does not match schema.`},..._e.errors),we)break}}if(!we&&C!==void 0){const te=`${o}/patternProperties`;for(const J in C){const be=new RegExp(J,"u"),_e=C[J];for(const Ht in r){if(!be.test(Ht))continue;const Dc=`${a}/${Gn(Ht)}`,Fc=ft(r[Ht],_e,t,n,s,i,Dc,`${te}/${Gn(J)}`);Fc.valid?l[Ht]=ce[Ht]=!0:(we=s,Y.push({instanceLocation:a,keyword:"patternProperties",keywordLocation:te,error:`Property "${Ht}" matches pattern "${J}" but does not match associated schema.`},...Fc.errors))}}}if(!we&&N!==void 0){const te=`${o}/additionalProperties`;for(const J in r){if(ce[J])continue;const be=`${a}/${Gn(J)}`,_e=ft(r[J],N,t,n,s,i,be,te);_e.valid?l[J]=!0:(we=s,Y.push({instanceLocation:a,keyword:"additionalProperties",keywordLocation:te,error:`Property "${J}" does not match additional properties schema.`},..._e.errors))}}else if(!we&&$!==void 0){const te=`${o}/unevaluatedProperties`;for(const J in r)if(!l[J]){const be=`${a}/${Gn(J)}`,_e=ft(r[J],$,t,n,s,i,be,te);_e.valid?l[J]=!0:Y.push({instanceLocation:a,keyword:"unevaluatedProperties",keywordLocation:te,error:`Property "${J}" does not match unevaluated properties schema.`},..._e.errors)}}}else if(u==="array"){Dt!==void 0&&r.length>Dt&&Y.push({instanceLocation:a,keyword:"maxItems",keywordLocation:`${o}/maxItems`,error:`Array has too many items (${r.length} > ${Dt}).`}),he!==void 0&&r.length<he&&Y.push({instanceLocation:a,keyword:"minItems",keywordLocation:`${o}/minItems`,error:`Array has too few items (${r.length} < ${he}).`});const ge=r.length;let ce=0,we=!1;if(W!==void 0){const te=`${o}/prefixItems`,J=Math.min(W.length,ge);for(;ce<J;ce++){const be=ft(r[ce],W[ce],t,n,s,i,`${a}/${ce}`,`${te}/${ce}`);if(l[ce]=!0,!be.valid&&(we=s,Y.push({instanceLocation:a,keyword:"prefixItems",keywordLocation:te,error:"Items did not match schema."},...be.errors),we))break}}if(ee!==void 0){const te=`${o}/items`;if(Array.isArray(ee)){const J=Math.min(ee.length,ge);for(;ce<J;ce++){const be=ft(r[ce],ee[ce],t,n,s,i,`${a}/${ce}`,`${te}/${ce}`);if(l[ce]=!0,!be.valid&&(we=s,Y.push({instanceLocation:a,keyword:"items",keywordLocation:te,error:"Items did not match schema."},...be.errors),we))break}}else for(;ce<ge;ce++){const J=ft(r[ce],ee,t,n,s,i,`${a}/${ce}`,te);if(l[ce]=!0,!J.valid&&(we=s,Y.push({instanceLocation:a,keyword:"items",keywordLocation:te,error:"Items did not match schema."},...J.errors),we))break}if(!we&&Z!==void 0){const J=`${o}/additionalItems`;for(;ce<ge;ce++){const be=ft(r[ce],Z,t,n,s,i,`${a}/${ce}`,J);l[ce]=!0,be.valid||(we=s,Y.push({instanceLocation:a,keyword:"additionalItems",keywordLocation:J,error:"Items did not match additional items schema."},...be.errors))}}}if(U!==void 0)if(ge===0&&G===void 0)Y.push({instanceLocation:a,keyword:"contains",keywordLocation:`${o}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(G!==void 0&&ge<G)Y.push({instanceLocation:a,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array has less items (${ge}) than minContains (${G}).`});else{const te=`${o}/contains`,J=Y.length;let be=0;for(let _e=0;_e<ge;_e++){const Ht=ft(r[_e],U,t,n,s,i,`${a}/${_e}`,te);Ht.valid?(l[_e]=!0,be++):Y.push(...Ht.errors)}be>=(G||0)&&(Y.length=J),G===void 0&&le===void 0&&be===0?Y.splice(J,0,{instanceLocation:a,keyword:"contains",keywordLocation:te,error:"Array does not contain item matching schema."}):G!==void 0&&be<G?Y.push({instanceLocation:a,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array must contain at least ${G} items matching schema. Only ${be} items were found.`}):le!==void 0&&be>le&&Y.push({instanceLocation:a,keyword:"maxContains",keywordLocation:`${o}/maxContains`,error:`Array may contain at most ${le} items matching schema. ${be} items were found.`})}if(!we&&X!==void 0){const te=`${o}/unevaluatedItems`;for(ce;ce<ge;ce++){if(l[ce])continue;const J=ft(r[ce],X,t,n,s,i,`${a}/${ce}`,te);l[ce]=!0,J.valid||Y.push({instanceLocation:a,keyword:"unevaluatedItems",keywordLocation:te,error:"Items did not match unevaluated items schema."},...J.errors)}}if(vt)for(let te=0;te<ge;te++){const J=r[te],be=typeof J=="object"&&J!==null;for(let _e=0;_e<ge;_e++){if(te===_e)continue;const Ht=r[_e];(J===Ht||be&&(typeof Ht=="object"&&Ht!==null)&&pa(J,Ht))&&(Y.push({instanceLocation:a,keyword:"uniqueItems",keywordLocation:`${o}/uniqueItems`,error:`Duplicate items at indexes ${te} and ${_e}.`}),te=Number.MAX_SAFE_INTEGER,_e=Number.MAX_SAFE_INTEGER)}}}else if(u==="number"){if(t==="4"?(lt!==void 0&&(Ut===!0&&r<=lt||r<lt)&&Y.push({instanceLocation:a,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${r} is less than ${Ut?"or equal to ":""} ${lt}.`}),_t!==void 0&&(hr===!0&&r>=_t||r>_t)&&Y.push({instanceLocation:a,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${r} is greater than ${hr?"or equal to ":""} ${_t}.`})):(lt!==void 0&&r<lt&&Y.push({instanceLocation:a,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${r} is less than ${lt}.`}),_t!==void 0&&r>_t&&Y.push({instanceLocation:a,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${r} is greater than ${_t}.`}),Ut!==void 0&&r<=Ut&&Y.push({instanceLocation:a,keyword:"exclusiveMinimum",keywordLocation:`${o}/exclusiveMinimum`,error:`${r} is less than ${Ut}.`}),hr!==void 0&&r>=hr&&Y.push({instanceLocation:a,keyword:"exclusiveMaximum",keywordLocation:`${o}/exclusiveMaximum`,error:`${r} is greater than or equal to ${hr}.`})),dn!==void 0){const ge=r%dn;Math.abs(0-ge)>=11920929e-14&&Math.abs(dn-ge)>=11920929e-14&&Y.push({instanceLocation:a,keyword:"multipleOf",keywordLocation:`${o}/multipleOf`,error:`${r} is not a multiple of ${dn}.`})}}else if(u==="string"){const ge=qt===void 0&&Cn===void 0?0:Z4(r);qt!==void 0&&ge<qt&&Y.push({instanceLocation:a,keyword:"minLength",keywordLocation:`${o}/minLength`,error:`String is too short (${ge} < ${qt}).`}),Cn!==void 0&&ge>Cn&&Y.push({instanceLocation:a,keyword:"maxLength",keywordLocation:`${o}/maxLength`,error:`String is too long (${ge} > ${Cn}).`}),Ci!==void 0&&!new RegExp(Ci,"u").test(r)&&Y.push({instanceLocation:a,keyword:"pattern",keywordLocation:`${o}/pattern`,error:"String does not match pattern."}),R!==void 0&&Mx[R]&&!Mx[R](r)&&Y.push({instanceLocation:a,keyword:"format",keywordLocation:`${o}/format`,error:`String does not match format "${R}".`})}return{valid:Y.length===0,errors:Y}}class J4 extends OA{async*_transform(e){for await(const t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}class IA extends J4{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=(e==null?void 0:e.diff)??this.diff}async*_transform(e){let t,n;for await(const s of e){if(typeof s!="string"&&typeof s.content!="string")throw new Error("Cannot handle non-string output.");let i;if(Oj(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new lr({message:s,text:s.content})}else if(Wh(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new lr({message:$j(s),text:s.content})}else i=new Ma({text:s});n===void 0?n=i:n=n.concat(i);const a=await this.parsePartialResult([n]);a!=null&&!pa(a,t)&&(this.diff?yield this._diff(t,a):yield a,t=a)}}getFormatInstructions(){return""}}class Zd extends OA{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const t=He.object(Object.fromEntries(Object.entries(e).map(([n,s])=>[n,He.string().describe(s)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(js(this.schema))}
\`\`\`
`}async parse(e){try{const n=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(s,i)=>`"${i.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await this.schema.parseAsync(JSON.parse(n))}catch(t){throw new ql(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}}class Jd extends IA{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,t){if(t)return e?mz(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return Jv(e[0].text)}async parse(e){return Jv(e,JSON.parse)}getFormatInstructions(){return""}}function $c(r,e){if(r.function===void 0)return;let t;if(e!=null&&e.partial)try{t=O_(r.function.arguments??"{}")}catch{return}else try{t=JSON.parse(r.function.arguments)}catch(s){throw new ql([`Function "${r.function.name}" arguments:`,"",r.function.arguments,"","are not valid JSON.",`Error: ${s.message}`].join(`
`))}const n={name:r.function.name,args:t,type:"tool_call"};return e!=null&&e.returnId&&(n.id=r.id),n}function CA(r){if(r.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:r.id,type:"function",function:{name:r.name,arguments:JSON.stringify(r.args)}}}function tf(r,e){var t,n;return{name:(t=r.function)==null?void 0:t.name,args:(n=r.function)==null?void 0:n.arguments,id:r.id,error:e,type:"invalid_tool_call"}}class K4 extends IA{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=(e==null?void 0:e.returnId)??this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){var a;const n=e[0].message;let s;if(rs(n)&&((a=n.tool_calls)!=null&&a.length)?s=n.tool_calls.map(o=>{const{id:l,...c}=o;return this.returnId?{id:l,...c}:c}):n.additional_kwargs.tool_calls!==void 0&&(s=JSON.parse(JSON.stringify(n.additional_kwargs.tool_calls)).map(l=>$c(l,{returnId:this.returnId,partial:t}))),!s)return[];const i=[];for(const o of s)if(o!==void 0){const l={type:o.name,args:o.args,id:o.id};i.push(l)}return i}}class Kd extends K4{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;const t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new ql(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){const n=(await super.parsePartialResult(e)).filter(i=>i.type===this.keyName);let s=n;if(n.length)return this.returnId||(s=n.map(i=>i.args)),this.returnSingle?s[0]:s}async parseResult(e){const n=(await super.parsePartialResult(e,!1)).filter(a=>a.type===this.keyName);let s=n;return n.length?(this.returnId||(s=n.map(a=>a.args)),this.returnSingle?this._validateResult(s[0]):await Promise.all(s.map(a=>this._validateResult(a)))):void 0}}const X4=Symbol("Let zodToJsonSchema decide on which parser to use"),Nx={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Y4=r=>typeof r=="string"?{...Nx,basePath:["#"],definitions:{},name:r}:{...Nx,basePath:["#"],definitions:{},...r},rb=r=>"_def"in r?r._def:r;function Q4(r){if(!r)return!0;for(const e in r)return!1;return!0}const eU=r=>{const e=Y4(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[rb(s),{def:rb(s),path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function $A(r,e,t,n){n!=null&&n.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function Xe(r,e,t,n,s){r[e]=t,$A(r,e,n,s)}function tU(){return{}}function nU(r,e){var n,s;const t={type:"array"};return((s=(n=r.type)==null?void 0:n._def)==null?void 0:s.typeName)!==L.ZodAny&&(t.items=qe(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&Xe(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&Xe(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(Xe(t,"minItems",r.exactLength.value,r.exactLength.message,e),Xe(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function rU(r,e){const t={type:"integer",format:"int64"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?Xe(t,"minimum",n.value,n.message,e):Xe(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Xe(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Xe(t,"maximum",n.value,n.message,e):Xe(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Xe(t,"maximum",n.value,n.message,e));break;case"multipleOf":Xe(t,"multipleOf",n.value,n.message,e);break}return t}function sU(){return{type:"boolean"}}function iU(r,e){return qe(r.type._def,e)}const aU=(r,e)=>qe(r.innerType._def,e);function MA(r,e,t){const n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((s,i)=>MA(r,e,s))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return oU(r,e)}}const oU=(r,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const n of r.checks)switch(n.kind){case"min":Xe(t,"minimum",n.value,n.message,e);break;case"max":Xe(t,"maximum",n.value,n.message,e);break}return t};function lU(r,e){return{...qe(r.innerType._def,e),default:r.defaultValue()}}function cU(r,e,t){return e.effectStrategy==="input"?qe(r.schema._def,e,t):{}}function uU(r){return{type:"string",enum:[...r.values]}}const dU=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function hU(r,e){const t=[qe(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),qe(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(i=>{if(dU(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(n=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...l}=i;a=l}else n=void 0;s.push(a)}}),s.length?{allOf:s,...n}:void 0}function fU(r,e){const t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}let xm;const Xs={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(xm===void 0&&(xm=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),xm),base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function NA(r,e){const t={type:"string"};function n(s){return e.patternStrategy==="escape"?pU(s):s}if(r.checks)for(const s of r.checks)switch(s.kind){case"min":Xe(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e);break;case"max":Xe(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Hn(t,"email",s.message,e);break;case"format:idn-email":Hn(t,"idn-email",s.message,e);break;case"pattern:zod":Wn(t,Xs.email,s.message,e);break}break;case"url":Hn(t,"uri",s.message,e);break;case"uuid":Hn(t,"uuid",s.message,e);break;case"regex":Wn(t,s.regex,s.message,e);break;case"cuid":Wn(t,Xs.cuid,s.message,e);break;case"cuid2":Wn(t,Xs.cuid2,s.message,e);break;case"startsWith":Wn(t,RegExp(`^${n(s.value)}`),s.message,e);break;case"endsWith":Wn(t,RegExp(`${n(s.value)}$`),s.message,e);break;case"datetime":Hn(t,"date-time",s.message,e);break;case"date":Hn(t,"date",s.message,e);break;case"time":Hn(t,"time",s.message,e);break;case"duration":Hn(t,"duration",s.message,e);break;case"length":Xe(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e),Xe(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"includes":{Wn(t,RegExp(n(s.value)),s.message,e);break}case"ip":{s.version!=="v6"&&Hn(t,"ipv4",s.message,e),s.version!=="v4"&&Hn(t,"ipv6",s.message,e);break}case"emoji":Wn(t,Xs.emoji,s.message,e);break;case"ulid":{Wn(t,Xs.ulid,s.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Hn(t,"binary",s.message,e);break}case"contentEncoding:base64":{Xe(t,"contentEncoding","base64",s.message,e);break}case"pattern:zod":{Wn(t,Xs.base64,s.message,e);break}}break}case"nanoid":Wn(t,Xs.nanoid,s.message,e)}return t}const pU=r=>Array.from(r).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),Hn=(r,e,t,n)=>{var s;r.format||(s=r.anyOf)!=null&&s.some(i=>i.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):Xe(r,"format",e,t,n)},Wn=(r,e,t,n)=>{var s;r.pattern||(s=r.allOf)!=null&&s.some(i=>i.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:Lx(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):Xe(r,"pattern",Lx(e,n),t,n)},Lx=(r,e)=>{var c;const t=typeof r=="function"?r():r;if(!e.applyRegexFlags||!t.flags)return t.source;const n={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},s=n.i?t.source.toLowerCase():t.source;let i="",a=!1,o=!1,l=!1;for(let u=0;u<s.length;u++){if(a){i+=s[u],a=!1;continue}if(n.i){if(o){if(s[u].match(/[a-z]/)){l?(i+=s[u],i+=`${s[u-2]}-${s[u]}`.toUpperCase(),l=!1):s[u+1]==="-"&&((c=s[u+2])!=null&&c.match(/[a-z]/))?(i+=s[u],l=!0):i+=`${s[u]}${s[u].toUpperCase()}`;continue}}else if(s[u].match(/[a-z]/)){i+=`[${s[u]}${s[u].toUpperCase()}]`;continue}}if(n.m){if(s[u]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(s[u]==="$"){i+=`($|(?=[\r
]))`;continue}}if(n.s&&s[u]==="."){i+=o?`${s[u]}\r
`:`[${s[u]}\r
]`;continue}i+=s[u],s[u]==="\\"?a=!0:o&&s[u]==="]"?o=!1:!o&&s[u]==="["&&(o=!0)}try{const u=new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return i};function LA(r,e){var n,s,i,a;if(e.target==="openApi3"&&((n=r.keyType)==null?void 0:n._def.typeName)===L.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((o,l)=>({...o,[l]:qe(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",l]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:qe(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((s=r.keyType)==null?void 0:s._def.typeName)===L.ZodString&&((i=r.keyType._def.checks)!=null&&i.length)){const o=Object.entries(NA(r.keyType._def,e)).reduce((l,[c,u])=>c==="type"?l:{...l,[c]:u},{});return{...t,propertyNames:o}}else if(((a=r.keyType)==null?void 0:a._def.typeName)===L.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};return t}function mU(r,e){if(e.mapStrategy==="record")return LA(r,e);const t=qe(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=qe(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function gU(r){const e=r.values,n=Object.keys(r.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(n.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function bU(){return{not:{}}}function _U(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Xd={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function yU(r,e){if(e.target==="openApi3")return jx(r,e);const t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in Xd&&(!n._def.checks||!n._def.checks.length))){const n=t.reduce((s,i)=>{const a=Xd[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=t.reduce((s,i)=>{const a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===t.length){const s=n.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,s)=>[...n,...s._def.values.filter(i=>!n.includes(i))],[])};return jx(r,e)}const jx=(r,e)=>{const t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,s)=>qe(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function wU(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:Xd[r.innerType._def.typeName],nullable:!0}:{type:[Xd[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=qe(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const t=qe(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function vU(r,e){const t={type:"number"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"int":t.type="integer",$A(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?Xe(t,"minimum",n.value,n.message,e):Xe(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Xe(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Xe(t,"maximum",n.value,n.message,e):Xe(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Xe(t,"maximum",n.value,n.message,e));break;case"multipleOf":Xe(t,"multipleOf",n.value,n.message,e);break}return t}function xU(r,e){return e.removeAdditionalStrategy==="strict"?r.catchall._def.typeName==="ZodNever"?r.unknownKeys!=="strict":qe(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":qe(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function kU(r,e){const t={type:"object",...Object.entries(r.shape()).reduce((n,[s,i])=>{if(i===void 0||i._def===void 0)return n;const a=qe(i._def,{...e,currentPath:[...e.currentPath,"properties",s],propertyPath:[...e.currentPath,"properties",s]});return a===void 0?n:{properties:{...n.properties,[s]:a},required:i.isOptional()&&!e.openaiStrictMode?n.required:[...n.required,s]}},{properties:{},required:[]}),additionalProperties:xU(r,e)};return t.required.length||delete t.required,t}const SU=(r,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return qe(r.innerType._def,e);const t=qe(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},PU=(r,e)=>{if(e.pipeStrategy==="input")return qe(r.in._def,e);if(e.pipeStrategy==="output")return qe(r.out._def,e);const t=qe(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=qe(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(s=>s!==void 0)}};function AU(r,e){return qe(r.type._def,e)}function EU(r,e){const n={type:"array",uniqueItems:!0,items:qe(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&Xe(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&Xe(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function OU(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>qe(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:qe(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>qe(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function TU(){return{not:{}}}function RU(){return{}}const IU=(r,e)=>qe(r.innerType._def,e);function qe(r,e,t=!1){var a;const n=e.seen.get(r);if(e.override){const o=(a=e.override)==null?void 0:a.call(e,r,e,n,t);if(o!==X4)return o}if(n&&!t){const o=CU(n,e);if(o!==void 0)return"$ref"in o&&e.seenRefs.add(o.$ref),o}const s={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,s);const i=MU(r,r.typeName,e,t);return i&&NU(r,e,i),s.jsonSchema=i,i}const CU=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"extract-to-root":const t=r.path.slice(e.basePath.length+1).join("_");return t!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[t]=r.def),{$ref:[...e.basePath,e.definitionPath,t].join("/")};case"relative":return{$ref:$U(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((n,s)=>e.currentPath[s]===n)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},$U=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},MU=(r,e,t,n)=>{switch(e){case L.ZodString:return NA(r,t);case L.ZodNumber:return vU(r,t);case L.ZodObject:return kU(r,t);case L.ZodBigInt:return rU(r,t);case L.ZodBoolean:return sU();case L.ZodDate:return MA(r,t);case L.ZodUndefined:return TU();case L.ZodNull:return _U(t);case L.ZodArray:return nU(r,t);case L.ZodUnion:case L.ZodDiscriminatedUnion:return yU(r,t);case L.ZodIntersection:return hU(r,t);case L.ZodTuple:return OU(r,t);case L.ZodRecord:return LA(r,t);case L.ZodLiteral:return fU(r,t);case L.ZodEnum:return uU(r);case L.ZodNativeEnum:return gU(r);case L.ZodNullable:return wU(r,t);case L.ZodOptional:return SU(r,t);case L.ZodMap:return mU(r,t);case L.ZodSet:return EU(r,t);case L.ZodLazy:return qe(r.getter()._def,t);case L.ZodPromise:return AU(r,t);case L.ZodNaN:case L.ZodNever:return bU();case L.ZodEffects:return cU(r,t,n);case L.ZodAny:return tU();case L.ZodUnknown:return RU();case L.ZodDefault:return lU(r,t);case L.ZodBranded:return iU(r,t);case L.ZodReadonly:return IU(r,t);case L.ZodCatch:return aU(r,t);case L.ZodPipeline:return PU(r,t);case L.ZodFunction:case L.ZodVoid:case L.ZodSymbol:return;default:return(s=>{})()}},NU=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t),LU=(r,e)=>{const t=eU(e),n=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,s=qe(r._def,n===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,n]},!1)??{},i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(s.title=i);const a=(()=>{if(Q4(t.definitions))return;const l={},c=new Set;for(let u=0;u<500;u++){const d=Object.entries(t.definitions).filter(([h])=>!c.has(h));if(d.length===0)break;for(const[h,f]of d)l[h]=qe(rb(f),{...t,currentPath:[...t.basePath,t.definitionPath,h]},!0)??{},c.add(h)}return l})(),o=n===void 0?a?{...s,[t.definitionPath]:a}:s:t.nameStrategy==="duplicate-ref"?{...s,...a||t.seenRefs.size?{[t.definitionPath]:{...a,...t.seenRefs.size?{[n]:s}:void 0}}:void 0}:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,n].join("/"),[t.definitionPath]:{...a,[n]:s}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function jA(r,e){return LU(r,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function DA(r,e,t){return J2({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:jA(r,{name:e})}},n=>r.parse(JSON.parse(n)))}function jU(r){return K2({type:"function",function:{name:r.name,parameters:jA(r.parameters,{name:r.name}),strict:!0,...r.description?{description:r.description}:void 0}},{callback:r.function,parser:e=>r.parameters.parse(JSON.parse(e))})}function DU(r){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:n,azureOpenAIBasePath:s,baseURL:i,azureADTokenProvider:a,azureOpenAIEndpoint:o}=r;if((n||a)&&s&&e)return`${s}/${e}`;if((n||a)&&o&&e)return`${o}/openai/deployments/${e}`;if(n||a){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return i}function FU(r){return r!==void 0&&Array.isArray(r.lc_namespace)}function zU(r){return r!==void 0&&Lt.isRunnable(r)&&"lc_name"in r.constructor&&typeof r.constructor.lc_name=="function"&&r.constructor.lc_name()==="RunnableToolLike"}function BU(r){return!!r&&typeof r=="object"&&"name"in r&&"schema"in r&&ki(r.schema)}function nf(r){return BU(r)||zU(r)||FU(r)}function UU(r){return ki(r)?js(r):r}function md(r){if(!r||typeof r!="object"||Object.keys(r).length===0||Array.isArray(r))return!1;if("type"in r)return typeof r.type=="string"?r.type==="string":Array.isArray(r.type)?r.type.every(e=>e==="string"):!1;if("enum"in r)return Array.isArray(r.enum)&&r.enum.length>0&&r.enum.every(e=>typeof e=="string");if("const"in r)return typeof r.const=="string";if("allOf"in r&&Array.isArray(r.allOf))return r.allOf.some(e=>md(e));if("anyOf"in r&&Array.isArray(r.anyOf)||"oneOf"in r&&Array.isArray(r.oneOf)){const e="anyOf"in r?r.anyOf:r.oneOf;return e.length>0&&e.every(t=>md(t))}if("not"in r)return!1;if("$ref"in r&&typeof r.$ref=="string"){const e=r.$ref,t=sa(r);return t[e]?md(t[e]):!1}return!1}function FA(r,e){const t=typeof e=="number"?void 0:e;return{name:r.name,description:r.description,parameters:UU(r.schema),...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}}function qU(r,e){let t;return nf(r)?t={type:"function",function:FA(r)}:t=r,t}function Au(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function km(r){let e;return r.constructor.name===_c.name?(e=new Error(r.message),e.name="TimeoutError"):r.constructor.name===bn.name?(e=new Error(r.message),e.name="AbortError"):r.status===400&&r.message.includes("tool_calls")?e=Au(r,"INVALID_TOOL_RESULTS"):r.status===401?e=Au(r,"MODEL_AUTHENTICATION"):r.status===429?e=Au(r,"MODEL_RATE_LIMIT"):r.status===404?e=Au(r,"MODEL_NOT_FOUND"):e=r,e}function Dx(r){if(r)return r==="any"||r==="required"?"required":r==="auto"?"auto":r==="none"?"none":typeof r=="string"?{type:"function",function:{name:r}}:r}function HU(r){return r.anyOf!==void 0&&Array.isArray(r.anyOf)}function WU(r){const e=["namespace functions {",""];for(const t of r)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(zA(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function zA(r,e){var n;const t=[];for(const[s,i]of Object.entries(r.properties??{}))i.description&&e<2&&t.push(`// ${i.description}`),(n=r.required)!=null&&n.includes(s)?t.push(`${s}: ${Yd(i,e)},`):t.push(`${s}?: ${Yd(i,e)},`);return t.map(s=>" ".repeat(e)+s).join(`
`)}function Yd(r,e){if(HU(r))return r.anyOf.map(t=>Yd(t,e)).join(" | ");switch(r.type){case"string":return r.enum?r.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",zA(r,e+2),"}"].join(`
`);case"array":return r.items?`${Yd(r.items,e)}[]`:"any[]";default:return""}}function VU(r,e){let t;return nf(r)?t=qU(r):t=r,(e==null?void 0:e.strict)!==void 0&&(t.function.strict=e.strict),t}function GU(r){return r.role!=="system"&&r.role!=="developer"&&r.role!=="assistant"&&r.role!=="user"&&r.role!=="function"&&r.role!=="tool"&&console.warn(`Unknown message role: ${r.role}`),r.role}function H_(r){const e=r._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!Ti.isInstance(r))throw new Error("Invalid generic chat message");return GU(r)}default:throw new Error(`Unknown message type: ${e}`)}}function Fx(r,e){return r.flatMap(t=>{var i;let n=H_(t);n==="system"&&W_(e)&&(n="developer");const s={role:n,content:t.content};if(t.name!=null&&(s.name=t.name),t.additional_kwargs.function_call!=null&&(s.function_call=t.additional_kwargs.function_call,s.content=""),rs(t)&&((i=t.tool_calls)!=null&&i.length)?(s.tool_calls=t.tool_calls.map(CA),s.content=""):(t.additional_kwargs.tool_calls!=null&&(s.tool_calls=t.additional_kwargs.tool_calls),t.tool_call_id!=null&&(s.tool_call_id=t.tool_call_id)),t.additional_kwargs.audio&&typeof t.additional_kwargs.audio=="object"&&"id"in t.additional_kwargs.audio){const a={role:"assistant",audio:{id:t.additional_kwargs.audio.id}};return[s,a]}return s})}const ia="__openai_function_call_ids__";function zx(r,e){return r.flatMap(t=>{var i,a,o;let n=H_(t);if(n==="system"&&W_(e)&&(n="developer"),n==="function")throw new Error("Function messages are not supported in Responses API");if(n==="tool"){const l=t;return((i=l.additional_kwargs)==null?void 0:i.type)==="computer_call_output"?{type:"computer_call_output",output:(()=>{if(typeof l.content=="string")return{type:"computer_screenshot",image_url:l.content};if(Array.isArray(l.content)){const u=l.content.find(h=>h.type==="computer_screenshot");if(u)return u;const d=l.content.find(h=>h.type==="image_url");if(d)return{type:"computer_screenshot",image_url:typeof d.image_url=="string"?d.image_url:d.image_url.url}}throw new Error("Invalid computer call output")})(),call_id:l.tool_call_id}:{type:"function_call_output",call_id:l.tool_call_id,id:l.id,output:typeof l.content!="string"?JSON.stringify(l.content):l.content}}if(n==="assistant"){const l=[];t.additional_kwargs.reasoning!=null&&(f=>typeof f=="object"&&f!=null&&"type"in f&&f.type==="reasoning")(t.additional_kwargs.reasoning)&&l.push(t.additional_kwargs.reasoning);let{content:c}=t;t.additional_kwargs.refusal!=null&&(typeof c=="string"&&(c=[{type:"output_text",text:c,annotations:[]}]),c=[...c,{type:"refusal",refusal:t.additional_kwargs.refusal}]),l.push({type:"message",role:"assistant",content:typeof c=="string"?c:c.flatMap(h=>h.type==="text"?{type:"output_text",text:h.text,annotations:h.annotations??[]}:h.type==="output_text"||h.type==="refusal"?h:[])});const u=t.additional_kwargs[ia];rs(t)&&((a=t.tool_calls)!=null&&a.length)?l.push(...t.tool_calls.map(h=>({type:"function_call",name:h.name,arguments:JSON.stringify(h.args),call_id:h.id,id:u==null?void 0:u[h.id]}))):t.additional_kwargs.tool_calls!=null&&l.push(...t.additional_kwargs.tool_calls.map(h=>({type:"function_call",name:h.function.name,call_id:h.id,id:u==null?void 0:u[h.id],arguments:h.function.arguments})));const d=(o=t.response_metadata.output)!=null&&o.length?t.response_metadata.output:t.additional_kwargs.tool_outputs;if(d!=null){const h=d,f=h==null?void 0:h.filter(m=>m.type==="reasoning"),p=h==null?void 0:h.filter(m=>m.type==="computer_call");f.length>0&&p.length>0&&l.push(...f),p.length>0&&l.push(...p)}return l}const s=typeof t.content=="string"?t.content:t.content.flatMap(l=>{if(l.type==="text")return{type:"input_text",text:l.text};if(l.type==="image_url"){const c=typeof l.image_url=="string"?l.image_url:l.image_url.url,u=typeof l.image_url=="string"?"auto":l.image_url.detail;return{type:"input_image",image_url:c,detail:u}}return l.type==="input_text"||l.type==="input_image"||l.type==="input_file"?l:[]});return n==="user"||n==="system"||n==="developer"?{type:"message",role:n,content:s}:(console.warn(`Unsupported role found when converting to OpenAI Responses API: ${n}`),[])})}function BA(r){if(r.error){const a=new Error(r.error.message);throw a.name=r.error.code,a}const e=[],t=[],n=[],s={model:r.model,created_at:r.created_at,id:r.id,incomplete_details:r.incomplete_details,metadata:r.metadata,object:r.object,status:r.status,user:r.user,model_name:r.model},i={};for(const a of r.output)if(a.type==="message")e.push(...a.content.flatMap(o=>o.type==="output_text"?("parsed"in o&&o.parsed!=null&&(i.parsed=o.parsed),{type:"text",text:o.text,annotations:o.annotations}):o.type==="refusal"?(i.refusal=o.refusal,[]):o));else if(a.type==="function_call"){const o={function:{name:a.name,arguments:a.arguments},id:a.call_id};try{t.push($c(o,{returnId:!0}))}catch(l){let c;typeof l=="object"&&l!=null&&"message"in l&&typeof l.message=="string"&&(c=l.message),n.push(tf(o,c))}i[ia]??(i[ia]={}),i[ia][a.call_id]=a.id}else a.type==="reasoning"?i.reasoning=a:(i.tool_outputs??(i.tool_outputs=[]),i.tool_outputs.push(a));return new ar({id:r.id,content:e,tool_calls:t,invalid_tool_calls:n,usage_metadata:r.usage,additional_kwargs:i,response_metadata:s})}function ZU(r){var l,c;const e=[];let t={},n;const s=[],i={},a={};let o;if(r.type==="response.output_text.delta")e.push({type:"text",text:r.delta,index:r.content_index});else if(r.type==="response.output_text.annotation.added")e.push({type:"text",text:"",annotations:[r.annotation],index:r.content_index});else if(r.type==="response.output_item.added"&&r.item.type==="message")o=r.item.id;else if(r.type==="response.output_item.added"&&r.item.type==="function_call")s.push({type:"tool_call_chunk",name:r.item.name,args:r.item.arguments,id:r.item.id,index:r.output_index}),a[ia]={[r.item.call_id]:r.item.id};else if(r.type==="response.output_item.done"&&(r.item.type==="web_search_call"||r.item.type==="file_search_call"||r.item.type==="computer_call"))a.tool_outputs=[r.item];else if(r.type==="response.created")i.id=r.response.id,i.model_name=r.response.model,i.model=r.response.model;else if(r.type==="response.completed"){const u=BA(r.response);n=r.response.usage,((c=(l=r.response.text)==null?void 0:l.format)==null?void 0:c.type)==="json_schema"&&(a.parsed??(a.parsed=JSON.parse(u.text)));for(const[d,h]of Object.entries(r.response))d!=="id"&&(i[d]=h)}else if(r.type==="response.function_call_arguments.delta")s.push({type:"tool_call_chunk",args:r.delta,index:r.output_index});else if(r.type==="response.web_search_call.completed"||r.type==="response.file_search_call.completed")t={tool_outputs:{id:r.item_id,type:r.type.replace("response.","").replace(".completed",""),status:"completed"}};else if(r.type==="response.refusal.done")a.refusal=r.refusal;else return null;return new lr({text:e.map(u=>u.text).join(""),message:new mt({id:o,content:e,tool_call_chunks:s,usage_metadata:n,additional_kwargs:a,response_metadata:i}),generationInfo:t})}function Sm(r){return"type"in r&&r.type!=="function"}function JU(r){return r!=null&&typeof r=="object"&&"type"in r&&r.type!=="function"}function Bx(r,e){return Cc(r)?(e==null?void 0:e.strict)!==void 0?{...r,function:{...r.function,strict:e.strict}}:r:VU(r,e)}function W_(r){return(r==null?void 0:r.startsWith("o1"))||(r==null?void 0:r.startsWith("o3"))}let KU=class extends xr{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","reasoningEffort","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","modelName","model","modelKwargs","stop","stopSequences","timeout","openAIApiKey","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming"]}constructor(e){var t,n;super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useResponsesApi",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.openAIApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.openAIApiKey)??((t=e==null?void 0:e.configuration)==null?void 0:t.apiKey)??_n("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.organization=((n=e==null?void 0:e.configuration)==null?void 0:n.organization)??_n("OPENAI_ORGANIZATION"),this.model=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.modelName=this.model,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this.stop,this.user=e==null?void 0:e.user,this.__includeRawResponse=e==null?void 0:e.__includeRawResponse,this.audio=e==null?void 0:e.audio,this.modalities=e==null?void 0:e.modalities,this.reasoningEffort=e==null?void 0:e.reasoningEffort,this.maxTokens=(e==null?void 0:e.maxCompletionTokens)??(e==null?void 0:e.maxTokens),this.useResponsesApi=(e==null?void 0:e.useResponsesApi)??this.useResponsesApi,this.disableStreaming=(e==null?void 0:e.disableStreaming)??this.disableStreaming,this.model==="o1"&&(this.disableStreaming=!0),this.streaming=(e==null?void 0:e.streaming)??!1,this.disableStreaming&&(this.streaming=!1),this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.disableStreaming&&(this.streamUsage=!1),this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e==null?void 0:e.configuration},(e==null?void 0:e.supportsStrictToolCalling)!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling)}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){let n;return(t==null?void 0:t.strict)!==void 0?n=t.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this.bind({tools:e.map(s=>Sm(s)?s:Bx(s,{strict:n})),...t})}createResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&Eu(e.json_schema.schema)?DA(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}invocationParams(e,t){var o,l;let n;if((e==null?void 0:e.strict)!==void 0?n=e.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this._useResponseApi(e)){const c={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:e==null?void 0:e.previous_response_id,truncation:e==null?void 0:e.truncation,include:e==null?void 0:e.include,tools:(o=e==null?void 0:e.tools)!=null&&o.length?e.tools.map(d=>Sm(d)?d:Cc(d)?{type:"function",name:d.function.name,parameters:d.function.parameters,description:d.function.description,strict:n}:null).filter(d=>d!==null):void 0,tool_choice:JU(e==null?void 0:e.tool_choice)?e==null?void 0:e.tool_choice:(()=>{const d=Dx(e==null?void 0:e.tool_choice);if(typeof d=="object"&&"type"in d)return{type:"function",name:d.function.name}})(),text:(()=>{if(e!=null&&e.text)return e.text;const d=this.createResponseFormat(e==null?void 0:e.response_format);return(d==null?void 0:d.type)==="json_schema"?d.json_schema.schema!=null?{format:{type:"json_schema",schema:d.json_schema.schema,description:d.json_schema.description,name:d.json_schema.name,strict:d.json_schema.strict}}:void 0:{format:d}})(),parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,max_output_tokens:this.maxTokens===-1?void 0:this.maxTokens,...this.modelKwargs},u=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return u!==void 0&&(c.reasoning={effort:u}),c}let s={};(e==null?void 0:e.stream_options)!==void 0?s={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t!=null&&t.streaming)&&(s={stream_options:{include_usage:!0}});const i={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:(l=e==null?void 0:e.tools)!=null&&l.length?e.tools.map(c=>Bx(c,{strict:n})):void 0,tool_choice:Dx(e==null?void 0:e.tool_choice),response_format:this.createResponseFormat(e==null?void 0:e.response_format),seed:e==null?void 0:e.seed,...s,parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,...this.audio||e!=null&&e.audio?{audio:this.audio||(e==null?void 0:e.audio)}:{},...this.modalities||e!=null&&e.modalities?{modalities:this.modalities||(e==null?void 0:e.modalities)}:{},...this.modelKwargs};(e==null?void 0:e.prediction)!==void 0&&(i.prediction=e.prediction);const a=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return a!==void 0&&(i.reasoning_effort=a),W_(i.model)?i.max_completion_tokens=this.maxTokens===-1?void 0:this.maxTokens:i.max_tokens=this.maxTokens===-1?void 0:this.maxTokens,i}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){const n=e.tool_calls;switch(e.role){case"assistant":{const s=[],i=[];for(const l of n??[])try{s.push($c(l,{returnId:!0}))}catch(c){i.push(tf(l,c.message))}const a={function_call:e.function_call,tool_calls:n};this.__includeRawResponse!==void 0&&(a.__raw_response=t);const o={model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};return e.audio&&(a.audio=e.audio),new ar({content:e.content||"",tool_calls:s,invalid_tool_calls:i,additional_kwargs:a,response_metadata:o,id:t.id})}default:return new Ti(e.content||"",e.role??"unknown")}}_convertOpenAIDeltaToBaseMessageChunk(e,t,n){var l,c;const s=e.role??n,i=e.content??"";let a;e.function_call?a={function_call:e.function_call}:e.tool_calls?a={tool_calls:e.tool_calls}:a={},this.__includeRawResponse&&(a.__raw_response=t),e.audio&&(a.audio={...e.audio,index:t.choices[0].index});const o={usage:{...t.usage}};if(s==="user")return new Ec({content:i,response_metadata:o});if(s==="assistant"){const u=[];if(Array.isArray(e.tool_calls))for(const d of e.tool_calls)u.push({name:(l=d.function)==null?void 0:l.name,args:(c=d.function)==null?void 0:c.arguments,id:d.id,index:d.index,type:"tool_call_chunk"});return new mt({content:i,tool_call_chunks:u,additional_kwargs:a,id:t.id,response_metadata:o})}else return s==="system"?new yi({content:i,response_metadata:o}):s==="developer"?new yi({content:i,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}}):s==="function"?new Ac({content:i,additional_kwargs:a,name:e.name,response_metadata:o}):s==="tool"?new Vh({content:i,additional_kwargs:a,tool_call_id:e.tool_call_id,response_metadata:o}):new Pc({content:i,role:s,response_metadata:o})}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,n){var c,u,d,h,f,p,m,g,b,_;if(this._useResponseApi(t)){const y=await this.responseApiWithRetry({...this.invocationParams(t,{streaming:!0}),input:zx(e,this.model),stream:!0},t);for await(const w of y){const v=ZU(w);v!=null&&(yield v)}return}const s=Fx(e,this.model),i={...this.invocationParams(t,{streaming:!0}),messages:s,stream:!0};let a;const o=await this.completionWithRetry(i,t);let l;for await(const y of o){const w=(c=y==null?void 0:y.choices)==null?void 0:c[0];if(y.usage&&(l=y.usage),!w)continue;const{delta:v}=w;if(!v)continue;const x=this._convertOpenAIDeltaToBaseMessageChunk(v,y,a);a=v.role??a;const S={prompt:t.promptIndex??0,completion:w.index??0};if(typeof x.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const k={...S};w.finish_reason!=null&&(k.finish_reason=w.finish_reason,k.system_fingerprint=y.system_fingerprint,k.model_name=y.model),this.logprobs&&(k.logprobs=w.logprobs);const R=new lr({message:x,text:x.content,generationInfo:k});yield R,await(n==null?void 0:n.handleLLMNewToken(R.text??"",S,void 0,void 0,void 0,{chunk:R}))}if(l){const y={...((u=l.prompt_tokens_details)==null?void 0:u.audio_tokens)!==null&&{audio:(d=l.prompt_tokens_details)==null?void 0:d.audio_tokens},...((h=l.prompt_tokens_details)==null?void 0:h.cached_tokens)!==null&&{cache_read:(f=l.prompt_tokens_details)==null?void 0:f.cached_tokens}},w={...((p=l.completion_tokens_details)==null?void 0:p.audio_tokens)!==null&&{audio:(m=l.completion_tokens_details)==null?void 0:m.audio_tokens},...((g=l.completion_tokens_details)==null?void 0:g.reasoning_tokens)!==null&&{reasoning:(b=l.completion_tokens_details)==null?void 0:b.reasoning_tokens}};yield new lr({message:new mt({content:"",response_metadata:{usage:{...l}},usage_metadata:{input_tokens:l.prompt_tokens,output_tokens:l.completion_tokens,total_tokens:l.total_tokens,...Object.keys(y).length>0&&{input_token_details:y},...Object.keys(w).length>0&&{output_token_details:w}}}),text:""})}if((_=t.signal)!=null&&_.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _responseApiGenerate(e,t,n){var o;const s=this.invocationParams(t);if(s.stream){const l=this._streamResponseChunks(e,t,n);let c;for await(const u of l)u.message.response_metadata={...u.generationInfo,...u.message.response_metadata},c=(c==null?void 0:c.concat(u))??u;return{generations:c?[c]:[],llmOutput:{estimatedTokenUsage:(o=c==null?void 0:c.message)==null?void 0:o.usage_metadata}}}const i=zx(e,this.model),a=await this.responseApiWithRetry({input:i,...s},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});return{generations:[{text:a.output_text,message:BA(a)}],llmOutput:{id:a.id,estimatedTokenUsage:a.usage?{promptTokens:a.usage.input_tokens,completionTokens:a.usage.output_tokens,totalTokens:a.usage.total_tokens}:void 0}}}_useResponseApi(e){var s;const t=(s=e==null?void 0:e.tools)==null?void 0:s.some(Sm),n=(e==null?void 0:e.previous_response_id)!=null||(e==null?void 0:e.text)!=null||(e==null?void 0:e.truncation)!=null||(e==null?void 0:e.include)!=null;return this.useResponsesApi||t||n}async _generate(e,t,n){var o,l;if(this._useResponseApi(t))return this._responseApiGenerate(e,t,n);const s={},i=this.invocationParams(t),a=Fx(e,this.model);if(i.stream){const c=this._streamResponseChunks(e,t,n),u={};for await(const g of c){g.message.response_metadata={...g.generationInfo,...g.message.response_metadata};const b=((o=g.generationInfo)==null?void 0:o.completion)??0;u[b]===void 0?u[b]=g:u[b]=u[b].concat(g)}const d=Object.entries(u).sort(([g],[b])=>parseInt(g,10)-parseInt(b,10)).map(([g,b])=>b),{functions:h,function_call:f}=this.invocationParams(t),p=await this.getEstimatedTokenCountFromPrompt(e,h,f),m=await this.getNumTokensFromGenerations(d);return s.input_tokens=p,s.output_tokens=m,s.total_tokens=p+m,{generations:d,llmOutput:{estimatedTokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}else{let c;t.response_format&&t.response_format.type==="json_schema"?c=await this.betaParsedCompletionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}):c=await this.completionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});const{completion_tokens:u,prompt_tokens:d,total_tokens:h,prompt_tokens_details:f,completion_tokens_details:p}=(c==null?void 0:c.usage)??{};u&&(s.output_tokens=(s.output_tokens??0)+u),d&&(s.input_tokens=(s.input_tokens??0)+d),h&&(s.total_tokens=(s.total_tokens??0)+h),((f==null?void 0:f.audio_tokens)!==null||(f==null?void 0:f.cached_tokens)!==null)&&(s.input_token_details={...(f==null?void 0:f.audio_tokens)!==null&&{audio:f==null?void 0:f.audio_tokens},...(f==null?void 0:f.cached_tokens)!==null&&{cache_read:f==null?void 0:f.cached_tokens}}),((p==null?void 0:p.audio_tokens)!==null||(p==null?void 0:p.reasoning_tokens)!==null)&&(s.output_token_details={...(p==null?void 0:p.audio_tokens)!==null&&{audio:p==null?void 0:p.audio_tokens},...(p==null?void 0:p.reasoning_tokens)!==null&&{reasoning:p==null?void 0:p.reasoning_tokens}});const m=[];for(const g of(c==null?void 0:c.choices)??[]){const _={text:((l=g.message)==null?void 0:l.content)??"",message:this._convertOpenAIChatCompletionMessageToBaseMessage(g.message??{role:"assistant"},c)};_.generationInfo={...g.finish_reason?{finish_reason:g.finish_reason}:{},...g.logprobs?{logprobs:g.logprobs}:{}},rs(_.message)&&(_.message.usage_metadata=s),_.message=new ar(Object.fromEntries(Object.entries(_.message).filter(([y])=>!y.startsWith("lc_")))),m.push(_)}return{generations:m,llmOutput:{tokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,t,n){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&n!=="auto"){const i=WU(t);s+=await this.getNumTokens(i),s+=9}return t&&e.find(i=>i._getType()==="system")&&(s-=4),n==="none"?s+=1:typeof n=="object"&&(s+=await this.getNumTokens(n.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async n=>{var s;return(s=n.message.additional_kwargs)!=null&&s.function_call?(await this.getNumTokensFromMessages([n.message])).countPerMessage[0]:await this.getNumTokens(n.message.content)}))).reduce((n,s)=>n+s,0)}async getNumTokensFromMessages(e){let t=0,n=0,s=0;this.model==="gpt-3.5-turbo-0301"?(n=4,s=-1):(n=3,s=1);const i=await Promise.all(e.map(async a=>{var h,f,p,m,g,b;const o=await this.getNumTokens(a.content),l=await this.getNumTokens(H_(a)),c=a.name!==void 0?s+await this.getNumTokens(a.name):0;let u=o+n+l+c;const d=a;if(d._getType()==="function"&&(u-=2),(h=d.additional_kwargs)!=null&&h.function_call&&(u+=3),(f=d==null?void 0:d.additional_kwargs.function_call)!=null&&f.name&&(u+=await this.getNumTokens((p=d.additional_kwargs.function_call)==null?void 0:p.name)),(m=d.additional_kwargs.function_call)!=null&&m.arguments)try{u+=await this.getNumTokens(JSON.stringify(JSON.parse((g=d.additional_kwargs.function_call)==null?void 0:g.arguments)))}catch(_){console.error("Error parsing function arguments",_,JSON.stringify(d.additional_kwargs.function_call)),u+=await this.getNumTokens((b=d.additional_kwargs.function_call)==null?void 0:b.arguments)}return t+=u,u}));return t+=3,{totalCount:t,countPerMessage:i}}async completionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,n)}catch(s){throw km(s)}})}async responseApiWithRetry(e,t){return this.caller.call(async()=>{var s,i;const n=this._getClientOptions(t);try{return((i=(s=e.text)==null?void 0:s.format)==null?void 0:i.type)==="json_schema"&&!e.stream?await this.client.responses.parse(e,n):await this.client.responses.create(e,n)}catch(a){throw km(a)}})}async betaParsedCompletionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.beta.chat.completions.parse(e,n)}catch(s){throw km(s)}})}_getClientOptions(e){if(!this.client){const n={baseURL:this.clientConfig.baseURL},s=DU(n),i={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new Ae(i)}return{...this.clientConfig,...e}}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,n)=>(n&&n.tokenUsage&&(t.tokenUsage.completionTokens+=n.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=n.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=n.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let n,s,i,a;XU(e)?(n=e.schema,s=e.name,i=e.method,a=e.includeRaw):(n=e,s=t==null?void 0:t.name,i=t==null?void 0:t.method,a=t==null?void 0:t.includeRaw);let o,l;if((t==null?void 0:t.strict)!==void 0&&i==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"?i===void 0&&(i="jsonSchema"):i==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`),i==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),Eu(n)?l=Zd.fromZodSchema(n):l=new Jd;else if(i==="jsonSchema")if(o=this.bind({response_format:{type:"json_schema",json_schema:{name:s??"extract",description:n.description,schema:n,strict:t==null?void 0:t.strict}}}),Eu(n)){const h=Zd.fromZodSchema(n);l=Ri.from(f=>"parsed"in f.additional_kwargs?f.additional_kwargs.parsed:h)}else l=new Jd;else{let h=s??"extract";if(Eu(n)){const f=js(n);o=this.bind({tools:[{type:"function",function:{name:h,description:f.description,parameters:f}}],tool_choice:{type:"function",function:{name:h}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),l=new Kd({returnSingle:!0,keyName:h,zodSchema:n})}else{let f;typeof n.name=="string"&&typeof n.parameters=="object"&&n.parameters!=null?(f=n,h=n.name):(h=n.title??h,f={name:h,description:n.description??"",parameters:n}),o=this.bind({tools:[{type:"function",function:f}],tool_choice:{type:"function",function:{name:h}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),l=new Kd({returnSingle:!0,keyName:h})}}if(!a)return o.pipe(l);const c=Ds.assign({parsed:(h,f)=>l.invoke(h.raw,f)}),u=Ds.assign({parsed:()=>null}),d=c.withFallbacks({fallbacks:[u]});return Qn.from([{raw:o},d])}};function Eu(r){return typeof(r==null?void 0:r.parse)=="function"}function XU(r){return r!==void 0&&typeof r.schema=="object"}class UA extends AA{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"verboseParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"content"}),this.verboseParsingErrors=(e==null?void 0:e.verboseParsingErrors)??this.verboseParsingErrors,this.responseFormat=(e==null?void 0:e.responseFormat)??this.responseFormat}async invoke(e,t){let n,s,i=We(t);return T_(e)?(n=e.id,s=e.args,i={...i,toolCall:e,configurable:{...i.configurable,tool_call_id:n}}):s=e,this.call(s,i)}async call(e,t,n){let s=e;if(ki(this.schema))try{s=await this.schema.parseAsync(e)}catch(f){let p="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(p=`${p}
Details: ${f.message}`),new Ug(p,JSON.stringify(e))}else{const f=ft(e,this.schema);if(!f.valid){let p="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(p=`${p}
Details: ${f.errors.map(m=>`${m.keywordLocation}: ${m.error}`).join(`
`)}`),new Ug(p,JSON.stringify(e))}}const i=F_(t),a=an.configure(i.callbacks,this.callbacks,i.tags||n,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),o=await(a==null?void 0:a.handleToolStart(this.toJSON(),typeof s=="string"?s:JSON.stringify(s),i.runId,void 0,void 0,void 0,i.runName));delete i.runId;let l;try{l=await this._call(s,o,i)}catch(f){throw await(o==null?void 0:o.handleToolError(f)),f}let c,u;if(this.responseFormat==="content_and_artifact")if(Array.isArray(l)&&l.length===2)[c,u]=l;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(l)}`);else c=l;let d;i&&"configurable"in i&&(d=i.configurable.tool_call_id);const h=t3({content:c,artifact:u,toolCallId:d,name:this.name});return await(o==null?void 0:o.handleToolEnd(h)),h}}class YU extends UA{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:He.object({input:He.string().optional()}).transform(t=>t.input)})}call(e,t){return super.call(typeof e=="string"||!e?{input:e}:e,t)}}class QU extends YU{static lc_name(){return"DynamicTool"}constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect}async call(e,t){const n=F_(t);return n.runName===void 0&&(n.runName=this.name),super.call(e,n)}async _call(e,t,n){return this.func(e,t,n)}}class e3 extends UA{static lc_name(){return"DynamicStructuredTool"}constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect,this.schema=e.schema}async call(e,t,n){const s=F_(t);return s.runName===void 0&&(s.runName=this.name),super.call(e,s,n)}_call(e,t,n){return this.func(e,t,n)}}function bo(r,e){var a;const t=e.schema&&ki(e.schema)&&(!("shape"in e.schema)||!e.schema.shape),n=md(e.schema);if(!e.schema||t||n)return new QU({...e,description:e.description??((a=e.schema)==null?void 0:a.description)??`${e.name} tool`,func:async(o,l,c)=>new Promise((u,d)=>{const h=Mt(c,{callbacks:l==null?void 0:l.getChild()});Rr.runWithConfig(Ns(h),async()=>{try{u(r(o,h))}catch(f){d(f)}})})});const s=e.schema,i=e.description??e.schema.description??`${e.name} tool`;return new e3({...e,description:i,schema:s,func:async(o,l,c)=>new Promise((u,d)=>{const h=Mt(c,{callbacks:l==null?void 0:l.getChild()});Rr.runWithConfig(Ns(h),async()=>{try{u(r(o,h))}catch(f){d(f)}})})})}function t3(r){const{content:e,artifact:t,toolCallId:n}=r;return n&&!Tj(e)?typeof e=="string"||Array.isArray(e)&&e.every(s=>typeof s=="object")?new zg({content:e,artifact:t,tool_call_id:n,name:r.name}):new zg({content:n3(e),artifact:t,tool_call_id:n,name:r.name}):e}function n3(r){try{return JSON.stringify(r,null,2)}catch{return`${r}`}}const Xi="0.37.0";let Ux=!1,ll,qA,sb,HA,WA,VA;function r3(r,e={auto:!1}){if(Ux)throw new Error(`you must \`import '@anthropic-ai/sdk/shims/${r.kind}'\` before importing anything else from @anthropic-ai/sdk`);if(ll)throw new Error(`can't \`import '@anthropic-ai/sdk/shims/${r.kind}'\` after \`import '@anthropic-ai/sdk/shims/${ll}'\``);Ux=e.auto,ll=r.kind,qA=r.fetch,sb=r.File,HA=r.ReadableStream,WA=r.getDefaultAgent,VA=r.fileFromPath}class s3{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function i3({manuallyImported:r}={}){const e=r?"You may need to use polyfills":"Add one of these imports before your first `import â¦ from '@anthropic-ai/sdk'`:\n- `import '@anthropic-ai/sdk/shims/node'` (if you're running on Node)\n- `import '@anthropic-ai/sdk/shims/web'` (otherwise)\n";let t,n,s,i;try{t=fetch,n=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new s3(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/anthropics/anthropic-sdk-typescript#file-uploads")},isFsReadStream:a=>!1}}ll||r3(i3(),{auto:!0});class De extends Error{}class Qt extends De{constructor(e,t,n,s){super(`${Qt.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["request-id"],this.error=t}static makeMessage(e,t,n){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e||!s)return new rf({message:n,cause:ib(t)});const i=t;return e===400?new ZA(e,i,n,s):e===401?new JA(e,i,n,s):e===403?new KA(e,i,n,s):e===404?new XA(e,i,n,s):e===409?new YA(e,i,n,s):e===422?new QA(e,i,n,s):e===429?new eE(e,i,n,s):e>=500?new tE(e,i,n,s):new Qt(e,i,n,s)}}class er extends Qt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class rf extends Qt{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class GA extends rf{constructor({message:e}={}){super({message:e??"Request timed out."})}}class ZA extends Qt{}class JA extends Qt{}class KA extends Qt{}class XA extends Qt{}class YA extends Qt{}class QA extends Qt{}class eE extends Qt{}class tE extends Qt{}var Ou=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Ys=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},kn;class Mc{constructor(){kn.set(this,void 0),this.buffer=new Uint8Array,Ou(this,kn,null,"f")}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e;let n=new Uint8Array(this.buffer.length+t.length);n.set(this.buffer),n.set(t,this.buffer.length),this.buffer=n;const s=[];let i;for(;(i=a3(this.buffer,Ys(this,kn,"f")))!=null;){if(i.carriage&&Ys(this,kn,"f")==null){Ou(this,kn,i.index,"f");continue}if(Ys(this,kn,"f")!=null&&(i.index!==Ys(this,kn,"f")+1||i.carriage)){s.push(this.decodeText(this.buffer.slice(0,Ys(this,kn,"f")-1))),this.buffer=this.buffer.slice(Ys(this,kn,"f")),Ou(this,kn,null,"f");continue}const a=Ys(this,kn,"f")!==null?i.preceding-1:i.preceding,o=this.decodeText(this.buffer.slice(0,a));s.push(o),this.buffer=this.buffer.slice(i.index),Ou(this,kn,null,"f")}return s}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new De(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new De(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new De("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}}kn=new WeakMap;Mc.NEWLINE_CHARS=new Set([`
`,"\r"]);Mc.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function a3(r,e){for(let s=e??0;s<r.length;s++){if(r[s]===10)return{preceding:s,index:s+1,carriage:!1};if(r[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function o3(r){for(let n=0;n<r.length-1;n++){if(r[n]===10&&r[n+1]===10||r[n]===13&&r[n+1]===13)return n+2;if(r[n]===13&&r[n+1]===10&&n+3<r.length&&r[n+2]===13&&r[n+3]===10)return n+4}return-1}function V_(r){if(r[Symbol.asyncIterator])return r;const e=r.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class Pr{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;async function*s(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(const a of l3(e,t)){if(a.event==="completion")try{yield JSON.parse(a.data)}catch(o){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),o}if(a.event==="message_start"||a.event==="message_delta"||a.event==="message_stop"||a.event==="content_block_start"||a.event==="content_block_delta"||a.event==="content_block_stop")try{yield JSON.parse(a.data)}catch(o){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),o}if(a.event!=="ping"&&a.event==="error")throw Qt.generate(void 0,`SSE Error: ${a.data}`,a.data,sE(e.headers))}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new Pr(s,t)}static fromReadableStream(e,t){let n=!1;async function*s(){const a=new Mc,o=V_(e);for await(const l of o)for(const c of a.decode(l))yield c;for(const l of a.flush())yield l}async function*i(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(const o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new Pr(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=n.next();e.push(a),t.push(a)}return i.shift()}});return[new Pr(()=>s(e),this.controller),new Pr(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new HA({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:a}=await t.next();if(a)return s.close();const o=n.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}}async function*l3(r,e){if(!r.body)throw e.abort(),new De("Attempted to iterate over a response with no body");const t=new u3,n=new Mc,s=V_(r.body);for await(const i of c3(s))for(const a of n.decode(i)){const o=t.decode(a);o&&(yield o)}for(const i of n.flush()){const a=t.decode(i);a&&(yield a)}}async function*c3(r){let e=new Uint8Array;for await(const t of r){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+n.length);s.set(e),s.set(n,e.length),e=s;let i;for(;(i=o3(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}class u3{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=d3(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}function d3(r,e){const t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}const h3=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function",f3=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&sf(r),sf=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function";async function p3(r,e,t){var s;if(r=await r,f3(r))return r;if(h3(r)){const i=await r.blob();e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=sf(i)?[await i.arrayBuffer()]:[i];return new sb(a,e,t)}const n=await m3(r);if(e||(e=b3(r)??"unknown_file"),!(t!=null&&t.type)){const i=(s=n[0])==null?void 0:s.type;typeof i=="string"&&(t={...t,type:i})}return new sb(n,e,t)}async function m3(r){var t;let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(sf(r))e.push(await r.arrayBuffer());else if(_3(r))for await(const n of r)e.push(n);else throw new Error(`Unexpected data type: ${typeof r}; constructor: ${(t=r==null?void 0:r.constructor)==null?void 0:t.name}; props: ${g3(r)}`);return e}function g3(r){return`[${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}function b3(r){var e;return Pm(r.name)||Pm(r.filename)||((e=Pm(r.path))==null?void 0:e.split(/[\\/]/).pop())}const Pm=r=>{if(typeof r=="string")return r;if(typeof Buffer<"u"&&r instanceof Buffer)return String(r)},_3=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",qx=r=>r&&typeof r=="object"&&r.body&&r[Symbol.toStringTag]==="MultipartBody";var ma={},y3=function(r,e,t,n,s){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t},w3=function(r,e,t,n){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Tu;async function nE(r){const{response:e}=r;if(r.options.stream)return ga("response",e.status,e.url,e.headers,e.body),r.options.__streamClass?r.options.__streamClass.fromSSEResponse(e,r.controller):Pr.fromSSEResponse(e,r.controller);if(e.status===204)return null;if(r.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const i=await e.json();return ga("response",e.status,e.url,e.headers,i),rE(i,e)}const s=await e.text();return ga("response",e.status,e.url,e.headers,s),s}function rE(r,e){return!r||typeof r!="object"||Array.isArray(r)?r:Object.defineProperty(r,"_request_id",{value:e.headers.get("request-id"),enumerable:!1})}class af extends Promise{constructor(e,t=nE){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new af(this.responsePromise,async t=>rE(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class v3{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=Am("maxRetries",t),this.timeout=Am("timeout",n),this.httpAgent=s,this.fetch=i??qA}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...E3(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${C3()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(async s=>{const i=s&&sf(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var p;e={...e};const{method:n,path:s,query:i,headers:a={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:qx(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,l=this.calculateContentLength(o),c=this.buildURL(s,i);"timeout"in e&&Am("timeout",e.timeout),e.timeout=e.timeout??this.timeout;const u=e.httpAgent??this.httpAgent??WA(c),d=e.timeout+1e3;typeof((p=u==null?void 0:u.options)==null?void 0:p.timeout)=="number"&&d>(u.options.timeout??0)&&(u.options.timeout=d),this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const h=this.buildHeaders({options:e,headers:a,contentLength:l,retryCount:t});return{req:{method:n,...o&&{body:o},headers:h,...u&&{agent:u},signal:e.signal??null},url:c,timeout:e.timeout}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:s}){const i={};n&&(i["content-length"]=n);const a=this.defaultHeaders(e);return Gx(i,a),Gx(i,t),qx(e.body)&&ll!=="node"&&delete i["content-type"],Ru(a,"x-stainless-retry-count")===void 0&&Ru(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),Ru(a,"x-stainless-timeout")===void 0&&Ru(t,"x-stainless-timeout")===void 0&&e.timeout&&(i["x-stainless-timeout"]=String(e.timeout)),this.validateHeaders(i,t),i}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new De("Streaming is strongly recommended for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-python#streaming-responses for more details");return 600*1e3}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,s){return Qt.generate(e,t,n,s)}request(e,t=null){return new af(this.makeRequest(e,t))}async makeRequest(e,t){var d,h;const n=await e,s=n.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(n);const{req:i,url:a,timeout:o}=this.buildRequest(n,{retryCount:s-t});if(await this.prepareRequest(i,{url:a,options:n}),ga("request",a,n,i.headers),(d=n.signal)!=null&&d.aborted)throw new er;const l=new AbortController,c=await this.fetchWithTimeout(a,i,o,l).catch(ib);if(c instanceof Error){if((h=n.signal)!=null&&h.aborted)throw new er;if(t)return this.retryRequest(n,t);throw c.name==="AbortError"?new GA:new rf({cause:c})}const u=sE(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){const _=`retrying, ${t} attempts remaining`;return ga(`response (error; ${_})`,c.status,a,u),this.retryRequest(n,t,u)}const f=await c.text().catch(_=>ib(_).message),p=O3(f),m=p?void 0:f;throw ga(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,a,u,m),this.makeStatusError(c.status,p,m,u)}return{response:c,options:n,controller:l}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new k3(this,n,e)}buildURL(e,t){const n=R3(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return Qd(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new De(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,s){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),n),l={signal:s.signal,...a};l.method&&(l.method=l.method.toUpperCase());const c=60*1e3,u=setTimeout(()=>{var d,h;if(l&&((d=l==null?void 0:l.agent)!=null&&d.sockets))for(const f of Object.values((h=l==null?void 0:l.agent)==null?void 0:h.sockets).flat())f!=null&&f.setKeepAlive&&f.setKeepAlive(!0,c)},c);return this.fetch.call(void 0,e,l).finally(()=>{clearTimeout(o),clearTimeout(u)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){let s;const i=n==null?void 0:n["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(s=o)}const a=n==null?void 0:n["retry-after"];if(a&&!s){const o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await I3(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Xi}`}}class x3{constructor(e,t,n,s){Tu.set(this,void 0),y3(this,Tu,e),this.options=s,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new De("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of n)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await w3(this,Tu,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Tu=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class k3 extends af{constructor(e,t,n){super(t,async s=>new n(e,s.response,await nE(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const sE=r=>new Proxy(Object.fromEntries(r.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),S3={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},ys=r=>typeof r=="object"&&r!==null&&!Qd(r)&&Object.keys(r).every(e=>iE(S3,e)),P3=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xi,"X-Stainless-OS":Wx(Deno.build.os),"X-Stainless-Arch":Hx(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xi,"X-Stainless-OS":Wx(process.platform),"X-Stainless-Arch":Hx(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const r=A3();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function A3(){if(typeof navigator>"u"||!navigator)return null;const r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of r){const n=t.exec(navigator.userAgent);if(n){const s=n[1]||0,i=n[2]||0,a=n[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const Hx=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",Wx=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown");let Vx;const E3=()=>Vx??(Vx=P3()),O3=r=>{try{return JSON.parse(r)}catch{return}},T3=/^[a-z][a-z0-9+.-]*:/i,R3=r=>T3.test(r),I3=r=>new Promise(e=>setTimeout(e,r)),Am=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new De(`${r} must be an integer`);if(e<0)throw new De(`${r} must be a positive integer`);return e},ib=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null)try{return new Error(JSON.stringify(r))}catch{}return new Error(String(r))},Em=r=>{var e,t,n,s;if(typeof process<"u")return((e=ma==null?void 0:ma[r])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(s=(n=(t=Deno.env)==null?void 0:t.get)==null?void 0:n.call(t,r))==null?void 0:s.trim()};function Qd(r){if(!r)return!0;for(const e in r)return!1;return!0}function iE(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function Gx(r,e){for(const t in e){if(!iE(e,t))continue;const n=t.toLowerCase();if(!n)continue;const s=e[t];s===null?delete r[n]:s!==void 0&&(r[n]=s)}}function ga(r,...e){typeof process<"u"&&(ma==null?void 0:ma.DEBUG)==="true"&&console.log(`Anthropic:DEBUG:${r}`,...e)}const C3=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)}),$3=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",M3=r=>typeof(r==null?void 0:r.get)=="function",Ru=(r,e)=>{var n;const t=e.toLowerCase();if(M3(r)){const s=((n=e[0])==null?void 0:n.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,a,o)=>a+o.toUpperCase());for(const i of[e,t,e.toUpperCase(),s]){const a=r.get(i);if(a)return a}}for(const[s,i]of Object.entries(r))if(s.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i};class of extends x3{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.has_more=n.has_more||!1,this.first_id=n.first_id||null,this.last_id=n.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var t;if((t=this.options.query)!=null&&t.before_id){const n=this.first_id;return n?{params:{before_id:n}}:null}const e=this.last_id;return e?{params:{after_id:e}}:null}}class Bs{constructor(e){this._client=e}}let G_=class extends Bs{retrieve(e,t){return this._client.get(`/v1/models/${e}?beta=true`,t)}list(e={},t){return ys(e)?this.list({},e):this._client.getAPIList("/v1/models?beta=true",Z_,{query:e,...t})}};class Z_ extends of{}G_.BetaModelInfosPage=Z_;class lf{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){const e=new Mc;for await(const t of this.iterator)for(const n of e.decode(t))yield JSON.parse(n);for(const t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body)throw t.abort(),new De("Attempted to iterate over a response with no body");return new lf(V_(e.body),t)}}let J_=class extends Bs{create(e,t){const{betas:n,...s}=e;return this._client.post("/v1/messages/batches?beta=true",{body:s,...t,headers:{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString(),...t==null?void 0:t.headers}})}retrieve(e,t={},n){if(ys(t))return this.retrieve(e,{},t);const{betas:s}=t;return this._client.get(`/v1/messages/batches/${e}?beta=true`,{...n,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...n==null?void 0:n.headers}})}list(e={},t){if(ys(e))return this.list({},e);const{betas:n,...s}=e;return this._client.getAPIList("/v1/messages/batches?beta=true",K_,{query:s,...t,headers:{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString(),...t==null?void 0:t.headers}})}delete(e,t={},n){if(ys(t))return this.delete(e,{},t);const{betas:s}=t;return this._client.delete(`/v1/messages/batches/${e}?beta=true`,{...n,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...n==null?void 0:n.headers}})}cancel(e,t={},n){if(ys(t))return this.cancel(e,{},t);const{betas:s}=t;return this._client.post(`/v1/messages/batches/${e}/cancel?beta=true`,{...n,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...n==null?void 0:n.headers}})}async results(e,t={},n){if(ys(t))return this.results(e,{},t);const s=await this.retrieve(e);if(!s.results_url)throw new De(`No batch \`results_url\`; Has it finished processing? ${s.processing_status} - ${s.id}`);const{betas:i}=t;return this._client.get(s.results_url,{...n,headers:{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary",...n==null?void 0:n.headers},__binaryResponse:!0})._thenUnwrap((a,o)=>lf.fromResponse(o.response,o.controller))}};class K_ extends of{}J_.BetaMessageBatchesPage=K_;const N3=r=>{let e=0,t=[];for(;e<r.length;){let n=r[e];if(n==="\\"){e++;continue}if(n==="{"){t.push({type:"brace",value:"{"}),e++;continue}if(n==="}"){t.push({type:"brace",value:"}"}),e++;continue}if(n==="["){t.push({type:"paren",value:"["}),e++;continue}if(n==="]"){t.push({type:"paren",value:"]"}),e++;continue}if(n===":"){t.push({type:"separator",value:":"}),e++;continue}if(n===","){t.push({type:"delimiter",value:","}),e++;continue}if(n==='"'){let o="",l=!1;for(n=r[++e];n!=='"';){if(e===r.length){l=!0;break}if(n==="\\"){if(e++,e===r.length){l=!0;break}o+=n+r[e],n=r[++e]}else o+=n,n=r[++e]}n=r[++e],l||t.push({type:"string",value:o});continue}if(n&&/\s/.test(n)){e++;continue}let i=/[0-9]/;if(n&&i.test(n)||n==="-"||n==="."){let o="";for(n==="-"&&(o+=n,n=r[++e]);n&&i.test(n)||n===".";)o+=n,n=r[++e];t.push({type:"number",value:o});continue}let a=/[a-z]/i;if(n&&a.test(n)){let o="";for(;n&&a.test(n)&&e!==r.length;)o+=n,n=r[++e];if(o=="true"||o=="false"||o==="null")t.push({type:"name",value:o});else{e++;continue}continue}e++}return t},Yi=r=>{if(r.length===0)return r;let e=r[r.length-1];switch(e.type){case"separator":return r=r.slice(0,r.length-1),Yi(r);case"number":let t=e.value[e.value.length-1];if(t==="."||t==="-")return r=r.slice(0,r.length-1),Yi(r);case"string":let n=r[r.length-2];if((n==null?void 0:n.type)==="delimiter")return r=r.slice(0,r.length-1),Yi(r);if((n==null?void 0:n.type)==="brace"&&n.value==="{")return r=r.slice(0,r.length-1),Yi(r);break;case"delimiter":return r=r.slice(0,r.length-1),Yi(r)}return r},L3=r=>{let e=[];return r.map(t=>{t.type==="brace"&&(t.value==="{"?e.push("}"):e.splice(e.lastIndexOf("}"),1)),t.type==="paren"&&(t.value==="["?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(t=>{t==="}"?r.push({type:"brace",value:"}"}):t==="]"&&r.push({type:"paren",value:"]"})}),r},j3=r=>{let e="";return r.map(t=>{switch(t.type){case"string":e+='"'+t.value+'"';break;default:e+=t.value;break}}),e},aE=r=>JSON.parse(j3(L3(Yi(N3(r)))));var Wt=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Ce=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Mn,fs,_o,Iu,yo,wo,Cu,vo,Lr,xo,$u,Mu,Hi,Nu,Lu,Om,Zx,Tm,Rm,Im,Cm,Jx;const Kx="__json_buf";class eh{constructor(){Mn.add(this),this.messages=[],this.receivedMessages=[],fs.set(this,void 0),this.controller=new AbortController,_o.set(this,void 0),Iu.set(this,()=>{}),yo.set(this,()=>{}),wo.set(this,void 0),Cu.set(this,()=>{}),vo.set(this,()=>{}),Lr.set(this,{}),xo.set(this,!1),$u.set(this,!1),Mu.set(this,!1),Hi.set(this,!1),Nu.set(this,void 0),Lu.set(this,void 0),Tm.set(this,e=>{if(Wt(this,$u,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new er),e instanceof er)return Wt(this,Mu,!0,"f"),this._emit("abort",e);if(e instanceof De)return this._emit("error",e);if(e instanceof Error){const t=new De(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new De(String(e)))}),Wt(this,_o,new Promise((e,t)=>{Wt(this,Iu,e,"f"),Wt(this,yo,t,"f")}),"f"),Wt(this,wo,new Promise((e,t)=>{Wt(this,Cu,e,"f"),Wt(this,vo,t,"f")}),"f"),Ce(this,_o,"f").catch(()=>{}),Ce(this,wo,"f").catch(()=>{})}get response(){return Ce(this,Nu,"f")}get request_id(){return Ce(this,Lu,"f")}async withResponse(){const e=await Ce(this,_o,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new eh;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,n){const s=new eh;for(const i of t.messages)s._addMessageParam(i);return s._run(()=>s._createMessage(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},Ce(this,Tm,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,n){var o;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Ce(this,Mn,"m",Rm).call(this);const{response:i,data:a}=await e.create({...t,stream:!0},{...n,signal:this.controller.signal}).withResponse();this._connected(i);for await(const l of a)Ce(this,Mn,"m",Im).call(this,l);if((o=a.controller.signal)!=null&&o.aborted)throw new er;Ce(this,Mn,"m",Cm).call(this)}_connected(e){this.ended||(Wt(this,Nu,e,"f"),Wt(this,Lu,e==null?void 0:e.headers.get("request-id"),"f"),Ce(this,Iu,"f").call(this,e),this._emit("connect"))}get ended(){return Ce(this,xo,"f")}get errored(){return Ce(this,$u,"f")}get aborted(){return Ce(this,Mu,"f")}abort(){this.controller.abort()}on(e,t){return(Ce(this,Lr,"f")[e]||(Ce(this,Lr,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=Ce(this,Lr,"f")[e];if(!n)return this;const s=n.findIndex(i=>i.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(Ce(this,Lr,"f")[e]||(Ce(this,Lr,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{Wt(this,Hi,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){Wt(this,Hi,!0,"f"),await Ce(this,wo,"f")}get currentMessage(){return Ce(this,fs,"f")}async finalMessage(){return await this.done(),Ce(this,Mn,"m",Om).call(this)}async finalText(){return await this.done(),Ce(this,Mn,"m",Zx).call(this)}_emit(e,...t){if(Ce(this,xo,"f"))return;e==="end"&&(Wt(this,xo,!0,"f"),Ce(this,Cu,"f").call(this));const n=Ce(this,Lr,"f")[e];if(n&&(Ce(this,Lr,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!Ce(this,Hi,"f")&&!(n!=null&&n.length)&&Promise.reject(s),Ce(this,yo,"f").call(this,s),Ce(this,vo,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!Ce(this,Hi,"f")&&!(n!=null&&n.length)&&Promise.reject(s),Ce(this,yo,"f").call(this,s),Ce(this,vo,"f").call(this,s),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",Ce(this,Mn,"m",Om).call(this))}async _fromReadableStream(e,t){var i;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),Ce(this,Mn,"m",Rm).call(this),this._connected(null);const s=Pr.fromReadableStream(e,this.controller);for await(const a of s)Ce(this,Mn,"m",Im).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new er;Ce(this,Mn,"m",Cm).call(this)}[(fs=new WeakMap,_o=new WeakMap,Iu=new WeakMap,yo=new WeakMap,wo=new WeakMap,Cu=new WeakMap,vo=new WeakMap,Lr=new WeakMap,xo=new WeakMap,$u=new WeakMap,Mu=new WeakMap,Hi=new WeakMap,Nu=new WeakMap,Lu=new WeakMap,Tm=new WeakMap,Mn=new WeakSet,Om=function(){if(this.receivedMessages.length===0)throw new De("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},Zx=function(){if(this.receivedMessages.length===0)throw new De("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(n=>n.type==="text").map(n=>n.text);if(t.length===0)throw new De("stream ended without producing a content block with type=text");return t.join(" ")},Rm=function(){this.ended||Wt(this,fs,void 0,"f")},Im=function(t){if(this.ended)return;const n=Ce(this,Mn,"m",Jx).call(this,t);switch(this._emit("streamEvent",t,n),t.type){case"content_block_delta":{const s=n.content.at(-1);switch(t.delta.type){case"text_delta":{s.type==="text"&&this._emit("text",t.delta.text,s.text||"");break}case"citations_delta":{s.type==="text"&&this._emit("citation",t.delta.citation,s.citations??[]);break}case"input_json_delta":{s.type==="tool_use"&&s.input&&this._emit("inputJson",t.delta.partial_json,s.input);break}case"thinking_delta":{s.type==="thinking"&&this._emit("thinking",t.delta.thinking,s.thinking);break}case"signature_delta":{s.type==="thinking"&&this._emit("signature",s.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(n),this._addMessage(n,!0);break}case"content_block_stop":{this._emit("contentBlock",n.content.at(-1));break}case"message_start":{Wt(this,fs,n,"f");break}}},Cm=function(){if(this.ended)throw new De("stream has ended, this shouldn't happen");const t=Ce(this,fs,"f");if(!t)throw new De("request ended without sending any chunks");return Wt(this,fs,void 0,"f"),t},Jx=function(t){let n=Ce(this,fs,"f");if(t.type==="message_start"){if(n)throw new De(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!n)throw new De(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return n;case"message_delta":return n.stop_reason=t.delta.stop_reason,n.stop_sequence=t.delta.stop_sequence,n.usage.output_tokens=t.usage.output_tokens,n;case"content_block_start":return n.content.push(t.content_block),n;case"content_block_delta":{const s=n.content.at(t.index);switch(t.delta.type){case"text_delta":{(s==null?void 0:s.type)==="text"&&(s.text+=t.delta.text);break}case"citations_delta":{(s==null?void 0:s.type)==="text"&&(s.citations??(s.citations=[]),s.citations.push(t.delta.citation));break}case"input_json_delta":{if((s==null?void 0:s.type)==="tool_use"){let i=s[Kx]||"";i+=t.delta.partial_json,Object.defineProperty(s,Kx,{value:i,enumerable:!1,writable:!0}),i&&(s.input=aE(i))}break}case"thinking_delta":{(s==null?void 0:s.type)==="thinking"&&(s.thinking+=t.delta.thinking);break}case"signature_delta":{(s==null?void 0:s.type)==="thinking"&&(s.signature=t.delta.signature);break}default:t.delta}return n}case"content_block_stop":return n}},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("streamEvent",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Pr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}const Xx={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"};let cf=class extends Bs{constructor(){super(...arguments),this.batches=new J_(this._client)}create(e,t){const{betas:n,...s}=e;return s.model in Xx&&console.warn(`The model '${s.model}' is deprecated and will reach end-of-life on ${Xx[s.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`),this._client.post("/v1/messages?beta=true",{body:s,timeout:this._client._options.timeout??(s.stream?6e5:this._client._calculateNonstreamingTimeout(s.max_tokens)),...t,headers:{...(n==null?void 0:n.toString())!=null?{"anthropic-beta":n==null?void 0:n.toString()}:void 0,...t==null?void 0:t.headers},stream:e.stream??!1})}stream(e,t){return eh.createMessage(this,e,t)}countTokens(e,t){const{betas:n,...s}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:s,...t,headers:{"anthropic-beta":[...n??[],"token-counting-2024-11-01"].toString(),...t==null?void 0:t.headers}})}};cf.Batches=J_;cf.BetaMessageBatchesPage=K_;class Nc extends Bs{constructor(){super(...arguments),this.models=new G_(this._client),this.messages=new cf(this._client)}}Nc.Models=G_;Nc.BetaModelInfosPage=Z_;Nc.Messages=cf;class oE extends Bs{create(e,t){return this._client.post("/v1/complete",{body:e,timeout:this._client._options.timeout??6e5,...t,stream:e.stream??!1})}}class X_ extends Bs{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/v1/messages/batches/${e}`,t)}list(e={},t){return ys(e)?this.list({},e):this._client.getAPIList("/v1/messages/batches",Y_,{query:e,...t})}delete(e,t){return this._client.delete(`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post(`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){const n=await this.retrieve(e);if(!n.results_url)throw new De(`No batch \`results_url\`; Has it finished processing? ${n.processing_status} - ${n.id}`);return this._client.get(n.results_url,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})._thenUnwrap((s,i)=>lf.fromResponse(i.response,i.controller))}}class Y_ extends of{}X_.MessageBatchesPage=Y_;var Vt=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},$e=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Nn,ps,ko,ju,So,Po,Du,Ao,jr,Eo,Fu,zu,Wi,Bu,Uu,$m,Yx,Mm,Nm,Lm,jm,Qx;const ek="__json_buf";class th{constructor(){Nn.add(this),this.messages=[],this.receivedMessages=[],ps.set(this,void 0),this.controller=new AbortController,ko.set(this,void 0),ju.set(this,()=>{}),So.set(this,()=>{}),Po.set(this,void 0),Du.set(this,()=>{}),Ao.set(this,()=>{}),jr.set(this,{}),Eo.set(this,!1),Fu.set(this,!1),zu.set(this,!1),Wi.set(this,!1),Bu.set(this,void 0),Uu.set(this,void 0),Mm.set(this,e=>{if(Vt(this,Fu,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new er),e instanceof er)return Vt(this,zu,!0,"f"),this._emit("abort",e);if(e instanceof De)return this._emit("error",e);if(e instanceof Error){const t=new De(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new De(String(e)))}),Vt(this,ko,new Promise((e,t)=>{Vt(this,ju,e,"f"),Vt(this,So,t,"f")}),"f"),Vt(this,Po,new Promise((e,t)=>{Vt(this,Du,e,"f"),Vt(this,Ao,t,"f")}),"f"),$e(this,ko,"f").catch(()=>{}),$e(this,Po,"f").catch(()=>{})}get response(){return $e(this,Bu,"f")}get request_id(){return $e(this,Uu,"f")}async withResponse(){const e=await $e(this,ko,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new th;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,n){const s=new th;for(const i of t.messages)s._addMessageParam(i);return s._run(()=>s._createMessage(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},$e(this,Mm,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,n){var o;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),$e(this,Nn,"m",Nm).call(this);const{response:i,data:a}=await e.create({...t,stream:!0},{...n,signal:this.controller.signal}).withResponse();this._connected(i);for await(const l of a)$e(this,Nn,"m",Lm).call(this,l);if((o=a.controller.signal)!=null&&o.aborted)throw new er;$e(this,Nn,"m",jm).call(this)}_connected(e){this.ended||(Vt(this,Bu,e,"f"),Vt(this,Uu,e==null?void 0:e.headers.get("request-id"),"f"),$e(this,ju,"f").call(this,e),this._emit("connect"))}get ended(){return $e(this,Eo,"f")}get errored(){return $e(this,Fu,"f")}get aborted(){return $e(this,zu,"f")}abort(){this.controller.abort()}on(e,t){return($e(this,jr,"f")[e]||($e(this,jr,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=$e(this,jr,"f")[e];if(!n)return this;const s=n.findIndex(i=>i.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return($e(this,jr,"f")[e]||($e(this,jr,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{Vt(this,Wi,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){Vt(this,Wi,!0,"f"),await $e(this,Po,"f")}get currentMessage(){return $e(this,ps,"f")}async finalMessage(){return await this.done(),$e(this,Nn,"m",$m).call(this)}async finalText(){return await this.done(),$e(this,Nn,"m",Yx).call(this)}_emit(e,...t){if($e(this,Eo,"f"))return;e==="end"&&(Vt(this,Eo,!0,"f"),$e(this,Du,"f").call(this));const n=$e(this,jr,"f")[e];if(n&&($e(this,jr,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!$e(this,Wi,"f")&&!(n!=null&&n.length)&&Promise.reject(s),$e(this,So,"f").call(this,s),$e(this,Ao,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!$e(this,Wi,"f")&&!(n!=null&&n.length)&&Promise.reject(s),$e(this,So,"f").call(this,s),$e(this,Ao,"f").call(this,s),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",$e(this,Nn,"m",$m).call(this))}async _fromReadableStream(e,t){var i;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),$e(this,Nn,"m",Nm).call(this),this._connected(null);const s=Pr.fromReadableStream(e,this.controller);for await(const a of s)$e(this,Nn,"m",Lm).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new er;$e(this,Nn,"m",jm).call(this)}[(ps=new WeakMap,ko=new WeakMap,ju=new WeakMap,So=new WeakMap,Po=new WeakMap,Du=new WeakMap,Ao=new WeakMap,jr=new WeakMap,Eo=new WeakMap,Fu=new WeakMap,zu=new WeakMap,Wi=new WeakMap,Bu=new WeakMap,Uu=new WeakMap,Mm=new WeakMap,Nn=new WeakSet,$m=function(){if(this.receivedMessages.length===0)throw new De("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},Yx=function(){if(this.receivedMessages.length===0)throw new De("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(n=>n.type==="text").map(n=>n.text);if(t.length===0)throw new De("stream ended without producing a content block with type=text");return t.join(" ")},Nm=function(){this.ended||Vt(this,ps,void 0,"f")},Lm=function(t){if(this.ended)return;const n=$e(this,Nn,"m",Qx).call(this,t);switch(this._emit("streamEvent",t,n),t.type){case"content_block_delta":{const s=n.content.at(-1);switch(t.delta.type){case"text_delta":{s.type==="text"&&this._emit("text",t.delta.text,s.text||"");break}case"citations_delta":{s.type==="text"&&this._emit("citation",t.delta.citation,s.citations??[]);break}case"input_json_delta":{s.type==="tool_use"&&s.input&&this._emit("inputJson",t.delta.partial_json,s.input);break}case"thinking_delta":{s.type==="thinking"&&this._emit("thinking",t.delta.thinking,s.thinking);break}case"signature_delta":{s.type==="thinking"&&this._emit("signature",s.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(n),this._addMessage(n,!0);break}case"content_block_stop":{this._emit("contentBlock",n.content.at(-1));break}case"message_start":{Vt(this,ps,n,"f");break}}},jm=function(){if(this.ended)throw new De("stream has ended, this shouldn't happen");const t=$e(this,ps,"f");if(!t)throw new De("request ended without sending any chunks");return Vt(this,ps,void 0,"f"),t},Qx=function(t){let n=$e(this,ps,"f");if(t.type==="message_start"){if(n)throw new De(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!n)throw new De(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return n;case"message_delta":return n.stop_reason=t.delta.stop_reason,n.stop_sequence=t.delta.stop_sequence,n.usage.output_tokens=t.usage.output_tokens,n;case"content_block_start":return n.content.push(t.content_block),n;case"content_block_delta":{const s=n.content.at(t.index);switch(t.delta.type){case"text_delta":{(s==null?void 0:s.type)==="text"&&(s.text+=t.delta.text);break}case"citations_delta":{(s==null?void 0:s.type)==="text"&&(s.citations??(s.citations=[]),s.citations.push(t.delta.citation));break}case"input_json_delta":{if((s==null?void 0:s.type)==="tool_use"){let i=s[ek]||"";i+=t.delta.partial_json,Object.defineProperty(s,ek,{value:i,enumerable:!1,writable:!0}),i&&(s.input=aE(i))}break}case"thinking_delta":{(s==null?void 0:s.type)==="thinking"&&(s.thinking+=t.delta.thinking);break}case"signature_delta":{(s==null?void 0:s.type)==="thinking"&&(s.signature=t.delta.signature);break}default:t.delta}return n}case"content_block_stop":return n}},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("streamEvent",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Pr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class uf extends Bs{constructor(){super(...arguments),this.batches=new X_(this._client)}create(e,t){return e.model in tk&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${tk[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`),this._client.post("/v1/messages",{body:e,timeout:this._client._options.timeout??(e.stream?6e5:this._client._calculateNonstreamingTimeout(e.max_tokens)),...t,stream:e.stream??!1})}stream(e,t){return th.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}}const tk={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"};uf.Batches=X_;uf.MessageBatchesPage=Y_;class Q_ extends Bs{retrieve(e,t){return this._client.get(`/v1/models/${e}`,t)}list(e={},t){return ys(e)?this.list({},e):this._client.getAPIList("/v1/models",ey,{query:e,...t})}}class ey extends of{}Q_.ModelInfosPage=ey;var lE;class tt extends v3{constructor({baseURL:e=Em("ANTHROPIC_BASE_URL"),apiKey:t=Em("ANTHROPIC_API_KEY")??null,authToken:n=Em("ANTHROPIC_AUTH_TOKEN")??null,...s}={}){const i={apiKey:t,authToken:n,...s,baseURL:e||"https://api.anthropic.com"};if(!i.dangerouslyAllowBrowser&&$3())throw new De(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new oE(this),this.messages=new uf(this),this.models=new Q_(this),this.beta=new Nc(this),this._options=i,this.apiKey=t,this.authToken=n}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01",...this._options.defaultHeaders}}validateHeaders(e,t){if(!(this.apiKey&&e["x-api-key"])&&t["x-api-key"]!==null&&!(this.authToken&&e.authorization)&&t.authorization!==null)throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}authHeaders(e){const t=this.apiKeyAuth(e),n=this.bearerAuth(e);return t!=null&&!Qd(t)?t:n!=null&&!Qd(n)?n:{}}apiKeyAuth(e){return this.apiKey==null?{}:{"X-Api-Key":this.apiKey}}bearerAuth(e){return this.authToken==null?{}:{Authorization:`Bearer ${this.authToken}`}}}lE=tt;tt.Anthropic=lE;tt.HUMAN_PROMPT=`

Human:`;tt.AI_PROMPT=`

Assistant:`;tt.DEFAULT_TIMEOUT=6e5;tt.AnthropicError=De;tt.APIError=Qt;tt.APIConnectionError=rf;tt.APIConnectionTimeoutError=GA;tt.APIUserAbortError=er;tt.NotFoundError=XA;tt.ConflictError=YA;tt.RateLimitError=eE;tt.BadRequestError=ZA;tt.AuthenticationError=JA;tt.InternalServerError=tE;tt.PermissionDeniedError=KA;tt.UnprocessableEntityError=QA;tt.toFile=p3;tt.fileFromPath=VA;tt.Completions=oE;tt.Messages=uf;tt.Models=Q_;tt.ModelInfosPage=ey;tt.Beta=Nc;const{HUMAN_PROMPT:uH,AI_PROMPT:dH}=tt;class nk extends EA{static lc_name(){return"AnthropicToolsOutputParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","anthropic","output_parsers"]}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){let t=e;if(typeof e=="string")try{t=JSON.parse(e)}catch(s){throw new ql(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(s.message)}`,e)}else t=e;if(this.zodSchema===void 0)return t;const n=await this.zodSchema.safeParseAsync(t);if(n.success)return n.data;throw new ql(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(n.error.errors)}`,JSON.stringify(t,null,2))}async parseResult(e){const t=e.flatMap(i=>{const{message:a}=i;return Array.isArray(a.content)?cE(a.content)[0]:[]});if(t[0]===void 0)throw new Error("No parseable tool calls provided to AnthropicToolsOutputParser.");const[n]=t;return await this._validateResult(n.args)}}function cE(r){const e=[];for(const t of r)t.type==="tool_use"&&e.push({name:t.name,args:t.input,id:t.id,type:"tool_call"});return e}function D3(r){if(r)return r==="any"?{type:"any"}:r==="auto"?{type:"auto"}:typeof r=="string"?{type:"tool",name:r}:r}function rk(r){const e=/^data:(image\/.+);base64,(.+)$/,t=r.match(e);if(t===null)throw new Error(["Anthropic only supports base64-encoded images currently.","Example: data:image/png;base64,/9j/4AAQSk..."].join(`

`));return{type:"base64",media_type:t[1]??"",data:t[2]??""}}function F3(r){const e=[];for(const t of r)if(t._getType()==="tool")if(typeof t.content=="string"){const n=e[e.length-1];(n==null?void 0:n._getType())==="human"&&Array.isArray(n.content)&&"type"in n.content[0]&&n.content[0].type==="tool_result"?n.content.push({type:"tool_result",content:t.content,tool_use_id:t.tool_call_id}):e.push(new _i({content:[{type:"tool_result",content:t.content,tool_use_id:t.tool_call_id}]}))}else e.push(new _i({content:[{type:"tool_result",content:ab(t.content),tool_use_id:t.tool_call_id}]}));else e.push(t);return e}function sk(r){if(r.id===void 0)throw new Error('Anthropic requires all tool calls to have an "id".');return{type:"tool_use",id:r.id,name:r.name,input:r.args}}function ab(r){const e=["tool_use","tool_result","input_json_delta"],t=["text","text_delta"];return typeof r=="string"?r:r.map(s=>{const i="cache_control"in s?s.cache_control:void 0;if(s.type==="image_url"){let a;return typeof s.image_url=="string"?a=rk(s.image_url):a=rk(s.image_url.url),{type:"image",source:a,...i?{cache_control:i}:{}}}else{if(s.type==="document")return{...s,...i?{cache_control:i}:{}};if(s.type==="thinking")return{type:"thinking",thinking:s.thinking,signature:s.signature,...i?{cache_control:i}:{}};if(s.type==="redacted_thinking")return{type:"redacted_thinking",data:s.data,...i?{cache_control:i}:{}};if(t.find(a=>a===s.type)&&"text"in s)return{type:"text",text:s.text,...i?{cache_control:i}:{}};if(e.find(a=>a===s.type)){const a={...s};if("index"in a&&delete a.index,a.type==="input_json_delta"&&(a.type="tool_use"),"input"in a&&typeof a.input=="string")try{a.input=JSON.parse(a.input)}catch{a.input={}}return{...a,...i?{cache_control:i}:{}}}else throw new Error("Unsupported message content format")}})}function ik(r){const e=F3(r);let t;e.length>0&&e[0]._getType()==="system"&&(t=r[0].content);const s=(t!==void 0?e.slice(1):e).map(i=>{var o;let a;if(i._getType()==="human")a="user";else if(i._getType()==="ai")a="assistant";else if(i._getType()==="tool")a="user";else throw i._getType()==="system"?new Error("System messages are only permitted as the first passed message."):new Error(`Message type "${i._getType()}" is not supported.`);if(rs(i)&&((o=i.tool_calls)!=null&&o.length)){if(typeof i.content=="string")return i.content===""?{role:a,content:i.tool_calls.map(sk)}:{role:a,content:[{type:"text",text:i.content},...i.tool_calls.map(sk)]};{const{content:l}=i;return!i.tool_calls.every(u=>l.find(d=>(d.type==="tool_use"||d.type==="input_json_delta")&&d.id===u.id))&&console.warn('The "tool_calls" field on a message is only respected if content is a string.'),{role:a,content:ab(i.content)}}}else return{role:a,content:ab(i.content)}});return{messages:z3(s),system:t}}function z3(r){if(!r||r.length<=1)return r;const e=[];let t=r[0];const n=i=>typeof i=="string"?[{type:"text",text:i}]:i,s=i=>i.role!=="user"||typeof i.content=="string"?!1:Array.isArray(i.content)&&i.content.every(a=>a.type==="tool_result");for(let i=1;i<r.length;i+=1){const a=r[i];s(t)&&s(a)?t={...t,content:[...n(t.content),...n(a.content)]}:(e.push(t),t=a)}return e.push(t),e}function B3(r,e){var t;if(r.type==="message_start"){const{content:n,usage:s,...i}=r.message,a={};for(const[d,h]of Object.entries(i))h!=null&&(a[d]=h);const{input_tokens:o,output_tokens:l,...c}=s??{},u={input_tokens:o,output_tokens:l,total_tokens:o+l,input_token_details:{cache_creation:c.cache_creation_input_tokens,cache_read:c.cache_read_input_tokens}};return{chunk:new mt({content:e.coerceContentToString?"":[],additional_kwargs:a,usage_metadata:e.streamUsage?u:void 0,response_metadata:{usage:{...c}},id:r.message.id})}}else if(r.type==="message_delta"){const n={input_tokens:0,output_tokens:r.usage.output_tokens,total_tokens:r.usage.output_tokens,input_token_details:{cache_creation:r.usage.cache_creation_input_tokens,cache_read:r.usage.cache_read_input_tokens}};return{chunk:new mt({content:e.coerceContentToString?"":[],additional_kwargs:{...r.delta},usage_metadata:e.streamUsage?n:void 0})}}else if(r.type==="content_block_start"&&["tool_use","document"].includes(r.content_block.type)){const n=r.content_block;let s;return n.type==="tool_use"?s=[{id:n.id,index:r.index,name:n.name,args:""}]:s=[],{chunk:new mt({content:e.coerceContentToString?"":[{index:r.index,...r.content_block,input:""}],additional_kwargs:{},tool_call_chunks:s})}}else if(r.type==="content_block_delta"&&["text_delta","citations_delta","thinking_delta","signature_delta"].includes(r.delta.type)){if(e.coerceContentToString&&"text"in r.delta)return{chunk:new mt({content:r.delta.text})};{const n=r.delta;return"citation"in n&&(n.citations=[n.citation],delete n.citation),n.type==="thinking_delta"||n.type==="signature_delta"?{chunk:new mt({content:[{index:r.index,...n,type:"thinking"}]})}:{chunk:new mt({content:[{index:r.index,...n,type:"text"}]})}}}else{if(r.type==="content_block_delta"&&r.delta.type==="input_json_delta")return{chunk:new mt({content:e.coerceContentToString?"":[{index:r.index,input:r.delta.partial_json,type:r.delta.type}],additional_kwargs:{},tool_call_chunks:[{index:r.index,args:r.delta.partial_json}]})};if(r.type==="content_block_start"&&r.content_block.type==="text"){const n=(t=r.content_block)==null?void 0:t.text;if(n!==void 0)return{chunk:new mt({content:e.coerceContentToString?n:[{index:r.index,...r.content_block}],additional_kwargs:{}})}}else{if(r.type==="content_block_start"&&r.content_block.type==="redacted_thinking")return{chunk:new mt({content:e.coerceContentToString?"":[{index:r.index,...r.content_block}]})};if(r.type==="content_block_start"&&r.content_block.type==="thinking"){const n=r.content_block.thinking;return{chunk:new mt({content:e.coerceContentToString?n:[{index:r.index,...r.content_block}]})}}}}return null}function U3(r,e){const t=e.usage,n=t!=null?{input_tokens:t.input_tokens??0,output_tokens:t.output_tokens??0,total_tokens:(t.input_tokens??0)+(t.output_tokens??0),input_token_details:{cache_creation:t.cache_creation_input_tokens,cache_read:t.cache_read_input_tokens}}:void 0;if(r.length===1&&r[0].type==="text")return[{text:r[0].text,message:new ar({content:r[0].text,additional_kwargs:e,usage_metadata:n,response_metadata:e,id:e.id})}];{const s=cE(r);return[{text:"",message:new ar({content:r,additional_kwargs:e,tool_calls:s,usage_metadata:n,response_metadata:e,id:e.id})}]}}function qu(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function ak(r){let e;return r.status===400&&r.message.includes("tool")?e=qu(r,"INVALID_TOOL_RESULTS"):r.status===401?e=qu(r,"MODEL_AUTHENTICATION"):r.status===404?e=qu(r,"MODEL_NOT_FOUND"):r.status===429?e=qu(r,"MODEL_RATE_LIMIT"):e=r,e}function q3(r){return!!(r.tools&&r.tools.length>0)}function H3(r){for(const e of r.messages??[])if(typeof e.content!="string"){for(const t of e.content??[])if(typeof t=="object"&&t!=null&&t.type==="document"&&typeof t.citations=="object"&&t.citations.enabled)return!0}return!1}function W3(r){return!!(r.thinking&&r.thinking.type==="enabled")}function V3(r){return"input_schema"in r}function G3(r){if(typeof r.content=="string")return r.content;if(Array.isArray(r.content)&&r.content.length>=1&&"input"in r.content[0])return typeof r.content[0].input=="string"?r.content[0].input:JSON.stringify(r.content[0].input);if(Array.isArray(r.content)&&r.content.length>=1&&"text"in r.content[0])return r.content[0].text}class Z3 extends xr{static lc_name(){return"ChatAnthropic"}get lc_secrets(){return{anthropicApiKey:"ANTHROPIC_API_KEY",apiKey:"ANTHROPIC_API_KEY"}}get lc_aliases(){return{modelName:"model"}}constructor(e){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"anthropicApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:2048}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"claude-2.1"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"claude-2.1"}),Object.defineProperty(this,"invocationKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"clientOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"thinking",{enumerable:!0,configurable:!0,writable:!0,value:{type:"disabled"}}),Object.defineProperty(this,"batchClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamingClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"createClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.anthropicApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.anthropicApiKey)??_n("ANTHROPIC_API_KEY"),!this.anthropicApiKey&&!(e!=null&&e.createClient))throw new Error("Anthropic API key not found");this.clientOptions=(e==null?void 0:e.clientOptions)??{},this.apiKey=this.anthropicApiKey,this.apiUrl=e==null?void 0:e.anthropicApiUrl,this.modelName=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.model=this.modelName,this.invocationKwargs=(e==null?void 0:e.invocationKwargs)??{},this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topK=(e==null?void 0:e.topK)??this.topK,this.topP=(e==null?void 0:e.topP)??this.topP,this.maxTokens=(e==null?void 0:e.maxTokensToSample)??(e==null?void 0:e.maxTokens)??this.maxTokens,this.stopSequences=(e==null?void 0:e.stopSequences)??this.stopSequences,this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.thinking=(e==null?void 0:e.thinking)??this.thinking,this.createClient=(e==null?void 0:e.createClient)??(t=>new tt(t))}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"anthropic",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}formatStructuredToolToAnthropic(e){if(!(!e||!e.length))return e.map(t=>{if(V3(t))return t;if(Cc(t))return{name:t.function.name,description:t.function.description,input_schema:t.function.parameters};if(nf(t))return{name:t.name,description:t.description,input_schema:ki(t.schema)?js(t.schema):t.schema};throw new Error(`Unknown tool type passed to ChatAnthropic: ${JSON.stringify(t,null,2)}`)})}bindTools(e,t){return this.bind({tools:this.formatStructuredToolToAnthropic(e),...t})}invocationParams(e){const t=D3(e==null?void 0:e.tool_choice);if(this.thinking.type==="enabled"){if(this.topK!==-1)throw new Error("topK is not supported when thinking is enabled");if(this.topP!==-1)throw new Error("topP is not supported when thinking is enabled");if(this.temperature!==1)throw new Error("temperature is not supported when thinking is enabled");return{model:this.model,stop_sequences:(e==null?void 0:e.stop)??this.stopSequences,stream:this.streaming,max_tokens:this.maxTokens,tools:this.formatStructuredToolToAnthropic(e==null?void 0:e.tools),tool_choice:t,thinking:this.thinking,...this.invocationKwargs}}return{model:this.model,temperature:this.temperature,top_k:this.topK,top_p:this.topP,stop_sequences:(e==null?void 0:e.stop)??this.stopSequences,stream:this.streaming,max_tokens:this.maxTokens,tools:this.formatStructuredToolToAnthropic(e==null?void 0:e.tools),tool_choice:t,thinking:this.thinking,...this.invocationKwargs}}_identifyingParams(){return{model_name:this.model,...this.invocationParams()}}identifyingParams(){return{model_name:this.model,...this.invocationParams()}}async*_streamResponseChunks(e,t,n){var c;const s=this.invocationParams(t),i=ik(e),a={...s,...i,stream:!0},o=!q3(a)&&!H3(a)&&!W3(a),l=await this.createStreamWithRetry(a,{headers:t.headers});for await(const u of l){if((c=t.signal)!=null&&c.aborted)throw l.controller.abort(),new Error("AbortError: User aborted the request.");const d=this.streamUsage??t.streamUsage,h=B3(u,{streamUsage:d,coerceContentToString:o});if(!h)continue;const{chunk:f}=h,p=G3(f),m=new lr({message:new mt({content:f.content,additional_kwargs:f.additional_kwargs,tool_call_chunks:f.tool_call_chunks,usage_metadata:d?f.usage_metadata:void 0,response_metadata:f.response_metadata,id:f.id}),text:p??""});yield m,await(n==null?void 0:n.handleLLMNewToken(p??"",void 0,void 0,void 0,void 0,{chunk:m}))}}async _generateNonStreaming(e,t,n){const s=await this.completionWithRetry({...t,stream:!1,...ik(e)},n),{content:i,...a}=s,o=U3(i,a),{role:l,type:c,...u}=a;return{generations:o,llmOutput:u}}async _generate(e,t,n){if(this.stopSequences&&t.stop)throw new Error('"stopSequence" parameter found in input and default params');const s=this.invocationParams(t);if(s.stream){let i;const a=this._streamResponseChunks(e,t,n);for await(const o of a)i===void 0?i=o:i=i.concat(o);if(i===void 0)throw new Error("No chunks returned from Anthropic API.");return{generations:[{text:i.text,message:i.message}]}}else return this._generateNonStreaming(e,s,{signal:t.signal,headers:t.headers})}async createStreamWithRetry(e,t){if(!this.streamingClient){const s=this.apiUrl?{baseURL:this.apiUrl}:void 0;this.streamingClient=this.createClient({dangerouslyAllowBrowser:!0,...this.clientOptions,...s,apiKey:this.apiKey,maxRetries:0})}const n=async()=>{try{return await this.streamingClient.messages.create({...e,...this.invocationKwargs,stream:!0},t)}catch(s){throw ak(s)}};return this.caller.call(n)}async completionWithRetry(e,t){if(!this.batchClient){const s=this.apiUrl?{baseURL:this.apiUrl}:void 0;this.batchClient=this.createClient({dangerouslyAllowBrowser:!0,...this.clientOptions,...s,apiKey:this.apiKey,maxRetries:0})}const n=async()=>{try{return await this.batchClient.messages.create({...e,...this.invocationKwargs},t)}catch(s){throw ak(s)}};return this.caller.callWithOptions({signal:t.signal??void 0},n)}_llmType(){return"anthropic"}withStructuredOutput(e,t){var p;const n=e,s=t==null?void 0:t.name,i=t==null?void 0:t.method,a=t==null?void 0:t.includeRaw;if(i==="jsonMode")throw new Error('Anthropic only supports "functionCalling" as a method.');let o=s??"extract",l,c;if(ki(n)){const m=js(n);c=[{name:o,description:m.description??"A function available to call.",input_schema:m}],l=new nk({returnSingle:!0,keyName:o,zodSchema:n})}else{let m;typeof n.name=="string"&&typeof n.description=="string"&&typeof n.input_schema=="object"&&n.input_schema!=null?(m=n,o=n.name):m={name:o,description:n.description??"",input_schema:n},c=[m],l=new nk({returnSingle:!0,keyName:o})}let u;if(((p=this.thinking)==null?void 0:p.type)==="enabled"){const m="Anthropic structured output relies on forced tool calling, which is not supported when `thinking` is enabled. This method will raise OutputParserException if tool calls are not generated. Consider disabling `thinking` or adjust your prompt to ensure the tool is called.";console.warn(m),u=this.bind({tools:c});const g=b=>{if(!b.tool_calls||b.tool_calls.length===0)throw new Error(m);return b};u=u.pipe(g)}else u=this.bind({tools:c,tool_choice:{type:"tool",name:o}});if(!a)return u.pipe(l).withConfig({runName:"ChatAnthropicStructuredOutput"});const d=Ds.assign({parsed:(m,g)=>l.invoke(m.raw,g)}),h=Ds.assign({parsed:()=>null}),f=d.withFallbacks({fallbacks:[h]});return Qn.from([{raw:u},f]).withConfig({runName:"StructuredOutputRunnable"})}}class J3 extends Z3{}function K3(r){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:n,azureOpenAIBasePath:s,baseURL:i,azureADTokenProvider:a,azureOpenAIEndpoint:o}=r;if((n||a)&&s&&e)return`${s}/${e}`;if((n||a)&&o&&e)return`${o}/openai/deployments/${e}`;if(n||a){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return i}function Hu(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function Dm(r){let e;return r.constructor.name===_c.name?(e=new Error(r.message),e.name="TimeoutError"):r.constructor.name===bn.name?(e=new Error(r.message),e.name="AbortError"):r.status===400&&r.message.includes("tool_calls")?e=Hu(r,"INVALID_TOOL_RESULTS"):r.status===401?e=Hu(r,"MODEL_AUTHENTICATION"):r.status===429?e=Hu(r,"MODEL_RATE_LIMIT"):r.status===404?e=Hu(r,"MODEL_NOT_FOUND"):e=r,e}function ok(r){if(r)return r==="any"||r==="required"?"required":r==="auto"?"auto":r==="none"?"none":typeof r=="string"?{type:"function",function:{name:r}}:r}function X3(r){return r.anyOf!==void 0&&Array.isArray(r.anyOf)}function Y3(r){const e=["namespace functions {",""];for(const t of r)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(uE(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function uE(r,e){var n;const t=[];for(const[s,i]of Object.entries(r.properties??{}))i.description&&e<2&&t.push(`// ${i.description}`),(n=r.required)!=null&&n.includes(s)?t.push(`${s}: ${nh(i,e)},`):t.push(`${s}?: ${nh(i,e)},`);return t.map(s=>" ".repeat(e)+s).join(`
`)}function nh(r,e){if(X3(r))return r.anyOf.map(t=>nh(t,e)).join(" | ");switch(r.type){case"string":return r.enum?r.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",uE(r,e+2),"}"].join(`
`);case"array":return r.items?`${nh(r.items,e)}[]`:"any[]";default:return""}}function Q3(r,e){let t;if(nf(r)){const n=jU({name:r.name,parameters:r.schema,description:r.description});n.function.parameters?t={type:n.type,function:{name:n.function.name,description:n.function.description,parameters:n.function.parameters,...(e==null?void 0:e.strict)!==void 0?{strict:e.strict}:{}}}:t={type:"function",function:FA(r,e)}}else t=r;return(e==null?void 0:e.strict)!==void 0&&(t.function.strict=e.strict),t}function e9(r){return r.role!=="system"&&r.role!=="developer"&&r.role!=="assistant"&&r.role!=="user"&&r.role!=="function"&&r.role!=="tool"&&console.warn(`Unknown message role: ${r.role}`),r.role}function ty(r){const e=r._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!Ti.isInstance(r))throw new Error("Invalid generic chat message");return e9(r)}default:throw new Error(`Unknown message type: ${e}`)}}function lk(r,e){return r.flatMap(t=>{var i;let n=ty(t);n==="system"&&ny(e)&&(n="developer");const s={role:n,content:t.content};if(t.name!=null&&(s.name=t.name),t.additional_kwargs.function_call!=null&&(s.function_call=t.additional_kwargs.function_call,s.content=""),rs(t)&&((i=t.tool_calls)!=null&&i.length)?(s.tool_calls=t.tool_calls.map(CA),s.content=""):(t.additional_kwargs.tool_calls!=null&&(s.tool_calls=t.additional_kwargs.tool_calls),t.tool_call_id!=null&&(s.tool_call_id=t.tool_call_id)),t.additional_kwargs.audio&&typeof t.additional_kwargs.audio=="object"&&"id"in t.additional_kwargs.audio){const a={role:"assistant",audio:{id:t.additional_kwargs.audio.id}};return[s,a]}return s})}const aa="__openai_function_call_ids__";function ck(r,e){return r.flatMap(t=>{var s,i;let n=ty(t);if(n==="system"&&ny(e)&&(n="developer"),n==="function")throw new Error("Function messages are not supported in Responses API");if(n==="tool"){const a=t;return((s=a.additional_kwargs)==null?void 0:s.type)==="computer_call_output"?{type:"computer_call_output",output:(()=>{if(typeof a.content=="string")return{type:"computer_screenshot",image_url:a.content};if(Array.isArray(a.content)){const l=a.content.find(u=>u.type==="computer_screenshot");if(l)return l;const c=a.content.find(u=>u.type==="image_url");if(c)return{type:"computer_screenshot",image_url:typeof c.image_url=="string"?c.image_url:c.image_url.url}}throw new Error("Invalid computer call output")})(),call_id:a.tool_call_id}:{type:"function_call_output",call_id:a.tool_call_id,id:a.id,output:typeof a.content!="string"?JSON.stringify(a.content):a.content}}if(n==="assistant"){const a=[];t.additional_kwargs.reasoning!=null&&(u=>typeof u=="object"&&u!=null&&"type"in u&&u.type==="reasoning")(t.additional_kwargs.reasoning)&&a.push(t.additional_kwargs.reasoning);let{content:o}=t;t.additional_kwargs.refusal!=null&&(typeof o=="string"&&(o=[{type:"output_text",text:o,annotations:[]}]),o=[...o,{type:"refusal",refusal:t.additional_kwargs.refusal}]),a.push({type:"message",role:"assistant",content:typeof o=="string"?o:o.flatMap(c=>c.type==="text"?{type:"output_text",text:c.text,annotations:c.annotations??[]}:c.type==="output_text"||c.type==="refusal"?c:[])});const l=t.additional_kwargs[aa];if(rs(t)&&((i=t.tool_calls)!=null&&i.length)?a.push(...t.tool_calls.map(c=>({type:"function_call",name:c.name,arguments:JSON.stringify(c.args),call_id:c.id,id:l==null?void 0:l[c.id]}))):t.additional_kwargs.tool_calls!=null&&a.push(...t.additional_kwargs.tool_calls.map(c=>({type:"function_call",name:c.function.name,call_id:c.id,id:l==null?void 0:l[c.id],arguments:c.function.arguments}))),t.additional_kwargs.tool_outputs!=null){const c=t.additional_kwargs.tool_outputs,u=c==null?void 0:c.filter(d=>d.type==="computer_call");u.length>0&&a.push(...u)}return a}return n==="user"?{type:"message",role:"user",content:typeof t.content=="string"?t.content:t.content.flatMap(a=>{if(a.type==="text")return{type:"input_text",text:a.text};if(a.type==="image_url"){const o=typeof a.image_url=="string"?a.image_url:a.image_url.url,l=typeof a.image_url=="string"?"auto":a.image_url.detail;return{type:"input_image",image_url:o,detail:l}}return a.type==="input_text"||a.type==="input_image"||a.type==="input_file"?a:[]})}:[]})}function dE(r){if(r.error){const a=new Error(r.error.message);throw a.name=r.error.code,a}const e=[],t=[],n=[],s={model:r.model,created_at:r.created_at,id:r.id,incomplete_details:r.incomplete_details,metadata:r.metadata,object:r.object,status:r.status,user:r.user,model_name:r.model},i={};for(const a of r.output)if(a.type==="message")e.push(...a.content.flatMap(o=>o.type==="output_text"?("parsed"in o&&o.parsed!=null&&(i.parsed=o.parsed),{type:"text",text:o.text,annotations:o.annotations}):o.type==="refusal"?(i.refusal=o.refusal,[]):o));else if(a.type==="function_call"){const o={function:{name:a.name,arguments:a.arguments},id:a.call_id};try{t.push($c(o,{returnId:!0}))}catch(l){let c;typeof l=="object"&&l!=null&&"message"in l&&typeof l.message=="string"&&(c=l.message),n.push(tf(o,c))}i[aa]??(i[aa]={}),i[aa][a.call_id]=a.id}else a.type==="reasoning"?i.reasoning=a:(i.tool_outputs??(i.tool_outputs=[]),i.tool_outputs.push(a));return new ar({id:r.id,content:e,tool_calls:t,invalid_tool_calls:n,usage_metadata:r.usage,additional_kwargs:i,response_metadata:s})}function t9(r){var l,c;const e=[];let t={},n;const s=[],i={},a={};let o;if(r.type==="response.output_text.delta")e.push({type:"text",text:r.delta,index:r.content_index});else if(r.type==="response.output_text.annotation.added")e.push({type:"text",text:"",annotations:[r.annotation],index:r.content_index});else if(r.type==="response.output_item.added"&&r.item.type==="message")o=r.item.id;else if(r.type==="response.output_item.added"&&r.item.type==="function_call")s.push({type:"tool_call_chunk",name:r.item.name,args:r.item.arguments,id:r.item.id,index:r.output_index}),a[aa]={[r.item.call_id]:r.item.id};else if(r.type==="response.output_item.done"&&(r.item.type==="web_search_call"||r.item.type==="file_search_call"||r.item.type==="computer_call"))a.tool_outputs=[r.item];else if(r.type==="response.created")i.id=r.response.id,i.model_name=r.response.model,i.model=r.response.model;else if(r.type==="response.completed"){const u=dE(r.response);n=r.response.usage,((c=(l=r.response.text)==null?void 0:l.format)==null?void 0:c.type)==="json_schema"&&(a.parsed??(a.parsed=JSON.parse(u.text)));for(const[d,h]of Object.entries(r.response))d!=="id"&&(i[d]=h)}else if(r.type==="response.function_call_arguments.delta")s.push({type:"tool_call_chunk",args:r.delta,index:r.output_index});else if(r.type==="response.web_search_call.completed"||r.type==="response.file_search_call.completed")t={tool_outputs:{id:r.item_id,type:r.type.replace("response.","").replace(".completed",""),status:"completed"}};else if(r.type==="response.refusal.done")a.refusal=r.refusal;else return null;return new lr({text:e.map(u=>u.text).join(""),message:new mt({id:o,content:e,tool_call_chunks:s,usage_metadata:n,additional_kwargs:a,response_metadata:i}),generationInfo:t})}function Fm(r){return"type"in r&&r.type!=="function"}function n9(r){return r!=null&&typeof r=="object"&&"type"in r&&r.type!=="function"}function uk(r,e){return Cc(r)?(e==null?void 0:e.strict)!==void 0?{...r,function:{...r.function,strict:e.strict}}:r:Q3(r,e)}function ny(r){return(r==null?void 0:r.startsWith("o1"))||(r==null?void 0:r.startsWith("o3"))}class r9 extends xr{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","reasoningEffort","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","modelName","model","modelKwargs","stop","stopSequences","timeout","openAIApiKey","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming"]}constructor(e){var t,n;super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useResponsesApi",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.openAIApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.openAIApiKey)??((t=e==null?void 0:e.configuration)==null?void 0:t.apiKey)??_n("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.organization=((n=e==null?void 0:e.configuration)==null?void 0:n.organization)??_n("OPENAI_ORGANIZATION"),this.model=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.modelName=this.model,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this.stop,this.user=e==null?void 0:e.user,this.__includeRawResponse=e==null?void 0:e.__includeRawResponse,this.audio=e==null?void 0:e.audio,this.modalities=e==null?void 0:e.modalities,this.reasoningEffort=e==null?void 0:e.reasoningEffort,this.maxTokens=(e==null?void 0:e.maxCompletionTokens)??(e==null?void 0:e.maxTokens),this.useResponsesApi=(e==null?void 0:e.useResponsesApi)??this.useResponsesApi,this.model==="o1"&&(this.disableStreaming=!0),this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e==null?void 0:e.configuration},(e==null?void 0:e.supportsStrictToolCalling)!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling)}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){let n;return(t==null?void 0:t.strict)!==void 0?n=t.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this.bind({tools:e.map(s=>Fm(s)?s:uk(s,{strict:n})),...t})}createResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&Wu(e.json_schema.schema)?DA(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}invocationParams(e,t){var o,l;let n;if((e==null?void 0:e.strict)!==void 0?n=e.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this._useResponseApi(e)){const c={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:e==null?void 0:e.previous_response_id,truncation:e==null?void 0:e.truncation,include:e==null?void 0:e.include,tools:(o=e==null?void 0:e.tools)!=null&&o.length?e.tools.map(d=>Fm(d)?d:Cc(d)?{type:"function",name:d.function.name,parameters:d.function.parameters,description:d.function.description,strict:n}:null).filter(d=>d!==null):void 0,tool_choice:n9(e==null?void 0:e.tool_choice)?e==null?void 0:e.tool_choice:(()=>{const d=ok(e==null?void 0:e.tool_choice);if(typeof d=="object"&&"type"in d)return{type:"function",name:d.function.name}})(),text:(()=>{if(e!=null&&e.text)return e.text;const d=this.createResponseFormat(e==null?void 0:e.response_format);return(d==null?void 0:d.type)==="json_schema"?d.json_schema.schema!=null?{format:{type:"json_schema",schema:d.json_schema.schema,description:d.json_schema.description,name:d.json_schema.name,strict:d.json_schema.strict}}:void 0:{format:d}})(),parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,max_output_tokens:this.maxTokens===-1?void 0:this.maxTokens,...this.modelKwargs},u=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return u!==void 0&&(c.reasoning={effort:u}),c}let s={};(e==null?void 0:e.stream_options)!==void 0?s={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t!=null&&t.streaming)&&(s={stream_options:{include_usage:!0}});const i={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:(l=e==null?void 0:e.tools)!=null&&l.length?e.tools.map(c=>uk(c,{strict:n})):void 0,tool_choice:ok(e==null?void 0:e.tool_choice),response_format:this.createResponseFormat(e==null?void 0:e.response_format),seed:e==null?void 0:e.seed,...s,parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,...this.audio||e!=null&&e.audio?{audio:this.audio||(e==null?void 0:e.audio)}:{},...this.modalities||e!=null&&e.modalities?{modalities:this.modalities||(e==null?void 0:e.modalities)}:{},...this.modelKwargs};(e==null?void 0:e.prediction)!==void 0&&(i.prediction=e.prediction);const a=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return a!==void 0&&(i.reasoning_effort=a),ny(i.model)?i.max_completion_tokens=this.maxTokens===-1?void 0:this.maxTokens:i.max_tokens=this.maxTokens===-1?void 0:this.maxTokens,i}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){const n=e.tool_calls;switch(e.role){case"assistant":{const s=[],i=[];for(const l of n??[])try{s.push($c(l,{returnId:!0}))}catch(c){i.push(tf(l,c.message))}const a={function_call:e.function_call,tool_calls:n};this.__includeRawResponse!==void 0&&(a.__raw_response=t);const o={model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};return e.audio&&(a.audio=e.audio),new ar({content:e.content||"",tool_calls:s,invalid_tool_calls:i,additional_kwargs:a,response_metadata:o,id:t.id})}default:return new Ti(e.content||"",e.role??"unknown")}}_convertOpenAIDeltaToBaseMessageChunk(e,t,n){var l,c;const s=e.role??n,i=e.content??"";let a;e.function_call?a={function_call:e.function_call}:e.tool_calls?a={tool_calls:e.tool_calls}:a={},this.__includeRawResponse&&(a.__raw_response=t),e.audio&&(a.audio={...e.audio,index:t.choices[0].index});const o={usage:{...t.usage}};if(s==="user")return new Ec({content:i,response_metadata:o});if(s==="assistant"){const u=[];if(Array.isArray(e.tool_calls))for(const d of e.tool_calls)u.push({name:(l=d.function)==null?void 0:l.name,args:(c=d.function)==null?void 0:c.arguments,id:d.id,index:d.index,type:"tool_call_chunk"});return new mt({content:i,tool_call_chunks:u,additional_kwargs:a,id:t.id,response_metadata:o})}else return s==="system"?new yi({content:i,response_metadata:o}):s==="developer"?new yi({content:i,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}}):s==="function"?new Ac({content:i,additional_kwargs:a,name:e.name,response_metadata:o}):s==="tool"?new Vh({content:i,additional_kwargs:a,tool_call_id:e.tool_call_id,response_metadata:o}):new Pc({content:i,role:s,response_metadata:o})}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,n){var c,u,d,h,f,p,m,g,b,_;if(this._useResponseApi(t)){const y=await this.responseApiWithRetry({...this.invocationParams(t,{streaming:!0}),input:ck(e,this.model),stream:!0},t);for await(const w of y){const v=t9(w);v!=null&&(yield v)}return}const s=lk(e,this.model),i={...this.invocationParams(t,{streaming:!0}),messages:s,stream:!0};let a;const o=await this.completionWithRetry(i,t);let l;for await(const y of o){const w=(c=y==null?void 0:y.choices)==null?void 0:c[0];if(y.usage&&(l=y.usage),!w)continue;const{delta:v}=w;if(!v)continue;const x=this._convertOpenAIDeltaToBaseMessageChunk(v,y,a);a=v.role??a;const S={prompt:t.promptIndex??0,completion:w.index??0};if(typeof x.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const k={...S};w.finish_reason!=null&&(k.finish_reason=w.finish_reason,k.system_fingerprint=y.system_fingerprint,k.model_name=y.model),this.logprobs&&(k.logprobs=w.logprobs);const R=new lr({message:x,text:x.content,generationInfo:k});yield R,await(n==null?void 0:n.handleLLMNewToken(R.text??"",S,void 0,void 0,void 0,{chunk:R}))}if(l){const y={...((u=l.prompt_tokens_details)==null?void 0:u.audio_tokens)!==null&&{audio:(d=l.prompt_tokens_details)==null?void 0:d.audio_tokens},...((h=l.prompt_tokens_details)==null?void 0:h.cached_tokens)!==null&&{cache_read:(f=l.prompt_tokens_details)==null?void 0:f.cached_tokens}},w={...((p=l.completion_tokens_details)==null?void 0:p.audio_tokens)!==null&&{audio:(m=l.completion_tokens_details)==null?void 0:m.audio_tokens},...((g=l.completion_tokens_details)==null?void 0:g.reasoning_tokens)!==null&&{reasoning:(b=l.completion_tokens_details)==null?void 0:b.reasoning_tokens}};yield new lr({message:new mt({content:"",response_metadata:{usage:{...l}},usage_metadata:{input_tokens:l.prompt_tokens,output_tokens:l.completion_tokens,total_tokens:l.total_tokens,...Object.keys(y).length>0&&{input_token_details:y},...Object.keys(w).length>0&&{output_token_details:w}}}),text:""})}if((_=t.signal)!=null&&_.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _responseApiGenerate(e,t,n){var o;const s=this.invocationParams(t);if(s.stream){const l=this._streamResponseChunks(e,t,n);let c;for await(const u of l)u.message.response_metadata={...u.generationInfo,...u.message.response_metadata},c=(c==null?void 0:c.concat(u))??u;return{generations:c?[c]:[],llmOutput:{estimatedTokenUsage:(o=c==null?void 0:c.message)==null?void 0:o.usage_metadata}}}const i=ck(e,this.model),a=await this.responseApiWithRetry({input:i,...s},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});return{generations:[{text:a.output_text,message:dE(a)}],llmOutput:{id:a.id,estimatedTokenUsage:a.usage?{promptTokens:a.usage.input_tokens,completionTokens:a.usage.output_tokens,totalTokens:a.usage.total_tokens}:void 0}}}_useResponseApi(e){var s;const t=(s=e==null?void 0:e.tools)==null?void 0:s.some(Fm),n=(e==null?void 0:e.previous_response_id)!=null||(e==null?void 0:e.text)!=null||(e==null?void 0:e.truncation)!=null||(e==null?void 0:e.include)!=null;return this.useResponsesApi||t||n}async _generate(e,t,n){var o,l;if(this._useResponseApi(t))return this._responseApiGenerate(e,t,n);const s={},i=this.invocationParams(t),a=lk(e,this.model);if(i.stream){const c=this._streamResponseChunks(e,t,n),u={};for await(const g of c){g.message.response_metadata={...g.generationInfo,...g.message.response_metadata};const b=((o=g.generationInfo)==null?void 0:o.completion)??0;u[b]===void 0?u[b]=g:u[b]=u[b].concat(g)}const d=Object.entries(u).sort(([g],[b])=>parseInt(g,10)-parseInt(b,10)).map(([g,b])=>b),{functions:h,function_call:f}=this.invocationParams(t),p=await this.getEstimatedTokenCountFromPrompt(e,h,f),m=await this.getNumTokensFromGenerations(d);return s.input_tokens=p,s.output_tokens=m,s.total_tokens=p+m,{generations:d,llmOutput:{estimatedTokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}else{let c;t.response_format&&t.response_format.type==="json_schema"?c=await this.betaParsedCompletionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}):c=await this.completionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});const{completion_tokens:u,prompt_tokens:d,total_tokens:h,prompt_tokens_details:f,completion_tokens_details:p}=(c==null?void 0:c.usage)??{};u&&(s.output_tokens=(s.output_tokens??0)+u),d&&(s.input_tokens=(s.input_tokens??0)+d),h&&(s.total_tokens=(s.total_tokens??0)+h),((f==null?void 0:f.audio_tokens)!==null||(f==null?void 0:f.cached_tokens)!==null)&&(s.input_token_details={...(f==null?void 0:f.audio_tokens)!==null&&{audio:f==null?void 0:f.audio_tokens},...(f==null?void 0:f.cached_tokens)!==null&&{cache_read:f==null?void 0:f.cached_tokens}}),((p==null?void 0:p.audio_tokens)!==null||(p==null?void 0:p.reasoning_tokens)!==null)&&(s.output_token_details={...(p==null?void 0:p.audio_tokens)!==null&&{audio:p==null?void 0:p.audio_tokens},...(p==null?void 0:p.reasoning_tokens)!==null&&{reasoning:p==null?void 0:p.reasoning_tokens}});const m=[];for(const g of(c==null?void 0:c.choices)??[]){const _={text:((l=g.message)==null?void 0:l.content)??"",message:this._convertOpenAIChatCompletionMessageToBaseMessage(g.message??{role:"assistant"},c)};_.generationInfo={...g.finish_reason?{finish_reason:g.finish_reason}:{},...g.logprobs?{logprobs:g.logprobs}:{}},rs(_.message)&&(_.message.usage_metadata=s),_.message=new ar(Object.fromEntries(Object.entries(_.message).filter(([y])=>!y.startsWith("lc_")))),m.push(_)}return{generations:m,llmOutput:{tokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,t,n){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&n!=="auto"){const i=Y3(t);s+=await this.getNumTokens(i),s+=9}return t&&e.find(i=>i._getType()==="system")&&(s-=4),n==="none"?s+=1:typeof n=="object"&&(s+=await this.getNumTokens(n.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async n=>{var s;return(s=n.message.additional_kwargs)!=null&&s.function_call?(await this.getNumTokensFromMessages([n.message])).countPerMessage[0]:await this.getNumTokens(n.message.content)}))).reduce((n,s)=>n+s,0)}async getNumTokensFromMessages(e){let t=0,n=0,s=0;this.model==="gpt-3.5-turbo-0301"?(n=4,s=-1):(n=3,s=1);const i=await Promise.all(e.map(async a=>{var h,f,p,m,g,b;const o=await this.getNumTokens(a.content),l=await this.getNumTokens(ty(a)),c=a.name!==void 0?s+await this.getNumTokens(a.name):0;let u=o+n+l+c;const d=a;if(d._getType()==="function"&&(u-=2),(h=d.additional_kwargs)!=null&&h.function_call&&(u+=3),(f=d==null?void 0:d.additional_kwargs.function_call)!=null&&f.name&&(u+=await this.getNumTokens((p=d.additional_kwargs.function_call)==null?void 0:p.name)),(m=d.additional_kwargs.function_call)!=null&&m.arguments)try{u+=await this.getNumTokens(JSON.stringify(JSON.parse((g=d.additional_kwargs.function_call)==null?void 0:g.arguments)))}catch(_){console.error("Error parsing function arguments",_,JSON.stringify(d.additional_kwargs.function_call)),u+=await this.getNumTokens((b=d.additional_kwargs.function_call)==null?void 0:b.arguments)}return t+=u,u}));return t+=3,{totalCount:t,countPerMessage:i}}async completionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,n)}catch(s){throw Dm(s)}})}async responseApiWithRetry(e,t){return this.caller.call(async()=>{var s,i;const n=this._getClientOptions(t);try{return((i=(s=e.text)==null?void 0:s.format)==null?void 0:i.type)==="json_schema"&&!e.stream?await this.client.responses.parse(e,n):await this.client.responses.create(e,n)}catch(a){throw Dm(a)}})}async betaParsedCompletionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.beta.chat.completions.parse(e,n)}catch(s){throw Dm(s)}})}_getClientOptions(e){if(!this.client){const n={baseURL:this.clientConfig.baseURL},s=K3(n),i={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new Ae(i)}return{...this.clientConfig,...e}}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,n)=>(n&&n.tokenUsage&&(t.tokenUsage.completionTokens+=n.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=n.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=n.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let n,s,i,a;s9(e)?(n=e.schema,s=e.name,i=e.method,a=e.includeRaw):(n=e,s=t==null?void 0:t.name,i=t==null?void 0:t.method,a=t==null?void 0:t.includeRaw);let o,l;if((t==null?void 0:t.strict)!==void 0&&i==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"?i===void 0&&(i="jsonSchema"):i==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`),i==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),Wu(n)?l=Zd.fromZodSchema(n):l=new Jd;else if(i==="jsonSchema")if(o=this.bind({response_format:{type:"json_schema",json_schema:{name:s??"extract",description:n.description,schema:n,strict:t==null?void 0:t.strict}}}),Wu(n)){const h=Zd.fromZodSchema(n);l=Ri.from(f=>"parsed"in f.additional_kwargs?f.additional_kwargs.parsed:h)}else l=new Jd;else{let h=s??"extract";if(Wu(n)){const f=js(n);o=this.bind({tools:[{type:"function",function:{name:h,description:f.description,parameters:f}}],tool_choice:{type:"function",function:{name:h}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),l=new Kd({returnSingle:!0,keyName:h,zodSchema:n})}else{let f;typeof n.name=="string"&&typeof n.parameters=="object"&&n.parameters!=null?(f=n,h=n.name):(h=n.title??h,f={name:h,description:n.description??"",parameters:n}),o=this.bind({tools:[{type:"function",function:f}],tool_choice:{type:"function",function:{name:h}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),l=new Kd({returnSingle:!0,keyName:h})}}if(!a)return o.pipe(l);const c=Ds.assign({parsed:(h,f)=>l.invoke(h.raw,f)}),u=Ds.assign({parsed:()=>null}),d=c.withFallbacks({fallbacks:[u]});return Qn.from([{raw:o},d])}}function Wu(r){return typeof(r==null?void 0:r.parse)=="function"}function s9(r){return r!==void 0&&typeof r.schema=="object"}class i9 extends r9{static lc_name(){return"ChatDeepSeek"}_llmType(){return"deepseek"}get lc_secrets(){return{apiKey:"DEEPSEEK_API_KEY"}}constructor(e){const t=(e==null?void 0:e.apiKey)||_n("DEEPSEEK_API_KEY");if(!t)throw new Error('Deepseek API key not found. Please set the DEEPSEEK_API_KEY environment variable or pass the key into "apiKey" field.');super({...e,apiKey:t,configuration:{baseURL:"https://api.deepseek.com",...e==null?void 0:e.configuration}}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models","deepseek"]})}_convertOpenAIDeltaToBaseMessageChunk(e,t,n){const s=super._convertOpenAIDeltaToBaseMessageChunk(e,t,n);return s.additional_kwargs.reasoning_content=e.reasoning_content,s}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){const n=super._convertOpenAIChatCompletionMessageToBaseMessage(e,t);return n.additional_kwargs.reasoning_content=e.reasoning_content,n}withStructuredOutput(e,t){const n={...t};return(n==null?void 0:n.method)===void 0&&(n.method="functionCalling"),super.withStructuredOutput(e,n)}}var zm={local:{},session:{}};function a9(r){return r==="local"?localStorage:sessionStorage}function o9(r,e,t){var n,s,i,a,o,l,c,u;const d=(n=void 0)!=null?n:JSON,h=(s=void 0)!=null?s:"local",f=(i=void 0)!=null?i:!0,p=(o=(a=void 0)!=null?a:void 0)!=null?o:x=>console.error(`Error when writing value from persisted store "${r}" to ${h}`,x),m=(l=void 0)!=null?l:(x,S)=>console.error(`Error when parsing ${x?'"'+x+'"':"value"} from persisted store "${r}"`,S),g=(c=void 0)!=null?c:x=>x,b=(u=void 0)!=null?u:x=>x,_=typeof window<"u"&&typeof document<"u",y=_?a9(h):null;function w(x,S){const k=b(S);try{y==null||y.setItem(x,d.stringify(k))}catch(R){p(R)}}function v(){function x(D){try{return d.parse(D)}catch(C){m(D,C)}}const S=y==null?void 0:y.getItem(r);if(S==null)return e;const k=x(S);return k==null?e:g(k)}if(!zm[h][r]){const x=v(),S=yb(x,D=>{if(_&&h=="local"&&f){const C=N=>{if(N.key===r&&N.newValue){let $;try{$=d.parse(N.newValue)}catch(E){m(N.newValue,E);return}const P=g($);D(P)}};return window.addEventListener("storage",C),()=>window.removeEventListener("storage",C)}}),{subscribe:k,set:R}=S;zm[h][r]={set(D){R(D),w(r,D)},update(D){return S.update(C=>{const N=D(C);return w(r,N),N})},reset(){this.set(e)},subscribe:k}}return zm[h][r]}const hE={provider:"openai",model:"gpt-3.5-turbo",apiKey:"",temperature:.7,maxTokens:1e3,baseUrl:""},ob=o9("llm-assist-signal-app::llm_config",hE),l9=[new Bg(`You are a signal processing assistant that can help users generate and process signals. You can use the following tools:

1. generate_signal - Generate a new signal channel
2. process_signal - Process an existing signal and create a new channel
3. list_channels - List all available signal channels
4. get_channel_info - Get detailed information about a specific signal channel

When a user requests to generate or process signals, please use the appropriate tool instead of answering directly. For example, if a user asks to generate a sine wave, call the generate_signal tool.

You will be called repeatedly to complete tasks. Follow these rules:  

1. Perform tasks step-by-step. If unable to finish in one response, persist until done.  
2. After completing the task (or a subtask requiring user input), call \`await_user_input\` before ending.  
3. Stay aware of prior contextâyou may be recalled to continue.  

Always conclude with \`await_user_input\` when the task requires further user interaction.

Always call the await_user_input tool after completing a task or response. This signals the system to pause and wait for further user input before proceeding`)],rh=yb([...l9]);function gd(r){rh.update(e=>[...e,r])}const fE=[bo(async r=>{const{name:e,signal_type:t,length:n=1e3,sample_rate:s=1e3,amplitude:i=1,frequency:a=10,phase:o=0,duty_cycle:l=.5,pulse_position:c=500,pulse_width:u=10}=r;let d=[];switch(t){case"sine":d=Vm(n,a,i,s,o);break;case"square":d=Gm(n,a,i,s,l);break;case"triangle":d=Zm(n,a,i,s);break;case"sawtooth":d=Jm(n,a,i,s);break;case"noise":d=Km(n,i);break;case"pulse":d=Xm(n,c,u,i);break;default:throw new Error(`ä¸æ¯æçä¿¡å·ç±»å: ${t}`)}const h=xb(e,d,s);return{channel_id:h.id,name:h.name,length:d.length,sample_rate:s,signal_type:t,message:`æåçæ${e}ä¿¡å·ééï¼ID: ${h.id}`}},{name:"generate_signal",description:"çæä¸ä¸ªæ°çä¿¡å·éé",schema:He.object({name:He.string().describe("ä¿¡å·ééçåç§°"),signal_type:He.enum(["sine","square","triangle","sawtooth","noise","pulse"]).describe("ä¿¡å·ç±»åï¼æ­£å¼¦æ³¢(sine)ãæ¹æ³¢(square)ãä¸è§æ³¢(triangle)ãé¯é½¿æ³¢(sawtooth)ãåªå£°(noise)ãèå²(pulse)"),length:He.number().int().default(1e3).describe("ä¿¡å·é¿åº¦ï¼æ ·æ¬æ°ï¼"),sample_rate:He.number().int().default(1e3).describe("éæ ·çï¼Hzï¼"),amplitude:He.number().default(1).describe("ä¿¡å·å¹åº¦"),frequency:He.number().default(10).describe("ä¿¡å·é¢çï¼Hzï¼ï¼ä»éç¨äºå¨ææ§ä¿¡å·"),phase:He.number().default(0).describe("ç¸ä½ï¼å¼§åº¦ï¼ï¼ä»éç¨äºæ­£å¼¦æ³¢"),duty_cycle:He.number().default(.5).describe("å ç©ºæ¯ï¼0-1ï¼ï¼ä»éç¨äºæ¹æ³¢"),pulse_position:He.number().int().default(500).describe("èå²ä½ç½®ï¼æ ·æ¬ç´¢å¼ï¼ï¼ä»éç¨äºèå²ä¿¡å·"),pulse_width:He.number().int().default(10).describe("èå²å®½åº¦ï¼æ ·æ¬æ°ï¼ï¼ä»éç¨äºèå²ä¿¡å·")})}),bo(async r=>{const{source_channel_id:e,new_channel_name:t,processor_type:n,window_size:s=10,cutoff_frequency:i=50}=r,a=Wm(e);if(!a)throw new Error(`æ¾ä¸å°IDä¸º${e}çä¿¡å·éé`);let o,l={};switch(n){case"moving_average":o=uS,l={windowSize:s};break;case"low_pass":o=dS,l={cutoffFrequency:i,sampleRate:a.sampleRate};break;case"high_pass":o=hS,l={cutoffFrequency:i,sampleRate:a.sampleRate};break;case"fft":o=Ob;break;case"differentiate":o=fS,l={sampleRate:a.sampleRate};break;case"integrate":o=pS,l={sampleRate:a.sampleRate};break;default:throw new Error(`ä¸æ¯æçå¤çå¨ç±»å: ${n}`)}const c=Dk(e,o,t,l);return{channel_id:c.id,name:c.name,source_channel_id:e,processor_type:n,length:c.data.length,message:`æåå¤çä¿¡å·å¹¶åå»ºæ°éé${t}ï¼ID: ${c.id}`}},{name:"process_signal",description:"å¤çç°æä¿¡å·å¹¶åå»ºæ°çä¿¡å·éé",schema:He.object({source_channel_id:He.string().describe("æºä¿¡å·ééçID"),new_channel_name:He.string().describe("æ°ä¿¡å·ééçåç§°"),processor_type:He.enum(["moving_average","low_pass","high_pass","fft","differentiate","integrate"]).describe("å¤çå¨ç±»åï¼ç§»å¨å¹³å(moving_average)ãä½éæ»¤æ³¢(low_pass)ãé«éæ»¤æ³¢(high_pass)ãFFT(fft)ãå¾®å(differentiate)ãç§¯å(integrate)"),window_size:He.number().int().default(10).describe("ç§»å¨å¹³åçªå£å¤§å°ï¼ä»éç¨äºç§»å¨å¹³åå¤çå¨"),cutoff_frequency:He.number().default(50).describe("æªæ­¢é¢çï¼Hzï¼ï¼ä»éç¨äºä½éåé«éæ»¤æ³¢å¨")})}),bo(async()=>{const r=wb(Na);return{channels:r.map(e=>({id:e.id,name:e.name,length:e.data.length,sample_rate:e.sampleRate,created_at:e.createdAt,processing_method:e.processingMethod,stats:e.getStats()})),count:r.length,message:`æ¾å°${r.length}ä¸ªä¿¡å·éé`}},{name:"list_channels",description:"ååºææå¯ç¨çä¿¡å·éé",schema:He.object({}).describe("æ éåæ°")}),bo(async r=>{const{channel_id:e}=r,t=Wm(e);if(!t)throw new Error(`æ¾ä¸å°IDä¸º${e}çä¿¡å·éé`);const n=t.getStats();return{id:t.id,name:t.name,length:t.data.length,sample_rate:t.sampleRate,created_at:t.createdAt,updated_at:t.updatedAt,processing_method:t.processingMethod,source_channel_ids:t.sourceChannelIds,stats:n,message:`æåè·åéé${t.name}çä¿¡æ¯`}},{name:"get_channel_info",description:"è·åç¹å®ä¿¡å·ééçè¯¦ç»ä¿¡æ¯",schema:He.object({channel_id:He.string().describe("ä¿¡å·ééçID")})}),bo(async()=>"æ­£å¨ç­å¾ç¨æ·è¾å¥",{name:"await_user_input",description:"ç­å¾ç¨æ·è¾å¥",schema:He.void()})];function c9(){const r=wb(ob),e={openai:KU,anthropic:J3,deepseek:i9};return new e[r.provider]({apiKey:r.apiKey,modelName:r.model,temperature:r.temperature,maxTokens:r.maxTokens,...r.baseUrl?{baseURL:r.baseUrl}:{}}).bindTools(fE)}async function u9(r){try{const e=c9();gd(new _i(r));e:for(;;){const t=await e.invoke(wb(rh));if(gd(t),t.tool_calls&&t.tool_calls.length>0)for(const n of t.tool_calls){const{name:s}=n,a=await fE.find(o=>o.name===s).invoke(n);if(gd(a),s==="await_user_input")break e}}}catch(e){throw console.error("Error sending message to LLM:",e),e}}function d9(r){switch(r.provider){case"openai":return["gpt-3.5-turbo","gpt-4","gpt-4-turbo"];case"anthropic":return["claude-3-opus-20240229","claude-3-sonnet-20240229","claude-3-haiku-20240307"];case"deepseek":return["deepseek-reasoner","deepseek-chat","deepseek-coder"];default:return[]}}function h9(){return[{id:"openai",name:"OpenAI"},{id:"anthropic",name:"Anthropic"},{id:"deepseek",name:"Deepseek"}]}var f9=pe("<div><!></div>");function dk(r,e){at(e,!0);let t=se(e,"ref",15,null),n=Tt(e,["$$slots","$$events","$$legacy","ref","class","children"]);var s=f9();let i;var a=B(s);kt(a,()=>e.children??Rn),z(s),es(s,o=>t(o),()=>t()),Ue(o=>i=jt(s,i,{class:o,...n}),[()=>zn("bg-card text-card-foreground rounded-lg border shadow-sm",e.class)]),q(r,s),ot()}var p9=pe("<div><!></div>");function hk(r,e){at(e,!0);let t=se(e,"ref",15,null),n=Tt(e,["$$slots","$$events","$$legacy","ref","class","children"]);var s=p9();let i;var a=B(s);kt(a,()=>e.children??Rn),z(s),es(s,o=>t(o),()=>t()),Ue(o=>i=jt(s,i,{class:o,...n}),[()=>zn("p-6",e.class)]),q(r,s),ot()}/**
 * @license lucide-svelte v0.488.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const m9={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var g9=_k("<svg><!><!></svg>");function df(r,e){const t=Aa(e,["children","$$slots","$$events","$$legacy"]),n=Aa(t,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);at(e,!1);let s=se(e,"name",8,void 0),i=se(e,"color",8,"currentColor"),a=se(e,"size",8,24),o=se(e,"strokeWidth",8,2),l=se(e,"absoluteStrokeWidth",8,!1),c=se(e,"iconNode",24,()=>[]);const u=(...m)=>m.filter((g,b,_)=>!!g&&_.indexOf(g)===b).join(" ");kh();var d=g9();let h;var f=B(d);jn(f,1,c,Er,(m,g)=>{let b=()=>A(g)[0],_=()=>A(g)[1];var y=Fe(),w=ke(y);Ik(w,b,!0,(v,x)=>{let S;Ue(()=>S=jt(v,S,{..._()}))}),q(m,y)});var p=V(f);pc(p,e,"default",{}),z(d),Ue((m,g)=>h=jt(d,h,{...m9,...n,width:a(),height:a(),stroke:i(),"stroke-width":m,class:g}),[()=>l()?Number(o())*24/Number(a()):o(),()=>u("lucide-icon","lucide",s()?`lucide-${s()}`:"",t.class)],hc),q(r,d),ot()}function b9(r,e){const t=Aa(e,["children","$$slots","$$events","$$legacy"]);df(r,Ir({name:"loader-circle"},()=>t,{iconNode:[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56"}]],children:(s,i)=>{var a=Fe(),o=ke(a);pc(o,e,"default",{}),q(s,a)},$$slots:{default:!0}}))}function _9(r,e){const t=Aa(e,["children","$$slots","$$events","$$legacy"]);df(r,Ir({name:"rotate-ccw"},()=>t,{iconNode:[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}]],children:(s,i)=>{var a=Fe(),o=ke(a);pc(o,e,"default",{}),q(s,a)},$$slots:{default:!0}}))}function y9(r,e){const t=Aa(e,["children","$$slots","$$events","$$legacy"]);df(r,Ir({name:"send"},()=>t,{iconNode:[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]],children:(s,i)=>{var a=Fe(),o=ke(a);pc(o,e,"default",{}),q(s,a)},$$slots:{default:!0}}))}function w9(r,e){const t=Aa(e,["children","$$slots","$$events","$$legacy"]);df(r,Ir({name:"trash-2"},()=>t,{iconNode:[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]],children:(s,i)=>{var a=Fe(),o=ke(a);pc(o,e,"default",{}),q(s,a)},$$slots:{default:!0}}))}function ry(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let Ii=ry();function pE(r){Ii=r}const cl={exec:()=>null};function Ze(r,e=""){let t=typeof r=="string"?r:r.source;const n={replace:(s,i)=>{let a=typeof i=="string"?i:i.source;return a=a.replace(on.caret,"$1"),t=t.replace(s,a),n},getRegex:()=>new RegExp(t,e)};return n}const on={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:r=>new RegExp(`^( {0,3}${r})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}#`),htmlBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}<(?:[a-z].*>|!--)`,"i")},v9=/^(?:[ \t]*(?:\n|$))+/,x9=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,k9=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Lc=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,S9=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,sy=/(?:[*+-]|\d{1,9}[.)])/,mE=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,gE=Ze(mE).replace(/bull/g,sy).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),P9=Ze(mE).replace(/bull/g,sy).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),iy=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,A9=/^[^\n]+/,ay=/(?!\s*\])(?:\\.|[^\[\]\\])+/,E9=Ze(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",ay).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),O9=Ze(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,sy).getRegex(),hf="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",oy=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,T9=Ze("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",oy).replace("tag",hf).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),bE=Ze(iy).replace("hr",Lc).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",hf).getRegex(),R9=Ze(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",bE).getRegex(),ly={blockquote:R9,code:x9,def:E9,fences:k9,heading:S9,hr:Lc,html:T9,lheading:gE,list:O9,newline:v9,paragraph:bE,table:cl,text:A9},fk=Ze("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Lc).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",hf).getRegex(),I9={...ly,lheading:P9,table:fk,paragraph:Ze(iy).replace("hr",Lc).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",fk).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",hf).getRegex()},C9={...ly,html:Ze(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",oy).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:cl,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Ze(iy).replace("hr",Lc).replace("heading",` *#{1,6} *[^
]`).replace("lheading",gE).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},$9=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,M9=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,_E=/^( {2,}|\\)\n(?!\s*$)/,N9=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,ff=/[\p{P}\p{S}]/u,cy=/[\s\p{P}\p{S}]/u,yE=/[^\s\p{P}\p{S}]/u,L9=Ze(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,cy).getRegex(),wE=/(?!~)[\p{P}\p{S}]/u,j9=/(?!~)[\s\p{P}\p{S}]/u,D9=/(?:[^\s\p{P}\p{S}]|~)/u,F9=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,vE=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,z9=Ze(vE,"u").replace(/punct/g,ff).getRegex(),B9=Ze(vE,"u").replace(/punct/g,wE).getRegex(),xE="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",U9=Ze(xE,"gu").replace(/notPunctSpace/g,yE).replace(/punctSpace/g,cy).replace(/punct/g,ff).getRegex(),q9=Ze(xE,"gu").replace(/notPunctSpace/g,D9).replace(/punctSpace/g,j9).replace(/punct/g,wE).getRegex(),H9=Ze("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,yE).replace(/punctSpace/g,cy).replace(/punct/g,ff).getRegex(),W9=Ze(/\\(punct)/,"gu").replace(/punct/g,ff).getRegex(),V9=Ze(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),G9=Ze(oy).replace("(?:-->|$)","-->").getRegex(),Z9=Ze("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",G9).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),sh=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,J9=Ze(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",sh).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),kE=Ze(/^!?\[(label)\]\[(ref)\]/).replace("label",sh).replace("ref",ay).getRegex(),SE=Ze(/^!?\[(ref)\](?:\[\])?/).replace("ref",ay).getRegex(),K9=Ze("reflink|nolink(?!\\()","g").replace("reflink",kE).replace("nolink",SE).getRegex(),uy={_backpedal:cl,anyPunctuation:W9,autolink:V9,blockSkip:F9,br:_E,code:M9,del:cl,emStrongLDelim:z9,emStrongRDelimAst:U9,emStrongRDelimUnd:H9,escape:$9,link:J9,nolink:SE,punctuation:L9,reflink:kE,reflinkSearch:K9,tag:Z9,text:N9,url:cl},X9={...uy,link:Ze(/^!?\[(label)\]\((.*?)\)/).replace("label",sh).getRegex(),reflink:Ze(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",sh).getRegex()},lb={...uy,emStrongRDelimAst:q9,emStrongLDelim:B9,url:Ze(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},Y9={...lb,br:Ze(_E).replace("{2,}","*").getRegex(),text:Ze(lb.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Vu={normal:ly,gfm:I9,pedantic:C9},Oo={normal:uy,gfm:lb,breaks:Y9,pedantic:X9},Q9={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},pk=r=>Q9[r];function gr(r,e){if(e){if(on.escapeTest.test(r))return r.replace(on.escapeReplace,pk)}else if(on.escapeTestNoEncode.test(r))return r.replace(on.escapeReplaceNoEncode,pk);return r}function mk(r){try{r=encodeURI(r).replace(on.percentDecode,"%")}catch{return null}return r}function gk(r,e){var i;const t=r.replace(on.findPipe,(a,o,l)=>{let c=!1,u=o;for(;--u>=0&&l[u]==="\\";)c=!c;return c?"|":" |"}),n=t.split(on.splitPipe);let s=0;if(n[0].trim()||n.shift(),n.length>0&&!((i=n.at(-1))!=null&&i.trim())&&n.pop(),e)if(n.length>e)n.splice(e);else for(;n.length<e;)n.push("");for(;s<n.length;s++)n[s]=n[s].trim().replace(on.slashPipe,"|");return n}function To(r,e,t){const n=r.length;if(n===0)return"";let s=0;for(;s<n&&r.charAt(n-s-1)===e;)s++;return r.slice(0,n-s)}function e5(r,e){if(r.indexOf(e[1])===-1)return-1;let t=0;for(let n=0;n<r.length;n++)if(r[n]==="\\")n++;else if(r[n]===e[0])t++;else if(r[n]===e[1]&&(t--,t<0))return n;return-1}function bk(r,e,t,n,s){const i=e.href,a=e.title||null,o=r[1].replace(s.other.outputLinkReplace,"$1");if(r[0].charAt(0)!=="!"){n.state.inLink=!0;const l={type:"link",raw:t,href:i,title:a,text:o,tokens:n.inlineTokens(o)};return n.state.inLink=!1,l}return{type:"image",raw:t,href:i,title:a,text:o}}function t5(r,e,t){const n=r.match(t.other.indentCodeCompensation);if(n===null)return e;const s=n[1];return e.split(`
`).map(i=>{const a=i.match(t.other.beginningSpace);if(a===null)return i;const[o]=a;return o.length>=s.length?i.slice(s.length):i}).join(`
`)}class ih{constructor(e){M(this,"options");M(this,"rules");M(this,"lexer");this.options=e||Ii}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const n=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?n:To(n,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const n=t[0],s=t5(n,t[3]||"",this.rules);return{type:"code",raw:n,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:s}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let n=t[2].trim();if(this.rules.other.endingHash.test(n)){const s=To(n,"#");(this.options.pedantic||!s||this.rules.other.endingSpaceChar.test(s))&&(n=s.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:To(t[0],`
`)}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){let n=To(t[0],`
`).split(`
`),s="",i="";const a=[];for(;n.length>0;){let o=!1;const l=[];let c;for(c=0;c<n.length;c++)if(this.rules.other.blockquoteStart.test(n[c]))l.push(n[c]),o=!0;else if(!o)l.push(n[c]);else break;n=n.slice(c);const u=l.join(`
`),d=u.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");s=s?`${s}
${u}`:u,i=i?`${i}
${d}`:d;const h=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(d,a,!0),this.lexer.state.top=h,n.length===0)break;const f=a.at(-1);if((f==null?void 0:f.type)==="code")break;if((f==null?void 0:f.type)==="blockquote"){const p=f,m=p.raw+`
`+n.join(`
`),g=this.blockquote(m);a[a.length-1]=g,s=s.substring(0,s.length-p.raw.length)+g.raw,i=i.substring(0,i.length-p.text.length)+g.text;break}else if((f==null?void 0:f.type)==="list"){const p=f,m=p.raw+`
`+n.join(`
`),g=this.list(m);a[a.length-1]=g,s=s.substring(0,s.length-f.raw.length)+g.raw,i=i.substring(0,i.length-p.raw.length)+g.raw,n=m.substring(a.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:s,tokens:a,text:i}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n=t[1].trim();const s=n.length>1,i={type:"list",raw:"",ordered:s,start:s?+n.slice(0,-1):"",loose:!1,items:[]};n=s?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=s?n:"[*+-]");const a=this.rules.other.listItemRegex(n);let o=!1;for(;e;){let c=!1,u="",d="";if(!(t=a.exec(e))||this.rules.block.hr.test(e))break;u=t[0],e=e.substring(u.length);let h=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,_=>" ".repeat(3*_.length)),f=e.split(`
`,1)[0],p=!h.trim(),m=0;if(this.options.pedantic?(m=2,d=h.trimStart()):p?m=t[1].length+1:(m=t[2].search(this.rules.other.nonSpaceChar),m=m>4?1:m,d=h.slice(m),m+=t[1].length),p&&this.rules.other.blankLine.test(f)&&(u+=f+`
`,e=e.substring(f.length+1),c=!0),!c){const _=this.rules.other.nextBulletRegex(m),y=this.rules.other.hrRegex(m),w=this.rules.other.fencesBeginRegex(m),v=this.rules.other.headingBeginRegex(m),x=this.rules.other.htmlBeginRegex(m);for(;e;){const S=e.split(`
`,1)[0];let k;if(f=S,this.options.pedantic?(f=f.replace(this.rules.other.listReplaceNesting,"  "),k=f):k=f.replace(this.rules.other.tabCharGlobal,"    "),w.test(f)||v.test(f)||x.test(f)||_.test(f)||y.test(f))break;if(k.search(this.rules.other.nonSpaceChar)>=m||!f.trim())d+=`
`+k.slice(m);else{if(p||h.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||w.test(h)||v.test(h)||y.test(h))break;d+=`
`+f}!p&&!f.trim()&&(p=!0),u+=S+`
`,e=e.substring(S.length+1),h=k.slice(m)}}i.loose||(o?i.loose=!0:this.rules.other.doubleBlankLine.test(u)&&(o=!0));let g=null,b;this.options.gfm&&(g=this.rules.other.listIsTask.exec(d),g&&(b=g[0]!=="[ ] ",d=d.replace(this.rules.other.listReplaceTask,""))),i.items.push({type:"list_item",raw:u,task:!!g,checked:b,loose:!1,text:d,tokens:[]}),i.raw+=u}const l=i.items.at(-1);if(l)l.raw=l.raw.trimEnd(),l.text=l.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let c=0;c<i.items.length;c++)if(this.lexer.state.top=!1,i.items[c].tokens=this.lexer.blockTokens(i.items[c].text,[]),!i.loose){const u=i.items[c].tokens.filter(h=>h.type==="space"),d=u.length>0&&u.some(h=>this.rules.other.anyLine.test(h.raw));i.loose=d}if(i.loose)for(let c=0;c<i.items.length;c++)i.items[c].loose=!0;return i}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){const t=this.rules.block.def.exec(e);if(t){const n=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),s=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:n,raw:t[0],href:s,title:i}}}table(e){var o;const t=this.rules.block.table.exec(e);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;const n=gk(t[1]),s=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=(o=t[3])!=null&&o.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],a={type:"table",raw:t[0],header:[],align:[],rows:[]};if(n.length===s.length){for(const l of s)this.rules.other.tableAlignRight.test(l)?a.align.push("right"):this.rules.other.tableAlignCenter.test(l)?a.align.push("center"):this.rules.other.tableAlignLeft.test(l)?a.align.push("left"):a.align.push(null);for(let l=0;l<n.length;l++)a.header.push({text:n[l],tokens:this.lexer.inline(n[l]),header:!0,align:a.align[l]});for(const l of i)a.rows.push(gk(l,a.header.length).map((c,u)=>({text:c,tokens:this.lexer.inline(c),header:!1,align:a.align[u]})));return a}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const n=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:n,tokens:this.lexer.inline(n)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const n=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;const a=To(n.slice(0,-1),"\\");if((n.length-a.length)%2===0)return}else{const a=e5(t[2],"()");if(a>-1){const l=(t[0].indexOf("!")===0?5:4)+t[1].length+a;t[2]=t[2].substring(0,a),t[0]=t[0].substring(0,l).trim(),t[3]=""}}let s=t[2],i="";if(this.options.pedantic){const a=this.rules.other.pedanticHrefTitle.exec(s);a&&(s=a[1],i=a[3])}else i=t[3]?t[3].slice(1,-1):"";return s=s.trim(),this.rules.other.startAngleBracket.test(s)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?s=s.slice(1):s=s.slice(1,-1)),bk(t,{href:s&&s.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){const s=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=t[s.toLowerCase()];if(!i){const a=n[0].charAt(0);return{type:"text",raw:a,text:a}}return bk(n,i,n[0],this.lexer,this.rules)}}emStrong(e,t,n=""){let s=this.rules.inline.emStrongLDelim.exec(e);if(!s||s[3]&&n.match(this.rules.other.unicodeAlphaNumeric))return;if(!(s[1]||s[2]||"")||!n||this.rules.inline.punctuation.exec(n)){const a=[...s[0]].length-1;let o,l,c=a,u=0;const d=s[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(d.lastIndex=0,t=t.slice(-1*e.length+a);(s=d.exec(t))!=null;){if(o=s[1]||s[2]||s[3]||s[4]||s[5]||s[6],!o)continue;if(l=[...o].length,s[3]||s[4]){c+=l;continue}else if((s[5]||s[6])&&a%3&&!((a+l)%3)){u+=l;continue}if(c-=l,c>0)continue;l=Math.min(l,l+c+u);const h=[...s[0]][0].length,f=e.slice(0,a+s.index+h+l);if(Math.min(a,l)%2){const m=f.slice(1,-1);return{type:"em",raw:f,text:m,tokens:this.lexer.inlineTokens(m)}}const p=f.slice(2,-2);return{type:"strong",raw:f,text:p,tokens:this.lexer.inlineTokens(p)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let n=t[2].replace(this.rules.other.newLineCharGlobal," ");const s=this.rules.other.nonSpaceChar.test(n),i=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return s&&i&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:t[0],text:n}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let n,s;return t[2]==="@"?(n=t[1],s="mailto:"+n):(n=t[1],s=n),{type:"link",raw:t[0],text:n,href:s,tokens:[{type:"text",raw:n,text:n}]}}}url(e){var n;let t;if(t=this.rules.inline.url.exec(e)){let s,i;if(t[2]==="@")s=t[0],i="mailto:"+s;else{let a;do a=t[0],t[0]=((n=this.rules.inline._backpedal.exec(t[0]))==null?void 0:n[0])??"";while(a!==t[0]);s=t[0],t[1]==="www."?i="http://"+t[0]:i=t[0]}return{type:"link",raw:t[0],text:s,href:i,tokens:[{type:"text",raw:s,text:s}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){const n=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:n}}}}class Dn{constructor(e){M(this,"tokens");M(this,"options");M(this,"state");M(this,"tokenizer");M(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Ii,this.options.tokenizer=this.options.tokenizer||new ih,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={other:on,block:Vu.normal,inline:Oo.normal};this.options.pedantic?(t.block=Vu.pedantic,t.inline=Oo.pedantic):this.options.gfm&&(t.block=Vu.gfm,this.options.breaks?t.inline=Oo.breaks:t.inline=Oo.gfm),this.tokenizer.rules=t}static get rules(){return{block:Vu,inline:Oo}}static lex(e,t){return new Dn(t).lex(e)}static lexInline(e,t){return new Dn(t).inlineTokens(e)}lex(e){e=e.replace(on.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){const n=this.inlineQueue[t];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],n=!1){var s,i,a;for(this.options.pedantic&&(e=e.replace(on.tabCharGlobal,"    ").replace(on.spaceLine,""));e;){let o;if((i=(s=this.options.extensions)==null?void 0:s.block)!=null&&i.some(c=>(o=c.call({lexer:this},e,t))?(e=e.substring(o.raw.length),t.push(o),!0):!1))continue;if(o=this.tokenizer.space(e)){e=e.substring(o.raw.length);const c=t.at(-1);o.raw.length===1&&c!==void 0?c.raw+=`
`:t.push(o);continue}if(o=this.tokenizer.code(e)){e=e.substring(o.raw.length);const c=t.at(-1);(c==null?void 0:c.type)==="paragraph"||(c==null?void 0:c.type)==="text"?(c.raw+=`
`+o.raw,c.text+=`
`+o.text,this.inlineQueue.at(-1).src=c.text):t.push(o);continue}if(o=this.tokenizer.fences(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.heading(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.hr(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.blockquote(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.list(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.html(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.def(e)){e=e.substring(o.raw.length);const c=t.at(-1);(c==null?void 0:c.type)==="paragraph"||(c==null?void 0:c.type)==="text"?(c.raw+=`
`+o.raw,c.text+=`
`+o.raw,this.inlineQueue.at(-1).src=c.text):this.tokens.links[o.tag]||(this.tokens.links[o.tag]={href:o.href,title:o.title});continue}if(o=this.tokenizer.table(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.lheading(e)){e=e.substring(o.raw.length),t.push(o);continue}let l=e;if((a=this.options.extensions)!=null&&a.startBlock){let c=1/0;const u=e.slice(1);let d;this.options.extensions.startBlock.forEach(h=>{d=h.call({lexer:this},u),typeof d=="number"&&d>=0&&(c=Math.min(c,d))}),c<1/0&&c>=0&&(l=e.substring(0,c+1))}if(this.state.top&&(o=this.tokenizer.paragraph(l))){const c=t.at(-1);n&&(c==null?void 0:c.type)==="paragraph"?(c.raw+=`
`+o.raw,c.text+=`
`+o.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=c.text):t.push(o),n=l.length!==e.length,e=e.substring(o.raw.length);continue}if(o=this.tokenizer.text(e)){e=e.substring(o.raw.length);const c=t.at(-1);(c==null?void 0:c.type)==="text"?(c.raw+=`
`+o.raw,c.text+=`
`+o.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=c.text):t.push(o);continue}if(e){const c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){var o,l,c;let n=e,s=null;if(this.tokens.links){const u=Object.keys(this.tokens.links);if(u.length>0)for(;(s=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)u.includes(s[0].slice(s[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(s=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,s.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(s=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)n=n.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let i=!1,a="";for(;e;){i||(a=""),i=!1;let u;if((l=(o=this.options.extensions)==null?void 0:o.inline)!=null&&l.some(h=>(u=h.call({lexer:this},e,t))?(e=e.substring(u.raw.length),t.push(u),!0):!1))continue;if(u=this.tokenizer.escape(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.tag(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.link(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(u.raw.length);const h=t.at(-1);u.type==="text"&&(h==null?void 0:h.type)==="text"?(h.raw+=u.raw,h.text+=u.text):t.push(u);continue}if(u=this.tokenizer.emStrong(e,n,a)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.codespan(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.br(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.del(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.autolink(e)){e=e.substring(u.raw.length),t.push(u);continue}if(!this.state.inLink&&(u=this.tokenizer.url(e))){e=e.substring(u.raw.length),t.push(u);continue}let d=e;if((c=this.options.extensions)!=null&&c.startInline){let h=1/0;const f=e.slice(1);let p;this.options.extensions.startInline.forEach(m=>{p=m.call({lexer:this},f),typeof p=="number"&&p>=0&&(h=Math.min(h,p))}),h<1/0&&h>=0&&(d=e.substring(0,h+1))}if(u=this.tokenizer.inlineText(d)){e=e.substring(u.raw.length),u.raw.slice(-1)!=="_"&&(a=u.raw.slice(-1)),i=!0;const h=t.at(-1);(h==null?void 0:h.type)==="text"?(h.raw+=u.raw,h.text+=u.text):t.push(u);continue}if(e){const h="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(h);break}else throw new Error(h)}}return t}}class ah{constructor(e){M(this,"options");M(this,"parser");this.options=e||Ii}space(e){return""}code({text:e,lang:t,escaped:n}){var a;const s=(a=(t||"").match(on.notSpaceStart))==null?void 0:a[0],i=e.replace(on.endingNewline,"")+`
`;return s?'<pre><code class="language-'+gr(s)+'">'+(n?i:gr(i,!0))+`</code></pre>
`:"<pre><code>"+(n?i:gr(i,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){const t=e.ordered,n=e.start;let s="";for(let o=0;o<e.items.length;o++){const l=e.items[o];s+=this.listitem(l)}const i=t?"ol":"ul",a=t&&n!==1?' start="'+n+'"':"";return"<"+i+a+`>
`+s+"</"+i+`>
`}listitem(e){var n;let t="";if(e.task){const s=this.checkbox({checked:!!e.checked});e.loose?((n=e.tokens[0])==null?void 0:n.type)==="paragraph"?(e.tokens[0].text=s+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=s+" "+gr(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:s+" ",text:s+" ",escaped:!0}):t+=s+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",n="";for(let i=0;i<e.header.length;i++)n+=this.tablecell(e.header[i]);t+=this.tablerow({text:n});let s="";for(let i=0;i<e.rows.length;i++){const a=e.rows[i];n="";for(let o=0;o<a.length;o++)n+=this.tablecell(a[o]);s+=this.tablerow({text:n})}return s&&(s=`<tbody>${s}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+s+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){const t=this.parser.parseInline(e.tokens),n=e.header?"th":"td";return(e.align?`<${n} align="${e.align}">`:`<${n}>`)+t+`</${n}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${gr(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:n}){const s=this.parser.parseInline(n),i=mk(e);if(i===null)return s;e=i;let a='<a href="'+e+'"';return t&&(a+=' title="'+gr(t)+'"'),a+=">"+s+"</a>",a}image({href:e,title:t,text:n}){const s=mk(e);if(s===null)return gr(n);e=s;let i=`<img src="${e}" alt="${n}"`;return t&&(i+=` title="${gr(t)}"`),i+=">",i}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:gr(e.text)}}class dy{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}}class Fn{constructor(e){M(this,"options");M(this,"renderer");M(this,"textRenderer");this.options=e||Ii,this.options.renderer=this.options.renderer||new ah,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new dy}static parse(e,t){return new Fn(t).parse(e)}static parseInline(e,t){return new Fn(t).parseInline(e)}parse(e,t=!0){var s,i;let n="";for(let a=0;a<e.length;a++){const o=e[a];if((i=(s=this.options.extensions)==null?void 0:s.renderers)!=null&&i[o.type]){const c=o,u=this.options.extensions.renderers[c.type].call({parser:this},c);if(u!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(c.type)){n+=u||"";continue}}const l=o;switch(l.type){case"space":{n+=this.renderer.space(l);continue}case"hr":{n+=this.renderer.hr(l);continue}case"heading":{n+=this.renderer.heading(l);continue}case"code":{n+=this.renderer.code(l);continue}case"table":{n+=this.renderer.table(l);continue}case"blockquote":{n+=this.renderer.blockquote(l);continue}case"list":{n+=this.renderer.list(l);continue}case"html":{n+=this.renderer.html(l);continue}case"paragraph":{n+=this.renderer.paragraph(l);continue}case"text":{let c=l,u=this.renderer.text(c);for(;a+1<e.length&&e[a+1].type==="text";)c=e[++a],u+=`
`+this.renderer.text(c);t?n+=this.renderer.paragraph({type:"paragraph",raw:u,text:u,tokens:[{type:"text",raw:u,text:u,escaped:!0}]}):n+=u;continue}default:{const c='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(c),"";throw new Error(c)}}}return n}parseInline(e,t=this.renderer){var s,i;let n="";for(let a=0;a<e.length;a++){const o=e[a];if((i=(s=this.options.extensions)==null?void 0:s.renderers)!=null&&i[o.type]){const c=this.options.extensions.renderers[o.type].call({parser:this},o);if(c!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){n+=c||"";continue}}const l=o;switch(l.type){case"escape":{n+=t.text(l);break}case"html":{n+=t.html(l);break}case"link":{n+=t.link(l);break}case"image":{n+=t.image(l);break}case"strong":{n+=t.strong(l);break}case"em":{n+=t.em(l);break}case"codespan":{n+=t.codespan(l);break}case"br":{n+=t.br(l);break}case"del":{n+=t.del(l);break}case"text":{n+=t.text(l);break}default:{const c='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(c),"";throw new Error(c)}}}return n}}class ul{constructor(e){M(this,"options");M(this,"block");this.options=e||Ii}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?Dn.lex:Dn.lexInline}provideParser(){return this.block?Fn.parse:Fn.parseInline}}M(ul,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));class n5{constructor(...e){M(this,"defaults",ry());M(this,"options",this.setOptions);M(this,"parse",this.parseMarkdown(!0));M(this,"parseInline",this.parseMarkdown(!1));M(this,"Parser",Fn);M(this,"Renderer",ah);M(this,"TextRenderer",dy);M(this,"Lexer",Dn);M(this,"Tokenizer",ih);M(this,"Hooks",ul);this.use(...e)}walkTokens(e,t){var s,i;let n=[];for(const a of e)switch(n=n.concat(t.call(this,a)),a.type){case"table":{const o=a;for(const l of o.header)n=n.concat(this.walkTokens(l.tokens,t));for(const l of o.rows)for(const c of l)n=n.concat(this.walkTokens(c.tokens,t));break}case"list":{const o=a;n=n.concat(this.walkTokens(o.items,t));break}default:{const o=a;(i=(s=this.defaults.extensions)==null?void 0:s.childTokens)!=null&&i[o.type]?this.defaults.extensions.childTokens[o.type].forEach(l=>{const c=o[l].flat(1/0);n=n.concat(this.walkTokens(c,t))}):o.tokens&&(n=n.concat(this.walkTokens(o.tokens,t)))}}return n}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(n=>{const s={...n};if(s.async=this.defaults.async||s.async||!1,n.extensions&&(n.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){const a=t.renderers[i.name];a?t.renderers[i.name]=function(...o){let l=i.renderer.apply(this,o);return l===!1&&(l=a.apply(this,o)),l}:t.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const a=t[i.level];a?a.unshift(i.tokenizer):t[i.level]=[i.tokenizer],i.start&&(i.level==="block"?t.startBlock?t.startBlock.push(i.start):t.startBlock=[i.start]:i.level==="inline"&&(t.startInline?t.startInline.push(i.start):t.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(t.childTokens[i.name]=i.childTokens)}),s.extensions=t),n.renderer){const i=this.defaults.renderer||new ah(this.defaults);for(const a in n.renderer){if(!(a in i))throw new Error(`renderer '${a}' does not exist`);if(["options","parser"].includes(a))continue;const o=a,l=n.renderer[o],c=i[o];i[o]=(...u)=>{let d=l.apply(i,u);return d===!1&&(d=c.apply(i,u)),d||""}}s.renderer=i}if(n.tokenizer){const i=this.defaults.tokenizer||new ih(this.defaults);for(const a in n.tokenizer){if(!(a in i))throw new Error(`tokenizer '${a}' does not exist`);if(["options","rules","lexer"].includes(a))continue;const o=a,l=n.tokenizer[o],c=i[o];i[o]=(...u)=>{let d=l.apply(i,u);return d===!1&&(d=c.apply(i,u)),d}}s.tokenizer=i}if(n.hooks){const i=this.defaults.hooks||new ul;for(const a in n.hooks){if(!(a in i))throw new Error(`hook '${a}' does not exist`);if(["options","block"].includes(a))continue;const o=a,l=n.hooks[o],c=i[o];ul.passThroughHooks.has(a)?i[o]=u=>{if(this.defaults.async)return Promise.resolve(l.call(i,u)).then(h=>c.call(i,h));const d=l.call(i,u);return c.call(i,d)}:i[o]=(...u)=>{let d=l.apply(i,u);return d===!1&&(d=c.apply(i,u)),d}}s.hooks=i}if(n.walkTokens){const i=this.defaults.walkTokens,a=n.walkTokens;s.walkTokens=function(o){let l=[];return l.push(a.call(this,o)),i&&(l=l.concat(i.call(this,o))),l}}this.defaults={...this.defaults,...s}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return Dn.lex(e,t??this.defaults)}parser(e,t){return Fn.parse(e,t??this.defaults)}parseMarkdown(e){return(n,s)=>{const i={...s},a={...this.defaults,...i},o=this.onError(!!a.silent,!!a.async);if(this.defaults.async===!0&&i.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof n>"u"||n===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof n!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(n)+", string expected"));a.hooks&&(a.hooks.options=a,a.hooks.block=e);const l=a.hooks?a.hooks.provideLexer():e?Dn.lex:Dn.lexInline,c=a.hooks?a.hooks.provideParser():e?Fn.parse:Fn.parseInline;if(a.async)return Promise.resolve(a.hooks?a.hooks.preprocess(n):n).then(u=>l(u,a)).then(u=>a.hooks?a.hooks.processAllTokens(u):u).then(u=>a.walkTokens?Promise.all(this.walkTokens(u,a.walkTokens)).then(()=>u):u).then(u=>c(u,a)).then(u=>a.hooks?a.hooks.postprocess(u):u).catch(o);try{a.hooks&&(n=a.hooks.preprocess(n));let u=l(n,a);a.hooks&&(u=a.hooks.processAllTokens(u)),a.walkTokens&&this.walkTokens(u,a.walkTokens);let d=c(u,a);return a.hooks&&(d=a.hooks.postprocess(d)),d}catch(u){return o(u)}}}onError(e,t){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,e){const s="<p>An error occurred:</p><pre>"+gr(n.message+"",!0)+"</pre>";return t?Promise.resolve(s):s}if(t)return Promise.reject(n);throw n}}}const Si=new n5;function Ve(r,e){return Si.parse(r,e)}Ve.options=Ve.setOptions=function(r){return Si.setOptions(r),Ve.defaults=Si.defaults,pE(Ve.defaults),Ve};Ve.getDefaults=ry;Ve.defaults=Ii;Ve.use=function(...r){return Si.use(...r),Ve.defaults=Si.defaults,pE(Ve.defaults),Ve};Ve.walkTokens=function(r,e){return Si.walkTokens(r,e)};Ve.parseInline=Si.parseInline;Ve.Parser=Fn;Ve.parser=Fn.parse;Ve.Renderer=ah;Ve.TextRenderer=dy;Ve.Lexer=Dn;Ve.lexer=Dn.lex;Ve.Tokenizer=ih;Ve.Hooks=ul;Ve.parse=Ve;Ve.options;Ve.setOptions;Ve.use;Ve.walkTokens;Ve.parseInline;Fn.parse;Dn.lex;var r5=pe("<textarea></textarea>");function s5(r,e){at(e,!0);let t=se(e,"ref",15,null),n=se(e,"value",15),s=Tt(e,["$$slots","$$events","$$legacy","ref","value","class"]);var i=r5();yO(i);let a;es(i,o=>t(o),()=>t()),Ue(o=>a=jt(i,a,{class:o,...s}),[()=>zn("border-input bg-background ring-offset-background placeholder:text-muted-foreground focus-visible:ring-ring flex min-h-[80px] w-full rounded-md border px-3 py-2 text-base focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e.class)]),Hm(i,n),q(r,i),ot()}var i5=pe('<div class="box items-center justify-center h-full text-muted-foreground space-y-4 p-4"><p class="text-lg font-medium">å¼å§ä¸ AI å©æå¯¹è¯</p> <div class="max-w-md bg-teal-50 p-4 rounded-lg border border-teal-200"><p class="text-sm text-teal-800 font-medium mb-2">æç¤ºï¼</p> <p class="text-sm text-teal-700">ä½ å¯ä»¥è®©AIå©æå¸®ä½ çæåå¤çä¿¡å·ï¼ä¾å¦ï¼</p> <ul class="list-disc pl-5 text-sm text-teal-700 mt-2 space-y-1"><li>çæä¸ä¸ªé¢çä¸º50Hzçæ­£å¼¦æ³¢ä¿¡å·</li> <li>å¯¹IDä¸ºxxxçä¿¡å·è¿è¡ä½éæ»¤æ³¢</li> <li>ååºææå¯ç¨çä¿¡å·éé</li> <li>è·åIDä¸ºxxxçä¿¡å·ééçè¯¦ç»ä¿¡æ¯</li></ul></div></div>'),a5=pe('<div class="flex-1 box justify-center"><div class="markdown-content break-words overflow-wrap-anywhere"><!></div></div>'),o5=pe('<div class="text-muted-foreground"> </div>'),l5=pe('<div class="flex items-center gap-2"><div> </div> <div class="box gap-2"><!> <!></div></div>'),c5=pe('<div class="flex-1 self-center box justify-center"><div class="text-muted-foreground"> </div></div>'),u5=pe('<div class="flex items-center gap-2"><div class="w-6 h-6 rounded-full bg-blue-600 flex items-center justify-center text-primary-foreground text-xs">AI</div> <!> <span>æèä¸­...</span></div>'),d5=pe('<div class="box gap-4 text-sm"><!> <!></div>'),h5=pe("<!> åé",1),f5=pe("<!> æ¸ç©º",1),p5=pe('<div class="box-fill"><div class="box-scroll overflow-y-auto overflow-x-hidden p-4"><!></div> <div class="border-t p-2"><form class="flex gap-2"><div class="flex-1 relative"><!></div> <div class="box gap-2"><!> <!></div></form></div></div>');function m5(r,e){at(e,!0);const[t,n]=Sh(),s=()=>Ph(rh,"$chatHistory",t);let i=rn(""),a=rn(!1),o;Os(()=>{s().length,o&&setTimeout(()=>{o.scrollTo({top:o.scrollHeight,behavior:"smooth"})},50)});async function l(){if(!A(i).trim()||A(a))return;const k=A(i).trim();de(i,"");try{de(a,!0),await u9(k)}catch(R){console.error("Error in chat:",R),gd(new ar(`Error: ${R.message}`))}finally{de(a,!1)}}function c(){Ok(rh,[])}function u(k){try{return Ve.setOptions({gfm:!0,breaks:!0}),Ve.parse(k)}catch(R){return console.error("Error parsing markdown:",R),k}}var d=p5(),h=B(d),f=B(h);{var p=k=>{var R=i5();q(k,R)},m=k=>{var R=d5(),D=B(R);jn(D,1,s,Er,($,P)=>{var E=Fe();const O=ze(()=>A(P).getType());var I=ke(E);{var T=W=>{const ee=ze(()=>A(O)==="human"?"bg-muted":"bg-card");dk(W,{get class(){return A(ee)},children:(Z,X)=>{hk(Z,{class:"p-2",children:(U,G)=>{var le=l5(),he=B(le),Dt=B(he,!0);z(he);var vt=V(he,2),lt=B(vt);{var _t=dn=>{var qt=a5(),Cn=B(qt),Ci=B(Cn);AO(Ci,()=>u(A(P).content)),z(Cn),z(qt),q(dn,qt)};Qe(lt,dn=>{A(P).content&&dn(_t)})}var Ut=V(lt,2);{var hr=dn=>{var qt=o5(),Cn=B(qt,!0);z(qt),Ue(()=>yt(Cn,A(P).tool_calls[0].name==="await_user_input"?"è¯·æ±ç¨æ·è¾å¥":"è¯·æ±è°ç¨å·¥å·")),q(dn,qt)};Qe(Ut,dn=>{A(P).tool_calls&&A(P).tool_calls.length>0&&dn(hr)})}z(vt),z(le),Ue(()=>{vb(he,1,`
                      self-start shrink-0 w-6 h-6 rounded-full flex items-center justify-center text-xs text-primary-foreground
                      ${A(O)==="human"?"bg-primary":"bg-blue-600"}`),yt(Dt,A(O)==="human"?"æ":"AI")}),q(U,le)},$$slots:{default:!0}})},$$slots:{default:!0}})},j=(W,ee)=>{{var Z=X=>{var U=c5(),G=B(U),le=B(G,!0);z(G),z(U),Ue(()=>yt(le,A(P).name==="await_user_input"?"ç­å¾ç¨æ·è¾å¥":"å·¥å·è°ç¨ç»æ")),q(X,U)};Qe(W,X=>{["tool"].includes(A(O))&&X(Z)},ee)}};Qe(I,W=>{["human","ai"].includes(A(O))?W(T):W(j,!1)})}q($,E)});var C=V(D,2);{var N=$=>{dk($,{class:"text-sm",children:(P,E)=>{hk(P,{class:"p-2",children:(O,I)=>{var T=u5(),j=V(B(T),2);b9(j,{class:"h-4 w-4 animate-spin"}),Jn(2),z(T),q(O,T)},$$slots:{default:!0}})},$$slots:{default:!0}})};Qe(C,$=>{A(a)&&$(N)})}z(R),q(k,R)};Qe(f,k=>{s().length<=1?k(p):k(m,!1)})}z(h),es(h,k=>o=k,()=>o);var g=V(h,2),b=B(g),_=B(b),y=B(_);s5(y,{class:"h-full min-h-full whitespace-pre-wrap break-words overflow-wrap-anywhere",placeholder:"è¾å¥æ¶æ¯...",onkeydown:k=>{k.key==="Enter"&&!k.shiftKey&&(k.preventDefault(),l())},get value(){return A(i)},set value(k){de(i,k,!0)}}),z(_);var w=V(_,2),v=B(w);const x=ze(()=>A(a)||!A(i).trim());fl(v,{type:"submit",get disabled(){return A(x)},children:(k,R)=>{var D=h5(),C=ke(D);y9(C,{class:"h-4 w-4 mr-2"}),Jn(),q(k,D)},$$slots:{default:!0}});var S=V(v,2);fl(S,{type:"button",variant:"outline",$$events:{click:c},children:(k,R)=>{var D=f5(),C=ke(D);w9(C,{class:"h-4 w-4 mr-2"}),Jn(),q(k,D)},$$slots:{default:!0}}),z(w),z(b),z(g),z(d),la("submit",b,k=>{k.preventDefault(),l()}),q(r,d),ot(),n()}var g5=pe("<option> </option>"),b5=pe("<option> </option>"),_5=pe("<!> éç½®",1),y5=pe('<div class="box gap-4"><div class="box gap-2"><h2 class="text-xl font-semibold">LLM éç½®</h2> <p class="text-sm text-muted-foreground">éç½® LLM æä¾ååæ¨¡åè®¾ç½®</p></div> <div class="box gap-4"><div class="box gap-2"><label for="provider" class="text-sm font-medium">æä¾å</label> <select id="provider" class="w-full p-2 border rounded-md"></select></div> <div class="box gap-2"><label for="model" class="text-sm font-medium">æ¨¡å</label> <select id="model" class="w-full p-2 border rounded-md"></select></div> <div class="box gap-2"><label for="apiKey" class="text-sm font-medium">API å¯é¥</label> <!></div> <div class="box gap-2"><label for="temperature" class="text-sm font-medium"> </label> <!></div> <div class="box gap-2"><label for="maxTokens" class="text-sm font-medium">æå¤§ Token æ°</label> <!></div> <div class="box gap-2"><label for="baseUrl" class="text-sm font-medium">èªå®ä¹ API ç«¯ç¹ (å¯é)</label> <!></div></div> <div class="flex justify-between"><!></div></div>');function w5(r,e){at(e,!0);const[t,n]=Sh();let i=rn(xh(Ph(ob,"$llmConfig",t)));const a=h9();let o=ze(()=>d9(A(i)));function l(){de(i,hE,!0)}Os(()=>{Ok(ob,A(i)),A(o).includes(A(i).model)||(A(i).model=A(o)[0])});var c=y5(),u=V(B(c),2),d=B(u),h=V(B(d),2);jn(h,21,()=>a,Er,(C,N)=>{var $=g5(),P={},E=B($,!0);z($),Ue(()=>{P!==(P=A(N).id)&&($.value=($.__value=A(N).id)??""),yt(E,A(N).name)}),q(C,$)}),z(h),z(d);var f=V(d,2),p=V(B(f),2);jn(p,21,()=>A(o),Er,(C,N)=>{var $=b5(),P={},E=B($,!0);z($),Ue(()=>{P!==(P=A(N))&&($.value=($.__value=A(N))??""),yt(E,A(N))}),q(C,$)}),z(p),z(f);var m=V(f,2),g=V(B(m),2);Jt(g,{id:"apiKey",type:"password",placeholder:"è¾å¥ API å¯é¥",get value(){return A(i).apiKey},set value(C){A(i).apiKey=C}}),z(m);var b=V(m,2),_=B(b),y=B(_);z(_);var w=V(_,2);Jt(w,{id:"temperature",type:"range",min:"0",max:"1",step:"0.1",get value(){return A(i).temperature},set value(C){A(i).temperature=C}}),z(b);var v=V(b,2),x=V(B(v),2);Jt(x,{id:"maxTokens",type:"number",min:"1",max:"4000",get value(){return A(i).maxTokens},set value(C){A(i).maxTokens=C}}),z(v);var S=V(v,2),k=V(B(S),2);Jt(k,{id:"baseUrl",type:"text",placeholder:"https://api.example.com/v1",get value(){return A(i).baseUrl},set value(C){A(i).baseUrl=C}}),z(S),z(u);var R=V(u,2),D=B(R);fl(D,{variant:"outline",$$events:{click:l},children:(C,N)=>{var $=_5(),P=ke($);_9(P,{class:"h-4 w-4 mr-2"}),Jn(),q(C,$)},$$slots:{default:!0}}),z(R),z(c),Ue(()=>yt(y,`æ¸©åº¦ (${A(i).temperature??""})`)),dl(h,()=>A(i).provider,C=>A(i).provider=C),dl(p,()=>A(i).model,C=>A(i).model=C),q(r,c),ot(),n()}function PE(r){return r?"":void 0}function v5(r){return r?"true":"false"}function x5(r){return r?!0:void 0}function k5(r){return r?!0:void 0}const cb="ArrowDown",hy="ArrowLeft",fy="ArrowRight",ub="ArrowUp",S5="End",P5="Enter",A5="Home",E5=" ";function O5(r){return window.getComputedStyle(r).getPropertyValue("direction")}function T5(r="ltr",e="horizontal"){return{horizontal:r==="rtl"?hy:fy,vertical:cb}[e]}function R5(r="ltr",e="horizontal"){return{horizontal:r==="rtl"?fy:hy,vertical:ub}[e]}function I5(r="ltr",e="horizontal"){return["ltr","rtl"].includes(r)||(r="ltr"),["horizontal","vertical"].includes(e)||(e="horizontal"),{nextKey:T5(r,e),prevKey:R5(r,e)}}const C5=typeof document<"u";function $5(r){const e=me(null);function t(){if(!C5)return[];const a=document.getElementById(r.rootNodeId.current);return a?r.candidateSelector?Array.from(a.querySelectorAll(r.candidateSelector)):Array.from(a.querySelectorAll(`[${r.candidateAttr}]:not([data-disabled])`)):[]}function n(){var o;const a=t();a.length&&((o=a[0])==null||o.focus())}function s(a,o,l=!1){var y;const c=document.getElementById(r.rootNodeId.current);if(!c||!a)return;const u=t();if(!u.length)return;const d=u.indexOf(a),h=O5(c),{nextKey:f,prevKey:p}=I5(h,r.orientation.current),m=r.loop.current,g={[f]:d+1,[p]:d-1,[A5]:0,[S5]:u.length-1};if(l){const w=f===cb?fy:cb,v=p===ub?hy:ub;g[w]=d+1,g[v]=d-1}let b=g[o.key];if(b===void 0)return;o.preventDefault(),b<0&&m?b=u.length-1:b===u.length&&m&&(b=0);const _=u[b];if(_)return _.focus(),e.current=_.id,(y=r.onCandidateFocus)==null||y.call(r,_),_}function i(a){const o=t(),l=e.current!==null;return a&&!l&&o[0]===a?(e.current=a.id,0):(a==null?void 0:a.id)===e.current?0:-1}return{setCurrentTabStopId(a){e.current=a},getTabIndex:i,handleKeydown:s,focusFirstCandidate:n,currentTabStopId:e}}globalThis.bitsIdCounter??(globalThis.bitsIdCounter={current:0});function pf(r="bits"){return globalThis.bitsIdCounter.current++,`${r}-${globalThis.bitsIdCounter.current}`}function M5(){}const N5="data-tabs-root",L5="data-tabs-list",AE="data-tabs-trigger",j5="data-tabs-content";var ac,oc;class D5{constructor(e){M(this,"opts");M(this,"rovingFocusGroup");ye(this,ac,rn(xh([])));M(this,"valueToTriggerId",new Ad);M(this,"valueToContentId",new Ad);ye(this,oc,ze(()=>({id:this.opts.id.current,"data-orientation":this.opts.orientation.current,[N5]:""})));this.opts=e,Oi(e),this.rovingFocusGroup=$5({candidateAttr:AE,rootNodeId:this.opts.id,loop:this.opts.loop,orientation:this.opts.orientation})}get triggerIds(){return A(F(this,ac))}set triggerIds(e){de(F(this,ac),e,!0)}registerTrigger(e,t){return this.triggerIds.push(e),this.valueToTriggerId.set(t,e),()=>{this.triggerIds=this.triggerIds.filter(n=>n!==e),this.valueToTriggerId.delete(t)}}registerContent(e,t){return this.valueToContentId.set(t,e),()=>{this.valueToContentId.delete(t)}}setValue(e){this.opts.value.current=e}get props(){return A(F(this,oc))}set props(e){de(F(this,oc),e)}}ac=new WeakMap,oc=new WeakMap;var bh,lc;class F5{constructor(e,t){M(this,"opts");M(this,"root");ye(this,bh,ze(()=>this.root.opts.disabled.current));ye(this,lc,ze(()=>({id:this.opts.id.current,role:"tablist","aria-orientation":this.root.opts.orientation.current,"data-orientation":this.root.opts.orientation.current,[L5]:"","data-disabled":PE(A(F(this,bh)))})));this.opts=e,this.root=t,Oi(e)}get props(){return A(F(this,lc))}set props(e){de(F(this,lc),e)}}bh=new WeakMap,lc=new WeakMap;var xa,ws,ka,_h,Sa,bd,cc;class z5{constructor(e,t){ye(this,Sa);M(this,"opts");M(this,"root");ye(this,xa,ze(()=>this.root.opts.value.current===this.opts.value.current));ye(this,ws,ze(()=>this.opts.disabled.current||this.root.opts.disabled.current));ye(this,ka,rn(0));ye(this,_h,ze(()=>this.root.valueToContentId.get(this.opts.value.current)));ye(this,cc,ze(()=>({id:this.opts.id.current,role:"tab","data-state":EE(A(F(this,xa))),"data-value":this.opts.value.current,"data-orientation":this.root.opts.orientation.current,"data-disabled":PE(A(F(this,ws))),"aria-selected":v5(A(F(this,xa))),"aria-controls":A(F(this,_h)),[AE]:"",disabled:k5(A(F(this,ws))),tabindex:A(F(this,ka)),onclick:this.onclick,onfocus:this.onfocus,onkeydown:this.onkeydown})));this.opts=e,this.root=t,Oi(e),As([()=>this.opts.id.current,()=>this.opts.value.current],([n,s])=>this.root.registerTrigger(n,s)),Os(()=>{this.root.triggerIds.length,A(F(this,xa))||!this.root.opts.value.current?de(F(this,ka),0):de(F(this,ka),-1)}),this.onfocus=this.onfocus.bind(this),this.onclick=this.onclick.bind(this),this.onkeydown=this.onkeydown.bind(this)}onfocus(e){this.root.opts.activationMode.current!=="automatic"||A(F(this,ws))||Us(this,Sa,bd).call(this)}onclick(e){A(F(this,ws))||Us(this,Sa,bd).call(this)}onkeydown(e){if(!A(F(this,ws))){if(e.key===E5||e.key===P5){e.preventDefault(),Us(this,Sa,bd).call(this);return}this.root.rovingFocusGroup.handleKeydown(this.opts.ref.current,e)}}get props(){return A(F(this,cc))}set props(e){de(F(this,cc),e)}}xa=new WeakMap,ws=new WeakMap,ka=new WeakMap,_h=new WeakMap,Sa=new WeakSet,bd=function(){this.root.opts.value.current!==this.opts.value.current&&this.root.setValue(this.opts.value.current)},cc=new WeakMap;var uc,yh,dc;class B5{constructor(e,t){M(this,"opts");M(this,"root");ye(this,uc,ze(()=>this.root.opts.value.current===this.opts.value.current));ye(this,yh,ze(()=>this.root.valueToTriggerId.get(this.opts.value.current)));ye(this,dc,ze(()=>({id:this.opts.id.current,role:"tabpanel",hidden:x5(!A(F(this,uc))),tabindex:0,"data-value":this.opts.value.current,"data-state":EE(A(F(this,uc))),"aria-labelledby":A(F(this,yh)),[j5]:""})));this.opts=e,this.root=t,Oi(e),As([()=>this.opts.id.current,()=>this.opts.value.current],([n,s])=>this.root.registerContent(n,s))}get props(){return A(F(this,dc))}set props(e){de(F(this,dc),e)}}uc=new WeakMap,yh=new WeakMap,dc=new WeakMap;const mf=new g1("Tabs.Root");function U5(r){return mf.set(new D5(r))}function q5(r){return new z5(r,mf.get())}function H5(r){return new F5(r,mf.get())}function W5(r){return new B5(r,mf.get())}function EE(r){return r?"active":"inactive"}var V5=pe("<div><!></div>");function G5(r,e){at(e,!0);let t=se(e,"id",19,pf),n=se(e,"ref",15,null),s=se(e,"value",15,""),i=se(e,"onValueChange",3,M5),a=se(e,"orientation",3,"horizontal"),o=se(e,"loop",3,!0),l=se(e,"activationMode",3,"automatic"),c=se(e,"disabled",3,!1),u=Tt(e,["$$slots","$$events","$$legacy","id","ref","value","onValueChange","orientation","loop","activationMode","disabled","children","child"]);const d=U5({id:me.with(()=>t()),value:me.with(()=>s(),b=>{s(b),i()(b)}),orientation:me.with(()=>a()),loop:me.with(()=>o()),activationMode:me.with(()=>l()),disabled:me.with(()=>c()),ref:me.with(()=>n(),b=>n(b))}),h=ze(()=>Ei(u,d.props));var f=Fe(),p=ke(f);{var m=b=>{var _=Fe(),y=ke(_);kt(y,()=>e.child,()=>({props:A(h)})),q(b,_)},g=b=>{var _=V5();let y;var w=B(_);kt(w,()=>e.children??Rn),z(_),Ue(()=>y=jt(_,y,{...A(h)})),q(b,_)};Qe(p,b=>{e.child?b(m):b(g,!1)})}q(r,f),ot()}var Z5=pe("<div><!></div>");function J5(r,e){at(e,!0);let t=se(e,"id",19,pf),n=se(e,"ref",15,null),s=Tt(e,["$$slots","$$events","$$legacy","children","child","id","ref","value"]);const i=W5({value:me.with(()=>e.value),id:me.with(()=>t()),ref:me.with(()=>n(),d=>n(d))}),a=ze(()=>Ei(s,i.props));var o=Fe(),l=ke(o);{var c=d=>{var h=Fe(),f=ke(h);kt(f,()=>e.child,()=>({props:A(a)})),q(d,h)},u=d=>{var h=Z5();let f;var p=B(h);kt(p,()=>e.children??Rn),z(h),Ue(()=>f=jt(h,f,{...A(a)})),q(d,h)};Qe(l,d=>{e.child?d(c):d(u,!1)})}q(r,o),ot()}var K5=pe("<div><!></div>");function X5(r,e){at(e,!0);let t=se(e,"id",19,pf),n=se(e,"ref",15,null),s=Tt(e,["$$slots","$$events","$$legacy","child","children","id","ref"]);const i=H5({id:me.with(()=>t()),ref:me.with(()=>n(),d=>n(d))}),a=ze(()=>Ei(s,i.props));var o=Fe(),l=ke(o);{var c=d=>{var h=Fe(),f=ke(h);kt(f,()=>e.child,()=>({props:A(a)})),q(d,h)},u=d=>{var h=K5();let f;var p=B(h);kt(p,()=>e.children??Rn),z(h),Ue(()=>f=jt(h,f,{...A(a)})),q(d,h)};Qe(l,d=>{e.child?d(c):d(u,!1)})}q(r,o),ot()}var Y5=pe("<button><!></button>");function Q5(r,e){at(e,!0);let t=se(e,"disabled",3,!1),n=se(e,"id",19,pf),s=se(e,"type",3,"button"),i=se(e,"ref",15,null),a=Tt(e,["$$slots","$$events","$$legacy","child","children","disabled","id","type","value","ref"]);const o=q5({id:me.with(()=>n()),disabled:me.with(()=>t()??!1),value:me.with(()=>e.value),ref:me.with(()=>i(),f=>i(f))}),l=ze(()=>Ei(a,o.props,{type:s()}));var c=Fe(),u=ke(c);{var d=f=>{var p=Fe(),m=ke(p);kt(m,()=>e.child,()=>({props:A(l)})),q(f,p)},h=f=>{var p=Y5();let m;var g=B(p);kt(g,()=>e.children??Rn),z(p),Ue(()=>m=jt(p,m,{...A(l)})),q(f,p)};Qe(u,f=>{e.child?f(d):f(h,!1)})}q(r,c),ot()}function Gu(r,e){at(e,!0);let t=se(e,"ref",15,null),n=Tt(e,["$$slots","$$events","$$legacy","ref","class"]);var s=Fe(),i=ke(s);const a=ze(()=>zn("ring-offset-background focus-visible:ring-ring mt-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2",e.class));fc(i,()=>J5,(o,l)=>{l(o,Ir({get class(){return A(a)}},()=>n,{get ref(){return t()},set ref(c){t(c)}}))}),q(r,s),ot()}function eq(r,e){at(e,!0);let t=se(e,"ref",15,null),n=Tt(e,["$$slots","$$events","$$legacy","ref","class"]);var s=Fe(),i=ke(s);const a=ze(()=>zn("bg-muted text-muted-foreground inline-flex h-10 items-center justify-center rounded-md p-1",e.class));fc(i,()=>X5,(o,l)=>{l(o,Ir({get class(){return A(a)}},()=>n,{get ref(){return t()},set ref(c){t(c)}}))}),q(r,s),ot()}function Zu(r,e){at(e,!0);let t=se(e,"ref",15,null),n=Tt(e,["$$slots","$$events","$$legacy","ref","class"]);var s=Fe(),i=ke(s);const a=ze(()=>zn("ring-offset-background focus-visible:ring-ring data-[state=active]:bg-background data-[state=active]:text-foreground inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm",e.class));fc(i,()=>Q5,(o,l)=>{l(o,Ir({get class(){return A(a)}},()=>n,{get ref(){return t()},set ref(c){t(c)}}))}),q(r,s),ot()}const tq=G5;var nq=pe('<div class="border-b p-4 flex-none"><h2 class="text-xl font-semibold">éé</h2> <p class="text-sm text-muted-foreground">æ¥çåç®¡çä¿¡å·éé</p></div> <div class="flex-1 min-h-0 overflow-hidden flex"><!></div>',1),rq=pe("<!> <!> <!> <!>",1),sq=pe("<!> <!> <!> <!> <!>",1),iq=pe('<div class="border-b p-4 flex-none"><h2 class="text-xl font-semibold">ä¿¡å·æä½</h2> <p class="text-sm text-muted-foreground">çæåå¤çä¿¡å·</p></div> <div class="box-fill"><!></div>',1),aq=pe("<!> <!> <!>",1),oq=pe('<div class="h-screen bg-background box-fill"><header class="border-b flex-none"><div class="container py-4"><h1 class="text-3xl font-bold tracking-tight">ä¿¡å·åæå¨</h1> <p class="text-muted-foreground">çæãå¤çååæä¿¡å·</p></div></header> <main class="box-fill"><div class="box-fill"><!></div></main></div>');function hH(r){let e=rn(void 0);var t=oq(),n=V(B(t),2),s=B(n),i=B(s);E1(i,{direction:"horizontal",class:"box-fill",children:(a,o)=>{var l=aq(),c=ke(l);Od(c,{class:"h-full box-fill",minSize:50,defaultSize:65,children:(h,f)=>{var p=nq(),m=V(ke(p),2),g=B(m);o2(g,{get selectedChannelId(){return A(e)},set selectedChannelId(b){de(e,b,!0)}}),z(m),q(h,p)},$$slots:{default:!0}});var u=V(c,2);A1(u,{withHandle:!0});var d=V(u,2);Od(d,{class:"h-full box-fill",minSize:20,children:(h,f)=>{var p=iq(),m=V(ke(p),2),g=B(m);tq(g,{value:"generate",class:"box-fill",children:(b,_)=>{var y=sq(),w=ke(y);eq(w,{class:"m-4 mb-2 grid grid-cols-4",children:(R,D)=>{var C=rq(),N=ke(C);Zu(N,{value:"generate",children:(O,I)=>{Jn();var T=ni("çæä¿¡å·");q(O,T)},$$slots:{default:!0}});var $=V(N,2);Zu($,{value:"process",children:(O,I)=>{Jn();var T=ni("å¤çä¿¡å·");q(O,T)},$$slots:{default:!0}});var P=V($,2);Zu(P,{value:"chat",children:(O,I)=>{Jn();var T=ni("AI å©æ");q(O,T)},$$slots:{default:!0}});var E=V(P,2);Zu(E,{value:"config",children:(O,I)=>{Jn();var T=ni("LLM éç½®");q(O,T)},$$slots:{default:!0}}),q(R,C)},$$slots:{default:!0}});var v=V(w,2);Gu(v,{value:"generate",class:"box-scroll border-t p-4",children:(R,D)=>{_R(R,{})},$$slots:{default:!0}});var x=V(v,2);Gu(x,{value:"process",class:"box-scroll border-t p-4",children:(R,D)=>{RR(R,{get selectedChannelId(){return A(e)},set selectedChannelId(C){de(e,C,!0)}})},$$slots:{default:!0}});var S=V(x,2);Gu(S,{value:"chat",class:"box-fill border-t",children:(R,D)=>{m5(R,{})},$$slots:{default:!0}});var k=V(S,2);Gu(k,{value:"config",class:"box-scroll border-t p-4",children:(R,D)=>{w5(R,{})},$$slots:{default:!0}}),q(b,y)},$$slots:{default:!0}}),z(m),q(h,p)},$$slots:{default:!0}}),q(a,l)},$$slots:{default:!0}}),z(s),z(n),z(t),q(r,t)}export{hH as component};
