var $E=Object.defineProperty;var ME=Object.getPrototypeOf;var NE=Reflect.get;var _y=r=>{throw TypeError(r)};var LE=(r,e,t)=>e in r?$E(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var $=(r,e,t)=>LE(r,typeof e!="symbol"?e+"":e,t),yf=(r,e,t)=>e.has(r)||_y("Cannot "+t);var F=(r,e,t)=>(yf(r,e,"read from private field"),t?t.call(r):e.get(r)),ye=(r,e,t)=>e.has(r)?_y("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),eo=(r,e,t,n)=>(yf(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),Us=(r,e,t)=>(yf(r,e,"access private method"),t);var yy=(r,e,t)=>NE(ME(r),t,e);import{b as Fm,e as jE,c as ze,a as q,t as fe,d as ni,n as mk}from"../chunks/d9qGaLUB.js";import{ah as gk,au as bk,av as DE,I as oa,h as et,C as cb,B as _k,H as Aa,b as ub,j as P,a0 as fc,K as FE,L as wy,M as oi,c as xr,al as zE,N as db,a as vh,O as yk,aw as wk,ao as vk,V as nn,aa as qr,ax as wf,R as BE,F as zm,ay as hb,az as UE,aA as fb,aB as vy,aC as qE,ad as HE,aD as WE,d as pb,aE as VE,aj as xk,am as GE,ak as ZE,E as JE,aF as KE,aG as XE,aH as YE,aI as QE,aJ as eO,aK as tO,g as xh,Q as mb,P as kk,aL as nO,W as de,aM as rO,as as Sk,p as at,o as ke,q as ot,s as B,n as In,v as z,t as Ue,w as V,aN as Bm,aO as Kn,aP as sO,aQ as iO,k as aO,ar as rn,a3 as pc,at as Ne,u as oO,f as Os,aR as lO,aS as xy,aT as cO}from"../chunks/ixtH5zbp.js";import{i as kh}from"../chunks/D0-JovLt.js";import{i as uO,a as dO,c as hO,d as fO,b as pO,n as mO,e as gO,f as bO,l as gb,g as la,s as yt,o as ms,r as _O}from"../chunks/C7W07q0B.js";import{p as se,i as Qe,b as es,r as Tt,s as bb,a as _b,d as Rr,c as mc,l as Ea,e as yO}from"../chunks/CYpfN_IN.js";import{w as Pk,o as Ak,a as wO,g as Ek}from"../chunks/ZhjlL-g9.js";import{s as kt}from"../chunks/CCtTOmwb.js";const vO=[];function xO(r,e=!1){return Qu(r,new Map,"",vO)}function Qu(r,e,t,n,s=null){if(typeof r=="object"&&r!==null){var i=e.get(r);if(i!==void 0)return i;if(r instanceof Map)return new Map(r);if(r instanceof Set)return new Set(r);if(gk(r)){var a=Array(r.length);e.set(r,a),s!==null&&e.set(s,a);for(var o=0;o<r.length;o+=1){var l=r[o];o in r&&(a[o]=Qu(l,e,t,n))}return a}if(bk(r)===DE){a={},e.set(r,a),s!==null&&e.set(s,a);for(var c in r)a[c]=Qu(r[c],e,t,n);return a}if(r instanceof Date)return structuredClone(r);if(typeof r.toJSON=="function")return Qu(r.toJSON(),e,t,n,r)}if(r instanceof EventTarget)return r;try{return structuredClone(r)}catch{return r}}function Ar(r,e){return e}function kO(r,e,t,n){for(var s=[],i=e.length,a=0;a<i;a++)qE(e[a].e,s,!0);var o=i>0&&s.length===0&&t!==null;if(o){var l=t.parentNode;HE(l),l.append(t),n.clear(),gs(r,e[0].prev,e[i-1].next)}WE(s,()=>{for(var c=0;c<i;c++){var u=e[c];o||(n.delete(u.k),gs(r,u.prev,u.next)),pb(u.e,!o)}})}function Dn(r,e,t,n,s,i=null){var a=r,o={flags:e,items:new Map,first:null},l=(e&wk)!==0;if(l){var c=r;a=et?oa(cb(c)):c.appendChild(_k())}et&&Aa();var u=null,d=!1,h=fc(()=>{var f=t();return gk(f)?f:f==null?[]:vk(f)});ub(()=>{var f=P(h),p=f.length;if(d&&p===0)return;d=p===0;let m=!1;if(et){var g=a.data===FE;g!==(p===0)&&(a=wy(),oa(a),oi(!1),m=!0)}if(et){for(var b=null,_,y=0;y<p;y++){if(xr.nodeType===8&&xr.data===zE){a=xr,m=!0,oi(!1);break}var w=f[y],v=n(w,y);_=Ok(xr,o,b,null,w,v,y,s,e,t),o.items.set(v,_),b=_}p>0&&oa(wy())}et||SO(f,o,a,s,e,n,t),i!==null&&(p===0?u?db(u):u=vh(()=>i(a)):u!==null&&yk(u,()=>{u=null})),m&&oi(!0),P(h)}),et&&(a=xr)}function SO(r,e,t,n,s,i,a){var A,E,O,I;var o=(s&UE)!==0,l=(s&(fb|hb))!==0,c=r.length,u=e.items,d=e.first,h=d,f,p=null,m,g=[],b=[],_,y,w,v;if(o)for(v=0;v<c;v+=1)_=r[v],y=i(_,v),w=u.get(y),w!==void 0&&((A=w.a)==null||A.measure(),(m??(m=new Set)).add(w));for(v=0;v<c;v+=1){if(_=r[v],y=i(_,v),w=u.get(y),w===void 0){var x=h?h.e.nodes_start:t;p=Ok(x,e,p,p===null?e.first:p.next,_,y,v,n,s,a),u.set(y,p),g=[],b=[],h=p.next;continue}if(l&&PO(w,_,v,s),(w.e.f&wf)!==0&&(db(w.e),o&&((E=w.a)==null||E.unfix(),(m??(m=new Set)).delete(w))),w!==h){if(f!==void 0&&f.has(w)){if(g.length<b.length){var k=b[0],S;p=k.prev;var R=g[0],D=g[g.length-1];for(S=0;S<g.length;S+=1)ky(g[S],k,t);for(S=0;S<b.length;S+=1)f.delete(b[S]);gs(e,R.prev,D.next),gs(e,p,R),gs(e,D,k),h=k,p=D,v-=1,g=[],b=[]}else f.delete(w),ky(w,h,t),gs(e,w.prev,w.next),gs(e,w,p===null?e.first:p.next),gs(e,p,w),p=w;continue}for(g=[],b=[];h!==null&&h.k!==y;)(h.e.f&wf)===0&&(f??(f=new Set)).add(h),b.push(h),h=h.next;if(h===null)continue;w=h}g.push(w),p=w,h=w.next}if(h!==null||f!==void 0){for(var M=f===void 0?[]:vk(f);h!==null;)(h.e.f&wf)===0&&M.push(h),h=h.next;var N=M.length;if(N>0){var C=(s&wk)!==0&&c===0?t:null;if(o){for(v=0;v<N;v+=1)(O=M[v].a)==null||O.measure();for(v=0;v<N;v+=1)(I=M[v].a)==null||I.fix()}kO(e,M,C,u)}}o&&BE(()=>{var T;if(m!==void 0)for(w of m)(T=w.a)==null||T.apply()}),zm.first=e.first&&e.first.e,zm.last=p&&p.e}function PO(r,e,t,n){(n&fb)!==0&&vy(r.v,e),(n&hb)!==0?vy(r.i,t):r.i=t}function Ok(r,e,t,n,s,i,a,o,l,c){var u=(l&fb)!==0,d=(l&VE)===0,h=u?d?nn(s):qr(s):s,f=(l&hb)===0?a:qr(a),p={i:f,v:h,k:i,a:null,e:null,prev:t,next:n};try{return p.e=vh(()=>o(r,h,f,c),et),p.e.prev=t&&t.e,p.e.next=n&&n.e,t===null?e.first=p:(t.next=p,t.e.next=p.e),n!==null&&(n.prev=p,n.e.prev=p.e),p}finally{}}function ky(r,e,t){for(var n=r.next?r.next.e.nodes_start:t,s=e?e.e.nodes_start:t,i=r.e.nodes_start;i!==n;){var a=xk(i);s.before(i),i=a}}function gs(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function AO(r,e,t,n,s){var i=r,a="",o;ub(()=>{if(a===(a=e()??"")){et&&Aa();return}o!==void 0&&(pb(o),o=void 0),a!==""&&(o=vh(()=>{if(et){xr.data;for(var l=Aa(),c=l;l!==null&&(l.nodeType!==8||l.data!=="");)c=l,l=xk(l);if(l===null)throw GE(),ZE;Fm(xr,c),i=oa(l);return}var u=a+"",d=jE(u);Fm(cb(d),d.lastChild),i.before(d)}))})}function gc(r,e,t,n,s){var o;et&&Aa();var i=(o=e.$$slots)==null?void 0:o[t],a=!1;i===!0&&(i=e.children,a=!0),i===void 0||i(r,a?()=>n:n)}function Tk(r,e,t,n,s,i){let a=et;et&&Aa();var o,l,c=null;et&&xr.nodeType===1&&(c=xr,Aa());var u=et?xr:r,d;ub(()=>{const h=e()||null;var f=KE;h!==o&&(d&&(h===null?yk(d,()=>{d=null,l=null}):h===l?db(d):pb(d)),h&&h!==l&&(d=vh(()=>{if(c=et?c:document.createElementNS(f,h),Fm(c,c),n){et&&uO(h)&&c.append(document.createComment(""));var p=et?cb(c):c.appendChild(_k());et&&(p===null?oi(!1):oa(p)),n(c,p)}zm.nodes_end=c,u.before(c)})),o=h,o&&(l=o))},JE),a&&(oi(!0),oa(u))}function Rk(r){var e,t,n="";if(typeof r=="string"||typeof r=="number")n+=r;else if(typeof r=="object")if(Array.isArray(r)){var s=r.length;for(e=0;e<s;e++)r[e]&&(t=Rk(r[e]))&&(n&&(n+=" "),n+=t)}else for(t in r)r[t]&&(n&&(n+=" "),n+=t);return n}function Jo(){for(var r,e,t=0,n="",s=arguments.length;t<s;t++)(r=arguments[t])&&(e=Rk(r))&&(n&&(n+=" "),n+=e);return n}function EO(r){return typeof r=="object"?Jo(r):r??""}const Sy=[...` 	
\r\fÂ \v\uFEFF`];function OO(r,e,t){var n=r==null?"":""+r;if(t){for(var s in t)if(t[s])n=n?n+" "+s:s;else if(n.length)for(var i=s.length,a=0;(a=n.indexOf(s,a))>=0;){var o=a+i;(a===0||Sy.includes(n[a-1]))&&(o===n.length||Sy.includes(n[o]))?n=(a===0?"":n.substring(0,a))+n.substring(o+1):a=o}}return n===""?null:n}function Py(r,e=!1){var t=e?" !important;":";",n="";for(var s in r){var i=r[s];i!=null&&i!==""&&(n+=" "+s+": "+i+t)}return n}function vf(r){return r[0]!=="-"||r[1]!=="-"?r.toLowerCase():r}function TO(r,e){if(e){var t="",n,s;if(Array.isArray(e)?(n=e[0],s=e[1]):n=e,r){r=String(r).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var i=!1,a=0,o=!1,l=[];n&&l.push(...Object.keys(n).map(vf)),s&&l.push(...Object.keys(s).map(vf));var c=0,u=-1;const m=r.length;for(var d=0;d<m;d++){var h=r[d];if(o?h==="/"&&r[d-1]==="*"&&(o=!1):i?i===h&&(i=!1):h==="/"&&r[d+1]==="*"?o=!0:h==='"'||h==="'"?i=h:h==="("?a++:h===")"&&a--,!o&&i===!1&&a===0){if(h===":"&&u===-1)u=d;else if(h===";"||d===m-1){if(u!==-1){var f=vf(r.substring(c,u).trim());if(!l.includes(f)){h!==";"&&d++;var p=r.substring(c,d).trim();t+=" "+p+";"}}c=d+1,u=-1}}}}return n&&(t+=Py(n)),s&&(t+=Py(s,!0)),t=t.trim(),t===""?null:t}return r==null?null:String(r)}function yb(r,e,t,n,s,i){var a=r.__className;if(et||a!==t||a===void 0){var o=OO(t,n,i);(!et||o!==r.getAttribute("class"))&&(o==null?r.removeAttribute("class"):e?r.className=o:r.setAttribute("class",o)),r.__className=t}else if(i&&s!==i)for(var l in i){var c=!!i[l];(s==null||c!==!!s[l])&&r.classList.toggle(l,c)}return i}function xf(r,e={},t,n){for(var s in t){var i=t[s];e[s]!==i&&(t[s]==null?r.style.removeProperty(s):r.style.setProperty(s,i,n))}}function RO(r,e,t,n){var s=r.__style;if(et||s!==e){var i=TO(e,n);(!et||i!==r.getAttribute("style"))&&(i==null?r.removeAttribute("style"):r.style.cssText=i),r.__style=e}else n&&(Array.isArray(n)?(xf(r,t==null?void 0:t[0],n[0]),xf(r,t==null?void 0:t[1],n[1],"important")):xf(r,t,n));return n}const to=Symbol("class"),no=Symbol("style"),Ik=Symbol("is custom element"),Ck=Symbol("is html");function Ay(r){if(et){var e=!1,t=()=>{if(!e){if(e=!0,r.hasAttribute("value")){var n=r.value;li(r,"value",null),r.value=n}if(r.hasAttribute("checked")){var s=r.checked;li(r,"checked",null),r.checked=s}}};r.__on_r=t,QE(t),gO()}}function IO(r,e){e?r.hasAttribute("selected")||r.setAttribute("selected",""):r.removeAttribute("selected")}function li(r,e,t,n){var s=$k(r);et&&(s[e]=r.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&r.nodeName==="LINK")||s[e]!==(s[e]=t)&&(e==="loading"&&(r[YE]=t),t==null?r.removeAttribute(e):typeof t!="string"&&Mk(r).includes(e)?r[e]=t:r.setAttribute(e,t))}function Dt(r,e,t,n,s=!1){var i=$k(r),a=i[Ik],o=!i[Ck];let l=et&&a;l&&oi(!1);var c=e||{},u=r.tagName==="OPTION";for(var d in e)d in t||(t[d]=null);t.class?t.class=EO(t.class):t[to]&&(t.class=null),t[no]&&(t.style??(t.style=null));var h=Mk(r);for(const y in t){let w=t[y];if(u&&y==="value"&&w==null){r.value=r.__value="",c[y]=w;continue}if(y==="class"){var f=r.namespaceURI==="http://www.w3.org/1999/xhtml";yb(r,f,w,n,e==null?void 0:e[to],t[to]),c[y]=w,c[to]=t[to];continue}if(y==="style"){RO(r,w,e==null?void 0:e[no],t[no]),c[y]=w,c[no]=t[no];continue}var p=c[y];if(w!==p){c[y]=w;var m=y[0]+y[1];if(m!=="$$")if(m==="on"){const v={},x="$$"+y;let k=y.slice(2);var g=bO(k);if(dO(k)&&(k=k.slice(0,-7),v.capture=!0),!g&&p){if(w!=null)continue;r.removeEventListener(k,c[x],v),c[x]=null}if(w!=null)if(g)r[`__${k}`]=w,fO([k]);else{let S=function(R){c[y].call(this,R)};c[x]=hO(k,r,S,v)}else g&&(r[`__${k}`]=void 0)}else if(y==="style")li(r,y,w);else if(y==="autofocus")pO(r,!!w);else if(!a&&(y==="__value"||y==="value"&&w!=null))r.value=r.__value=w;else if(y==="selected"&&u)IO(r,w);else{var b=y;o||(b=mO(b));var _=b==="defaultValue"||b==="defaultChecked";if(w==null&&!a&&!_)if(i[y]=null,b==="value"||b==="checked"){let v=r;const x=e===void 0;if(b==="value"){let k=v.defaultValue;v.removeAttribute(b),v.defaultValue=k,v.value=v.__value=x?k:null}else{let k=v.defaultChecked;v.removeAttribute(b),v.defaultChecked=k,v.checked=x?k:!1}}else r.removeAttribute(y);else _||h.includes(b)&&(a||typeof w!="string")?r[b]=w:typeof w!="function"&&li(r,b,w)}}}return l&&oi(!0),c}function $k(r){return r.__attributes??(r.__attributes={[Ik]:r.nodeName.includes("-"),[Ck]:r.namespaceURI===XE})}var Ey=new Map;function Mk(r){var e=Ey.get(r.nodeName);if(e)return e;Ey.set(r.nodeName,e=[]);for(var t,n=r,s=Element.prototype;s!==n;){t=eO(n);for(var i in t)t[i].set&&e.push(i);n=bk(n)}return e}function Um(r,e,t=e){var n=tO();gb(r,"input",s=>{var i=s?r.defaultValue:r.value;if(i=kf(r)?Sf(i):i,t(i),n&&i!==(i=e())){var a=r.selectionStart,o=r.selectionEnd;r.value=i??"",o!==null&&(r.selectionStart=a,r.selectionEnd=Math.min(o,r.value.length))}}),(et&&r.defaultValue!==r.value||xh(e)==null&&r.value)&&t(kf(r)?Sf(r.value):r.value),mb(()=>{var s=e();kf(r)&&s===Sf(r.value)||r.type==="date"&&!s&&!r.value||s!==r.value&&(r.value=s??"")})}function kf(r){var e=r.type;return e==="number"||e==="range"}function Sf(r){return r===""?null:+r}function CO(r,e,t=e){gb(r,"change",()=>{t(r.files)}),et&&r.files&&t(r.files),mb(()=>{r.files=e()})}function Nk(r,e,t){if(r.multiple)return MO(r,e);for(var n of r.options){var s=Ko(n);if(nO(s,e)){n.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function $O(r,e){kk(()=>{var t=new MutationObserver(()=>{var n=r.__value;Nk(r,n)});return t.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{t.disconnect()}})}function hl(r,e,t=e){var n=!0;gb(r,"change",s=>{var i=s?"[selected]":":checked",a;if(r.multiple)a=[].map.call(r.querySelectorAll(i),Ko);else{var o=r.querySelector(i)??r.querySelector("option:not([disabled])");a=o&&Ko(o)}t(a)}),kk(()=>{var s=e();if(Nk(r,s,n),n&&s===void 0){var i=r.querySelector(":checked");i!==null&&(s=Ko(i),t(s))}r.__value=s,n=!1}),$O(r)}function MO(r,e){for(var t of r.options)t.selected=~e.indexOf(Ko(t))}function Ko(r){return"__value"in r?r.__value:r.value}function Wi(r){de(r,r.v+1)}function NO(r){let e=0,t=qr(0),n;return()=>{rO()&&(P(t),mb(()=>(e===0&&(n=xh(()=>r(()=>Wi(t)))),e+=1,()=>{Sk().then(()=>{e-=1,e===0&&(n==null||n(),n=void 0)})})))}}class LO{constructor(e,t=[],n=1e3){this.id=crypto.randomUUID(),this.name=e,this.data=t,this.sampleRate=n,this.createdAt=new Date,this.updatedAt=new Date,this.sourceChannelIds=[],this.processingMethod=null}getStats(){if(this.data.length===0)return{length:0,min:0,max:0,mean:0,rms:0,duration:0};const e=Math.min(...this.data),t=Math.max(...this.data),s=this.data.reduce((l,c)=>l+c,0)/this.data.length,i=this.data.reduce((l,c)=>l+c*c,0),a=Math.sqrt(i/this.data.length),o=this.data.length/this.sampleRate;return{length:this.data.length,min:e,max:t,mean:s,rms:a,duration:o}}updateData(e,t=null,n=[]){this.data=e,this.updatedAt=new Date,t&&(this.processingMethod=t),n.length>0&&(this.sourceChannelIds=n)}}const La=Pk([]);function wb(r,e=[],t=1e3){const n=new LO(r,e,t);return La.update(s=>[...s,n]),n}function qm(r){let e=null;return La.subscribe(t=>{e=t.find(n=>n.id===r)})(),e}function jO(r){let e=!1;return La.update(t=>{const n=t.length,s=t.filter(i=>i.id!==r);return e=s.length<n,s}),e}function Lk(r,e,t,n={}){const s=qm(r);if(!s)return null;const i=e(s.data,...Object.values(n)),a=wb(t,i,s.sampleRate);return a.processingMethod=e.name,a.sourceChannelIds=[r],a}function Hm(r,e,t=1,n=1e3,s=0){const i=[];for(let a=0;a<r;a++){const o=a/n;i.push(t*Math.sin(2*Math.PI*e*o+s))}return i}function Wm(r,e,t=1,n=1e3,s=.5){const i=[],a=n/e;for(let o=0;o<r;o++){const l=o%a;i.push(l<a*s?t:-t)}return i}function Vm(r,e,t=1,n=1e3){const s=[],i=n/e;for(let a=0;a<r;a++){const l=a%i/i;let c;l<.5?c=2*l:c=2*(1-l),s.push(t*(2*c-1))}return s}function Gm(r,e,t=1,n=1e3){const s=[],i=n/e;for(let a=0;a<r;a++){const l=a%i/i;s.push(t*(2*l-1))}return s}function Zm(r,e=1){const t=[];for(let n=0;n<r;n++)t.push(e*(2*Math.random()-1));return t}function Jm(r,e,t=1,n=1){const s=new Array(r).fill(0);for(let i=0;i<t;i++){const a=e+i;a>=0&&a<r&&(s[a]=n)}return s}var Oy=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,pn=r=>!r||typeof r!="object"||Object.keys(r).length===0,DO=(r,e)=>JSON.stringify(r)===JSON.stringify(e);function jk(r,e){r.forEach(function(t){Array.isArray(t)?jk(t,e):e.push(t)})}function Dk(r){let e=[];return jk(r,e),e}var Fk=(...r)=>Dk(r).filter(Boolean),zk=(r,e)=>{let t={},n=Object.keys(r),s=Object.keys(e);for(let i of n)if(s.includes(i)){let a=r[i],o=e[i];Array.isArray(a)||Array.isArray(o)?t[i]=Fk(o,a):typeof a=="object"&&typeof o=="object"?t[i]=zk(a,o):t[i]=o+" "+a}else t[i]=r[i];for(let i of s)n.includes(i)||(t[i]=e[i]);return t},Ty=r=>!r||typeof r!="string"?r:r.replace(/\s+/g," ").trim();const vb="-",FO=r=>{const e=BO(r),{conflictingClassGroups:t,conflictingClassGroupModifiers:n}=r;return{getClassGroupId:a=>{const o=a.split(vb);return o[0]===""&&o.length!==1&&o.shift(),Bk(o,e)||zO(a)},getConflictingClassGroupIds:(a,o)=>{const l=t[a]||[];return o&&n[a]?[...l,...n[a]]:l}}},Bk=(r,e)=>{var a;if(r.length===0)return e.classGroupId;const t=r[0],n=e.nextPart.get(t),s=n?Bk(r.slice(1),n):void 0;if(s)return s;if(e.validators.length===0)return;const i=r.join(vb);return(a=e.validators.find(({validator:o})=>o(i)))==null?void 0:a.classGroupId},Ry=/^\[(.+)\]$/,zO=r=>{if(Ry.test(r)){const e=Ry.exec(r)[1],t=e==null?void 0:e.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},BO=r=>{const{theme:e,classGroups:t}=r,n={nextPart:new Map,validators:[]};for(const s in t)Km(t[s],n,s,e);return n},Km=(r,e,t,n)=>{r.forEach(s=>{if(typeof s=="string"){const i=s===""?e:Iy(e,s);i.classGroupId=t;return}if(typeof s=="function"){if(UO(s)){Km(s(n),e,t,n);return}e.validators.push({validator:s,classGroupId:t});return}Object.entries(s).forEach(([i,a])=>{Km(a,Iy(e,i),t,n)})})},Iy=(r,e)=>{let t=r;return e.split(vb).forEach(n=>{t.nextPart.has(n)||t.nextPart.set(n,{nextPart:new Map,validators:[]}),t=t.nextPart.get(n)}),t},UO=r=>r.isThemeGetter,qO=r=>{if(r<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,n=new Map;const s=(i,a)=>{t.set(i,a),e++,e>r&&(e=0,n=t,t=new Map)};return{get(i){let a=t.get(i);if(a!==void 0)return a;if((a=n.get(i))!==void 0)return s(i,a),a},set(i,a){t.has(i)?t.set(i,a):s(i,a)}}},Xm="!",Ym=":",HO=Ym.length,WO=r=>{const{prefix:e,experimentalParseClassName:t}=r;let n=s=>{const i=[];let a=0,o=0,l=0,c;for(let p=0;p<s.length;p++){let m=s[p];if(a===0&&o===0){if(m===Ym){i.push(s.slice(l,p)),l=p+HO;continue}if(m==="/"){c=p;continue}}m==="["?a++:m==="]"?a--:m==="("?o++:m===")"&&o--}const u=i.length===0?s:s.substring(l),d=VO(u),h=d!==u,f=c&&c>l?c-l:void 0;return{modifiers:i,hasImportantModifier:h,baseClassName:d,maybePostfixModifierPosition:f}};if(e){const s=e+Ym,i=n;n=a=>a.startsWith(s)?i(a.substring(s.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:a,maybePostfixModifierPosition:void 0}}if(t){const s=n;n=i=>t({className:i,parseClassName:s})}return n},VO=r=>r.endsWith(Xm)?r.substring(0,r.length-1):r.startsWith(Xm)?r.substring(1):r,GO=r=>{const e=Object.fromEntries(r.orderSensitiveModifiers.map(n=>[n,!0]));return n=>{if(n.length<=1)return n;const s=[];let i=[];return n.forEach(a=>{a[0]==="["||e[a]?(s.push(...i.sort(),a),i=[]):i.push(a)}),s.push(...i.sort()),s}},ZO=r=>({cache:qO(r.cacheSize),parseClassName:WO(r),sortModifiers:GO(r),...FO(r)}),JO=/\s+/,KO=(r,e)=>{const{parseClassName:t,getClassGroupId:n,getConflictingClassGroupIds:s,sortModifiers:i}=e,a=[],o=r.trim().split(JO);let l="";for(let c=o.length-1;c>=0;c-=1){const u=o[c],{isExternal:d,modifiers:h,hasImportantModifier:f,baseClassName:p,maybePostfixModifierPosition:m}=t(u);if(d){l=u+(l.length>0?" "+l:l);continue}let g=!!m,b=n(g?p.substring(0,m):p);if(!b){if(!g){l=u+(l.length>0?" "+l:l);continue}if(b=n(p),!b){l=u+(l.length>0?" "+l:l);continue}g=!1}const _=i(h).join(":"),y=f?_+Xm:_,w=y+b;if(a.includes(w))continue;a.push(w);const v=s(b,g);for(let x=0;x<v.length;++x){const k=v[x];a.push(y+k)}l=u+(l.length>0?" "+l:l)}return l};function XO(){let r=0,e,t,n="";for(;r<arguments.length;)(e=arguments[r++])&&(t=Uk(e))&&(n&&(n+=" "),n+=t);return n}const Uk=r=>{if(typeof r=="string")return r;let e,t="";for(let n=0;n<r.length;n++)r[n]&&(e=Uk(r[n]))&&(t&&(t+=" "),t+=e);return t};function Qm(r,...e){let t,n,s,i=a;function a(l){const c=e.reduce((u,d)=>d(u),r());return t=ZO(c),n=t.cache.get,s=t.cache.set,i=o,o(l)}function o(l){const c=n(l);if(c)return c;const u=KO(l,t);return s(l,u),u}return function(){return i(XO.apply(null,arguments))}}const It=r=>{const e=t=>t[r]||[];return e.isThemeGetter=!0,e},qk=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,Hk=/^\((?:(\w[\w-]*):)?(.+)\)$/i,YO=/^\d+\/\d+$/,QO=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,eT=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,tT=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,nT=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,rT=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Ci=r=>YO.test(r),je=r=>!!r&&!Number.isNaN(Number(r)),qs=r=>!!r&&Number.isInteger(Number(r)),Cy=r=>r.endsWith("%")&&je(r.slice(0,-1)),as=r=>QO.test(r),sT=()=>!0,iT=r=>eT.test(r)&&!tT.test(r),xb=()=>!1,aT=r=>nT.test(r),oT=r=>rT.test(r),lT=r=>!ie(r)&&!ae(r),cT=r=>ja(r,Gk,xb),ie=r=>qk.test(r),Hs=r=>ja(r,Zk,iT),Pf=r=>ja(r,wT,je),uT=r=>ja(r,Wk,xb),dT=r=>ja(r,Vk,oT),hT=r=>ja(r,xb,aT),ae=r=>Hk.test(r),Wc=r=>Da(r,Zk),fT=r=>Da(r,vT),pT=r=>Da(r,Wk),mT=r=>Da(r,Gk),gT=r=>Da(r,Vk),bT=r=>Da(r,xT,!0),ja=(r,e,t)=>{const n=qk.exec(r);return n?n[1]?e(n[1]):t(n[2]):!1},Da=(r,e,t=!1)=>{const n=Hk.exec(r);return n?n[1]?e(n[1]):t:!1},Wk=r=>r==="position",_T=new Set(["image","url"]),Vk=r=>_T.has(r),yT=new Set(["length","size","percentage"]),Gk=r=>yT.has(r),Zk=r=>r==="length",wT=r=>r==="number",vT=r=>r==="family-name",xT=r=>r==="shadow",eg=()=>{const r=It("color"),e=It("font"),t=It("text"),n=It("font-weight"),s=It("tracking"),i=It("leading"),a=It("breakpoint"),o=It("container"),l=It("spacing"),c=It("radius"),u=It("shadow"),d=It("inset-shadow"),h=It("drop-shadow"),f=It("blur"),p=It("perspective"),m=It("aspect"),g=It("ease"),b=It("animate"),_=()=>["auto","avoid","all","avoid-page","page","left","right","column"],y=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],w=()=>["auto","hidden","clip","visible","scroll"],v=()=>["auto","contain","none"],x=()=>[ae,ie,l],k=()=>[Ci,"full","auto",...x()],S=()=>[qs,"none","subgrid",ae,ie],R=()=>["auto",{span:["full",qs,ae,ie]},ae,ie],D=()=>[qs,"auto",ae,ie],M=()=>["auto","min","max","fr",ae,ie],N=()=>["start","end","center","between","around","evenly","stretch","baseline"],C=()=>["start","end","center","stretch"],A=()=>["auto",...x()],E=()=>[Ci,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...x()],O=()=>[r,ae,ie],I=()=>[Cy,Hs],T=()=>["","none","full",c,ae,ie],L=()=>["",je,Wc,Hs],W=()=>["solid","dashed","dotted","double"],ee=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Z=()=>["","none",f,ae,ie],X=()=>["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ae,ie],U=()=>["none",je,ae,ie],G=()=>["none",je,ae,ie],le=()=>[je,ae,ie],me=()=>[Ci,"full",...x()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[as],breakpoint:[as],color:[sT],container:[as],"drop-shadow":[as],ease:["in","out","in-out"],font:[lT],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[as],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[as],shadow:[as],spacing:["px",je],text:[as],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Ci,ie,ae,m]}],container:["container"],columns:[{columns:[je,ie,ae,o]}],"break-after":[{"break-after":_()}],"break-before":[{"break-before":_()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...y(),ie,ae]}],overflow:[{overflow:w()}],"overflow-x":[{"overflow-x":w()}],"overflow-y":[{"overflow-y":w()}],overscroll:[{overscroll:v()}],"overscroll-x":[{"overscroll-x":v()}],"overscroll-y":[{"overscroll-y":v()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:k()}],"inset-x":[{"inset-x":k()}],"inset-y":[{"inset-y":k()}],start:[{start:k()}],end:[{end:k()}],top:[{top:k()}],right:[{right:k()}],bottom:[{bottom:k()}],left:[{left:k()}],visibility:["visible","invisible","collapse"],z:[{z:[qs,"auto",ae,ie]}],basis:[{basis:[Ci,"full","auto",o,...x()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[je,Ci,"auto","initial","none",ie]}],grow:[{grow:["",je,ae,ie]}],shrink:[{shrink:["",je,ae,ie]}],order:[{order:[qs,"first","last","none",ae,ie]}],"grid-cols":[{"grid-cols":S()}],"col-start-end":[{col:R()}],"col-start":[{"col-start":D()}],"col-end":[{"col-end":D()}],"grid-rows":[{"grid-rows":S()}],"row-start-end":[{row:R()}],"row-start":[{"row-start":D()}],"row-end":[{"row-end":D()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":M()}],"auto-rows":[{"auto-rows":M()}],gap:[{gap:x()}],"gap-x":[{"gap-x":x()}],"gap-y":[{"gap-y":x()}],"justify-content":[{justify:[...N(),"normal"]}],"justify-items":[{"justify-items":[...C(),"normal"]}],"justify-self":[{"justify-self":["auto",...C()]}],"align-content":[{content:["normal",...N()]}],"align-items":[{items:[...C(),"baseline"]}],"align-self":[{self:["auto",...C(),"baseline"]}],"place-content":[{"place-content":N()}],"place-items":[{"place-items":[...C(),"baseline"]}],"place-self":[{"place-self":["auto",...C()]}],p:[{p:x()}],px:[{px:x()}],py:[{py:x()}],ps:[{ps:x()}],pe:[{pe:x()}],pt:[{pt:x()}],pr:[{pr:x()}],pb:[{pb:x()}],pl:[{pl:x()}],m:[{m:A()}],mx:[{mx:A()}],my:[{my:A()}],ms:[{ms:A()}],me:[{me:A()}],mt:[{mt:A()}],mr:[{mr:A()}],mb:[{mb:A()}],ml:[{ml:A()}],"space-x":[{"space-x":x()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":x()}],"space-y-reverse":["space-y-reverse"],size:[{size:E()}],w:[{w:[o,"screen",...E()]}],"min-w":[{"min-w":[o,"screen","none",...E()]}],"max-w":[{"max-w":[o,"screen","none","prose",{screen:[a]},...E()]}],h:[{h:["screen",...E()]}],"min-h":[{"min-h":["screen","none",...E()]}],"max-h":[{"max-h":["screen",...E()]}],"font-size":[{text:["base",t,Wc,Hs]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[n,ae,Pf]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Cy,ie]}],"font-family":[{font:[fT,ie,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[s,ae,ie]}],"line-clamp":[{"line-clamp":[je,"none",ae,Pf]}],leading:[{leading:[i,...x()]}],"list-image":[{"list-image":["none",ae,ie]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",ae,ie]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:O()}],"text-color":[{text:O()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...W(),"wavy"]}],"text-decoration-thickness":[{decoration:[je,"from-font","auto",ae,Hs]}],"text-decoration-color":[{decoration:O()}],"underline-offset":[{"underline-offset":[je,"auto",ae,ie]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:x()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ae,ie]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ae,ie]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...y(),pT,uT]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","space","round"]}]}],"bg-size":[{bg:["auto","cover","contain",mT,cT]}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},qs,ae,ie],radial:["",ae,ie],conic:[qs,ae,ie]},gT,dT]}],"bg-color":[{bg:O()}],"gradient-from-pos":[{from:I()}],"gradient-via-pos":[{via:I()}],"gradient-to-pos":[{to:I()}],"gradient-from":[{from:O()}],"gradient-via":[{via:O()}],"gradient-to":[{to:O()}],rounded:[{rounded:T()}],"rounded-s":[{"rounded-s":T()}],"rounded-e":[{"rounded-e":T()}],"rounded-t":[{"rounded-t":T()}],"rounded-r":[{"rounded-r":T()}],"rounded-b":[{"rounded-b":T()}],"rounded-l":[{"rounded-l":T()}],"rounded-ss":[{"rounded-ss":T()}],"rounded-se":[{"rounded-se":T()}],"rounded-ee":[{"rounded-ee":T()}],"rounded-es":[{"rounded-es":T()}],"rounded-tl":[{"rounded-tl":T()}],"rounded-tr":[{"rounded-tr":T()}],"rounded-br":[{"rounded-br":T()}],"rounded-bl":[{"rounded-bl":T()}],"border-w":[{border:L()}],"border-w-x":[{"border-x":L()}],"border-w-y":[{"border-y":L()}],"border-w-s":[{"border-s":L()}],"border-w-e":[{"border-e":L()}],"border-w-t":[{"border-t":L()}],"border-w-r":[{"border-r":L()}],"border-w-b":[{"border-b":L()}],"border-w-l":[{"border-l":L()}],"divide-x":[{"divide-x":L()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":L()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...W(),"hidden","none"]}],"divide-style":[{divide:[...W(),"hidden","none"]}],"border-color":[{border:O()}],"border-color-x":[{"border-x":O()}],"border-color-y":[{"border-y":O()}],"border-color-s":[{"border-s":O()}],"border-color-e":[{"border-e":O()}],"border-color-t":[{"border-t":O()}],"border-color-r":[{"border-r":O()}],"border-color-b":[{"border-b":O()}],"border-color-l":[{"border-l":O()}],"divide-color":[{divide:O()}],"outline-style":[{outline:[...W(),"none","hidden"]}],"outline-offset":[{"outline-offset":[je,ae,ie]}],"outline-w":[{outline:["",je,Wc,Hs]}],"outline-color":[{outline:[r]}],shadow:[{shadow:["","none",u,bT,hT]}],"shadow-color":[{shadow:O()}],"inset-shadow":[{"inset-shadow":["none",ae,ie,d]}],"inset-shadow-color":[{"inset-shadow":O()}],"ring-w":[{ring:L()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:O()}],"ring-offset-w":[{"ring-offset":[je,Hs]}],"ring-offset-color":[{"ring-offset":O()}],"inset-ring-w":[{"inset-ring":L()}],"inset-ring-color":[{"inset-ring":O()}],opacity:[{opacity:[je,ae,ie]}],"mix-blend":[{"mix-blend":[...ee(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":ee()}],filter:[{filter:["","none",ae,ie]}],blur:[{blur:Z()}],brightness:[{brightness:[je,ae,ie]}],contrast:[{contrast:[je,ae,ie]}],"drop-shadow":[{"drop-shadow":["","none",h,ae,ie]}],grayscale:[{grayscale:["",je,ae,ie]}],"hue-rotate":[{"hue-rotate":[je,ae,ie]}],invert:[{invert:["",je,ae,ie]}],saturate:[{saturate:[je,ae,ie]}],sepia:[{sepia:["",je,ae,ie]}],"backdrop-filter":[{"backdrop-filter":["","none",ae,ie]}],"backdrop-blur":[{"backdrop-blur":Z()}],"backdrop-brightness":[{"backdrop-brightness":[je,ae,ie]}],"backdrop-contrast":[{"backdrop-contrast":[je,ae,ie]}],"backdrop-grayscale":[{"backdrop-grayscale":["",je,ae,ie]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[je,ae,ie]}],"backdrop-invert":[{"backdrop-invert":["",je,ae,ie]}],"backdrop-opacity":[{"backdrop-opacity":[je,ae,ie]}],"backdrop-saturate":[{"backdrop-saturate":[je,ae,ie]}],"backdrop-sepia":[{"backdrop-sepia":["",je,ae,ie]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":x()}],"border-spacing-x":[{"border-spacing-x":x()}],"border-spacing-y":[{"border-spacing-y":x()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",ae,ie]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[je,"initial",ae,ie]}],ease:[{ease:["linear","initial",g,ae,ie]}],delay:[{delay:[je,ae,ie]}],animate:[{animate:["none",b,ae,ie]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[p,ae,ie]}],"perspective-origin":[{"perspective-origin":X()}],rotate:[{rotate:U()}],"rotate-x":[{"rotate-x":U()}],"rotate-y":[{"rotate-y":U()}],"rotate-z":[{"rotate-z":U()}],scale:[{scale:G()}],"scale-x":[{"scale-x":G()}],"scale-y":[{"scale-y":G()}],"scale-z":[{"scale-z":G()}],"scale-3d":["scale-3d"],skew:[{skew:le()}],"skew-x":[{"skew-x":le()}],"skew-y":[{"skew-y":le()}],transform:[{transform:[ae,ie,"","none","gpu","cpu"]}],"transform-origin":[{origin:X()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:me()}],"translate-x":[{"translate-x":me()}],"translate-y":[{"translate-y":me()}],"translate-z":[{"translate-z":me()}],"translate-none":["translate-none"],accent:[{accent:O()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:O()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ae,ie]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":x()}],"scroll-mx":[{"scroll-mx":x()}],"scroll-my":[{"scroll-my":x()}],"scroll-ms":[{"scroll-ms":x()}],"scroll-me":[{"scroll-me":x()}],"scroll-mt":[{"scroll-mt":x()}],"scroll-mr":[{"scroll-mr":x()}],"scroll-mb":[{"scroll-mb":x()}],"scroll-ml":[{"scroll-ml":x()}],"scroll-p":[{"scroll-p":x()}],"scroll-px":[{"scroll-px":x()}],"scroll-py":[{"scroll-py":x()}],"scroll-ps":[{"scroll-ps":x()}],"scroll-pe":[{"scroll-pe":x()}],"scroll-pt":[{"scroll-pt":x()}],"scroll-pr":[{"scroll-pr":x()}],"scroll-pb":[{"scroll-pb":x()}],"scroll-pl":[{"scroll-pl":x()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ae,ie]}],fill:[{fill:["none",...O()]}],"stroke-w":[{stroke:[je,Wc,Hs,Pf]}],stroke:[{stroke:["none",...O()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["before","after","placeholder","file","marker","selection","first-line","first-letter","backdrop","*","**"]}},kT=(r,{cacheSize:e,prefix:t,experimentalParseClassName:n,extend:s={},override:i={}})=>(Io(r,"cacheSize",e),Io(r,"prefix",t),Io(r,"experimentalParseClassName",n),Vc(r.theme,i.theme),Vc(r.classGroups,i.classGroups),Vc(r.conflictingClassGroups,i.conflictingClassGroups),Vc(r.conflictingClassGroupModifiers,i.conflictingClassGroupModifiers),Io(r,"orderSensitiveModifiers",i.orderSensitiveModifiers),Gc(r.theme,s.theme),Gc(r.classGroups,s.classGroups),Gc(r.conflictingClassGroups,s.conflictingClassGroups),Gc(r.conflictingClassGroupModifiers,s.conflictingClassGroupModifiers),Jk(r,s,"orderSensitiveModifiers"),r),Io=(r,e,t)=>{t!==void 0&&(r[e]=t)},Vc=(r,e)=>{if(e)for(const t in e)Io(r,t,e[t])},Gc=(r,e)=>{if(e)for(const t in e)Jk(r,e,t)},Jk=(r,e,t)=>{const n=e[t];n!==void 0&&(r[t]=r[t]?r[t].concat(n):n)},ST=(r,...e)=>typeof r=="function"?Qm(eg,r,...e):Qm(()=>kT(eg(),r),...e),PT=Qm(eg);var AT={twMerge:!0,twMergeConfig:{},responsiveVariants:!1},Kk=r=>r||void 0,fl=(...r)=>Kk(Dk(r).filter(Boolean).join(" ")),Af=null,Ur={},tg=!1,ro=(...r)=>e=>e.twMerge?((!Af||tg)&&(tg=!1,Af=pn(Ur)?PT:ST({...Ur,extend:{theme:Ur.theme,classGroups:Ur.classGroups,conflictingClassGroupModifiers:Ur.conflictingClassGroupModifiers,conflictingClassGroups:Ur.conflictingClassGroups,...Ur.extend}})),Kk(Af(fl(r)))):fl(r),$y=(r,e)=>{for(let t in e)r.hasOwnProperty(t)?r[t]=fl(r[t],e[t]):r[t]=e[t];return r},ET=(r,e)=>{let{extend:t=null,slots:n={},variants:s={},compoundVariants:i=[],compoundSlots:a=[],defaultVariants:o={}}=r,l={...AT,...e},c=t!=null&&t.base?fl(t.base,r==null?void 0:r.base):r==null?void 0:r.base,u=t!=null&&t.variants&&!pn(t.variants)?zk(s,t.variants):s,d=t!=null&&t.defaultVariants&&!pn(t.defaultVariants)?{...t.defaultVariants,...o}:o;!pn(l.twMergeConfig)&&!DO(l.twMergeConfig,Ur)&&(tg=!0,Ur=l.twMergeConfig);let h=pn(t==null?void 0:t.slots),f=pn(n)?{}:{base:fl(r==null?void 0:r.base,h&&(t==null?void 0:t.base)),...n},p=h?f:$y({...t==null?void 0:t.slots},pn(f)?{base:r==null?void 0:r.base}:f),m=pn(t==null?void 0:t.compoundVariants)?i:Fk(t==null?void 0:t.compoundVariants,i),g=_=>{if(pn(u)&&pn(n)&&h)return ro(c,_==null?void 0:_.class,_==null?void 0:_.className)(l);if(m&&!Array.isArray(m))throw new TypeError(`The "compoundVariants" prop must be an array. Received: ${typeof m}`);if(a&&!Array.isArray(a))throw new TypeError(`The "compoundSlots" prop must be an array. Received: ${typeof a}`);let y=(N,C,A=[],E)=>{let O=A;if(typeof C=="string")O=O.concat(Ty(C).split(" ").map(I=>`${N}:${I}`));else if(Array.isArray(C))O=O.concat(C.reduce((I,T)=>I.concat(`${N}:${T}`),[]));else if(typeof C=="object"&&typeof E=="string"){for(let I in C)if(C.hasOwnProperty(I)&&I===E){let T=C[I];if(T&&typeof T=="string"){let L=Ty(T);O[E]?O[E]=O[E].concat(L.split(" ").map(W=>`${N}:${W}`)):O[E]=L.split(" ").map(W=>`${N}:${W}`)}else Array.isArray(T)&&T.length>0&&(O[E]=T.reduce((L,W)=>L.concat(`${N}:${W}`),[]))}}return O},w=(N,C=u,A=null,E=null)=>{var O;let I=C[N];if(!I||pn(I))return null;let T=(O=E==null?void 0:E[N])!=null?O:_==null?void 0:_[N];if(T===null)return null;let L=Oy(T),W=Array.isArray(l.responsiveVariants)&&l.responsiveVariants.length>0||l.responsiveVariants===!0,ee=d==null?void 0:d[N],Z=[];if(typeof L=="object"&&W)for(let[G,le]of Object.entries(L)){let me=I[le];if(G==="initial"){ee=le;continue}Array.isArray(l.responsiveVariants)&&!l.responsiveVariants.includes(G)||(Z=y(G,me,Z,A))}let X=L!=null&&typeof L!="object"?L:Oy(ee),U=I[X||"false"];return typeof Z=="object"&&typeof A=="string"&&Z[A]?$y(Z,U):Z.length>0?(Z.push(U),A==="base"?Z.join(" "):Z):U},v=()=>u?Object.keys(u).map(N=>w(N,u)):null,x=(N,C)=>{if(!u||typeof u!="object")return null;let A=new Array;for(let E in u){let O=w(E,u,N,C),I=N==="base"&&typeof O=="string"?O:O&&O[N];I&&(A[A.length]=I)}return A},k={};for(let N in _)_[N]!==void 0&&(k[N]=_[N]);let S=(N,C)=>{var A;let E=typeof(_==null?void 0:_[N])=="object"?{[N]:(A=_[N])==null?void 0:A.initial}:{};return{...d,...k,...E,...C}},R=(N=[],C)=>{let A=[];for(let{class:E,className:O,...I}of N){let T=!0;for(let[L,W]of Object.entries(I)){let ee=S(L,C)[L];if(Array.isArray(W)){if(!W.includes(ee)){T=!1;break}}else{let Z=X=>X==null||X===!1;if(Z(W)&&Z(ee))continue;if(ee!==W){T=!1;break}}}T&&(E&&A.push(E),O&&A.push(O))}return A},D=N=>{let C=R(m,N);if(!Array.isArray(C))return C;let A={};for(let E of C)if(typeof E=="string"&&(A.base=ro(A.base,E)(l)),typeof E=="object")for(let[O,I]of Object.entries(E))A[O]=ro(A[O],I)(l);return A},M=N=>{if(a.length<1)return null;let C={};for(let{slots:A=[],class:E,className:O,...I}of a){if(!pn(I)){let T=!0;for(let L of Object.keys(I)){let W=S(L,N)[L];if(W===void 0||(Array.isArray(I[L])?!I[L].includes(W):I[L]!==W)){T=!1;break}}if(!T)continue}for(let T of A)C[T]=C[T]||[],C[T].push([E,O])}return C};if(!pn(n)||!h){let N={};if(typeof p=="object"&&!pn(p))for(let C of Object.keys(p))N[C]=A=>{var E,O;return ro(p[C],x(C,A),((E=D(A))!=null?E:[])[C],((O=M(A))!=null?O:[])[C],A==null?void 0:A.class,A==null?void 0:A.className)(l)};return N}return ro(c,v(),R(m),_==null?void 0:_.class,_==null?void 0:_.className)(l)},b=()=>{if(!(!u||typeof u!="object"))return Object.keys(u)};return g.variantKeys=b(),g.extend=t,g.base=c,g.slots=p,g.variants=u,g.defaultVariants=d,g.compoundSlots=a,g.compoundVariants=m,g};const kb="-",OT=r=>{const e=RT(r),{conflictingClassGroups:t,conflictingClassGroupModifiers:n}=r;return{getClassGroupId:a=>{const o=a.split(kb);return o[0]===""&&o.length!==1&&o.shift(),Xk(o,e)||TT(a)},getConflictingClassGroupIds:(a,o)=>{const l=t[a]||[];return o&&n[a]?[...l,...n[a]]:l}}},Xk=(r,e)=>{var a;if(r.length===0)return e.classGroupId;const t=r[0],n=e.nextPart.get(t),s=n?Xk(r.slice(1),n):void 0;if(s)return s;if(e.validators.length===0)return;const i=r.join(kb);return(a=e.validators.find(({validator:o})=>o(i)))==null?void 0:a.classGroupId},My=/^\[(.+)\]$/,TT=r=>{if(My.test(r)){const e=My.exec(r)[1],t=e==null?void 0:e.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},RT=r=>{const{theme:e,classGroups:t}=r,n={nextPart:new Map,validators:[]};for(const s in t)ng(t[s],n,s,e);return n},ng=(r,e,t,n)=>{r.forEach(s=>{if(typeof s=="string"){const i=s===""?e:Ny(e,s);i.classGroupId=t;return}if(typeof s=="function"){if(IT(s)){ng(s(n),e,t,n);return}e.validators.push({validator:s,classGroupId:t});return}Object.entries(s).forEach(([i,a])=>{ng(a,Ny(e,i),t,n)})})},Ny=(r,e)=>{let t=r;return e.split(kb).forEach(n=>{t.nextPart.has(n)||t.nextPart.set(n,{nextPart:new Map,validators:[]}),t=t.nextPart.get(n)}),t},IT=r=>r.isThemeGetter,CT=r=>{if(r<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,n=new Map;const s=(i,a)=>{t.set(i,a),e++,e>r&&(e=0,n=t,t=new Map)};return{get(i){let a=t.get(i);if(a!==void 0)return a;if((a=n.get(i))!==void 0)return s(i,a),a},set(i,a){t.has(i)?t.set(i,a):s(i,a)}}},rg="!",sg=":",$T=sg.length,MT=r=>{const{prefix:e,experimentalParseClassName:t}=r;let n=s=>{const i=[];let a=0,o=0,l=0,c;for(let p=0;p<s.length;p++){let m=s[p];if(a===0&&o===0){if(m===sg){i.push(s.slice(l,p)),l=p+$T;continue}if(m==="/"){c=p;continue}}m==="["?a++:m==="]"?a--:m==="("?o++:m===")"&&o--}const u=i.length===0?s:s.substring(l),d=NT(u),h=d!==u,f=c&&c>l?c-l:void 0;return{modifiers:i,hasImportantModifier:h,baseClassName:d,maybePostfixModifierPosition:f}};if(e){const s=e+sg,i=n;n=a=>a.startsWith(s)?i(a.substring(s.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:a,maybePostfixModifierPosition:void 0}}if(t){const s=n;n=i=>t({className:i,parseClassName:s})}return n},NT=r=>r.endsWith(rg)?r.substring(0,r.length-1):r.startsWith(rg)?r.substring(1):r,LT=r=>{const e=Object.fromEntries(r.orderSensitiveModifiers.map(n=>[n,!0]));return n=>{if(n.length<=1)return n;const s=[];let i=[];return n.forEach(a=>{a[0]==="["||e[a]?(s.push(...i.sort(),a),i=[]):i.push(a)}),s.push(...i.sort()),s}},jT=r=>({cache:CT(r.cacheSize),parseClassName:MT(r),sortModifiers:LT(r),...OT(r)}),DT=/\s+/,FT=(r,e)=>{const{parseClassName:t,getClassGroupId:n,getConflictingClassGroupIds:s,sortModifiers:i}=e,a=[],o=r.trim().split(DT);let l="";for(let c=o.length-1;c>=0;c-=1){const u=o[c],{isExternal:d,modifiers:h,hasImportantModifier:f,baseClassName:p,maybePostfixModifierPosition:m}=t(u);if(d){l=u+(l.length>0?" "+l:l);continue}let g=!!m,b=n(g?p.substring(0,m):p);if(!b){if(!g){l=u+(l.length>0?" "+l:l);continue}if(b=n(p),!b){l=u+(l.length>0?" "+l:l);continue}g=!1}const _=i(h).join(":"),y=f?_+rg:_,w=y+b;if(a.includes(w))continue;a.push(w);const v=s(b,g);for(let x=0;x<v.length;++x){const k=v[x];a.push(y+k)}l=u+(l.length>0?" "+l:l)}return l};function zT(){let r=0,e,t,n="";for(;r<arguments.length;)(e=arguments[r++])&&(t=Yk(e))&&(n&&(n+=" "),n+=t);return n}const Yk=r=>{if(typeof r=="string")return r;let e,t="";for(let n=0;n<r.length;n++)r[n]&&(e=Yk(r[n]))&&(t&&(t+=" "),t+=e);return t};function BT(r,...e){let t,n,s,i=a;function a(l){const c=e.reduce((u,d)=>d(u),r());return t=jT(c),n=t.cache.get,s=t.cache.set,i=o,o(l)}function o(l){const c=n(l);if(c)return c;const u=FT(l,t);return s(l,u),u}return function(){return i(zT.apply(null,arguments))}}const St=r=>{const e=t=>t[r]||[];return e.isThemeGetter=!0,e},Qk=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,eS=/^\((?:(\w[\w-]*):)?(.+)\)$/i,UT=/^\d+\/\d+$/,qT=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,HT=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,WT=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,VT=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,GT=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,$i=r=>UT.test(r),Me=r=>!!r&&!Number.isNaN(Number(r)),os=r=>!!r&&Number.isInteger(Number(r)),Ef=r=>r.endsWith("%")&&Me(r.slice(0,-1)),Cr=r=>qT.test(r),ZT=()=>!0,JT=r=>HT.test(r)&&!WT.test(r),tS=()=>!1,KT=r=>VT.test(r),XT=r=>GT.test(r),YT=r=>!ne(r)&&!re(r),QT=r=>Fa(r,sS,tS),ne=r=>Qk.test(r),Ws=r=>Fa(r,iS,JT),Of=r=>Fa(r,sR,Me),Ly=r=>Fa(r,nS,tS),eR=r=>Fa(r,rS,XT),Zc=r=>Fa(r,aS,KT),re=r=>eS.test(r),so=r=>za(r,iS),tR=r=>za(r,iR),jy=r=>za(r,nS),nR=r=>za(r,sS),rR=r=>za(r,rS),Jc=r=>za(r,aS,!0),Fa=(r,e,t)=>{const n=Qk.exec(r);return n?n[1]?e(n[1]):t(n[2]):!1},za=(r,e,t=!1)=>{const n=eS.exec(r);return n?n[1]?e(n[1]):t:!1},nS=r=>r==="position"||r==="percentage",rS=r=>r==="image"||r==="url",sS=r=>r==="length"||r==="size"||r==="bg-size",iS=r=>r==="length",sR=r=>r==="number",iR=r=>r==="family-name",aS=r=>r==="shadow",aR=()=>{const r=St("color"),e=St("font"),t=St("text"),n=St("font-weight"),s=St("tracking"),i=St("leading"),a=St("breakpoint"),o=St("container"),l=St("spacing"),c=St("radius"),u=St("shadow"),d=St("inset-shadow"),h=St("text-shadow"),f=St("drop-shadow"),p=St("blur"),m=St("perspective"),g=St("aspect"),b=St("ease"),_=St("animate"),y=()=>["auto","avoid","all","avoid-page","page","left","right","column"],w=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],v=()=>[...w(),re,ne],x=()=>["auto","hidden","clip","visible","scroll"],k=()=>["auto","contain","none"],S=()=>[re,ne,l],R=()=>[$i,"full","auto",...S()],D=()=>[os,"none","subgrid",re,ne],M=()=>["auto",{span:["full",os,re,ne]},os,re,ne],N=()=>[os,"auto",re,ne],C=()=>["auto","min","max","fr",re,ne],A=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],E=()=>["start","end","center","stretch","center-safe","end-safe"],O=()=>["auto",...S()],I=()=>[$i,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...S()],T=()=>[r,re,ne],L=()=>[...w(),jy,Ly,{position:[re,ne]}],W=()=>["no-repeat",{repeat:["","x","y","space","round"]}],ee=()=>["auto","cover","contain",nR,QT,{size:[re,ne]}],Z=()=>[Ef,so,Ws],X=()=>["","none","full",c,re,ne],U=()=>["",Me,so,Ws],G=()=>["solid","dashed","dotted","double"],le=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],me=()=>[Me,Ef,jy,Ly],Rt=()=>["","none",p,re,ne],vt=()=>["none",Me,re,ne],ut=()=>["none",Me,re,ne],_t=()=>[Me,re,ne],Ut=()=>[$i,"full",...S()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Cr],breakpoint:[Cr],color:[ZT],container:[Cr],"drop-shadow":[Cr],ease:["in","out","in-out"],font:[YT],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Cr],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Cr],shadow:[Cr],spacing:["px",Me],text:[Cr],"text-shadow":[Cr],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",$i,ne,re,g]}],container:["container"],columns:[{columns:[Me,ne,re,o]}],"break-after":[{"break-after":y()}],"break-before":[{"break-before":y()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:v()}],overflow:[{overflow:x()}],"overflow-x":[{"overflow-x":x()}],"overflow-y":[{"overflow-y":x()}],overscroll:[{overscroll:k()}],"overscroll-x":[{"overscroll-x":k()}],"overscroll-y":[{"overscroll-y":k()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:R()}],"inset-x":[{"inset-x":R()}],"inset-y":[{"inset-y":R()}],start:[{start:R()}],end:[{end:R()}],top:[{top:R()}],right:[{right:R()}],bottom:[{bottom:R()}],left:[{left:R()}],visibility:["visible","invisible","collapse"],z:[{z:[os,"auto",re,ne]}],basis:[{basis:[$i,"full","auto",o,...S()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Me,$i,"auto","initial","none",ne]}],grow:[{grow:["",Me,re,ne]}],shrink:[{shrink:["",Me,re,ne]}],order:[{order:[os,"first","last","none",re,ne]}],"grid-cols":[{"grid-cols":D()}],"col-start-end":[{col:M()}],"col-start":[{"col-start":N()}],"col-end":[{"col-end":N()}],"grid-rows":[{"grid-rows":D()}],"row-start-end":[{row:M()}],"row-start":[{"row-start":N()}],"row-end":[{"row-end":N()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":C()}],"auto-rows":[{"auto-rows":C()}],gap:[{gap:S()}],"gap-x":[{"gap-x":S()}],"gap-y":[{"gap-y":S()}],"justify-content":[{justify:[...A(),"normal"]}],"justify-items":[{"justify-items":[...E(),"normal"]}],"justify-self":[{"justify-self":["auto",...E()]}],"align-content":[{content:["normal",...A()]}],"align-items":[{items:[...E(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...E(),{baseline:["","last"]}]}],"place-content":[{"place-content":A()}],"place-items":[{"place-items":[...E(),"baseline"]}],"place-self":[{"place-self":["auto",...E()]}],p:[{p:S()}],px:[{px:S()}],py:[{py:S()}],ps:[{ps:S()}],pe:[{pe:S()}],pt:[{pt:S()}],pr:[{pr:S()}],pb:[{pb:S()}],pl:[{pl:S()}],m:[{m:O()}],mx:[{mx:O()}],my:[{my:O()}],ms:[{ms:O()}],me:[{me:O()}],mt:[{mt:O()}],mr:[{mr:O()}],mb:[{mb:O()}],ml:[{ml:O()}],"space-x":[{"space-x":S()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":S()}],"space-y-reverse":["space-y-reverse"],size:[{size:I()}],w:[{w:[o,"screen",...I()]}],"min-w":[{"min-w":[o,"screen","none",...I()]}],"max-w":[{"max-w":[o,"screen","none","prose",{screen:[a]},...I()]}],h:[{h:["screen",...I()]}],"min-h":[{"min-h":["screen","none",...I()]}],"max-h":[{"max-h":["screen",...I()]}],"font-size":[{text:["base",t,so,Ws]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[n,re,Of]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Ef,ne]}],"font-family":[{font:[tR,ne,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[s,re,ne]}],"line-clamp":[{"line-clamp":[Me,"none",re,Of]}],leading:[{leading:[i,...S()]}],"list-image":[{"list-image":["none",re,ne]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",re,ne]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:T()}],"text-color":[{text:T()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...G(),"wavy"]}],"text-decoration-thickness":[{decoration:[Me,"from-font","auto",re,Ws]}],"text-decoration-color":[{decoration:T()}],"underline-offset":[{"underline-offset":[Me,"auto",re,ne]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:S()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",re,ne]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",re,ne]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:L()}],"bg-repeat":[{bg:W()}],"bg-size":[{bg:ee()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},os,re,ne],radial:["",re,ne],conic:[os,re,ne]},rR,eR]}],"bg-color":[{bg:T()}],"gradient-from-pos":[{from:Z()}],"gradient-via-pos":[{via:Z()}],"gradient-to-pos":[{to:Z()}],"gradient-from":[{from:T()}],"gradient-via":[{via:T()}],"gradient-to":[{to:T()}],rounded:[{rounded:X()}],"rounded-s":[{"rounded-s":X()}],"rounded-e":[{"rounded-e":X()}],"rounded-t":[{"rounded-t":X()}],"rounded-r":[{"rounded-r":X()}],"rounded-b":[{"rounded-b":X()}],"rounded-l":[{"rounded-l":X()}],"rounded-ss":[{"rounded-ss":X()}],"rounded-se":[{"rounded-se":X()}],"rounded-ee":[{"rounded-ee":X()}],"rounded-es":[{"rounded-es":X()}],"rounded-tl":[{"rounded-tl":X()}],"rounded-tr":[{"rounded-tr":X()}],"rounded-br":[{"rounded-br":X()}],"rounded-bl":[{"rounded-bl":X()}],"border-w":[{border:U()}],"border-w-x":[{"border-x":U()}],"border-w-y":[{"border-y":U()}],"border-w-s":[{"border-s":U()}],"border-w-e":[{"border-e":U()}],"border-w-t":[{"border-t":U()}],"border-w-r":[{"border-r":U()}],"border-w-b":[{"border-b":U()}],"border-w-l":[{"border-l":U()}],"divide-x":[{"divide-x":U()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":U()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...G(),"hidden","none"]}],"divide-style":[{divide:[...G(),"hidden","none"]}],"border-color":[{border:T()}],"border-color-x":[{"border-x":T()}],"border-color-y":[{"border-y":T()}],"border-color-s":[{"border-s":T()}],"border-color-e":[{"border-e":T()}],"border-color-t":[{"border-t":T()}],"border-color-r":[{"border-r":T()}],"border-color-b":[{"border-b":T()}],"border-color-l":[{"border-l":T()}],"divide-color":[{divide:T()}],"outline-style":[{outline:[...G(),"none","hidden"]}],"outline-offset":[{"outline-offset":[Me,re,ne]}],"outline-w":[{outline:["",Me,so,Ws]}],"outline-color":[{outline:T()}],shadow:[{shadow:["","none",u,Jc,Zc]}],"shadow-color":[{shadow:T()}],"inset-shadow":[{"inset-shadow":["none",d,Jc,Zc]}],"inset-shadow-color":[{"inset-shadow":T()}],"ring-w":[{ring:U()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:T()}],"ring-offset-w":[{"ring-offset":[Me,Ws]}],"ring-offset-color":[{"ring-offset":T()}],"inset-ring-w":[{"inset-ring":U()}],"inset-ring-color":[{"inset-ring":T()}],"text-shadow":[{"text-shadow":["none",h,Jc,Zc]}],"text-shadow-color":[{"text-shadow":T()}],opacity:[{opacity:[Me,re,ne]}],"mix-blend":[{"mix-blend":[...le(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":le()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[Me]}],"mask-image-linear-from-pos":[{"mask-linear-from":me()}],"mask-image-linear-to-pos":[{"mask-linear-to":me()}],"mask-image-linear-from-color":[{"mask-linear-from":T()}],"mask-image-linear-to-color":[{"mask-linear-to":T()}],"mask-image-t-from-pos":[{"mask-t-from":me()}],"mask-image-t-to-pos":[{"mask-t-to":me()}],"mask-image-t-from-color":[{"mask-t-from":T()}],"mask-image-t-to-color":[{"mask-t-to":T()}],"mask-image-r-from-pos":[{"mask-r-from":me()}],"mask-image-r-to-pos":[{"mask-r-to":me()}],"mask-image-r-from-color":[{"mask-r-from":T()}],"mask-image-r-to-color":[{"mask-r-to":T()}],"mask-image-b-from-pos":[{"mask-b-from":me()}],"mask-image-b-to-pos":[{"mask-b-to":me()}],"mask-image-b-from-color":[{"mask-b-from":T()}],"mask-image-b-to-color":[{"mask-b-to":T()}],"mask-image-l-from-pos":[{"mask-l-from":me()}],"mask-image-l-to-pos":[{"mask-l-to":me()}],"mask-image-l-from-color":[{"mask-l-from":T()}],"mask-image-l-to-color":[{"mask-l-to":T()}],"mask-image-x-from-pos":[{"mask-x-from":me()}],"mask-image-x-to-pos":[{"mask-x-to":me()}],"mask-image-x-from-color":[{"mask-x-from":T()}],"mask-image-x-to-color":[{"mask-x-to":T()}],"mask-image-y-from-pos":[{"mask-y-from":me()}],"mask-image-y-to-pos":[{"mask-y-to":me()}],"mask-image-y-from-color":[{"mask-y-from":T()}],"mask-image-y-to-color":[{"mask-y-to":T()}],"mask-image-radial":[{"mask-radial":[re,ne]}],"mask-image-radial-from-pos":[{"mask-radial-from":me()}],"mask-image-radial-to-pos":[{"mask-radial-to":me()}],"mask-image-radial-from-color":[{"mask-radial-from":T()}],"mask-image-radial-to-color":[{"mask-radial-to":T()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":w()}],"mask-image-conic-pos":[{"mask-conic":[Me]}],"mask-image-conic-from-pos":[{"mask-conic-from":me()}],"mask-image-conic-to-pos":[{"mask-conic-to":me()}],"mask-image-conic-from-color":[{"mask-conic-from":T()}],"mask-image-conic-to-color":[{"mask-conic-to":T()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:L()}],"mask-repeat":[{mask:W()}],"mask-size":[{mask:ee()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",re,ne]}],filter:[{filter:["","none",re,ne]}],blur:[{blur:Rt()}],brightness:[{brightness:[Me,re,ne]}],contrast:[{contrast:[Me,re,ne]}],"drop-shadow":[{"drop-shadow":["","none",f,Jc,Zc]}],"drop-shadow-color":[{"drop-shadow":T()}],grayscale:[{grayscale:["",Me,re,ne]}],"hue-rotate":[{"hue-rotate":[Me,re,ne]}],invert:[{invert:["",Me,re,ne]}],saturate:[{saturate:[Me,re,ne]}],sepia:[{sepia:["",Me,re,ne]}],"backdrop-filter":[{"backdrop-filter":["","none",re,ne]}],"backdrop-blur":[{"backdrop-blur":Rt()}],"backdrop-brightness":[{"backdrop-brightness":[Me,re,ne]}],"backdrop-contrast":[{"backdrop-contrast":[Me,re,ne]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Me,re,ne]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Me,re,ne]}],"backdrop-invert":[{"backdrop-invert":["",Me,re,ne]}],"backdrop-opacity":[{"backdrop-opacity":[Me,re,ne]}],"backdrop-saturate":[{"backdrop-saturate":[Me,re,ne]}],"backdrop-sepia":[{"backdrop-sepia":["",Me,re,ne]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":S()}],"border-spacing-x":[{"border-spacing-x":S()}],"border-spacing-y":[{"border-spacing-y":S()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",re,ne]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Me,"initial",re,ne]}],ease:[{ease:["linear","initial",b,re,ne]}],delay:[{delay:[Me,re,ne]}],animate:[{animate:["none",_,re,ne]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[m,re,ne]}],"perspective-origin":[{"perspective-origin":v()}],rotate:[{rotate:vt()}],"rotate-x":[{"rotate-x":vt()}],"rotate-y":[{"rotate-y":vt()}],"rotate-z":[{"rotate-z":vt()}],scale:[{scale:ut()}],"scale-x":[{"scale-x":ut()}],"scale-y":[{"scale-y":ut()}],"scale-z":[{"scale-z":ut()}],"scale-3d":["scale-3d"],skew:[{skew:_t()}],"skew-x":[{"skew-x":_t()}],"skew-y":[{"skew-y":_t()}],transform:[{transform:[re,ne,"","none","gpu","cpu"]}],"transform-origin":[{origin:v()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Ut()}],"translate-x":[{"translate-x":Ut()}],"translate-y":[{"translate-y":Ut()}],"translate-z":[{"translate-z":Ut()}],"translate-none":["translate-none"],accent:[{accent:T()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:T()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",re,ne]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":S()}],"scroll-mx":[{"scroll-mx":S()}],"scroll-my":[{"scroll-my":S()}],"scroll-ms":[{"scroll-ms":S()}],"scroll-me":[{"scroll-me":S()}],"scroll-mt":[{"scroll-mt":S()}],"scroll-mr":[{"scroll-mr":S()}],"scroll-mb":[{"scroll-mb":S()}],"scroll-ml":[{"scroll-ml":S()}],"scroll-p":[{"scroll-p":S()}],"scroll-px":[{"scroll-px":S()}],"scroll-py":[{"scroll-py":S()}],"scroll-ps":[{"scroll-ps":S()}],"scroll-pe":[{"scroll-pe":S()}],"scroll-pt":[{"scroll-pt":S()}],"scroll-pr":[{"scroll-pr":S()}],"scroll-pb":[{"scroll-pb":S()}],"scroll-pl":[{"scroll-pl":S()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",re,ne]}],fill:[{fill:["none",...T()]}],"stroke-w":[{stroke:[Me,so,Ws,Of]}],stroke:[{stroke:["none",...T()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},oR=BT(aR);function Bn(...r){return oR(Jo(r))}const Dy=ET({base:"ring-offset-background focus-visible:ring-ring inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border-input bg-background hover:bg-accent hover:text-accent-foreground border",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}});var lR=fe("<a><!></a>"),cR=fe("<button><!></button>");function pl(r,e){at(e,!0);let t=se(e,"variant",3,"default"),n=se(e,"size",3,"default"),s=se(e,"ref",15,null),i=se(e,"href",3,void 0),a=se(e,"type",3,"button"),o=Tt(e,["$$slots","$$events","$$legacy","class","variant","size","ref","href","type","children"]);var l=ze(),c=ke(l);{var u=h=>{var f=lR();let p;var m=B(f);kt(m,()=>e.children??In),z(f),es(f,g=>s(g),()=>s()),Ue(g=>p=Dt(f,p,{class:g,href:i(),...o}),[()=>Bn(Dy({variant:t(),size:n()}),e.class)]),q(h,f)},d=h=>{var f=cR();let p;var m=B(f);kt(m,()=>e.children??In),z(f),es(f,g=>s(g),()=>s()),Ue(g=>p=Dt(f,p,{class:g,type:a(),...o}),[()=>Bn(Dy({variant:t(),size:n()}),e.class)]),q(h,f)};Qe(c,h=>{i()?h(u):h(d,!1)})}q(r,l),ot()}var uR=fe("<input>"),dR=fe("<input>");function Jt(r,e){at(e,!0);let t=se(e,"ref",15,null),n=se(e,"value",15),s=se(e,"files",15),i=Tt(e,["$$slots","$$events","$$legacy","ref","value","type","files","class"]);var a=ze(),o=ke(a);{var l=u=>{var d=uR();Ay(d);let h;es(d,f=>t(f),()=>t()),Ue(f=>h=Dt(d,h,{class:f,type:"file",...i}),[()=>Bn("border-input bg-background ring-offset-background placeholder:text-muted-foreground focus-visible:ring-ring flex h-10 w-full rounded-md border px-3 py-2 text-base file:border-0 file:bg-transparent file:text-sm file:font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e.class)]),CO(d,s),Um(d,n),q(u,d)},c=u=>{var d=dR();Ay(d);let h;es(d,f=>t(f),()=>t()),Ue(f=>h=Dt(d,h,{class:f,type:e.type,...i}),[()=>Bn("border-input bg-background ring-offset-background placeholder:text-muted-foreground focus-visible:ring-ring flex h-10 w-full rounded-md border px-3 py-2 text-base file:border-0 file:bg-transparent file:text-sm file:font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e.class)]),Um(d,n),q(u,d)};Qe(o,u=>{e.type==="file"?u(l):u(c,!1)})}q(r,a),ot()}var hR=fe("<option> </option>"),fR=fe('<div class="box gap-2"><label for="frequency" class="text-sm font-medium">é¢ç (Hz)</label> <!></div>'),pR=fe('<div class="box gap-2"><label for="phase" class="text-sm font-medium">ç¸ä½ (å¼§åº¦)</label> <!></div>'),mR=fe('<div class="box gap-2"><label for="dutyCycle" class="text-sm font-medium">å ç©ºæ¯ (0-1)</label> <!></div>'),gR=fe('<div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="box gap-2"><label for="pulsePosition" class="text-sm font-medium">èå² Position (sample)</label> <!></div> <div class="box gap-2"><label for="pulseWidth" class="text-sm font-medium">èå² Width (samples)</label> <!></div></div>'),bR=fe('<div class="box gap-4"><form class="box space-y-4"><div class="grid gap-4"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="box gap-2"><label for="channelName" class="text-sm font-medium">ééåç§°</label> <!></div> <div class="box gap-2"><label for="signalType" class="text-sm font-medium">ä¿¡å·ç±»å</label> <select id="signalType" class="w-full px-3 py-2 border rounded-md border-input bg-background"></select></div></div> <div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div class="box gap-2"><label for="sampleRate" class="text-sm font-medium">éæ ·ç (Hz)</label> <!></div> <div class="box gap-2"><label for="length" class="text-sm font-medium">é¿åº¦ (æ ·æ¬æ°)</label> <!></div> <div class="box gap-2"><label for="amplitude" class="text-sm font-medium">å¹åº¦</label> <!></div></div> <!> <!> <!> <!></div> <!></form></div>');function _R(r,e){at(e,!1);const t=[{id:"sine",name:"æ­£å¼¦æ³¢",generator:Hm},{id:"square",name:"æ¹æ³¢",generator:Wm},{id:"triangle",name:"ä¸è§æ³¢",generator:Vm},{id:"sawtooth",name:"é¯é½¿æ³¢",generator:Gm},{id:"noise",name:"ç½åªå£°",generator:Zm},{id:"pulse",name:"èå²",generator:Jm}];let n=1;function s(){return"ä¿¡å· "+n++}let i=nn(t[0]),a=nn(s()),o=nn(1e3),l=nn(1e3),c=nn(10),u=nn(1),d=nn(.5),h=nn(500),f=nn(10),p=nn(0);function m(){let U;switch(P(i).id){case"sine":U=Hm(P(l),P(c),P(u),P(o),P(p));break;case"square":U=Wm(P(l),P(c),P(u),P(o),P(d));break;case"triangle":U=Vm(P(l),P(c),P(u),P(o));break;case"sawtooth":U=Gm(P(l),P(c),P(u),P(o));break;case"noise":U=Zm(P(l),P(u));break;case"pulse":U=Jm(P(l),P(h),P(f),P(u));break;default:U=[]}wb(P(a),U,P(o)),de(a,s())}kh();var g=bR(),b=B(g),_=B(b),y=B(_),w=B(y),v=V(B(w),2);Jt(v,{id:"channelName",type:"text",required:!0,get value(){return P(a)},set value(U){de(a,U)},$$legacy:!0}),z(w);var x=V(w,2),k=V(B(x),2);Ue(()=>{P(i),Bm(()=>{})}),Dn(k,5,()=>t,Ar,(U,G)=>{var le=hR(),me={},Rt=B(le,!0);z(le),Ue(()=>{me!==(me=P(G))&&(le.value=(le.__value=P(G))??""),yt(Rt,P(G).name)}),q(U,le)}),z(k),z(x),z(y);var S=V(y,2),R=B(S),D=V(B(R),2);Jt(D,{id:"sampleRate",type:"number",min:"1",required:!0,get value(){return P(o)},set value(U){de(o,U)},$$legacy:!0}),z(R);var M=V(R,2),N=V(B(M),2);Jt(N,{id:"length",type:"number",min:"1",required:!0,get value(){return P(l)},set value(U){de(l,U)},$$legacy:!0}),z(M);var C=V(M,2),A=V(B(C),2);Jt(A,{id:"amplitude",type:"number",step:"0.1",required:!0,get value(){return P(u)},set value(U){de(u,U)},$$legacy:!0}),z(C),z(S);var E=V(S,2);{var O=U=>{var G=fR(),le=V(B(G),2);Jt(le,{id:"frequency",type:"number",min:"0.1",step:"0.1",required:!0,get value(){return P(c)},set value(me){de(c,me)},$$legacy:!0}),z(G),q(U,G)};Qe(E,U=>{(P(i).id==="sine"||P(i).id==="square"||P(i).id==="triangle"||P(i).id==="sawtooth")&&U(O)})}var I=V(E,2);{var T=U=>{var G=pR(),le=V(B(G),2);Jt(le,{id:"phase",type:"number",step:"0.1",get value(){return P(p)},set value(me){de(p,me)},$$legacy:!0}),z(G),q(U,G)};Qe(I,U=>{P(i).id==="sine"&&U(T)})}var L=V(I,2);{var W=U=>{var G=mR(),le=V(B(G),2);Jt(le,{id:"dutyCycle",type:"number",min:"0",max:"1",step:"0.1",required:!0,get value(){return P(d)},set value(me){de(d,me)},$$legacy:!0}),z(G),q(U,G)};Qe(L,U=>{P(i).id==="square"&&U(W)})}var ee=V(L,2);{var Z=U=>{var G=gR(),le=B(G),me=V(B(le),2);const Rt=fc(()=>P(l)-1);Jt(me,{id:"pulsePosition",type:"number",min:"0",get max(){return P(Rt)},required:!0,get value(){return P(h)},set value(_t){de(h,_t)},$$legacy:!0}),z(le);var vt=V(le,2),ut=V(B(vt),2);Jt(ut,{id:"pulseWidth",type:"number",min:"1",required:!0,get value(){return P(f)},set value(_t){de(f,_t)},$$legacy:!0}),z(vt),z(G),q(U,G)};Qe(ee,U=>{P(i).id==="pulse"&&U(Z)})}z(_);var X=V(_,2);pl(X,{type:"submit",class:"w-full",children:(U,G)=>{Kn();var le=ni("çæä¿¡å·");q(U,le)},$$slots:{default:!0}}),z(b),z(g),la("submit",b,U=>{U.preventDefault(),m()}),hl(k,()=>P(i),U=>de(i,U)),q(r,g),ot()}function Pi(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Tf,Fy;function Sb(){if(Fy)return Tf;Fy=1;var r=function(s,i){return[s[0]+i[0],s[1]+i[1]]},e=function(s,i){return[s[0]-i[0],s[1]-i[1]]},t=function(s,i){return[s[0]*i[0]-s[1]*i[1],s[0]*i[1]+s[1]*i[0]]},n=function(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])};return Tf={add:r,subtract:e,multiply:t,magnitude:n},Tf}var Rf,zy;function Pb(){if(zy)return Rf;zy=1;var r=Sb(),e={},t=function(i,a){var o=-2*Math.PI*(i/a);return e[a]=e[a]||{},e[a][i]=e[a][i]||[Math.cos(o),Math.sin(o)],e[a][i]},n=function(i){var a=i.map(r.magnitude);return a.slice(0,a.length/2)},s=function(i,a){var o=a/i.length,l=i.slice(0,i.length/2);return l.map(function(c,u){return u*o})};return Rf={fftMag:n,fftFreq:s,exponent:t},Rf}var dt={},By;function yR(){if(By)return dt;By=1;var r=32;dt.INT_BITS=r,dt.INT_MAX=2147483647,dt.INT_MIN=-1<<r-1,dt.sign=function(n){return(n>0)-(n<0)},dt.abs=function(n){var s=n>>r-1;return(n^s)-s},dt.min=function(n,s){return s^(n^s)&-(n<s)},dt.max=function(n,s){return n^(n^s)&-(n<s)},dt.isPow2=function(n){return!(n&n-1)&&!!n},dt.log2=function(n){var s,i;return s=(n>65535)<<4,n>>>=s,i=(n>255)<<3,n>>>=i,s|=i,i=(n>15)<<2,n>>>=i,s|=i,i=(n>3)<<1,n>>>=i,s|=i,s|n>>1},dt.log10=function(n){return n>=1e9?9:n>=1e8?8:n>=1e7?7:n>=1e6?6:n>=1e5?5:n>=1e4?4:n>=1e3?3:n>=100?2:n>=10?1:0},dt.popCount=function(n){return n=n-(n>>>1&1431655765),n=(n&858993459)+(n>>>2&858993459),(n+(n>>>4)&252645135)*16843009>>>24};function e(n){var s=32;return n&=-n,n&&s--,n&65535&&(s-=16),n&16711935&&(s-=8),n&252645135&&(s-=4),n&858993459&&(s-=2),n&1431655765&&(s-=1),s}dt.countTrailingZeros=e,dt.nextPow2=function(n){return n+=n===0,--n,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n+1},dt.prevPow2=function(n){return n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n-(n>>>1)},dt.parity=function(n){return n^=n>>>16,n^=n>>>8,n^=n>>>4,n&=15,27030>>>n&1};var t=new Array(256);return function(n){for(var s=0;s<256;++s){var i=s,a=s,o=7;for(i>>>=1;i;i>>>=1)a<<=1,a|=i&1,--o;n[s]=a<<o&255}}(t),dt.reverse=function(n){return t[n&255]<<24|t[n>>>8&255]<<16|t[n>>>16&255]<<8|t[n>>>24&255]},dt.interleave2=function(n,s){return n&=65535,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,s&=65535,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,n|s<<1},dt.deinterleave2=function(n,s){return n=n>>>s&1431655765,n=(n|n>>>1)&858993459,n=(n|n>>>2)&252645135,n=(n|n>>>4)&16711935,n=(n|n>>>16)&65535,n<<16>>16},dt.interleave3=function(n,s,i){return n&=1023,n=(n|n<<16)&4278190335,n=(n|n<<8)&251719695,n=(n|n<<4)&3272356035,n=(n|n<<2)&1227133513,s&=1023,s=(s|s<<16)&4278190335,s=(s|s<<8)&251719695,s=(s|s<<4)&3272356035,s=(s|s<<2)&1227133513,n|=s<<1,i&=1023,i=(i|i<<16)&4278190335,i=(i|i<<8)&251719695,i=(i|i<<4)&3272356035,i=(i|i<<2)&1227133513,n|i<<2},dt.deinterleave3=function(n,s){return n=n>>>s&1227133513,n=(n|n>>>2)&3272356035,n=(n|n>>>4)&251719695,n=(n|n>>>8)&4278190335,n=(n|n>>>16)&1023,n<<22>>22},dt.nextCombination=function(n){var s=n|n-1;return s+1|(~s&-~s)-1>>>e(n)+1},dt}var If,Uy;function ig(){if(Uy)return If;Uy=1;var r=Sb(),e=Pb(),t=yR();return If={fft:function n(s){var i=[],a=s.length;if(a==1)return Array.isArray(s[0])?[[s[0][0],s[0][1]]]:[[s[0],0]];for(var o=n(s.filter(h)),l=n(s.filter(f)),c=0;c<a/2;c++){var u=o[c],d=r.multiply(e.exponent(c,a),l[c]);i[c]=r.add(u,d),i[c+a/2]=r.subtract(u,d)}function h(p,m){return m%2==0}function f(p,m){return m%2==1}return i},fftInPlace:function(n){for(var s=n.length,i=t.countTrailingZeros(s),a=0;a<s;a++){var o=t.reverse(a)>>>t.INT_BITS-i;if(o>a){var l=[n[a],0];n[a]=n[o],n[o]=l}else n[o]=[n[o],0]}for(var c=2;c<=s;c+=c)for(var u=0;u<c/2;u++)for(var d=e.exponent(u,c),h=0;h<s/c;h++){var f=r.multiply(d,n[h*c+u+c/2]);n[h*c+u+c/2]=r.subtract(n[h*c+u],f),n[h*c+u]=r.add(n[h*c+u],f)}}},If}var Cf,qy;function wR(){if(qy)return Cf;qy=1;var r=ig().fft;return Cf={ifft:function(t){for(var n=[],s=0;s<t.length;s++)n[s]=[t[s][1],t[s][0]];for(var i=r(n),a=[],o=0;o<i.length;o++)a[o]=[i[o][1]/i.length,i[o][0]/i.length];return a}},Cf}var $f,Hy;function oS(){if(Hy)return $f;Hy=1;var r=Sb(),e=Pb(),t=function(n){for(var s=[],i=n.length,a=0;a<i;a++){s[a]=[0,0];for(var o=0;o<i;o++){var l=e.exponent(a*o,i),c;Array.isArray(n[o])?c=r.multiply(n[o],l):c=r.multiply([n[o],0],l),s[a]=r.add(s[a],c)}}return s};return $f=t,$f}var Mf,Wy;function vR(){if(Wy)return Mf;Wy=1;var r=oS();function e(t){for(var n=[],s=0;s<t.length;s++)n[s]=[t[s][1],t[s][0]];for(var i=r(n),a=[],o=0;o<i.length;o++)a[o]=[i[o][1]/i.length,i[o][0]/i.length];return a}return Mf=e,Mf}var Nf,Vy;function xR(){return Vy||(Vy=1,Nf={fft:ig().fft,ifft:wR().ifft,fftInPlace:ig().fftInPlace,util:Pb(),dft:oS(),idft:vR()}),Nf}var kR=xR();const Gy=Pi(kR);function lS(r,e){if(e<=1||e>r.length)return[...r];const t=[];let n=0;for(let s=0;s<e;s++)s<r.length&&(n+=r[s]);for(let s=0;s<r.length;s++)s>=e&&(n=n-r[s-e]+r[s]),t.push(n/Math.min(e,s+1));return t}function cS(r,e,t){const n=1/t,s=1/(2*Math.PI*e),i=n/(s+n),a=[];let o=r[0]||0;for(let l=0;l<r.length;l++)o=o+i*(r[l]-o),a.push(o);return a}function uS(r,e,t){const n=1/t,s=1/(2*Math.PI*e),i=s/(s+n),a=[];let o=0,l=r[0]||0;for(let c=0;c<r.length;c++){const u=r[c],d=i*(o+u-l);a.push(d),o=d,l=u}return a}function Ab(r){const e=Math.pow(2,Math.ceil(Math.log2(r.length))),t=[...r];for(;t.length<e;)t.push(0);const n=Gy.fft(t),s=Gy.util.fftMag(n);return s.slice(0,Math.floor(s.length/2))}function SR(r,e){const t=Ab(r),n=t.length,s=Array.from({length:n},(a,o)=>o*e/(2*n)),i=t.map(a=>a*a);return{frequencies:s,powerSpectrum:i}}function dS(r,e){if(r.length<=1)return new Array(r.length).fill(0);const t=[],n=1/e;t.push((r[1]-r[0])/n);for(let s=1;s<r.length-1;s++)t.push((r[s+1]-r[s-1])/(2*n));return t.push((r[r.length-1]-r[r.length-2])/n),t}function hS(r,e){const t=[],n=1/e;let s=0;for(let i=0;i<r.length;i++)s+=r[i]*n,t.push(s);return t}var PR=fe("<option> </option>"),AR=fe("<option> </option>"),ER=fe('<div class="box gap-2"><label for="windowSize" class="text-sm font-medium">çªå£å¤§å°</label> <!></div>'),OR=fe('<div class="box gap-2"><label for="cutoffFrequency" class="text-sm font-medium">æªæ­¢é¢ç (Hz)</label> <!></div>'),TR=fe('<div class="box gap-4"><form class="box space-y-4"><div class="grid gap-4"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="box gap-2"><label for="sourceChannel" class="text-sm font-medium">æºéé</label> <select id="sourceChannel" required class="w-full px-3 py-2 border rounded-md border-input bg-background"><option>éæ©ä¸ä¸ªéé</option><!></select></div> <div class="box gap-2"><label for="processingMethod" class="text-sm font-medium">å¤çæ¹æ³</label> <select id="processingMethod" class="w-full px-3 py-2 border rounded-md border-input bg-background"></select></div></div> <div class="box gap-2"><label for="newChannelName" class="text-sm font-medium">æ°ééåç§°</label> <!></div> <!> <!></div> <!></form></div>');function RR(r,e){at(e,!1);const[t,n]=bb(),s=()=>_b(La,"$channels",t),i=[{id:"movingAverage",name:"ç§»å¨å¹³å",processor:lS,params:["windowSize"]},{id:"lowPass",name:"ä½éæ»¤æ³¢å¨",processor:cS,params:["cutoffFrequency","sampleRate"]},{id:"highPass",name:"é«éæ»¤æ³¢å¨",processor:uS,params:["cutoffFrequency","sampleRate"]},{id:"fft",name:"FFT",processor:Ab,params:[]},{id:"powerSpectrum",name:"åçè°±",processor:SR,params:["sampleRate"]},{id:"differentiate",name:"å¾®å",processor:dS,params:["sampleRate"]},{id:"integrate",name:"ç§¯å",processor:hS,params:["sampleRate"]}];let a=nn(i[0]),o=se(e,"selectedChannelId",12,""),l=nn(""),c=nn(10),u=nn(100);function d(){if(!o()||!P(l))return;const A=s().find(O=>O.id===o());if(!A)return;P(l)||de(l,`${A.name} (${P(a).name})`);const E={};P(a).params.includes("windowSize")&&(E.windowSize=P(c)),P(a).params.includes("cutoffFrequency")&&(E.cutoffFrequency=P(u)),P(a).params.includes("sampleRate")&&(E.sampleRate=A.sampleRate),Lk(o(),P(a).processor,P(l),E),de(l,"")}sO(()=>(aO(o()),P(a),s()),()=>{if(o()&&P(a)){const A=s().find(E=>E.id===o());A&&de(l,`${A.name} (${P(a).name})`)}}),iO(),kh();var h=TR(),f=B(h),p=B(f),m=B(p),g=B(m),b=V(B(g),2);Ue(()=>{o(),Bm(()=>{s()})});var _=B(b);_.value=_.__value="";var y=V(_);Dn(y,1,s,Ar,(A,E)=>{var O=PR(),I={},T=B(O,!0);z(O),Ue(()=>{I!==(I=P(E).id)&&(O.value=(O.__value=P(E).id)??""),yt(T,P(E).name)}),q(A,O)}),z(b),z(g);var w=V(g,2),v=V(B(w),2);Ue(()=>{P(a),Bm(()=>{})}),Dn(v,5,()=>i,Ar,(A,E)=>{var O=AR(),I={},T=B(O,!0);z(O),Ue(()=>{I!==(I=P(E))&&(O.value=(O.__value=P(E))??""),yt(T,P(E).name)}),q(A,O)}),z(v),z(w),z(m);var x=V(m,2),k=V(B(x),2);Jt(k,{id:"newChannelName",type:"text",required:!0,get value(){return P(l)},set value(A){de(l,A)},$$legacy:!0}),z(x);var S=V(x,2);{var R=A=>{var E=ER(),O=V(B(E),2);Jt(O,{id:"windowSize",type:"number",min:"1",required:!0,get value(){return P(c)},set value(I){de(c,I)},$$legacy:!0}),z(E),q(A,E)};Qe(S,A=>{P(a)&&P(a).params.includes("windowSize")&&A(R)})}var D=V(S,2);{var M=A=>{var E=OR(),O=V(B(E),2);Jt(O,{id:"cutoffFrequency",type:"number",min:"0.1",step:"0.1",required:!0,get value(){return P(u)},set value(I){de(u,I)},$$legacy:!0}),z(E),q(A,E)};Qe(D,A=>{P(a)&&P(a).params.includes("cutoffFrequency")&&A(M)})}z(p);var N=V(p,2);const C=fc(()=>!o());pl(N,{type:"submit",get disabled(){return P(C)},class:"w-full",children:(A,E)=>{Kn();var O=ni("å¤çä¿¡å·");q(A,O)},$$slots:{default:!0}}),z(f),z(h),la("submit",f,A=>{A.preventDefault(),d()}),hl(b,o),hl(v,()=>P(a),A=>de(a,A)),q(r,h),ot(),n()}/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function bc(r){return r+.5|0}const vs=(r,e,t)=>Math.max(Math.min(r,t),e);function Co(r){return vs(bc(r*2.55),0,255)}function Ps(r){return vs(bc(r*255),0,255)}function Hr(r){return vs(bc(r/2.55)/100,0,1)}function Zy(r){return vs(bc(r*100),0,100)}const Mn={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},ag=[..."0123456789ABCDEF"],IR=r=>ag[r&15],CR=r=>ag[(r&240)>>4]+ag[r&15],Kc=r=>(r&240)>>4===(r&15),$R=r=>Kc(r.r)&&Kc(r.g)&&Kc(r.b)&&Kc(r.a);function MR(r){var e=r.length,t;return r[0]==="#"&&(e===4||e===5?t={r:255&Mn[r[1]]*17,g:255&Mn[r[2]]*17,b:255&Mn[r[3]]*17,a:e===5?Mn[r[4]]*17:255}:(e===7||e===9)&&(t={r:Mn[r[1]]<<4|Mn[r[2]],g:Mn[r[3]]<<4|Mn[r[4]],b:Mn[r[5]]<<4|Mn[r[6]],a:e===9?Mn[r[7]]<<4|Mn[r[8]]:255})),t}const NR=(r,e)=>r<255?e(r):"";function LR(r){var e=$R(r)?IR:CR;return r?"#"+e(r.r)+e(r.g)+e(r.b)+NR(r.a,e):void 0}const jR=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function fS(r,e,t){const n=e*Math.min(t,1-t),s=(i,a=(i+r/30)%12)=>t-n*Math.max(Math.min(a-3,9-a,1),-1);return[s(0),s(8),s(4)]}function DR(r,e,t){const n=(s,i=(s+r/60)%6)=>t-t*e*Math.max(Math.min(i,4-i,1),0);return[n(5),n(3),n(1)]}function FR(r,e,t){const n=fS(r,1,.5);let s;for(e+t>1&&(s=1/(e+t),e*=s,t*=s),s=0;s<3;s++)n[s]*=1-e-t,n[s]+=e;return n}function zR(r,e,t,n,s){return r===s?(e-t)/n+(e<t?6:0):e===s?(t-r)/n+2:(r-e)/n+4}function Eb(r){const t=r.r/255,n=r.g/255,s=r.b/255,i=Math.max(t,n,s),a=Math.min(t,n,s),o=(i+a)/2;let l,c,u;return i!==a&&(u=i-a,c=o>.5?u/(2-i-a):u/(i+a),l=zR(t,n,s,u,i),l=l*60+.5),[l|0,c||0,o]}function Ob(r,e,t,n){return(Array.isArray(e)?r(e[0],e[1],e[2]):r(e,t,n)).map(Ps)}function Tb(r,e,t){return Ob(fS,r,e,t)}function BR(r,e,t){return Ob(FR,r,e,t)}function UR(r,e,t){return Ob(DR,r,e,t)}function pS(r){return(r%360+360)%360}function qR(r){const e=jR.exec(r);let t=255,n;if(!e)return;e[5]!==n&&(t=e[6]?Co(+e[5]):Ps(+e[5]));const s=pS(+e[2]),i=+e[3]/100,a=+e[4]/100;return e[1]==="hwb"?n=BR(s,i,a):e[1]==="hsv"?n=UR(s,i,a):n=Tb(s,i,a),{r:n[0],g:n[1],b:n[2],a:t}}function HR(r,e){var t=Eb(r);t[0]=pS(t[0]+e),t=Tb(t),r.r=t[0],r.g=t[1],r.b=t[2]}function WR(r){if(!r)return;const e=Eb(r),t=e[0],n=Zy(e[1]),s=Zy(e[2]);return r.a<255?`hsla(${t}, ${n}%, ${s}%, ${Hr(r.a)})`:`hsl(${t}, ${n}%, ${s}%)`}const Jy={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Ky={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function VR(){const r={},e=Object.keys(Ky),t=Object.keys(Jy);let n,s,i,a,o;for(n=0;n<e.length;n++){for(a=o=e[n],s=0;s<t.length;s++)i=t[s],o=o.replace(i,Jy[i]);i=parseInt(Ky[a],16),r[o]=[i>>16&255,i>>8&255,i&255]}return r}let Xc;function GR(r){Xc||(Xc=VR(),Xc.transparent=[0,0,0,0]);const e=Xc[r.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const ZR=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function JR(r){const e=ZR.exec(r);let t=255,n,s,i;if(e){if(e[7]!==n){const a=+e[7];t=e[8]?Co(a):vs(a*255,0,255)}return n=+e[1],s=+e[3],i=+e[5],n=255&(e[2]?Co(n):vs(n,0,255)),s=255&(e[4]?Co(s):vs(s,0,255)),i=255&(e[6]?Co(i):vs(i,0,255)),{r:n,g:s,b:i,a:t}}}function KR(r){return r&&(r.a<255?`rgba(${r.r}, ${r.g}, ${r.b}, ${Hr(r.a)})`:`rgb(${r.r}, ${r.g}, ${r.b})`)}const Lf=r=>r<=.0031308?r*12.92:Math.pow(r,1/2.4)*1.055-.055,Mi=r=>r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4);function XR(r,e,t){const n=Mi(Hr(r.r)),s=Mi(Hr(r.g)),i=Mi(Hr(r.b));return{r:Ps(Lf(n+t*(Mi(Hr(e.r))-n))),g:Ps(Lf(s+t*(Mi(Hr(e.g))-s))),b:Ps(Lf(i+t*(Mi(Hr(e.b))-i))),a:r.a+t*(e.a-r.a)}}function Yc(r,e,t){if(r){let n=Eb(r);n[e]=Math.max(0,Math.min(n[e]+n[e]*t,e===0?360:1)),n=Tb(n),r.r=n[0],r.g=n[1],r.b=n[2]}}function mS(r,e){return r&&Object.assign(e||{},r)}function Xy(r){var e={r:0,g:0,b:0,a:255};return Array.isArray(r)?r.length>=3&&(e={r:r[0],g:r[1],b:r[2],a:255},r.length>3&&(e.a=Ps(r[3]))):(e=mS(r,{r:0,g:0,b:0,a:1}),e.a=Ps(e.a)),e}function YR(r){return r.charAt(0)==="r"?JR(r):qR(r)}class ml{constructor(e){if(e instanceof ml)return e;const t=typeof e;let n;t==="object"?n=Xy(e):t==="string"&&(n=MR(e)||GR(e)||YR(e)),this._rgb=n,this._valid=!!n}get valid(){return this._valid}get rgb(){var e=mS(this._rgb);return e&&(e.a=Hr(e.a)),e}set rgb(e){this._rgb=Xy(e)}rgbString(){return this._valid?KR(this._rgb):void 0}hexString(){return this._valid?LR(this._rgb):void 0}hslString(){return this._valid?WR(this._rgb):void 0}mix(e,t){if(e){const n=this.rgb,s=e.rgb;let i;const a=t===i?.5:t,o=2*a-1,l=n.a-s.a,c=((o*l===-1?o:(o+l)/(1+o*l))+1)/2;i=1-c,n.r=255&c*n.r+i*s.r+.5,n.g=255&c*n.g+i*s.g+.5,n.b=255&c*n.b+i*s.b+.5,n.a=a*n.a+(1-a)*s.a,this.rgb=n}return this}interpolate(e,t){return e&&(this._rgb=XR(this._rgb,e._rgb,t)),this}clone(){return new ml(this.rgb)}alpha(e){return this._rgb.a=Ps(e),this}clearer(e){const t=this._rgb;return t.a*=1-e,this}greyscale(){const e=this._rgb,t=bc(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=t,this}opaquer(e){const t=this._rgb;return t.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return Yc(this._rgb,2,e),this}darken(e){return Yc(this._rgb,2,-e),this}saturate(e){return Yc(this._rgb,1,e),this}desaturate(e){return Yc(this._rgb,1,-e),this}rotate(e){return HR(this._rgb,e),this}}/*!
 * Chart.js v4.4.9
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function $r(){}const QR=(()=>{let r=0;return()=>r++})();function Le(r){return r==null}function lt(r){if(Array.isArray&&Array.isArray(r))return!0;const e=Object.prototype.toString.call(r);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function De(r){return r!==null&&Object.prototype.toString.call(r)==="[object Object]"}function gt(r){return(typeof r=="number"||r instanceof Number)&&isFinite(+r)}function An(r,e){return gt(r)?r:e}function Se(r,e){return typeof r>"u"?e:r}const eI=(r,e)=>typeof r=="string"&&r.endsWith("%")?parseFloat(r)/100:+r/e,gS=(r,e)=>typeof r=="string"&&r.endsWith("%")?parseFloat(r)/100*e:+r;function nt(r,e,t){if(r&&typeof r.call=="function")return r.apply(t,e)}function Je(r,e,t,n){let s,i,a;if(lt(r))for(i=r.length,s=0;s<i;s++)e.call(t,r[s],s);else if(De(r))for(a=Object.keys(r),i=a.length,s=0;s<i;s++)e.call(t,r[a[s]],a[s])}function wd(r,e){let t,n,s,i;if(!r||!e||r.length!==e.length)return!1;for(t=0,n=r.length;t<n;++t)if(s=r[t],i=e[t],s.datasetIndex!==i.datasetIndex||s.index!==i.index)return!1;return!0}function vd(r){if(lt(r))return r.map(vd);if(De(r)){const e=Object.create(null),t=Object.keys(r),n=t.length;let s=0;for(;s<n;++s)e[t[s]]=vd(r[t[s]]);return e}return r}function bS(r){return["__proto__","prototype","constructor"].indexOf(r)===-1}function tI(r,e,t,n){if(!bS(r))return;const s=e[r],i=t[r];De(s)&&De(i)?gl(s,i,n):e[r]=vd(i)}function gl(r,e,t){const n=lt(e)?e:[e],s=n.length;if(!De(r))return r;t=t||{};const i=t.merger||tI;let a;for(let o=0;o<s;++o){if(a=n[o],!De(a))continue;const l=Object.keys(a);for(let c=0,u=l.length;c<u;++c)i(l[c],r,a,t)}return r}function Xo(r,e){return gl(r,e,{merger:nI})}function nI(r,e,t){if(!bS(r))return;const n=e[r],s=t[r];De(n)&&De(s)?Xo(n,s):Object.prototype.hasOwnProperty.call(e,r)||(e[r]=vd(s))}const Yy={"":r=>r,x:r=>r.x,y:r=>r.y};function rI(r){const e=r.split("."),t=[];let n="";for(const s of e)n+=s,n.endsWith("\\")?n=n.slice(0,-1)+".":(t.push(n),n="");return t}function sI(r){const e=rI(r);return t=>{for(const n of e){if(n==="")break;t=t&&t[n]}return t}}function Ts(r,e){return(Yy[e]||(Yy[e]=sI(e)))(r)}function Rb(r){return r.charAt(0).toUpperCase()+r.slice(1)}const bl=r=>typeof r<"u",Rs=r=>typeof r=="function",Qy=(r,e)=>{if(r.size!==e.size)return!1;for(const t of r)if(!e.has(t))return!1;return!0};function iI(r){return r.type==="mouseup"||r.type==="click"||r.type==="contextmenu"}const it=Math.PI,st=2*it,aI=st+it,xd=Number.POSITIVE_INFINITY,oI=it/180,wt=it/2,Vs=it/4,ew=it*2/3,xs=Math.log10,Pr=Math.sign;function Yo(r,e,t){return Math.abs(r-e)<t}function tw(r){const e=Math.round(r);r=Yo(r,e,r/1e3)?e:r;const t=Math.pow(10,Math.floor(xs(r))),n=r/t;return(n<=1?1:n<=2?2:n<=5?5:10)*t}function lI(r){const e=[],t=Math.sqrt(r);let n;for(n=1;n<t;n++)r%n===0&&(e.push(n),e.push(r/n));return t===(t|0)&&e.push(t),e.sort((s,i)=>s-i).pop(),e}function cI(r){return typeof r=="symbol"||typeof r=="object"&&r!==null&&!(Symbol.toPrimitive in r||"toString"in r||"valueOf"in r)}function Oa(r){return!cI(r)&&!isNaN(parseFloat(r))&&isFinite(r)}function uI(r,e){const t=Math.round(r);return t-e<=r&&t+e>=r}function _S(r,e,t){let n,s,i;for(n=0,s=r.length;n<s;n++)i=r[n][t],isNaN(i)||(e.min=Math.min(e.min,i),e.max=Math.max(e.max,i))}function Xn(r){return r*(it/180)}function Ib(r){return r*(180/it)}function nw(r){if(!gt(r))return;let e=1,t=0;for(;Math.round(r*e)/e!==r;)e*=10,t++;return t}function yS(r,e){const t=e.x-r.x,n=e.y-r.y,s=Math.sqrt(t*t+n*n);let i=Math.atan2(n,t);return i<-.5*it&&(i+=st),{angle:i,distance:s}}function og(r,e){return Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2))}function dI(r,e){return(r-e+aI)%st-it}function Tn(r){return(r%st+st)%st}function _l(r,e,t,n){const s=Tn(r),i=Tn(e),a=Tn(t),o=Tn(i-s),l=Tn(a-s),c=Tn(s-i),u=Tn(s-a);return s===i||s===a||n&&i===a||o>l&&c<u}function Lt(r,e,t){return Math.max(e,Math.min(t,r))}function hI(r){return Lt(r,-32768,32767)}function Kr(r,e,t,n=1e-6){return r>=Math.min(e,t)-n&&r<=Math.max(e,t)+n}function Cb(r,e,t){t=t||(a=>r[a]<e);let n=r.length-1,s=0,i;for(;n-s>1;)i=s+n>>1,t(i)?s=i:n=i;return{lo:s,hi:n}}const Xr=(r,e,t,n)=>Cb(r,t,n?s=>{const i=r[s][e];return i<t||i===t&&r[s+1][e]===t}:s=>r[s][e]<t),fI=(r,e,t)=>Cb(r,t,n=>r[n][e]>=t);function pI(r,e,t){let n=0,s=r.length;for(;n<s&&r[n]<e;)n++;for(;s>n&&r[s-1]>t;)s--;return n>0||s<r.length?r.slice(n,s):r}const wS=["push","pop","shift","splice","unshift"];function mI(r,e){if(r._chartjs){r._chartjs.listeners.push(e);return}Object.defineProperty(r,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),wS.forEach(t=>{const n="_onData"+Rb(t),s=r[t];Object.defineProperty(r,t,{configurable:!0,enumerable:!1,value(...i){const a=s.apply(this,i);return r._chartjs.listeners.forEach(o=>{typeof o[n]=="function"&&o[n](...i)}),a}})})}function rw(r,e){const t=r._chartjs;if(!t)return;const n=t.listeners,s=n.indexOf(e);s!==-1&&n.splice(s,1),!(n.length>0)&&(wS.forEach(i=>{delete r[i]}),delete r._chartjs)}function vS(r){const e=new Set(r);return e.size===r.length?r:Array.from(e)}const xS=function(){return typeof window>"u"?function(r){return r()}:window.requestAnimationFrame}();function kS(r,e){let t=[],n=!1;return function(...s){t=s,n||(n=!0,xS.call(window,()=>{n=!1,r.apply(e,t)}))}}function gI(r,e){let t;return function(...n){return e?(clearTimeout(t),t=setTimeout(r,e,n)):r.apply(this,n),e}}const $b=r=>r==="start"?"left":r==="end"?"right":"center",Zt=(r,e,t)=>r==="start"?e:r==="end"?t:(e+t)/2,bI=(r,e,t,n)=>r===(n?"left":"right")?t:r==="center"?(e+t)/2:e;function SS(r,e,t){const n=e.length;let s=0,i=n;if(r._sorted){const{iScale:a,vScale:o,_parsed:l}=r,c=r.dataset&&r.dataset.options?r.dataset.options.spanGaps:null,u=a.axis,{min:d,max:h,minDefined:f,maxDefined:p}=a.getUserBounds();if(f){if(s=Math.min(Xr(l,u,d).lo,t?n:Xr(e,u,a.getPixelForValue(d)).lo),c){const m=l.slice(0,s+1).reverse().findIndex(g=>!Le(g[o.axis]));s-=Math.max(0,m)}s=Lt(s,0,n-1)}if(p){let m=Math.max(Xr(l,a.axis,h,!0).hi+1,t?0:Xr(e,u,a.getPixelForValue(h),!0).hi+1);if(c){const g=l.slice(m-1).findIndex(b=>!Le(b[o.axis]));m+=Math.max(0,g)}i=Lt(m,s,n)-s}else i=n-s}return{start:s,count:i}}function PS(r){const{xScale:e,yScale:t,_scaleRanges:n}=r,s={xmin:e.min,xmax:e.max,ymin:t.min,ymax:t.max};if(!n)return r._scaleRanges=s,!0;const i=n.xmin!==e.min||n.xmax!==e.max||n.ymin!==t.min||n.ymax!==t.max;return Object.assign(n,s),i}const Qc=r=>r===0||r===1,sw=(r,e,t)=>-(Math.pow(2,10*(r-=1))*Math.sin((r-e)*st/t)),iw=(r,e,t)=>Math.pow(2,-10*r)*Math.sin((r-e)*st/t)+1,Qo={linear:r=>r,easeInQuad:r=>r*r,easeOutQuad:r=>-r*(r-2),easeInOutQuad:r=>(r/=.5)<1?.5*r*r:-.5*(--r*(r-2)-1),easeInCubic:r=>r*r*r,easeOutCubic:r=>(r-=1)*r*r+1,easeInOutCubic:r=>(r/=.5)<1?.5*r*r*r:.5*((r-=2)*r*r+2),easeInQuart:r=>r*r*r*r,easeOutQuart:r=>-((r-=1)*r*r*r-1),easeInOutQuart:r=>(r/=.5)<1?.5*r*r*r*r:-.5*((r-=2)*r*r*r-2),easeInQuint:r=>r*r*r*r*r,easeOutQuint:r=>(r-=1)*r*r*r*r+1,easeInOutQuint:r=>(r/=.5)<1?.5*r*r*r*r*r:.5*((r-=2)*r*r*r*r+2),easeInSine:r=>-Math.cos(r*wt)+1,easeOutSine:r=>Math.sin(r*wt),easeInOutSine:r=>-.5*(Math.cos(it*r)-1),easeInExpo:r=>r===0?0:Math.pow(2,10*(r-1)),easeOutExpo:r=>r===1?1:-Math.pow(2,-10*r)+1,easeInOutExpo:r=>Qc(r)?r:r<.5?.5*Math.pow(2,10*(r*2-1)):.5*(-Math.pow(2,-10*(r*2-1))+2),easeInCirc:r=>r>=1?r:-(Math.sqrt(1-r*r)-1),easeOutCirc:r=>Math.sqrt(1-(r-=1)*r),easeInOutCirc:r=>(r/=.5)<1?-.5*(Math.sqrt(1-r*r)-1):.5*(Math.sqrt(1-(r-=2)*r)+1),easeInElastic:r=>Qc(r)?r:sw(r,.075,.3),easeOutElastic:r=>Qc(r)?r:iw(r,.075,.3),easeInOutElastic(r){return Qc(r)?r:r<.5?.5*sw(r*2,.1125,.45):.5+.5*iw(r*2-1,.1125,.45)},easeInBack(r){return r*r*((1.70158+1)*r-1.70158)},easeOutBack(r){return(r-=1)*r*((1.70158+1)*r+1.70158)+1},easeInOutBack(r){let e=1.70158;return(r/=.5)<1?.5*(r*r*(((e*=1.525)+1)*r-e)):.5*((r-=2)*r*(((e*=1.525)+1)*r+e)+2)},easeInBounce:r=>1-Qo.easeOutBounce(1-r),easeOutBounce(r){return r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375},easeInOutBounce:r=>r<.5?Qo.easeInBounce(r*2)*.5:Qo.easeOutBounce(r*2-1)*.5+.5};function Mb(r){if(r&&typeof r=="object"){const e=r.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function aw(r){return Mb(r)?r:new ml(r)}function jf(r){return Mb(r)?r:new ml(r).saturate(.5).darken(.1).hexString()}const _I=["x","y","borderWidth","radius","tension"],yI=["color","borderColor","backgroundColor"];function wI(r){r.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),r.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),r.set("animations",{colors:{type:"color",properties:yI},numbers:{type:"number",properties:_I}}),r.describe("animations",{_fallback:"animation"}),r.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function vI(r){r.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const ow=new Map;function xI(r,e){e=e||{};const t=r+JSON.stringify(e);let n=ow.get(t);return n||(n=new Intl.NumberFormat(r,e),ow.set(t,n)),n}function _c(r,e,t){return xI(e,t).format(r)}const AS={values(r){return lt(r)?r:""+r},numeric(r,e,t){if(r===0)return"0";const n=this.chart.options.locale;let s,i=r;if(t.length>1){const c=Math.max(Math.abs(t[0].value),Math.abs(t[t.length-1].value));(c<1e-4||c>1e15)&&(s="scientific"),i=kI(r,t)}const a=xs(Math.abs(i)),o=isNaN(a)?1:Math.max(Math.min(-1*Math.floor(a),20),0),l={notation:s,minimumFractionDigits:o,maximumFractionDigits:o};return Object.assign(l,this.options.ticks.format),_c(r,n,l)},logarithmic(r,e,t){if(r===0)return"0";const n=t[e].significand||r/Math.pow(10,Math.floor(xs(r)));return[1,2,3,5,10,15].includes(n)||e>.8*t.length?AS.numeric.call(this,r,e,t):""}};function kI(r,e){let t=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(t)>=1&&r!==Math.floor(r)&&(t=r-Math.floor(r)),t}var Sh={formatters:AS};function SI(r){r.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,t)=>t.lineWidth,tickColor:(e,t)=>t.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Sh.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),r.route("scale.ticks","color","","color"),r.route("scale.grid","color","","borderColor"),r.route("scale.border","color","","borderColor"),r.route("scale.title","color","","color"),r.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),r.describe("scales",{_fallback:"scale"}),r.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}const mi=Object.create(null),lg=Object.create(null);function el(r,e){if(!e)return r;const t=e.split(".");for(let n=0,s=t.length;n<s;++n){const i=t[n];r=r[i]||(r[i]=Object.create(null))}return r}function Df(r,e,t){return typeof e=="string"?gl(el(r,e),t):gl(el(r,""),e)}class PI{constructor(e,t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=n=>n.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(n,s)=>jf(s.backgroundColor),this.hoverBorderColor=(n,s)=>jf(s.borderColor),this.hoverColor=(n,s)=>jf(s.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(t)}set(e,t){return Df(this,e,t)}get(e){return el(this,e)}describe(e,t){return Df(lg,e,t)}override(e,t){return Df(mi,e,t)}route(e,t,n,s){const i=el(this,e),a=el(this,n),o="_"+t;Object.defineProperties(i,{[o]:{value:i[t],writable:!0},[t]:{enumerable:!0,get(){const l=this[o],c=a[s];return De(l)?Object.assign({},c,l):Se(l,c)},set(l){this[o]=l}}})}apply(e){e.forEach(t=>t(this))}}var ct=new PI({_scriptable:r=>!r.startsWith("on"),_indexable:r=>r!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[wI,vI,SI]);function AI(r){return!r||Le(r.size)||Le(r.family)?null:(r.style?r.style+" ":"")+(r.weight?r.weight+" ":"")+r.size+"px "+r.family}function kd(r,e,t,n,s){let i=e[s];return i||(i=e[s]=r.measureText(s).width,t.push(s)),i>n&&(n=i),n}function EI(r,e,t,n){n=n||{};let s=n.data=n.data||{},i=n.garbageCollect=n.garbageCollect||[];n.font!==e&&(s=n.data={},i=n.garbageCollect=[],n.font=e),r.save(),r.font=e;let a=0;const o=t.length;let l,c,u,d,h;for(l=0;l<o;l++)if(d=t[l],d!=null&&!lt(d))a=kd(r,s,i,a,d);else if(lt(d))for(c=0,u=d.length;c<u;c++)h=d[c],h!=null&&!lt(h)&&(a=kd(r,s,i,a,h));r.restore();const f=i.length/2;if(f>t.length){for(l=0;l<f;l++)delete s[i[l]];i.splice(0,f)}return a}function Gs(r,e,t){const n=r.currentDevicePixelRatio,s=t!==0?Math.max(t/2,.5):0;return Math.round((e-s)*n)/n+s}function lw(r,e){!e&&!r||(e=e||r.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,r.width,r.height),e.restore())}function cg(r,e,t,n){ES(r,e,t,n,null)}function ES(r,e,t,n,s){let i,a,o,l,c,u,d,h;const f=e.pointStyle,p=e.rotation,m=e.radius;let g=(p||0)*oI;if(f&&typeof f=="object"&&(i=f.toString(),i==="[object HTMLImageElement]"||i==="[object HTMLCanvasElement]")){r.save(),r.translate(t,n),r.rotate(g),r.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),r.restore();return}if(!(isNaN(m)||m<=0)){switch(r.beginPath(),f){default:s?r.ellipse(t,n,s/2,m,0,0,st):r.arc(t,n,m,0,st),r.closePath();break;case"triangle":u=s?s/2:m,r.moveTo(t+Math.sin(g)*u,n-Math.cos(g)*m),g+=ew,r.lineTo(t+Math.sin(g)*u,n-Math.cos(g)*m),g+=ew,r.lineTo(t+Math.sin(g)*u,n-Math.cos(g)*m),r.closePath();break;case"rectRounded":c=m*.516,l=m-c,a=Math.cos(g+Vs)*l,d=Math.cos(g+Vs)*(s?s/2-c:l),o=Math.sin(g+Vs)*l,h=Math.sin(g+Vs)*(s?s/2-c:l),r.arc(t-d,n-o,c,g-it,g-wt),r.arc(t+h,n-a,c,g-wt,g),r.arc(t+d,n+o,c,g,g+wt),r.arc(t-h,n+a,c,g+wt,g+it),r.closePath();break;case"rect":if(!p){l=Math.SQRT1_2*m,u=s?s/2:l,r.rect(t-u,n-l,2*u,2*l);break}g+=Vs;case"rectRot":d=Math.cos(g)*(s?s/2:m),a=Math.cos(g)*m,o=Math.sin(g)*m,h=Math.sin(g)*(s?s/2:m),r.moveTo(t-d,n-o),r.lineTo(t+h,n-a),r.lineTo(t+d,n+o),r.lineTo(t-h,n+a),r.closePath();break;case"crossRot":g+=Vs;case"cross":d=Math.cos(g)*(s?s/2:m),a=Math.cos(g)*m,o=Math.sin(g)*m,h=Math.sin(g)*(s?s/2:m),r.moveTo(t-d,n-o),r.lineTo(t+d,n+o),r.moveTo(t+h,n-a),r.lineTo(t-h,n+a);break;case"star":d=Math.cos(g)*(s?s/2:m),a=Math.cos(g)*m,o=Math.sin(g)*m,h=Math.sin(g)*(s?s/2:m),r.moveTo(t-d,n-o),r.lineTo(t+d,n+o),r.moveTo(t+h,n-a),r.lineTo(t-h,n+a),g+=Vs,d=Math.cos(g)*(s?s/2:m),a=Math.cos(g)*m,o=Math.sin(g)*m,h=Math.sin(g)*(s?s/2:m),r.moveTo(t-d,n-o),r.lineTo(t+d,n+o),r.moveTo(t+h,n-a),r.lineTo(t-h,n+a);break;case"line":a=s?s/2:Math.cos(g)*m,o=Math.sin(g)*m,r.moveTo(t-a,n-o),r.lineTo(t+a,n+o);break;case"dash":r.moveTo(t,n),r.lineTo(t+Math.cos(g)*(s?s/2:m),n+Math.sin(g)*m);break;case!1:r.closePath();break}r.fill(),e.borderWidth>0&&r.stroke()}}function Yr(r,e,t){return t=t||.5,!e||r&&r.x>e.left-t&&r.x<e.right+t&&r.y>e.top-t&&r.y<e.bottom+t}function Ph(r,e){r.save(),r.beginPath(),r.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),r.clip()}function Ah(r){r.restore()}function OI(r,e,t,n,s){if(!e)return r.lineTo(t.x,t.y);if(s==="middle"){const i=(e.x+t.x)/2;r.lineTo(i,e.y),r.lineTo(i,t.y)}else s==="after"!=!!n?r.lineTo(e.x,t.y):r.lineTo(t.x,e.y);r.lineTo(t.x,t.y)}function TI(r,e,t,n){if(!e)return r.lineTo(t.x,t.y);r.bezierCurveTo(n?e.cp1x:e.cp2x,n?e.cp1y:e.cp2y,n?t.cp2x:t.cp1x,n?t.cp2y:t.cp1y,t.x,t.y)}function RI(r,e){e.translation&&r.translate(e.translation[0],e.translation[1]),Le(e.rotation)||r.rotate(e.rotation),e.color&&(r.fillStyle=e.color),e.textAlign&&(r.textAlign=e.textAlign),e.textBaseline&&(r.textBaseline=e.textBaseline)}function II(r,e,t,n,s){if(s.strikethrough||s.underline){const i=r.measureText(n),a=e-i.actualBoundingBoxLeft,o=e+i.actualBoundingBoxRight,l=t-i.actualBoundingBoxAscent,c=t+i.actualBoundingBoxDescent,u=s.strikethrough?(l+c)/2:c;r.strokeStyle=r.fillStyle,r.beginPath(),r.lineWidth=s.decorationWidth||2,r.moveTo(a,u),r.lineTo(o,u),r.stroke()}}function CI(r,e){const t=r.fillStyle;r.fillStyle=e.color,r.fillRect(e.left,e.top,e.width,e.height),r.fillStyle=t}function gi(r,e,t,n,s,i={}){const a=lt(e)?e:[e],o=i.strokeWidth>0&&i.strokeColor!=="";let l,c;for(r.save(),r.font=s.string,RI(r,i),l=0;l<a.length;++l)c=a[l],i.backdrop&&CI(r,i.backdrop),o&&(i.strokeColor&&(r.strokeStyle=i.strokeColor),Le(i.strokeWidth)||(r.lineWidth=i.strokeWidth),r.strokeText(c,t,n,i.maxWidth)),r.fillText(c,t,n,i.maxWidth),II(r,t,n,c,i),n+=Number(s.lineHeight);r.restore()}function yl(r,e){const{x:t,y:n,w:s,h:i,radius:a}=e;r.arc(t+a.topLeft,n+a.topLeft,a.topLeft,1.5*it,it,!0),r.lineTo(t,n+i-a.bottomLeft),r.arc(t+a.bottomLeft,n+i-a.bottomLeft,a.bottomLeft,it,wt,!0),r.lineTo(t+s-a.bottomRight,n+i),r.arc(t+s-a.bottomRight,n+i-a.bottomRight,a.bottomRight,wt,0,!0),r.lineTo(t+s,n+a.topRight),r.arc(t+s-a.topRight,n+a.topRight,a.topRight,0,-wt,!0),r.lineTo(t+a.topLeft,n)}const $I=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,MI=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function NI(r,e){const t=(""+r).match($I);if(!t||t[1]==="normal")return e*1.2;switch(r=+t[2],t[3]){case"px":return r;case"%":r/=100;break}return e*r}const LI=r=>+r||0;function Nb(r,e){const t={},n=De(e),s=n?Object.keys(e):e,i=De(r)?n?a=>Se(r[a],r[e[a]]):a=>r[a]:()=>r;for(const a of s)t[a]=LI(i(a));return t}function OS(r){return Nb(r,{top:"y",right:"x",bottom:"y",left:"x"})}function ci(r){return Nb(r,["topLeft","topRight","bottomLeft","bottomRight"])}function Xt(r){const e=OS(r);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function Ot(r,e){r=r||{},e=e||ct.font;let t=Se(r.size,e.size);typeof t=="string"&&(t=parseInt(t,10));let n=Se(r.style,e.style);n&&!(""+n).match(MI)&&(console.warn('Invalid font style specified: "'+n+'"'),n=void 0);const s={family:Se(r.family,e.family),lineHeight:NI(Se(r.lineHeight,e.lineHeight),t),size:t,style:n,weight:Se(r.weight,e.weight),string:""};return s.string=AI(s),s}function $o(r,e,t,n){let s,i,a;for(s=0,i=r.length;s<i;++s)if(a=r[s],a!==void 0&&a!==void 0)return a}function jI(r,e,t){const{min:n,max:s}=r,i=gS(e,(s-n)/2),a=(o,l)=>t&&o===0?0:o+l;return{min:a(n,-Math.abs(i)),max:a(s,i)}}function Fs(r,e){return Object.assign(Object.create(r),e)}function Lb(r,e=[""],t,n,s=()=>r[0]){const i=t||r;typeof n>"u"&&(n=CS("_fallback",r));const a={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:r,_rootScopes:i,_fallback:n,_getTarget:s,override:o=>Lb([o,...r],e,i,n)};return new Proxy(a,{deleteProperty(o,l){return delete o[l],delete o._keys,delete r[0][l],!0},get(o,l){return RS(o,l,()=>WI(l,e,r,o))},getOwnPropertyDescriptor(o,l){return Reflect.getOwnPropertyDescriptor(o._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(r[0])},has(o,l){return uw(o).includes(l)},ownKeys(o){return uw(o)},set(o,l,c){const u=o._storage||(o._storage=s());return o[l]=u[l]=c,delete o._keys,!0}})}function Ta(r,e,t,n){const s={_cacheable:!1,_proxy:r,_context:e,_subProxy:t,_stack:new Set,_descriptors:TS(r,n),setContext:i=>Ta(r,i,t,n),override:i=>Ta(r.override(i),e,t,n)};return new Proxy(s,{deleteProperty(i,a){return delete i[a],delete r[a],!0},get(i,a,o){return RS(i,a,()=>FI(i,a,o))},getOwnPropertyDescriptor(i,a){return i._descriptors.allKeys?Reflect.has(r,a)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(r,a)},getPrototypeOf(){return Reflect.getPrototypeOf(r)},has(i,a){return Reflect.has(r,a)},ownKeys(){return Reflect.ownKeys(r)},set(i,a,o){return r[a]=o,delete i[a],!0}})}function TS(r,e={scriptable:!0,indexable:!0}){const{_scriptable:t=e.scriptable,_indexable:n=e.indexable,_allKeys:s=e.allKeys}=r;return{allKeys:s,scriptable:t,indexable:n,isScriptable:Rs(t)?t:()=>t,isIndexable:Rs(n)?n:()=>n}}const DI=(r,e)=>r?r+Rb(e):e,jb=(r,e)=>De(e)&&r!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function RS(r,e,t){if(Object.prototype.hasOwnProperty.call(r,e)||e==="constructor")return r[e];const n=t();return r[e]=n,n}function FI(r,e,t){const{_proxy:n,_context:s,_subProxy:i,_descriptors:a}=r;let o=n[e];return Rs(o)&&a.isScriptable(e)&&(o=zI(e,o,r,t)),lt(o)&&o.length&&(o=BI(e,o,r,a.isIndexable)),jb(e,o)&&(o=Ta(o,s,i&&i[e],a)),o}function zI(r,e,t,n){const{_proxy:s,_context:i,_subProxy:a,_stack:o}=t;if(o.has(r))throw new Error("Recursion detected: "+Array.from(o).join("->")+"->"+r);o.add(r);let l=e(i,a||n);return o.delete(r),jb(r,l)&&(l=Db(s._scopes,s,r,l)),l}function BI(r,e,t,n){const{_proxy:s,_context:i,_subProxy:a,_descriptors:o}=t;if(typeof i.index<"u"&&n(r))return e[i.index%e.length];if(De(e[0])){const l=e,c=s._scopes.filter(u=>u!==l);e=[];for(const u of l){const d=Db(c,s,r,u);e.push(Ta(d,i,a&&a[r],o))}}return e}function IS(r,e,t){return Rs(r)?r(e,t):r}const UI=(r,e)=>r===!0?e:typeof r=="string"?Ts(e,r):void 0;function qI(r,e,t,n,s){for(const i of e){const a=UI(t,i);if(a){r.add(a);const o=IS(a._fallback,t,s);if(typeof o<"u"&&o!==t&&o!==n)return o}else if(a===!1&&typeof n<"u"&&t!==n)return null}return!1}function Db(r,e,t,n){const s=e._rootScopes,i=IS(e._fallback,t,n),a=[...r,...s],o=new Set;o.add(n);let l=cw(o,a,t,i||t,n);return l===null||typeof i<"u"&&i!==t&&(l=cw(o,a,i,l,n),l===null)?!1:Lb(Array.from(o),[""],s,i,()=>HI(e,t,n))}function cw(r,e,t,n,s){for(;t;)t=qI(r,e,t,n,s);return t}function HI(r,e,t){const n=r._getTarget();e in n||(n[e]={});const s=n[e];return lt(s)&&De(t)?t:s||{}}function WI(r,e,t,n){let s;for(const i of e)if(s=CS(DI(i,r),t),typeof s<"u")return jb(r,s)?Db(t,n,r,s):s}function CS(r,e){for(const t of e){if(!t)continue;const n=t[r];if(typeof n<"u")return n}}function uw(r){let e=r._keys;return e||(e=r._keys=VI(r._scopes)),e}function VI(r){const e=new Set;for(const t of r)for(const n of Object.keys(t).filter(s=>!s.startsWith("_")))e.add(n);return Array.from(e)}function $S(r,e,t,n){const{iScale:s}=r,{key:i="r"}=this._parsing,a=new Array(n);let o,l,c,u;for(o=0,l=n;o<l;++o)c=o+t,u=e[c],a[o]={r:s.parse(Ts(u,i),c)};return a}const GI=Number.EPSILON||1e-14,Ra=(r,e)=>e<r.length&&!r[e].skip&&r[e],MS=r=>r==="x"?"y":"x";function ZI(r,e,t,n){const s=r.skip?e:r,i=e,a=t.skip?e:t,o=og(i,s),l=og(a,i);let c=o/(o+l),u=l/(o+l);c=isNaN(c)?0:c,u=isNaN(u)?0:u;const d=n*c,h=n*u;return{previous:{x:i.x-d*(a.x-s.x),y:i.y-d*(a.y-s.y)},next:{x:i.x+h*(a.x-s.x),y:i.y+h*(a.y-s.y)}}}function JI(r,e,t){const n=r.length;let s,i,a,o,l,c=Ra(r,0);for(let u=0;u<n-1;++u)if(l=c,c=Ra(r,u+1),!(!l||!c)){if(Yo(e[u],0,GI)){t[u]=t[u+1]=0;continue}s=t[u]/e[u],i=t[u+1]/e[u],o=Math.pow(s,2)+Math.pow(i,2),!(o<=9)&&(a=3/Math.sqrt(o),t[u]=s*a*e[u],t[u+1]=i*a*e[u])}}function KI(r,e,t="x"){const n=MS(t),s=r.length;let i,a,o,l=Ra(r,0);for(let c=0;c<s;++c){if(a=o,o=l,l=Ra(r,c+1),!o)continue;const u=o[t],d=o[n];a&&(i=(u-a[t])/3,o[`cp1${t}`]=u-i,o[`cp1${n}`]=d-i*e[c]),l&&(i=(l[t]-u)/3,o[`cp2${t}`]=u+i,o[`cp2${n}`]=d+i*e[c])}}function XI(r,e="x"){const t=MS(e),n=r.length,s=Array(n).fill(0),i=Array(n);let a,o,l,c=Ra(r,0);for(a=0;a<n;++a)if(o=l,l=c,c=Ra(r,a+1),!!l){if(c){const u=c[e]-l[e];s[a]=u!==0?(c[t]-l[t])/u:0}i[a]=o?c?Pr(s[a-1])!==Pr(s[a])?0:(s[a-1]+s[a])/2:s[a-1]:s[a]}JI(r,s,i),KI(r,i,e)}function eu(r,e,t){return Math.max(Math.min(r,t),e)}function YI(r,e){let t,n,s,i,a,o=Yr(r[0],e);for(t=0,n=r.length;t<n;++t)a=i,i=o,o=t<n-1&&Yr(r[t+1],e),i&&(s=r[t],a&&(s.cp1x=eu(s.cp1x,e.left,e.right),s.cp1y=eu(s.cp1y,e.top,e.bottom)),o&&(s.cp2x=eu(s.cp2x,e.left,e.right),s.cp2y=eu(s.cp2y,e.top,e.bottom)))}function QI(r,e,t,n,s){let i,a,o,l;if(e.spanGaps&&(r=r.filter(c=>!c.skip)),e.cubicInterpolationMode==="monotone")XI(r,s);else{let c=n?r[r.length-1]:r[0];for(i=0,a=r.length;i<a;++i)o=r[i],l=ZI(c,o,r[Math.min(i+1,a-(n?0:1))%a],e.tension),o.cp1x=l.previous.x,o.cp1y=l.previous.y,o.cp2x=l.next.x,o.cp2y=l.next.y,c=o}e.capBezierPoints&&YI(r,t)}function Fb(){return typeof window<"u"&&typeof document<"u"}function zb(r){let e=r.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function Sd(r,e,t){let n;return typeof r=="string"?(n=parseInt(r,10),r.indexOf("%")!==-1&&(n=n/100*e.parentNode[t])):n=r,n}const Eh=r=>r.ownerDocument.defaultView.getComputedStyle(r,null);function eC(r,e){return Eh(r).getPropertyValue(e)}const tC=["top","right","bottom","left"];function ui(r,e,t){const n={};t=t?"-"+t:"";for(let s=0;s<4;s++){const i=tC[s];n[i]=parseFloat(r[e+"-"+i+t])||0}return n.width=n.left+n.right,n.height=n.top+n.bottom,n}const nC=(r,e,t)=>(r>0||e>0)&&(!t||!t.shadowRoot);function rC(r,e){const t=r.touches,n=t&&t.length?t[0]:r,{offsetX:s,offsetY:i}=n;let a=!1,o,l;if(nC(s,i,r.target))o=s,l=i;else{const c=e.getBoundingClientRect();o=n.clientX-c.left,l=n.clientY-c.top,a=!0}return{x:o,y:l,box:a}}function Qs(r,e){if("native"in r)return r;const{canvas:t,currentDevicePixelRatio:n}=e,s=Eh(t),i=s.boxSizing==="border-box",a=ui(s,"padding"),o=ui(s,"border","width"),{x:l,y:c,box:u}=rC(r,t),d=a.left+(u&&o.left),h=a.top+(u&&o.top);let{width:f,height:p}=e;return i&&(f-=a.width+o.width,p-=a.height+o.height),{x:Math.round((l-d)/f*t.width/n),y:Math.round((c-h)/p*t.height/n)}}function sC(r,e,t){let n,s;if(e===void 0||t===void 0){const i=r&&zb(r);if(!i)e=r.clientWidth,t=r.clientHeight;else{const a=i.getBoundingClientRect(),o=Eh(i),l=ui(o,"border","width"),c=ui(o,"padding");e=a.width-c.width-l.width,t=a.height-c.height-l.height,n=Sd(o.maxWidth,i,"clientWidth"),s=Sd(o.maxHeight,i,"clientHeight")}}return{width:e,height:t,maxWidth:n||xd,maxHeight:s||xd}}const tu=r=>Math.round(r*10)/10;function iC(r,e,t,n){const s=Eh(r),i=ui(s,"margin"),a=Sd(s.maxWidth,r,"clientWidth")||xd,o=Sd(s.maxHeight,r,"clientHeight")||xd,l=sC(r,e,t);let{width:c,height:u}=l;if(s.boxSizing==="content-box"){const h=ui(s,"border","width"),f=ui(s,"padding");c-=f.width+h.width,u-=f.height+h.height}return c=Math.max(0,c-i.width),u=Math.max(0,n?c/n:u-i.height),c=tu(Math.min(c,a,l.maxWidth)),u=tu(Math.min(u,o,l.maxHeight)),c&&!u&&(u=tu(c/2)),(e!==void 0||t!==void 0)&&n&&l.height&&u>l.height&&(u=l.height,c=tu(Math.floor(u*n))),{width:c,height:u}}function dw(r,e,t){const n=e||1,s=Math.floor(r.height*n),i=Math.floor(r.width*n);r.height=Math.floor(r.height),r.width=Math.floor(r.width);const a=r.canvas;return a.style&&(t||!a.style.height&&!a.style.width)&&(a.style.height=`${r.height}px`,a.style.width=`${r.width}px`),r.currentDevicePixelRatio!==n||a.height!==s||a.width!==i?(r.currentDevicePixelRatio=n,a.height=s,a.width=i,r.ctx.setTransform(n,0,0,n,0,0),!0):!1}const aC=function(){let r=!1;try{const e={get passive(){return r=!0,!1}};Fb()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch{}return r}();function hw(r,e){const t=eC(r,e),n=t&&t.match(/^(\d+)(\.\d+)?px$/);return n?+n[1]:void 0}function ei(r,e,t,n){return{x:r.x+t*(e.x-r.x),y:r.y+t*(e.y-r.y)}}function oC(r,e,t,n){return{x:r.x+t*(e.x-r.x),y:n==="middle"?t<.5?r.y:e.y:n==="after"?t<1?r.y:e.y:t>0?e.y:r.y}}function lC(r,e,t,n){const s={x:r.cp2x,y:r.cp2y},i={x:e.cp1x,y:e.cp1y},a=ei(r,s,t),o=ei(s,i,t),l=ei(i,e,t),c=ei(a,o,t),u=ei(o,l,t);return ei(c,u,t)}const cC=function(r,e){return{x(t){return r+r+e-t},setWidth(t){e=t},textAlign(t){return t==="center"?t:t==="right"?"left":"right"},xPlus(t,n){return t-n},leftForLtr(t,n){return t-n}}},uC=function(){return{x(r){return r},setWidth(r){},textAlign(r){return r},xPlus(r,e){return r+e},leftForLtr(r,e){return r}}};function ca(r,e,t){return r?cC(e,t):uC()}function NS(r,e){let t,n;(e==="ltr"||e==="rtl")&&(t=r.canvas.style,n=[t.getPropertyValue("direction"),t.getPropertyPriority("direction")],t.setProperty("direction",e,"important"),r.prevTextDirection=n)}function LS(r,e){e!==void 0&&(delete r.prevTextDirection,r.canvas.style.setProperty("direction",e[0],e[1]))}function jS(r){return r==="angle"?{between:_l,compare:dI,normalize:Tn}:{between:Kr,compare:(e,t)=>e-t,normalize:e=>e}}function fw({start:r,end:e,count:t,loop:n,style:s}){return{start:r%t,end:e%t,loop:n&&(e-r+1)%t===0,style:s}}function dC(r,e,t){const{property:n,start:s,end:i}=t,{between:a,normalize:o}=jS(n),l=e.length;let{start:c,end:u,loop:d}=r,h,f;if(d){for(c+=l,u+=l,h=0,f=l;h<f&&a(o(e[c%l][n]),s,i);++h)c--,u--;c%=l,u%=l}return u<c&&(u+=l),{start:c,end:u,loop:d,style:r.style}}function DS(r,e,t){if(!t)return[r];const{property:n,start:s,end:i}=t,a=e.length,{compare:o,between:l,normalize:c}=jS(n),{start:u,end:d,loop:h,style:f}=dC(r,e,t),p=[];let m=!1,g=null,b,_,y;const w=()=>l(s,y,b)&&o(s,y)!==0,v=()=>o(i,b)===0||l(i,y,b),x=()=>m||w(),k=()=>!m||v();for(let S=u,R=u;S<=d;++S)_=e[S%a],!_.skip&&(b=c(_[n]),b!==y&&(m=l(b,s,i),g===null&&x()&&(g=o(b,s)===0?S:R),g!==null&&k()&&(p.push(fw({start:g,end:S,loop:h,count:a,style:f})),g=null),R=S,y=b));return g!==null&&p.push(fw({start:g,end:d,loop:h,count:a,style:f})),p}function FS(r,e){const t=[],n=r.segments;for(let s=0;s<n.length;s++){const i=DS(n[s],r.points,e);i.length&&t.push(...i)}return t}function hC(r,e,t,n){let s=0,i=e-1;if(t&&!n)for(;s<e&&!r[s].skip;)s++;for(;s<e&&r[s].skip;)s++;for(s%=e,t&&(i+=s);i>s&&r[i%e].skip;)i--;return i%=e,{start:s,end:i}}function fC(r,e,t,n){const s=r.length,i=[];let a=e,o=r[e],l;for(l=e+1;l<=t;++l){const c=r[l%s];c.skip||c.stop?o.skip||(n=!1,i.push({start:e%s,end:(l-1)%s,loop:n}),e=a=c.stop?l:null):(a=l,o.skip&&(e=l)),o=c}return a!==null&&i.push({start:e%s,end:a%s,loop:n}),i}function pC(r,e){const t=r.points,n=r.options.spanGaps,s=t.length;if(!s)return[];const i=!!r._loop,{start:a,end:o}=hC(t,s,i,n);if(n===!0)return pw(r,[{start:a,end:o,loop:i}],t,e);const l=o<a?o+s:o,c=!!r._fullLoop&&a===0&&o===s-1;return pw(r,fC(t,a,l,c),t,e)}function pw(r,e,t,n){return!n||!n.setContext||!t?e:mC(r,e,t,n)}function mC(r,e,t,n){const s=r._chart.getContext(),i=mw(r.options),{_datasetIndex:a,options:{spanGaps:o}}=r,l=t.length,c=[];let u=i,d=e[0].start,h=d;function f(p,m,g,b){const _=o?-1:1;if(p!==m){for(p+=l;t[p%l].skip;)p-=_;for(;t[m%l].skip;)m+=_;p%l!==m%l&&(c.push({start:p%l,end:m%l,loop:g,style:b}),u=b,d=m%l)}}for(const p of e){d=o?d:p.start;let m=t[d%l],g;for(h=d+1;h<=p.end;h++){const b=t[h%l];g=mw(n.setContext(Fs(s,{type:"segment",p0:m,p1:b,p0DataIndex:(h-1)%l,p1DataIndex:h%l,datasetIndex:a}))),gC(g,u)&&f(d,h-1,p.loop,u),m=b,u=g}d<h-1&&f(d,h-1,p.loop,u)}return c}function mw(r){return{backgroundColor:r.backgroundColor,borderCapStyle:r.borderCapStyle,borderDash:r.borderDash,borderDashOffset:r.borderDashOffset,borderJoinStyle:r.borderJoinStyle,borderWidth:r.borderWidth,borderColor:r.borderColor}}function gC(r,e){if(!e)return!1;const t=[],n=function(s,i){return Mb(i)?(t.includes(i)||t.push(i),t.indexOf(i)):i};return JSON.stringify(r,n)!==JSON.stringify(e,n)}function nu(r,e,t){return r.options.clip?r[t]:e[t]}function bC(r,e){const{xScale:t,yScale:n}=r;return t&&n?{left:nu(t,e,"left"),right:nu(t,e,"right"),top:nu(n,e,"top"),bottom:nu(n,e,"bottom")}:e}function zS(r,e){const t=e._clip;if(t.disabled)return!1;const n=bC(e,r.chartArea);return{left:t.left===!1?0:n.left-(t.left===!0?0:t.left),right:t.right===!1?r.width:n.right+(t.right===!0?0:t.right),top:t.top===!1?0:n.top-(t.top===!0?0:t.top),bottom:t.bottom===!1?r.height:n.bottom+(t.bottom===!0?0:t.bottom)}}/*!
 * Chart.js v4.4.9
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class _C{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,n,s){const i=t.listeners[s],a=t.duration;i.forEach(o=>o({chart:e,initial:t.initial,numSteps:a,currentStep:Math.min(n-t.start,a)}))}_refresh(){this._request||(this._running=!0,this._request=xS.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let t=0;this._charts.forEach((n,s)=>{if(!n.running||!n.items.length)return;const i=n.items;let a=i.length-1,o=!1,l;for(;a>=0;--a)l=i[a],l._active?(l._total>n.duration&&(n.duration=l._total),l.tick(e),o=!0):(i[a]=i[i.length-1],i.pop());o&&(s.draw(),this._notify(s,n,e,"progress")),i.length||(n.running=!1,this._notify(s,n,e,"complete"),n.initial=!1),t+=i.length}),this._lastDate=e,t===0&&(this._running=!1)}_getAnims(e){const t=this._charts;let n=t.get(e);return n||(n={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,n)),n}listen(e,t,n){this._getAnims(e).listeners[t].push(n)}add(e,t){!t||!t.length||this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){const t=this._charts.get(e);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce((n,s)=>Math.max(n,s._duration),0),this._refresh())}running(e){if(!this._running)return!1;const t=this._charts.get(e);return!(!t||!t.running||!t.items.length)}stop(e){const t=this._charts.get(e);if(!t||!t.items.length)return;const n=t.items;let s=n.length-1;for(;s>=0;--s)n[s].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var Dr=new _C;const gw="transparent",yC={boolean(r,e,t){return t>.5?e:r},color(r,e,t){const n=aw(r||gw),s=n.valid&&aw(e||gw);return s&&s.valid?s.mix(n,t).hexString():e},number(r,e,t){return r+(e-r)*t}};class wC{constructor(e,t,n,s){const i=t[n];s=$o([e.to,s,i,e.from]);const a=$o([e.from,i,s]);this._active=!0,this._fn=e.fn||yC[e.type||typeof a],this._easing=Qo[e.easing]||Qo.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=n,this._from=a,this._to=s,this._promises=void 0}active(){return this._active}update(e,t,n){if(this._active){this._notify(!1);const s=this._target[this._prop],i=n-this._start,a=this._duration-i;this._start=n,this._duration=Math.floor(Math.max(a,e.duration)),this._total+=i,this._loop=!!e.loop,this._to=$o([e.to,t,s,e.from]),this._from=$o([e.from,s,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const t=e-this._start,n=this._duration,s=this._prop,i=this._from,a=this._loop,o=this._to;let l;if(this._active=i!==o&&(a||t<n),!this._active){this._target[s]=o,this._notify(!0);return}if(t<0){this._target[s]=i;return}l=t/n%2,l=a&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[s]=this._fn(i,o,l)}wait(){const e=this._promises||(this._promises=[]);return new Promise((t,n)=>{e.push({res:t,rej:n})})}_notify(e){const t=e?"res":"rej",n=this._promises||[];for(let s=0;s<n.length;s++)n[s][t]()}}class BS{constructor(e,t){this._chart=e,this._properties=new Map,this.configure(t)}configure(e){if(!De(e))return;const t=Object.keys(ct.animation),n=this._properties;Object.getOwnPropertyNames(e).forEach(s=>{const i=e[s];if(!De(i))return;const a={};for(const o of t)a[o]=i[o];(lt(i.properties)&&i.properties||[s]).forEach(o=>{(o===s||!n.has(o))&&n.set(o,a)})})}_animateOptions(e,t){const n=t.options,s=xC(e,n);if(!s)return[];const i=this._createAnimations(s,n);return n.$shared&&vC(e.options.$animations,n).then(()=>{e.options=n},()=>{}),i}_createAnimations(e,t){const n=this._properties,s=[],i=e.$animations||(e.$animations={}),a=Object.keys(t),o=Date.now();let l;for(l=a.length-1;l>=0;--l){const c=a[l];if(c.charAt(0)==="$")continue;if(c==="options"){s.push(...this._animateOptions(e,t));continue}const u=t[c];let d=i[c];const h=n.get(c);if(d)if(h&&d.active()){d.update(h,u,o);continue}else d.cancel();if(!h||!h.duration){e[c]=u;continue}i[c]=d=new wC(h,e,c,u),s.push(d)}return s}update(e,t){if(this._properties.size===0){Object.assign(e,t);return}const n=this._createAnimations(e,t);if(n.length)return Dr.add(this._chart,n),!0}}function vC(r,e){const t=[],n=Object.keys(e);for(let s=0;s<n.length;s++){const i=r[n[s]];i&&i.active()&&t.push(i.wait())}return Promise.all(t)}function xC(r,e){if(!e)return;let t=r.options;if(!t){r.options=e;return}return t.$shared&&(r.options=t=Object.assign({},t,{$shared:!1,$animations:{}})),t}function bw(r,e){const t=r&&r.options||{},n=t.reverse,s=t.min===void 0?e:0,i=t.max===void 0?e:0;return{start:n?i:s,end:n?s:i}}function kC(r,e,t){if(t===!1)return!1;const n=bw(r,t),s=bw(e,t);return{top:s.end,right:n.end,bottom:s.start,left:n.start}}function SC(r){let e,t,n,s;return De(r)?(e=r.top,t=r.right,n=r.bottom,s=r.left):e=t=n=s=r,{top:e,right:t,bottom:n,left:s,disabled:r===!1}}function US(r,e){const t=[],n=r._getSortedDatasetMetas(e);let s,i;for(s=0,i=n.length;s<i;++s)t.push(n[s].index);return t}function _w(r,e,t,n={}){const s=r.keys,i=n.mode==="single";let a,o,l,c;if(e===null)return;let u=!1;for(a=0,o=s.length;a<o;++a){if(l=+s[a],l===t){if(u=!0,n.all)continue;break}c=r.values[l],gt(c)&&(i||e===0||Pr(e)===Pr(c))&&(e+=c)}return!u&&!n.all?0:e}function PC(r,e){const{iScale:t,vScale:n}=e,s=t.axis==="x"?"x":"y",i=n.axis==="x"?"x":"y",a=Object.keys(r),o=new Array(a.length);let l,c,u;for(l=0,c=a.length;l<c;++l)u=a[l],o[l]={[s]:u,[i]:r[u]};return o}function Ff(r,e){const t=r&&r.options.stacked;return t||t===void 0&&e.stack!==void 0}function AC(r,e,t){return`${r.id}.${e.id}.${t.stack||t.type}`}function EC(r){const{min:e,max:t,minDefined:n,maxDefined:s}=r.getUserBounds();return{min:n?e:Number.NEGATIVE_INFINITY,max:s?t:Number.POSITIVE_INFINITY}}function OC(r,e,t){const n=r[e]||(r[e]={});return n[t]||(n[t]={})}function yw(r,e,t,n){for(const s of e.getMatchingVisibleMetas(n).reverse()){const i=r[s.index];if(t&&i>0||!t&&i<0)return s.index}return null}function ww(r,e){const{chart:t,_cachedMeta:n}=r,s=t._stacks||(t._stacks={}),{iScale:i,vScale:a,index:o}=n,l=i.axis,c=a.axis,u=AC(i,a,n),d=e.length;let h;for(let f=0;f<d;++f){const p=e[f],{[l]:m,[c]:g}=p,b=p._stacks||(p._stacks={});h=b[c]=OC(s,u,m),h[o]=g,h._top=yw(h,a,!0,n.type),h._bottom=yw(h,a,!1,n.type);const _=h._visualValues||(h._visualValues={});_[o]=g}}function zf(r,e){const t=r.scales;return Object.keys(t).filter(n=>t[n].axis===e).shift()}function TC(r,e){return Fs(r,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function RC(r,e,t){return Fs(r,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:t,index:e,mode:"default",type:"data"})}function io(r,e){const t=r.controller.index,n=r.vScale&&r.vScale.axis;if(n){e=e||r._parsed;for(const s of e){const i=s._stacks;if(!i||i[n]===void 0||i[n][t]===void 0)return;delete i[n][t],i[n]._visualValues!==void 0&&i[n]._visualValues[t]!==void 0&&delete i[n]._visualValues[t]}}}const Bf=r=>r==="reset"||r==="none",vw=(r,e)=>e?r:Object.assign({},r),IC=(r,e,t)=>r&&!e.hidden&&e._stacked&&{keys:US(t,!0),values:null};class nr{constructor(e,t){this.chart=e,this._ctx=e.ctx,this.index=t,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=Ff(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&io(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,t=this._cachedMeta,n=this.getDataset(),s=(d,h,f,p)=>d==="x"?h:d==="r"?p:f,i=t.xAxisID=Se(n.xAxisID,zf(e,"x")),a=t.yAxisID=Se(n.yAxisID,zf(e,"y")),o=t.rAxisID=Se(n.rAxisID,zf(e,"r")),l=t.indexAxis,c=t.iAxisID=s(l,i,a,o),u=t.vAxisID=s(l,a,i,o);t.xScale=this.getScaleForId(i),t.yScale=this.getScaleForId(a),t.rScale=this.getScaleForId(o),t.iScale=this.getScaleForId(c),t.vScale=this.getScaleForId(u)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const t=this._cachedMeta;return e===t.iScale?t.vScale:t.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&rw(this._data,this),e._stacked&&io(e)}_dataCheck(){const e=this.getDataset(),t=e.data||(e.data=[]),n=this._data;if(De(t)){const s=this._cachedMeta;this._data=PC(t,s)}else if(n!==t){if(n){rw(n,this);const s=this._cachedMeta;io(s),s._parsed=[]}t&&Object.isExtensible(t)&&mI(t,this),this._syncList=[],this._data=t}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const t=this._cachedMeta,n=this.getDataset();let s=!1;this._dataCheck();const i=t._stacked;t._stacked=Ff(t.vScale,t),t.stack!==n.stack&&(s=!0,io(t),t.stack=n.stack),this._resyncElements(e),(s||i!==t._stacked)&&(ww(this,t._parsed),t._stacked=Ff(t.vScale,t))}configure(){const e=this.chart.config,t=e.datasetScopeKeys(this._type),n=e.getOptionScopes(this.getDataset(),t,!0);this.options=e.createResolver(n,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,t){const{_cachedMeta:n,_data:s}=this,{iScale:i,_stacked:a}=n,o=i.axis;let l=e===0&&t===s.length?!0:n._sorted,c=e>0&&n._parsed[e-1],u,d,h;if(this._parsing===!1)n._parsed=s,n._sorted=!0,h=s;else{lt(s[e])?h=this.parseArrayData(n,s,e,t):De(s[e])?h=this.parseObjectData(n,s,e,t):h=this.parsePrimitiveData(n,s,e,t);const f=()=>d[o]===null||c&&d[o]<c[o];for(u=0;u<t;++u)n._parsed[u+e]=d=h[u],l&&(f()&&(l=!1),c=d);n._sorted=l}a&&ww(this,h)}parsePrimitiveData(e,t,n,s){const{iScale:i,vScale:a}=e,o=i.axis,l=a.axis,c=i.getLabels(),u=i===a,d=new Array(s);let h,f,p;for(h=0,f=s;h<f;++h)p=h+n,d[h]={[o]:u||i.parse(c[p],p),[l]:a.parse(t[p],p)};return d}parseArrayData(e,t,n,s){const{xScale:i,yScale:a}=e,o=new Array(s);let l,c,u,d;for(l=0,c=s;l<c;++l)u=l+n,d=t[u],o[l]={x:i.parse(d[0],u),y:a.parse(d[1],u)};return o}parseObjectData(e,t,n,s){const{xScale:i,yScale:a}=e,{xAxisKey:o="x",yAxisKey:l="y"}=this._parsing,c=new Array(s);let u,d,h,f;for(u=0,d=s;u<d;++u)h=u+n,f=t[h],c[u]={x:i.parse(Ts(f,o),h),y:a.parse(Ts(f,l),h)};return c}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,t,n){const s=this.chart,i=this._cachedMeta,a=t[e.axis],o={keys:US(s,!0),values:t._stacks[e.axis]._visualValues};return _w(o,a,i.index,{mode:n})}updateRangeFromParsed(e,t,n,s){const i=n[t.axis];let a=i===null?NaN:i;const o=s&&n._stacks[t.axis];s&&o&&(s.values=o,a=_w(s,i,this._cachedMeta.index)),e.min=Math.min(e.min,a),e.max=Math.max(e.max,a)}getMinMax(e,t){const n=this._cachedMeta,s=n._parsed,i=n._sorted&&e===n.iScale,a=s.length,o=this._getOtherScale(e),l=IC(t,n,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:u,max:d}=EC(o);let h,f;function p(){f=s[h];const m=f[o.axis];return!gt(f[e.axis])||u>m||d<m}for(h=0;h<a&&!(!p()&&(this.updateRangeFromParsed(c,e,f,l),i));++h);if(i){for(h=a-1;h>=0;--h)if(!p()){this.updateRangeFromParsed(c,e,f,l);break}}return c}getAllParsedValues(e){const t=this._cachedMeta._parsed,n=[];let s,i,a;for(s=0,i=t.length;s<i;++s)a=t[s][e.axis],gt(a)&&n.push(a);return n}getMaxOverflow(){return!1}getLabelAndValue(e){const t=this._cachedMeta,n=t.iScale,s=t.vScale,i=this.getParsed(e);return{label:n?""+n.getLabelForValue(i[n.axis]):"",value:s?""+s.getLabelForValue(i[s.axis]):""}}_update(e){const t=this._cachedMeta;this.update(e||"default"),t._clip=SC(Se(this.options.clip,kC(t.xScale,t.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,t=this.chart,n=this._cachedMeta,s=n.data||[],i=t.chartArea,a=[],o=this._drawStart||0,l=this._drawCount||s.length-o,c=this.options.drawActiveElementsOnTop;let u;for(n.dataset&&n.dataset.draw(e,i,o,l),u=o;u<o+l;++u){const d=s[u];d.hidden||(d.active&&c?a.push(d):d.draw(e,i))}for(u=0;u<a.length;++u)a[u].draw(e,i)}getStyle(e,t){const n=t?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(n):this.resolveDataElementOptions(e||0,n)}getContext(e,t,n){const s=this.getDataset();let i;if(e>=0&&e<this._cachedMeta.data.length){const a=this._cachedMeta.data[e];i=a.$context||(a.$context=RC(this.getContext(),e,a)),i.parsed=this.getParsed(e),i.raw=s.data[e],i.index=i.dataIndex=e}else i=this.$context||(this.$context=TC(this.chart.getContext(),this.index)),i.dataset=s,i.index=i.datasetIndex=this.index;return i.active=!!t,i.mode=n,i}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,t){return this._resolveElementOptions(this.dataElementType.id,t,e)}_resolveElementOptions(e,t="default",n){const s=t==="active",i=this._cachedDataOpts,a=e+"-"+t,o=i[a],l=this.enableOptionSharing&&bl(n);if(o)return vw(o,l);const c=this.chart.config,u=c.datasetElementScopeKeys(this._type,e),d=s?[`${e}Hover`,"hover",e,""]:[e,""],h=c.getOptionScopes(this.getDataset(),u),f=Object.keys(ct.elements[e]),p=()=>this.getContext(n,s,t),m=c.resolveNamedOptions(h,f,p,d);return m.$shared&&(m.$shared=l,i[a]=Object.freeze(vw(m,l))),m}_resolveAnimations(e,t,n){const s=this.chart,i=this._cachedDataOpts,a=`animation-${t}`,o=i[a];if(o)return o;let l;if(s.options.animation!==!1){const u=this.chart.config,d=u.datasetAnimationScopeKeys(this._type,t),h=u.getOptionScopes(this.getDataset(),d);l=u.createResolver(h,this.getContext(e,n,t))}const c=new BS(s,l&&l.animations);return l&&l._cacheable&&(i[a]=Object.freeze(c)),c}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,t){return!t||Bf(e)||this.chart._animationsDisabled}_getSharedOptions(e,t){const n=this.resolveDataElementOptions(e,t),s=this._sharedOptions,i=this.getSharedOptions(n),a=this.includeOptions(t,i)||i!==s;return this.updateSharedOptions(i,t,n),{sharedOptions:i,includeOptions:a}}updateElement(e,t,n,s){Bf(s)?Object.assign(e,n):this._resolveAnimations(t,s).update(e,n)}updateSharedOptions(e,t,n){e&&!Bf(t)&&this._resolveAnimations(void 0,t).update(e,n)}_setStyle(e,t,n,s){e.active=s;const i=this.getStyle(t,s);this._resolveAnimations(t,n,s).update(e,{options:!s&&this.getSharedOptions(i)||i})}removeHoverStyle(e,t,n){this._setStyle(e,n,"active",!1)}setHoverStyle(e,t,n){this._setStyle(e,n,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const t=this._data,n=this._cachedMeta.data;for(const[o,l,c]of this._syncList)this[o](l,c);this._syncList=[];const s=n.length,i=t.length,a=Math.min(i,s);a&&this.parse(0,a),i>s?this._insertElements(s,i-s,e):i<s&&this._removeElements(i,s-i)}_insertElements(e,t,n=!0){const s=this._cachedMeta,i=s.data,a=e+t;let o;const l=c=>{for(c.length+=t,o=c.length-1;o>=a;o--)c[o]=c[o-t]};for(l(i),o=e;o<a;++o)i[o]=new this.dataElementType;this._parsing&&l(s._parsed),this.parse(e,t),n&&this.updateElements(i,e,t,"reset")}updateElements(e,t,n,s){}_removeElements(e,t){const n=this._cachedMeta;if(this._parsing){const s=n._parsed.splice(e,t);n._stacked&&io(n,s)}n.data.splice(e,t)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[t,n,s]=e;this[t](n,s)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,t){t&&this._sync(["_removeElements",e,t]);const n=arguments.length-2;n&&this._sync(["_insertElements",e,n])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}$(nr,"defaults",{}),$(nr,"datasetElementType",null),$(nr,"dataElementType",null);function CC(r,e){if(!r._cache.$bar){const t=r.getMatchingVisibleMetas(e);let n=[];for(let s=0,i=t.length;s<i;s++)n=n.concat(t[s].controller.getAllParsedValues(r));r._cache.$bar=vS(n.sort((s,i)=>s-i))}return r._cache.$bar}function $C(r){const e=r.iScale,t=CC(e,r.type);let n=e._length,s,i,a,o;const l=()=>{a===32767||a===-32768||(bl(o)&&(n=Math.min(n,Math.abs(a-o)||n)),o=a)};for(s=0,i=t.length;s<i;++s)a=e.getPixelForValue(t[s]),l();for(o=void 0,s=0,i=e.ticks.length;s<i;++s)a=e.getPixelForTick(s),l();return n}function MC(r,e,t,n){const s=t.barThickness;let i,a;return Le(s)?(i=e.min*t.categoryPercentage,a=t.barPercentage):(i=s*n,a=1),{chunk:i/n,ratio:a,start:e.pixels[r]-i/2}}function NC(r,e,t,n){const s=e.pixels,i=s[r];let a=r>0?s[r-1]:null,o=r<s.length-1?s[r+1]:null;const l=t.categoryPercentage;a===null&&(a=i-(o===null?e.end-e.start:o-i)),o===null&&(o=i+i-a);const c=i-(i-Math.min(a,o))/2*l;return{chunk:Math.abs(o-a)/2*l/n,ratio:t.barPercentage,start:c}}function LC(r,e,t,n){const s=t.parse(r[0],n),i=t.parse(r[1],n),a=Math.min(s,i),o=Math.max(s,i);let l=a,c=o;Math.abs(a)>Math.abs(o)&&(l=o,c=a),e[t.axis]=c,e._custom={barStart:l,barEnd:c,start:s,end:i,min:a,max:o}}function qS(r,e,t,n){return lt(r)?LC(r,e,t,n):e[t.axis]=t.parse(r,n),e}function xw(r,e,t,n){const s=r.iScale,i=r.vScale,a=s.getLabels(),o=s===i,l=[];let c,u,d,h;for(c=t,u=t+n;c<u;++c)h=e[c],d={},d[s.axis]=o||s.parse(a[c],c),l.push(qS(h,d,i,c));return l}function Uf(r){return r&&r.barStart!==void 0&&r.barEnd!==void 0}function jC(r,e,t){return r!==0?Pr(r):(e.isHorizontal()?1:-1)*(e.min>=t?1:-1)}function DC(r){let e,t,n,s,i;return r.horizontal?(e=r.base>r.x,t="left",n="right"):(e=r.base<r.y,t="bottom",n="top"),e?(s="end",i="start"):(s="start",i="end"),{start:t,end:n,reverse:e,top:s,bottom:i}}function FC(r,e,t,n){let s=e.borderSkipped;const i={};if(!s){r.borderSkipped=i;return}if(s===!0){r.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:a,end:o,reverse:l,top:c,bottom:u}=DC(r);s==="middle"&&t&&(r.enableBorderRadius=!0,(t._top||0)===n?s=c:(t._bottom||0)===n?s=u:(i[kw(u,a,o,l)]=!0,s=c)),i[kw(s,a,o,l)]=!0,r.borderSkipped=i}function kw(r,e,t,n){return n?(r=zC(r,e,t),r=Sw(r,t,e)):r=Sw(r,e,t),r}function zC(r,e,t){return r===e?t:r===t?e:r}function Sw(r,e,t){return r==="start"?e:r==="end"?t:r}function BC(r,{inflateAmount:e},t){r.inflateAmount=e==="auto"?t===1?.33:0:e}class ed extends nr{parsePrimitiveData(e,t,n,s){return xw(e,t,n,s)}parseArrayData(e,t,n,s){return xw(e,t,n,s)}parseObjectData(e,t,n,s){const{iScale:i,vScale:a}=e,{xAxisKey:o="x",yAxisKey:l="y"}=this._parsing,c=i.axis==="x"?o:l,u=a.axis==="x"?o:l,d=[];let h,f,p,m;for(h=n,f=n+s;h<f;++h)m=t[h],p={},p[i.axis]=i.parse(Ts(m,c),h),d.push(qS(Ts(m,u),p,a,h));return d}updateRangeFromParsed(e,t,n,s){super.updateRangeFromParsed(e,t,n,s);const i=n._custom;i&&t===this._cachedMeta.vScale&&(e.min=Math.min(e.min,i.min),e.max=Math.max(e.max,i.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const t=this._cachedMeta,{iScale:n,vScale:s}=t,i=this.getParsed(e),a=i._custom,o=Uf(a)?"["+a.start+", "+a.end+"]":""+s.getLabelForValue(i[s.axis]);return{label:""+n.getLabelForValue(i[n.axis]),value:o}}initialize(){this.enableOptionSharing=!0,super.initialize();const e=this._cachedMeta;e.stack=this.getDataset().stack}update(e){const t=this._cachedMeta;this.updateElements(t.data,0,t.data.length,e)}updateElements(e,t,n,s){const i=s==="reset",{index:a,_cachedMeta:{vScale:o}}=this,l=o.getBasePixel(),c=o.isHorizontal(),u=this._getRuler(),{sharedOptions:d,includeOptions:h}=this._getSharedOptions(t,s);for(let f=t;f<t+n;f++){const p=this.getParsed(f),m=i||Le(p[o.axis])?{base:l,head:l}:this._calculateBarValuePixels(f),g=this._calculateBarIndexPixels(f,u),b=(p._stacks||{})[o.axis],_={horizontal:c,base:m.base,enableBorderRadius:!b||Uf(p._custom)||a===b._top||a===b._bottom,x:c?m.head:g.center,y:c?g.center:m.head,height:c?g.size:Math.abs(m.size),width:c?Math.abs(m.size):g.size};h&&(_.options=d||this.resolveDataElementOptions(f,e[f].active?"active":s));const y=_.options||e[f].options;FC(_,y,b,a),BC(_,y,u.ratio),this.updateElement(e[f],f,_,s)}}_getStacks(e,t){const{iScale:n}=this._cachedMeta,s=n.getMatchingVisibleMetas(this._type).filter(u=>u.controller.options.grouped),i=n.options.stacked,a=[],o=this._cachedMeta.controller.getParsed(t),l=o&&o[n.axis],c=u=>{const d=u._parsed.find(f=>f[n.axis]===l),h=d&&d[u.vScale.axis];if(Le(h)||isNaN(h))return!0};for(const u of s)if(!(t!==void 0&&c(u))&&((i===!1||a.indexOf(u.stack)===-1||i===void 0&&u.stack===void 0)&&a.push(u.stack),u.index===e))break;return a.length||a.push(void 0),a}_getStackCount(e){return this._getStacks(void 0,e).length}_getStackIndex(e,t,n){const s=this._getStacks(e,n),i=t!==void 0?s.indexOf(t):-1;return i===-1?s.length-1:i}_getRuler(){const e=this.options,t=this._cachedMeta,n=t.iScale,s=[];let i,a;for(i=0,a=t.data.length;i<a;++i)s.push(n.getPixelForValue(this.getParsed(i)[n.axis],i));const o=e.barThickness;return{min:o||$C(t),pixels:s,start:n._startPixel,end:n._endPixel,stackCount:this._getStackCount(),scale:n,grouped:e.grouped,ratio:o?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:t,_stacked:n,index:s},options:{base:i,minBarLength:a}}=this,o=i||0,l=this.getParsed(e),c=l._custom,u=Uf(c);let d=l[t.axis],h=0,f=n?this.applyStack(t,l,n):d,p,m;f!==d&&(h=f-d,f=d),u&&(d=c.barStart,f=c.barEnd-c.barStart,d!==0&&Pr(d)!==Pr(c.barEnd)&&(h=0),h+=d);const g=!Le(i)&&!u?i:h;let b=t.getPixelForValue(g);if(this.chart.getDataVisibility(e)?p=t.getPixelForValue(h+f):p=b,m=p-b,Math.abs(m)<a){m=jC(m,t,o)*a,d===o&&(b-=m/2);const _=t.getPixelForDecimal(0),y=t.getPixelForDecimal(1),w=Math.min(_,y),v=Math.max(_,y);b=Math.max(Math.min(b,v),w),p=b+m,n&&!u&&(l._stacks[t.axis]._visualValues[s]=t.getValueForPixel(p)-t.getValueForPixel(b))}if(b===t.getPixelForValue(o)){const _=Pr(m)*t.getLineWidthForValue(o)/2;b+=_,m-=_}return{size:m,base:b,head:p,center:p+m/2}}_calculateBarIndexPixels(e,t){const n=t.scale,s=this.options,i=s.skipNull,a=Se(s.maxBarThickness,1/0);let o,l;if(t.grouped){const c=i?this._getStackCount(e):t.stackCount,u=s.barThickness==="flex"?NC(e,t,s,c):MC(e,t,s,c),d=this._getStackIndex(this.index,this._cachedMeta.stack,i?e:void 0);o=u.start+u.chunk*d+u.chunk/2,l=Math.min(a,u.chunk*u.ratio)}else o=n.getPixelForValue(this.getParsed(e)[n.axis],e),l=Math.min(a,t.min*t.ratio);return{base:o-l/2,head:o+l/2,center:o,size:l}}draw(){const e=this._cachedMeta,t=e.vScale,n=e.data,s=n.length;let i=0;for(;i<s;++i)this.getParsed(i)[t.axis]!==null&&!n[i].hidden&&n[i].draw(this._ctx)}}$(ed,"id","bar"),$(ed,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),$(ed,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class td extends nr{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(e,t,n,s){const i=super.parsePrimitiveData(e,t,n,s);for(let a=0;a<i.length;a++)i[a]._custom=this.resolveDataElementOptions(a+n).radius;return i}parseArrayData(e,t,n,s){const i=super.parseArrayData(e,t,n,s);for(let a=0;a<i.length;a++){const o=t[n+a];i[a]._custom=Se(o[2],this.resolveDataElementOptions(a+n).radius)}return i}parseObjectData(e,t,n,s){const i=super.parseObjectData(e,t,n,s);for(let a=0;a<i.length;a++){const o=t[n+a];i[a]._custom=Se(o&&o.r&&+o.r,this.resolveDataElementOptions(a+n).radius)}return i}getMaxOverflow(){const e=this._cachedMeta.data;let t=0;for(let n=e.length-1;n>=0;--n)t=Math.max(t,e[n].size(this.resolveDataElementOptions(n))/2);return t>0&&t}getLabelAndValue(e){const t=this._cachedMeta,n=this.chart.data.labels||[],{xScale:s,yScale:i}=t,a=this.getParsed(e),o=s.getLabelForValue(a.x),l=i.getLabelForValue(a.y),c=a._custom;return{label:n[e]||"",value:"("+o+", "+l+(c?", "+c:"")+")"}}update(e){const t=this._cachedMeta.data;this.updateElements(t,0,t.length,e)}updateElements(e,t,n,s){const i=s==="reset",{iScale:a,vScale:o}=this._cachedMeta,{sharedOptions:l,includeOptions:c}=this._getSharedOptions(t,s),u=a.axis,d=o.axis;for(let h=t;h<t+n;h++){const f=e[h],p=!i&&this.getParsed(h),m={},g=m[u]=i?a.getPixelForDecimal(.5):a.getPixelForValue(p[u]),b=m[d]=i?o.getBasePixel():o.getPixelForValue(p[d]);m.skip=isNaN(g)||isNaN(b),c&&(m.options=l||this.resolveDataElementOptions(h,f.active?"active":s),i&&(m.options.radius=0)),this.updateElement(f,h,m,s)}}resolveDataElementOptions(e,t){const n=this.getParsed(e);let s=super.resolveDataElementOptions(e,t);s.$shared&&(s=Object.assign({},s,{$shared:!1}));const i=s.radius;return t!=="active"&&(s.radius=0),s.radius+=Se(n&&n._custom,i),s}}$(td,"id","bubble"),$(td,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),$(td,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function UC(r,e,t){let n=1,s=1,i=0,a=0;if(e<st){const o=r,l=o+e,c=Math.cos(o),u=Math.sin(o),d=Math.cos(l),h=Math.sin(l),f=(y,w,v)=>_l(y,o,l,!0)?1:Math.max(w,w*t,v,v*t),p=(y,w,v)=>_l(y,o,l,!0)?-1:Math.min(w,w*t,v,v*t),m=f(0,c,d),g=f(wt,u,h),b=p(it,c,d),_=p(it+wt,u,h);n=(m-b)/2,s=(g-_)/2,i=-(m+b)/2,a=-(g+_)/2}return{ratioX:n,ratioY:s,offsetX:i,offsetY:a}}class ri extends nr{constructor(e,t){super(e,t),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(e,t){const n=this.getDataset().data,s=this._cachedMeta;if(this._parsing===!1)s._parsed=n;else{let i=l=>+n[l];if(De(n[e])){const{key:l="value"}=this._parsing;i=c=>+Ts(n[c],l)}let a,o;for(a=e,o=e+t;a<o;++a)s._parsed[a]=i(a)}}_getRotation(){return Xn(this.options.rotation-90)}_getCircumference(){return Xn(this.options.circumference)}_getRotationExtents(){let e=st,t=-st;for(let n=0;n<this.chart.data.datasets.length;++n)if(this.chart.isDatasetVisible(n)&&this.chart.getDatasetMeta(n).type===this._type){const s=this.chart.getDatasetMeta(n).controller,i=s._getRotation(),a=s._getCircumference();e=Math.min(e,i),t=Math.max(t,i+a)}return{rotation:e,circumference:t-e}}update(e){const t=this.chart,{chartArea:n}=t,s=this._cachedMeta,i=s.data,a=this.getMaxBorderWidth()+this.getMaxOffset(i)+this.options.spacing,o=Math.max((Math.min(n.width,n.height)-a)/2,0),l=Math.min(eI(this.options.cutout,o),1),c=this._getRingWeight(this.index),{circumference:u,rotation:d}=this._getRotationExtents(),{ratioX:h,ratioY:f,offsetX:p,offsetY:m}=UC(d,u,l),g=(n.width-a)/h,b=(n.height-a)/f,_=Math.max(Math.min(g,b)/2,0),y=gS(this.options.radius,_),w=Math.max(y*l,0),v=(y-w)/this._getVisibleDatasetWeightTotal();this.offsetX=p*y,this.offsetY=m*y,s.total=this.calculateTotal(),this.outerRadius=y-v*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-v*c,0),this.updateElements(i,0,i.length,e)}_circumference(e,t){const n=this.options,s=this._cachedMeta,i=this._getCircumference();return t&&n.animation.animateRotate||!this.chart.getDataVisibility(e)||s._parsed[e]===null||s.data[e].hidden?0:this.calculateCircumference(s._parsed[e]*i/st)}updateElements(e,t,n,s){const i=s==="reset",a=this.chart,o=a.chartArea,c=a.options.animation,u=(o.left+o.right)/2,d=(o.top+o.bottom)/2,h=i&&c.animateScale,f=h?0:this.innerRadius,p=h?0:this.outerRadius,{sharedOptions:m,includeOptions:g}=this._getSharedOptions(t,s);let b=this._getRotation(),_;for(_=0;_<t;++_)b+=this._circumference(_,i);for(_=t;_<t+n;++_){const y=this._circumference(_,i),w=e[_],v={x:u+this.offsetX,y:d+this.offsetY,startAngle:b,endAngle:b+y,circumference:y,outerRadius:p,innerRadius:f};g&&(v.options=m||this.resolveDataElementOptions(_,w.active?"active":s)),b+=y,this.updateElement(w,_,v,s)}}calculateTotal(){const e=this._cachedMeta,t=e.data;let n=0,s;for(s=0;s<t.length;s++){const i=e._parsed[s];i!==null&&!isNaN(i)&&this.chart.getDataVisibility(s)&&!t[s].hidden&&(n+=Math.abs(i))}return n}calculateCircumference(e){const t=this._cachedMeta.total;return t>0&&!isNaN(e)?st*(Math.abs(e)/t):0}getLabelAndValue(e){const t=this._cachedMeta,n=this.chart,s=n.data.labels||[],i=_c(t._parsed[e],n.options.locale);return{label:s[e]||"",value:i}}getMaxBorderWidth(e){let t=0;const n=this.chart;let s,i,a,o,l;if(!e){for(s=0,i=n.data.datasets.length;s<i;++s)if(n.isDatasetVisible(s)){a=n.getDatasetMeta(s),e=a.data,o=a.controller;break}}if(!e)return 0;for(s=0,i=e.length;s<i;++s)l=o.resolveDataElementOptions(s),l.borderAlign!=="inner"&&(t=Math.max(t,l.borderWidth||0,l.hoverBorderWidth||0));return t}getMaxOffset(e){let t=0;for(let n=0,s=e.length;n<s;++n){const i=this.resolveDataElementOptions(n);t=Math.max(t,i.offset||0,i.hoverOffset||0)}return t}_getRingWeightOffset(e){let t=0;for(let n=0;n<e;++n)this.chart.isDatasetVisible(n)&&(t+=this._getRingWeight(n));return t}_getRingWeight(e){return Math.max(Se(this.chart.data.datasets[e].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}$(ri,"id","doughnut"),$(ri,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),$(ri,"descriptors",{_scriptable:e=>e!=="spacing",_indexable:e=>e!=="spacing"&&!e.startsWith("borderDash")&&!e.startsWith("hoverBorderDash")}),$(ri,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:n,color:s}}=e.legend.options;return t.labels.map((i,a)=>{const l=e.getDatasetMeta(0).controller.getStyle(a);return{text:i,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:s,lineWidth:l.borderWidth,pointStyle:n,hidden:!e.getDataVisibility(a),index:a}})}return[]}},onClick(e,t,n){n.chart.toggleDataVisibility(t.index),n.chart.update()}}}});class nd extends nr{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const t=this._cachedMeta,{dataset:n,data:s=[],_dataset:i}=t,a=this.chart._animationsDisabled;let{start:o,count:l}=SS(t,s,a);this._drawStart=o,this._drawCount=l,PS(t)&&(o=0,l=s.length),n._chart=this.chart,n._datasetIndex=this.index,n._decimated=!!i._decimated,n.points=s;const c=this.resolveDatasetElementOptions(e);this.options.showLine||(c.borderWidth=0),c.segment=this.options.segment,this.updateElement(n,void 0,{animated:!a,options:c},e),this.updateElements(s,o,l,e)}updateElements(e,t,n,s){const i=s==="reset",{iScale:a,vScale:o,_stacked:l,_dataset:c}=this._cachedMeta,{sharedOptions:u,includeOptions:d}=this._getSharedOptions(t,s),h=a.axis,f=o.axis,{spanGaps:p,segment:m}=this.options,g=Oa(p)?p:Number.POSITIVE_INFINITY,b=this.chart._animationsDisabled||i||s==="none",_=t+n,y=e.length;let w=t>0&&this.getParsed(t-1);for(let v=0;v<y;++v){const x=e[v],k=b?x:{};if(v<t||v>=_){k.skip=!0;continue}const S=this.getParsed(v),R=Le(S[f]),D=k[h]=a.getPixelForValue(S[h],v),M=k[f]=i||R?o.getBasePixel():o.getPixelForValue(l?this.applyStack(o,S,l):S[f],v);k.skip=isNaN(D)||isNaN(M)||R,k.stop=v>0&&Math.abs(S[h]-w[h])>g,m&&(k.parsed=S,k.raw=c.data[v]),d&&(k.options=u||this.resolveDataElementOptions(v,x.active?"active":s)),b||this.updateElement(x,v,k,s),w=S}}getMaxOverflow(){const e=this._cachedMeta,t=e.dataset,n=t.options&&t.options.borderWidth||0,s=e.data||[];if(!s.length)return n;const i=s[0].size(this.resolveDataElementOptions(0)),a=s[s.length-1].size(this.resolveDataElementOptions(s.length-1));return Math.max(n,i,a)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}$(nd,"id","line"),$(nd,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),$(nd,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class tl extends nr{constructor(e,t){super(e,t),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(e){const t=this._cachedMeta,n=this.chart,s=n.data.labels||[],i=_c(t._parsed[e].r,n.options.locale);return{label:s[e]||"",value:i}}parseObjectData(e,t,n,s){return $S.bind(this)(e,t,n,s)}update(e){const t=this._cachedMeta.data;this._updateRadius(),this.updateElements(t,0,t.length,e)}getMinMax(){const e=this._cachedMeta,t={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return e.data.forEach((n,s)=>{const i=this.getParsed(s).r;!isNaN(i)&&this.chart.getDataVisibility(s)&&(i<t.min&&(t.min=i),i>t.max&&(t.max=i))}),t}_updateRadius(){const e=this.chart,t=e.chartArea,n=e.options,s=Math.min(t.right-t.left,t.bottom-t.top),i=Math.max(s/2,0),a=Math.max(n.cutoutPercentage?i/100*n.cutoutPercentage:1,0),o=(i-a)/e.getVisibleDatasetCount();this.outerRadius=i-o*this.index,this.innerRadius=this.outerRadius-o}updateElements(e,t,n,s){const i=s==="reset",a=this.chart,l=a.options.animation,c=this._cachedMeta.rScale,u=c.xCenter,d=c.yCenter,h=c.getIndexAngle(0)-.5*it;let f=h,p;const m=360/this.countVisibleElements();for(p=0;p<t;++p)f+=this._computeAngle(p,s,m);for(p=t;p<t+n;p++){const g=e[p];let b=f,_=f+this._computeAngle(p,s,m),y=a.getDataVisibility(p)?c.getDistanceFromCenterForValue(this.getParsed(p).r):0;f=_,i&&(l.animateScale&&(y=0),l.animateRotate&&(b=_=h));const w={x:u,y:d,innerRadius:0,outerRadius:y,startAngle:b,endAngle:_,options:this.resolveDataElementOptions(p,g.active?"active":s)};this.updateElement(g,p,w,s)}}countVisibleElements(){const e=this._cachedMeta;let t=0;return e.data.forEach((n,s)=>{!isNaN(this.getParsed(s).r)&&this.chart.getDataVisibility(s)&&t++}),t}_computeAngle(e,t,n){return this.chart.getDataVisibility(e)?Xn(this.resolveDataElementOptions(e,t).angle||n):0}}$(tl,"id","polarArea"),$(tl,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),$(tl,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:n,color:s}}=e.legend.options;return t.labels.map((i,a)=>{const l=e.getDatasetMeta(0).controller.getStyle(a);return{text:i,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:s,lineWidth:l.borderWidth,pointStyle:n,hidden:!e.getDataVisibility(a),index:a}})}return[]}},onClick(e,t,n){n.chart.toggleDataVisibility(t.index),n.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class ug extends ri{}$(ug,"id","pie"),$(ug,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class rd extends nr{getLabelAndValue(e){const t=this._cachedMeta.vScale,n=this.getParsed(e);return{label:t.getLabels()[e],value:""+t.getLabelForValue(n[t.axis])}}parseObjectData(e,t,n,s){return $S.bind(this)(e,t,n,s)}update(e){const t=this._cachedMeta,n=t.dataset,s=t.data||[],i=t.iScale.getLabels();if(n.points=s,e!=="resize"){const a=this.resolveDatasetElementOptions(e);this.options.showLine||(a.borderWidth=0);const o={_loop:!0,_fullLoop:i.length===s.length,options:a};this.updateElement(n,void 0,o,e)}this.updateElements(s,0,s.length,e)}updateElements(e,t,n,s){const i=this._cachedMeta.rScale,a=s==="reset";for(let o=t;o<t+n;o++){const l=e[o],c=this.resolveDataElementOptions(o,l.active?"active":s),u=i.getPointPositionForValue(o,this.getParsed(o).r),d=a?i.xCenter:u.x,h=a?i.yCenter:u.y,f={x:d,y:h,angle:u.angle,skip:isNaN(d)||isNaN(h),options:c};this.updateElement(l,o,f,s)}}}$(rd,"id","radar"),$(rd,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),$(rd,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class sd extends nr{getLabelAndValue(e){const t=this._cachedMeta,n=this.chart.data.labels||[],{xScale:s,yScale:i}=t,a=this.getParsed(e),o=s.getLabelForValue(a.x),l=i.getLabelForValue(a.y);return{label:n[e]||"",value:"("+o+", "+l+")"}}update(e){const t=this._cachedMeta,{data:n=[]}=t,s=this.chart._animationsDisabled;let{start:i,count:a}=SS(t,n,s);if(this._drawStart=i,this._drawCount=a,PS(t)&&(i=0,a=n.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:o,_dataset:l}=t;o._chart=this.chart,o._datasetIndex=this.index,o._decimated=!!l._decimated,o.points=n;const c=this.resolveDatasetElementOptions(e);c.segment=this.options.segment,this.updateElement(o,void 0,{animated:!s,options:c},e)}else this.datasetElementType&&(delete t.dataset,this.datasetElementType=!1);this.updateElements(n,i,a,e)}addElements(){const{showLine:e}=this.options;!this.datasetElementType&&e&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(e,t,n,s){const i=s==="reset",{iScale:a,vScale:o,_stacked:l,_dataset:c}=this._cachedMeta,u=this.resolveDataElementOptions(t,s),d=this.getSharedOptions(u),h=this.includeOptions(s,d),f=a.axis,p=o.axis,{spanGaps:m,segment:g}=this.options,b=Oa(m)?m:Number.POSITIVE_INFINITY,_=this.chart._animationsDisabled||i||s==="none";let y=t>0&&this.getParsed(t-1);for(let w=t;w<t+n;++w){const v=e[w],x=this.getParsed(w),k=_?v:{},S=Le(x[p]),R=k[f]=a.getPixelForValue(x[f],w),D=k[p]=i||S?o.getBasePixel():o.getPixelForValue(l?this.applyStack(o,x,l):x[p],w);k.skip=isNaN(R)||isNaN(D)||S,k.stop=w>0&&Math.abs(x[f]-y[f])>b,g&&(k.parsed=x,k.raw=c.data[w]),h&&(k.options=d||this.resolveDataElementOptions(w,v.active?"active":s)),_||this.updateElement(v,w,k,s),y=x}this.updateSharedOptions(d,s,u)}getMaxOverflow(){const e=this._cachedMeta,t=e.data||[];if(!this.options.showLine){let o=0;for(let l=t.length-1;l>=0;--l)o=Math.max(o,t[l].size(this.resolveDataElementOptions(l))/2);return o>0&&o}const n=e.dataset,s=n.options&&n.options.borderWidth||0;if(!t.length)return s;const i=t[0].size(this.resolveDataElementOptions(0)),a=t[t.length-1].size(this.resolveDataElementOptions(t.length-1));return Math.max(s,i,a)/2}}$(sd,"id","scatter"),$(sd,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),$(sd,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var qC=Object.freeze({__proto__:null,BarController:ed,BubbleController:td,DoughnutController:ri,LineController:nd,PieController:ug,PolarAreaController:tl,RadarController:rd,ScatterController:sd});function Zs(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Bb{constructor(e){$(this,"options");this.options=e||{}}static override(e){Object.assign(Bb.prototype,e)}init(){}formats(){return Zs()}parse(){return Zs()}format(){return Zs()}add(){return Zs()}diff(){return Zs()}startOf(){return Zs()}endOf(){return Zs()}}var HC={_date:Bb};function WC(r,e,t,n){const{controller:s,data:i,_sorted:a}=r,o=s._cachedMeta.iScale,l=r.dataset&&r.dataset.options?r.dataset.options.spanGaps:null;if(o&&e===o.axis&&e!=="r"&&a&&i.length){const c=o._reversePixels?fI:Xr;if(n){if(s._sharedOptions){const u=i[0],d=typeof u.getRange=="function"&&u.getRange(e);if(d){const h=c(i,e,t-d),f=c(i,e,t+d);return{lo:h.lo,hi:f.hi}}}}else{const u=c(i,e,t);if(l){const{vScale:d}=s._cachedMeta,{_parsed:h}=r,f=h.slice(0,u.lo+1).reverse().findIndex(m=>!Le(m[d.axis]));u.lo-=Math.max(0,f);const p=h.slice(u.hi).findIndex(m=>!Le(m[d.axis]));u.hi+=Math.max(0,p)}return u}}return{lo:0,hi:i.length-1}}function Oh(r,e,t,n,s){const i=r.getSortedVisibleDatasetMetas(),a=t[e];for(let o=0,l=i.length;o<l;++o){const{index:c,data:u}=i[o],{lo:d,hi:h}=WC(i[o],e,a,s);for(let f=d;f<=h;++f){const p=u[f];p.skip||n(p,c,f)}}}function VC(r){const e=r.indexOf("x")!==-1,t=r.indexOf("y")!==-1;return function(n,s){const i=e?Math.abs(n.x-s.x):0,a=t?Math.abs(n.y-s.y):0;return Math.sqrt(Math.pow(i,2)+Math.pow(a,2))}}function qf(r,e,t,n,s){const i=[];return!s&&!r.isPointInArea(e)||Oh(r,t,e,function(o,l,c){!s&&!Yr(o,r.chartArea,0)||o.inRange(e.x,e.y,n)&&i.push({element:o,datasetIndex:l,index:c})},!0),i}function GC(r,e,t,n){let s=[];function i(a,o,l){const{startAngle:c,endAngle:u}=a.getProps(["startAngle","endAngle"],n),{angle:d}=yS(a,{x:e.x,y:e.y});_l(d,c,u)&&s.push({element:a,datasetIndex:o,index:l})}return Oh(r,t,e,i),s}function ZC(r,e,t,n,s,i){let a=[];const o=VC(t);let l=Number.POSITIVE_INFINITY;function c(u,d,h){const f=u.inRange(e.x,e.y,s);if(n&&!f)return;const p=u.getCenterPoint(s);if(!(!!i||r.isPointInArea(p))&&!f)return;const g=o(e,p);g<l?(a=[{element:u,datasetIndex:d,index:h}],l=g):g===l&&a.push({element:u,datasetIndex:d,index:h})}return Oh(r,t,e,c),a}function Hf(r,e,t,n,s,i){return!i&&!r.isPointInArea(e)?[]:t==="r"&&!n?GC(r,e,t,s):ZC(r,e,t,n,s,i)}function Pw(r,e,t,n,s){const i=[],a=t==="x"?"inXRange":"inYRange";let o=!1;return Oh(r,t,e,(l,c,u)=>{l[a]&&l[a](e[t],s)&&(i.push({element:l,datasetIndex:c,index:u}),o=o||l.inRange(e.x,e.y,s))}),n&&!o?[]:i}var JC={modes:{index(r,e,t,n){const s=Qs(e,r),i=t.axis||"x",a=t.includeInvisible||!1,o=t.intersect?qf(r,s,i,n,a):Hf(r,s,i,!1,n,a),l=[];return o.length?(r.getSortedVisibleDatasetMetas().forEach(c=>{const u=o[0].index,d=c.data[u];d&&!d.skip&&l.push({element:d,datasetIndex:c.index,index:u})}),l):[]},dataset(r,e,t,n){const s=Qs(e,r),i=t.axis||"xy",a=t.includeInvisible||!1;let o=t.intersect?qf(r,s,i,n,a):Hf(r,s,i,!1,n,a);if(o.length>0){const l=o[0].datasetIndex,c=r.getDatasetMeta(l).data;o=[];for(let u=0;u<c.length;++u)o.push({element:c[u],datasetIndex:l,index:u})}return o},point(r,e,t,n){const s=Qs(e,r),i=t.axis||"xy",a=t.includeInvisible||!1;return qf(r,s,i,n,a)},nearest(r,e,t,n){const s=Qs(e,r),i=t.axis||"xy",a=t.includeInvisible||!1;return Hf(r,s,i,t.intersect,n,a)},x(r,e,t,n){const s=Qs(e,r);return Pw(r,s,"x",t.intersect,n)},y(r,e,t,n){const s=Qs(e,r);return Pw(r,s,"y",t.intersect,n)}}};const HS=["left","top","right","bottom"];function ao(r,e){return r.filter(t=>t.pos===e)}function Aw(r,e){return r.filter(t=>HS.indexOf(t.pos)===-1&&t.box.axis===e)}function oo(r,e){return r.sort((t,n)=>{const s=e?n:t,i=e?t:n;return s.weight===i.weight?s.index-i.index:s.weight-i.weight})}function KC(r){const e=[];let t,n,s,i,a,o;for(t=0,n=(r||[]).length;t<n;++t)s=r[t],{position:i,options:{stack:a,stackWeight:o=1}}=s,e.push({index:t,box:s,pos:i,horizontal:s.isHorizontal(),weight:s.weight,stack:a&&i+a,stackWeight:o});return e}function XC(r){const e={};for(const t of r){const{stack:n,pos:s,stackWeight:i}=t;if(!n||!HS.includes(s))continue;const a=e[n]||(e[n]={count:0,placed:0,weight:0,size:0});a.count++,a.weight+=i}return e}function YC(r,e){const t=XC(r),{vBoxMaxWidth:n,hBoxMaxHeight:s}=e;let i,a,o;for(i=0,a=r.length;i<a;++i){o=r[i];const{fullSize:l}=o.box,c=t[o.stack],u=c&&o.stackWeight/c.weight;o.horizontal?(o.width=u?u*n:l&&e.availableWidth,o.height=s):(o.width=n,o.height=u?u*s:l&&e.availableHeight)}return t}function QC(r){const e=KC(r),t=oo(e.filter(c=>c.box.fullSize),!0),n=oo(ao(e,"left"),!0),s=oo(ao(e,"right")),i=oo(ao(e,"top"),!0),a=oo(ao(e,"bottom")),o=Aw(e,"x"),l=Aw(e,"y");return{fullSize:t,leftAndTop:n.concat(i),rightAndBottom:s.concat(l).concat(a).concat(o),chartArea:ao(e,"chartArea"),vertical:n.concat(s).concat(l),horizontal:i.concat(a).concat(o)}}function Ew(r,e,t,n){return Math.max(r[t],e[t])+Math.max(r[n],e[n])}function WS(r,e){r.top=Math.max(r.top,e.top),r.left=Math.max(r.left,e.left),r.bottom=Math.max(r.bottom,e.bottom),r.right=Math.max(r.right,e.right)}function e$(r,e,t,n){const{pos:s,box:i}=t,a=r.maxPadding;if(!De(s)){t.size&&(r[s]-=t.size);const d=n[t.stack]||{size:0,count:1};d.size=Math.max(d.size,t.horizontal?i.height:i.width),t.size=d.size/d.count,r[s]+=t.size}i.getPadding&&WS(a,i.getPadding());const o=Math.max(0,e.outerWidth-Ew(a,r,"left","right")),l=Math.max(0,e.outerHeight-Ew(a,r,"top","bottom")),c=o!==r.w,u=l!==r.h;return r.w=o,r.h=l,t.horizontal?{same:c,other:u}:{same:u,other:c}}function t$(r){const e=r.maxPadding;function t(n){const s=Math.max(e[n]-r[n],0);return r[n]+=s,s}r.y+=t("top"),r.x+=t("left"),t("right"),t("bottom")}function n$(r,e){const t=e.maxPadding;function n(s){const i={left:0,top:0,right:0,bottom:0};return s.forEach(a=>{i[a]=Math.max(e[a],t[a])}),i}return n(r?["left","right"]:["top","bottom"])}function Mo(r,e,t,n){const s=[];let i,a,o,l,c,u;for(i=0,a=r.length,c=0;i<a;++i){o=r[i],l=o.box,l.update(o.width||e.w,o.height||e.h,n$(o.horizontal,e));const{same:d,other:h}=e$(e,t,o,n);c|=d&&s.length,u=u||h,l.fullSize||s.push(o)}return c&&Mo(s,e,t,n)||u}function ru(r,e,t,n,s){r.top=t,r.left=e,r.right=e+n,r.bottom=t+s,r.width=n,r.height=s}function Ow(r,e,t,n){const s=t.padding;let{x:i,y:a}=e;for(const o of r){const l=o.box,c=n[o.stack]||{placed:0,weight:1},u=o.stackWeight/c.weight||1;if(o.horizontal){const d=e.w*u,h=c.size||l.height;bl(c.start)&&(a=c.start),l.fullSize?ru(l,s.left,a,t.outerWidth-s.right-s.left,h):ru(l,e.left+c.placed,a,d,h),c.start=a,c.placed+=d,a=l.bottom}else{const d=e.h*u,h=c.size||l.width;bl(c.start)&&(i=c.start),l.fullSize?ru(l,i,s.top,h,t.outerHeight-s.bottom-s.top):ru(l,i,e.top+c.placed,h,d),c.start=i,c.placed+=d,i=l.right}}e.x=i,e.y=a}var Kt={addBox(r,e){r.boxes||(r.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},r.boxes.push(e)},removeBox(r,e){const t=r.boxes?r.boxes.indexOf(e):-1;t!==-1&&r.boxes.splice(t,1)},configure(r,e,t){e.fullSize=t.fullSize,e.position=t.position,e.weight=t.weight},update(r,e,t,n){if(!r)return;const s=Xt(r.options.layout.padding),i=Math.max(e-s.width,0),a=Math.max(t-s.height,0),o=QC(r.boxes),l=o.vertical,c=o.horizontal;Je(r.boxes,m=>{typeof m.beforeLayout=="function"&&m.beforeLayout()});const u=l.reduce((m,g)=>g.box.options&&g.box.options.display===!1?m:m+1,0)||1,d=Object.freeze({outerWidth:e,outerHeight:t,padding:s,availableWidth:i,availableHeight:a,vBoxMaxWidth:i/2/u,hBoxMaxHeight:a/2}),h=Object.assign({},s);WS(h,Xt(n));const f=Object.assign({maxPadding:h,w:i,h:a,x:s.left,y:s.top},s),p=YC(l.concat(c),d);Mo(o.fullSize,f,d,p),Mo(l,f,d,p),Mo(c,f,d,p)&&Mo(l,f,d,p),t$(f),Ow(o.leftAndTop,f,d,p),f.x+=f.w,f.y+=f.h,Ow(o.rightAndBottom,f,d,p),r.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},Je(o.chartArea,m=>{const g=m.box;Object.assign(g,r.chartArea),g.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})})}};class VS{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,n){}removeEventListener(e,t,n){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,n,s){return t=Math.max(0,t||e.width),n=n||e.height,{width:t,height:Math.max(0,s?Math.floor(t/s):n)}}isAttached(e){return!0}updateConfig(e){}}class r$ extends VS{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const id="$chartjs",s$={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Tw=r=>r===null||r==="";function i$(r,e){const t=r.style,n=r.getAttribute("height"),s=r.getAttribute("width");if(r[id]={initial:{height:n,width:s,style:{display:t.display,height:t.height,width:t.width}}},t.display=t.display||"block",t.boxSizing=t.boxSizing||"border-box",Tw(s)){const i=hw(r,"width");i!==void 0&&(r.width=i)}if(Tw(n))if(r.style.height==="")r.height=r.width/(e||2);else{const i=hw(r,"height");i!==void 0&&(r.height=i)}return r}const GS=aC?{passive:!0}:!1;function a$(r,e,t){r&&r.addEventListener(e,t,GS)}function o$(r,e,t){r&&r.canvas&&r.canvas.removeEventListener(e,t,GS)}function l$(r,e){const t=s$[r.type]||r.type,{x:n,y:s}=Qs(r,e);return{type:t,chart:e,native:r,x:n!==void 0?n:null,y:s!==void 0?s:null}}function Pd(r,e){for(const t of r)if(t===e||t.contains(e))return!0}function c$(r,e,t){const n=r.canvas,s=new MutationObserver(i=>{let a=!1;for(const o of i)a=a||Pd(o.addedNodes,n),a=a&&!Pd(o.removedNodes,n);a&&t()});return s.observe(document,{childList:!0,subtree:!0}),s}function u$(r,e,t){const n=r.canvas,s=new MutationObserver(i=>{let a=!1;for(const o of i)a=a||Pd(o.removedNodes,n),a=a&&!Pd(o.addedNodes,n);a&&t()});return s.observe(document,{childList:!0,subtree:!0}),s}const wl=new Map;let Rw=0;function ZS(){const r=window.devicePixelRatio;r!==Rw&&(Rw=r,wl.forEach((e,t)=>{t.currentDevicePixelRatio!==r&&e()}))}function d$(r,e){wl.size||window.addEventListener("resize",ZS),wl.set(r,e)}function h$(r){wl.delete(r),wl.size||window.removeEventListener("resize",ZS)}function f$(r,e,t){const n=r.canvas,s=n&&zb(n);if(!s)return;const i=kS((o,l)=>{const c=s.clientWidth;t(o,l),c<s.clientWidth&&t()},window),a=new ResizeObserver(o=>{const l=o[0],c=l.contentRect.width,u=l.contentRect.height;c===0&&u===0||i(c,u)});return a.observe(s),d$(r,i),a}function Wf(r,e,t){t&&t.disconnect(),e==="resize"&&h$(r)}function p$(r,e,t){const n=r.canvas,s=kS(i=>{r.ctx!==null&&t(l$(i,r))},r);return a$(n,e,s),s}class m$ extends VS{acquireContext(e,t){const n=e&&e.getContext&&e.getContext("2d");return n&&n.canvas===e?(i$(e,t),n):null}releaseContext(e){const t=e.canvas;if(!t[id])return!1;const n=t[id].initial;["height","width"].forEach(i=>{const a=n[i];Le(a)?t.removeAttribute(i):t.setAttribute(i,a)});const s=n.style||{};return Object.keys(s).forEach(i=>{t.style[i]=s[i]}),t.width=t.width,delete t[id],!0}addEventListener(e,t,n){this.removeEventListener(e,t);const s=e.$proxies||(e.$proxies={}),a={attach:c$,detach:u$,resize:f$}[t]||p$;s[t]=a(e,t,n)}removeEventListener(e,t){const n=e.$proxies||(e.$proxies={}),s=n[t];if(!s)return;({attach:Wf,detach:Wf,resize:Wf}[t]||o$)(e,t,s),n[t]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,n,s){return iC(e,t,n,s)}isAttached(e){const t=e&&zb(e);return!!(t&&t.isConnected)}}function g$(r){return!Fb()||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas?r$:m$}var Yu;let ns=(Yu=class{constructor(){$(this,"x");$(this,"y");$(this,"active",!1);$(this,"options");$(this,"$animations")}tooltipPosition(e){const{x:t,y:n}=this.getProps(["x","y"],e);return{x:t,y:n}}hasValue(){return Oa(this.x)&&Oa(this.y)}getProps(e,t){const n=this.$animations;if(!t||!n)return this;const s={};return e.forEach(i=>{s[i]=n[i]&&n[i].active()?n[i]._to:this[i]}),s}},$(Yu,"defaults",{}),$(Yu,"defaultRoutes"),Yu);function b$(r,e){const t=r.options.ticks,n=_$(r),s=Math.min(t.maxTicksLimit||n,n),i=t.major.enabled?w$(e):[],a=i.length,o=i[0],l=i[a-1],c=[];if(a>s)return v$(e,c,i,a/s),c;const u=y$(i,e,s);if(a>0){let d,h;const f=a>1?Math.round((l-o)/(a-1)):null;for(su(e,c,u,Le(f)?0:o-f,o),d=0,h=a-1;d<h;d++)su(e,c,u,i[d],i[d+1]);return su(e,c,u,l,Le(f)?e.length:l+f),c}return su(e,c,u),c}function _$(r){const e=r.options.offset,t=r._tickSize(),n=r._length/t+(e?0:1),s=r._maxLength/t;return Math.floor(Math.min(n,s))}function y$(r,e,t){const n=x$(r),s=e.length/t;if(!n)return Math.max(s,1);const i=lI(n);for(let a=0,o=i.length-1;a<o;a++){const l=i[a];if(l>s)return l}return Math.max(s,1)}function w$(r){const e=[];let t,n;for(t=0,n=r.length;t<n;t++)r[t].major&&e.push(t);return e}function v$(r,e,t,n){let s=0,i=t[0],a;for(n=Math.ceil(n),a=0;a<r.length;a++)a===i&&(e.push(r[a]),s++,i=t[s*n])}function su(r,e,t,n,s){const i=Se(n,0),a=Math.min(Se(s,r.length),r.length);let o=0,l,c,u;for(t=Math.ceil(t),s&&(l=s-n,t=l/Math.floor(l/t)),u=i;u<0;)o++,u=Math.round(i+o*t);for(c=Math.max(i,0);c<a;c++)c===u&&(e.push(r[c]),o++,u=Math.round(i+o*t))}function x$(r){const e=r.length;let t,n;if(e<2)return!1;for(n=r[0],t=1;t<e;++t)if(r[t]-r[t-1]!==n)return!1;return n}const k$=r=>r==="left"?"right":r==="right"?"left":r,Iw=(r,e,t)=>e==="top"||e==="left"?r[e]+t:r[e]-t,Cw=(r,e)=>Math.min(e||r,r);function $w(r,e){const t=[],n=r.length/e,s=r.length;let i=0;for(;i<s;i+=n)t.push(r[Math.floor(i)]);return t}function S$(r,e,t){const n=r.ticks.length,s=Math.min(e,n-1),i=r._startPixel,a=r._endPixel,o=1e-6;let l=r.getPixelForTick(s),c;if(!(t&&(n===1?c=Math.max(l-i,a-l):e===0?c=(r.getPixelForTick(1)-l)/2:c=(l-r.getPixelForTick(s-1))/2,l+=s<e?c:-c,l<i-o||l>a+o)))return l}function P$(r,e){Je(r,t=>{const n=t.gc,s=n.length/2;let i;if(s>e){for(i=0;i<s;++i)delete t.data[n[i]];n.splice(0,s)}})}function lo(r){return r.drawTicks?r.tickLength:0}function Mw(r,e){if(!r.display)return 0;const t=Ot(r.font,e),n=Xt(r.padding);return(lt(r.text)?r.text.length:1)*t.lineHeight+n.height}function A$(r,e){return Fs(r,{scale:e,type:"scale"})}function E$(r,e,t){return Fs(r,{tick:t,index:e,type:"tick"})}function O$(r,e,t){let n=$b(r);return(t&&e!=="right"||!t&&e==="right")&&(n=k$(n)),n}function T$(r,e,t,n){const{top:s,left:i,bottom:a,right:o,chart:l}=r,{chartArea:c,scales:u}=l;let d=0,h,f,p;const m=a-s,g=o-i;if(r.isHorizontal()){if(f=Zt(n,i,o),De(t)){const b=Object.keys(t)[0],_=t[b];p=u[b].getPixelForValue(_)+m-e}else t==="center"?p=(c.bottom+c.top)/2+m-e:p=Iw(r,t,e);h=o-i}else{if(De(t)){const b=Object.keys(t)[0],_=t[b];f=u[b].getPixelForValue(_)-g+e}else t==="center"?f=(c.left+c.right)/2-g+e:f=Iw(r,t,e);p=Zt(n,a,s),d=t==="left"?-wt:wt}return{titleX:f,titleY:p,maxWidth:h,rotation:d}}class Ai extends ns{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:n,_suggestedMax:s}=this;return e=An(e,Number.POSITIVE_INFINITY),t=An(t,Number.NEGATIVE_INFINITY),n=An(n,Number.POSITIVE_INFINITY),s=An(s,Number.NEGATIVE_INFINITY),{min:An(e,n),max:An(t,s),minDefined:gt(e),maxDefined:gt(t)}}getMinMax(e){let{min:t,max:n,minDefined:s,maxDefined:i}=this.getUserBounds(),a;if(s&&i)return{min:t,max:n};const o=this.getMatchingVisibleMetas();for(let l=0,c=o.length;l<c;++l)a=o[l].controller.getMinMax(this,e),s||(t=Math.min(t,a.min)),i||(n=Math.max(n,a.max));return t=i&&t>n?n:t,n=s&&t>n?t:n,{min:An(t,An(n,t)),max:An(n,An(t,n))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){nt(this.options.beforeUpdate,[this])}update(e,t,n){const{beginAtZero:s,grace:i,ticks:a}=this.options,o=a.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=n=Object.assign({left:0,right:0,top:0,bottom:0},n),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+n.left+n.right:this.height+n.top+n.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=jI(this,i,s),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=o<this.ticks.length;this._convertTicksToLabels(l?$w(this.ticks,o):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),a.display&&(a.autoSkip||a.source==="auto")&&(this.ticks=b$(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,t,n;this.isHorizontal()?(t=this.left,n=this.right):(t=this.top,n=this.bottom,e=!e),this._startPixel=t,this._endPixel=n,this._reversePixels=e,this._length=n-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){nt(this.options.afterUpdate,[this])}beforeSetDimensions(){nt(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){nt(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),nt(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){nt(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const t=this.options.ticks;let n,s,i;for(n=0,s=e.length;n<s;n++)i=e[n],i.label=nt(t.callback,[i.value,n,e],this)}afterTickToLabelConversion(){nt(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){nt(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,t=e.ticks,n=Cw(this.ticks.length,e.ticks.maxTicksLimit),s=t.minRotation||0,i=t.maxRotation;let a=s,o,l,c;if(!this._isVisible()||!t.display||s>=i||n<=1||!this.isHorizontal()){this.labelRotation=s;return}const u=this._getLabelSizes(),d=u.widest.width,h=u.highest.height,f=Lt(this.chart.width-d,0,this.maxWidth);o=e.offset?this.maxWidth/n:f/(n-1),d+6>o&&(o=f/(n-(e.offset?.5:1)),l=this.maxHeight-lo(e.grid)-t.padding-Mw(e.title,this.chart.options.font),c=Math.sqrt(d*d+h*h),a=Ib(Math.min(Math.asin(Lt((u.highest.height+6)/o,-1,1)),Math.asin(Lt(l/c,-1,1))-Math.asin(Lt(h/c,-1,1)))),a=Math.max(s,Math.min(i,a))),this.labelRotation=a}afterCalculateLabelRotation(){nt(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){nt(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:t,options:{ticks:n,title:s,grid:i}}=this,a=this._isVisible(),o=this.isHorizontal();if(a){const l=Mw(s,t.options.font);if(o?(e.width=this.maxWidth,e.height=lo(i)+l):(e.height=this.maxHeight,e.width=lo(i)+l),n.display&&this.ticks.length){const{first:c,last:u,widest:d,highest:h}=this._getLabelSizes(),f=n.padding*2,p=Xn(this.labelRotation),m=Math.cos(p),g=Math.sin(p);if(o){const b=n.mirror?0:g*d.width+m*h.height;e.height=Math.min(this.maxHeight,e.height+b+f)}else{const b=n.mirror?0:m*d.width+g*h.height;e.width=Math.min(this.maxWidth,e.width+b+f)}this._calculatePadding(c,u,g,m)}}this._handleMargins(),o?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,n,s){const{ticks:{align:i,padding:a},position:o}=this.options,l=this.labelRotation!==0,c=o!=="top"&&this.axis==="x";if(this.isHorizontal()){const u=this.getPixelForTick(0)-this.left,d=this.right-this.getPixelForTick(this.ticks.length-1);let h=0,f=0;l?c?(h=s*e.width,f=n*t.height):(h=n*e.height,f=s*t.width):i==="start"?f=t.width:i==="end"?h=e.width:i!=="inner"&&(h=e.width/2,f=t.width/2),this.paddingLeft=Math.max((h-u+a)*this.width/(this.width-u),0),this.paddingRight=Math.max((f-d+a)*this.width/(this.width-d),0)}else{let u=t.height/2,d=e.height/2;i==="start"?(u=0,d=e.height):i==="end"&&(u=t.height,d=0),this.paddingTop=u+a,this.paddingBottom=d+a}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){nt(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:t}=this.options;return t==="top"||t==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let t,n;for(t=0,n=e.length;t<n;t++)Le(e[t].label)&&(e.splice(t,1),n--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const t=this.options.ticks.sampleSize;let n=this.ticks;t<n.length&&(n=$w(n,t)),this._labelSizes=e=this._computeLabelSizes(n,n.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,t,n){const{ctx:s,_longestTextCache:i}=this,a=[],o=[],l=Math.floor(t/Cw(t,n));let c=0,u=0,d,h,f,p,m,g,b,_,y,w,v;for(d=0;d<t;d+=l){if(p=e[d].label,m=this._resolveTickFontOptions(d),s.font=g=m.string,b=i[g]=i[g]||{data:{},gc:[]},_=m.lineHeight,y=w=0,!Le(p)&&!lt(p))y=kd(s,b.data,b.gc,y,p),w=_;else if(lt(p))for(h=0,f=p.length;h<f;++h)v=p[h],!Le(v)&&!lt(v)&&(y=kd(s,b.data,b.gc,y,v),w+=_);a.push(y),o.push(w),c=Math.max(y,c),u=Math.max(w,u)}P$(i,t);const x=a.indexOf(c),k=o.indexOf(u),S=R=>({width:a[R]||0,height:o[R]||0});return{first:S(0),last:S(t-1),widest:S(x),highest:S(k),widths:a,heights:o}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const t=this._startPixel+e*this._length;return hI(this._alignToPixels?Gs(this.chart,t,0):t)}getDecimalForPixel(e){const t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){const t=this.ticks||[];if(e>=0&&e<t.length){const n=t[e];return n.$context||(n.$context=E$(this.getContext(),e,n))}return this.$context||(this.$context=A$(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,t=Xn(this.labelRotation),n=Math.abs(Math.cos(t)),s=Math.abs(Math.sin(t)),i=this._getLabelSizes(),a=e.autoSkipPadding||0,o=i?i.widest.width+a:0,l=i?i.highest.height+a:0;return this.isHorizontal()?l*n>o*s?o/n:l/s:l*s<o*n?l/n:o/s}_isVisible(){const e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const t=this.axis,n=this.chart,s=this.options,{grid:i,position:a,border:o}=s,l=i.offset,c=this.isHorizontal(),d=this.ticks.length+(l?1:0),h=lo(i),f=[],p=o.setContext(this.getContext()),m=p.display?p.width:0,g=m/2,b=function(O){return Gs(n,O,m)};let _,y,w,v,x,k,S,R,D,M,N,C;if(a==="top")_=b(this.bottom),k=this.bottom-h,R=_-g,M=b(e.top)+g,C=e.bottom;else if(a==="bottom")_=b(this.top),M=e.top,C=b(e.bottom)-g,k=_+g,R=this.top+h;else if(a==="left")_=b(this.right),x=this.right-h,S=_-g,D=b(e.left)+g,N=e.right;else if(a==="right")_=b(this.left),D=e.left,N=b(e.right)-g,x=_+g,S=this.left+h;else if(t==="x"){if(a==="center")_=b((e.top+e.bottom)/2+.5);else if(De(a)){const O=Object.keys(a)[0],I=a[O];_=b(this.chart.scales[O].getPixelForValue(I))}M=e.top,C=e.bottom,k=_+g,R=k+h}else if(t==="y"){if(a==="center")_=b((e.left+e.right)/2);else if(De(a)){const O=Object.keys(a)[0],I=a[O];_=b(this.chart.scales[O].getPixelForValue(I))}x=_-g,S=x-h,D=e.left,N=e.right}const A=Se(s.ticks.maxTicksLimit,d),E=Math.max(1,Math.ceil(d/A));for(y=0;y<d;y+=E){const O=this.getContext(y),I=i.setContext(O),T=o.setContext(O),L=I.lineWidth,W=I.color,ee=T.dash||[],Z=T.dashOffset,X=I.tickWidth,U=I.tickColor,G=I.tickBorderDash||[],le=I.tickBorderDashOffset;w=S$(this,y,l),w!==void 0&&(v=Gs(n,w,L),c?x=S=D=N=v:k=R=M=C=v,f.push({tx1:x,ty1:k,tx2:S,ty2:R,x1:D,y1:M,x2:N,y2:C,width:L,color:W,borderDash:ee,borderDashOffset:Z,tickWidth:X,tickColor:U,tickBorderDash:G,tickBorderDashOffset:le}))}return this._ticksLength=d,this._borderValue=_,f}_computeLabelItems(e){const t=this.axis,n=this.options,{position:s,ticks:i}=n,a=this.isHorizontal(),o=this.ticks,{align:l,crossAlign:c,padding:u,mirror:d}=i,h=lo(n.grid),f=h+u,p=d?-u:f,m=-Xn(this.labelRotation),g=[];let b,_,y,w,v,x,k,S,R,D,M,N,C="middle";if(s==="top")x=this.bottom-p,k=this._getXAxisLabelAlignment();else if(s==="bottom")x=this.top+p,k=this._getXAxisLabelAlignment();else if(s==="left"){const E=this._getYAxisLabelAlignment(h);k=E.textAlign,v=E.x}else if(s==="right"){const E=this._getYAxisLabelAlignment(h);k=E.textAlign,v=E.x}else if(t==="x"){if(s==="center")x=(e.top+e.bottom)/2+f;else if(De(s)){const E=Object.keys(s)[0],O=s[E];x=this.chart.scales[E].getPixelForValue(O)+f}k=this._getXAxisLabelAlignment()}else if(t==="y"){if(s==="center")v=(e.left+e.right)/2-f;else if(De(s)){const E=Object.keys(s)[0],O=s[E];v=this.chart.scales[E].getPixelForValue(O)}k=this._getYAxisLabelAlignment(h).textAlign}t==="y"&&(l==="start"?C="top":l==="end"&&(C="bottom"));const A=this._getLabelSizes();for(b=0,_=o.length;b<_;++b){y=o[b],w=y.label;const E=i.setContext(this.getContext(b));S=this.getPixelForTick(b)+i.labelOffset,R=this._resolveTickFontOptions(b),D=R.lineHeight,M=lt(w)?w.length:1;const O=M/2,I=E.color,T=E.textStrokeColor,L=E.textStrokeWidth;let W=k;a?(v=S,k==="inner"&&(b===_-1?W=this.options.reverse?"left":"right":b===0?W=this.options.reverse?"right":"left":W="center"),s==="top"?c==="near"||m!==0?N=-M*D+D/2:c==="center"?N=-A.highest.height/2-O*D+D:N=-A.highest.height+D/2:c==="near"||m!==0?N=D/2:c==="center"?N=A.highest.height/2-O*D:N=A.highest.height-M*D,d&&(N*=-1),m!==0&&!E.showLabelBackdrop&&(v+=D/2*Math.sin(m))):(x=S,N=(1-M)*D/2);let ee;if(E.showLabelBackdrop){const Z=Xt(E.backdropPadding),X=A.heights[b],U=A.widths[b];let G=N-Z.top,le=0-Z.left;switch(C){case"middle":G-=X/2;break;case"bottom":G-=X;break}switch(k){case"center":le-=U/2;break;case"right":le-=U;break;case"inner":b===_-1?le-=U:b>0&&(le-=U/2);break}ee={left:le,top:G,width:U+Z.width,height:X+Z.height,color:E.backdropColor}}g.push({label:w,font:R,textOffset:N,options:{rotation:m,color:I,strokeColor:T,strokeWidth:L,textAlign:W,textBaseline:C,translation:[v,x],backdrop:ee}})}return g}_getXAxisLabelAlignment(){const{position:e,ticks:t}=this.options;if(-Xn(this.labelRotation))return e==="top"?"left":"right";let s="center";return t.align==="start"?s="left":t.align==="end"?s="right":t.align==="inner"&&(s="inner"),s}_getYAxisLabelAlignment(e){const{position:t,ticks:{crossAlign:n,mirror:s,padding:i}}=this.options,a=this._getLabelSizes(),o=e+i,l=a.widest.width;let c,u;return t==="left"?s?(u=this.right+i,n==="near"?c="left":n==="center"?(c="center",u+=l/2):(c="right",u+=l)):(u=this.right-o,n==="near"?c="right":n==="center"?(c="center",u-=l/2):(c="left",u=this.left)):t==="right"?s?(u=this.left+i,n==="near"?c="right":n==="center"?(c="center",u-=l/2):(c="left",u-=l)):(u=this.left+o,n==="near"?c="left":n==="center"?(c="center",u+=l/2):(c="right",u=this.right)):c="right",{textAlign:c,x:u}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,t=this.options.position;if(t==="left"||t==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(t==="top"||t==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){const{ctx:e,options:{backgroundColor:t},left:n,top:s,width:i,height:a}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(n,s,i,a),e.restore())}getLineWidthForValue(e){const t=this.options.grid;if(!this._isVisible()||!t.display)return 0;const s=this.ticks.findIndex(i=>i.value===e);return s>=0?t.setContext(this.getContext(s)).lineWidth:0}drawGrid(e){const t=this.options.grid,n=this.ctx,s=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let i,a;const o=(l,c,u)=>{!u.width||!u.color||(n.save(),n.lineWidth=u.width,n.strokeStyle=u.color,n.setLineDash(u.borderDash||[]),n.lineDashOffset=u.borderDashOffset,n.beginPath(),n.moveTo(l.x,l.y),n.lineTo(c.x,c.y),n.stroke(),n.restore())};if(t.display)for(i=0,a=s.length;i<a;++i){const l=s[i];t.drawOnChartArea&&o({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),t.drawTicks&&o({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:t,options:{border:n,grid:s}}=this,i=n.setContext(this.getContext()),a=n.display?i.width:0;if(!a)return;const o=s.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let c,u,d,h;this.isHorizontal()?(c=Gs(e,this.left,a)-a/2,u=Gs(e,this.right,o)+o/2,d=h=l):(d=Gs(e,this.top,a)-a/2,h=Gs(e,this.bottom,o)+o/2,c=u=l),t.save(),t.lineWidth=i.width,t.strokeStyle=i.color,t.beginPath(),t.moveTo(c,d),t.lineTo(u,h),t.stroke(),t.restore()}drawLabels(e){if(!this.options.ticks.display)return;const n=this.ctx,s=this._computeLabelArea();s&&Ph(n,s);const i=this.getLabelItems(e);for(const a of i){const o=a.options,l=a.font,c=a.label,u=a.textOffset;gi(n,c,0,u,l,o)}s&&Ah(n)}drawTitle(){const{ctx:e,options:{position:t,title:n,reverse:s}}=this;if(!n.display)return;const i=Ot(n.font),a=Xt(n.padding),o=n.align;let l=i.lineHeight/2;t==="bottom"||t==="center"||De(t)?(l+=a.bottom,lt(n.text)&&(l+=i.lineHeight*(n.text.length-1))):l+=a.top;const{titleX:c,titleY:u,maxWidth:d,rotation:h}=T$(this,l,t,o);gi(e,n.text,0,0,i,{color:n.color,maxWidth:d,rotation:h,textAlign:O$(o,t,s),textBaseline:"middle",translation:[c,u]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,t=e.ticks&&e.ticks.z||0,n=Se(e.grid&&e.grid.z,-1),s=Se(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==Ai.prototype.draw?[{z:t,draw:i=>{this.draw(i)}}]:[{z:n,draw:i=>{this.drawBackground(),this.drawGrid(i),this.drawTitle()}},{z:s,draw:()=>{this.drawBorder()}},{z:t,draw:i=>{this.drawLabels(i)}}]}getMatchingVisibleMetas(e){const t=this.chart.getSortedVisibleDatasetMetas(),n=this.axis+"AxisID",s=[];let i,a;for(i=0,a=t.length;i<a;++i){const o=t[i];o[n]===this.id&&(!e||o.type===e)&&s.push(o)}return s}_resolveTickFontOptions(e){const t=this.options.ticks.setContext(this.getContext(e));return Ot(t.font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class iu{constructor(e,t,n){this.type=e,this.scope=t,this.override=n,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const t=Object.getPrototypeOf(e);let n;C$(t)&&(n=this.register(t));const s=this.items,i=e.id,a=this.scope+"."+i;if(!i)throw new Error("class does not have id: "+e);return i in s||(s[i]=e,R$(e,a,n),this.override&&ct.override(e.id,e.overrides)),a}get(e){return this.items[e]}unregister(e){const t=this.items,n=e.id,s=this.scope;n in t&&delete t[n],s&&n in ct[s]&&(delete ct[s][n],this.override&&delete mi[n])}}function R$(r,e,t){const n=gl(Object.create(null),[t?ct.get(t):{},ct.get(e),r.defaults]);ct.set(e,n),r.defaultRoutes&&I$(e,r.defaultRoutes),r.descriptors&&ct.describe(e,r.descriptors)}function I$(r,e){Object.keys(e).forEach(t=>{const n=t.split("."),s=n.pop(),i=[r].concat(n).join("."),a=e[t].split("."),o=a.pop(),l=a.join(".");ct.route(i,s,l,o)})}function C$(r){return"id"in r&&"defaults"in r}class $${constructor(){this.controllers=new iu(nr,"datasets",!0),this.elements=new iu(ns,"elements"),this.plugins=new iu(Object,"plugins"),this.scales=new iu(Ai,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,t,n){[...t].forEach(s=>{const i=n||this._getRegistryForType(s);n||i.isForType(s)||i===this.plugins&&s.id?this._exec(e,i,s):Je(s,a=>{const o=n||this._getRegistryForType(a);this._exec(e,o,a)})})}_exec(e,t,n){const s=Rb(e);nt(n["before"+s],[],n),t[e](n),nt(n["after"+s],[],n)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){const n=this._typedRegistries[t];if(n.isForType(e))return n}return this.plugins}_get(e,t,n){const s=t.get(e);if(s===void 0)throw new Error('"'+e+'" is not a registered '+n+".");return s}}var gr=new $$;class M${constructor(){this._init=[]}notify(e,t,n,s){t==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const i=s?this._descriptors(e).filter(s):this._descriptors(e),a=this._notify(i,e,t,n);return t==="afterDestroy"&&(this._notify(i,e,"stop"),this._notify(this._init,e,"uninstall")),a}_notify(e,t,n,s){s=s||{};for(const i of e){const a=i.plugin,o=a[n],l=[t,s,i.options];if(nt(o,l,a)===!1&&s.cancelable)return!1}return!0}invalidate(){Le(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){const n=e&&e.config,s=Se(n.options&&n.options.plugins,{}),i=N$(n);return s===!1&&!t?[]:j$(e,i,s,t)}_notifyStateChanges(e){const t=this._oldCache||[],n=this._cache,s=(i,a)=>i.filter(o=>!a.some(l=>o.plugin.id===l.plugin.id));this._notify(s(t,n),e,"stop"),this._notify(s(n,t),e,"start")}}function N$(r){const e={},t=[],n=Object.keys(gr.plugins.items);for(let i=0;i<n.length;i++)t.push(gr.getPlugin(n[i]));const s=r.plugins||[];for(let i=0;i<s.length;i++){const a=s[i];t.indexOf(a)===-1&&(t.push(a),e[a.id]=!0)}return{plugins:t,localIds:e}}function L$(r,e){return!e&&r===!1?null:r===!0?{}:r}function j$(r,{plugins:e,localIds:t},n,s){const i=[],a=r.getContext();for(const o of e){const l=o.id,c=L$(n[l],s);c!==null&&i.push({plugin:o,options:D$(r.config,{plugin:o,local:t[l]},c,a)})}return i}function D$(r,{plugin:e,local:t},n,s){const i=r.pluginScopeKeys(e),a=r.getOptionScopes(n,i);return t&&e.defaults&&a.push(e.defaults),r.createResolver(a,s,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function dg(r,e){const t=ct.datasets[r]||{};return((e.datasets||{})[r]||{}).indexAxis||e.indexAxis||t.indexAxis||"x"}function F$(r,e){let t=r;return r==="_index_"?t=e:r==="_value_"&&(t=e==="x"?"y":"x"),t}function z$(r,e){return r===e?"_index_":"_value_"}function Nw(r){if(r==="x"||r==="y"||r==="r")return r}function B$(r){if(r==="top"||r==="bottom")return"x";if(r==="left"||r==="right")return"y"}function hg(r,...e){if(Nw(r))return r;for(const t of e){const n=t.axis||B$(t.position)||r.length>1&&Nw(r[0].toLowerCase());if(n)return n}throw new Error(`Cannot determine type of '${r}' axis. Please provide 'axis' or 'position' option.`)}function Lw(r,e,t){if(t[e+"AxisID"]===r)return{axis:e}}function U$(r,e){if(e.data&&e.data.datasets){const t=e.data.datasets.filter(n=>n.xAxisID===r||n.yAxisID===r);if(t.length)return Lw(r,"x",t[0])||Lw(r,"y",t[0])}return{}}function q$(r,e){const t=mi[r.type]||{scales:{}},n=e.scales||{},s=dg(r.type,e),i=Object.create(null);return Object.keys(n).forEach(a=>{const o=n[a];if(!De(o))return console.error(`Invalid scale configuration for scale: ${a}`);if(o._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${a}`);const l=hg(a,o,U$(a,r),ct.scales[o.type]),c=z$(l,s),u=t.scales||{};i[a]=Xo(Object.create(null),[{axis:l},o,u[l],u[c]])}),r.data.datasets.forEach(a=>{const o=a.type||r.type,l=a.indexAxis||dg(o,e),u=(mi[o]||{}).scales||{};Object.keys(u).forEach(d=>{const h=F$(d,l),f=a[h+"AxisID"]||h;i[f]=i[f]||Object.create(null),Xo(i[f],[{axis:h},n[f],u[d]])})}),Object.keys(i).forEach(a=>{const o=i[a];Xo(o,[ct.scales[o.type],ct.scale])}),i}function JS(r){const e=r.options||(r.options={});e.plugins=Se(e.plugins,{}),e.scales=q$(r,e)}function KS(r){return r=r||{},r.datasets=r.datasets||[],r.labels=r.labels||[],r}function H$(r){return r=r||{},r.data=KS(r.data),JS(r),r}const jw=new Map,XS=new Set;function au(r,e){let t=jw.get(r);return t||(t=e(),jw.set(r,t),XS.add(t)),t}const co=(r,e,t)=>{const n=Ts(e,t);n!==void 0&&r.add(n)};class W${constructor(e){this._config=H$(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=KS(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),JS(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return au(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,t){return au(`${e}.transition.${t}`,()=>[[`datasets.${e}.transitions.${t}`,`transitions.${t}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,t){return au(`${e}-${t}`,()=>[[`datasets.${e}.elements.${t}`,`datasets.${e}`,`elements.${t}`,""]])}pluginScopeKeys(e){const t=e.id,n=this.type;return au(`${n}-plugin-${t}`,()=>[[`plugins.${t}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,t){const n=this._scopeCache;let s=n.get(e);return(!s||t)&&(s=new Map,n.set(e,s)),s}getOptionScopes(e,t,n){const{options:s,type:i}=this,a=this._cachedScopes(e,n),o=a.get(t);if(o)return o;const l=new Set;t.forEach(u=>{e&&(l.add(e),u.forEach(d=>co(l,e,d))),u.forEach(d=>co(l,s,d)),u.forEach(d=>co(l,mi[i]||{},d)),u.forEach(d=>co(l,ct,d)),u.forEach(d=>co(l,lg,d))});const c=Array.from(l);return c.length===0&&c.push(Object.create(null)),XS.has(t)&&a.set(t,c),c}chartOptionScopes(){const{options:e,type:t}=this;return[e,mi[t]||{},ct.datasets[t]||{},{type:t},ct,lg]}resolveNamedOptions(e,t,n,s=[""]){const i={$shared:!0},{resolver:a,subPrefixes:o}=Dw(this._resolverCache,e,s);let l=a;if(G$(a,t)){i.$shared=!1,n=Rs(n)?n():n;const c=this.createResolver(e,n,o);l=Ta(a,n,c)}for(const c of t)i[c]=l[c];return i}createResolver(e,t,n=[""],s){const{resolver:i}=Dw(this._resolverCache,e,n);return De(t)?Ta(i,t,void 0,s):i}}function Dw(r,e,t){let n=r.get(e);n||(n=new Map,r.set(e,n));const s=t.join();let i=n.get(s);return i||(i={resolver:Lb(e,t),subPrefixes:t.filter(o=>!o.toLowerCase().includes("hover"))},n.set(s,i)),i}const V$=r=>De(r)&&Object.getOwnPropertyNames(r).some(e=>Rs(r[e]));function G$(r,e){const{isScriptable:t,isIndexable:n}=TS(r);for(const s of e){const i=t(s),a=n(s),o=(a||i)&&r[s];if(i&&(Rs(o)||V$(o))||a&&lt(o))return!0}return!1}var Z$="4.4.9";const J$=["top","bottom","left","right","chartArea"];function Fw(r,e){return r==="top"||r==="bottom"||J$.indexOf(r)===-1&&e==="x"}function zw(r,e){return function(t,n){return t[r]===n[r]?t[e]-n[e]:t[r]-n[r]}}function Bw(r){const e=r.chart,t=e.options.animation;e.notifyPlugins("afterRender"),nt(t&&t.onComplete,[r],e)}function K$(r){const e=r.chart,t=e.options.animation;nt(t&&t.onProgress,[r],e)}function YS(r){return Fb()&&typeof r=="string"?r=document.getElementById(r):r&&r.length&&(r=r[0]),r&&r.canvas&&(r=r.canvas),r}const ad={},Uw=r=>{const e=YS(r);return Object.values(ad).filter(t=>t.canvas===e).pop()};function X$(r,e,t){const n=Object.keys(r);for(const s of n){const i=+s;if(i>=e){const a=r[s];delete r[s],(t>0||i>e)&&(r[i+t]=a)}}}function Y$(r,e,t,n){return!t||r.type==="mouseout"?null:n?e:r}class Wr{static register(...e){gr.add(...e),qw()}static unregister(...e){gr.remove(...e),qw()}constructor(e,t){const n=this.config=new W$(t),s=YS(e),i=Uw(s);if(i)throw new Error("Canvas is already in use. Chart with ID '"+i.id+"' must be destroyed before the canvas with ID '"+i.canvas.id+"' can be reused.");const a=n.createResolver(n.chartOptionScopes(),this.getContext());this.platform=new(n.platform||g$(s)),this.platform.updateConfig(n);const o=this.platform.acquireContext(s,a.aspectRatio),l=o&&o.canvas,c=l&&l.height,u=l&&l.width;if(this.id=QR(),this.ctx=o,this.canvas=l,this.width=u,this.height=c,this._options=a,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new M$,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=gI(d=>this.update(d),a.resizeDelay||0),this._dataChanges=[],ad[this.id]=this,!o||!l){console.error("Failed to create chart: can't acquire context from the given item");return}Dr.listen(this,"complete",Bw),Dr.listen(this,"progress",K$),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:t},width:n,height:s,_aspectRatio:i}=this;return Le(e)?t&&i?i:s?n/s:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return gr}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():dw(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return lw(this.canvas,this.ctx),this}stop(){return Dr.stop(this),this}resize(e,t){Dr.running(this)?this._resizeBeforeDraw={width:e,height:t}:this._resize(e,t)}_resize(e,t){const n=this.options,s=this.canvas,i=n.maintainAspectRatio&&this.aspectRatio,a=this.platform.getMaximumSize(s,e,t,i),o=n.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=a.width,this.height=a.height,this._aspectRatio=this.aspectRatio,dw(this,o,!0)&&(this.notifyPlugins("resize",{size:a}),nt(n.onResize,[this,a],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const t=this.options.scales||{};Je(t,(n,s)=>{n.id=s})}buildOrUpdateScales(){const e=this.options,t=e.scales,n=this.scales,s=Object.keys(n).reduce((a,o)=>(a[o]=!1,a),{});let i=[];t&&(i=i.concat(Object.keys(t).map(a=>{const o=t[a],l=hg(a,o),c=l==="r",u=l==="x";return{options:o,dposition:c?"chartArea":u?"bottom":"left",dtype:c?"radialLinear":u?"category":"linear"}}))),Je(i,a=>{const o=a.options,l=o.id,c=hg(l,o),u=Se(o.type,a.dtype);(o.position===void 0||Fw(o.position,c)!==Fw(a.dposition))&&(o.position=a.dposition),s[l]=!0;let d=null;if(l in n&&n[l].type===u)d=n[l];else{const h=gr.getScale(u);d=new h({id:l,type:u,ctx:this.ctx,chart:this}),n[d.id]=d}d.init(o,e)}),Je(s,(a,o)=>{a||delete n[o]}),Je(n,a=>{Kt.configure(this,a,a.options),Kt.addBox(this,a)})}_updateMetasets(){const e=this._metasets,t=this.data.datasets.length,n=e.length;if(e.sort((s,i)=>s.index-i.index),n>t){for(let s=t;s<n;++s)this._destroyDatasetMeta(s);e.splice(t,n-t)}this._sortedMetasets=e.slice(0).sort(zw("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:t}}=this;e.length>t.length&&delete this._stacks,e.forEach((n,s)=>{t.filter(i=>i===n._dataset).length===0&&this._destroyDatasetMeta(s)})}buildOrUpdateControllers(){const e=[],t=this.data.datasets;let n,s;for(this._removeUnreferencedMetasets(),n=0,s=t.length;n<s;n++){const i=t[n];let a=this.getDatasetMeta(n);const o=i.type||this.config.type;if(a.type&&a.type!==o&&(this._destroyDatasetMeta(n),a=this.getDatasetMeta(n)),a.type=o,a.indexAxis=i.indexAxis||dg(o,this.options),a.order=i.order||0,a.index=n,a.label=""+i.label,a.visible=this.isDatasetVisible(n),a.controller)a.controller.updateIndex(n),a.controller.linkScales();else{const l=gr.getController(o),{datasetElementType:c,dataElementType:u}=ct.datasets[o];Object.assign(l,{dataElementType:gr.getElement(u),datasetElementType:c&&gr.getElement(c)}),a.controller=new l(this,n),e.push(a.controller)}}return this._updateMetasets(),e}_resetElements(){Je(this.data.datasets,(e,t)=>{this.getDatasetMeta(t).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const t=this.config;t.update();const n=this._options=t.createResolver(t.chartOptionScopes(),this.getContext()),s=this._animationsDisabled=!n.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;const i=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let a=0;for(let c=0,u=this.data.datasets.length;c<u;c++){const{controller:d}=this.getDatasetMeta(c),h=!s&&i.indexOf(d)===-1;d.buildOrUpdateElements(h),a=Math.max(+d.getMaxOverflow(),a)}a=this._minPadding=n.layout.autoPadding?a:0,this._updateLayout(a),s||Je(i,c=>{c.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(zw("z","_idx"));const{_active:o,_lastEvent:l}=this;l?this._eventHandler(l,!0):o.length&&this._updateHoverStyles(o,o,!0),this.render()}_updateScales(){Je(this.scales,e=>{Kt.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,t=new Set(Object.keys(this._listeners)),n=new Set(e.events);(!Qy(t,n)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,t=this._getUniformDataChanges()||[];for(const{method:n,start:s,count:i}of t){const a=n==="_removeElements"?-i:i;X$(e,s,a)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const t=this.data.datasets.length,n=i=>new Set(e.filter(a=>a[0]===i).map((a,o)=>o+","+a.splice(1).join(","))),s=n(0);for(let i=1;i<t;i++)if(!Qy(s,n(i)))return;return Array.from(s).map(i=>i.split(",")).map(i=>({method:i[1],start:+i[2],count:+i[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Kt.update(this,this.width,this.height,e);const t=this.chartArea,n=t.width<=0||t.height<=0;this._layers=[],Je(this.boxes,s=>{n&&s.position==="chartArea"||(s.configure&&s.configure(),this._layers.push(...s._layers()))},this),this._layers.forEach((s,i)=>{s._idx=i}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let t=0,n=this.data.datasets.length;t<n;++t)this.getDatasetMeta(t).controller.configure();for(let t=0,n=this.data.datasets.length;t<n;++t)this._updateDataset(t,Rs(e)?e({datasetIndex:t}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,t){const n=this.getDatasetMeta(e),s={meta:n,index:e,mode:t,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",s)!==!1&&(n.controller._update(t),s.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",s))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Dr.has(this)?this.attached&&!Dr.running(this)&&Dr.start(this):(this.draw(),Bw({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:n,height:s}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(n,s)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const t=this._layers;for(e=0;e<t.length&&t[e].z<=0;++e)t[e].draw(this.chartArea);for(this._drawDatasets();e<t.length;++e)t[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const t=this._sortedMetasets,n=[];let s,i;for(s=0,i=t.length;s<i;++s){const a=t[s];(!e||a.visible)&&n.push(a)}return n}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const e=this.getSortedVisibleDatasetMetas();for(let t=e.length-1;t>=0;--t)this._drawDataset(e[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const t=this.ctx,n={meta:e,index:e.index,cancelable:!0},s=zS(this,e);this.notifyPlugins("beforeDatasetDraw",n)!==!1&&(s&&Ph(t,s),e.controller.draw(),s&&Ah(t),n.cancelable=!1,this.notifyPlugins("afterDatasetDraw",n))}isPointInArea(e){return Yr(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,t,n,s){const i=JC.modes[t];return typeof i=="function"?i(this,e,n,s):[]}getDatasetMeta(e){const t=this.data.datasets[e],n=this._metasets;let s=n.filter(i=>i&&i._dataset===t).pop();return s||(s={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:e,_dataset:t,_parsed:[],_sorted:!1},n.push(s)),s}getContext(){return this.$context||(this.$context=Fs(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const t=this.data.datasets[e];if(!t)return!1;const n=this.getDatasetMeta(e);return typeof n.hidden=="boolean"?!n.hidden:!t.hidden}setDatasetVisibility(e,t){const n=this.getDatasetMeta(e);n.hidden=!t}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,t,n){const s=n?"show":"hide",i=this.getDatasetMeta(e),a=i.controller._resolveAnimations(void 0,s);bl(t)?(i.data[t].hidden=!n,this.update()):(this.setDatasetVisibility(e,n),a.update(i,{visible:n}),this.update(o=>o.datasetIndex===e?s:void 0))}hide(e,t){this._updateVisibility(e,t,!1)}show(e,t){this._updateVisibility(e,t,!0)}_destroyDatasetMeta(e){const t=this._metasets[e];t&&t.controller&&t.controller._destroy(),delete this._metasets[e]}_stop(){let e,t;for(this.stop(),Dr.remove(this),e=0,t=this.data.datasets.length;e<t;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:t}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),lw(e,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),delete ad[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,t=this.platform,n=(i,a)=>{t.addEventListener(this,i,a),e[i]=a},s=(i,a,o)=>{i.offsetX=a,i.offsetY=o,this._eventHandler(i)};Je(this.options.events,i=>n(i,s))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,t=this.platform,n=(l,c)=>{t.addEventListener(this,l,c),e[l]=c},s=(l,c)=>{e[l]&&(t.removeEventListener(this,l,c),delete e[l])},i=(l,c)=>{this.canvas&&this.resize(l,c)};let a;const o=()=>{s("attach",o),this.attached=!0,this.resize(),n("resize",i),n("detach",a)};a=()=>{this.attached=!1,s("resize",i),this._stop(),this._resize(0,0),n("attach",o)},t.isAttached(this.canvas)?o():a()}unbindEvents(){Je(this._listeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._listeners={},Je(this._responsiveListeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,t,n){const s=n?"set":"remove";let i,a,o,l;for(t==="dataset"&&(i=this.getDatasetMeta(e[0].datasetIndex),i.controller["_"+s+"DatasetHoverStyle"]()),o=0,l=e.length;o<l;++o){a=e[o];const c=a&&this.getDatasetMeta(a.datasetIndex).controller;c&&c[s+"HoverStyle"](a.element,a.datasetIndex,a.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const t=this._active||[],n=e.map(({datasetIndex:i,index:a})=>{const o=this.getDatasetMeta(i);if(!o)throw new Error("No dataset found at index "+i);return{datasetIndex:i,element:o.data[a],index:a}});!wd(n,t)&&(this._active=n,this._lastEvent=null,this._updateHoverStyles(n,t))}notifyPlugins(e,t,n){return this._plugins.notify(this,e,t,n)}isPluginEnabled(e){return this._plugins._cache.filter(t=>t.plugin.id===e).length===1}_updateHoverStyles(e,t,n){const s=this.options.hover,i=(l,c)=>l.filter(u=>!c.some(d=>u.datasetIndex===d.datasetIndex&&u.index===d.index)),a=i(t,e),o=n?e:i(e,t);a.length&&this.updateHoverStyle(a,s.mode,!1),o.length&&s.mode&&this.updateHoverStyle(o,s.mode,!0)}_eventHandler(e,t){const n={event:e,replay:t,cancelable:!0,inChartArea:this.isPointInArea(e)},s=a=>(a.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",n,s)===!1)return;const i=this._handleEvent(e,t,n.inChartArea);return n.cancelable=!1,this.notifyPlugins("afterEvent",n,s),(i||n.changed)&&this.render(),this}_handleEvent(e,t,n){const{_active:s=[],options:i}=this,a=t,o=this._getActiveElements(e,s,n,a),l=iI(e),c=Y$(e,this._lastEvent,n,l);n&&(this._lastEvent=null,nt(i.onHover,[e,o,this],this),l&&nt(i.onClick,[e,o,this],this));const u=!wd(o,s);return(u||t)&&(this._active=o,this._updateHoverStyles(o,s,t)),this._lastEvent=c,u}_getActiveElements(e,t,n,s){if(e.type==="mouseout")return[];if(!n)return t;const i=this.options.hover;return this.getElementsAtEventForMode(e,i.mode,i,s)}}$(Wr,"defaults",ct),$(Wr,"instances",ad),$(Wr,"overrides",mi),$(Wr,"registry",gr),$(Wr,"version",Z$),$(Wr,"getChart",Uw);function qw(){return Je(Wr.instances,r=>r._plugins.invalidate())}function Q$(r,e,t){const{startAngle:n,pixelMargin:s,x:i,y:a,outerRadius:o,innerRadius:l}=e;let c=s/o;r.beginPath(),r.arc(i,a,o,n-c,t+c),l>s?(c=s/l,r.arc(i,a,l,t+c,n-c,!0)):r.arc(i,a,s,t+wt,n-wt),r.closePath(),r.clip()}function eM(r){return Nb(r,["outerStart","outerEnd","innerStart","innerEnd"])}function tM(r,e,t,n){const s=eM(r.options.borderRadius),i=(t-e)/2,a=Math.min(i,n*e/2),o=l=>{const c=(t-Math.min(i,l))*n/2;return Lt(l,0,Math.min(i,c))};return{outerStart:o(s.outerStart),outerEnd:o(s.outerEnd),innerStart:Lt(s.innerStart,0,a),innerEnd:Lt(s.innerEnd,0,a)}}function Ni(r,e,t,n){return{x:t+r*Math.cos(e),y:n+r*Math.sin(e)}}function Ad(r,e,t,n,s,i){const{x:a,y:o,startAngle:l,pixelMargin:c,innerRadius:u}=e,d=Math.max(e.outerRadius+n+t-c,0),h=u>0?u+n+t+c:0;let f=0;const p=s-l;if(n){const E=u>0?u-n:0,O=d>0?d-n:0,I=(E+O)/2,T=I!==0?p*I/(I+n):p;f=(p-T)/2}const m=Math.max(.001,p*d-t/it)/d,g=(p-m)/2,b=l+g+f,_=s-g-f,{outerStart:y,outerEnd:w,innerStart:v,innerEnd:x}=tM(e,h,d,_-b),k=d-y,S=d-w,R=b+y/k,D=_-w/S,M=h+v,N=h+x,C=b+v/M,A=_-x/N;if(r.beginPath(),i){const E=(R+D)/2;if(r.arc(a,o,d,R,E),r.arc(a,o,d,E,D),w>0){const L=Ni(S,D,a,o);r.arc(L.x,L.y,w,D,_+wt)}const O=Ni(N,_,a,o);if(r.lineTo(O.x,O.y),x>0){const L=Ni(N,A,a,o);r.arc(L.x,L.y,x,_+wt,A+Math.PI)}const I=(_-x/h+(b+v/h))/2;if(r.arc(a,o,h,_-x/h,I,!0),r.arc(a,o,h,I,b+v/h,!0),v>0){const L=Ni(M,C,a,o);r.arc(L.x,L.y,v,C+Math.PI,b-wt)}const T=Ni(k,b,a,o);if(r.lineTo(T.x,T.y),y>0){const L=Ni(k,R,a,o);r.arc(L.x,L.y,y,b-wt,R)}}else{r.moveTo(a,o);const E=Math.cos(R)*d+a,O=Math.sin(R)*d+o;r.lineTo(E,O);const I=Math.cos(D)*d+a,T=Math.sin(D)*d+o;r.lineTo(I,T)}r.closePath()}function nM(r,e,t,n,s){const{fullCircles:i,startAngle:a,circumference:o}=e;let l=e.endAngle;if(i){Ad(r,e,t,n,l,s);for(let c=0;c<i;++c)r.fill();isNaN(o)||(l=a+(o%st||st))}return Ad(r,e,t,n,l,s),r.fill(),l}function rM(r,e,t,n,s){const{fullCircles:i,startAngle:a,circumference:o,options:l}=e,{borderWidth:c,borderJoinStyle:u,borderDash:d,borderDashOffset:h}=l,f=l.borderAlign==="inner";if(!c)return;r.setLineDash(d||[]),r.lineDashOffset=h,f?(r.lineWidth=c*2,r.lineJoin=u||"round"):(r.lineWidth=c,r.lineJoin=u||"bevel");let p=e.endAngle;if(i){Ad(r,e,t,n,p,s);for(let m=0;m<i;++m)r.stroke();isNaN(o)||(p=a+(o%st||st))}f&&Q$(r,e,p),i||(Ad(r,e,t,n,p,s),r.stroke())}class No extends ns{constructor(t){super();$(this,"circumference");$(this,"endAngle");$(this,"fullCircles");$(this,"innerRadius");$(this,"outerRadius");$(this,"pixelMargin");$(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,t&&Object.assign(this,t)}inRange(t,n,s){const i=this.getProps(["x","y"],s),{angle:a,distance:o}=yS(i,{x:t,y:n}),{startAngle:l,endAngle:c,innerRadius:u,outerRadius:d,circumference:h}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],s),f=(this.options.spacing+this.options.borderWidth)/2,p=Se(h,c-l),m=_l(a,l,c)&&l!==c,g=p>=st||m,b=Kr(o,u+f,d+f);return g&&b}getCenterPoint(t){const{x:n,y:s,startAngle:i,endAngle:a,innerRadius:o,outerRadius:l}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],t),{offset:c,spacing:u}=this.options,d=(i+a)/2,h=(o+l+u+c)/2;return{x:n+Math.cos(d)*h,y:s+Math.sin(d)*h}}tooltipPosition(t){return this.getCenterPoint(t)}draw(t){const{options:n,circumference:s}=this,i=(n.offset||0)/4,a=(n.spacing||0)/2,o=n.circular;if(this.pixelMargin=n.borderAlign==="inner"?.33:0,this.fullCircles=s>st?Math.floor(s/st):0,s===0||this.innerRadius<0||this.outerRadius<0)return;t.save();const l=(this.startAngle+this.endAngle)/2;t.translate(Math.cos(l)*i,Math.sin(l)*i);const c=1-Math.sin(Math.min(it,s||0)),u=i*c;t.fillStyle=n.backgroundColor,t.strokeStyle=n.borderColor,nM(t,this,u,a,o),rM(t,this,u,a,o),t.restore()}}$(No,"id","arc"),$(No,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),$(No,"defaultRoutes",{backgroundColor:"backgroundColor"}),$(No,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"});function QS(r,e,t=e){r.lineCap=Se(t.borderCapStyle,e.borderCapStyle),r.setLineDash(Se(t.borderDash,e.borderDash)),r.lineDashOffset=Se(t.borderDashOffset,e.borderDashOffset),r.lineJoin=Se(t.borderJoinStyle,e.borderJoinStyle),r.lineWidth=Se(t.borderWidth,e.borderWidth),r.strokeStyle=Se(t.borderColor,e.borderColor)}function sM(r,e,t){r.lineTo(t.x,t.y)}function iM(r){return r.stepped?OI:r.tension||r.cubicInterpolationMode==="monotone"?TI:sM}function e1(r,e,t={}){const n=r.length,{start:s=0,end:i=n-1}=t,{start:a,end:o}=e,l=Math.max(s,a),c=Math.min(i,o),u=s<a&&i<a||s>o&&i>o;return{count:n,start:l,loop:e.loop,ilen:c<l&&!u?n+c-l:c-l}}function aM(r,e,t,n){const{points:s,options:i}=e,{count:a,start:o,loop:l,ilen:c}=e1(s,t,n),u=iM(i);let{move:d=!0,reverse:h}=n||{},f,p,m;for(f=0;f<=c;++f)p=s[(o+(h?c-f:f))%a],!p.skip&&(d?(r.moveTo(p.x,p.y),d=!1):u(r,m,p,h,i.stepped),m=p);return l&&(p=s[(o+(h?c:0))%a],u(r,m,p,h,i.stepped)),!!l}function oM(r,e,t,n){const s=e.points,{count:i,start:a,ilen:o}=e1(s,t,n),{move:l=!0,reverse:c}=n||{};let u=0,d=0,h,f,p,m,g,b;const _=w=>(a+(c?o-w:w))%i,y=()=>{m!==g&&(r.lineTo(u,g),r.lineTo(u,m),r.lineTo(u,b))};for(l&&(f=s[_(0)],r.moveTo(f.x,f.y)),h=0;h<=o;++h){if(f=s[_(h)],f.skip)continue;const w=f.x,v=f.y,x=w|0;x===p?(v<m?m=v:v>g&&(g=v),u=(d*u+w)/++d):(y(),r.lineTo(w,v),p=x,d=0,m=g=v),b=v}y()}function fg(r){const e=r.options,t=e.borderDash&&e.borderDash.length;return!r._decimated&&!r._loop&&!e.tension&&e.cubicInterpolationMode!=="monotone"&&!e.stepped&&!t?oM:aM}function lM(r){return r.stepped?oC:r.tension||r.cubicInterpolationMode==="monotone"?lC:ei}function cM(r,e,t,n){let s=e._path;s||(s=e._path=new Path2D,e.path(s,t,n)&&s.closePath()),QS(r,e.options),r.stroke(s)}function uM(r,e,t,n){const{segments:s,options:i}=e,a=fg(e);for(const o of s)QS(r,i,o.style),r.beginPath(),a(r,e,o,{start:t,end:t+n-1})&&r.closePath(),r.stroke()}const dM=typeof Path2D=="function";function hM(r,e,t,n){dM&&!e.options.segment?cM(r,e,t,n):uM(r,e,t,n)}class ks extends ns{constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,t){const n=this.options;if((n.tension||n.cubicInterpolationMode==="monotone")&&!n.stepped&&!this._pointsUpdated){const s=n.spanGaps?this._loop:this._fullLoop;QI(this._points,n,e,s,t),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=pC(this,this.options.segment))}first(){const e=this.segments,t=this.points;return e.length&&t[e[0].start]}last(){const e=this.segments,t=this.points,n=e.length;return n&&t[e[n-1].end]}interpolate(e,t){const n=this.options,s=e[t],i=this.points,a=FS(this,{property:t,start:s,end:s});if(!a.length)return;const o=[],l=lM(n);let c,u;for(c=0,u=a.length;c<u;++c){const{start:d,end:h}=a[c],f=i[d],p=i[h];if(f===p){o.push(f);continue}const m=Math.abs((s-f[t])/(p[t]-f[t])),g=l(f,p,m,n.stepped);g[t]=e[t],o.push(g)}return o.length===1?o[0]:o}pathSegment(e,t,n){return fg(this)(e,this,t,n)}path(e,t,n){const s=this.segments,i=fg(this);let a=this._loop;t=t||0,n=n||this.points.length-t;for(const o of s)a&=i(e,this,o,{start:t,end:t+n-1});return!!a}draw(e,t,n,s){const i=this.options||{};(this.points||[]).length&&i.borderWidth&&(e.save(),hM(e,this,n,s),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}$(ks,"id","line"),$(ks,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),$(ks,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),$(ks,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"&&e!=="fill"});function Hw(r,e,t,n){const s=r.options,{[t]:i}=r.getProps([t],n);return Math.abs(e-i)<s.radius+s.hitRadius}class od extends ns{constructor(t){super();$(this,"parsed");$(this,"skip");$(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,n,s){const i=this.options,{x:a,y:o}=this.getProps(["x","y"],s);return Math.pow(t-a,2)+Math.pow(n-o,2)<Math.pow(i.hitRadius+i.radius,2)}inXRange(t,n){return Hw(this,t,"x",n)}inYRange(t,n){return Hw(this,t,"y",n)}getCenterPoint(t){const{x:n,y:s}=this.getProps(["x","y"],t);return{x:n,y:s}}size(t){t=t||this.options||{};let n=t.radius||0;n=Math.max(n,n&&t.hoverRadius||0);const s=n&&t.borderWidth||0;return(n+s)*2}draw(t,n){const s=this.options;this.skip||s.radius<.1||!Yr(this,n,this.size(s)/2)||(t.strokeStyle=s.borderColor,t.lineWidth=s.borderWidth,t.fillStyle=s.backgroundColor,cg(t,s,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}$(od,"id","point"),$(od,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),$(od,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function t1(r,e){const{x:t,y:n,base:s,width:i,height:a}=r.getProps(["x","y","base","width","height"],e);let o,l,c,u,d;return r.horizontal?(d=a/2,o=Math.min(t,s),l=Math.max(t,s),c=n-d,u=n+d):(d=i/2,o=t-d,l=t+d,c=Math.min(n,s),u=Math.max(n,s)),{left:o,top:c,right:l,bottom:u}}function Ss(r,e,t,n){return r?0:Lt(e,t,n)}function fM(r,e,t){const n=r.options.borderWidth,s=r.borderSkipped,i=OS(n);return{t:Ss(s.top,i.top,0,t),r:Ss(s.right,i.right,0,e),b:Ss(s.bottom,i.bottom,0,t),l:Ss(s.left,i.left,0,e)}}function pM(r,e,t){const{enableBorderRadius:n}=r.getProps(["enableBorderRadius"]),s=r.options.borderRadius,i=ci(s),a=Math.min(e,t),o=r.borderSkipped,l=n||De(s);return{topLeft:Ss(!l||o.top||o.left,i.topLeft,0,a),topRight:Ss(!l||o.top||o.right,i.topRight,0,a),bottomLeft:Ss(!l||o.bottom||o.left,i.bottomLeft,0,a),bottomRight:Ss(!l||o.bottom||o.right,i.bottomRight,0,a)}}function mM(r){const e=t1(r),t=e.right-e.left,n=e.bottom-e.top,s=fM(r,t/2,n/2),i=pM(r,t/2,n/2);return{outer:{x:e.left,y:e.top,w:t,h:n,radius:i},inner:{x:e.left+s.l,y:e.top+s.t,w:t-s.l-s.r,h:n-s.t-s.b,radius:{topLeft:Math.max(0,i.topLeft-Math.max(s.t,s.l)),topRight:Math.max(0,i.topRight-Math.max(s.t,s.r)),bottomLeft:Math.max(0,i.bottomLeft-Math.max(s.b,s.l)),bottomRight:Math.max(0,i.bottomRight-Math.max(s.b,s.r))}}}}function Vf(r,e,t,n){const s=e===null,i=t===null,o=r&&!(s&&i)&&t1(r,n);return o&&(s||Kr(e,o.left,o.right))&&(i||Kr(t,o.top,o.bottom))}function gM(r){return r.topLeft||r.topRight||r.bottomLeft||r.bottomRight}function bM(r,e){r.rect(e.x,e.y,e.w,e.h)}function Gf(r,e,t={}){const n=r.x!==t.x?-e:0,s=r.y!==t.y?-e:0,i=(r.x+r.w!==t.x+t.w?e:0)-n,a=(r.y+r.h!==t.y+t.h?e:0)-s;return{x:r.x+n,y:r.y+s,w:r.w+i,h:r.h+a,radius:r.radius}}class ld extends ns{constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:t,options:{borderColor:n,backgroundColor:s}}=this,{inner:i,outer:a}=mM(this),o=gM(a.radius)?yl:bM;e.save(),(a.w!==i.w||a.h!==i.h)&&(e.beginPath(),o(e,Gf(a,t,i)),e.clip(),o(e,Gf(i,-t,a)),e.fillStyle=n,e.fill("evenodd")),e.beginPath(),o(e,Gf(i,t)),e.fillStyle=s,e.fill(),e.restore()}inRange(e,t,n){return Vf(this,e,t,n)}inXRange(e,t){return Vf(this,e,null,t)}inYRange(e,t){return Vf(this,null,e,t)}getCenterPoint(e){const{x:t,y:n,base:s,horizontal:i}=this.getProps(["x","y","base","horizontal"],e);return{x:i?(t+s)/2:t,y:i?n:(n+s)/2}}getRange(e){return e==="x"?this.width/2:this.height/2}}$(ld,"id","bar"),$(ld,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),$(ld,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var _M=Object.freeze({__proto__:null,ArcElement:No,BarElement:ld,LineElement:ks,PointElement:od});const pg=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],Ww=pg.map(r=>r.replace("rgb(","rgba(").replace(")",", 0.5)"));function n1(r){return pg[r%pg.length]}function r1(r){return Ww[r%Ww.length]}function yM(r,e){return r.borderColor=n1(e),r.backgroundColor=r1(e),++e}function wM(r,e){return r.backgroundColor=r.data.map(()=>n1(e++)),e}function vM(r,e){return r.backgroundColor=r.data.map(()=>r1(e++)),e}function xM(r){let e=0;return(t,n)=>{const s=r.getDatasetMeta(n).controller;s instanceof ri?e=wM(t,e):s instanceof tl?e=vM(t,e):s&&(e=yM(t,e))}}function Vw(r){let e;for(e in r)if(r[e].borderColor||r[e].backgroundColor)return!0;return!1}function kM(r){return r&&(r.borderColor||r.backgroundColor)}function SM(){return ct.borderColor!=="rgba(0,0,0,0.1)"||ct.backgroundColor!=="rgba(0,0,0,0.1)"}var PM={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(r,e,t){if(!t.enabled)return;const{data:{datasets:n},options:s}=r.config,{elements:i}=s,a=Vw(n)||kM(s)||i&&Vw(i)||SM();if(!t.forceOverride&&a)return;const o=xM(r);n.forEach(o)}};function AM(r,e,t,n,s){const i=s.samples||n;if(i>=t)return r.slice(e,e+t);const a=[],o=(t-2)/(i-2);let l=0;const c=e+t-1;let u=e,d,h,f,p,m;for(a[l++]=r[u],d=0;d<i-2;d++){let g=0,b=0,_;const y=Math.floor((d+1)*o)+1+e,w=Math.min(Math.floor((d+2)*o)+1,t)+e,v=w-y;for(_=y;_<w;_++)g+=r[_].x,b+=r[_].y;g/=v,b/=v;const x=Math.floor(d*o)+1+e,k=Math.min(Math.floor((d+1)*o)+1,t)+e,{x:S,y:R}=r[u];for(f=p=-1,_=x;_<k;_++)p=.5*Math.abs((S-g)*(r[_].y-R)-(S-r[_].x)*(b-R)),p>f&&(f=p,h=r[_],m=_);a[l++]=h,u=m}return a[l++]=r[c],a}function EM(r,e,t,n){let s=0,i=0,a,o,l,c,u,d,h,f,p,m;const g=[],b=e+t-1,_=r[e].x,w=r[b].x-_;for(a=e;a<e+t;++a){o=r[a],l=(o.x-_)/w*n,c=o.y;const v=l|0;if(v===u)c<p?(p=c,d=a):c>m&&(m=c,h=a),s=(i*s+o.x)/++i;else{const x=a-1;if(!Le(d)&&!Le(h)){const k=Math.min(d,h),S=Math.max(d,h);k!==f&&k!==x&&g.push({...r[k],x:s}),S!==f&&S!==x&&g.push({...r[S],x:s})}a>0&&x!==f&&g.push(r[x]),g.push(o),u=v,i=0,p=m=c,d=h=f=a}}return g}function s1(r){if(r._decimated){const e=r._data;delete r._decimated,delete r._data,Object.defineProperty(r,"data",{configurable:!0,enumerable:!0,writable:!0,value:e})}}function Gw(r){r.data.datasets.forEach(e=>{s1(e)})}function OM(r,e){const t=e.length;let n=0,s;const{iScale:i}=r,{min:a,max:o,minDefined:l,maxDefined:c}=i.getUserBounds();return l&&(n=Lt(Xr(e,i.axis,a).lo,0,t-1)),c?s=Lt(Xr(e,i.axis,o).hi+1,n,t)-n:s=t-n,{start:n,count:s}}var TM={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(r,e,t)=>{if(!t.enabled){Gw(r);return}const n=r.width;r.data.datasets.forEach((s,i)=>{const{_data:a,indexAxis:o}=s,l=r.getDatasetMeta(i),c=a||s.data;if($o([o,r.options.indexAxis])==="y"||!l.controller.supportsDecimation)return;const u=r.scales[l.xAxisID];if(u.type!=="linear"&&u.type!=="time"||r.options.parsing)return;let{start:d,count:h}=OM(l,c);const f=t.threshold||4*n;if(h<=f){s1(s);return}Le(a)&&(s._data=c,delete s.data,Object.defineProperty(s,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(m){this._data=m}}));let p;switch(t.algorithm){case"lttb":p=AM(c,d,h,n,t);break;case"min-max":p=EM(c,d,h,n);break;default:throw new Error(`Unsupported decimation algorithm '${t.algorithm}'`)}s._decimated=p})},destroy(r){Gw(r)}};function RM(r,e,t){const n=r.segments,s=r.points,i=e.points,a=[];for(const o of n){let{start:l,end:c}=o;c=Ub(l,c,s);const u=mg(t,s[l],s[c],o.loop);if(!e.segments){a.push({source:o,target:u,start:s[l],end:s[c]});continue}const d=FS(e,u);for(const h of d){const f=mg(t,i[h.start],i[h.end],h.loop),p=DS(o,s,f);for(const m of p)a.push({source:m,target:h,start:{[t]:Zw(u,f,"start",Math.max)},end:{[t]:Zw(u,f,"end",Math.min)}})}}return a}function mg(r,e,t,n){if(n)return;let s=e[r],i=t[r];return r==="angle"&&(s=Tn(s),i=Tn(i)),{property:r,start:s,end:i}}function IM(r,e){const{x:t=null,y:n=null}=r||{},s=e.points,i=[];return e.segments.forEach(({start:a,end:o})=>{o=Ub(a,o,s);const l=s[a],c=s[o];n!==null?(i.push({x:l.x,y:n}),i.push({x:c.x,y:n})):t!==null&&(i.push({x:t,y:l.y}),i.push({x:t,y:c.y}))}),i}function Ub(r,e,t){for(;e>r;e--){const n=t[e];if(!isNaN(n.x)&&!isNaN(n.y))break}return e}function Zw(r,e,t,n){return r&&e?n(r[t],e[t]):r?r[t]:e?e[t]:0}function i1(r,e){let t=[],n=!1;return lt(r)?(n=!0,t=r):t=IM(r,e),t.length?new ks({points:t,options:{tension:0},_loop:n,_fullLoop:n}):null}function Jw(r){return r&&r.fill!==!1}function CM(r,e,t){let s=r[e].fill;const i=[e];let a;if(!t)return s;for(;s!==!1&&i.indexOf(s)===-1;){if(!gt(s))return s;if(a=r[s],!a)return!1;if(a.visible)return s;i.push(s),s=a.fill}return!1}function $M(r,e,t){const n=jM(r);if(De(n))return isNaN(n.value)?!1:n;let s=parseFloat(n);return gt(s)&&Math.floor(s)===s?MM(n[0],e,s,t):["origin","start","end","stack","shape"].indexOf(n)>=0&&n}function MM(r,e,t,n){return(r==="-"||r==="+")&&(t=e+t),t===e||t<0||t>=n?!1:t}function NM(r,e){let t=null;return r==="start"?t=e.bottom:r==="end"?t=e.top:De(r)?t=e.getPixelForValue(r.value):e.getBasePixel&&(t=e.getBasePixel()),t}function LM(r,e,t){let n;return r==="start"?n=t:r==="end"?n=e.options.reverse?e.min:e.max:De(r)?n=r.value:n=e.getBaseValue(),n}function jM(r){const e=r.options,t=e.fill;let n=Se(t&&t.target,t);return n===void 0&&(n=!!e.backgroundColor),n===!1||n===null?!1:n===!0?"origin":n}function DM(r){const{scale:e,index:t,line:n}=r,s=[],i=n.segments,a=n.points,o=FM(e,t);o.push(i1({x:null,y:e.bottom},n));for(let l=0;l<i.length;l++){const c=i[l];for(let u=c.start;u<=c.end;u++)zM(s,a[u],o)}return new ks({points:s,options:{}})}function FM(r,e){const t=[],n=r.getMatchingVisibleMetas("line");for(let s=0;s<n.length;s++){const i=n[s];if(i.index===e)break;i.hidden||t.unshift(i.dataset)}return t}function zM(r,e,t){const n=[];for(let s=0;s<t.length;s++){const i=t[s],{first:a,last:o,point:l}=BM(i,e,"x");if(!(!l||a&&o)){if(a)n.unshift(l);else if(r.push(l),!o)break}}r.push(...n)}function BM(r,e,t){const n=r.interpolate(e,t);if(!n)return{};const s=n[t],i=r.segments,a=r.points;let o=!1,l=!1;for(let c=0;c<i.length;c++){const u=i[c],d=a[u.start][t],h=a[u.end][t];if(Kr(s,d,h)){o=s===d,l=s===h;break}}return{first:o,last:l,point:n}}class a1{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,t,n){const{x:s,y:i,radius:a}=this;return t=t||{start:0,end:st},e.arc(s,i,a,t.end,t.start,!0),!n.bounds}interpolate(e){const{x:t,y:n,radius:s}=this,i=e.angle;return{x:t+Math.cos(i)*s,y:n+Math.sin(i)*s,angle:i}}}function UM(r){const{chart:e,fill:t,line:n}=r;if(gt(t))return qM(e,t);if(t==="stack")return DM(r);if(t==="shape")return!0;const s=HM(r);return s instanceof a1?s:i1(s,n)}function qM(r,e){const t=r.getDatasetMeta(e);return t&&r.isDatasetVisible(e)?t.dataset:null}function HM(r){return(r.scale||{}).getPointPositionForValue?VM(r):WM(r)}function WM(r){const{scale:e={},fill:t}=r,n=NM(t,e);if(gt(n)){const s=e.isHorizontal();return{x:s?n:null,y:s?null:n}}return null}function VM(r){const{scale:e,fill:t}=r,n=e.options,s=e.getLabels().length,i=n.reverse?e.max:e.min,a=LM(t,e,i),o=[];if(n.grid.circular){const l=e.getPointPositionForValue(0,i);return new a1({x:l.x,y:l.y,radius:e.getDistanceFromCenterForValue(a)})}for(let l=0;l<s;++l)o.push(e.getPointPositionForValue(l,a));return o}function Zf(r,e,t){const n=UM(e),{chart:s,index:i,line:a,scale:o,axis:l}=e,c=a.options,u=c.fill,d=c.backgroundColor,{above:h=d,below:f=d}=u||{},p=s.getDatasetMeta(i),m=zS(s,p);n&&a.points.length&&(Ph(r,t),GM(r,{line:a,target:n,above:h,below:f,area:t,scale:o,axis:l,clip:m}),Ah(r))}function GM(r,e){const{line:t,target:n,above:s,below:i,area:a,scale:o,clip:l}=e,c=t._loop?"angle":e.axis;r.save(),c==="x"&&i!==s&&(Kw(r,n,a.top),Xw(r,{line:t,target:n,color:s,scale:o,property:c,clip:l}),r.restore(),r.save(),Kw(r,n,a.bottom)),Xw(r,{line:t,target:n,color:i,scale:o,property:c,clip:l}),r.restore()}function Kw(r,e,t){const{segments:n,points:s}=e;let i=!0,a=!1;r.beginPath();for(const o of n){const{start:l,end:c}=o,u=s[l],d=s[Ub(l,c,s)];i?(r.moveTo(u.x,u.y),i=!1):(r.lineTo(u.x,t),r.lineTo(u.x,u.y)),a=!!e.pathSegment(r,o,{move:a}),a?r.closePath():r.lineTo(d.x,t)}r.lineTo(e.first().x,t),r.closePath(),r.clip()}function Xw(r,e){const{line:t,target:n,property:s,color:i,scale:a,clip:o}=e,l=RM(t,n,s);for(const{source:c,target:u,start:d,end:h}of l){const{style:{backgroundColor:f=i}={}}=c,p=n!==!0;r.save(),r.fillStyle=f,ZM(r,a,o,p&&mg(s,d,h)),r.beginPath();const m=!!t.pathSegment(r,c);let g;if(p){m?r.closePath():Yw(r,n,h,s);const b=!!n.pathSegment(r,u,{move:m,reverse:!0});g=m&&b,g||Yw(r,n,d,s)}r.closePath(),r.fill(g?"evenodd":"nonzero"),r.restore()}}function ZM(r,e,t,n){const s=e.chart.chartArea,{property:i,start:a,end:o}=n||{};if(i==="x"||i==="y"){let l,c,u,d;i==="x"?(l=a,c=s.top,u=o,d=s.bottom):(l=s.left,c=a,u=s.right,d=o),r.beginPath(),t&&(l=Math.max(l,t.left),u=Math.min(u,t.right),c=Math.max(c,t.top),d=Math.min(d,t.bottom)),r.rect(l,c,u-l,d-c),r.clip()}}function Yw(r,e,t,n){const s=e.interpolate(t,n);s&&r.lineTo(s.x,s.y)}var JM={id:"filler",afterDatasetsUpdate(r,e,t){const n=(r.data.datasets||[]).length,s=[];let i,a,o,l;for(a=0;a<n;++a)i=r.getDatasetMeta(a),o=i.dataset,l=null,o&&o.options&&o instanceof ks&&(l={visible:r.isDatasetVisible(a),index:a,fill:$M(o,a,n),chart:r,axis:i.controller.options.indexAxis,scale:i.vScale,line:o}),i.$filler=l,s.push(l);for(a=0;a<n;++a)l=s[a],!(!l||l.fill===!1)&&(l.fill=CM(s,a,t.propagate))},beforeDraw(r,e,t){const n=t.drawTime==="beforeDraw",s=r.getSortedVisibleDatasetMetas(),i=r.chartArea;for(let a=s.length-1;a>=0;--a){const o=s[a].$filler;o&&(o.line.updateControlPoints(i,o.axis),n&&o.fill&&Zf(r.ctx,o,i))}},beforeDatasetsDraw(r,e,t){if(t.drawTime!=="beforeDatasetsDraw")return;const n=r.getSortedVisibleDatasetMetas();for(let s=n.length-1;s>=0;--s){const i=n[s].$filler;Jw(i)&&Zf(r.ctx,i,r.chartArea)}},beforeDatasetDraw(r,e,t){const n=e.meta.$filler;!Jw(n)||t.drawTime!=="beforeDatasetDraw"||Zf(r.ctx,n,r.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const Qw=(r,e)=>{let{boxHeight:t=e,boxWidth:n=e}=r;return r.usePointStyle&&(t=Math.min(t,e),n=r.pointStyleWidth||Math.min(n,e)),{boxWidth:n,boxHeight:t,itemHeight:Math.max(e,t)}},KM=(r,e)=>r!==null&&e!==null&&r.datasetIndex===e.datasetIndex&&r.index===e.index;class ev extends ns{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,n){this.maxWidth=e,this.maxHeight=t,this._margins=n,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let t=nt(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter(n=>e.filter(n,this.chart.data))),e.sort&&(t=t.sort((n,s)=>e.sort(n,s,this.chart.data))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){const{options:e,ctx:t}=this;if(!e.display){this.width=this.height=0;return}const n=e.labels,s=Ot(n.font),i=s.size,a=this._computeTitleHeight(),{boxWidth:o,itemHeight:l}=Qw(n,i);let c,u;t.font=s.string,this.isHorizontal()?(c=this.maxWidth,u=this._fitRows(a,i,o,l)+10):(u=this.maxHeight,c=this._fitCols(a,s,o,l)+10),this.width=Math.min(c,e.maxWidth||this.maxWidth),this.height=Math.min(u,e.maxHeight||this.maxHeight)}_fitRows(e,t,n,s){const{ctx:i,maxWidth:a,options:{labels:{padding:o}}}=this,l=this.legendHitBoxes=[],c=this.lineWidths=[0],u=s+o;let d=e;i.textAlign="left",i.textBaseline="middle";let h=-1,f=-u;return this.legendItems.forEach((p,m)=>{const g=n+t/2+i.measureText(p.text).width;(m===0||c[c.length-1]+g+2*o>a)&&(d+=u,c[c.length-(m>0?0:1)]=0,f+=u,h++),l[m]={left:0,top:f,row:h,width:g,height:s},c[c.length-1]+=g+o}),d}_fitCols(e,t,n,s){const{ctx:i,maxHeight:a,options:{labels:{padding:o}}}=this,l=this.legendHitBoxes=[],c=this.columnSizes=[],u=a-e;let d=o,h=0,f=0,p=0,m=0;return this.legendItems.forEach((g,b)=>{const{itemWidth:_,itemHeight:y}=XM(n,t,i,g,s);b>0&&f+y+2*o>u&&(d+=h+o,c.push({width:h,height:f}),p+=h+o,m++,h=f=0),l[b]={left:p,top:f,col:m,width:_,height:y},h=Math.max(h,_),f+=y+o}),d+=h,c.push({width:h,height:f}),d}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:n,labels:{padding:s},rtl:i}}=this,a=ca(i,this.left,this.width);if(this.isHorizontal()){let o=0,l=Zt(n,this.left+s,this.right-this.lineWidths[o]);for(const c of t)o!==c.row&&(o=c.row,l=Zt(n,this.left+s,this.right-this.lineWidths[o])),c.top+=this.top+e+s,c.left=a.leftForLtr(a.x(l),c.width),l+=c.width+s}else{let o=0,l=Zt(n,this.top+e+s,this.bottom-this.columnSizes[o].height);for(const c of t)c.col!==o&&(o=c.col,l=Zt(n,this.top+e+s,this.bottom-this.columnSizes[o].height)),c.top=l,c.left+=this.left+s,c.left=a.leftForLtr(a.x(c.left),c.width),l+=c.height+s}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const e=this.ctx;Ph(e,this),this._draw(),Ah(e)}}_draw(){const{options:e,columnSizes:t,lineWidths:n,ctx:s}=this,{align:i,labels:a}=e,o=ct.color,l=ca(e.rtl,this.left,this.width),c=Ot(a.font),{padding:u}=a,d=c.size,h=d/2;let f;this.drawTitle(),s.textAlign=l.textAlign("left"),s.textBaseline="middle",s.lineWidth=.5,s.font=c.string;const{boxWidth:p,boxHeight:m,itemHeight:g}=Qw(a,d),b=function(x,k,S){if(isNaN(p)||p<=0||isNaN(m)||m<0)return;s.save();const R=Se(S.lineWidth,1);if(s.fillStyle=Se(S.fillStyle,o),s.lineCap=Se(S.lineCap,"butt"),s.lineDashOffset=Se(S.lineDashOffset,0),s.lineJoin=Se(S.lineJoin,"miter"),s.lineWidth=R,s.strokeStyle=Se(S.strokeStyle,o),s.setLineDash(Se(S.lineDash,[])),a.usePointStyle){const D={radius:m*Math.SQRT2/2,pointStyle:S.pointStyle,rotation:S.rotation,borderWidth:R},M=l.xPlus(x,p/2),N=k+h;ES(s,D,M,N,a.pointStyleWidth&&p)}else{const D=k+Math.max((d-m)/2,0),M=l.leftForLtr(x,p),N=ci(S.borderRadius);s.beginPath(),Object.values(N).some(C=>C!==0)?yl(s,{x:M,y:D,w:p,h:m,radius:N}):s.rect(M,D,p,m),s.fill(),R!==0&&s.stroke()}s.restore()},_=function(x,k,S){gi(s,S.text,x,k+g/2,c,{strikethrough:S.hidden,textAlign:l.textAlign(S.textAlign)})},y=this.isHorizontal(),w=this._computeTitleHeight();y?f={x:Zt(i,this.left+u,this.right-n[0]),y:this.top+u+w,line:0}:f={x:this.left+u,y:Zt(i,this.top+w+u,this.bottom-t[0].height),line:0},NS(this.ctx,e.textDirection);const v=g+u;this.legendItems.forEach((x,k)=>{s.strokeStyle=x.fontColor,s.fillStyle=x.fontColor;const S=s.measureText(x.text).width,R=l.textAlign(x.textAlign||(x.textAlign=a.textAlign)),D=p+h+S;let M=f.x,N=f.y;l.setWidth(this.width),y?k>0&&M+D+u>this.right&&(N=f.y+=v,f.line++,M=f.x=Zt(i,this.left+u,this.right-n[f.line])):k>0&&N+v>this.bottom&&(M=f.x=M+t[f.line].width+u,f.line++,N=f.y=Zt(i,this.top+w+u,this.bottom-t[f.line].height));const C=l.x(M);if(b(C,N,x),M=bI(R,M+p+h,y?M+D:this.right,e.rtl),_(l.x(M),N,x),y)f.x+=D+u;else if(typeof x.text!="string"){const A=c.lineHeight;f.y+=o1(x,A)+u}else f.y+=v}),LS(this.ctx,e.textDirection)}drawTitle(){const e=this.options,t=e.title,n=Ot(t.font),s=Xt(t.padding);if(!t.display)return;const i=ca(e.rtl,this.left,this.width),a=this.ctx,o=t.position,l=n.size/2,c=s.top+l;let u,d=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),u=this.top+c,d=Zt(e.align,d,this.right-h);else{const p=this.columnSizes.reduce((m,g)=>Math.max(m,g.height),0);u=c+Zt(e.align,this.top,this.bottom-p-e.labels.padding-this._computeTitleHeight())}const f=Zt(o,d,d+h);a.textAlign=i.textAlign($b(o)),a.textBaseline="middle",a.strokeStyle=t.color,a.fillStyle=t.color,a.font=n.string,gi(a,t.text,f,u,n)}_computeTitleHeight(){const e=this.options.title,t=Ot(e.font),n=Xt(e.padding);return e.display?t.lineHeight+n.height:0}_getLegendItemAt(e,t){let n,s,i;if(Kr(e,this.left,this.right)&&Kr(t,this.top,this.bottom)){for(i=this.legendHitBoxes,n=0;n<i.length;++n)if(s=i[n],Kr(e,s.left,s.left+s.width)&&Kr(t,s.top,s.top+s.height))return this.legendItems[n]}return null}handleEvent(e){const t=this.options;if(!eN(e.type,t))return;const n=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){const s=this._hoveredItem,i=KM(s,n);s&&!i&&nt(t.onLeave,[e,s,this],this),this._hoveredItem=n,n&&!i&&nt(t.onHover,[e,n,this],this)}else n&&nt(t.onClick,[e,n,this],this)}}function XM(r,e,t,n,s){const i=YM(n,r,e,t),a=QM(s,n,e.lineHeight);return{itemWidth:i,itemHeight:a}}function YM(r,e,t,n){let s=r.text;return s&&typeof s!="string"&&(s=s.reduce((i,a)=>i.length>a.length?i:a)),e+t.size/2+n.measureText(s).width}function QM(r,e,t){let n=r;return typeof e.text!="string"&&(n=o1(e,t)),n}function o1(r,e){const t=r.text?r.text.length:0;return e*t}function eN(r,e){return!!((r==="mousemove"||r==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(r==="click"||r==="mouseup"))}var tN={id:"legend",_element:ev,start(r,e,t){const n=r.legend=new ev({ctx:r.ctx,options:t,chart:r});Kt.configure(r,n,t),Kt.addBox(r,n)},stop(r){Kt.removeBox(r,r.legend),delete r.legend},beforeUpdate(r,e,t){const n=r.legend;Kt.configure(r,n,t),n.options=t},afterUpdate(r){const e=r.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(r,e){e.replay||r.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(r,e,t){const n=e.datasetIndex,s=t.chart;s.isDatasetVisible(n)?(s.hide(n),e.hidden=!0):(s.show(n),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:r=>r.chart.options.color,boxWidth:40,padding:10,generateLabels(r){const e=r.data.datasets,{labels:{usePointStyle:t,pointStyle:n,textAlign:s,color:i,useBorderRadius:a,borderRadius:o}}=r.legend.options;return r._getSortedDatasetMetas().map(l=>{const c=l.controller.getStyle(t?0:void 0),u=Xt(c.borderWidth);return{text:e[l.index].label,fillStyle:c.backgroundColor,fontColor:i,hidden:!l.visible,lineCap:c.borderCapStyle,lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:(u.width+u.height)/4,strokeStyle:c.borderColor,pointStyle:n||c.pointStyle,rotation:c.rotation,textAlign:s||c.textAlign,borderRadius:a&&(o||c.borderRadius),datasetIndex:l.index}},this)}},title:{color:r=>r.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:r=>!r.startsWith("on"),labels:{_scriptable:r=>!["generateLabels","filter","sort"].includes(r)}}};class qb extends ns{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t){const n=this.options;if(this.left=0,this.top=0,!n.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=e,this.height=this.bottom=t;const s=lt(n.text)?n.text.length:1;this._padding=Xt(n.padding);const i=s*Ot(n.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=i:this.width=i}isHorizontal(){const e=this.options.position;return e==="top"||e==="bottom"}_drawArgs(e){const{top:t,left:n,bottom:s,right:i,options:a}=this,o=a.align;let l=0,c,u,d;return this.isHorizontal()?(u=Zt(o,n,i),d=t+e,c=i-n):(a.position==="left"?(u=n+e,d=Zt(o,s,t),l=it*-.5):(u=i-e,d=Zt(o,t,s),l=it*.5),c=s-t),{titleX:u,titleY:d,maxWidth:c,rotation:l}}draw(){const e=this.ctx,t=this.options;if(!t.display)return;const n=Ot(t.font),i=n.lineHeight/2+this._padding.top,{titleX:a,titleY:o,maxWidth:l,rotation:c}=this._drawArgs(i);gi(e,t.text,0,0,n,{color:t.color,maxWidth:l,rotation:c,textAlign:$b(t.align),textBaseline:"middle",translation:[a,o]})}}function nN(r,e){const t=new qb({ctx:r.ctx,options:e,chart:r});Kt.configure(r,t,e),Kt.addBox(r,t),r.titleBlock=t}var rN={id:"title",_element:qb,start(r,e,t){nN(r,t)},stop(r){const e=r.titleBlock;Kt.removeBox(r,e),delete r.titleBlock},beforeUpdate(r,e,t){const n=r.titleBlock;Kt.configure(r,n,t),n.options=t},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const ou=new WeakMap;var sN={id:"subtitle",start(r,e,t){const n=new qb({ctx:r.ctx,options:t,chart:r});Kt.configure(r,n,t),Kt.addBox(r,n),ou.set(r,n)},stop(r){Kt.removeBox(r,ou.get(r)),ou.delete(r)},beforeUpdate(r,e,t){const n=ou.get(r);Kt.configure(r,n,t),n.options=t},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Lo={average(r){if(!r.length)return!1;let e,t,n=new Set,s=0,i=0;for(e=0,t=r.length;e<t;++e){const o=r[e].element;if(o&&o.hasValue()){const l=o.tooltipPosition();n.add(l.x),s+=l.y,++i}}return i===0||n.size===0?!1:{x:[...n].reduce((o,l)=>o+l)/n.size,y:s/i}},nearest(r,e){if(!r.length)return!1;let t=e.x,n=e.y,s=Number.POSITIVE_INFINITY,i,a,o;for(i=0,a=r.length;i<a;++i){const l=r[i].element;if(l&&l.hasValue()){const c=l.getCenterPoint(),u=og(e,c);u<s&&(s=u,o=l)}}if(o){const l=o.tooltipPosition();t=l.x,n=l.y}return{x:t,y:n}}};function pr(r,e){return e&&(lt(e)?Array.prototype.push.apply(r,e):r.push(e)),r}function Fr(r){return(typeof r=="string"||r instanceof String)&&r.indexOf(`
`)>-1?r.split(`
`):r}function iN(r,e){const{element:t,datasetIndex:n,index:s}=e,i=r.getDatasetMeta(n).controller,{label:a,value:o}=i.getLabelAndValue(s);return{chart:r,label:a,parsed:i.getParsed(s),raw:r.data.datasets[n].data[s],formattedValue:o,dataset:i.getDataset(),dataIndex:s,datasetIndex:n,element:t}}function tv(r,e){const t=r.chart.ctx,{body:n,footer:s,title:i}=r,{boxWidth:a,boxHeight:o}=e,l=Ot(e.bodyFont),c=Ot(e.titleFont),u=Ot(e.footerFont),d=i.length,h=s.length,f=n.length,p=Xt(e.padding);let m=p.height,g=0,b=n.reduce((w,v)=>w+v.before.length+v.lines.length+v.after.length,0);if(b+=r.beforeBody.length+r.afterBody.length,d&&(m+=d*c.lineHeight+(d-1)*e.titleSpacing+e.titleMarginBottom),b){const w=e.displayColors?Math.max(o,l.lineHeight):l.lineHeight;m+=f*w+(b-f)*l.lineHeight+(b-1)*e.bodySpacing}h&&(m+=e.footerMarginTop+h*u.lineHeight+(h-1)*e.footerSpacing);let _=0;const y=function(w){g=Math.max(g,t.measureText(w).width+_)};return t.save(),t.font=c.string,Je(r.title,y),t.font=l.string,Je(r.beforeBody.concat(r.afterBody),y),_=e.displayColors?a+2+e.boxPadding:0,Je(n,w=>{Je(w.before,y),Je(w.lines,y),Je(w.after,y)}),_=0,t.font=u.string,Je(r.footer,y),t.restore(),g+=p.width,{width:g,height:m}}function aN(r,e){const{y:t,height:n}=e;return t<n/2?"top":t>r.height-n/2?"bottom":"center"}function oN(r,e,t,n){const{x:s,width:i}=n,a=t.caretSize+t.caretPadding;if(r==="left"&&s+i+a>e.width||r==="right"&&s-i-a<0)return!0}function lN(r,e,t,n){const{x:s,width:i}=t,{width:a,chartArea:{left:o,right:l}}=r;let c="center";return n==="center"?c=s<=(o+l)/2?"left":"right":s<=i/2?c="left":s>=a-i/2&&(c="right"),oN(c,r,e,t)&&(c="center"),c}function nv(r,e,t){const n=t.yAlign||e.yAlign||aN(r,t);return{xAlign:t.xAlign||e.xAlign||lN(r,e,t,n),yAlign:n}}function cN(r,e){let{x:t,width:n}=r;return e==="right"?t-=n:e==="center"&&(t-=n/2),t}function uN(r,e,t){let{y:n,height:s}=r;return e==="top"?n+=t:e==="bottom"?n-=s+t:n-=s/2,n}function rv(r,e,t,n){const{caretSize:s,caretPadding:i,cornerRadius:a}=r,{xAlign:o,yAlign:l}=t,c=s+i,{topLeft:u,topRight:d,bottomLeft:h,bottomRight:f}=ci(a);let p=cN(e,o);const m=uN(e,l,c);return l==="center"?o==="left"?p+=c:o==="right"&&(p-=c):o==="left"?p-=Math.max(u,h)+s:o==="right"&&(p+=Math.max(d,f)+s),{x:Lt(p,0,n.width-e.width),y:Lt(m,0,n.height-e.height)}}function lu(r,e,t){const n=Xt(t.padding);return e==="center"?r.x+r.width/2:e==="right"?r.x+r.width-n.right:r.x+n.left}function sv(r){return pr([],Fr(r))}function dN(r,e,t){return Fs(r,{tooltip:e,tooltipItems:t,type:"tooltip"})}function iv(r,e){const t=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return t?r.override(t):r}const l1={beforeTitle:$r,title(r){if(r.length>0){const e=r[0],t=e.chart.data.labels,n=t?t.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(n>0&&e.dataIndex<n)return t[e.dataIndex]}return""},afterTitle:$r,beforeBody:$r,beforeLabel:$r,label(r){if(this&&this.options&&this.options.mode==="dataset")return r.label+": "+r.formattedValue||r.formattedValue;let e=r.dataset.label||"";e&&(e+=": ");const t=r.formattedValue;return Le(t)||(e+=t),e},labelColor(r){const t=r.chart.getDatasetMeta(r.datasetIndex).controller.getStyle(r.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(r){const t=r.chart.getDatasetMeta(r.datasetIndex).controller.getStyle(r.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:$r,afterBody:$r,beforeFooter:$r,footer:$r,afterFooter:$r};function hn(r,e,t,n){const s=r[e].call(t,n);return typeof s>"u"?l1[e].call(t,n):s}class gg extends ns{constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const t=this.chart,n=this.options.setContext(this.getContext()),s=n.enabled&&t.options.animation&&n.animations,i=new BS(this.chart,s);return s._cacheable&&(this._cachedAnimations=Object.freeze(i)),i}getContext(){return this.$context||(this.$context=dN(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,t){const{callbacks:n}=t,s=hn(n,"beforeTitle",this,e),i=hn(n,"title",this,e),a=hn(n,"afterTitle",this,e);let o=[];return o=pr(o,Fr(s)),o=pr(o,Fr(i)),o=pr(o,Fr(a)),o}getBeforeBody(e,t){return sv(hn(t.callbacks,"beforeBody",this,e))}getBody(e,t){const{callbacks:n}=t,s=[];return Je(e,i=>{const a={before:[],lines:[],after:[]},o=iv(n,i);pr(a.before,Fr(hn(o,"beforeLabel",this,i))),pr(a.lines,hn(o,"label",this,i)),pr(a.after,Fr(hn(o,"afterLabel",this,i))),s.push(a)}),s}getAfterBody(e,t){return sv(hn(t.callbacks,"afterBody",this,e))}getFooter(e,t){const{callbacks:n}=t,s=hn(n,"beforeFooter",this,e),i=hn(n,"footer",this,e),a=hn(n,"afterFooter",this,e);let o=[];return o=pr(o,Fr(s)),o=pr(o,Fr(i)),o=pr(o,Fr(a)),o}_createItems(e){const t=this._active,n=this.chart.data,s=[],i=[],a=[];let o=[],l,c;for(l=0,c=t.length;l<c;++l)o.push(iN(this.chart,t[l]));return e.filter&&(o=o.filter((u,d,h)=>e.filter(u,d,h,n))),e.itemSort&&(o=o.sort((u,d)=>e.itemSort(u,d,n))),Je(o,u=>{const d=iv(e.callbacks,u);s.push(hn(d,"labelColor",this,u)),i.push(hn(d,"labelPointStyle",this,u)),a.push(hn(d,"labelTextColor",this,u))}),this.labelColors=s,this.labelPointStyles=i,this.labelTextColors=a,this.dataPoints=o,o}update(e,t){const n=this.options.setContext(this.getContext()),s=this._active;let i,a=[];if(!s.length)this.opacity!==0&&(i={opacity:0});else{const o=Lo[n.position].call(this,s,this._eventPosition);a=this._createItems(n),this.title=this.getTitle(a,n),this.beforeBody=this.getBeforeBody(a,n),this.body=this.getBody(a,n),this.afterBody=this.getAfterBody(a,n),this.footer=this.getFooter(a,n);const l=this._size=tv(this,n),c=Object.assign({},o,l),u=nv(this.chart,n,c),d=rv(n,c,u,this.chart);this.xAlign=u.xAlign,this.yAlign=u.yAlign,i={opacity:1,x:d.x,y:d.y,width:l.width,height:l.height,caretX:o.x,caretY:o.y}}this._tooltipItems=a,this.$context=void 0,i&&this._resolveAnimations().update(this,i),e&&n.external&&n.external.call(this,{chart:this.chart,tooltip:this,replay:t})}drawCaret(e,t,n,s){const i=this.getCaretPosition(e,n,s);t.lineTo(i.x1,i.y1),t.lineTo(i.x2,i.y2),t.lineTo(i.x3,i.y3)}getCaretPosition(e,t,n){const{xAlign:s,yAlign:i}=this,{caretSize:a,cornerRadius:o}=n,{topLeft:l,topRight:c,bottomLeft:u,bottomRight:d}=ci(o),{x:h,y:f}=e,{width:p,height:m}=t;let g,b,_,y,w,v;return i==="center"?(w=f+m/2,s==="left"?(g=h,b=g-a,y=w+a,v=w-a):(g=h+p,b=g+a,y=w-a,v=w+a),_=g):(s==="left"?b=h+Math.max(l,u)+a:s==="right"?b=h+p-Math.max(c,d)-a:b=this.caretX,i==="top"?(y=f,w=y-a,g=b-a,_=b+a):(y=f+m,w=y+a,g=b+a,_=b-a),v=y),{x1:g,x2:b,x3:_,y1:y,y2:w,y3:v}}drawTitle(e,t,n){const s=this.title,i=s.length;let a,o,l;if(i){const c=ca(n.rtl,this.x,this.width);for(e.x=lu(this,n.titleAlign,n),t.textAlign=c.textAlign(n.titleAlign),t.textBaseline="middle",a=Ot(n.titleFont),o=n.titleSpacing,t.fillStyle=n.titleColor,t.font=a.string,l=0;l<i;++l)t.fillText(s[l],c.x(e.x),e.y+a.lineHeight/2),e.y+=a.lineHeight+o,l+1===i&&(e.y+=n.titleMarginBottom-o)}}_drawColorBox(e,t,n,s,i){const a=this.labelColors[n],o=this.labelPointStyles[n],{boxHeight:l,boxWidth:c}=i,u=Ot(i.bodyFont),d=lu(this,"left",i),h=s.x(d),f=l<u.lineHeight?(u.lineHeight-l)/2:0,p=t.y+f;if(i.usePointStyle){const m={radius:Math.min(c,l)/2,pointStyle:o.pointStyle,rotation:o.rotation,borderWidth:1},g=s.leftForLtr(h,c)+c/2,b=p+l/2;e.strokeStyle=i.multiKeyBackground,e.fillStyle=i.multiKeyBackground,cg(e,m,g,b),e.strokeStyle=a.borderColor,e.fillStyle=a.backgroundColor,cg(e,m,g,b)}else{e.lineWidth=De(a.borderWidth)?Math.max(...Object.values(a.borderWidth)):a.borderWidth||1,e.strokeStyle=a.borderColor,e.setLineDash(a.borderDash||[]),e.lineDashOffset=a.borderDashOffset||0;const m=s.leftForLtr(h,c),g=s.leftForLtr(s.xPlus(h,1),c-2),b=ci(a.borderRadius);Object.values(b).some(_=>_!==0)?(e.beginPath(),e.fillStyle=i.multiKeyBackground,yl(e,{x:m,y:p,w:c,h:l,radius:b}),e.fill(),e.stroke(),e.fillStyle=a.backgroundColor,e.beginPath(),yl(e,{x:g,y:p+1,w:c-2,h:l-2,radius:b}),e.fill()):(e.fillStyle=i.multiKeyBackground,e.fillRect(m,p,c,l),e.strokeRect(m,p,c,l),e.fillStyle=a.backgroundColor,e.fillRect(g,p+1,c-2,l-2))}e.fillStyle=this.labelTextColors[n]}drawBody(e,t,n){const{body:s}=this,{bodySpacing:i,bodyAlign:a,displayColors:o,boxHeight:l,boxWidth:c,boxPadding:u}=n,d=Ot(n.bodyFont);let h=d.lineHeight,f=0;const p=ca(n.rtl,this.x,this.width),m=function(S){t.fillText(S,p.x(e.x+f),e.y+h/2),e.y+=h+i},g=p.textAlign(a);let b,_,y,w,v,x,k;for(t.textAlign=a,t.textBaseline="middle",t.font=d.string,e.x=lu(this,g,n),t.fillStyle=n.bodyColor,Je(this.beforeBody,m),f=o&&g!=="right"?a==="center"?c/2+u:c+2+u:0,w=0,x=s.length;w<x;++w){for(b=s[w],_=this.labelTextColors[w],t.fillStyle=_,Je(b.before,m),y=b.lines,o&&y.length&&(this._drawColorBox(t,e,w,p,n),h=Math.max(d.lineHeight,l)),v=0,k=y.length;v<k;++v)m(y[v]),h=d.lineHeight;Je(b.after,m)}f=0,h=d.lineHeight,Je(this.afterBody,m),e.y-=i}drawFooter(e,t,n){const s=this.footer,i=s.length;let a,o;if(i){const l=ca(n.rtl,this.x,this.width);for(e.x=lu(this,n.footerAlign,n),e.y+=n.footerMarginTop,t.textAlign=l.textAlign(n.footerAlign),t.textBaseline="middle",a=Ot(n.footerFont),t.fillStyle=n.footerColor,t.font=a.string,o=0;o<i;++o)t.fillText(s[o],l.x(e.x),e.y+a.lineHeight/2),e.y+=a.lineHeight+n.footerSpacing}}drawBackground(e,t,n,s){const{xAlign:i,yAlign:a}=this,{x:o,y:l}=e,{width:c,height:u}=n,{topLeft:d,topRight:h,bottomLeft:f,bottomRight:p}=ci(s.cornerRadius);t.fillStyle=s.backgroundColor,t.strokeStyle=s.borderColor,t.lineWidth=s.borderWidth,t.beginPath(),t.moveTo(o+d,l),a==="top"&&this.drawCaret(e,t,n,s),t.lineTo(o+c-h,l),t.quadraticCurveTo(o+c,l,o+c,l+h),a==="center"&&i==="right"&&this.drawCaret(e,t,n,s),t.lineTo(o+c,l+u-p),t.quadraticCurveTo(o+c,l+u,o+c-p,l+u),a==="bottom"&&this.drawCaret(e,t,n,s),t.lineTo(o+f,l+u),t.quadraticCurveTo(o,l+u,o,l+u-f),a==="center"&&i==="left"&&this.drawCaret(e,t,n,s),t.lineTo(o,l+d),t.quadraticCurveTo(o,l,o+d,l),t.closePath(),t.fill(),s.borderWidth>0&&t.stroke()}_updateAnimationTarget(e){const t=this.chart,n=this.$animations,s=n&&n.x,i=n&&n.y;if(s||i){const a=Lo[e.position].call(this,this._active,this._eventPosition);if(!a)return;const o=this._size=tv(this,e),l=Object.assign({},a,this._size),c=nv(t,e,l),u=rv(e,l,c,t);(s._to!==u.x||i._to!==u.y)&&(this.xAlign=c.xAlign,this.yAlign=c.yAlign,this.width=o.width,this.height=o.height,this.caretX=a.x,this.caretY=a.y,this._resolveAnimations().update(this,u))}}_willRender(){return!!this.opacity}draw(e){const t=this.options.setContext(this.getContext());let n=this.opacity;if(!n)return;this._updateAnimationTarget(t);const s={width:this.width,height:this.height},i={x:this.x,y:this.y};n=Math.abs(n)<.001?0:n;const a=Xt(t.padding),o=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;t.enabled&&o&&(e.save(),e.globalAlpha=n,this.drawBackground(i,e,s,t),NS(e,t.textDirection),i.y+=a.top,this.drawTitle(i,e,t),this.drawBody(i,e,t),this.drawFooter(i,e,t),LS(e,t.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,t){const n=this._active,s=e.map(({datasetIndex:o,index:l})=>{const c=this.chart.getDatasetMeta(o);if(!c)throw new Error("Cannot find a dataset at index "+o);return{datasetIndex:o,element:c.data[l],index:l}}),i=!wd(n,s),a=this._positionChanged(s,t);(i||a)&&(this._active=s,this._eventPosition=t,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,t,n=!0){if(t&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const s=this.options,i=this._active||[],a=this._getActiveElements(e,i,t,n),o=this._positionChanged(a,e),l=t||!wd(a,i)||o;return l&&(this._active=a,(s.enabled||s.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,t))),l}_getActiveElements(e,t,n,s){const i=this.options;if(e.type==="mouseout")return[];if(!s)return t.filter(o=>this.chart.data.datasets[o.datasetIndex]&&this.chart.getDatasetMeta(o.datasetIndex).controller.getParsed(o.index)!==void 0);const a=this.chart.getElementsAtEventForMode(e,i.mode,i,n);return i.reverse&&a.reverse(),a}_positionChanged(e,t){const{caretX:n,caretY:s,options:i}=this,a=Lo[i.position].call(this,e,t);return a!==!1&&(n!==a.x||s!==a.y)}}$(gg,"positioners",Lo);var hN={id:"tooltip",_element:gg,positioners:Lo,afterInit(r,e,t){t&&(r.tooltip=new gg({chart:r,options:t}))},beforeUpdate(r,e,t){r.tooltip&&r.tooltip.initialize(t)},reset(r,e,t){r.tooltip&&r.tooltip.initialize(t)},afterDraw(r){const e=r.tooltip;if(e&&e._willRender()){const t={tooltip:e};if(r.notifyPlugins("beforeTooltipDraw",{...t,cancelable:!0})===!1)return;e.draw(r.ctx),r.notifyPlugins("afterTooltipDraw",t)}},afterEvent(r,e){if(r.tooltip){const t=e.replay;r.tooltip.handleEvent(e.event,t,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(r,e)=>e.bodyFont.size,boxWidth:(r,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:l1},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:r=>r!=="filter"&&r!=="itemSort"&&r!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},fN=Object.freeze({__proto__:null,Colors:PM,Decimation:TM,Filler:JM,Legend:tN,SubTitle:sN,Title:rN,Tooltip:hN});const pN=(r,e,t,n)=>(typeof e=="string"?(t=r.push(e)-1,n.unshift({index:t,label:e})):isNaN(e)&&(t=null),t);function mN(r,e,t,n){const s=r.indexOf(e);if(s===-1)return pN(r,e,t,n);const i=r.lastIndexOf(e);return s!==i?t:s}const gN=(r,e)=>r===null?null:Lt(Math.round(r),0,e);function av(r){const e=this.getLabels();return r>=0&&r<e.length?e[r]:r}class bg extends Ai{constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const t=this._addedLabels;if(t.length){const n=this.getLabels();for(const{index:s,label:i}of t)n[s]===i&&n.splice(s,1);this._addedLabels=[]}super.init(e)}parse(e,t){if(Le(e))return null;const n=this.getLabels();return t=isFinite(t)&&n[t]===e?t:mN(n,e,Se(t,e),this._addedLabels),gN(t,n.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let{min:n,max:s}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(n=0),t||(s=this.getLabels().length-1)),this.min=n,this.max=s}buildTicks(){const e=this.min,t=this.max,n=this.options.offset,s=[];let i=this.getLabels();i=e===0&&t===i.length-1?i:i.slice(e,t+1),this._valueRange=Math.max(i.length-(n?0:1),1),this._startValue=this.min-(n?.5:0);for(let a=e;a<=t;a++)s.push({value:a});return s}getLabelForValue(e){return av.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}$(bg,"id","category"),$(bg,"defaults",{ticks:{callback:av}});function bN(r,e){const t=[],{bounds:s,step:i,min:a,max:o,precision:l,count:c,maxTicks:u,maxDigits:d,includeBounds:h}=r,f=i||1,p=u-1,{min:m,max:g}=e,b=!Le(a),_=!Le(o),y=!Le(c),w=(g-m)/(d+1);let v=tw((g-m)/p/f)*f,x,k,S,R;if(v<1e-14&&!b&&!_)return[{value:m},{value:g}];R=Math.ceil(g/v)-Math.floor(m/v),R>p&&(v=tw(R*v/p/f)*f),Le(l)||(x=Math.pow(10,l),v=Math.ceil(v*x)/x),s==="ticks"?(k=Math.floor(m/v)*v,S=Math.ceil(g/v)*v):(k=m,S=g),b&&_&&i&&uI((o-a)/i,v/1e3)?(R=Math.round(Math.min((o-a)/v,u)),v=(o-a)/R,k=a,S=o):y?(k=b?a:k,S=_?o:S,R=c-1,v=(S-k)/R):(R=(S-k)/v,Yo(R,Math.round(R),v/1e3)?R=Math.round(R):R=Math.ceil(R));const D=Math.max(nw(v),nw(k));x=Math.pow(10,Le(l)?D:l),k=Math.round(k*x)/x,S=Math.round(S*x)/x;let M=0;for(b&&(h&&k!==a?(t.push({value:a}),k<a&&M++,Yo(Math.round((k+M*v)*x)/x,a,ov(a,w,r))&&M++):k<a&&M++);M<R;++M){const N=Math.round((k+M*v)*x)/x;if(_&&N>o)break;t.push({value:N})}return _&&h&&S!==o?t.length&&Yo(t[t.length-1].value,o,ov(o,w,r))?t[t.length-1].value=o:t.push({value:o}):(!_||S===o)&&t.push({value:S}),t}function ov(r,e,{horizontal:t,minRotation:n}){const s=Xn(n),i=(t?Math.sin(s):Math.cos(s))||.001,a=.75*e*(""+r).length;return Math.min(e/i,a)}class Ed extends Ai{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,t){return Le(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:t,maxDefined:n}=this.getUserBounds();let{min:s,max:i}=this;const a=l=>s=t?s:l,o=l=>i=n?i:l;if(e){const l=Pr(s),c=Pr(i);l<0&&c<0?o(0):l>0&&c>0&&a(0)}if(s===i){let l=i===0?1:Math.abs(i*.05);o(i+l),e||a(s-l)}this.min=s,this.max=i}getTickLimit(){const e=this.options.ticks;let{maxTicksLimit:t,stepSize:n}=e,s;return n?(s=Math.ceil(this.max/n)-Math.floor(this.min/n)+1,s>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${n} would result generating up to ${s} ticks. Limiting to 1000.`),s=1e3)):(s=this.computeTickLimit(),t=t||11),t&&(s=Math.min(t,s)),s}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,t=e.ticks;let n=this.getTickLimit();n=Math.max(2,n);const s={maxTicks:n,bounds:e.bounds,min:e.min,max:e.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:t.includeBounds!==!1},i=this._range||this,a=bN(s,i);return e.bounds==="ticks"&&_S(a,this,"value"),e.reverse?(a.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),a}configure(){const e=this.ticks;let t=this.min,n=this.max;if(super.configure(),this.options.offset&&e.length){const s=(n-t)/Math.max(e.length-1,1)/2;t-=s,n+=s}this._startValue=t,this._endValue=n,this._valueRange=n-t}getLabelForValue(e){return _c(e,this.chart.options.locale,this.options.ticks.format)}}class _g extends Ed{determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=gt(e)?e:0,this.max=gt(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),t=e?this.width:this.height,n=Xn(this.options.ticks.minRotation),s=(e?Math.sin(n):Math.cos(n))||.001,i=this._resolveTickFontOptions(0);return Math.ceil(t/Math.min(40,i.lineHeight/s))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}$(_g,"id","linear"),$(_g,"defaults",{ticks:{callback:Sh.formatters.numeric}});const vl=r=>Math.floor(xs(r)),Js=(r,e)=>Math.pow(10,vl(r)+e);function lv(r){return r/Math.pow(10,vl(r))===1}function cv(r,e,t){const n=Math.pow(10,t),s=Math.floor(r/n);return Math.ceil(e/n)-s}function _N(r,e){const t=e-r;let n=vl(t);for(;cv(r,e,n)>10;)n++;for(;cv(r,e,n)<10;)n--;return Math.min(n,vl(r))}function yN(r,{min:e,max:t}){e=An(r.min,e);const n=[],s=vl(e);let i=_N(e,t),a=i<0?Math.pow(10,Math.abs(i)):1;const o=Math.pow(10,i),l=s>i?Math.pow(10,s):0,c=Math.round((e-l)*a)/a,u=Math.floor((e-l)/o/10)*o*10;let d=Math.floor((c-u)/Math.pow(10,i)),h=An(r.min,Math.round((l+u+d*Math.pow(10,i))*a)/a);for(;h<t;)n.push({value:h,major:lv(h),significand:d}),d>=10?d=d<15?15:20:d++,d>=20&&(i++,d=2,a=i>=0?1:a),h=Math.round((l+u+d*Math.pow(10,i))*a)/a;const f=An(r.max,h);return n.push({value:f,major:lv(f),significand:d}),n}class yg extends Ai{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,t){const n=Ed.prototype.parse.apply(this,[e,t]);if(n===0){this._zero=!0;return}return gt(n)&&n>0?n:null}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=gt(e)?Math.max(0,e):null,this.max=gt(t)?Math.max(0,t):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!gt(this._userMin)&&(this.min=e===Js(this.min,0)?Js(this.min,-1):Js(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let n=this.min,s=this.max;const i=o=>n=e?n:o,a=o=>s=t?s:o;n===s&&(n<=0?(i(1),a(10)):(i(Js(n,-1)),a(Js(s,1)))),n<=0&&i(Js(s,-1)),s<=0&&a(Js(n,1)),this.min=n,this.max=s}buildTicks(){const e=this.options,t={min:this._userMin,max:this._userMax},n=yN(t,this);return e.bounds==="ticks"&&_S(n,this,"value"),e.reverse?(n.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),n}getLabelForValue(e){return e===void 0?"0":_c(e,this.chart.options.locale,this.options.ticks.format)}configure(){const e=this.min;super.configure(),this._startValue=xs(e),this._valueRange=xs(this.max)-xs(e)}getPixelForValue(e){return(e===void 0||e===0)&&(e=this.min),e===null||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(xs(e)-this._startValue)/this._valueRange)}getValueForPixel(e){const t=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+t*this._valueRange)}}$(yg,"id","logarithmic"),$(yg,"defaults",{ticks:{callback:Sh.formatters.logarithmic,major:{enabled:!0}}});function wg(r){const e=r.ticks;if(e.display&&r.display){const t=Xt(e.backdropPadding);return Se(e.font&&e.font.size,ct.font.size)+t.height}return 0}function wN(r,e,t){return t=lt(t)?t:[t],{w:EI(r,e.string,t),h:t.length*e.lineHeight}}function uv(r,e,t,n,s){return r===n||r===s?{start:e-t/2,end:e+t/2}:r<n||r>s?{start:e-t,end:e}:{start:e,end:e+t}}function vN(r){const e={l:r.left+r._padding.left,r:r.right-r._padding.right,t:r.top+r._padding.top,b:r.bottom-r._padding.bottom},t=Object.assign({},e),n=[],s=[],i=r._pointLabels.length,a=r.options.pointLabels,o=a.centerPointLabels?it/i:0;for(let l=0;l<i;l++){const c=a.setContext(r.getPointLabelContext(l));s[l]=c.padding;const u=r.getPointPosition(l,r.drawingArea+s[l],o),d=Ot(c.font),h=wN(r.ctx,d,r._pointLabels[l]);n[l]=h;const f=Tn(r.getIndexAngle(l)+o),p=Math.round(Ib(f)),m=uv(p,u.x,h.w,0,180),g=uv(p,u.y,h.h,90,270);xN(t,e,f,m,g)}r.setCenterPoint(e.l-t.l,t.r-e.r,e.t-t.t,t.b-e.b),r._pointLabelItems=PN(r,n,s)}function xN(r,e,t,n,s){const i=Math.abs(Math.sin(t)),a=Math.abs(Math.cos(t));let o=0,l=0;n.start<e.l?(o=(e.l-n.start)/i,r.l=Math.min(r.l,e.l-o)):n.end>e.r&&(o=(n.end-e.r)/i,r.r=Math.max(r.r,e.r+o)),s.start<e.t?(l=(e.t-s.start)/a,r.t=Math.min(r.t,e.t-l)):s.end>e.b&&(l=(s.end-e.b)/a,r.b=Math.max(r.b,e.b+l))}function kN(r,e,t){const n=r.drawingArea,{extra:s,additionalAngle:i,padding:a,size:o}=t,l=r.getPointPosition(e,n+s+a,i),c=Math.round(Ib(Tn(l.angle+wt))),u=ON(l.y,o.h,c),d=AN(c),h=EN(l.x,o.w,d);return{visible:!0,x:l.x,y:u,textAlign:d,left:h,top:u,right:h+o.w,bottom:u+o.h}}function SN(r,e){if(!e)return!0;const{left:t,top:n,right:s,bottom:i}=r;return!(Yr({x:t,y:n},e)||Yr({x:t,y:i},e)||Yr({x:s,y:n},e)||Yr({x:s,y:i},e))}function PN(r,e,t){const n=[],s=r._pointLabels.length,i=r.options,{centerPointLabels:a,display:o}=i.pointLabels,l={extra:wg(i)/2,additionalAngle:a?it/s:0};let c;for(let u=0;u<s;u++){l.padding=t[u],l.size=e[u];const d=kN(r,u,l);n.push(d),o==="auto"&&(d.visible=SN(d,c),d.visible&&(c=d))}return n}function AN(r){return r===0||r===180?"center":r<180?"left":"right"}function EN(r,e,t){return t==="right"?r-=e:t==="center"&&(r-=e/2),r}function ON(r,e,t){return t===90||t===270?r-=e/2:(t>270||t<90)&&(r-=e),r}function TN(r,e,t){const{left:n,top:s,right:i,bottom:a}=t,{backdropColor:o}=e;if(!Le(o)){const l=ci(e.borderRadius),c=Xt(e.backdropPadding);r.fillStyle=o;const u=n-c.left,d=s-c.top,h=i-n+c.width,f=a-s+c.height;Object.values(l).some(p=>p!==0)?(r.beginPath(),yl(r,{x:u,y:d,w:h,h:f,radius:l}),r.fill()):r.fillRect(u,d,h,f)}}function RN(r,e){const{ctx:t,options:{pointLabels:n}}=r;for(let s=e-1;s>=0;s--){const i=r._pointLabelItems[s];if(!i.visible)continue;const a=n.setContext(r.getPointLabelContext(s));TN(t,a,i);const o=Ot(a.font),{x:l,y:c,textAlign:u}=i;gi(t,r._pointLabels[s],l,c+o.lineHeight/2,o,{color:a.color,textAlign:u,textBaseline:"middle"})}}function c1(r,e,t,n){const{ctx:s}=r;if(t)s.arc(r.xCenter,r.yCenter,e,0,st);else{let i=r.getPointPosition(0,e);s.moveTo(i.x,i.y);for(let a=1;a<n;a++)i=r.getPointPosition(a,e),s.lineTo(i.x,i.y)}}function IN(r,e,t,n,s){const i=r.ctx,a=e.circular,{color:o,lineWidth:l}=e;!a&&!n||!o||!l||t<0||(i.save(),i.strokeStyle=o,i.lineWidth=l,i.setLineDash(s.dash||[]),i.lineDashOffset=s.dashOffset,i.beginPath(),c1(r,t,a,n),i.closePath(),i.stroke(),i.restore())}function CN(r,e,t){return Fs(r,{label:t,index:e,type:"pointLabel"})}class jo extends Ed{constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const e=this._padding=Xt(wg(this.options)/2),t=this.width=this.maxWidth-e.width,n=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+t/2+e.left),this.yCenter=Math.floor(this.top+n/2+e.top),this.drawingArea=Math.floor(Math.min(t,n)/2)}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!1);this.min=gt(e)&&!isNaN(e)?e:0,this.max=gt(t)&&!isNaN(t)?t:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/wg(this.options))}generateTickLabels(e){Ed.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map((t,n)=>{const s=nt(this.options.pointLabels.callback,[t,n],this);return s||s===0?s:""}).filter((t,n)=>this.chart.getDataVisibility(n))}fit(){const e=this.options;e.display&&e.pointLabels.display?vN(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,t,n,s){this.xCenter+=Math.floor((e-t)/2),this.yCenter+=Math.floor((n-s)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,t,n,s))}getIndexAngle(e){const t=st/(this._pointLabels.length||1),n=this.options.startAngle||0;return Tn(e*t+Xn(n))}getDistanceFromCenterForValue(e){if(Le(e))return NaN;const t=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*t:(e-this.min)*t}getValueForDistanceFromCenter(e){if(Le(e))return NaN;const t=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-t:this.min+t}getPointLabelContext(e){const t=this._pointLabels||[];if(e>=0&&e<t.length){const n=t[e];return CN(this.getContext(),e,n)}}getPointPosition(e,t,n=0){const s=this.getIndexAngle(e)-wt+n;return{x:Math.cos(s)*t+this.xCenter,y:Math.sin(s)*t+this.yCenter,angle:s}}getPointPositionForValue(e,t){return this.getPointPosition(e,this.getDistanceFromCenterForValue(t))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){const{left:t,top:n,right:s,bottom:i}=this._pointLabelItems[e];return{left:t,top:n,right:s,bottom:i}}drawBackground(){const{backgroundColor:e,grid:{circular:t}}=this.options;if(e){const n=this.ctx;n.save(),n.beginPath(),c1(this,this.getDistanceFromCenterForValue(this._endValue),t,this._pointLabels.length),n.closePath(),n.fillStyle=e,n.fill(),n.restore()}}drawGrid(){const e=this.ctx,t=this.options,{angleLines:n,grid:s,border:i}=t,a=this._pointLabels.length;let o,l,c;if(t.pointLabels.display&&RN(this,a),s.display&&this.ticks.forEach((u,d)=>{if(d!==0||d===0&&this.min<0){l=this.getDistanceFromCenterForValue(u.value);const h=this.getContext(d),f=s.setContext(h),p=i.setContext(h);IN(this,f,l,a,p)}}),n.display){for(e.save(),o=a-1;o>=0;o--){const u=n.setContext(this.getPointLabelContext(o)),{color:d,lineWidth:h}=u;!h||!d||(e.lineWidth=h,e.strokeStyle=d,e.setLineDash(u.borderDash),e.lineDashOffset=u.borderDashOffset,l=this.getDistanceFromCenterForValue(t.reverse?this.min:this.max),c=this.getPointPosition(o,l),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(c.x,c.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){const e=this.ctx,t=this.options,n=t.ticks;if(!n.display)return;const s=this.getIndexAngle(0);let i,a;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(s),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach((o,l)=>{if(l===0&&this.min>=0&&!t.reverse)return;const c=n.setContext(this.getContext(l)),u=Ot(c.font);if(i=this.getDistanceFromCenterForValue(this.ticks[l].value),c.showLabelBackdrop){e.font=u.string,a=e.measureText(o.label).width,e.fillStyle=c.backdropColor;const d=Xt(c.backdropPadding);e.fillRect(-a/2-d.left,-i-u.size/2-d.top,a+d.width,u.size+d.height)}gi(e,o.label,0,-i,u,{color:c.color,strokeColor:c.textStrokeColor,strokeWidth:c.textStrokeWidth})}),e.restore()}drawTitle(){}}$(jo,"id","radialLinear"),$(jo,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Sh.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(e){return e},padding:5,centerPointLabels:!1}}),$(jo,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),$(jo,"descriptors",{angleLines:{_fallback:"grid"}});const Th={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},gn=Object.keys(Th);function dv(r,e){return r-e}function hv(r,e){if(Le(e))return null;const t=r._adapter,{parser:n,round:s,isoWeekday:i}=r._parseOpts;let a=e;return typeof n=="function"&&(a=n(a)),gt(a)||(a=typeof n=="string"?t.parse(a,n):t.parse(a)),a===null?null:(s&&(a=s==="week"&&(Oa(i)||i===!0)?t.startOf(a,"isoWeek",i):t.startOf(a,s)),+a)}function fv(r,e,t,n){const s=gn.length;for(let i=gn.indexOf(r);i<s-1;++i){const a=Th[gn[i]],o=a.steps?a.steps:Number.MAX_SAFE_INTEGER;if(a.common&&Math.ceil((t-e)/(o*a.size))<=n)return gn[i]}return gn[s-1]}function $N(r,e,t,n,s){for(let i=gn.length-1;i>=gn.indexOf(t);i--){const a=gn[i];if(Th[a].common&&r._adapter.diff(s,n,a)>=e-1)return a}return gn[t?gn.indexOf(t):0]}function MN(r){for(let e=gn.indexOf(r)+1,t=gn.length;e<t;++e)if(Th[gn[e]].common)return gn[e]}function pv(r,e,t){if(!t)r[e]=!0;else if(t.length){const{lo:n,hi:s}=Cb(t,e),i=t[n]>=e?t[n]:t[s];r[i]=!0}}function NN(r,e,t,n){const s=r._adapter,i=+s.startOf(e[0].value,n),a=e[e.length-1].value;let o,l;for(o=i;o<=a;o=+s.add(o,1,n))l=t[o],l>=0&&(e[l].major=!0);return e}function mv(r,e,t){const n=[],s={},i=e.length;let a,o;for(a=0;a<i;++a)o=e[a],s[o]=a,n.push({value:o,major:!1});return i===0||!t?n:NN(r,n,s,t)}class xl extends Ai{constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,t={}){const n=e.time||(e.time={}),s=this._adapter=new HC._date(e.adapters.date);s.init(t),Xo(n.displayFormats,s.formats()),this._parseOpts={parser:n.parser,round:n.round,isoWeekday:n.isoWeekday},super.init(e),this._normalized=t.normalized}parse(e,t){return e===void 0?null:hv(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,t=this._adapter,n=e.time.unit||"day";let{min:s,max:i,minDefined:a,maxDefined:o}=this.getUserBounds();function l(c){!a&&!isNaN(c.min)&&(s=Math.min(s,c.min)),!o&&!isNaN(c.max)&&(i=Math.max(i,c.max))}(!a||!o)&&(l(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&l(this.getMinMax(!1))),s=gt(s)&&!isNaN(s)?s:+t.startOf(Date.now(),n),i=gt(i)&&!isNaN(i)?i:+t.endOf(Date.now(),n)+1,this.min=Math.min(s,i-1),this.max=Math.max(s+1,i)}_getLabelBounds(){const e=this.getLabelTimestamps();let t=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return e.length&&(t=e[0],n=e[e.length-1]),{min:t,max:n}}buildTicks(){const e=this.options,t=e.time,n=e.ticks,s=n.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&s.length&&(this.min=this._userMin||s[0],this.max=this._userMax||s[s.length-1]);const i=this.min,a=this.max,o=pI(s,i,a);return this._unit=t.unit||(n.autoSkip?fv(t.minUnit,this.min,this.max,this._getLabelCapacity(i)):$N(this,o.length,t.minUnit,this.min,this.max)),this._majorUnit=!n.major.enabled||this._unit==="year"?void 0:MN(this._unit),this.initOffsets(s),e.reverse&&o.reverse(),mv(this,o,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let t=0,n=0,s,i;this.options.offset&&e.length&&(s=this.getDecimalForValue(e[0]),e.length===1?t=1-s:t=(this.getDecimalForValue(e[1])-s)/2,i=this.getDecimalForValue(e[e.length-1]),e.length===1?n=i:n=(i-this.getDecimalForValue(e[e.length-2]))/2);const a=e.length<3?.5:.25;t=Lt(t,0,a),n=Lt(n,0,a),this._offsets={start:t,end:n,factor:1/(t+1+n)}}_generate(){const e=this._adapter,t=this.min,n=this.max,s=this.options,i=s.time,a=i.unit||fv(i.minUnit,t,n,this._getLabelCapacity(t)),o=Se(s.ticks.stepSize,1),l=a==="week"?i.isoWeekday:!1,c=Oa(l)||l===!0,u={};let d=t,h,f;if(c&&(d=+e.startOf(d,"isoWeek",l)),d=+e.startOf(d,c?"day":a),e.diff(n,t,a)>1e5*o)throw new Error(t+" and "+n+" are too far apart with stepSize of "+o+" "+a);const p=s.ticks.source==="data"&&this.getDataTimestamps();for(h=d,f=0;h<n;h=+e.add(h,o,a),f++)pv(u,h,p);return(h===n||s.bounds==="ticks"||f===1)&&pv(u,h,p),Object.keys(u).sort(dv).map(m=>+m)}getLabelForValue(e){const t=this._adapter,n=this.options.time;return n.tooltipFormat?t.format(e,n.tooltipFormat):t.format(e,n.displayFormats.datetime)}format(e,t){const s=this.options.time.displayFormats,i=this._unit,a=t||s[i];return this._adapter.format(e,a)}_tickFormatFunction(e,t,n,s){const i=this.options,a=i.ticks.callback;if(a)return nt(a,[e,t,n],this);const o=i.time.displayFormats,l=this._unit,c=this._majorUnit,u=l&&o[l],d=c&&o[c],h=n[t],f=c&&d&&h&&h.major;return this._adapter.format(e,s||(f?d:u))}generateTickLabels(e){let t,n,s;for(t=0,n=e.length;t<n;++t)s=e[t],s.label=this._tickFormatFunction(s.value,t,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const t=this._offsets,n=this.getDecimalForValue(e);return this.getPixelForDecimal((t.start+n)*t.factor)}getValueForPixel(e){const t=this._offsets,n=this.getDecimalForPixel(e)/t.factor-t.end;return this.min+n*(this.max-this.min)}_getLabelSize(e){const t=this.options.ticks,n=this.ctx.measureText(e).width,s=Xn(this.isHorizontal()?t.maxRotation:t.minRotation),i=Math.cos(s),a=Math.sin(s),o=this._resolveTickFontOptions(0).size;return{w:n*i+o*a,h:n*a+o*i}}_getLabelCapacity(e){const t=this.options.time,n=t.displayFormats,s=n[t.unit]||n.millisecond,i=this._tickFormatFunction(e,0,mv(this,[e],this._majorUnit),s),a=this._getLabelSize(i),o=Math.floor(this.isHorizontal()?this.width/a.w:this.height/a.h)-1;return o>0?o:1}getDataTimestamps(){let e=this._cache.data||[],t,n;if(e.length)return e;const s=this.getMatchingVisibleMetas();if(this._normalized&&s.length)return this._cache.data=s[0].controller.getAllParsedValues(this);for(t=0,n=s.length;t<n;++t)e=e.concat(s[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let t,n;if(e.length)return e;const s=this.getLabels();for(t=0,n=s.length;t<n;++t)e.push(hv(this,s[t]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return vS(e.sort(dv))}}$(xl,"id","time"),$(xl,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function cu(r,e,t){let n=0,s=r.length-1,i,a,o,l;t?(e>=r[n].pos&&e<=r[s].pos&&({lo:n,hi:s}=Xr(r,"pos",e)),{pos:i,time:o}=r[n],{pos:a,time:l}=r[s]):(e>=r[n].time&&e<=r[s].time&&({lo:n,hi:s}=Xr(r,"time",e)),{time:i,pos:o}=r[n],{time:a,pos:l}=r[s]);const c=a-i;return c?o+(l-o)*(e-i)/c:o}class vg extends xl{constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(e);this._minPos=cu(t,this.min),this._tableRange=cu(t,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:t,max:n}=this,s=[],i=[];let a,o,l,c,u;for(a=0,o=e.length;a<o;++a)c=e[a],c>=t&&c<=n&&s.push(c);if(s.length<2)return[{time:t,pos:0},{time:n,pos:1}];for(a=0,o=s.length;a<o;++a)u=s[a+1],l=s[a-1],c=s[a],Math.round((u+l)/2)!==c&&i.push({time:c,pos:a/(o-1)});return i}_generate(){const e=this.min,t=this.max;let n=super.getDataTimestamps();return(!n.includes(e)||!n.length)&&n.splice(0,0,e),(!n.includes(t)||n.length===1)&&n.push(t),n.sort((s,i)=>s-i)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const t=this.getDataTimestamps(),n=this.getLabelTimestamps();return t.length&&n.length?e=this.normalize(t.concat(n)):e=t.length?t:n,e=this._cache.all=e,e}getDecimalForValue(e){return(cu(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const t=this._offsets,n=this.getDecimalForPixel(e)/t.factor-t.end;return cu(this._table,n*this._tableRange+this._minPos,!0)}}$(vg,"id","timeseries"),$(vg,"defaults",xl.defaults);var LN=Object.freeze({__proto__:null,CategoryScale:bg,LinearScale:_g,LogarithmicScale:yg,RadialLinearScale:jo,TimeScale:xl,TimeSeriesScale:vg});const jN=[qC,_M,fN,LN];Wr.register(...jN);function DN(r){return typeof r=="function"}function FN(r){return r!==null&&typeof r=="object"}const zN=["string","number","bigint","boolean"];function xg(r){return r==null||zN.includes(typeof r)?!0:Array.isArray(r)?r.every(e=>xg(e)):typeof r=="object"?Object.getPrototypeOf(r)===Object.prototype:!1}const kl=Symbol("box"),Hb=Symbol("is-writable");function BN(r){return FN(r)&&kl in r}function UN(r){return pe.isBox(r)&&Hb in r}function pe(r){let e=rn(pc(r));return{[kl]:!0,[Hb]:!0,get current(){return P(e)},set current(t){de(e,t,!0)}}}function qN(r,e){const t=Ne(r);return e?{[kl]:!0,[Hb]:!0,get current(){return P(t)},set current(n){e(n)}}:{[kl]:!0,get current(){return r()}}}function HN(r){return pe.isBox(r)?r:DN(r)?pe.with(r):pe(r)}function WN(r){return Object.entries(r).reduce((e,[t,n])=>pe.isBox(n)?(pe.isWritableBox(n)?Object.defineProperty(e,t,{get(){return n.current},set(s){n.current=s}}):Object.defineProperty(e,t,{get(){return n.current}}),e):Object.assign(e,{[t]:n}),{})}function VN(r){return pe.isWritableBox(r)?{[kl]:!0,get current(){return r.current}}:r}pe.from=HN;pe.with=qN;pe.flatten=WN;pe.readonly=VN;pe.isBox=BN;pe.isWritableBox=UN;function GN(...r){return function(e){var t;for(const n of r)if(n){if(e.defaultPrevented)return;typeof n=="function"?n.call(this,e):(t=n.current)==null||t.call(this,e)}}}var Li={},Jf,gv;function ZN(){if(gv)return Jf;gv=1;var r=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,e=/\n/g,t=/^\s*/,n=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,s=/^:\s*/,i=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,a=/^[;\s]*/,o=/^\s+|\s+$/g,l=`
`,c="/",u="*",d="",h="comment",f="declaration";Jf=function(m,g){if(typeof m!="string")throw new TypeError("First argument must be a string");if(!m)return[];g=g||{};var b=1,_=1;function y(C){var A=C.match(e);A&&(b+=A.length);var E=C.lastIndexOf(l);_=~E?C.length-E:_+C.length}function w(){var C={line:b,column:_};return function(A){return A.position=new v(C),S(),A}}function v(C){this.start=C,this.end={line:b,column:_},this.source=g.source}v.prototype.content=m;function x(C){var A=new Error(g.source+":"+b+":"+_+": "+C);if(A.reason=C,A.filename=g.source,A.line=b,A.column=_,A.source=m,!g.silent)throw A}function k(C){var A=C.exec(m);if(A){var E=A[0];return y(E),m=m.slice(E.length),A}}function S(){k(t)}function R(C){var A;for(C=C||[];A=D();)A!==!1&&C.push(A);return C}function D(){var C=w();if(!(c!=m.charAt(0)||u!=m.charAt(1))){for(var A=2;d!=m.charAt(A)&&(u!=m.charAt(A)||c!=m.charAt(A+1));)++A;if(A+=2,d===m.charAt(A-1))return x("End of comment missing");var E=m.slice(2,A-2);return _+=2,y(E),m=m.slice(A),_+=2,C({type:h,comment:E})}}function M(){var C=w(),A=k(n);if(A){if(D(),!k(s))return x("property missing ':'");var E=k(i),O=C({type:f,property:p(A[0].replace(r,d)),value:E?p(E[0].replace(r,d)):d});return k(a),O}}function N(){var C=[];R(C);for(var A;A=M();)A!==!1&&(C.push(A),R(C));return C}return S(),N()};function p(m){return m?m.replace(o,d):d}return Jf}var bv;function JN(){if(bv)return Li;bv=1;var r=Li&&Li.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Li,"__esModule",{value:!0}),Li.default=t;var e=r(ZN());function t(n,s){var i=null;if(!n||typeof n!="string")return i;var a=(0,e.default)(n),o=typeof s=="function";return a.forEach(function(l){if(l.type==="declaration"){var c=l.property,u=l.value;o?s(c,u,l):u&&(i=i||{},i[c]=u)}}),i}return Li}var KN=JN();const _v=Pi(KN),XN=_v.default||_v,YN=/\d/,QN=["-","_","/","."];function eL(r=""){if(!YN.test(r))return r!==r.toLowerCase()}function tL(r){const e=[];let t="",n,s;for(const i of r){const a=QN.includes(i);if(a===!0){e.push(t),t="",n=void 0;continue}const o=eL(i);if(s===!1){if(n===!1&&o===!0){e.push(t),t=i,n=o;continue}if(n===!0&&o===!1&&t.length>1){const l=t.at(-1);e.push(t.slice(0,Math.max(0,t.length-1))),t=l+i,n=o;continue}}t+=i,n=o,s=a}return e.push(t),e}function u1(r){return r?tL(r).map(e=>rL(e)).join(""):""}function nL(r){return sL(u1(r||""))}function rL(r){return r?r[0].toUpperCase()+r.slice(1):""}function sL(r){return r?r[0].toLowerCase()+r.slice(1):""}function uu(r){if(!r)return{};const e={};function t(n,s){if(n.startsWith("-moz-")||n.startsWith("-webkit-")||n.startsWith("-ms-")||n.startsWith("-o-")){e[u1(n)]=s;return}if(n.startsWith("--")){e[n]=s;return}e[nL(n)]=s}return XN(r,t),e}function d1(...r){return(...e)=>{for(const t of r)typeof t=="function"&&t(...e)}}function iL(r,e,t,n){const s=Array.isArray(e)?e:[e];return s.forEach(i=>r.addEventListener(i,t,n)),()=>{s.forEach(i=>r.removeEventListener(i,t,n))}}function aL(r,e){const t=RegExp(r,"g");return n=>{if(typeof n!="string")throw new TypeError(`expected an argument of type string, but got ${typeof n}`);return n.match(t)?n.replace(t,e):n}}const oL=aL(/[A-Z]/,r=>`-${r.toLowerCase()}`);function lL(r){if(!r||typeof r!="object"||Array.isArray(r))throw new TypeError(`expected an argument of type object, but got ${typeof r}`);return Object.keys(r).map(e=>`${oL(e)}: ${r[e]};`).join(`
`)}function h1(r={}){return lL(r).replace(`
`," ")}const cL={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",transform:"translateX(-100%)"};h1(cL);function uL(r){var e;return r.length>2&&r.startsWith("on")&&r[2]===((e=r[2])==null?void 0:e.toLowerCase())}function Ei(...r){const e={...r[0]};for(let t=1;t<r.length;t++){const n=r[t];for(const s in n){const i=e[s],a=n[s],o=typeof i=="function",l=typeof a=="function";if(o&&uL(s)){const c=i,u=a;e[s]=GN(c,u)}else if(o&&l)e[s]=d1(i,a);else if(s==="class"){const c=xg(i),u=xg(a);c&&u?e[s]=Jo(i,a):c?e[s]=Jo(i):u&&(e[s]=Jo(a))}else if(s==="style"){const c=typeof i=="object",u=typeof a=="object",d=typeof i=="string",h=typeof a=="string";if(c&&u)e[s]={...i,...a};else if(c&&h){const f=uu(a);e[s]={...i,...f}}else if(d&&u){const f=uu(i);e[s]={...f,...a}}else if(d&&h){const f=uu(i),p=uu(a);e[s]={...f,...p}}else c?e[s]=i:u?e[s]=a:d?e[s]=i:h&&(e[s]=a)}else e[s]=a!==void 0?a:i}}return typeof e.style=="object"&&(e.style=h1(e.style).replaceAll(`
`," ")),e.hidden!==!0&&(e.hidden=void 0,delete e.hidden),e.disabled!==!0&&(e.disabled=void 0,delete e.disabled),e}const dL=typeof window<"u"?window:void 0;function hL(r){let e=r.activeElement;for(;e!=null&&e.shadowRoot;){const t=e.shadowRoot.activeElement;if(t===e)break;e=t}return e}var yr,wr,Gr,_a,cd;const hy=class hy extends Map{constructor(t){super();ye(this,_a);ye(this,yr,new Map);ye(this,wr,qr(0));ye(this,Gr,qr(0));if(t){for(var[n,s]of t)super.set(n,s);F(this,Gr).v=super.size}}has(t){var n=F(this,yr),s=n.get(t);if(s===void 0){var i=super.get(t);if(i!==void 0)s=qr(0),n.set(t,s);else return P(F(this,wr)),!1}return P(s),!0}forEach(t,n){Us(this,_a,cd).call(this),super.forEach(t,n)}get(t){var n=F(this,yr),s=n.get(t);if(s===void 0){var i=super.get(t);if(i!==void 0)s=qr(0),n.set(t,s);else{P(F(this,wr));return}}return P(s),super.get(t)}set(t,n){var d;var s=F(this,yr),i=s.get(t),a=super.get(t),o=super.set(t,n),l=F(this,wr);if(i===void 0)s.set(t,qr(0)),de(F(this,Gr),super.size),Wi(l);else if(a!==n){Wi(i);var c=l.reactions===null?null:new Set(l.reactions),u=c===null||!((d=i.reactions)!=null&&d.every(h=>c.has(h)));u&&Wi(l)}return o}delete(t){var n=F(this,yr),s=n.get(t),i=super.delete(t);return s!==void 0&&(n.delete(t),de(F(this,Gr),super.size),de(s,-1),Wi(F(this,wr))),i}clear(){if(super.size!==0){super.clear();var t=F(this,yr);de(F(this,Gr),0);for(var n of t.values())de(n,-1);Wi(F(this,wr)),t.clear()}}keys(){return P(F(this,wr)),super.keys()}values(){return Us(this,_a,cd).call(this),super.values()}entries(){return Us(this,_a,cd).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return P(F(this,Gr)),super.size}};yr=new WeakMap,wr=new WeakMap,Gr=new WeakMap,_a=new WeakSet,cd=function(){P(F(this,wr));var t=F(this,yr);if(F(this,Gr).v!==t.size)for(var n of yy(hy.prototype,this,"keys").call(this))t.has(n)||t.set(n,qr(0));for(var[,s]of F(this,yr))P(s)};let Od=hy;var ya,Wl;class fL{constructor(e={}){ye(this,ya);ye(this,Wl);const{window:t=dL,document:n=t==null?void 0:t.document}=e;t!==void 0&&(eo(this,ya,n),eo(this,Wl,NO(s=>{const i=ms(t,"focusin",s),a=ms(t,"focusout",s);return()=>{i(),a()}})))}get current(){var e;return(e=F(this,Wl))==null||e.call(this),F(this,ya)?hL(F(this,ya)):null}}ya=new WeakMap,Wl=new WeakMap;new fL;function pL(r,e){switch(r){case"post":Os(e);break;case"pre":oO(e);break}}function f1(r,e,t,n={}){const{lazy:s=!1}=n;let i=!s,a=Array.isArray(r)?[]:void 0;pL(e,()=>{const o=Array.isArray(r)?r.map(c=>c()):r();if(!i){i=!0,a=o;return}const l=xh(()=>t(o,a));return a=o,l})}function As(r,e,t){f1(r,"post",e,t)}function mL(r,e,t){f1(r,"pre",e,t)}As.pre=mL;var Vl,Zr;class p1{constructor(e){ye(this,Vl);ye(this,Zr);eo(this,Vl,e),eo(this,Zr,Symbol(e))}get key(){return F(this,Zr)}exists(){return lO(F(this,Zr))}get(){const e=xy(F(this,Zr));if(e===void 0)throw new Error(`Context "${F(this,Vl)}" not found`);return e}getOr(e){const t=xy(F(this,Zr));return t===void 0?e:t}set(e){return cO(F(this,Zr),e)}}Vl=new WeakMap,Zr=new WeakMap;function gL(r){Os(()=>()=>{r()})}function Oi({id:r,ref:e,deps:t=()=>!0,onRefChange:n,getRootNode:s}){As([()=>r.current,t],([i])=>{const a=(s==null?void 0:s())??document,o=a==null?void 0:a.getElementById(i);o?e.current=o:e.current=null,n==null||n(e.current)}),gL(()=>{e.current=null,n==null||n(null)})}function bL(r){Sk().then(r)}function _L({layout:r,panesArray:e,pivotIndices:t}){let n=0,s=100,i=0,a=0;const o=t[0];for(let d=0;d<e.length;d++){const h=e[d].constraints,{maxSize:f=100,minSize:p=0}=h;d===o?(n=p,s=f):(i+=p,a+=f)}const l=Math.min(s,100-i),c=Math.max(n,100-a),u=r[o];return{valueMax:l,valueMin:c,valueNow:u}}function rt(r,e="Assertion failed!"){if(!r)throw console.error(e),new Error(e)}const yL=100,Wb=10;function En(r,e,t=Wb){return Sl(r,e,t)===0}function Sl(r,e,t=Wb){const n=yv(r,t),s=yv(e,t);return Math.sign(n-s)}function uo(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function yv(r,e){return Number.parseFloat(r.toFixed(e))}const Rh=typeof document<"u";function wL(r){return r instanceof HTMLElement}function m1(r){return r.type==="keydown"}function g1(r){return r.type.startsWith("mouse")}function b1(r){return r.type.startsWith("touch")}function Qi({paneConstraints:r,paneIndex:e,initialSize:t}){const n=r[e];rt(n!=null,"Pane constraints should not be null.");const{collapsedSize:s=0,collapsible:i,maxSize:a=100,minSize:o=0}=n;let l=t;return Sl(l,o)<0&&(l=vL(l,i,s,o)),l=Math.min(a,l),Number.parseFloat(l.toFixed(Wb))}function vL(r,e,t,n){if(!e)return n;const s=(t+n)/2;return Sl(r,s)<0?t:n}function di(){}function xL({groupId:r,layout:e,panesArray:t}){const n=yc(r);for(let s=0;s<t.length-1;s++){const{valueMax:i,valueMin:a,valueNow:o}=_L({layout:e,panesArray:t,pivotIndices:[s,s+1]}),l=n[s];if(wL(l)){const c=t[s];l.setAttribute("aria-controls",c.opts.id.current),l.setAttribute("aria-valuemax",`${Math.round(i)}`),l.setAttribute("aria-valuemin",`${Math.round(a)}`),l.setAttribute("aria-valuenow",o!=null?`${Math.round(o)}`:"")}}return()=>{n.forEach(s=>{s.removeAttribute("aria-controls"),s.removeAttribute("aria-valuemax"),s.removeAttribute("aria-valuemin"),s.removeAttribute("aria-valuenow")})}}function yc(r){return Rh?Array.from(document.querySelectorAll(`[data-pane-resizer-id][data-pane-group-id="${r}"]`)):[]}function _1(r,e){return Rh?yc(r).findIndex(s=>s.getAttribute("data-pane-resizer-id")===e)??null:null}function wv(r,e){const t=_1(r,e);return t!=null?[t,t+1]:[-1,-1]}function ji(r,e,t){const n=r.map(c=>c.constraints),s=Vi(r,e),i=n[s],o=s===r.length-1?[s-1,s]:[s,s+1],l=t[s];return{...i,paneSize:l,pivotIndices:o}}function Vi(r,e){return r.findIndex(t=>t.opts.id.current===e.opts.id.current)}function ho(r,e,t){for(let n=0;n<e.length;n++){const s=e[n],i=r[n];rt(i);const{collapsedSize:a=0,collapsible:o}=i.constraints,l=t[i.opts.id.current];if(!(l==null||s!==l))continue;t[i.opts.id.current]=s;const{onCollapse:c,onExpand:u,onResize:d}=i.callbacks;d==null||d(s,l),o&&(c||u)&&(u&&(l==null||l===a)&&s!==a&&u(),c&&(l==null||l!==a)&&s===a&&c())}}function kL({panesArray:r}){const e=Array(r.length),t=r.map(i=>i.constraints);let n=0,s=100;for(let i=0;i<r.length;i++){const a=t[i];rt(a);const{defaultSize:o}=a;o!=null&&(n++,e[i]=o,s-=o)}for(let i=0;i<r.length;i++){const a=t[i];rt(a);const{defaultSize:o}=a;if(o!=null)continue;const l=r.length-n,c=s/l;n++,e[i]=c,s-=c}return e}function SL({layout:r,paneConstraints:e}){const t=[...r],n=t.reduce((i,a)=>i+a,0);if(t.length!==e.length)throw new Error(`Invalid ${e.length} pane layout: ${t.map(i=>`${i}%`).join(", ")}`);if(!En(n,100))for(let i=0;i<e.length;i++){const a=t[i];rt(a!=null);const o=100/n*a;t[i]=o}let s=0;for(let i=0;i<e.length;i++){const a=t[i];rt(a!=null);const o=Qi({paneConstraints:e,paneIndex:i,initialSize:a});a!==o&&(s+=a-o,t[i]=o)}if(!En(s,0))for(let i=0;i<e.length;i++){const a=t[i];rt(a!=null);const o=a+s,l=Qi({paneConstraints:e,paneIndex:i,initialSize:o});if(a!==l&&(s-=l-a,t[i]=l,En(s,0)))break}return t}function PL(r){if(!Rh)return null;const e=document.querySelector(`[data-pane-group][data-pane-group-id="${r}"]`);return e||null}function Vb(r){if(!Rh)return null;const e=document.querySelector(`[data-pane-resizer-id="${r}"]`);return e||null}function AL(r,e,t,n){const s=t==="horizontal",i=Vb(e);rt(i);const a=i.getAttribute("data-pane-group-id");rt(a);const{initialCursorPosition:o}=n,l=y1(t,r),c=PL(a);rt(c);const u=c.getBoundingClientRect(),d=s?u.width:u.height;return(l-o)/d*100}function EL(r,e,t,n,s){if(m1(r)){const i=t==="horizontal";let a=0;r.shiftKey?a=100:s!=null?a=s:a=10;let o=0;switch(r.key){case"ArrowDown":o=i?0:a;break;case"ArrowLeft":o=i?-a:0;break;case"ArrowRight":o=i?a:0;break;case"ArrowUp":o=i?0:-a;break;case"End":o=100;break;case"Home":o=-100;break}return o}else return n==null?0:AL(r,e,t,n)}function y1(r,e){const t=r==="horizontal";if(g1(e))return t?e.clientX:e.clientY;if(b1(e)){const n=e.touches[0];return rt(n),t?n.screenX:n.screenY}else throw new Error(`Unsupported event type "${e.type}"`)}function OL(r,e,t){var l,c;const n=Vb(e),s=yc(r),i=n?s.indexOf(n):-1,a=((l=t[i])==null?void 0:l.opts.id.current)??null,o=((c=t[i+1])==null?void 0:c.opts.id.current)??null;return[a,o]}let vv=0;function Td(r="paneforge"){return vv++,`${r}-${vv}`}function fo({delta:r,layout:e,paneConstraints:t,pivotIndices:n,trigger:s}){if(En(r,0))return e;const i=[...e],[a,o]=n;let l=0;if(s==="keyboard"){{const u=r<0?o:a,d=t[u];if(rt(d),d.collapsible){const h=e[u];rt(h!=null);const f=t[u];rt(f);const{collapsedSize:p=0,minSize:m=0}=f;if(En(h,p)){const g=m-h;Sl(g,Math.abs(r))>0&&(r=r<0?0-g:g)}}}{const u=r<0?a:o,d=t[u];rt(d);const{collapsible:h}=d;if(h){const f=e[u];rt(f!=null);const p=t[u];rt(p);const{collapsedSize:m=0,minSize:g=0}=p;if(En(f,g)){const b=f-m;Sl(b,Math.abs(r))>0&&(r=r<0?0-b:b)}}}}{const u=r<0?1:-1;let d=r<0?o:a,h=0;for(;;){const p=e[d];rt(p!=null);const g=Qi({paneConstraints:t,paneIndex:d,initialSize:100})-p;if(h+=g,d+=u,d<0||d>=t.length)break}const f=Math.min(Math.abs(r),Math.abs(h));r=r<0?0-f:f}{let d=r<0?a:o;for(;d>=0&&d<t.length;){const h=Math.abs(r)-Math.abs(l),f=e[d];rt(f!=null);const p=f-h,m=Qi({paneConstraints:t,paneIndex:d,initialSize:p});if(!En(f,m)&&(l+=f-m,i[d]=m,l.toPrecision(3).localeCompare(Math.abs(r).toPrecision(3),void 0,{numeric:!0})>=0))break;r<0?d--:d++}}if(En(l,0))return e;{const u=r<0?o:a,d=e[u];rt(d!=null);const h=d+l,f=Qi({paneConstraints:t,paneIndex:u,initialSize:h});if(i[u]=f,!En(f,h)){let p=h-f,g=r<0?o:a;for(;g>=0&&g<t.length;){const b=i[g];rt(b!=null);const _=b+p,y=Qi({paneConstraints:t,paneIndex:g,initialSize:_});if(En(b,y)||(p-=y-b,i[g]=y),En(p,0))break;r>0?g--:g++}}}const c=i.reduce((u,d)=>d+u,0);return En(c,100)?i:e}let kg=null,si=null;function w1(r){switch(r){case"horizontal":return"ew-resize";case"horizontal-max":return"w-resize";case"horizontal-min":return"e-resize";case"vertical":return"ns-resize";case"vertical-max":return"n-resize";case"vertical-min":return"s-resize"}}function TL(){si!==null&&(document.head.removeChild(si),kg=null,si=null)}function Kf(r){if(kg===r)return;kg=r;const e=w1(r);si===null&&(si=document.createElement("style"),document.head.appendChild(si)),si.innerHTML=`*{cursor: ${e}!important;}`}function RL({defaultSize:r,dragState:e,layout:t,panesArray:n,paneIndex:s,precision:i=3}){const a=t[s];let o;return a==null?o=r??"1":n.length===1?o="1":o=a.toPrecision(i),{flexBasis:0,flexGrow:o,flexShrink:1,overflow:"hidden",pointerEvents:e!==null?"none":void 0}}function xv(r){try{if(typeof localStorage>"u")throw new TypeError("localStorage is not supported in this environment");r.getItem=e=>localStorage.getItem(e),r.setItem=(e,t)=>localStorage.setItem(e,t)}catch(e){console.error(e),r.getItem=()=>null,r.setItem=()=>{}}}function v1(r){return`paneforge:${r}`}function x1(r){return r.map(t=>t.opts.order.current?`${t.opts.order.current}:${JSON.stringify(t.constraints)}`:JSON.stringify(t.constraints)).sort().join(",")}function k1(r,e){try{const t=v1(r),n=e.getItem(t),s=JSON.parse(n||"");if(typeof s=="object"&&s!==null)return s}catch{}return null}function IL(r,e,t){const n=k1(r,t)||{},s=x1(e);return n[s]||null}function CL(r,e,t,n,s){const i=v1(r),a=x1(e),o=k1(r,s)||{};o[a]={expandToSizes:Object.fromEntries(t.entries()),layout:n};try{s.setItem(i,JSON.stringify(o))}catch(l){console.error(l)}}const kv={};function $L(r,e=10){let t=null;return(...s)=>{t!==null&&clearTimeout(t),t=setTimeout(()=>{r(...s)},e)}}function ML({autoSaveId:r,layout:e,storage:t,panesArray:n,paneSizeBeforeCollapse:s}){if(e.length===0||e.length!==n.length)return;let i=kv[r];i==null&&(i=$L(CL,yL),kv[r]=i);const a=[...n],o=new Map(s);i(r,a,o,e,t)}const Do={getItem:r=>(xv(Do),Do.getItem(r)),setItem:(r,e)=>{xv(Do),Do.setItem(r,e)}};var Gl,Zl,Jl,Kl,Xl,Yl,lh,Ql;class NL{constructor(e){$(this,"opts");ye(this,Gl,rn(null));ye(this,Zl,rn([]));ye(this,Jl,rn([]));ye(this,Kl,rn(!1));ye(this,Xl,rn(pc({})));$(this,"paneSizeBeforeCollapseMap",new Map);ye(this,Yl,rn(0));$(this,"setLayout",e=>{this.layout=e});$(this,"registerResizeHandle",e=>t=>{var g,b;t.preventDefault();const n=this.opts.direction.current,s=this.dragState,i=this.opts.id.current,a=this.opts.keyboardResizeBy.current,o=this.layout,l=this.panesArray,{initialLayout:c}=s??{},u=wv(i,e);let d=EL(t,e,n,s,a);if(d===0)return;const h=n==="horizontal";document.dir==="rtl"&&h&&(d=-d);const f=l.map(_=>_.constraints),p=fo({delta:d,layout:c??o,paneConstraints:f,pivotIndices:u,trigger:m1(t)?"keyboard":"mouse-or-touch"}),m=!uo(o,p);(g1(t)||b1(t))&&this.prevDelta!==d&&(this.prevDelta=d,Kf(m?h?"horizontal":"vertical":h?d<0?"horizontal-min":"horizontal-max":d<0?"vertical-min":"vertical-max")),m&&(this.setLayout(p),(b=(g=this.opts.onLayout).current)==null||b.call(g,p),ho(l,p,this.paneIdToLastNotifiedSizeMap))});$(this,"resizePane",(e,t)=>{var d,h;const n=this.layout,s=this.panesArray,i=s.map(f=>f.constraints),{paneSize:a,pivotIndices:o}=ji(s,e,n);rt(a!=null);const c=Vi(s,e)===s.length-1?a-t:t-a,u=fo({delta:c,layout:n,paneConstraints:i,pivotIndices:o,trigger:"imperative-api"});uo(n,u)||(this.setLayout(u),(h=(d=this.opts.onLayout).current)==null||h.call(d,u),ho(s,u,this.paneIdToLastNotifiedSizeMap))});$(this,"startDragging",(e,t)=>{const n=this.opts.direction.current,s=this.layout,i=Vb(e);rt(i);const a=y1(n,t);this.dragState={dragHandleId:e,dragHandleRect:i.getBoundingClientRect(),initialCursorPosition:a,initialLayout:s}});$(this,"stopDragging",()=>{TL(),this.dragState=null});$(this,"isPaneCollapsed",e=>{const t=this.panesArray,n=this.layout,{collapsedSize:s=0,collapsible:i,paneSize:a}=ji(t,e,n);return i===!0&&a===s});$(this,"expandPane",e=>{var p,m;const t=this.layout,n=this.panesArray;if(!e.constraints.collapsible)return;const s=n.map(g=>g.constraints),{collapsedSize:i=0,paneSize:a,minSize:o=0,pivotIndices:l}=ji(n,e,t);if(a!==i)return;const c=this.paneSizeBeforeCollapseMap.get(e.opts.id.current),u=c!=null&&c>=o?c:o,h=Vi(n,e)===n.length-1?a-u:u-a,f=fo({delta:h,layout:t,paneConstraints:s,pivotIndices:l,trigger:"imperative-api"});uo(t,f)||(this.setLayout(f),(m=(p=this.opts.onLayout).current)==null||m.call(p,f),ho(n,f,this.paneIdToLastNotifiedSizeMap))});$(this,"collapsePane",e=>{var d,h;const t=this.layout,n=this.panesArray;if(!e.constraints.collapsible)return;const s=n.map(f=>f.constraints),{collapsedSize:i=0,paneSize:a,pivotIndices:o}=ji(n,e,t);if(rt(a!=null),a===i)return;this.paneSizeBeforeCollapseMap.set(e.opts.id.current,a);const c=Vi(n,e)===n.length-1?a-i:i-a,u=fo({delta:c,layout:t,paneConstraints:s,pivotIndices:o,trigger:"imperative-api"});uo(t,u)||(this.layout=u,(h=(d=this.opts.onLayout).current)==null||h.call(d,u),ho(n,u,this.paneIdToLastNotifiedSizeMap))});$(this,"getPaneSize",e=>ji(this.panesArray,e,this.layout).paneSize);$(this,"getPaneStyle",(e,t)=>{const n=this.panesArray,s=this.layout,i=this.dragState,a=Vi(n,e);return RL({defaultSize:t,dragState:i,layout:s,panesArray:n,paneIndex:a})});$(this,"isPaneExpanded",e=>{const{collapsedSize:t=0,collapsible:n,paneSize:s}=ji(this.panesArray,e,this.layout);return!n||s>t});$(this,"registerPane",e=>{const t=[...this.panesArray,e];return t.sort((n,s)=>{const i=n.opts.order.current,a=s.opts.order.current;return i==null&&a==null?0:i==null?-1:a==null?1:i-a}),this.panesArray=t,this.panesArrayChanged=!0,()=>{const n=[...this.panesArray],s=Vi(this.panesArray,e);s<0||(n.splice(s,1),this.panesArray=n,delete this.paneIdToLastNotifiedSizeMap[e.opts.id.current],this.panesArrayChanged=!0)}});ye(this,lh,()=>{const e=this.opts.id.current,t=yc(e),n=this.panesArray,s=t.map(i=>{const a=i.getAttribute("data-pane-resizer-id");if(!a)return di;const[o,l]=OL(e,a,n);if(o==null||l==null)return di;const u=iL(i,"keydown",d=>{if(d.defaultPrevented||d.key!=="Enter")return;d.preventDefault();const h=this.panesArray,f=h.findIndex(v=>v.opts.id.current===o);if(f<0)return;const p=h[f];rt(p);const m=this.layout,g=m[f],{collapsedSize:b=0,collapsible:_,minSize:y=0}=p.constraints;if(!(g!=null&&_))return;const w=fo({delta:En(g,b)?y-g:b-g,layout:m,paneConstraints:h.map(v=>v.constraints),pivotIndices:wv(e,a),trigger:"keyboard"});m!==w&&(this.layout=w)});return()=>{u()}});return()=>{for(const i of s)i()}});ye(this,Ql,Ne(()=>({id:this.opts.id.current,"data-pane-group":"","data-direction":this.opts.direction.current,"data-pane-group-id":this.opts.id.current,style:{display:"flex",flexDirection:this.opts.direction.current==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"}})));this.opts=e,Oi(e),As([()=>this.opts.id.current,()=>this.layout,()=>this.panesArray],()=>xL({groupId:this.opts.id.current,layout:this.layout,panesArray:this.panesArray})),Os(()=>xh(()=>F(this,lh).call(this))),As([()=>this.opts.autoSaveId.current,()=>this.layout,()=>this.opts.storage.current],()=>{this.opts.autoSaveId.current&&ML({autoSaveId:this.opts.autoSaveId.current,layout:this.layout,storage:this.opts.storage.current,panesArray:this.panesArray,paneSizeBeforeCollapse:this.paneSizeBeforeCollapseMap})}),As(()=>this.panesArrayChanged,()=>{var i,a;if(!this.panesArrayChanged)return;this.panesArrayChanged=!1;const t=this.layout;let n=null;if(this.opts.autoSaveId.current){const o=IL(this.opts.autoSaveId.current,this.panesArray,this.opts.storage.current);o&&(this.paneSizeBeforeCollapseMap=new Map(Object.entries(o.expandToSizes)),n=o.layout)}n==null&&(n=kL({panesArray:this.panesArray}));const s=SL({layout:n,paneConstraints:this.panesArray.map(o=>o.constraints)});uo(t,s)||(this.layout=s,(a=(i=this.opts.onLayout).current)==null||a.call(i,s),ho(this.panesArray,s,this.paneIdToLastNotifiedSizeMap))})}get dragState(){return P(F(this,Gl))}set dragState(e){de(F(this,Gl),e)}get layout(){return P(F(this,Zl))}set layout(e){de(F(this,Zl),e)}get panesArray(){return P(F(this,Jl))}set panesArray(e){de(F(this,Jl),e)}get panesArrayChanged(){return P(F(this,Kl))}set panesArrayChanged(e){de(F(this,Kl),e,!0)}get paneIdToLastNotifiedSizeMap(){return P(F(this,Xl))}set paneIdToLastNotifiedSizeMap(e){de(F(this,Xl),e,!0)}get prevDelta(){return P(F(this,Yl))}set prevDelta(e){de(F(this,Yl),e,!0)}get props(){return P(F(this,Ql))}set props(e){de(F(this,Ql),e)}}Gl=new WeakMap,Zl=new WeakMap,Jl=new WeakMap,Kl=new WeakMap,Xl=new WeakMap,Yl=new WeakMap,lh=new WeakMap,Ql=new WeakMap;const LL=["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","End","Home"];var ec,wa,tc,va,ch,uh,dh,hh,fh,ph,mh,gh,nc;class jL{constructor(e,t){$(this,"opts");$(this,"group");ye(this,ec,Ne(()=>{var e;return((e=this.group.dragState)==null?void 0:e.dragHandleId)===this.opts.id.current}));ye(this,wa,rn(!1));$(this,"resizeHandler",null);ye(this,tc,e=>{e.preventDefault(),!this.opts.disabled.current&&(this.group.startDragging(this.opts.id.current,e),this.opts.onDraggingChange.current(!0))});ye(this,va,()=>{const e=this.opts.ref.current;e&&(e.blur(),this.group.stopDragging(),this.opts.onDraggingChange.current(!1))});ye(this,ch,e=>{if(this.opts.disabled.current||!this.resizeHandler||e.defaultPrevented)return;if(LL.includes(e.key)){e.preventDefault(),this.resizeHandler(e);return}if(e.key!=="F6")return;e.preventDefault();const t=yc(this.group.opts.id.current),n=_1(this.group.opts.id.current,this.opts.id.current);if(n===null)return;let s=0;e.shiftKey?n>0?s=n-1:s=t.length-1:n+1<t.length?s=n+1:s=0,t[s].focus()});ye(this,uh,()=>{de(F(this,wa),!1)});ye(this,dh,()=>{de(F(this,wa),!0)});ye(this,hh,e=>{F(this,tc).call(this,e)});ye(this,fh,()=>{F(this,va).call(this)});ye(this,ph,()=>{F(this,va).call(this)});ye(this,mh,()=>{F(this,va).call(this)});ye(this,gh,e=>{F(this,tc).call(this,e)});ye(this,nc,Ne(()=>({id:this.opts.id.current,role:"separator","data-direction":this.group.opts.direction.current,"data-pane-group-id":this.group.opts.id.current,"data-active":P(F(this,ec))?"pointer":P(F(this,wa))?"keyboard":void 0,"data-enabled":!this.opts.disabled.current,"data-pane-resizer-id":this.opts.id.current,"data-pane-resizer":"",tabIndex:this.opts.tabIndex.current,style:{cursor:w1(this.group.opts.direction.current),touchAction:"none",userSelect:"none","-webkit-user-select":"none","-webkit-touch-callout":"none"},onkeydown:F(this,ch),onblur:F(this,uh),onfocus:F(this,dh),onmousedown:F(this,hh),onmouseup:F(this,fh),ontouchcancel:F(this,ph),ontouchend:F(this,mh),ontouchstart:F(this,gh)})));this.opts=e,this.group=t,Oi(e),Os(()=>{this.opts.disabled.current?this.resizeHandler=null:this.resizeHandler=this.group.registerResizeHandle(this.opts.id.current)}),Os(()=>{const n=this.opts.ref.current;if(!n)return;const s=this.opts.disabled.current,i=this.resizeHandler,a=P(F(this,ec));if(s||i===null||!a)return;const o=u=>{i(u)},l=u=>{i(u)},c=()=>{n.blur(),this.group.stopDragging(),this.opts.onDraggingChange.current(!1)};return d1(ms(document.body,"contextmenu",c),ms(document.body,"mousemove",o),ms(document.body,"touchmove",o,{passive:!1}),ms(document.body,"mouseleave",l),ms(window,"mouseup",c),ms(window,"touchend",c))})}get props(){return P(F(this,nc))}set props(e){de(F(this,nc),e)}}ec=new WeakMap,wa=new WeakMap,tc=new WeakMap,va=new WeakMap,ch=new WeakMap,uh=new WeakMap,dh=new WeakMap,hh=new WeakMap,fh=new WeakMap,ph=new WeakMap,mh=new WeakMap,gh=new WeakMap,nc=new WeakMap;var Jr,rc,sc,ic,xa,bh,ac;class DL{constructor(e,t){$(this,"opts");$(this,"group");ye(this,Jr,rn(""));ye(this,rc,Ne(()=>({onCollapse:this.opts.onCollapse.current,onExpand:this.opts.onExpand.current,onResize:this.opts.onResize.current})));ye(this,sc,Ne(()=>({collapsedSize:this.opts.collapsedSize.current,collapsible:this.opts.collapsible.current,defaultSize:this.opts.defaultSize.current,maxSize:this.opts.maxSize.current,minSize:this.opts.minSize.current})));ye(this,ic,e=>{de(F(this,Jr),e,!0),bL(()=>{if(this.opts.ref.current){const t=this.opts.ref.current;if(!(getComputedStyle(t).transitionDuration!=="0s")){de(F(this,Jr),"");return}const i=a=>{a.propertyName==="flex-grow"&&(de(F(this,Jr),""),t.removeEventListener("transitionend",i))};t.addEventListener("transitionend",i)}else de(F(this,Jr),"")})});$(this,"pane",{collapse:()=>{F(this,ic).call(this,"collapsing"),this.group.collapsePane(this)},expand:()=>{F(this,ic).call(this,"expanding"),this.group.expandPane(this)},getSize:()=>this.group.getPaneSize(this),isCollapsed:()=>this.group.isPaneCollapsed(this),isExpanded:()=>this.group.isPaneExpanded(this),resize:e=>this.group.resizePane(this,e),getId:()=>this.opts.id.current});ye(this,xa,Ne(()=>this.group.isPaneCollapsed(this)));ye(this,bh,Ne(()=>P(F(this,Jr))!==""?P(F(this,Jr)):P(F(this,xa))?"collapsed":"expanded"));ye(this,ac,Ne(()=>({id:this.opts.id.current,style:this.group.getPaneStyle(this,this.opts.defaultSize.current),"data-pane":"","data-pane-id":this.opts.id.current,"data-pane-group-id":this.group.opts.id.current,"data-collapsed":P(F(this,xa))?"":void 0,"data-expanded":P(F(this,xa))?void 0:"","data-pane-state":P(F(this,bh))})));this.opts=e,this.group=t,Oi(e),Ak(()=>this.group.registerPane(this)),As(()=>xO(this.constraints),()=>{this.group.panesArrayChanged=!0})}get callbacks(){return P(F(this,rc))}set callbacks(e){de(F(this,rc),e)}get constraints(){return P(F(this,sc))}set constraints(e){de(F(this,sc),e)}get props(){return P(F(this,ac))}set props(e){de(F(this,ac),e)}}Jr=new WeakMap,rc=new WeakMap,sc=new WeakMap,ic=new WeakMap,xa=new WeakMap,bh=new WeakMap,ac=new WeakMap;const Gb=new p1("PaneGroup");function FL(r){return Gb.set(new NL(r))}function zL(r){return new jL(r,Gb.get())}function BL(r){return new DL(r,Gb.get())}var UL=fe("<div><!></div>");function qL(r,e){at(e,!0);let t=se(e,"autoSaveId",3,null),n=se(e,"id",19,Td),s=se(e,"keyboardResizeBy",3,null),i=se(e,"onLayoutChange",3,di),a=se(e,"storage",3,Do),o=se(e,"ref",15,null),l=Tt(e,["$$slots","$$events","$$legacy","autoSaveId","direction","id","keyboardResizeBy","onLayoutChange","storage","ref","child","children"]);const c=FL({id:pe.with(()=>n()??Td()),ref:pe.with(()=>o(),_=>o(_)),autoSaveId:pe.with(()=>t()),direction:pe.with(()=>e.direction),keyboardResizeBy:pe.with(()=>s()),onLayout:pe.with(()=>i()),storage:pe.with(()=>a())}),u=()=>c.layout,d=c.setLayout,h=()=>c.opts.id.current,f=Ne(()=>Ei(l,c.props));var p=ze(),m=ke(p);{var g=_=>{var y=ze(),w=ke(y);kt(w,()=>e.child,()=>({props:P(f)})),q(_,y)},b=_=>{var y=UL();let w;var v=B(y);kt(v,()=>e.children??In),z(y),Ue(()=>w=Dt(y,w,{...P(f)})),q(_,y)};Qe(m,_=>{e.child?_(g):_(b,!1)})}return q(r,p),ot({getLayout:u,setLayout:d,getId:h})}var HL=fe("<div><!></div>");function Rd(r,e){at(e,!0);let t=se(e,"id",19,Td),n=se(e,"ref",15,null),s=se(e,"onCollapse",3,di),i=se(e,"onExpand",3,di),a=se(e,"onResize",3,di),o=Tt(e,["$$slots","$$events","$$legacy","id","ref","collapsedSize","collapsible","defaultSize","maxSize","minSize","onCollapse","onExpand","onResize","order","child","children"]);const l=BL({id:pe.with(()=>t()),ref:pe.with(()=>n(),v=>n(v)),collapsedSize:pe.with(()=>e.collapsedSize),collapsible:pe.with(()=>e.collapsible),defaultSize:pe.with(()=>e.defaultSize),maxSize:pe.with(()=>e.maxSize),minSize:pe.with(()=>e.minSize),onCollapse:pe.with(()=>s()),onExpand:pe.with(()=>i()),onResize:pe.with(()=>a()),order:pe.with(()=>e.order)}),c=l.pane.collapse,u=l.pane.expand,d=l.pane.getSize,h=l.pane.isCollapsed,f=l.pane.isExpanded,p=l.pane.resize,m=l.pane.getId,g=Ne(()=>Ei(o,l.props));var b=ze(),_=ke(b);{var y=v=>{var x=ze(),k=ke(x);kt(k,()=>e.child,()=>({props:P(g)})),q(v,x)},w=v=>{var x=HL();let k;var S=B(x);kt(S,()=>e.children??In),z(x),Ue(()=>k=Dt(x,k,{...P(g)})),q(v,x)};Qe(_,v=>{e.child?v(y):v(w,!1)})}return q(r,b),ot({collapse:c,expand:u,getSize:d,isCollapsed:h,isExpanded:f,resize:p,getId:m})}var WL=fe("<div><!></div>");function VL(r,e){at(e,!0);let t=se(e,"id",19,Td),n=se(e,"ref",15,null),s=se(e,"disabled",3,!1),i=se(e,"onDraggingChange",3,di),a=se(e,"tabindex",3,0),o=Tt(e,["$$slots","$$events","$$legacy","id","ref","disabled","onDraggingChange","tabindex","child","children"]);const l=zL({id:pe.with(()=>t()),ref:pe.with(()=>n(),p=>n(p)),disabled:pe.with(()=>s()),onDraggingChange:pe.with(()=>i()),tabIndex:pe.with(()=>a())}),c=Ne(()=>Ei(o,l.props));var u=ze(),d=ke(u);{var h=p=>{var m=ze(),g=ke(m);kt(g,()=>e.child,()=>({props:P(c)})),q(p,m)},f=p=>{var m=WL();let g;var b=B(m);kt(b,()=>e.children??In),z(m),Ue(()=>g=Dt(m,g,{...P(c)})),q(p,m)};Qe(d,p=>{e.child?p(h):p(f,!1)})}q(r,u),ot()}/**
 * @license @lucide/svelte v0.488.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const GL={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var ZL=mk("<svg><!><!></svg>");function JL(r,e){at(e,!0);const t=se(e,"color",3,"currentColor"),n=se(e,"size",3,24),s=se(e,"strokeWidth",3,2),i=se(e,"absoluteStrokeWidth",3,!1),a=se(e,"iconNode",19,()=>[]),o=Tt(e,["$$slots","$$events","$$legacy","name","color","size","strokeWidth","absoluteStrokeWidth","iconNode","children"]);var l=ZL();let c;var u=B(l);Dn(u,17,a,Ar,(h,f)=>{let p=()=>P(f)[0],m=()=>P(f)[1];var g=ze(),b=ke(g);Tk(b,p,!0,(_,y)=>{let w;Ue(()=>w=Dt(_,w,{...m()}))}),q(h,g)});var d=V(u);kt(d,()=>e.children??In),z(l),Ue(h=>c=Dt(l,c,{...GL,...o,width:n(),height:n(),stroke:t(),"stroke-width":h,class:["lucide-icon lucide",e.name&&`lucide-${e.name}`,e.class]}),[()=>i()?Number(s())*24/Number(n()):s()]),q(r,l),ot()}function KL(r,e){at(e,!0);let t=Tt(e,["$$slots","$$events","$$legacy"]);JL(r,Rr({name:"grip-vertical"},()=>t,{iconNode:[["circle",{cx:"9",cy:"12",r:"1"}],["circle",{cx:"9",cy:"5",r:"1"}],["circle",{cx:"9",cy:"19",r:"1"}],["circle",{cx:"15",cy:"12",r:"1"}],["circle",{cx:"15",cy:"5",r:"1"}],["circle",{cx:"15",cy:"19",r:"1"}]],children:(s,i)=>{var a=ze(),o=ke(a);kt(o,()=>e.children??In),q(s,a)},$$slots:{default:!0}})),ot()}var XL=fe('<div class="bg-border z-10 flex h-4 w-3 items-center justify-center rounded-sm border"><!></div>');function S1(r,e){at(e,!0);let t=se(e,"ref",15,null),n=se(e,"withHandle",3,!1),s=Tt(e,["$$slots","$$events","$$legacy","ref","class","withHandle"]);var i=ze(),a=ke(i);const o=Ne(()=>Bn("bg-border focus-visible:ring-ring relative flex w-px items-center justify-center after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-offset-1 data-[direction=vertical]:h-px data-[direction=vertical]:w-full data-[direction=vertical]:after:left-0 data-[direction=vertical]:after:h-1 data-[direction=vertical]:after:w-full data-[direction=vertical]:after:-translate-y-1/2 data-[direction=vertical]:after:translate-x-0 [&[data-direction=vertical]>div]:rotate-90",e.class));mc(a,()=>VL,(l,c)=>{c(l,Rr({get class(){return P(o)}},()=>s,{get ref(){return t()},set ref(u){t(u)},children:(u,d)=>{var h=ze(),f=ke(h);{var p=m=>{var g=XL(),b=B(g);KL(b,{class:"size-2.5"}),z(g),q(m,g)};Qe(f,m=>{n()&&m(p)})}q(u,h)},$$slots:{default:!0}}))}),q(r,i),ot()}function P1(r,e){at(e,!0),se(e,"ref",11,null);let t=se(e,"this",15),n=Tt(e,["$$slots","$$events","$$legacy","ref","this","class"]);var s=ze(),i=ke(s);const a=Ne(()=>Bn("flex h-full w-full data-[direction=vertical]:flex-col",e.class));mc(i,()=>qL,(o,l)=>{es(l(o,Rr({get class(){return P(a)}},()=>n)),c=>t(c),()=>t())}),q(r,s),ot()}var YL=fe('<div class="text-center py-8 text-muted-foreground"><p>æ²¡æå¯ç¨çééãè¯·åçæä¸ä¸ªä¿¡å·ã</p></div>'),QL=fe('<div role="button" tabindex="0"><div class="flex justify-between items-center mb-2"><h3 class="text-sm"> </h3> <button class="h-8 w-8 flex items-center justify-center rounded-full text-destructive hover:bg-destructive/10"><span class="text-xl">Ã</span></button></div> <div class="h-8"><canvas></canvas></div></div>'),e2=fe('<div class="box"></div>'),t2=fe('<div class="space-y-1 col-span-2"><div class="text-xs text-muted-foreground">æºéé</div> <div class="text-sm"></div></div>'),n2=fe('<div class="space-y-1 col-span-2"><div class="text-xs text-muted-foreground">å¤çæ¹æ³</div> <div class="text-sm"> </div></div> <!>',1),r2=fe('<h3 class="text-lg font-semibold mb-4"> </h3> <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4"><div class="space-y-1"><div class="text-xs text-muted-foreground">ID</div> <div class="text-sm font-medium truncate"> </div></div> <div class="space-y-1"><div class="text-xs text-muted-foreground">åå»ºæ¶é´</div> <div class="text-sm"> </div></div> <div class="space-y-1"><div class="text-xs text-muted-foreground">æ´æ°æ¶é´</div> <div class="text-sm"> </div></div> <div class="space-y-1"><div class="text-xs text-muted-foreground">éæ ·ç</div> <div class="text-sm"> </div></div> <div class="space-y-1"><div class="text-xs text-muted-foreground">Length</div> <div class="text-sm"> </div></div> <div class="space-y-1"><div class="text-xs text-muted-foreground">Duration</div> <div class="text-sm"> </div></div> <div class="space-y-1"><div class="text-xs text-muted-foreground">æå°å¼/æå¤§å¼</div> <div class="text-sm"> </div></div> <div class="space-y-1"><div class="text-xs text-muted-foreground">å¹³åå¼/åæ¹æ ¹</div> <div class="text-sm"> </div></div> <!></div> <div class="h-64 mt-4"><canvas id="detail-chart"></canvas></div>',1),s2=fe('<div class="text-center py-8 text-muted-foreground"><p>è¯·éæ©ä¸ä¸ªééä»¥æ¥çè¯¦æã</p></div>'),i2=fe("<!> <!> <!>",1),a2=fe('<div class="box-fill"><!></div>');function o2(r,e){at(e,!1);const[t,n]=bb(),s=()=>_b(La,"$channels",t);let i=se(e,"selectedChannelId",12,null),a={};wO(()=>{s().length>0&&o()}),Ak(()=>()=>{Object.values(a).forEach(g=>g.destroy())});function o(){if(s().forEach(g=>{const b=`chart-${g.id}`,_=document.getElementById(b);if(_){a[b]&&a[b].destroy();const y=_.getContext("2d");a[b]=l(y,g,!1)}}),i()){const g=s().find(b=>b.id===i());if(g){const b="detail-chart",_=document.getElementById(b);if(_){a[b]&&a[b].destroy();const y=_.getContext("2d");a[b]=l(y,g,!0)}}}}function l(g,b,_=!1){const y=b.data,w=Array.from({length:y.length},(x,k)=>k),v=b.processingMethod==="calculateFFT"||b.processingMethod==="calculatePowerSpectrum";return new Wr(g,{type:v?"bar":"line",data:{labels:w,datasets:[{label:b.name,data:y,borderColor:"rgb(75, 192, 192)",backgroundColor:"rgba(75, 192, 192, 0.2)",borderWidth:1,pointRadius:_?1:0}]},options:{responsive:!0,maintainAspectRatio:!1,animation:!1,scales:{x:{title:{display:_,text:v?"é¢ç (Hz)":"æ ·æ¬"},display:_},y:{title:{display:_,text:"å¹åº¦"},display:_}},plugins:{legend:{display:_},tooltip:{enabled:_}}}})}function c(g){i(g),setTimeout(o,0)}function u(g){confirm("æ¨ç¡®å®è¦å é¤æ­¤ééåï¼")&&(jO(g),i()===g&&i(null))}function d(g){return new Date(g).toLocaleString()}kh();var h=a2(),f=B(h);{var p=g=>{var b=YL();q(g,b)},m=g=>{P1(g,{direction:"horizontal",class:"box-fill",children:(b,_)=>{var y=i2(),w=ke(y);Rd(w,{class:"box-scroll h-full",minSize:20,children:(k,S)=>{var R=e2();Dn(R,5,s,D=>D.id,(D,M)=>{var N=QL(),C=B(N),A=B(C),E=B(A,!0);z(A);var O=V(A,2);z(C);var I=V(C,2),T=B(I);z(I),z(N),Ue(()=>{yb(N,1,`p-2 ${i()===P(M).id?"bg-primary/5":""} cursor-pointer hover:bg-accent/50 transition-colors border-b`),li(N,"aria-pressed",i()===P(M).id),yt(E,P(M).name),li(O,"aria-label",`Delete channel ${P(M).name??""}`),li(T,"id",`chart-${P(M).id}`)}),la("click",O,L=>{L.stopPropagation(),u(P(M).id)}),la("click",N,()=>c(P(M).id)),la("keydown",N,L=>L.key==="Enter"&&c(P(M).id)),q(D,N)}),z(R),q(k,R)},$$slots:{default:!0}});var v=V(w,2);S1(v,{withHandle:!0});var x=V(v,2);Rd(x,{class:"box-scroll h-full p-4",minSize:20,children:(k,S)=>{var R=ze(),D=ke(R);{var M=C=>{var A=ze(),E=ke(A);Dn(E,1,s,O=>O.id,(O,I)=>{var T=ze(),L=ke(T);{var W=ee=>{var Z=r2(),X=ke(Z),U=B(X);z(X);var G=V(X,2),le=B(G),me=V(B(le),2),Rt=B(me,!0);z(me),z(le);var vt=V(le,2),ut=V(B(vt),2),_t=B(ut,!0);z(ut),z(vt);var Ut=V(vt,2),qt=V(B(Ut),2),dn=B(qt,!0);z(qt),z(Ut);var wn=V(Ut,2),Ir=V(B(wn),2),Fc=B(Ir);z(Ir),z(wn);var ss=V(wn,2),zc=V(B(ss),2),Y=B(zc);z(zc),z(ss);var is=V(ss,2),ge=V(B(is),2),ce=B(ge);z(ge),z(is);var we=V(is,2),te=V(B(we),2),J=B(te);z(te),z(we);var be=V(we,2),_e=V(B(be),2),Ht=B(_e);z(_e),z(be);var Bc=V(be,2);{var Uc=Xa=>{var qc=n2(),Ya=ke(qc),Hc=V(B(Ya),2),pf=B(Hc,!0);z(Hc),z(Ya);var mf=V(Ya,2);{var gf=Qa=>{var bf=t2(),fy=V(B(bf),2);Dn(fy,5,()=>P(I).sourceChannelIds,Ar,(EE,OE)=>{var py=ze(),TE=ke(py);Dn(TE,1,s,Ar,(RE,my)=>{var gy=ze(),IE=ke(gy);{var CE=_f=>{var by=ni();Ue(()=>yt(by,P(my).name)),q(_f,by)};Qe(IE,_f=>{P(my).id===P(OE)&&_f(CE)})}q(RE,gy)}),q(EE,py)}),z(fy),z(bf),q(Qa,bf)};Qe(mf,Qa=>{P(I).sourceChannelIds.length>0&&Qa(gf)})}Ue(()=>yt(pf,P(I).processingMethod)),q(Xa,qc)};Qe(Bc,Xa=>{P(I).processingMethod&&Xa(Uc)})}z(G),Kn(2),Ue((Xa,qc,Ya,Hc,pf,mf,gf,Qa)=>{yt(U,`${P(I).name??""} è¯¦æ`),yt(Rt,P(I).id),yt(_t,Xa),yt(dn,qc),yt(Fc,`${P(I).sampleRate??""} Hz`),yt(Y,`${Ya??""} ä¸ªæ ·æ¬`),yt(ce,`${Hc??""} s`),yt(J,`${pf??""} / ${mf??""}`),yt(Ht,`${gf??""} / ${Qa??""}`)},[()=>d(P(I).createdAt),()=>d(P(I).updatedAt),()=>P(I).getStats().length,()=>P(I).getStats().duration.toFixed(3),()=>P(I).getStats().min.toFixed(3),()=>P(I).getStats().max.toFixed(3),()=>P(I).getStats().mean.toFixed(3),()=>P(I).getStats().rms.toFixed(3)],fc),q(ee,Z)};Qe(L,ee=>{P(I).id===i()&&ee(W)})}q(O,T)}),q(C,A)},N=C=>{var A=s2();q(C,A)};Qe(D,C=>{i()?C(M):C(N,!1)})}q(k,R)},$$slots:{default:!0}}),q(b,y)},$$slots:{default:!0}})};Qe(f,g=>{s().length===0?g(p):g(m,!1)})}z(h),q(r,h),ot(),n()}const Sg="RFC3986",Pg={RFC1738:r=>String(r).replace(/%20/g,"+"),RFC3986:r=>String(r)},l2="RFC1738",c2=Array.isArray,hr=(()=>{const r=[];for(let e=0;e<256;++e)r.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return r})(),Xf=1024,u2=(r,e,t,n,s)=>{if(r.length===0)return r;let i=r;if(typeof r=="symbol"?i=Symbol.prototype.toString.call(r):typeof r!="string"&&(i=String(r)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let a="";for(let o=0;o<i.length;o+=Xf){const l=i.length>=Xf?i.slice(o,o+Xf):i,c=[];for(let u=0;u<l.length;++u){let d=l.charCodeAt(u);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||s===l2&&(d===40||d===41)){c[c.length]=l.charAt(u);continue}if(d<128){c[c.length]=hr[d];continue}if(d<2048){c[c.length]=hr[192|d>>6]+hr[128|d&63];continue}if(d<55296||d>=57344){c[c.length]=hr[224|d>>12]+hr[128|d>>6&63]+hr[128|d&63];continue}u+=1,d=65536+((d&1023)<<10|l.charCodeAt(u)&1023),c[c.length]=hr[240|d>>18]+hr[128|d>>12&63]+hr[128|d>>6&63]+hr[128|d&63]}a+=c.join("")}return a};function d2(r){return!r||typeof r!="object"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))}function Sv(r,e){if(c2(r)){const t=[];for(let n=0;n<r.length;n+=1)t.push(e(r[n]));return t}return e(r)}const h2=Object.prototype.hasOwnProperty,A1={brackets(r){return String(r)+"[]"},comma:"comma",indices(r,e){return String(r)+"["+e+"]"},repeat(r){return String(r)}},br=Array.isArray,f2=Array.prototype.push,E1=function(r,e){f2.apply(r,br(e)?e:[e])},p2=Date.prototype.toISOString,At={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:u2,encodeValuesOnly:!1,format:Sg,formatter:Pg[Sg],indices:!1,serializeDate(r){return p2.call(r)},skipNulls:!1,strictNullHandling:!1};function m2(r){return typeof r=="string"||typeof r=="number"||typeof r=="boolean"||typeof r=="symbol"||typeof r=="bigint"}const Yf={};function O1(r,e,t,n,s,i,a,o,l,c,u,d,h,f,p,m,g,b){let _=r,y=b,w=0,v=!1;for(;(y=y.get(Yf))!==void 0&&!v;){const D=y.get(r);if(w+=1,typeof D<"u"){if(D===w)throw new RangeError("Cyclic object value");v=!0}typeof y.get(Yf)>"u"&&(w=0)}if(typeof c=="function"?_=c(e,_):_ instanceof Date?_=h==null?void 0:h(_):t==="comma"&&br(_)&&(_=Sv(_,function(D){return D instanceof Date?h==null?void 0:h(D):D})),_===null){if(i)return l&&!m?l(e,At.encoder,g,"key",f):e;_=""}if(m2(_)||d2(_)){if(l){const D=m?e:l(e,At.encoder,g,"key",f);return[(p==null?void 0:p(D))+"="+(p==null?void 0:p(l(_,At.encoder,g,"value",f)))]}return[(p==null?void 0:p(e))+"="+(p==null?void 0:p(String(_)))]}const x=[];if(typeof _>"u")return x;let k;if(t==="comma"&&br(_))m&&l&&(_=Sv(_,l)),k=[{value:_.length>0?_.join(",")||null:void 0}];else if(br(c))k=c;else{const D=Object.keys(_);k=u?D.sort(u):D}const S=o?String(e).replace(/\./g,"%2E"):String(e),R=n&&br(_)&&_.length===1?S+"[]":S;if(s&&br(_)&&_.length===0)return R+"[]";for(let D=0;D<k.length;++D){const M=k[D],N=typeof M=="object"&&typeof M.value<"u"?M.value:_[M];if(a&&N===null)continue;const C=d&&o?M.replace(/\./g,"%2E"):M,A=br(_)?typeof t=="function"?t(R,C):R:R+(d?"."+C:"["+C+"]");b.set(r,w);const E=new WeakMap;E.set(Yf,b),E1(x,O1(N,A,t,n,s,i,a,o,t==="comma"&&m&&br(_)?null:l,c,u,d,h,f,p,m,g,E))}return x}function g2(r=At){if(typeof r.allowEmptyArrays<"u"&&typeof r.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof r.encodeDotInKeys<"u"&&typeof r.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(r.encoder!==null&&typeof r.encoder<"u"&&typeof r.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=r.charset||At.charset;if(typeof r.charset<"u"&&r.charset!=="utf-8"&&r.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Sg;if(typeof r.format<"u"){if(!h2.call(Pg,r.format))throw new TypeError("Unknown format option provided.");t=r.format}const n=Pg[t];let s=At.filter;(typeof r.filter=="function"||br(r.filter))&&(s=r.filter);let i;if(r.arrayFormat&&r.arrayFormat in A1?i=r.arrayFormat:"indices"in r?i=r.indices?"indices":"repeat":i=At.arrayFormat,"commaRoundTrip"in r&&typeof r.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a=typeof r.allowDots>"u"?r.encodeDotInKeys?!0:At.allowDots:!!r.allowDots;return{addQueryPrefix:typeof r.addQueryPrefix=="boolean"?r.addQueryPrefix:At.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof r.allowEmptyArrays=="boolean"?!!r.allowEmptyArrays:At.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof r.charsetSentinel=="boolean"?r.charsetSentinel:At.charsetSentinel,commaRoundTrip:!!r.commaRoundTrip,delimiter:typeof r.delimiter>"u"?At.delimiter:r.delimiter,encode:typeof r.encode=="boolean"?r.encode:At.encode,encodeDotInKeys:typeof r.encodeDotInKeys=="boolean"?r.encodeDotInKeys:At.encodeDotInKeys,encoder:typeof r.encoder=="function"?r.encoder:At.encoder,encodeValuesOnly:typeof r.encodeValuesOnly=="boolean"?r.encodeValuesOnly:At.encodeValuesOnly,filter:s,format:t,formatter:n,serializeDate:typeof r.serializeDate=="function"?r.serializeDate:At.serializeDate,skipNulls:typeof r.skipNulls=="boolean"?r.skipNulls:At.skipNulls,sort:typeof r.sort=="function"?r.sort:null,strictNullHandling:typeof r.strictNullHandling=="boolean"?r.strictNullHandling:At.strictNullHandling}}function b2(r,e={}){let t=r;const n=g2(e);let s,i;typeof n.filter=="function"?(i=n.filter,t=i("",t)):br(n.filter)&&(i=n.filter,s=i);const a=[];if(typeof t!="object"||t===null)return"";const o=A1[n.arrayFormat],l=o==="comma"&&n.commaRoundTrip;s||(s=Object.keys(t)),n.sort&&s.sort(n.sort);const c=new WeakMap;for(let h=0;h<s.length;++h){const f=s[h];n.skipNulls&&t[f]===null||E1(a,O1(t[f],f,o,l,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,c))}const u=a.join(n.delimiter);let d=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),u.length>0?d+u:""}const Gi="4.95.0";let Pv=!1,nl,T1,R1,Ag,I1,C1,$1,M1,N1;function _2(r,e={auto:!1}){if(Pv)throw new Error(`you must \`import 'openai/shims/${r.kind}'\` before importing anything else from openai`);if(nl)throw new Error(`can't \`import 'openai/shims/${r.kind}'\` after \`import 'openai/shims/${nl}'\``);Pv=e.auto,nl=r.kind,T1=r.fetch,R1=r.FormData,Ag=r.File,I1=r.ReadableStream,C1=r.getMultipartRequestOptions,$1=r.getDefaultAgent,M1=r.fileFromPath,N1=r.isFsReadStream}let y2=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function w2({manuallyImported:r}={}){const e=r?"You may need to use polyfills":"Add one of these imports before your first `import â¦ from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,n,s,i;try{t=fetch,n=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new y2(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}const L1=()=>{nl||_2(w2(),{auto:!0})};L1();class ve extends Error{}let yn=class Eg extends ve{constructor(e,t,n,s){super(`${Eg.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"],this.error=t;const i=t;this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,n){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e||!s)return new Ih({message:n,cause:Tg(t)});const i=t==null?void 0:t.error;return e===400?new j1(e,i,n,s):e===401?new D1(e,i,n,s):e===403?new F1(e,i,n,s):e===404?new z1(e,i,n,s):e===409?new B1(e,i,n,s):e===422?new U1(e,i,n,s):e===429?new q1(e,i,n,s):e>=500?new H1(e,i,n,s):new Eg(e,i,n,s)}},bn=class extends yn{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Ih=class extends yn{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},wc=class extends Ih{constructor({message:e}={}){super({message:e??"Request timed out."})}},j1=class extends yn{},D1=class extends yn{},F1=class extends yn{},z1=class extends yn{},B1=class extends yn{},U1=class extends yn{},q1=class extends yn{},H1=class extends yn{};class W1 extends ve{constructor(){super("Could not parse response content as the length limit was reached")}}class V1 extends ve{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var du=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Ks=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},xn;let Ch=class{constructor(){xn.set(this,void 0),this.buffer=new Uint8Array,du(this,xn,null,"f")}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e;let n=new Uint8Array(this.buffer.length+t.length);n.set(this.buffer),n.set(t,this.buffer.length),this.buffer=n;const s=[];let i;for(;(i=v2(this.buffer,Ks(this,xn,"f")))!=null;){if(i.carriage&&Ks(this,xn,"f")==null){du(this,xn,i.index,"f");continue}if(Ks(this,xn,"f")!=null&&(i.index!==Ks(this,xn,"f")+1||i.carriage)){s.push(this.decodeText(this.buffer.slice(0,Ks(this,xn,"f")-1))),this.buffer=this.buffer.slice(Ks(this,xn,"f")),du(this,xn,null,"f");continue}const a=Ks(this,xn,"f")!==null?i.preceding-1:i.preceding,o=this.decodeText(this.buffer.slice(0,a));s.push(o),this.buffer=this.buffer.slice(i.index),du(this,xn,null,"f")}return s}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new ve(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new ve(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new ve("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}};xn=new WeakMap;Ch.NEWLINE_CHARS=new Set([`
`,"\r"]);Ch.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function v2(r,e){for(let s=e??0;s<r.length;s++){if(r[s]===10)return{preceding:s,index:s+1,carriage:!1};if(r[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function x2(r){for(let n=0;n<r.length-1;n++){if(r[n]===10&&r[n+1]===10||r[n]===13&&r[n+1]===13)return n+2;if(r[n]===13&&r[n+1]===10&&n+3<r.length&&r[n+2]===13&&r[n+3]===10)return n+4}return-1}function G1(r){if(r[Symbol.asyncIterator])return r;const e=r.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}let Pl=class Fo{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;async function*s(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(const a of k2(e,t))if(!i){if(a.data.startsWith("[DONE]")){i=!0;continue}if(a.event===null||a.event.startsWith("response.")||a.event.startsWith("transcript.")){let o;try{o=JSON.parse(a.data)}catch(l){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),l}if(o&&o.error)throw new yn(void 0,o.error,void 0,nP(e.headers));yield o}else{let o;try{o=JSON.parse(a.data)}catch(l){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),l}if(a.event=="error")throw new yn(void 0,o.error,o.message,void 0);yield{event:a.event,data:o}}}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new Fo(s,t)}static fromReadableStream(e,t){let n=!1;async function*s(){const a=new Ch,o=G1(e);for await(const l of o)for(const c of a.decode(l))yield c;for(const l of a.flush())yield l}async function*i(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(const o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new Fo(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=n.next();e.push(a),t.push(a)}return i.shift()}});return[new Fo(()=>s(e),this.controller),new Fo(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new I1({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:a}=await t.next();if(a)return s.close();const o=n.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}};async function*k2(r,e){if(!r.body)throw e.abort(),new ve("Attempted to iterate over a response with no body");const t=new P2,n=new Ch,s=G1(r.body);for await(const i of S2(s))for(const a of n.decode(i)){const o=t.decode(a);o&&(yield o)}for(const i of n.flush()){const a=t.decode(i);a&&(yield a)}}async function*S2(r){let e=new Uint8Array;for await(const t of r){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+n.length);s.set(e),s.set(n,e.length),e=s;let i;for(;(i=x2(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}let P2=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=A2(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function A2(r,e){const t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}const Z1=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function",J1=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&$h(r),$h=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",E2=r=>J1(r)||Z1(r)||N1(r);async function K1(r,e,t){var s;if(r=await r,J1(r))return r;if(Z1(r)){const i=await r.blob();e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=$h(i)?[await i.arrayBuffer()]:[i];return new Ag(a,e,t)}const n=await O2(r);if(e||(e=R2(r)??"unknown_file"),!(t!=null&&t.type)){const i=(s=n[0])==null?void 0:s.type;typeof i=="string"&&(t={...t,type:i})}return new Ag(n,e,t)}async function O2(r){var t;let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if($h(r))e.push(await r.arrayBuffer());else if(I2(r))for await(const n of r)e.push(n);else throw new Error(`Unexpected data type: ${typeof r}; constructor: ${(t=r==null?void 0:r.constructor)==null?void 0:t.name}; props: ${T2(r)}`);return e}function T2(r){return`[${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}function R2(r){var e;return Qf(r.name)||Qf(r.filename)||((e=Qf(r.path))==null?void 0:e.split(/[\\/]/).pop())}const Qf=r=>{if(typeof r=="string")return r;if(typeof Buffer<"u"&&r instanceof Buffer)return String(r)},I2=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",Av=r=>r&&typeof r=="object"&&r.body&&r[Symbol.toStringTag]==="MultipartBody",Ia=async r=>{const e=await C2(r.body);return C1(e,r)},C2=async r=>{const e=new R1;return await Promise.all(Object.entries(r||{}).map(([t,n])=>Og(e,t,n))),e},Og=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(E2(t)){const n=await K1(t);r.append(e,n)}else if(Array.isArray(t))await Promise.all(t.map(n=>Og(r,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,s])=>Og(r,`${e}[${n}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var ua={},$2=function(r,e,t,n,s){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t},M2=function(r,e,t,n){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},hu;L1();async function X1(r){var a;const{response:e}=r;if(r.options.stream)return Es("response",e.status,e.url,e.headers,e.body),r.options.__streamClass?r.options.__streamClass.fromSSEResponse(e,r.controller):Pl.fromSSEResponse(e,r.controller);if(e.status===204)return null;if(r.options.__binaryResponse)return e;const t=e.headers.get("content-type"),n=(a=t==null?void 0:t.split(";")[0])==null?void 0:a.trim();if((n==null?void 0:n.includes("application/json"))||(n==null?void 0:n.endsWith("+json"))){const o=await e.json();return Es("response",e.status,e.url,e.headers,o),Y1(o,e)}const i=await e.text();return Es("response",e.status,e.url,e.headers,i),i}function Y1(r,e){return!r||typeof r!="object"||Array.isArray(r)?r:Object.defineProperty(r,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}let Q1=class eP extends Promise{constructor(e,t=X1){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new eP(this.responsePromise,async t=>Y1(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},N2=class{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=ep("maxRetries",t),this.timeout=ep("timeout",n),this.httpAgent=s,this.fetch=i??T1}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...z2(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${H2()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(async s=>{const i=s&&$h(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var m;const n={...e},{method:s,path:i,query:a,headers:o={}}=n,l=ArrayBuffer.isView(n.body)||n.__binaryRequest&&typeof n.body=="string"?n.body:Av(n.body)?n.body.body:n.body?JSON.stringify(n.body,null,2):null,c=this.calculateContentLength(l),u=this.buildURL(i,a);"timeout"in n&&ep("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const d=n.httpAgent??this.httpAgent??$1(u),h=n.timeout+1e3;typeof((m=d==null?void 0:d.options)==null?void 0:m.timeout)=="number"&&h>(d.options.timeout??0)&&(d.options.timeout=h),this.idempotencyHeader&&s!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);const f=this.buildHeaders({options:n,headers:o,contentLength:c,retryCount:t});return{req:{method:s,...l&&{body:l},headers:f,...d&&{agent:d},signal:n.signal??null},url:u,timeout:n.timeout}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:s}){const i={};n&&(i["content-length"]=n);const a=this.defaultHeaders(e);return Rv(i,a),Rv(i,t),Av(e.body)&&nl!=="node"&&delete i["content-type"],pu(a,"x-stainless-retry-count")===void 0&&pu(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),pu(a,"x-stainless-timeout")===void 0&&pu(t,"x-stainless-timeout")===void 0&&e.timeout&&(i["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,s){return yn.generate(e,t,n,s)}request(e,t=null){return new Q1(this.makeRequest(e,t))}async makeRequest(e,t){var d,h;const n=await e,s=n.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(n);const{req:i,url:a,timeout:o}=this.buildRequest(n,{retryCount:s-t});if(await this.prepareRequest(i,{url:a,options:n}),Es("request",a,n,i.headers),(d=n.signal)!=null&&d.aborted)throw new bn;const l=new AbortController,c=await this.fetchWithTimeout(a,i,o,l).catch(Tg);if(c instanceof Error){if((h=n.signal)!=null&&h.aborted)throw new bn;if(t)return this.retryRequest(n,t);throw c.name==="AbortError"?new wc:new Ih({cause:c})}const u=nP(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){const _=`retrying, ${t} attempts remaining`;return Es(`response (error; ${_})`,c.status,a,u),this.retryRequest(n,t,u)}const f=await c.text().catch(_=>Tg(_).message),p=B2(f),m=p?void 0:f;throw Es(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,a,u,m),this.makeStatusError(c.status,p,m,u)}return{response:c,options:n,controller:l}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new L2(this,n,e)}buildURL(e,t){const n=q2(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return rP(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new ve(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,s){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),n),l={signal:s.signal,...a};return l.method&&(l.method=l.method.toUpperCase()),this.fetch.call(void 0,e,l).finally(()=>{clearTimeout(o)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){let s;const i=n==null?void 0:n["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(s=o)}const a=n==null?void 0:n["retry-after"];if(a&&!s){const o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await vc(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Gi}`}},tP=class{constructor(e,t,n,s){hu.set(this,void 0),$2(this,hu,e),this.options=s,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new ve("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of n)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await M2(this,hu,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(hu=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}},L2=class extends Q1{constructor(e,t,n){super(t,async s=>new n(e,s.response,await X1(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}};const nP=r=>new Proxy(Object.fromEntries(r.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),j2={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},bt=r=>typeof r=="object"&&r!==null&&!rP(r)&&Object.keys(r).every(e=>sP(j2,e)),D2=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Gi,"X-Stainless-OS":Ov(Deno.build.os),"X-Stainless-Arch":Ev(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Gi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Gi,"X-Stainless-OS":Ov(process.platform),"X-Stainless-Arch":Ev(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const r=F2();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Gi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Gi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function F2(){if(typeof navigator>"u"||!navigator)return null;const r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of r){const n=t.exec(navigator.userAgent);if(n){const s=n[1]||0,i=n[2]||0,a=n[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const Ev=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",Ov=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown");let Tv;const z2=()=>Tv??(Tv=D2()),B2=r=>{try{return JSON.parse(r)}catch{return}},U2=/^[a-z][a-z0-9+.-]*:/i,q2=r=>U2.test(r),vc=r=>new Promise(e=>setTimeout(e,r)),ep=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new ve(`${r} must be an integer`);if(e<0)throw new ve(`${r} must be a positive integer`);return e},Tg=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null)try{return new Error(JSON.stringify(r))}catch{}return new Error(r)},fu=r=>{var e,t,n,s;if(typeof process<"u")return((e=ua==null?void 0:ua[r])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(s=(n=(t=Deno.env)==null?void 0:t.get)==null?void 0:n.call(t,r))==null?void 0:s.trim()};function rP(r){if(!r)return!0;for(const e in r)return!1;return!0}function sP(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function Rv(r,e){for(const t in e){if(!sP(e,t))continue;const n=t.toLowerCase();if(!n)continue;const s=e[t];s===null?delete r[n]:s!==void 0&&(r[n]=s)}}const Iv=new Set(["authorization","api-key"]);function Es(r,...e){if(typeof process<"u"&&(ua==null?void 0:ua.DEBUG)==="true"){const t=e.map(n=>{if(!n)return n;if(n.headers){const i={...n,headers:{...n.headers}};for(const a in n.headers)Iv.has(a.toLowerCase())&&(i.headers[a]="REDACTED");return i}let s=null;for(const i in n)Iv.has(i.toLowerCase())&&(s??(s={...n}),s[i]="REDACTED");return s??n});console.log(`OpenAI:DEBUG:${r}`,...t)}}const H2=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)}),W2=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",V2=r=>typeof(r==null?void 0:r.get)=="function",pu=(r,e)=>{var n;const t=e.toLowerCase();if(V2(r)){const s=((n=e[0])==null?void 0:n.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,a,o)=>a+o.toUpperCase());for(const i of[e,t,e.toUpperCase(),s]){const a=r.get(i);if(a)return a}}for(const[s,i]of Object.entries(r))if(s.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i},G2=r=>{if(typeof Buffer<"u"){const e=Buffer.from(r,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(r),t=e.length,n=new Uint8Array(t);for(let s=0;s<t;s++)n[s]=e.charCodeAt(s);return Array.from(new Float32Array(n.buffer))}};function tp(r){return r!=null&&typeof r=="object"&&!Array.isArray(r)}let Mh=class extends tP{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}};class Bt extends tP{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var n;const e=this.getPaginatedItems();if(!e.length)return null;const t=(n=e[e.length-1])==null?void 0:n.id;return t?{params:{after:t}}:null}}let Re=class{constructor(e){this._client=e}},iP=class extends Re{list(e,t={},n){return bt(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,Z2,{query:t,...n})}},Nh=class extends Re{constructor(){super(...arguments),this.messages=new iP(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return bt(e)?this.list({},e):this._client.getAPIList("/chat/completions",Lh,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}};class Lh extends Bt{}class Z2 extends Bt{}Nh.ChatCompletionsPage=Lh;Nh.Messages=iP;let jh=class extends Re{constructor(){super(...arguments),this.completions=new Nh(this._client)}};jh.Completions=Nh;jh.ChatCompletionsPage=Lh;class aP extends Re{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t==null?void 0:t.headers},__binaryResponse:!0})}}class oP extends Re{create(e,t){return this._client.post("/audio/transcriptions",Ia({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}}class lP extends Re{create(e,t){return this._client.post("/audio/translations",Ia({body:e,...t,__metadata:{model:e.model}}))}}class xc extends Re{constructor(){super(...arguments),this.transcriptions=new oP(this._client),this.translations=new lP(this._client),this.speech=new aP(this._client)}}xc.Transcriptions=oP;xc.Translations=lP;xc.Speech=aP;let Zb=class extends Re{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return bt(e)?this.list({},e):this._client.getAPIList("/batches",Jb,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}};class Jb extends Bt{}Zb.BatchesPage=Jb;class Kb extends Re{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return bt(e)?this.list({},e):this._client.getAPIList("/assistants",Xb,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Xb extends Bt{}Kb.AssistantsPage=Xb;function Cv(r){return typeof r.parse=="function"}const da=r=>(r==null?void 0:r.role)==="assistant",cP=r=>(r==null?void 0:r.role)==="function",uP=r=>(r==null?void 0:r.role)==="tool";var Gn=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},ht=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Rg,ud,dd,zo,Bo,hd,Uo,zr,qo,Id,Cd,Zi,dP;class Yb{constructor(){Rg.add(this),this.controller=new AbortController,ud.set(this,void 0),dd.set(this,()=>{}),zo.set(this,()=>{}),Bo.set(this,void 0),hd.set(this,()=>{}),Uo.set(this,()=>{}),zr.set(this,{}),qo.set(this,!1),Id.set(this,!1),Cd.set(this,!1),Zi.set(this,!1),Gn(this,ud,new Promise((e,t)=>{Gn(this,dd,e,"f"),Gn(this,zo,t,"f")}),"f"),Gn(this,Bo,new Promise((e,t)=>{Gn(this,hd,e,"f"),Gn(this,Uo,t,"f")}),"f"),ht(this,ud,"f").catch(()=>{}),ht(this,Bo,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},ht(this,Rg,"m",dP).bind(this))},0)}_connected(){this.ended||(ht(this,dd,"f").call(this),this._emit("connect"))}get ended(){return ht(this,qo,"f")}get errored(){return ht(this,Id,"f")}get aborted(){return ht(this,Cd,"f")}abort(){this.controller.abort()}on(e,t){return(ht(this,zr,"f")[e]||(ht(this,zr,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=ht(this,zr,"f")[e];if(!n)return this;const s=n.findIndex(i=>i.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(ht(this,zr,"f")[e]||(ht(this,zr,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{Gn(this,Zi,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){Gn(this,Zi,!0,"f"),await ht(this,Bo,"f")}_emit(e,...t){if(ht(this,qo,"f"))return;e==="end"&&(Gn(this,qo,!0,"f"),ht(this,hd,"f").call(this));const n=ht(this,zr,"f")[e];if(n&&(ht(this,zr,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!ht(this,Zi,"f")&&!(n!=null&&n.length)&&Promise.reject(s),ht(this,zo,"f").call(this,s),ht(this,Uo,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!ht(this,Zi,"f")&&!(n!=null&&n.length)&&Promise.reject(s),ht(this,zo,"f").call(this,s),ht(this,Uo,"f").call(this,s),this._emit("end")}}_emitFinal(){}}ud=new WeakMap,dd=new WeakMap,zo=new WeakMap,Bo=new WeakMap,hd=new WeakMap,Uo=new WeakMap,zr=new WeakMap,qo=new WeakMap,Id=new WeakMap,Cd=new WeakMap,Zi=new WeakMap,Rg=new WeakSet,dP=function(e){if(Gn(this,Id,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new bn),e instanceof bn)return Gn(this,Cd,!0,"f"),this._emit("abort",e);if(e instanceof ve)return this._emit("error",e);if(e instanceof Error){const t=new ve(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new ve(String(e)))};function J2(r,e){const t={...r};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function Qb(r){return(r==null?void 0:r.$brand)==="auto-parseable-response-format"}function K2(r,{parser:e,callback:t}){const n={...r};return Object.defineProperties(n,{$brand:{value:"auto-parseable-tool",enumerable:!1},$parseRaw:{value:e,enumerable:!1},$callback:{value:t,enumerable:!1}}),n}function kc(r){return(r==null?void 0:r.$brand)==="auto-parseable-tool"}function X2(r,e){return!e||!hP(e)?{...r,choices:r.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:e_(r,e)}function e_(r,e){const t=r.choices.map(n=>{var s;if(n.finish_reason==="length")throw new W1;if(n.finish_reason==="content_filter")throw new V1;return{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:((s=n.message.tool_calls)==null?void 0:s.map(i=>Q2(e,i)))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?Y2(e,n.message.content):null}}});return{...r,choices:t}}function Y2(r,e){var t,n;return((t=r.response_format)==null?void 0:t.type)!=="json_schema"?null:((n=r.response_format)==null?void 0:n.type)==="json_schema"?"$parseRaw"in r.response_format?r.response_format.$parseRaw(e):JSON.parse(e):null}function Q2(r,e){var n;const t=(n=r.tools)==null?void 0:n.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:kc(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function ej(r,e){var n;if(!r)return!1;const t=(n=r.tools)==null?void 0:n.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return kc(t)||(t==null?void 0:t.function.strict)||!1}function hP(r){var e;return Qb(r.response_format)?!0:((e=r.tools)==null?void 0:e.some(t=>kc(t)||t.type==="function"&&t.function.strict===!0))??!1}function tj(r){for(const e of r??[]){if(e.type!=="function")throw new ve(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new ve(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var mn=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Gt,Ig,$d,Cg,$g,Mg,fP,Ng;const $v=10;class pP extends Yb{constructor(){super(...arguments),Gt.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(n=e.choices[0])==null?void 0:n.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(cP(e)||uP(e))&&e.content)this._emit("functionCallResult",e.content);else if(da(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(da(e)&&e.tool_calls)for(const n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new ve("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),mn(this,Gt,"m",Ig).call(this)}async finalMessage(){return await this.done(),mn(this,Gt,"m",$d).call(this)}async finalFunctionCall(){return await this.done(),mn(this,Gt,"m",Cg).call(this)}async finalFunctionCallResult(){return await this.done(),mn(this,Gt,"m",$g).call(this)}async totalUsage(){return await this.done(),mn(this,Gt,"m",Mg).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=mn(this,Gt,"m",$d).call(this);t&&this._emit("finalMessage",t);const n=mn(this,Gt,"m",Ig).call(this);n&&this._emit("finalContent",n);const s=mn(this,Gt,"m",Cg).call(this);s&&this._emit("finalFunctionCall",s);const i=mn(this,Gt,"m",$g).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",mn(this,Gt,"m",Mg).call(this))}async _createChatCompletion(e,t,n){const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),mn(this,Gt,"m",fP).call(this,t);const i=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(e_(i,t))}async _runChatCompletion(e,t,n){for(const s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){var h;const s="function",{function_call:i="auto",stream:a,...o}=t,l=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:c=$v}=n||{},u={};for(const f of t.functions)u[f.name||f.function.name]=f;const d=t.functions.map(f=>({name:f.name||f.function.name,parameters:f.parameters,description:f.description}));for(const f of t.messages)this._addMessage(f,!1);for(let f=0;f<c;++f){const m=(h=(await this._createChatCompletion(e,{...o,function_call:i,functions:d,messages:[...this.messages]},n)).choices[0])==null?void 0:h.message;if(!m)throw new ve("missing message in ChatCompletion response");if(!m.function_call)return;const{name:g,arguments:b}=m.function_call,_=u[g];if(_){if(l&&l!==g){const x=`Invalid function_call: ${JSON.stringify(g)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,name:g,content:x});continue}}else{const x=`Invalid function_call: ${JSON.stringify(g)}. Available options are: ${d.map(k=>JSON.stringify(k.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:g,content:x});continue}let y;try{y=Cv(_)?await _.parse(b):b}catch(x){this._addMessage({role:s,name:g,content:x instanceof Error?x.message:String(x)});continue}const w=await _.function(y,this),v=mn(this,Gt,"m",Ng).call(this,w);if(this._addMessage({role:s,name:g,content:v}),l)return}}async _runTools(e,t,n){var f,p,m;const s="tool",{tool_choice:i="auto",stream:a,...o}=t,l=typeof i!="string"&&((f=i==null?void 0:i.function)==null?void 0:f.name),{maxChatCompletions:c=$v}=n||{},u=t.tools.map(g=>{if(kc(g)){if(!g.$callback)throw new ve("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:g.$callback,name:g.function.name,description:g.function.description||"",parameters:g.function.parameters,parse:g.$parseRaw,strict:!0}}}return g}),d={};for(const g of u)g.type==="function"&&(d[g.function.name||g.function.function.name]=g.function);const h="tools"in t?u.map(g=>g.type==="function"?{type:"function",function:{name:g.function.name||g.function.function.name,parameters:g.function.parameters,description:g.function.description,strict:g.function.strict}}:g):void 0;for(const g of t.messages)this._addMessage(g,!1);for(let g=0;g<c;++g){const _=(p=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:h,messages:[...this.messages]},n)).choices[0])==null?void 0:p.message;if(!_)throw new ve("missing message in ChatCompletion response");if(!((m=_.tool_calls)!=null&&m.length))return;for(const y of _.tool_calls){if(y.type!=="function")continue;const w=y.id,{name:v,arguments:x}=y.function,k=d[v];if(k){if(l&&l!==v){const M=`Invalid tool_call: ${JSON.stringify(v)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,tool_call_id:w,content:M});continue}}else{const M=`Invalid tool_call: ${JSON.stringify(v)}. Available options are: ${Object.keys(d).map(N=>JSON.stringify(N)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:w,content:M});continue}let S;try{S=Cv(k)?await k.parse(x):x}catch(M){const N=M instanceof Error?M.message:String(M);this._addMessage({role:s,tool_call_id:w,content:N});continue}const R=await k.function(S,this),D=mn(this,Gt,"m",Ng).call(this,R);if(this._addMessage({role:s,tool_call_id:w,content:D}),l)return}}}}Gt=new WeakSet,Ig=function(){return mn(this,Gt,"m",$d).call(this).content??null},$d=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(da(t)){const{function_call:n,...s}=t,i={...s,content:t.content??null,refusal:t.refusal??null};return n&&(i.function_call=n),i}}throw new ve("stream ended without producing a ChatCompletionMessage with role=assistant")},Cg=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){const s=this.messages[n];if(da(s)&&(s!=null&&s.function_call))return s.function_call;if(da(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},$g=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(cP(t)&&t.content!=null||uP(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>{var s;return n.role==="assistant"&&((s=n.tool_calls)==null?void 0:s.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},Mg=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},fP=function(e){if(e.n!=null&&e.n>1)throw new ve("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Ng=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Al extends pP{static runFunctions(e,t,n){const s=new Al,i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,n){const s=new Al,i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e,t=!0){super._addMessage(e,t),da(e)&&e.content&&this._emit("content",e.content)}}const mP=1,gP=2,bP=4,_P=8,yP=16,wP=32,vP=64,xP=128,kP=256,SP=xP|kP,PP=yP|wP|SP|vP,AP=mP|gP|PP,EP=bP|_P,nj=AP|EP,$t={STR:mP,NUM:gP,ARR:bP,OBJ:_P,NULL:yP,BOOL:wP,NAN:vP,INFINITY:xP,MINUS_INFINITY:kP,INF:SP,SPECIAL:PP,ATOM:AP,COLLECTION:EP,ALL:nj};class rj extends Error{}class sj extends Error{}function ij(r,e=$t.ALL){if(typeof r!="string")throw new TypeError(`expecting str, got ${typeof r}`);if(!r.trim())throw new Error(`${r} is empty`);return aj(r.trim(),e)}const aj=(r,e)=>{const t=r.length;let n=0;const s=h=>{throw new rj(`${h} at position ${n}`)},i=h=>{throw new sj(`${h} at position ${n}`)},a=()=>(d(),n>=t&&s("Unexpected end of input"),r[n]==='"'?o():r[n]==="{"?l():r[n]==="["?c():r.substring(n,n+4)==="null"||$t.NULL&e&&t-n<4&&"null".startsWith(r.substring(n))?(n+=4,null):r.substring(n,n+4)==="true"||$t.BOOL&e&&t-n<4&&"true".startsWith(r.substring(n))?(n+=4,!0):r.substring(n,n+5)==="false"||$t.BOOL&e&&t-n<5&&"false".startsWith(r.substring(n))?(n+=5,!1):r.substring(n,n+8)==="Infinity"||$t.INFINITY&e&&t-n<8&&"Infinity".startsWith(r.substring(n))?(n+=8,1/0):r.substring(n,n+9)==="-Infinity"||$t.MINUS_INFINITY&e&&1<t-n&&t-n<9&&"-Infinity".startsWith(r.substring(n))?(n+=9,-1/0):r.substring(n,n+3)==="NaN"||$t.NAN&e&&t-n<3&&"NaN".startsWith(r.substring(n))?(n+=3,NaN):u()),o=()=>{const h=n;let f=!1;for(n++;n<t&&(r[n]!=='"'||f&&r[n-1]==="\\");)f=r[n]==="\\"?!f:!1,n++;if(r.charAt(n)=='"')try{return JSON.parse(r.substring(h,++n-Number(f)))}catch(p){i(String(p))}else if($t.STR&e)try{return JSON.parse(r.substring(h,n-Number(f))+'"')}catch{return JSON.parse(r.substring(h,r.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},l=()=>{n++,d();const h={};try{for(;r[n]!=="}";){if(d(),n>=t&&$t.OBJ&e)return h;const f=o();d(),n++;try{const p=a();Object.defineProperty(h,f,{value:p,writable:!0,enumerable:!0,configurable:!0})}catch(p){if($t.OBJ&e)return h;throw p}d(),r[n]===","&&n++}}catch{if($t.OBJ&e)return h;s("Expected '}' at end of object")}return n++,h},c=()=>{n++;const h=[];try{for(;r[n]!=="]";)h.push(a()),d(),r[n]===","&&n++}catch{if($t.ARR&e)return h;s("Expected ']' at end of array")}return n++,h},u=()=>{if(n===0){r==="-"&&$t.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(r)}catch(f){if($t.NUM&e)try{return r[r.length-1]==="."?JSON.parse(r.substring(0,r.lastIndexOf("."))):JSON.parse(r.substring(0,r.lastIndexOf("e")))}catch{}i(String(f))}}const h=n;for(r[n]==="-"&&n++;r[n]&&!",]}".includes(r[n]);)n++;n==t&&!($t.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(r.substring(h,n))}catch{r.substring(h,n)==="-"&&$t.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(r.substring(h,r.lastIndexOf("e")))}catch(p){i(String(p))}}},d=()=>{for(;n<t&&` 
\r	`.includes(r[n]);)n++};return a()},Mv=r=>ij(r,$t.ALL^$t.NUM);var Di=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Ye=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Pt,Mr,Fi,ls,np,mu,rp,sp,ip,gu,ap,Nv;class El extends pP{constructor(e){super(),Pt.add(this),Mr.set(this,void 0),Fi.set(this,void 0),ls.set(this,void 0),Di(this,Mr,e,"f"),Di(this,Fi,[],"f")}get currentChatCompletionSnapshot(){return Ye(this,ls,"f")}static fromReadableStream(e){const t=new El(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const s=new El(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,n){var a;super._createChatCompletion;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Ye(this,Pt,"m",np).call(this);const i=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of i)Ye(this,Pt,"m",rp).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new bn;return this._addChatCompletion(Ye(this,Pt,"m",gu).call(this))}async _fromReadableStream(e,t){var a;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),Ye(this,Pt,"m",np).call(this),this._connected();const s=Pl.fromReadableStream(e,this.controller);let i;for await(const o of s)i&&i!==o.id&&this._addChatCompletion(Ye(this,Pt,"m",gu).call(this)),Ye(this,Pt,"m",rp).call(this,o),i=o.id;if((a=s.controller.signal)!=null&&a.aborted)throw new bn;return this._addChatCompletion(Ye(this,Pt,"m",gu).call(this))}[(Mr=new WeakMap,Fi=new WeakMap,ls=new WeakMap,Pt=new WeakSet,np=function(){this.ended||Di(this,ls,void 0,"f")},mu=function(t){let n=Ye(this,Fi,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Ye(this,Fi,"f")[t.index]=n,n)},rp=function(t){var s,i,a,o,l,c,u,d,h,f,p,m,g,b,_;if(this.ended)return;const n=Ye(this,Pt,"m",Nv).call(this,t);this._emit("chunk",t,n);for(const y of t.choices){const w=n.choices[y.index];y.delta.content!=null&&((s=w.message)==null?void 0:s.role)==="assistant"&&((i=w.message)!=null&&i.content)&&(this._emit("content",y.delta.content,w.message.content),this._emit("content.delta",{delta:y.delta.content,snapshot:w.message.content,parsed:w.message.parsed})),y.delta.refusal!=null&&((a=w.message)==null?void 0:a.role)==="assistant"&&((o=w.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:y.delta.refusal,snapshot:w.message.refusal}),((l=y.logprobs)==null?void 0:l.content)!=null&&((c=w.message)==null?void 0:c.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(u=y.logprobs)==null?void 0:u.content,snapshot:((d=w.logprobs)==null?void 0:d.content)??[]}),((h=y.logprobs)==null?void 0:h.refusal)!=null&&((f=w.message)==null?void 0:f.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(p=y.logprobs)==null?void 0:p.refusal,snapshot:((m=w.logprobs)==null?void 0:m.refusal)??[]});const v=Ye(this,Pt,"m",mu).call(this,w);w.finish_reason&&(Ye(this,Pt,"m",ip).call(this,w),v.current_tool_call_index!=null&&Ye(this,Pt,"m",sp).call(this,w,v.current_tool_call_index));for(const x of y.delta.tool_calls??[])v.current_tool_call_index!==x.index&&(Ye(this,Pt,"m",ip).call(this,w),v.current_tool_call_index!=null&&Ye(this,Pt,"m",sp).call(this,w,v.current_tool_call_index)),v.current_tool_call_index=x.index;for(const x of y.delta.tool_calls??[]){const k=(g=w.message.tool_calls)==null?void 0:g[x.index];k!=null&&k.type&&((k==null?void 0:k.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(b=k.function)==null?void 0:b.name,index:x.index,arguments:k.function.arguments,parsed_arguments:k.function.parsed_arguments,arguments_delta:((_=x.function)==null?void 0:_.arguments)??""}):(k==null||k.type,void 0))}}},sp=function(t,n){var a,o,l;if(Ye(this,Pt,"m",mu).call(this,t).done_tool_calls.has(n))return;const i=(a=t.message.tool_calls)==null?void 0:a[n];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){const c=(l=(o=Ye(this,Mr,"f"))==null?void 0:o.tools)==null?void 0:l.find(u=>u.type==="function"&&u.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:n,arguments:i.function.arguments,parsed_arguments:kc(c)?c.$parseRaw(i.function.arguments):c!=null&&c.function.strict?JSON.parse(i.function.arguments):null})}else i.type},ip=function(t){var s,i;const n=Ye(this,Pt,"m",mu).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;const a=Ye(this,Pt,"m",ap).call(this);this._emit("content.done",{content:t.message.content,parsed:a?a.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(s=t.logprobs)!=null&&s.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(i=t.logprobs)!=null&&i.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},gu=function(){if(this.ended)throw new ve("stream has ended, this shouldn't happen");const t=Ye(this,ls,"f");if(!t)throw new ve("request ended without sending any chunks");return Di(this,ls,void 0,"f"),Di(this,Fi,[],"f"),oj(t,Ye(this,Mr,"f"))},ap=function(){var n;const t=(n=Ye(this,Mr,"f"))==null?void 0:n.response_format;return Qb(t)?t:null},Nv=function(t){var n,s,i,a;let o=Ye(this,ls,"f");const{choices:l,...c}=t;o?Object.assign(o,c):o=Di(this,ls,{...c,choices:[]},"f");for(const{delta:u,finish_reason:d,index:h,logprobs:f=null,...p}of t.choices){let m=o.choices[h];if(m||(m=o.choices[h]={finish_reason:d,index:h,message:{},logprobs:f,...p}),f)if(!m.logprobs)m.logprobs=Object.assign({},f);else{const{content:x,refusal:k,...S}=f;Object.assign(m.logprobs,S),x&&((n=m.logprobs).content??(n.content=[]),m.logprobs.content.push(...x)),k&&((s=m.logprobs).refusal??(s.refusal=[]),m.logprobs.refusal.push(...k))}if(d&&(m.finish_reason=d,Ye(this,Mr,"f")&&hP(Ye(this,Mr,"f")))){if(d==="length")throw new W1;if(d==="content_filter")throw new V1}if(Object.assign(m,p),!u)continue;const{content:g,refusal:b,function_call:_,role:y,tool_calls:w,...v}=u;if(Object.assign(m.message,v),b&&(m.message.refusal=(m.message.refusal||"")+b),y&&(m.message.role=y),_&&(m.message.function_call?(_.name&&(m.message.function_call.name=_.name),_.arguments&&((i=m.message.function_call).arguments??(i.arguments=""),m.message.function_call.arguments+=_.arguments)):m.message.function_call=_),g&&(m.message.content=(m.message.content||"")+g,!m.message.refusal&&Ye(this,Pt,"m",ap).call(this)&&(m.message.parsed=Mv(m.message.content))),w){m.message.tool_calls||(m.message.tool_calls=[]);for(const{index:x,id:k,type:S,function:R,...D}of w){const M=(a=m.message.tool_calls)[x]??(a[x]={});Object.assign(M,D),k&&(M.id=k),S&&(M.type=S),R&&(M.function??(M.function={name:R.name??"",arguments:""})),R!=null&&R.name&&(M.function.name=R.name),R!=null&&R.arguments&&(M.function.arguments+=R.arguments,ej(Ye(this,Mr,"f"),M)&&(M.function.parsed_arguments=Mv(M.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Pl(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function oj(r,e){const{id:t,choices:n,created:s,model:i,system_fingerprint:a,...o}=r,l={...o,id:t,choices:n.map(({message:c,finish_reason:u,index:d,logprobs:h,...f})=>{if(!u)throw new ve(`missing finish_reason for choice ${d}`);const{content:p=null,function_call:m,tool_calls:g,...b}=c,_=c.role;if(!_)throw new ve(`missing role for choice ${d}`);if(m){const{arguments:y,name:w}=m;if(y==null)throw new ve(`missing function_call.arguments for choice ${d}`);if(!w)throw new ve(`missing function_call.name for choice ${d}`);return{...f,message:{content:p,function_call:{arguments:y,name:w},role:_,refusal:c.refusal??null},finish_reason:u,index:d,logprobs:h}}return g?{...f,index:d,finish_reason:u,logprobs:h,message:{...b,role:_,content:p,refusal:c.refusal??null,tool_calls:g.map((y,w)=>{const{function:v,type:x,id:k,...S}=y,{arguments:R,name:D,...M}=v||{};if(k==null)throw new ve(`missing choices[${d}].tool_calls[${w}].id
${bu(r)}`);if(x==null)throw new ve(`missing choices[${d}].tool_calls[${w}].type
${bu(r)}`);if(D==null)throw new ve(`missing choices[${d}].tool_calls[${w}].function.name
${bu(r)}`);if(R==null)throw new ve(`missing choices[${d}].tool_calls[${w}].function.arguments
${bu(r)}`);return{...S,id:k,type:x,function:{...M,name:D,arguments:R}}})}}:{...f,message:{...b,content:p,role:_,refusal:c.refusal??null},finish_reason:u,index:d,logprobs:h}}),created:s,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return X2(l,e)}function bu(r){return JSON.stringify(r)}class ha extends El{static fromReadableStream(e){const t=new ha(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,n){const s=new ha(null),i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,n){const s=new ha(t),i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}}let OP=class extends Re{parse(e,t){return tj(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(n=>e_(n,e))}runFunctions(e,t){return e.stream?ha.runFunctions(this._client,e,t):Al.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?ha.runTools(this._client,e,t):Al.runTools(this._client,e,t)}stream(e,t){return El.createChatCompletion(this._client,e,t)}};class Lg extends Re{constructor(){super(...arguments),this.completions=new OP(this._client)}}(function(r){r.Completions=OP})(Lg||(Lg={}));class TP extends Re{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class RP extends Re{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Dh extends Re{constructor(){super(...arguments),this.sessions=new TP(this._client),this.transcriptionSessions=new RP(this._client)}}Dh.Sessions=TP;Dh.TranscriptionSessions=RP;var ue=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},vn=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},zt,jg,_r,fd,Jn,ii,ea,ti,Md,Pn,pd,md,rl,Ho,Wo,Lv,jv,Dv,Fv,zv,Bv,Uv;class Yn extends Yb{constructor(){super(...arguments),zt.add(this),jg.set(this,[]),_r.set(this,{}),fd.set(this,{}),Jn.set(this,void 0),ii.set(this,void 0),ea.set(this,void 0),ti.set(this,void 0),Md.set(this,void 0),Pn.set(this,void 0),pd.set(this,void 0),md.set(this,void 0),rl.set(this,void 0)}[(jg=new WeakMap,_r=new WeakMap,fd=new WeakMap,Jn=new WeakMap,ii=new WeakMap,ea=new WeakMap,ti=new WeakMap,Md=new WeakMap,Pn=new WeakMap,pd=new WeakMap,md=new WeakMap,rl=new WeakMap,zt=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Yn;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var i;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=Pl.fromReadableStream(e,this.controller);for await(const a of s)ue(this,zt,"m",Ho).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new bn;return this._addRun(ue(this,zt,"m",Wo).call(this))}toReadableStream(){return new Pl(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,s,i){const a=new Yn;return a._run(()=>a._runToolAssistantStream(e,t,n,s,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,n,s,i){var c;const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},l=await e.submitToolOutputs(t,n,o,{...i,signal:this.controller.signal});this._connected();for await(const u of l)ue(this,zt,"m",Ho).call(this,u);if((c=l.controller.signal)!=null&&c.aborted)throw new bn;return this._addRun(ue(this,zt,"m",Wo).call(this))}static createThreadAssistantStream(e,t,n){const s=new Yn;return s._run(()=>s._threadAssistantStream(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,n,s){const i=new Yn;return i._run(()=>i._runAssistantStream(e,t,n,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return ue(this,pd,"f")}currentRun(){return ue(this,md,"f")}currentMessageSnapshot(){return ue(this,Jn,"f")}currentRunStepSnapshot(){return ue(this,rl,"f")}async finalRunSteps(){return await this.done(),Object.values(ue(this,_r,"f"))}async finalMessages(){return await this.done(),Object.values(ue(this,fd,"f"))}async finalRun(){if(await this.done(),!ue(this,ii,"f"))throw Error("Final run was not received.");return ue(this,ii,"f")}async _createThreadAssistantStream(e,t,n){var o;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i={...t,stream:!0},a=await e.createAndRun(i,{...n,signal:this.controller.signal});this._connected();for await(const l of a)ue(this,zt,"m",Ho).call(this,l);if((o=a.controller.signal)!=null&&o.aborted)throw new bn;return this._addRun(ue(this,zt,"m",Wo).call(this))}async _createAssistantStream(e,t,n,s){var l;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...n,stream:!0},o=await e.create(t,a,{...s,signal:this.controller.signal});this._connected();for await(const c of o)ue(this,zt,"m",Ho).call(this,c);if((l=o.controller.signal)!=null&&l.aborted)throw new bn;return this._addRun(ue(this,zt,"m",Wo).call(this))}static accumulateDelta(e,t){for(const[n,s]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=s;continue}let i=e[n];if(i==null){e[n]=s;continue}if(n==="index"||n==="type"){e[n]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(tp(i)&&tp(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}for(const a of s){if(!tp(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);const o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const l=i[o];l==null?i.push(a):i[o]=this.accumulateDelta(l,a)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${i}`);e[n]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,s){return await this._createAssistantStream(t,e,n,s)}async _runToolAssistantStream(e,t,n,s,i){return await this._createToolAssistantStream(n,e,t,s,i)}}Ho=function(e){if(!this.ended)switch(vn(this,pd,e,"f"),ue(this,zt,"m",Dv).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":ue(this,zt,"m",Uv).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":ue(this,zt,"m",jv).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":ue(this,zt,"m",Lv).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Wo=function(){if(this.ended)throw new ve("stream has ended, this shouldn't happen");if(!ue(this,ii,"f"))throw Error("Final run has not been received");return ue(this,ii,"f")},Lv=function(e){const[t,n]=ue(this,zt,"m",zv).call(this,e,ue(this,Jn,"f"));vn(this,Jn,t,"f"),ue(this,fd,"f")[t.id]=t;for(const s of n){const i=t.content[s.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=t.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=ue(this,ea,"f")){if(ue(this,ti,"f"))switch(ue(this,ti,"f").type){case"text":this._emit("textDone",ue(this,ti,"f").text,ue(this,Jn,"f"));break;case"image_file":this._emit("imageFileDone",ue(this,ti,"f").image_file,ue(this,Jn,"f"));break}vn(this,ea,s.index,"f")}vn(this,ti,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(ue(this,ea,"f")!==void 0){const s=e.data.content[ue(this,ea,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,ue(this,Jn,"f"));break;case"text":this._emit("textDone",s.text,ue(this,Jn,"f"));break}}ue(this,Jn,"f")&&this._emit("messageDone",e.data),vn(this,Jn,void 0,"f")}},jv=function(e){const t=ue(this,zt,"m",Fv).call(this,e);switch(vn(this,rl,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const i of n.step_details.tool_calls)i.index==ue(this,Md,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(ue(this,Pn,"f")&&this._emit("toolCallDone",ue(this,Pn,"f")),vn(this,Md,i.index,"f"),vn(this,Pn,t.step_details.tool_calls[i.index],"f"),ue(this,Pn,"f")&&this._emit("toolCallCreated",ue(this,Pn,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":vn(this,rl,void 0,"f"),e.data.step_details.type=="tool_calls"&&ue(this,Pn,"f")&&(this._emit("toolCallDone",ue(this,Pn,"f")),vn(this,Pn,void 0,"f")),this._emit("runStepDone",e.data,t);break}},Dv=function(e){ue(this,jg,"f").push(e),this._emit("event",e)},Fv=function(e){switch(e.event){case"thread.run.step.created":return ue(this,_r,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=ue(this,_r,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const s=Yn.accumulateDelta(t,n.delta);ue(this,_r,"f")[e.data.id]=s}return ue(this,_r,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":ue(this,_r,"f")[e.data.id]=e.data;break}if(ue(this,_r,"f")[e.data.id])return ue(this,_r,"f")[e.data.id];throw new Error("No snapshot available")},zv=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const i of s.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=ue(this,zt,"m",Bv).call(this,i,a)}else t.content[i.index]=i,n.push(i);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Bv=function(e,t){return Yn.accumulateDelta(t,e)},Uv=function(e){switch(vn(this,md,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":vn(this,ii,e.data,"f"),ue(this,Pn,"f")&&(this._emit("toolCallDone",ue(this,Pn,"f")),vn(this,Pn,void 0,"f"));break}};let t_=class extends Re{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return bt(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,n_,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}};class n_ extends Bt{}t_.MessagesPage=n_;class r_ extends Re{retrieve(e,t,n,s={},i){return bt(s)?this.retrieve(e,t,n,{},s):this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,t,n={},s){return bt(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,s_,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class s_ extends Bt{}r_.RunStepsPage=s_;let Sc=class extends Re{constructor(){super(...arguments),this.steps=new r_(this._client)}create(e,t,n){const{include:s,...i}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:i,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return bt(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,i_,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t,n);return await this.poll(e,s.id,n)}createAndStream(e,t,n){return Yn.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...n,headers:{...n==null?void 0:n.headers,...s}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const l=a.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(o=c)}}await vc(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,n){return Yn.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,s){const i=await this.submitToolOutputs(e,t,n,s);return await this.poll(e,i.id,s)}submitToolOutputsStream(e,t,n,s){return Yn.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,s)}};class i_ extends Bt{}Sc.RunsPage=i_;Sc.Steps=r_;Sc.RunStepsPage=s_;class Ba extends Re{constructor(){super(...arguments),this.runs=new Sc(this._client),this.messages=new t_(this._client)}create(e={},t){return bt(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return Yn.createThreadAssistantStream(e,this._client.beta.threads,t)}}Ba.Runs=Sc;Ba.RunsPage=i_;Ba.Messages=t_;Ba.MessagesPage=n_;let Ua=class extends Re{constructor(){super(...arguments),this.realtime=new Dh(this._client),this.chat=new Lg(this._client),this.assistants=new Kb(this._client),this.threads=new Ba(this._client)}};Ua.Realtime=Dh;Ua.Assistants=Kb;Ua.AssistantsPage=Xb;Ua.Threads=Ba;let IP=class extends Re{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}};class CP extends Re{create(e,t){const n=!!e.encoding_format;let s=n?e.encoding_format:"base64";n&&Es("Request","User defined encoding_format:",e.encoding_format);const i=this._client.post("/embeddings",{body:{...e,encoding_format:s},...t});return n?i:(Es("response","Decoding base64 embeddings to float32 array"),i._thenUnwrap(a=>(a&&a.data&&a.data.forEach(o=>{const l=o.embedding;o.embedding=G2(l)}),a)))}}class a_ extends Re{retrieve(e,t,n,s){return this._client.get(`/evals/${e}/runs/${t}/output_items/${n}`,s)}list(e,t,n={},s){return bt(n)?this.list(e,t,{},n):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,o_,{query:n,...s})}}class o_ extends Bt{}a_.OutputItemListResponsesPage=o_;class Pc extends Re{constructor(){super(...arguments),this.outputItems=new a_(this._client)}create(e,t,n){return this._client.post(`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){return this._client.get(`/evals/${e}/runs/${t}`,n)}list(e,t={},n){return bt(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,l_,{query:t,...n})}del(e,t,n){return this._client.delete(`/evals/${e}/runs/${t}`,n)}cancel(e,t,n){return this._client.post(`/evals/${e}/runs/${t}`,n)}}class l_ extends Bt{}Pc.RunListResponsesPage=l_;Pc.OutputItems=a_;Pc.OutputItemListResponsesPage=o_;class Ac extends Re{constructor(){super(...arguments),this.runs=new Pc(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,n){return this._client.post(`/evals/${e}`,{body:t,...n})}list(e={},t){return bt(e)?this.list({},e):this._client.getAPIList("/evals",c_,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}}class c_ extends Bt{}Ac.EvalListResponsesPage=c_;Ac.Runs=Pc;Ac.RunListResponsesPage=l_;let u_=class extends Re{create(e,t){return this._client.post("/files",Ia({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return bt(e)?this.list({},e):this._client.getAPIList("/files",d_,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),i=Date.now();let a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await vc(t),a=await this.retrieve(e),Date.now()-i>n)throw new wc({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}};class d_ extends Bt{}u_.FileObjectsPage=d_;class h_ extends Re{create(e,t,n){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,f_,{body:t,method:"post",...n})}retrieve(e,t={},n){return bt(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}del(e,t){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions`,t)}}class f_ extends Mh{}h_.PermissionCreateResponsesPage=f_;let Fh=class extends Re{constructor(){super(...arguments),this.permissions=new h_(this._client)}};Fh.Permissions=h_;Fh.PermissionCreateResponsesPage=f_;class p_ extends Re{list(e,t={},n){return bt(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,m_,{query:t,...n})}}class m_ extends Bt{}p_.FineTuningJobCheckpointsPage=m_;class qa extends Re{constructor(){super(...arguments),this.checkpoints=new p_(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return bt(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",g_,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return bt(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,b_,{query:t,...n})}}class g_ extends Bt{}class b_ extends Bt{}qa.FineTuningJobsPage=g_;qa.FineTuningJobEventsPage=b_;qa.Checkpoints=p_;qa.FineTuningJobCheckpointsPage=m_;class Ha extends Re{constructor(){super(...arguments),this.jobs=new qa(this._client),this.checkpoints=new Fh(this._client)}}Ha.Jobs=qa;Ha.FineTuningJobsPage=g_;Ha.FineTuningJobEventsPage=b_;Ha.Checkpoints=Fh;class $P extends Re{createVariation(e,t){return this._client.post("/images/variations",Ia({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",Ia({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}let __=class extends Re{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",y_,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}};class y_ extends Mh{}__.ModelsPage=y_;class MP extends Re{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function lj(r,e){return!e||!uj(e)?{...r,output_parsed:null,output:r.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(n=>({...n,parsed:null}))}:t)}:NP(r,e)}function NP(r,e){const t=r.output.map(s=>{if(s.type==="function_call")return{...s,parsed_arguments:fj(e,s)};if(s.type==="message"){const i=s.content.map(a=>a.type==="output_text"?{...a,parsed:cj(e,a.text)}:a);return{...s,content:i}}return s}),n=Object.assign({},r,{output:t});return Object.getOwnPropertyDescriptor(r,"output_text")||LP(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(const s of n.output)if(s.type==="message"){for(const i of s.content)if(i.type==="output_text"&&i.parsed!==null)return i.parsed}return null}}),n}function cj(r,e){var t,n,s,i;return((n=(t=r.text)==null?void 0:t.format)==null?void 0:n.type)!=="json_schema"?null:"$parseRaw"in((s=r.text)==null?void 0:s.format)?((i=r.text)==null?void 0:i.format).$parseRaw(e):JSON.parse(e)}function uj(r){var e;return!!Qb((e=r.text)==null?void 0:e.format)}function dj(r){return(r==null?void 0:r.$brand)==="auto-parseable-tool"}function hj(r,e){return r.find(t=>t.type==="function"&&t.name===e)}function fj(r,e){const t=hj(r.tools??[],e.name);return{...e,...e,parsed_arguments:dj(t)?t.$parseRaw(e.arguments):t!=null&&t.strict?JSON.parse(e.arguments):null}}function LP(r){const e=[];for(const t of r.output)if(t.type==="message")for(const n of t.content)n.type==="output_text"&&e.push(n.text);r.output_text=e.join("")}class jP extends Re{list(e,t={},n){return bt(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,mj,{query:t,...n})}}var zi=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},cs=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Bi,_u,us,yu,qv,Hv,Wv,Vv;class w_ extends Yb{constructor(e){super(),Bi.add(this),_u.set(this,void 0),us.set(this,void 0),yu.set(this,void 0),zi(this,_u,e,"f")}static createResponse(e,t,n){const s=new w_(t);return s._run(()=>s._createResponse(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createResponse(e,t,n){var a;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),cs(this,Bi,"m",qv).call(this);const i=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of i)cs(this,Bi,"m",Hv).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new bn;return cs(this,Bi,"m",Wv).call(this)}[(_u=new WeakMap,us=new WeakMap,yu=new WeakMap,Bi=new WeakSet,qv=function(){this.ended||zi(this,us,void 0,"f")},Hv=function(t){if(this.ended)return;const n=cs(this,Bi,"m",Vv).call(this,t);switch(this._emit("event",t),t.type){case"response.output_text.delta":{const s=n.output[t.output_index];if(!s)throw new ve(`missing output at index ${t.output_index}`);if(s.type==="message"){const i=s.content[t.content_index];if(!i)throw new ve(`missing content at index ${t.content_index}`);if(i.type!=="output_text")throw new ve(`expected content to be 'output_text', got ${i.type}`);this._emit("response.output_text.delta",{...t,snapshot:i.text})}break}case"response.function_call_arguments.delta":{const s=n.output[t.output_index];if(!s)throw new ve(`missing output at index ${t.output_index}`);s.type==="function_call"&&this._emit("response.function_call_arguments.delta",{...t,snapshot:s.arguments});break}default:this._emit(t.type,t);break}},Wv=function(){if(this.ended)throw new ve("stream has ended, this shouldn't happen");const t=cs(this,us,"f");if(!t)throw new ve("request ended without sending any events");zi(this,us,void 0,"f");const n=pj(t,cs(this,_u,"f"));return zi(this,yu,n,"f"),n},Vv=function(t){let n=cs(this,us,"f");if(!n){if(t.type!=="response.created")throw new ve(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return n=zi(this,us,t.response,"f"),n}switch(t.type){case"response.output_item.added":{n.output.push(t.item);break}case"response.content_part.added":{const s=n.output[t.output_index];if(!s)throw new ve(`missing output at index ${t.output_index}`);s.type==="message"&&s.content.push(t.part);break}case"response.output_text.delta":{const s=n.output[t.output_index];if(!s)throw new ve(`missing output at index ${t.output_index}`);if(s.type==="message"){const i=s.content[t.content_index];if(!i)throw new ve(`missing content at index ${t.content_index}`);if(i.type!=="output_text")throw new ve(`expected content to be 'output_text', got ${i.type}`);i.text+=t.delta}break}case"response.function_call_arguments.delta":{const s=n.output[t.output_index];if(!s)throw new ve(`missing output at index ${t.output_index}`);s.type==="function_call"&&(s.arguments+=t.delta);break}case"response.completed":{zi(this,us,t.response,"f");break}}return n},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=cs(this,yu,"f");if(!e)throw new ve("stream ended without producing a ChatCompletion");return e}}function pj(r,e){return lj(r,e)}class v_ extends Re{constructor(){super(...arguments),this.inputItems=new jP(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&LP(n),n))}retrieve(e,t={},n){return bt(t)?this.retrieve(e,{},t):this._client.get(`/responses/${e}`,{query:t,...n})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t==null?void 0:t.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(n=>NP(n,e))}stream(e,t){return w_.createResponse(this._client,e,t)}}class mj extends Bt{}v_.InputItems=jP;class DP extends Re{create(e,t,n){return this._client.post(`/uploads/${e}/parts`,Ia({body:t,...n}))}}class x_ extends Re{constructor(){super(...arguments),this.parts=new DP(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}}x_.Parts=DP;const gj=async r=>{const e=await Promise.allSettled(r),t=e.filter(s=>s.status==="rejected");if(t.length){for(const s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const n=[];for(const s of e)s.status==="fulfilled"&&n.push(s.value);return n};class zh extends Re{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return bt(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,Bh,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t,n);return await this.poll(e,s.id,n)}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const i=await this.retrieve(e,t,{...n,headers:s}).withResponse(),a=i.data;switch(a.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const l=i.response.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(o=c)}}await vc(o);break;case"failed":case"completed":return a}}}async upload(e,t,n){const s=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:s.id},n)}async uploadAndPoll(e,t,n){const s=await this.upload(e,t,n);return await this.poll(e,s.id,n)}content(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,k_,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Bh extends Bt{}class k_ extends Mh{}zh.VectorStoreFilesPage=Bh;zh.FileContentResponsesPage=k_;class FP extends Re{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t);return await this.poll(e,s.id,n)}listFiles(e,t,n={},s){return bt(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,Bh,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...n,headers:s}).withResponse();switch(i.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const l=a.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(o=c)}}await vc(o);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const i=(s==null?void 0:s.maxConcurrency)??5,a=Math.min(i,t.length),o=this._client,l=t.values(),c=[...n];async function u(h){for(let f of h){const p=await o.files.create({file:f,purpose:"assistants"},s);c.push(p.id)}}const d=Array(a).fill(l).map(u);return await gj(d),await this.createAndPoll(e,{file_ids:c})}}class zs extends Re{constructor(){super(...arguments),this.files=new zh(this._client),this.fileBatches=new FP(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return bt(e)?this.list({},e):this._client.getAPIList("/vector_stores",S_,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}search(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/search`,P_,{body:t,method:"post",...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class S_ extends Bt{}class P_ extends Mh{}zs.VectorStoresPage=S_;zs.VectorStoreSearchResponsesPage=P_;zs.Files=zh;zs.VectorStoreFilesPage=Bh;zs.FileContentResponsesPage=k_;zs.FileBatches=FP;var zP;let Ae=class extends N2{constructor({baseURL:e=fu("OPENAI_BASE_URL"),apiKey:t=fu("OPENAI_API_KEY"),organization:n=fu("OPENAI_ORG_ID")??null,project:s=fu("OPENAI_PROJECT_ID")??null,...i}={}){if(t===void 0)throw new ve("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:t,organization:n,project:s,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&W2())throw new ve(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new IP(this),this.chat=new jh(this),this.embeddings=new CP(this),this.files=new u_(this),this.images=new $P(this),this.audio=new xc(this),this.moderations=new MP(this),this.models=new __(this),this.fineTuning=new Ha(this),this.vectorStores=new zs(this),this.beta=new Ua(this),this.batches=new Zb(this),this.uploads=new x_(this),this.responses=new v_(this),this.evals=new Ac(this),this._options=a,this.apiKey=t,this.organization=n,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return b2(e,{arrayFormat:"brackets"})}};zP=Ae;Ae.OpenAI=zP;Ae.DEFAULT_TIMEOUT=6e5;Ae.OpenAIError=ve;Ae.APIError=yn;Ae.APIConnectionError=Ih;Ae.APIConnectionTimeoutError=wc;Ae.APIUserAbortError=bn;Ae.NotFoundError=z1;Ae.ConflictError=B1;Ae.RateLimitError=q1;Ae.BadRequestError=j1;Ae.AuthenticationError=D1;Ae.InternalServerError=H1;Ae.PermissionDeniedError=F1;Ae.UnprocessableEntityError=U1;Ae.toFile=K1;Ae.fileFromPath=M1;Ae.Completions=IP;Ae.Chat=jh;Ae.ChatCompletionsPage=Lh;Ae.Embeddings=CP;Ae.Files=u_;Ae.FileObjectsPage=d_;Ae.Images=$P;Ae.Audio=xc;Ae.Moderations=MP;Ae.Models=__;Ae.ModelsPage=y_;Ae.FineTuning=Ha;Ae.VectorStores=zs;Ae.VectorStoresPage=S_;Ae.VectorStoreSearchResponsesPage=P_;Ae.Beta=Ua;Ae.Batches=Zb;Ae.BatchesPage=Jb;Ae.Uploads=x_;Ae.Responses=v_;Ae.Evals=Ac;Ae.EvalListResponsesPage=c_;function Gv(r,e=A_){r=r.trim();const t=/```(json)?(.*)```/s.exec(r);return e(t?t[2]:r)}function A_(r){if(typeof r>"u")return null;try{return JSON.parse(r)}catch{}let e="";const t=[];let n=!1,s=!1;for(let i of r){if(n)i==='"'&&!s?n=!1:i===`
`&&!s?i="\\n":i==="\\"?s=!s:s=!1;else if(i==='"')n=!0,s=!1;else if(i==="{")t.push("}");else if(i==="[")t.push("]");else if(i==="}"||i==="]")if(t&&t[t.length-1]===i)t.pop();else return null;e+=i}n&&(e+='"');for(let i=t.length-1;i>=0;i-=1)e+=t[i];try{return JSON.parse(e)}catch{return null}}var op,Zv;function bj(){return Zv||(Zv=1,op=function(r,e){if(typeof r!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,r.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}),op}var _j=bj();const yj=Pi(_j);var wu={exports:{}},Jv;function wj(){if(Jv)return wu.exports;Jv=1;const r=/[\p{Lu}]/u,e=/[\p{Ll}]/u,t=/^[\p{Lu}](?![\p{Lu}])/gu,n=/([\p{Alpha}\p{N}_]|$)/u,s=/[_.\- ]+/,i=new RegExp("^"+s.source),a=new RegExp(s.source+n.source,"gu"),o=new RegExp("\\d+"+n.source,"gu"),l=(h,f,p)=>{let m=!1,g=!1,b=!1;for(let _=0;_<h.length;_++){const y=h[_];m&&r.test(y)?(h=h.slice(0,_)+"-"+h.slice(_),m=!1,b=g,g=!0,_++):g&&b&&e.test(y)?(h=h.slice(0,_-1)+"-"+h.slice(_-1),b=g,g=!1,m=!0):(m=f(y)===y&&p(y)!==y,b=g,g=p(y)===y&&f(y)!==y)}return h},c=(h,f)=>(t.lastIndex=0,h.replace(t,p=>f(p))),u=(h,f)=>(a.lastIndex=0,o.lastIndex=0,h.replace(a,(p,m)=>f(m)).replace(o,p=>f(p))),d=(h,f)=>{if(!(typeof h=="string"||Array.isArray(h)))throw new TypeError("Expected the input to be `string | string[]`");if(f={pascalCase:!1,preserveConsecutiveUppercase:!1,...f},Array.isArray(h)?h=h.map(b=>b.trim()).filter(b=>b.length).join("-"):h=h.trim(),h.length===0)return"";const p=f.locale===!1?b=>b.toLowerCase():b=>b.toLocaleLowerCase(f.locale),m=f.locale===!1?b=>b.toUpperCase():b=>b.toLocaleUpperCase(f.locale);return h.length===1?f.pascalCase?m(h):p(h):(h!==p(h)&&(h=l(h,p,m)),h=h.replace(i,""),f.preserveConsecutiveUppercase?h=c(h,p):h=p(h),f.pascalCase&&(h=m(h.charAt(0))+h.slice(1)),u(h,m))};return wu.exports=d,wu.exports.default=d,wu.exports}wj();function vj(r,e){return(e==null?void 0:e[r])||yj(r)}function xj(r,e,t){const n={};for(const s in r)Object.hasOwn(r,s)&&(n[e(s,t)]=r[s]);return n}function Kv(r){return Array.isArray(r)?[...r]:{...r}}function kj(r,e){const t=Kv(r);for(const[n,s]of Object.entries(e)){const[i,...a]=n.split(".").reverse();let o=t;for(const l of a.reverse()){if(o[l]===void 0)break;o[l]=Kv(o[l]),o=o[l]}o[i]!==void 0&&(o[i]={lc:1,type:"secret",id:[s]})}return t}function BP(r){const e=Object.getPrototypeOf(r);return typeof r.lc_name=="function"&&(typeof e.lc_name!="function"||r.lc_name()!==e.lc_name())?r.lc_name():r.name}class bi{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,BP(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([n])=>{var s;return(s=this.lc_serializable_keys)==null?void 0:s.includes(n)})):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof bi||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},n=Object.keys(this.lc_kwargs).reduce((s,i)=>(s[i]=i in this?this[i]:this.lc_kwargs[i],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(t,Reflect.get(s,"lc_secrets",this)),Object.assign(n,Reflect.get(s,"lc_attributes",this));return Object.keys(t).forEach(s=>{let i=this,a=n;const[o,...l]=s.split(".").reverse();for(const c of l.reverse()){if(!(c in i)||i[c]===void 0)return;(!(c in a)||a[c]===void 0)&&(typeof i[c]=="object"&&i[c]!=null?a[c]={}:Array.isArray(i[c])&&(a[c]=[])),i=i[c],a=a[c]}o in i&&i[o]!==void 0&&(a[o]=a[o]||i[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:xj(Object.keys(t).length?kj(n,t):n,vj,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}function Wa(r,e){return typeof r=="string"?r===""?e:typeof e=="string"?r+e:[{type:"text",text:r},...e]:Array.isArray(e)?Uh(r,e)??[...r,...e]:e===""?r:[...r,{type:"text",text:e}]}function Sj(r,e){return r==="error"||e==="error"?"error":"success"}function Pj(r,e){function t(n,s){if(typeof n!="object"||n===null||n===void 0)return n;if(s>=e)return Array.isArray(n)?"[Array]":"[Object]";if(Array.isArray(n))return n.map(a=>t(a,s+1));const i={};for(const a of Object.keys(n))i[a]=t(n[a],s+1);return i}return JSON.stringify(t(r,0),null,2)}class Va extends bi{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const t=Pj(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}}function ln(r,e){const t={...r};for(const[n,s]of Object.entries(e))if(t[n]==null)t[n]=s;else{if(s==null)continue;if(typeof t[n]!=typeof s||Array.isArray(t[n])!==Array.isArray(s))throw new Error(`field[${n}] already exists in the message chunk, but with a different type.`);if(typeof t[n]=="string"){if(n==="type")continue;t[n]+=s}else if(typeof t[n]=="object"&&!Array.isArray(t[n]))t[n]=ln(t[n],s);else if(Array.isArray(t[n]))t[n]=Uh(t[n],s);else{if(t[n]===s)continue;console.warn(`field[${n}] already exists in this message chunk and value has unsupported type.`)}}return t}function Uh(r,e){if(!(r===void 0&&e===void 0)){if(r===void 0||e===void 0)return r||e;{const t=[...r];for(const n of e)if(typeof n=="object"&&"index"in n&&typeof n.index=="number"){const s=t.findIndex(i=>i.index===n.index);s!==-1?t[s]=ln(t[s],n):t.push(n)}else{if(typeof n=="object"&&"text"in n&&n.text==="")continue;t.push(n)}return t}}}function Aj(r,e){if(!r&&!e)throw new Error("Cannot merge two undefined objects.");if(!r||!e)return r||e;if(typeof r!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof r}
Right ${typeof e}`);if(typeof r=="string"&&typeof e=="string")return r+e;if(Array.isArray(r)&&Array.isArray(e))return Uh(r,e);if(typeof r=="object"&&typeof e=="object")return ln(r,e);if(r===e)return r;throw new Error(`Can not merge objects of different types.
Left ${r}
Right ${e}`)}class Ga extends Va{}function Ej(r){return typeof r.role=="string"}function qh(r){return typeof(r==null?void 0:r._getType)=="function"}function Oj(r){return qh(r)&&typeof r.concat=="function"}function Tj(r){return r!=null&&typeof r=="object"&&"lc_direct_tool_output"in r&&r.lc_direct_tool_output===!0}class Dg extends Va{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,n){typeof e=="string"&&(e={content:e,name:n,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}class Hh extends Ga{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new Hh({content:Wa(this.content,e.content),additional_kwargs:ln(this.additional_kwargs,e.additional_kwargs),response_metadata:ln(this.response_metadata,e.response_metadata),artifact:Aj(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:Sj(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}function Rj(r){const e=[],t=[];for(const n of r)if(n.function){const s=n.function.name;try{const i=JSON.parse(n.function.arguments),a={name:s||"",args:i||{},id:n.id};e.push(a)}catch{t.push({name:s,args:n.function.arguments,id:n.id,error:"Malformed args."})}}else continue;return[e,t]}class Cn extends Va{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){var s;let n;if(typeof e=="string")n={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{n=e;const i=(s=n.additional_kwargs)==null?void 0:s.tool_calls,a=n.tool_calls;i!=null&&i.length>0&&(a===void 0||a.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(i!=null&&a===void 0){const[o,l]=Rj(i);n.tool_calls=o??[],n.invalid_tool_calls=l??[]}else n.tool_calls=n.tool_calls??[],n.invalid_tool_calls=n.invalid_tool_calls??[]}catch{n.tool_calls=[],n.invalid_tool_calls=[]}}super(n),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof n!="string"&&(this.tool_calls=n.tool_calls??this.tool_calls,this.invalid_tool_calls=n.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=n.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}function rs(r){return r._getType()==="ai"}function Xv(r){return r._getType()==="ai"}class mt extends Ga{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{const n=[],s=[];for(const i of e.tool_call_chunks){let a={};try{if(a=A_(i.args||"{}"),a===null||typeof a!="object"||Array.isArray(a))throw new Error("Malformed tool call chunk args.");n.push({name:i.name??"",args:a,id:i.id,type:"tool_call"})}catch{s.push({name:i.name,args:i.args,id:i.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:n,invalid_tool_calls:s,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){var n,s,i,a,o,l,c,u,d,h,f,p,m,g,b,_,y,w,v,x,k,S,R,D,M,N,C,A,E,O,I,T,L,W,ee,Z,X,U,G,le;const t={content:Wa(this.content,e.content),additional_kwargs:ln(this.additional_kwargs,e.additional_kwargs),response_metadata:ln(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const me=Uh(this.tool_call_chunks,e.tool_call_chunks);me!==void 0&&me.length>0&&(t.tool_call_chunks=me)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){const me={...(((s=(n=this.usage_metadata)==null?void 0:n.input_token_details)==null?void 0:s.audio)!==void 0||((a=(i=e.usage_metadata)==null?void 0:i.input_token_details)==null?void 0:a.audio)!==void 0)&&{audio:(((l=(o=this.usage_metadata)==null?void 0:o.input_token_details)==null?void 0:l.audio)??0)+(((u=(c=e.usage_metadata)==null?void 0:c.input_token_details)==null?void 0:u.audio)??0)},...(((h=(d=this.usage_metadata)==null?void 0:d.input_token_details)==null?void 0:h.cache_read)!==void 0||((p=(f=e.usage_metadata)==null?void 0:f.input_token_details)==null?void 0:p.cache_read)!==void 0)&&{cache_read:(((g=(m=this.usage_metadata)==null?void 0:m.input_token_details)==null?void 0:g.cache_read)??0)+(((_=(b=e.usage_metadata)==null?void 0:b.input_token_details)==null?void 0:_.cache_read)??0)},...(((w=(y=this.usage_metadata)==null?void 0:y.input_token_details)==null?void 0:w.cache_creation)!==void 0||((x=(v=e.usage_metadata)==null?void 0:v.input_token_details)==null?void 0:x.cache_creation)!==void 0)&&{cache_creation:(((S=(k=this.usage_metadata)==null?void 0:k.input_token_details)==null?void 0:S.cache_creation)??0)+(((D=(R=e.usage_metadata)==null?void 0:R.input_token_details)==null?void 0:D.cache_creation)??0)}},Rt={...(((N=(M=this.usage_metadata)==null?void 0:M.output_token_details)==null?void 0:N.audio)!==void 0||((A=(C=e.usage_metadata)==null?void 0:C.output_token_details)==null?void 0:A.audio)!==void 0)&&{audio:(((O=(E=this.usage_metadata)==null?void 0:E.output_token_details)==null?void 0:O.audio)??0)+(((T=(I=e.usage_metadata)==null?void 0:I.output_token_details)==null?void 0:T.audio)??0)},...(((W=(L=this.usage_metadata)==null?void 0:L.output_token_details)==null?void 0:W.reasoning)!==void 0||((Z=(ee=e.usage_metadata)==null?void 0:ee.output_token_details)==null?void 0:Z.reasoning)!==void 0)&&{reasoning:(((U=(X=this.usage_metadata)==null?void 0:X.output_token_details)==null?void 0:U.reasoning)??0)+(((le=(G=e.usage_metadata)==null?void 0:G.output_token_details)==null?void 0:le.reasoning)??0)}},vt=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},ut=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},_t={input_tokens:vt.input_tokens+ut.input_tokens,output_tokens:vt.output_tokens+ut.output_tokens,total_tokens:vt.total_tokens+ut.total_tokens,...Object.keys(me).length>0&&{input_token_details:me},...Object.keys(Rt).length>0&&{output_token_details:Rt}};t.usage_metadata=_t}return new mt(t)}}class Ti extends Va{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return Ti}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}}class Ec extends Ga{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new Ec({content:Wa(this.content,e.content),additional_kwargs:ln(this.additional_kwargs,e.additional_kwargs),response_metadata:ln(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}class Oc extends Ga{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new Oc({content:Wa(this.content,e.content),additional_kwargs:ln(this.additional_kwargs,e.additional_kwargs),response_metadata:ln(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}class _i extends Va{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class Tc extends Ga{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new Tc({content:Wa(this.content,e.content),additional_kwargs:ln(this.additional_kwargs,e.additional_kwargs),response_metadata:ln(this.response_metadata,e.response_metadata),id:this.id??e.id})}}class Fg extends Va{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class yi extends Ga{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new yi({content:Wa(this.content,e.content),additional_kwargs:ln(this.additional_kwargs,e.additional_kwargs),response_metadata:ln(this.response_metadata,e.response_metadata),id:this.id??e.id})}}function UP(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function E_(r){return!!(r&&typeof r=="object"&&"type"in r&&r.type==="tool_call")}class zg extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}function Ij(r){return E_(r)?r:typeof r.id=="string"&&r.type==="function"&&typeof r.function=="object"&&r.function!==null&&"arguments"in r.function&&typeof r.function.arguments=="string"&&"name"in r.function&&typeof r.function.name=="string"?{id:r.id,args:JSON.parse(r.function.arguments),name:r.function.name,type:"tool_call"}:r}function Cj(r){return typeof r=="object"&&r!=null&&r.lc===1&&Array.isArray(r.id)&&r.kwargs!=null&&typeof r.kwargs=="object"}function lp(r){let e,t;if(Cj(r)){const n=r.id.at(-1);n==="HumanMessage"||n==="HumanMessageChunk"?e="user":n==="AIMessage"||n==="AIMessageChunk"?e="assistant":n==="SystemMessage"||n==="SystemMessageChunk"?e="system":n==="FunctionMessage"||n==="FunctionMessageChunk"?e="function":n==="ToolMessage"||n==="ToolMessageChunk"?e="tool":e="unknown",t=r.kwargs}else{const{type:n,...s}=r;e=n,t=s}if(e==="human"||e==="user")return new _i(t);if(e==="ai"||e==="assistant"){const{tool_calls:n,...s}=t;if(!Array.isArray(n))return new Cn(t);const i=n.map(Ij);return new Cn({...s,tool_calls:i})}else{if(e==="system")return new Fg(t);if(e==="developer")return new Fg({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in t)return new Dg({...t,content:t.content,tool_call_id:t.tool_call_id,name:t.name});throw UP(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(r,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function Vo(r){if(typeof r=="string")return new _i(r);if(qh(r))return r;if(Array.isArray(r)){const[e,t]=r;return lp({type:e,content:t})}else if(Ej(r)){const{role:e,...t}=r;return lp({...t,type:e})}else return lp(r)}function qP(r,e="Human",t="AI"){const n=[];for(const s of r){let i;if(s._getType()==="human")i=e;else if(s._getType()==="ai")i=t;else if(s._getType()==="system")i="System";else if(s._getType()==="function")i="Function";else if(s._getType()==="tool")i="Tool";else if(s._getType()==="generic")i=s.role;else throw new Error(`Got unsupported message type: ${s._getType()}`);const a=s.name?`${s.name}, `:"",o=typeof s.content=="string"?s.content:JSON.stringify(s.content,null,2);n.push(`${i}: ${a}${o}`)}return n.join(`
`)}function $j(r){var t;const e=r._getType();if(e==="human")return new Tc({...r});if(e==="ai"){let n={...r};return"tool_calls"in n&&(n={...n,tool_call_chunks:(t=n.tool_calls)==null?void 0:t.map(s=>({...s,type:"tool_call_chunk",index:void 0,args:JSON.stringify(s.args)}))}),new mt({...n})}else{if(e==="system")return new yi({...r});if(e==="function")return new Oc({...r});if(Ti.isInstance(r))return new Ec({...r});throw new Error("Unknown message type.")}}var Be;(function(r){r.assertEqual=s=>s;function e(s){}r.assertIs=e;function t(s){throw new Error}r.assertNever=t,r.arrayToEnum=s=>{const i={};for(const a of s)i[a]=a;return i},r.getValidEnumValues=s=>{const i=r.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),a={};for(const o of i)a[o]=s[o];return r.objectValues(a)},r.objectValues=s=>r.objectKeys(s).map(function(i){return s[i]}),r.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const i=[];for(const a in s)Object.prototype.hasOwnProperty.call(s,a)&&i.push(a);return i},r.find=(s,i)=>{for(const a of s)if(i(a))return a},r.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function n(s,i=" | "){return s.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}r.joinValues=n,r.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(Be||(Be={}));var Bg;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(Bg||(Bg={}));const Q=Be.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Vr=r=>{switch(typeof r){case"undefined":return Q.undefined;case"string":return Q.string;case"number":return isNaN(r)?Q.nan:Q.number;case"boolean":return Q.boolean;case"function":return Q.function;case"bigint":return Q.bigint;case"symbol":return Q.symbol;case"object":return Array.isArray(r)?Q.array:r===null?Q.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?Q.promise:typeof Map<"u"&&r instanceof Map?Q.map:typeof Set<"u"&&r instanceof Set?Q.set:typeof Date<"u"&&r instanceof Date?Q.date:Q.object;default:return Q.unknown}},H=Be.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Mj=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:");class Rn extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(i){return i.message},n={_errors:[]},s=i=>{for(const a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)n._errors.push(t(a));else{let o=n,l=0;for(;l<a.path.length;){const c=a.path[l];l===a.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(a))):o[c]=o[c]||{_errors:[]},o=o[c],l++}}};return s(this),n}static assert(e){if(!(e instanceof Rn))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Be.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},n=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):n.push(e(s));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}Rn.create=r=>new Rn(r);const Ca=(r,e)=>{let t;switch(r.code){case H.invalid_type:r.received===Q.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case H.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,Be.jsonStringifyReplacer)}`;break;case H.unrecognized_keys:t=`Unrecognized key(s) in object: ${Be.joinValues(r.keys,", ")}`;break;case H.invalid_union:t="Invalid input";break;case H.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${Be.joinValues(r.options)}`;break;case H.invalid_enum_value:t=`Invalid enum value. Expected ${Be.joinValues(r.options)}, received '${r.received}'`;break;case H.invalid_arguments:t="Invalid function arguments";break;case H.invalid_return_type:t="Invalid function return type";break;case H.invalid_date:t="Invalid date";break;case H.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:Be.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case H.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case H.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case H.custom:t="Invalid input";break;case H.invalid_intersection_types:t="Intersection results could not be merged";break;case H.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case H.not_finite:t="Number must be finite";break;default:t=e.defaultError,Be.assertNever(r)}return{message:t}};let HP=Ca;function Nj(r){HP=r}function Nd(){return HP}const Ld=r=>{const{data:e,path:t,errorMaps:n,issueData:s}=r,i=[...t,...s.path||[]],a={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let o="";const l=n.filter(c=>!!c).slice().reverse();for(const c of l)o=c(a,{data:e,defaultError:o}).message;return{...s,path:i,message:o}},Lj=[];function K(r,e){const t=Nd(),n=Ld({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===Ca?void 0:Ca].filter(s=>!!s)});r.common.issues.push(n)}class Yt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const s of t){if(s.status==="aborted")return xe;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const s of t){const i=await s.key,a=await s.value;n.push({key:i,value:a})}return Yt.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const s of t){const{key:i,value:a}=s;if(i.status==="aborted"||a.status==="aborted")return xe;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value<"u"||s.alwaysSet)&&(n[i.value]=a.value)}return{status:e.value,value:n}}}const xe=Object.freeze({status:"aborted"}),ta=r=>({status:"dirty",value:r}),cn=r=>({status:"valid",value:r}),Ug=r=>r.status==="aborted",qg=r=>r.status==="dirty",wi=r=>r.status==="valid",Ol=r=>typeof Promise<"u"&&r instanceof Promise;function jd(r,e,t,n){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(r)}function WP(r,e,t,n,s){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t}var oe;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(oe||(oe={}));var Go,Zo;class Er{constructor(e,t,n,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Yv=(r,e)=>{if(wi(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Rn(r.common.issues);return this._error=t,this._error}}};function Pe(r){if(!r)return{};const{errorMap:e,invalid_type_error:t,required_error:n,description:s}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(a,o)=>{var l,c;const{message:u}=r;return a.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:(l=u??n)!==null&&l!==void 0?l:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(c=u??t)!==null&&c!==void 0?c:o.defaultError}},description:s}}class Te{get description(){return this._def.description}_getType(e){return Vr(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Vr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Yt,ctx:{common:e.parent.common,data:e.data,parsedType:Vr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Ol(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;const s={common:{issues:[],async:(n=t==null?void 0:t.async)!==null&&n!==void 0?n:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Vr(e)},i=this._parseSync({data:e,path:s.path,parent:s});return Yv(s,i)}"~validate"(e){var t,n;const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Vr(e)};if(!this["~standard"].async)try{const i=this._parseSync({data:e,path:[],parent:s});return wi(i)?{value:i.value}:{issues:s.common.issues}}catch(i){!((n=(t=i==null?void 0:i.message)===null||t===void 0?void 0:t.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:s}).then(i=>wi(i)?{value:i.value}:{issues:s.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Vr(e)},s=this._parse({data:e,path:n.path,parent:n}),i=await(Ol(s)?s:Promise.resolve(s));return Yv(n,i)}refine(e,t){const n=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{const a=e(s),o=()=>i.addIssue({code:H.custom,...n(s)});return typeof Promise<"u"&&a instanceof Promise?a.then(l=>l?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof t=="function"?t(n,s):t),!1))}_refinement(e){return new or({schema:this,typeName:j.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return sr.create(this,this._def)}nullable(){return Ms.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return rr.create(this)}promise(){return Ma.create(this,this._def)}or(e){return Cl.create([this,e],this._def)}and(e){return $l.create(this,e,this._def)}transform(e){return new or({...Pe(this._def),schema:this,typeName:j.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Dl({...Pe(this._def),innerType:this,defaultValue:t,typeName:j.ZodDefault})}brand(){return new O_({typeName:j.ZodBranded,type:this,...Pe(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Fl({...Pe(this._def),innerType:this,catchValue:t,typeName:j.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Rc.create(this,e)}readonly(){return zl.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const jj=/^c[^\s-]{8,}$/i,Dj=/^[0-9a-z]+$/,Fj=/^[0-9A-HJKMNP-TV-Z]{26}$/i,zj=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Bj=/^[a-z0-9_-]{21}$/i,Uj=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,qj=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Hj=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Wj="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let cp;const Vj=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Gj=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Zj=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Jj=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Kj=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Xj=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,VP="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Yj=new RegExp(`^${VP}$`);function GP(r){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Qj(r){return new RegExp(`^${GP(r)}$`)}function ZP(r){let e=`${VP}T${GP(r)}`;const t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function eD(r,e){return!!((e==="v4"||!e)&&Vj.test(r)||(e==="v6"||!e)&&Zj.test(r))}function tD(r,e){if(!Uj.test(r))return!1;try{const[t]=r.split("."),n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(n));return!(typeof s!="object"||s===null||!s.typ||!s.alg||e&&s.alg!==e)}catch{return!1}}function nD(r,e){return!!((e==="v4"||!e)&&Gj.test(r)||(e==="v6"||!e)&&Jj.test(r))}class Qn extends Te{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==Q.string){const i=this._getOrReturnCtx(e);return K(i,{code:H.invalid_type,expected:Q.string,received:i.parsedType}),xe}const n=new Yt;let s;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),K(s,{code:H.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),K(s,{code:H.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="length"){const a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(s=this._getOrReturnCtx(e,s),a?K(s,{code:H.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&K(s,{code:H.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),n.dirty())}else if(i.kind==="email")Hj.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"email",code:H.invalid_string,message:i.message}),n.dirty());else if(i.kind==="emoji")cp||(cp=new RegExp(Wj,"u")),cp.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"emoji",code:H.invalid_string,message:i.message}),n.dirty());else if(i.kind==="uuid")zj.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"uuid",code:H.invalid_string,message:i.message}),n.dirty());else if(i.kind==="nanoid")Bj.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"nanoid",code:H.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid")jj.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"cuid",code:H.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid2")Dj.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"cuid2",code:H.invalid_string,message:i.message}),n.dirty());else if(i.kind==="ulid")Fj.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"ulid",code:H.invalid_string,message:i.message}),n.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),K(s,{validation:"url",code:H.invalid_string,message:i.message}),n.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"regex",code:H.invalid_string,message:i.message}),n.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),K(s,{code:H.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),n.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),K(s,{code:H.invalid_string,validation:{startsWith:i.value},message:i.message}),n.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),K(s,{code:H.invalid_string,validation:{endsWith:i.value},message:i.message}),n.dirty()):i.kind==="datetime"?ZP(i).test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{code:H.invalid_string,validation:"datetime",message:i.message}),n.dirty()):i.kind==="date"?Yj.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{code:H.invalid_string,validation:"date",message:i.message}),n.dirty()):i.kind==="time"?Qj(i).test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{code:H.invalid_string,validation:"time",message:i.message}),n.dirty()):i.kind==="duration"?qj.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"duration",code:H.invalid_string,message:i.message}),n.dirty()):i.kind==="ip"?eD(e.data,i.version)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"ip",code:H.invalid_string,message:i.message}),n.dirty()):i.kind==="jwt"?tD(e.data,i.alg)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"jwt",code:H.invalid_string,message:i.message}),n.dirty()):i.kind==="cidr"?nD(e.data,i.version)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"cidr",code:H.invalid_string,message:i.message}),n.dirty()):i.kind==="base64"?Kj.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"base64",code:H.invalid_string,message:i.message}),n.dirty()):i.kind==="base64url"?Xj.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"base64url",code:H.invalid_string,message:i.message}),n.dirty()):Be.assertNever(i);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(s=>e.test(s),{validation:t,code:H.invalid_string,...oe.errToObj(n)})}_addCheck(e){return new Qn({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...oe.errToObj(e)})}url(e){return this._addCheck({kind:"url",...oe.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...oe.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...oe.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...oe.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...oe.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...oe.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...oe.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...oe.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...oe.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...oe.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...oe.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...oe.errToObj(e)})}datetime(e){var t,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(n=e==null?void 0:e.local)!==null&&n!==void 0?n:!1,...oe.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...oe.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...oe.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...oe.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...oe.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...oe.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...oe.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...oe.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...oe.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...oe.errToObj(t)})}nonempty(e){return this.min(1,oe.errToObj(e))}trim(){return new Qn({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Qn({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Qn({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Qn.create=r=>{var e;return new Qn({checks:[],typeName:j.ZodString,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...Pe(r)})};function rD(r,e){const t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=t>n?t:n,i=parseInt(r.toFixed(s).replace(".","")),a=parseInt(e.toFixed(s).replace(".",""));return i%a/Math.pow(10,s)}class Is extends Te{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==Q.number){const i=this._getOrReturnCtx(e);return K(i,{code:H.invalid_type,expected:Q.number,received:i.parsedType}),xe}let n;const s=new Yt;for(const i of this._def.checks)i.kind==="int"?Be.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),K(n,{code:H.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),K(n,{code:H.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),K(n,{code:H.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?rD(e.data,i.value)!==0&&(n=this._getOrReturnCtx(e,n),K(n,{code:H.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),K(n,{code:H.not_finite,message:i.message}),s.dirty()):Be.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,oe.toString(t))}gt(e,t){return this.setLimit("min",e,!1,oe.toString(t))}lte(e,t){return this.setLimit("max",e,!0,oe.toString(t))}lt(e,t){return this.setLimit("max",e,!1,oe.toString(t))}setLimit(e,t,n,s){return new Is({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:oe.toString(s)}]})}_addCheck(e){return new Is({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:oe.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:oe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:oe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:oe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:oe.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:oe.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:oe.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:oe.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:oe.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Be.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Is.create=r=>new Is({checks:[],typeName:j.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...Pe(r)});class Cs extends Te{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==Q.bigint)return this._getInvalidInput(e);let n;const s=new Yt;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),K(n,{code:H.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),K(n,{code:H.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),K(n,{code:H.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):Be.assertNever(i);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return K(t,{code:H.invalid_type,expected:Q.bigint,received:t.parsedType}),xe}gte(e,t){return this.setLimit("min",e,!0,oe.toString(t))}gt(e,t){return this.setLimit("min",e,!1,oe.toString(t))}lte(e,t){return this.setLimit("max",e,!0,oe.toString(t))}lt(e,t){return this.setLimit("max",e,!1,oe.toString(t))}setLimit(e,t,n,s){return new Cs({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:oe.toString(s)}]})}_addCheck(e){return new Cs({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:oe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:oe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:oe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:oe.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:oe.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Cs.create=r=>{var e;return new Cs({checks:[],typeName:j.ZodBigInt,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...Pe(r)})};class Tl extends Te{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==Q.boolean){const n=this._getOrReturnCtx(e);return K(n,{code:H.invalid_type,expected:Q.boolean,received:n.parsedType}),xe}return cn(e.data)}}Tl.create=r=>new Tl({typeName:j.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...Pe(r)});class vi extends Te{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==Q.date){const i=this._getOrReturnCtx(e);return K(i,{code:H.invalid_type,expected:Q.date,received:i.parsedType}),xe}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return K(i,{code:H.invalid_date}),xe}const n=new Yt;let s;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),K(s,{code:H.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),n.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),K(s,{code:H.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),n.dirty()):Be.assertNever(i);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new vi({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:oe.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:oe.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}vi.create=r=>new vi({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:j.ZodDate,...Pe(r)});class Dd extends Te{_parse(e){if(this._getType(e)!==Q.symbol){const n=this._getOrReturnCtx(e);return K(n,{code:H.invalid_type,expected:Q.symbol,received:n.parsedType}),xe}return cn(e.data)}}Dd.create=r=>new Dd({typeName:j.ZodSymbol,...Pe(r)});class Rl extends Te{_parse(e){if(this._getType(e)!==Q.undefined){const n=this._getOrReturnCtx(e);return K(n,{code:H.invalid_type,expected:Q.undefined,received:n.parsedType}),xe}return cn(e.data)}}Rl.create=r=>new Rl({typeName:j.ZodUndefined,...Pe(r)});class Il extends Te{_parse(e){if(this._getType(e)!==Q.null){const n=this._getOrReturnCtx(e);return K(n,{code:H.invalid_type,expected:Q.null,received:n.parsedType}),xe}return cn(e.data)}}Il.create=r=>new Il({typeName:j.ZodNull,...Pe(r)});class $a extends Te{constructor(){super(...arguments),this._any=!0}_parse(e){return cn(e.data)}}$a.create=r=>new $a({typeName:j.ZodAny,...Pe(r)});class hi extends Te{constructor(){super(...arguments),this._unknown=!0}_parse(e){return cn(e.data)}}hi.create=r=>new hi({typeName:j.ZodUnknown,...Pe(r)});class ts extends Te{_parse(e){const t=this._getOrReturnCtx(e);return K(t,{code:H.invalid_type,expected:Q.never,received:t.parsedType}),xe}}ts.create=r=>new ts({typeName:j.ZodNever,...Pe(r)});class Fd extends Te{_parse(e){if(this._getType(e)!==Q.undefined){const n=this._getOrReturnCtx(e);return K(n,{code:H.invalid_type,expected:Q.void,received:n.parsedType}),xe}return cn(e.data)}}Fd.create=r=>new Fd({typeName:j.ZodVoid,...Pe(r)});class rr extends Te{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),s=this._def;if(t.parsedType!==Q.array)return K(t,{code:H.invalid_type,expected:Q.array,received:t.parsedType}),xe;if(s.exactLength!==null){const a=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(a||o)&&(K(t,{code:a?H.too_big:H.too_small,minimum:o?s.exactLength.value:void 0,maximum:a?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(K(t,{code:H.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(K(t,{code:H.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>s.type._parseAsync(new Er(t,a,t.path,o)))).then(a=>Yt.mergeArray(n,a));const i=[...t.data].map((a,o)=>s.type._parseSync(new Er(t,a,t.path,o)));return Yt.mergeArray(n,i)}get element(){return this._def.type}min(e,t){return new rr({...this._def,minLength:{value:e,message:oe.toString(t)}})}max(e,t){return new rr({...this._def,maxLength:{value:e,message:oe.toString(t)}})}length(e,t){return new rr({...this._def,exactLength:{value:e,message:oe.toString(t)}})}nonempty(e){return this.min(1,e)}}rr.create=(r,e)=>new rr({type:r,minLength:null,maxLength:null,exactLength:null,typeName:j.ZodArray,...Pe(e)});function Ji(r){if(r instanceof pt){const e={};for(const t in r.shape){const n=r.shape[t];e[t]=sr.create(Ji(n))}return new pt({...r._def,shape:()=>e})}else return r instanceof rr?new rr({...r._def,type:Ji(r.element)}):r instanceof sr?sr.create(Ji(r.unwrap())):r instanceof Ms?Ms.create(Ji(r.unwrap())):r instanceof Or?Or.create(r.items.map(e=>Ji(e))):r}class pt extends Te{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=Be.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==Q.object){const c=this._getOrReturnCtx(e);return K(c,{code:H.invalid_type,expected:Q.object,received:c.parsedType}),xe}const{status:n,ctx:s}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof ts&&this._def.unknownKeys==="strip"))for(const c in s.data)a.includes(c)||o.push(c);const l=[];for(const c of a){const u=i[c],d=s.data[c];l.push({key:{status:"valid",value:c},value:u._parse(new Er(s,d,s.path,c)),alwaysSet:c in s.data})}if(this._def.catchall instanceof ts){const c=this._def.unknownKeys;if(c==="passthrough")for(const u of o)l.push({key:{status:"valid",value:u},value:{status:"valid",value:s.data[u]}});else if(c==="strict")o.length>0&&(K(s,{code:H.unrecognized_keys,keys:o}),n.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const u of o){const d=s.data[u];l.push({key:{status:"valid",value:u},value:c._parse(new Er(s,d,s.path,u)),alwaysSet:u in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const c=[];for(const u of l){const d=await u.key,h=await u.value;c.push({key:d,value:h,alwaysSet:u.alwaysSet})}return c}).then(c=>Yt.mergeObjectSync(n,c)):Yt.mergeObjectSync(n,l)}get shape(){return this._def.shape()}strict(e){return oe.errToObj,new pt({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var s,i,a,o;const l=(a=(i=(s=this._def).errorMap)===null||i===void 0?void 0:i.call(s,t,n).message)!==null&&a!==void 0?a:n.defaultError;return t.code==="unrecognized_keys"?{message:(o=oe.errToObj(e).message)!==null&&o!==void 0?o:l}:{message:l}}}:{}})}strip(){return new pt({...this._def,unknownKeys:"strip"})}passthrough(){return new pt({...this._def,unknownKeys:"passthrough"})}extend(e){return new pt({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new pt({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:j.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new pt({...this._def,catchall:e})}pick(e){const t={};return Be.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])}),new pt({...this._def,shape:()=>t})}omit(e){const t={};return Be.objectKeys(this.shape).forEach(n=>{e[n]||(t[n]=this.shape[n])}),new pt({...this._def,shape:()=>t})}deepPartial(){return Ji(this)}partial(e){const t={};return Be.objectKeys(this.shape).forEach(n=>{const s=this.shape[n];e&&!e[n]?t[n]=s:t[n]=s.optional()}),new pt({...this._def,shape:()=>t})}required(e){const t={};return Be.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])t[n]=this.shape[n];else{let i=this.shape[n];for(;i instanceof sr;)i=i._def.innerType;t[n]=i}}),new pt({...this._def,shape:()=>t})}keyof(){return JP(Be.objectKeys(this.shape))}}pt.create=(r,e)=>new pt({shape:()=>r,unknownKeys:"strip",catchall:ts.create(),typeName:j.ZodObject,...Pe(e)});pt.strictCreate=(r,e)=>new pt({shape:()=>r,unknownKeys:"strict",catchall:ts.create(),typeName:j.ZodObject,...Pe(e)});pt.lazycreate=(r,e)=>new pt({shape:r,unknownKeys:"strip",catchall:ts.create(),typeName:j.ZodObject,...Pe(e)});class Cl extends Te{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;function s(i){for(const o of i)if(o.result.status==="valid")return o.result;for(const o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const a=i.map(o=>new Rn(o.ctx.common.issues));return K(t,{code:H.invalid_union,unionErrors:a}),xe}if(t.common.async)return Promise.all(n.map(async i=>{const a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(s);{let i;const a=[];for(const l of n){const c={...t,common:{...t.common,issues:[]},parent:null},u=l._parseSync({data:t.data,path:t.path,parent:c});if(u.status==="valid")return u;u.status==="dirty"&&!i&&(i={result:u,ctx:c}),c.common.issues.length&&a.push(c.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const o=a.map(l=>new Rn(l));return K(t,{code:H.invalid_union,unionErrors:o}),xe}}get options(){return this._def.options}}Cl.create=(r,e)=>new Cl({options:r,typeName:j.ZodUnion,...Pe(e)});const Br=r=>r instanceof Nl?Br(r.schema):r instanceof or?Br(r.innerType()):r instanceof Ll?[r.value]:r instanceof $s?r.options:r instanceof jl?Be.objectValues(r.enum):r instanceof Dl?Br(r._def.innerType):r instanceof Rl?[void 0]:r instanceof Il?[null]:r instanceof sr?[void 0,...Br(r.unwrap())]:r instanceof Ms?[null,...Br(r.unwrap())]:r instanceof O_||r instanceof zl?Br(r.unwrap()):r instanceof Fl?Br(r._def.innerType):[];class Wh extends Te{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Q.object)return K(t,{code:H.invalid_type,expected:Q.object,received:t.parsedType}),xe;const n=this.discriminator,s=t.data[n],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(K(t,{code:H.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),xe)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){const s=new Map;for(const i of t){const a=Br(i.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of a){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,i)}}return new Wh({typeName:j.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...Pe(n)})}}function Hg(r,e){const t=Vr(r),n=Vr(e);if(r===e)return{valid:!0,data:r};if(t===Q.object&&n===Q.object){const s=Be.objectKeys(e),i=Be.objectKeys(r).filter(o=>s.indexOf(o)!==-1),a={...r,...e};for(const o of i){const l=Hg(r[o],e[o]);if(!l.valid)return{valid:!1};a[o]=l.data}return{valid:!0,data:a}}else if(t===Q.array&&n===Q.array){if(r.length!==e.length)return{valid:!1};const s=[];for(let i=0;i<r.length;i++){const a=r[i],o=e[i],l=Hg(a,o);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return t===Q.date&&n===Q.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class $l extends Te{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=(i,a)=>{if(Ug(i)||Ug(a))return xe;const o=Hg(i.value,a.value);return o.valid?((qg(i)||qg(a))&&t.dirty(),{status:t.value,value:o.data}):(K(n,{code:H.invalid_intersection_types}),xe)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([i,a])=>s(i,a)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}$l.create=(r,e,t)=>new $l({left:r,right:e,typeName:j.ZodIntersection,...Pe(t)});class Or extends Te{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Q.array)return K(n,{code:H.invalid_type,expected:Q.array,received:n.parsedType}),xe;if(n.data.length<this._def.items.length)return K(n,{code:H.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),xe;!this._def.rest&&n.data.length>this._def.items.length&&(K(n,{code:H.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...n.data].map((a,o)=>{const l=this._def.items[o]||this._def.rest;return l?l._parse(new Er(n,a,n.path,o)):null}).filter(a=>!!a);return n.common.async?Promise.all(i).then(a=>Yt.mergeArray(t,a)):Yt.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new Or({...this._def,rest:e})}}Or.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Or({items:r,typeName:j.ZodTuple,rest:null,...Pe(e)})};class Ml extends Te{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Q.object)return K(n,{code:H.invalid_type,expected:Q.object,received:n.parsedType}),xe;const s=[],i=this._def.keyType,a=this._def.valueType;for(const o in n.data)s.push({key:i._parse(new Er(n,o,n.path,o)),value:a._parse(new Er(n,n.data[o],n.path,o)),alwaysSet:o in n.data});return n.common.async?Yt.mergeObjectAsync(t,s):Yt.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof Te?new Ml({keyType:e,valueType:t,typeName:j.ZodRecord,...Pe(n)}):new Ml({keyType:Qn.create(),valueType:e,typeName:j.ZodRecord,...Pe(t)})}}class zd extends Te{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Q.map)return K(n,{code:H.invalid_type,expected:Q.map,received:n.parsedType}),xe;const s=this._def.keyType,i=this._def.valueType,a=[...n.data.entries()].map(([o,l],c)=>({key:s._parse(new Er(n,o,n.path,[c,"key"])),value:i._parse(new Er(n,l,n.path,[c,"value"]))}));if(n.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const l of a){const c=await l.key,u=await l.value;if(c.status==="aborted"||u.status==="aborted")return xe;(c.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(c.value,u.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const l of a){const c=l.key,u=l.value;if(c.status==="aborted"||u.status==="aborted")return xe;(c.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(c.value,u.value)}return{status:t.value,value:o}}}}zd.create=(r,e,t)=>new zd({valueType:e,keyType:r,typeName:j.ZodMap,...Pe(t)});class xi extends Te{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Q.set)return K(n,{code:H.invalid_type,expected:Q.set,received:n.parsedType}),xe;const s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(K(n,{code:H.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(K(n,{code:H.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const i=this._def.valueType;function a(l){const c=new Set;for(const u of l){if(u.status==="aborted")return xe;u.status==="dirty"&&t.dirty(),c.add(u.value)}return{status:t.value,value:c}}const o=[...n.data.values()].map((l,c)=>i._parse(new Er(n,l,n.path,c)));return n.common.async?Promise.all(o).then(l=>a(l)):a(o)}min(e,t){return new xi({...this._def,minSize:{value:e,message:oe.toString(t)}})}max(e,t){return new xi({...this._def,maxSize:{value:e,message:oe.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}xi.create=(r,e)=>new xi({valueType:r,minSize:null,maxSize:null,typeName:j.ZodSet,...Pe(e)});class fa extends Te{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Q.function)return K(t,{code:H.invalid_type,expected:Q.function,received:t.parsedType}),xe;function n(o,l){return Ld({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Nd(),Ca].filter(c=>!!c),issueData:{code:H.invalid_arguments,argumentsError:l}})}function s(o,l){return Ld({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Nd(),Ca].filter(c=>!!c),issueData:{code:H.invalid_return_type,returnTypeError:l}})}const i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof Ma){const o=this;return cn(async function(...l){const c=new Rn([]),u=await o._def.args.parseAsync(l,i).catch(f=>{throw c.addIssue(n(l,f)),c}),d=await Reflect.apply(a,this,u);return await o._def.returns._def.type.parseAsync(d,i).catch(f=>{throw c.addIssue(s(d,f)),c})})}else{const o=this;return cn(function(...l){const c=o._def.args.safeParse(l,i);if(!c.success)throw new Rn([n(l,c.error)]);const u=Reflect.apply(a,this,c.data),d=o._def.returns.safeParse(u,i);if(!d.success)throw new Rn([s(u,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new fa({...this._def,args:Or.create(e).rest(hi.create())})}returns(e){return new fa({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new fa({args:e||Or.create([]).rest(hi.create()),returns:t||hi.create(),typeName:j.ZodFunction,...Pe(n)})}}class Nl extends Te{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Nl.create=(r,e)=>new Nl({getter:r,typeName:j.ZodLazy,...Pe(e)});class Ll extends Te{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return K(t,{received:t.data,code:H.invalid_literal,expected:this._def.value}),xe}return{status:"valid",value:e.data}}get value(){return this._def.value}}Ll.create=(r,e)=>new Ll({value:r,typeName:j.ZodLiteral,...Pe(e)});function JP(r,e){return new $s({values:r,typeName:j.ZodEnum,...Pe(e)})}class $s extends Te{constructor(){super(...arguments),Go.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),n=this._def.values;return K(t,{expected:Be.joinValues(n),received:t.parsedType,code:H.invalid_type}),xe}if(jd(this,Go)||WP(this,Go,new Set(this._def.values)),!jd(this,Go).has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return K(t,{received:t.data,code:H.invalid_enum_value,options:n}),xe}return cn(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return $s.create(e,{...this._def,...t})}exclude(e,t=this._def){return $s.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}}Go=new WeakMap;$s.create=JP;class jl extends Te{constructor(){super(...arguments),Zo.set(this,void 0)}_parse(e){const t=Be.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==Q.string&&n.parsedType!==Q.number){const s=Be.objectValues(t);return K(n,{expected:Be.joinValues(s),received:n.parsedType,code:H.invalid_type}),xe}if(jd(this,Zo)||WP(this,Zo,new Set(Be.getValidEnumValues(this._def.values))),!jd(this,Zo).has(e.data)){const s=Be.objectValues(t);return K(n,{received:n.data,code:H.invalid_enum_value,options:s}),xe}return cn(e.data)}get enum(){return this._def.values}}Zo=new WeakMap;jl.create=(r,e)=>new jl({values:r,typeName:j.ZodNativeEnum,...Pe(e)});class Ma extends Te{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Q.promise&&t.common.async===!1)return K(t,{code:H.invalid_type,expected:Q.promise,received:t.parsedType}),xe;const n=t.parsedType===Q.promise?t.data:Promise.resolve(t.data);return cn(n.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Ma.create=(r,e)=>new Ma({type:r,typeName:j.ZodPromise,...Pe(e)});class or extends Te{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===j.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:a=>{K(n,a),a.fatal?t.abort():t.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){const a=s.transform(n.data,i);if(n.common.async)return Promise.resolve(a).then(async o=>{if(t.value==="aborted")return xe;const l=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return l.status==="aborted"?xe:l.status==="dirty"||t.value==="dirty"?ta(l.value):l});{if(t.value==="aborted")return xe;const o=this._def.schema._parseSync({data:a,path:n.path,parent:n});return o.status==="aborted"?xe:o.status==="dirty"||t.value==="dirty"?ta(o.value):o}}if(s.type==="refinement"){const a=o=>{const l=s.refinement(o,i);if(n.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?xe:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?xe:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(n.common.async===!1){const a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!wi(a))return a;const o=s.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>wi(a)?Promise.resolve(s.transform(a.value,i)).then(o=>({status:t.value,value:o})):a);Be.assertNever(s)}}or.create=(r,e,t)=>new or({schema:r,typeName:j.ZodEffects,effect:e,...Pe(t)});or.createWithPreprocess=(r,e,t)=>new or({schema:e,effect:{type:"preprocess",transform:r},typeName:j.ZodEffects,...Pe(t)});class sr extends Te{_parse(e){return this._getType(e)===Q.undefined?cn(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}sr.create=(r,e)=>new sr({innerType:r,typeName:j.ZodOptional,...Pe(e)});class Ms extends Te{_parse(e){return this._getType(e)===Q.null?cn(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ms.create=(r,e)=>new Ms({innerType:r,typeName:j.ZodNullable,...Pe(e)});class Dl extends Te{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===Q.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Dl.create=(r,e)=>new Dl({innerType:r,typeName:j.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Pe(e)});class Fl extends Te{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Ol(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Rn(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Rn(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}Fl.create=(r,e)=>new Fl({innerType:r,typeName:j.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Pe(e)});class Bd extends Te{_parse(e){if(this._getType(e)!==Q.nan){const n=this._getOrReturnCtx(e);return K(n,{code:H.invalid_type,expected:Q.nan,received:n.parsedType}),xe}return{status:"valid",value:e.data}}}Bd.create=r=>new Bd({typeName:j.ZodNaN,...Pe(r)});const sD=Symbol("zod_brand");class O_ extends Te{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class Rc extends Te{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?xe:i.status==="dirty"?(t.dirty(),ta(i.value)):this._def.out._parseAsync({data:i.value,path:n.path,parent:n})})();{const s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?xe:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,t){return new Rc({in:e,out:t,typeName:j.ZodPipeline})}}class zl extends Te{_parse(e){const t=this._def.innerType._parse(e),n=s=>(wi(s)&&(s.value=Object.freeze(s.value)),s);return Ol(t)?t.then(s=>n(s)):n(t)}unwrap(){return this._def.innerType}}zl.create=(r,e)=>new zl({innerType:r,typeName:j.ZodReadonly,...Pe(e)});function Qv(r,e){const t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function KP(r,e={},t){return r?$a.create().superRefine((n,s)=>{var i,a;const o=r(n);if(o instanceof Promise)return o.then(l=>{var c,u;if(!l){const d=Qv(e,n),h=(u=(c=d.fatal)!==null&&c!==void 0?c:t)!==null&&u!==void 0?u:!0;s.addIssue({code:"custom",...d,fatal:h})}});if(!o){const l=Qv(e,n),c=(a=(i=l.fatal)!==null&&i!==void 0?i:t)!==null&&a!==void 0?a:!0;s.addIssue({code:"custom",...l,fatal:c})}}):$a.create()}const iD={object:pt.lazycreate};var j;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(j||(j={}));const aD=(r,e={message:`Input not instance of ${r.name}`})=>KP(t=>t instanceof r,e),XP=Qn.create,YP=Is.create,oD=Bd.create,lD=Cs.create,QP=Tl.create,cD=vi.create,uD=Dd.create,dD=Rl.create,hD=Il.create,fD=$a.create,pD=hi.create,mD=ts.create,gD=Fd.create,bD=rr.create,_D=pt.create,yD=pt.strictCreate,wD=Cl.create,vD=Wh.create,xD=$l.create,kD=Or.create,SD=Ml.create,PD=zd.create,AD=xi.create,ED=fa.create,OD=Nl.create,TD=Ll.create,RD=$s.create,ID=jl.create,CD=Ma.create,e0=or.create,$D=sr.create,MD=Ms.create,ND=or.createWithPreprocess,LD=Rc.create,jD=()=>XP().optional(),DD=()=>YP().optional(),FD=()=>QP().optional(),zD={string:r=>Qn.create({...r,coerce:!0}),number:r=>Is.create({...r,coerce:!0}),boolean:r=>Tl.create({...r,coerce:!0}),bigint:r=>Cs.create({...r,coerce:!0}),date:r=>vi.create({...r,coerce:!0})},BD=xe;var He=Object.freeze({__proto__:null,defaultErrorMap:Ca,setErrorMap:Nj,getErrorMap:Nd,makeIssue:Ld,EMPTY_PATH:Lj,addIssueToContext:K,ParseStatus:Yt,INVALID:xe,DIRTY:ta,OK:cn,isAborted:Ug,isDirty:qg,isValid:wi,isAsync:Ol,get util(){return Be},get objectUtil(){return Bg},ZodParsedType:Q,getParsedType:Vr,ZodType:Te,datetimeRegex:ZP,ZodString:Qn,ZodNumber:Is,ZodBigInt:Cs,ZodBoolean:Tl,ZodDate:vi,ZodSymbol:Dd,ZodUndefined:Rl,ZodNull:Il,ZodAny:$a,ZodUnknown:hi,ZodNever:ts,ZodVoid:Fd,ZodArray:rr,ZodObject:pt,ZodUnion:Cl,ZodDiscriminatedUnion:Wh,ZodIntersection:$l,ZodTuple:Or,ZodRecord:Ml,ZodMap:zd,ZodSet:xi,ZodFunction:fa,ZodLazy:Nl,ZodLiteral:Ll,ZodEnum:$s,ZodNativeEnum:jl,ZodPromise:Ma,ZodEffects:or,ZodTransformer:or,ZodOptional:sr,ZodNullable:Ms,ZodDefault:Dl,ZodCatch:Fl,ZodNaN:Bd,BRAND:sD,ZodBranded:O_,ZodPipeline:Rc,ZodReadonly:zl,custom:KP,Schema:Te,ZodSchema:Te,late:iD,get ZodFirstPartyTypeKind(){return j},coerce:zD,any:fD,array:bD,bigint:lD,boolean:QP,date:cD,discriminatedUnion:vD,effect:e0,enum:RD,function:ED,instanceof:aD,intersection:xD,lazy:OD,literal:TD,map:PD,nan:oD,nativeEnum:ID,never:mD,null:hD,nullable:MD,number:YP,object:_D,oboolean:FD,onumber:DD,optional:$D,ostring:jD,pipeline:LD,preprocess:ND,promise:CD,record:SD,set:AD,strictObject:yD,string:XP,symbol:uD,transformer:e0,tuple:kD,undefined:dD,union:wD,unknown:pD,void:gD,NEVER:BD,ZodIssueCode:H,quotelessJson:Mj,ZodError:Rn}),po={exports:{}},up={},dp,t0;function UD(){if(t0)return dp;t0=1;function r(e,t){typeof t=="boolean"&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return dp=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(n===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1);else return!1;var s=this;return this._timer=setTimeout(function(){s._attempts++,s._operationTimeoutCb&&(s._timeout=setTimeout(function(){s._operationTimeoutCb(s._attempts)},s._operationTimeout),s._options.unref&&s._timeout.unref()),s._fn(s._attempts)},n),this._options.unref&&this._timer.unref(),!0},r.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},r.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},r.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},t=null,n=0,s=0;s<this._errors.length;s++){var i=this._errors[s],a=i.message,o=(e[a]||0)+1;e[a]=o,o>=n&&(t=i,n=o)}return t},dp}var n0;function qD(){return n0||(n0=1,function(r){var e=UD();r.operation=function(t){var n=r.timeouts(t);return new e(n,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},r.timeouts=function(t){if(t instanceof Array)return[].concat(t);var n={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var s in t)n[s]=t[s];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var i=[],a=0;a<n.retries;a++)i.push(this.createTimeout(a,n));return t&&t.forever&&!i.length&&i.push(this.createTimeout(a,n)),i.sort(function(o,l){return o-l}),i},r.createTimeout=function(t,n){var s=n.randomize?Math.random()+1:1,i=Math.round(s*Math.max(n.minTimeout,1)*Math.pow(n.factor,t));return i=Math.min(i,n.maxTimeout),i},r.wrap=function(t,n,s){if(n instanceof Array&&(s=n,n=null),!s){s=[];for(var i in t)typeof t[i]=="function"&&s.push(i)}for(var a=0;a<s.length;a++){var o=s[a],l=t[o];t[o]=(function(u){var d=r.operation(n),h=Array.prototype.slice.call(arguments,1),f=h.pop();h.push(function(p){d.retry(p)||(p&&(arguments[0]=d.mainError()),f.apply(this,arguments))}),d.attempt(function(){u.apply(t,h)})}).bind(t,l),t[o].options=n}}}(up)),up}var hp,r0;function HD(){return r0||(r0=1,hp=qD()),hp}var s0;function WD(){if(s0)return po.exports;s0=1;const r=HD(),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class t extends Error{constructor(o){super(),o instanceof Error?(this.originalError=o,{message:o}=o):(this.originalError=new Error(o),this.originalError.stack=this.stack),this.name="AbortError",this.message=o}}const n=(a,o,l)=>{const c=l.retries-(o-1);return a.attemptNumber=o,a.retriesLeft=c,a},s=a=>e.includes(a),i=(a,o)=>new Promise((l,c)=>{o={onFailedAttempt:()=>{},retries:10,...o};const u=r.operation(o);u.attempt(async d=>{try{l(await a(d))}catch(h){if(!(h instanceof Error)){c(new TypeError(`Non-error was thrown: "${h}". You should only throw errors.`));return}if(h instanceof t)u.stop(),c(h.originalError);else if(h instanceof TypeError&&!s(h.message))u.stop(),c(h);else{n(h,d,o);try{await o.onFailedAttempt(h)}catch(f){c(f);return}u.retry(h)||c(u.mainError())}}})});return po.exports=i,po.exports.default=i,po.exports.AbortError=t,po.exports}var VD=WD();const Ud=Pi(VD),GD=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function sl(r){return typeof r=="string"&&GD.test(r)}var Ft=[];for(var fp=0;fp<256;++fp)Ft.push((fp+256).toString(16).slice(1));function ZD(r,e=0){return(Ft[r[e+0]]+Ft[r[e+1]]+Ft[r[e+2]]+Ft[r[e+3]]+"-"+Ft[r[e+4]]+Ft[r[e+5]]+"-"+Ft[r[e+6]]+Ft[r[e+7]]+"-"+Ft[r[e+8]]+Ft[r[e+9]]+"-"+Ft[r[e+10]]+Ft[r[e+11]]+Ft[r[e+12]]+Ft[r[e+13]]+Ft[r[e+14]]+Ft[r[e+15]]).toLowerCase()}var vu,JD=new Uint8Array(16);function KD(){if(!vu&&(vu=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!vu))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return vu(JD)}var XD=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const i0={randomUUID:XD};function sn(r,e,t){if(i0.randomUUID&&!r)return i0.randomUUID();r=r||{};var n=r.random||(r.rng||KD)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,ZD(n)}var xu={},pp={exports:{}},a0;function YD(){return a0||(a0=1,function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function s(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function i(l,c,u,d,h){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new s(u,d||l,h),p=t?t+c:c;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],f]:l._events[p].push(f):(l._events[p]=f,l._eventsCount++),l}function a(l,c){--l._eventsCount===0?l._events=new n:delete l._events[c]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],u,d;if(this._eventsCount===0)return c;for(d in u=this._events)e.call(u,d)&&c.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},o.prototype.listeners=function(c){var u=t?t+c:c,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,f=d.length,p=new Array(f);h<f;h++)p[h]=d[h].fn;return p},o.prototype.listenerCount=function(c){var u=t?t+c:c,d=this._events[u];return d?d.fn?1:d.length:0},o.prototype.emit=function(c,u,d,h,f,p){var m=t?t+c:c;if(!this._events[m])return!1;var g=this._events[m],b=arguments.length,_,y;if(g.fn){switch(g.once&&this.removeListener(c,g.fn,void 0,!0),b){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,u),!0;case 3:return g.fn.call(g.context,u,d),!0;case 4:return g.fn.call(g.context,u,d,h),!0;case 5:return g.fn.call(g.context,u,d,h,f),!0;case 6:return g.fn.call(g.context,u,d,h,f,p),!0}for(y=1,_=new Array(b-1);y<b;y++)_[y-1]=arguments[y];g.fn.apply(g.context,_)}else{var w=g.length,v;for(y=0;y<w;y++)switch(g[y].once&&this.removeListener(c,g[y].fn,void 0,!0),b){case 1:g[y].fn.call(g[y].context);break;case 2:g[y].fn.call(g[y].context,u);break;case 3:g[y].fn.call(g[y].context,u,d);break;case 4:g[y].fn.call(g[y].context,u,d,h);break;default:if(!_)for(v=1,_=new Array(b-1);v<b;v++)_[v-1]=arguments[v];g[y].fn.apply(g[y].context,_)}}return!0},o.prototype.on=function(c,u,d){return i(this,c,u,d,!1)},o.prototype.once=function(c,u,d){return i(this,c,u,d,!0)},o.prototype.removeListener=function(c,u,d,h){var f=t?t+c:c;if(!this._events[f])return this;if(!u)return a(this,f),this;var p=this._events[f];if(p.fn)p.fn===u&&(!h||p.once)&&(!d||p.context===d)&&a(this,f);else{for(var m=0,g=[],b=p.length;m<b;m++)(p[m].fn!==u||h&&!p[m].once||d&&p[m].context!==d)&&g.push(p[m]);g.length?this._events[f]=g.length===1?g[0]:g:a(this,f)}return this},o.prototype.removeAllListeners=function(c){var u;return c?(u=t?t+c:c,this._events[u]&&a(this,u)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,r.exports=o}(pp)),pp.exports}var mo={exports:{}},mp,o0;function QD(){return o0||(o0=1,mp=(r,e)=>(e=e||(()=>{}),r.then(t=>new Promise(n=>{n(e())}).then(()=>t),t=>new Promise(n=>{n(e())}).then(()=>{throw t})))),mp}var l0;function eF(){if(l0)return mo.exports;l0=1;const r=QD();class e extends Error{constructor(s){super(s),this.name="TimeoutError"}}const t=(n,s,i)=>new Promise((a,o)=>{if(typeof s!="number"||s<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(s===1/0){a(n);return}const l=setTimeout(()=>{if(typeof i=="function"){try{a(i())}catch(d){o(d)}return}const c=typeof i=="string"?i:`Promise timed out after ${s} milliseconds`,u=i instanceof Error?i:new e(c);typeof n.cancel=="function"&&n.cancel(),o(u)},s);r(n.then(a,o),()=>{clearTimeout(l)})});return mo.exports=t,mo.exports.default=t,mo.exports.TimeoutError=e,mo.exports}var ku={},Su={},c0;function tF(){if(c0)return Su;c0=1,Object.defineProperty(Su,"__esModule",{value:!0});function r(e,t,n){let s=0,i=e.length;for(;i>0;){const a=i/2|0;let o=s+a;n(e[o],t)<=0?(s=++o,i-=a+1):i=a}return s}return Su.default=r,Su}var u0;function nF(){if(u0)return ku;u0=1,Object.defineProperty(ku,"__esModule",{value:!0});const r=tF();class e{constructor(){this._queue=[]}enqueue(n,s){s=Object.assign({priority:0},s);const i={priority:s.priority,run:n};if(this.size&&this._queue[this.size-1].priority>=s.priority){this._queue.push(i);return}const a=r.default(this._queue,i,(o,l)=>l.priority-o.priority);this._queue.splice(a,0,i)}dequeue(){const n=this._queue.shift();return n==null?void 0:n.run}filter(n){return this._queue.filter(s=>s.priority===n.priority).map(s=>s.run)}get size(){return this._queue.length}}return ku.default=e,ku}var d0;function rF(){if(d0)return xu;d0=1,Object.defineProperty(xu,"__esModule",{value:!0});const r=YD(),e=eF(),t=nF(),n=()=>{},s=new e.TimeoutError;class i extends r{constructor(o){var l,c,u,d;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=n,this._resolveIdle=n,o=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:t.default},o),!(typeof o.intervalCap=="number"&&o.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(c=(l=o.intervalCap)===null||l===void 0?void 0:l.toString())!==null&&c!==void 0?c:""}\` (${typeof o.intervalCap})`);if(o.interval===void 0||!(Number.isFinite(o.interval)&&o.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(d=(u=o.interval)===null||u===void 0?void 0:u.toString())!==null&&d!==void 0?d:""}\` (${typeof o.interval})`);this._carryoverConcurrencyCount=o.carryoverConcurrencyCount,this._isIntervalIgnored=o.intervalCap===1/0||o.interval===0,this._intervalCap=o.intervalCap,this._interval=o.interval,this._queue=new o.queueClass,this._queueClass=o.queueClass,this.concurrency=o.concurrency,this._timeout=o.timeout,this._throwOnTimeout=o.throwOnTimeout===!0,this._isPaused=o.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=n,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=n,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const o=Date.now();if(this._intervalId===void 0){const l=this._intervalEnd-o;if(l<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},l)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const o=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const l=this._queue.dequeue();return l?(this.emit("active"),l(),o&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(o){if(!(typeof o=="number"&&o>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${o}\` (${typeof o})`);this._concurrency=o,this._processQueue()}async add(o,l={}){return new Promise((c,u)=>{const d=async()=>{this._pendingCount++,this._intervalCount++;try{const h=this._timeout===void 0&&l.timeout===void 0?o():e.default(Promise.resolve(o()),l.timeout===void 0?this._timeout:l.timeout,()=>{(l.throwOnTimeout===void 0?this._throwOnTimeout:l.throwOnTimeout)&&u(s)});c(await h)}catch(h){u(h)}this._next()};this._queue.enqueue(d,l),this._tryToStartAnother(),this.emit("add")})}async addAll(o,l){return Promise.all(o.map(async c=>this.add(c,l)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(o=>{const l=this._resolveEmpty;this._resolveEmpty=()=>{l(),o()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(o=>{const l=this._resolveIdle;this._resolveIdle=()=>{l(),o()}})}get size(){return this._queue.size}sizeBy(o){return this._queue.filter(o).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(o){this._timeout=o}}return xu.default=i,xu}var sF=rF();const Qr=Pi(sF),iF=(...r)=>fetch(...r),aF=Symbol.for("ls:fetch_implementation"),he=()=>globalThis[aF]??iF,oF=[400,401,403,404,405,406,407,408],lF=[409];let h0=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in Qr?this.queue=new Qr.default({concurrency:this.maxConcurrency}):this.queue=new Qr({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...t){const n=this.onFailedResponseHook;return this.queue.add(()=>Ud(()=>e(...t).catch(s=>{throw s instanceof Error?s:new Error(s)}),{async onFailedAttempt(s){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.message.startsWith("AbortError")||(s==null?void 0:s.code)==="ECONNABORTED")throw s;const i=s==null?void 0:s.response,a=i==null?void 0:i.status;if(a){if(oF.includes(+a))throw s;if(lF.includes(+a))return;n&&await n(i)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>he()(...e).then(t=>t.ok?t:Promise.reject(t)))}};function f0(r){return typeof(r==null?void 0:r._getType)=="function"}function p0(r){const e={type:r._getType(),data:{content:r.content}};return r!=null&&r.additional_kwargs&&Object.keys(r.additional_kwargs).length>0&&(e.data.additional_kwargs={...r.additional_kwargs}),e}function Ee(r,e){if(!sl(r)){const t=e!==void 0?`Invalid UUID for ${e}: ${r}`:`Invalid UUID: ${r}`;throw new Error(t)}return r}const m0={};function eA(r){m0[r]||(console.warn(r),m0[r]=!0)}var Pu={exports:{}},gp,g0;function Vh(){if(g0)return gp;g0=1;const r="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,n=16,s=e-6;return gp={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:s,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:r,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},gp}var bp,b0;function Gh(){if(b0)return bp;b0=1;var r={};return bp=typeof process=="object"&&r&&r.NODE_DEBUG&&/\bsemver\b/i.test(r.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{},bp}var _0;function Ic(){return _0||(_0=1,function(r,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:s}=Vh(),i=Gh();e=r.exports={};const a=e.re=[],o=e.safeRe=[],l=e.src=[],c=e.safeSrc=[],u=e.t={};let d=0;const h="[a-zA-Z0-9-]",f=[["\\s",1],["\\d",s],[h,n]],p=g=>{for(const[b,_]of f)g=g.split(`${b}*`).join(`${b}{0,${_}}`).split(`${b}+`).join(`${b}{1,${_}}`);return g},m=(g,b,_)=>{const y=p(b),w=d++;i(g,w,b),u[g]=w,l[w]=b,c[w]=y,a[w]=new RegExp(b,_?"g":void 0),o[w]=new RegExp(y,_?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${h}*`),m("MAINVERSION",`(${l[u.NUMERICIDENTIFIER]})\\.(${l[u.NUMERICIDENTIFIER]})\\.(${l[u.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${l[u.NUMERICIDENTIFIERLOOSE]})\\.(${l[u.NUMERICIDENTIFIERLOOSE]})\\.(${l[u.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${l[u.NUMERICIDENTIFIER]}|${l[u.NONNUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${l[u.NUMERICIDENTIFIERLOOSE]}|${l[u.NONNUMERICIDENTIFIER]})`),m("PRERELEASE",`(?:-(${l[u.PRERELEASEIDENTIFIER]}(?:\\.${l[u.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${l[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[u.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${h}+`),m("BUILD",`(?:\\+(${l[u.BUILDIDENTIFIER]}(?:\\.${l[u.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${l[u.MAINVERSION]}${l[u.PRERELEASE]}?${l[u.BUILD]}?`),m("FULL",`^${l[u.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${l[u.MAINVERSIONLOOSE]}${l[u.PRERELEASELOOSE]}?${l[u.BUILD]}?`),m("LOOSE",`^${l[u.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${l[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${l[u.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${l[u.XRANGEIDENTIFIER]})(?:\\.(${l[u.XRANGEIDENTIFIER]})(?:\\.(${l[u.XRANGEIDENTIFIER]})(?:${l[u.PRERELEASE]})?${l[u.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${l[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[u.XRANGEIDENTIFIERLOOSE]})(?:${l[u.PRERELEASELOOSE]})?${l[u.BUILD]}?)?)?`),m("XRANGE",`^${l[u.GTLT]}\\s*${l[u.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${l[u.GTLT]}\\s*${l[u.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),m("COERCE",`${l[u.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",l[u.COERCEPLAIN]+`(?:${l[u.PRERELEASE]})?(?:${l[u.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",l[u.COERCE],!0),m("COERCERTLFULL",l[u.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${l[u.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",m("TILDE",`^${l[u.LONETILDE]}${l[u.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${l[u.LONETILDE]}${l[u.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${l[u.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",m("CARET",`^${l[u.LONECARET]}${l[u.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${l[u.LONECARET]}${l[u.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${l[u.GTLT]}\\s*(${l[u.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${l[u.GTLT]}\\s*(${l[u.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${l[u.GTLT]}\\s*(${l[u.LOOSEPLAIN]}|${l[u.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${l[u.XRANGEPLAIN]})\\s+-\\s+(${l[u.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${l[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[u.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(Pu,Pu.exports)),Pu.exports}var _p,y0;function T_(){if(y0)return _p;y0=1;const r=Object.freeze({loose:!0}),e=Object.freeze({});return _p=n=>n?typeof n!="object"?r:n:e,_p}var yp,w0;function tA(){if(w0)return yp;w0=1;const r=/^[0-9]+$/,e=(n,s)=>{const i=r.test(n),a=r.test(s);return i&&a&&(n=+n,s=+s),n===s?0:i&&!a?-1:a&&!i?1:n<s?-1:1};return yp={compareIdentifiers:e,rcompareIdentifiers:(n,s)=>e(s,n)},yp}var wp,v0;function un(){if(v0)return wp;v0=1;const r=Gh(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=Vh(),{safeRe:n,safeSrc:s,t:i}=Ic(),a=T_(),{compareIdentifiers:o}=tA();class l{constructor(u,d){if(d=a(d),u instanceof l){if(u.loose===!!d.loose&&u.includePrerelease===!!d.includePrerelease)return u;u=u.version}else if(typeof u!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof u}".`);if(u.length>e)throw new TypeError(`version is longer than ${e} characters`);r("SemVer",u,d),this.options=d,this.loose=!!d.loose,this.includePrerelease=!!d.includePrerelease;const h=u.trim().match(d.loose?n[i.LOOSE]:n[i.FULL]);if(!h)throw new TypeError(`Invalid Version: ${u}`);if(this.raw=u,this.major=+h[1],this.minor=+h[2],this.patch=+h[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");h[4]?this.prerelease=h[4].split(".").map(f=>{if(/^[0-9]+$/.test(f)){const p=+f;if(p>=0&&p<t)return p}return f}):this.prerelease=[],this.build=h[5]?h[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(u){if(r("SemVer.compare",this.version,this.options,u),!(u instanceof l)){if(typeof u=="string"&&u===this.version)return 0;u=new l(u,this.options)}return u.version===this.version?0:this.compareMain(u)||this.comparePre(u)}compareMain(u){return u instanceof l||(u=new l(u,this.options)),o(this.major,u.major)||o(this.minor,u.minor)||o(this.patch,u.patch)}comparePre(u){if(u instanceof l||(u=new l(u,this.options)),this.prerelease.length&&!u.prerelease.length)return-1;if(!this.prerelease.length&&u.prerelease.length)return 1;if(!this.prerelease.length&&!u.prerelease.length)return 0;let d=0;do{const h=this.prerelease[d],f=u.prerelease[d];if(r("prerelease compare",d,h,f),h===void 0&&f===void 0)return 0;if(f===void 0)return 1;if(h===void 0)return-1;if(h===f)continue;return o(h,f)}while(++d)}compareBuild(u){u instanceof l||(u=new l(u,this.options));let d=0;do{const h=this.build[d],f=u.build[d];if(r("build compare",d,h,f),h===void 0&&f===void 0)return 0;if(f===void 0)return 1;if(h===void 0)return-1;if(h===f)continue;return o(h,f)}while(++d)}inc(u,d,h){if(u.startsWith("pre")){if(!d&&h===!1)throw new Error("invalid increment argument: identifier is empty");if(d){const f=new RegExp(`^${this.options.loose?s[i.PRERELEASELOOSE]:s[i.PRERELEASE]}$`),p=`-${d}`.match(f);if(!p||p[1]!==d)throw new Error(`invalid identifier: ${d}`)}}switch(u){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",d,h);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",d,h);break;case"prepatch":this.prerelease.length=0,this.inc("patch",d,h),this.inc("pre",d,h);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",d,h),this.inc("pre",d,h);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const f=Number(h)?1:0;if(this.prerelease.length===0)this.prerelease=[f];else{let p=this.prerelease.length;for(;--p>=0;)typeof this.prerelease[p]=="number"&&(this.prerelease[p]++,p=-2);if(p===-1){if(d===this.prerelease.join(".")&&h===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(f)}}if(d){let p=[d,f];h===!1&&(p=[d]),o(this.prerelease[0],d)===0?isNaN(this.prerelease[1])&&(this.prerelease=p):this.prerelease=p}break}default:throw new Error(`invalid increment argument: ${u}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return wp=l,wp}var vp,x0;function Za(){if(x0)return vp;x0=1;const r=un();return vp=(t,n,s=!1)=>{if(t instanceof r)return t;try{return new r(t,n)}catch(i){if(!s)return null;throw i}},vp}var xp,k0;function cF(){if(k0)return xp;k0=1;const r=Za();return xp=(t,n)=>{const s=r(t,n);return s?s.version:null},xp}var kp,S0;function uF(){if(S0)return kp;S0=1;const r=Za();return kp=(t,n)=>{const s=r(t.trim().replace(/^[=v]+/,""),n);return s?s.version:null},kp}var Sp,P0;function dF(){if(P0)return Sp;P0=1;const r=un();return Sp=(t,n,s,i,a)=>{typeof s=="string"&&(a=i,i=s,s=void 0);try{return new r(t instanceof r?t.version:t,s).inc(n,i,a).version}catch{return null}},Sp}var Pp,A0;function hF(){if(A0)return Pp;A0=1;const r=Za();return Pp=(t,n)=>{const s=r(t,null,!0),i=r(n,null,!0),a=s.compare(i);if(a===0)return null;const o=a>0,l=o?s:i,c=o?i:s,u=!!l.prerelease.length;if(!!c.prerelease.length&&!u){if(!c.patch&&!c.minor)return"major";if(c.compareMain(l)===0)return c.minor&&!c.patch?"minor":"patch"}const h=u?"pre":"";return s.major!==i.major?h+"major":s.minor!==i.minor?h+"minor":s.patch!==i.patch?h+"patch":"prerelease"},Pp}var Ap,E0;function fF(){if(E0)return Ap;E0=1;const r=un();return Ap=(t,n)=>new r(t,n).major,Ap}var Ep,O0;function pF(){if(O0)return Ep;O0=1;const r=un();return Ep=(t,n)=>new r(t,n).minor,Ep}var Op,T0;function mF(){if(T0)return Op;T0=1;const r=un();return Op=(t,n)=>new r(t,n).patch,Op}var Tp,R0;function gF(){if(R0)return Tp;R0=1;const r=Za();return Tp=(t,n)=>{const s=r(t,n);return s&&s.prerelease.length?s.prerelease:null},Tp}var Rp,I0;function ur(){if(I0)return Rp;I0=1;const r=un();return Rp=(t,n,s)=>new r(t,s).compare(new r(n,s)),Rp}var Ip,C0;function bF(){if(C0)return Ip;C0=1;const r=ur();return Ip=(t,n,s)=>r(n,t,s),Ip}var Cp,$0;function _F(){if($0)return Cp;$0=1;const r=ur();return Cp=(t,n)=>r(t,n,!0),Cp}var $p,M0;function R_(){if(M0)return $p;M0=1;const r=un();return $p=(t,n,s)=>{const i=new r(t,s),a=new r(n,s);return i.compare(a)||i.compareBuild(a)},$p}var Mp,N0;function yF(){if(N0)return Mp;N0=1;const r=R_();return Mp=(t,n)=>t.sort((s,i)=>r(s,i,n)),Mp}var Np,L0;function wF(){if(L0)return Np;L0=1;const r=R_();return Np=(t,n)=>t.sort((s,i)=>r(i,s,n)),Np}var Lp,j0;function Zh(){if(j0)return Lp;j0=1;const r=ur();return Lp=(t,n,s)=>r(t,n,s)>0,Lp}var jp,D0;function I_(){if(D0)return jp;D0=1;const r=ur();return jp=(t,n,s)=>r(t,n,s)<0,jp}var Dp,F0;function nA(){if(F0)return Dp;F0=1;const r=ur();return Dp=(t,n,s)=>r(t,n,s)===0,Dp}var Fp,z0;function rA(){if(z0)return Fp;z0=1;const r=ur();return Fp=(t,n,s)=>r(t,n,s)!==0,Fp}var zp,B0;function C_(){if(B0)return zp;B0=1;const r=ur();return zp=(t,n,s)=>r(t,n,s)>=0,zp}var Bp,U0;function $_(){if(U0)return Bp;U0=1;const r=ur();return Bp=(t,n,s)=>r(t,n,s)<=0,Bp}var Up,q0;function sA(){if(q0)return Up;q0=1;const r=nA(),e=rA(),t=Zh(),n=C_(),s=I_(),i=$_();return Up=(o,l,c,u)=>{switch(l){case"===":return typeof o=="object"&&(o=o.version),typeof c=="object"&&(c=c.version),o===c;case"!==":return typeof o=="object"&&(o=o.version),typeof c=="object"&&(c=c.version),o!==c;case"":case"=":case"==":return r(o,c,u);case"!=":return e(o,c,u);case">":return t(o,c,u);case">=":return n(o,c,u);case"<":return s(o,c,u);case"<=":return i(o,c,u);default:throw new TypeError(`Invalid operator: ${l}`)}},Up}var qp,H0;function vF(){if(H0)return qp;H0=1;const r=un(),e=Za(),{safeRe:t,t:n}=Ic();return qp=(i,a)=>{if(i instanceof r)return i;if(typeof i=="number"&&(i=String(i)),typeof i!="string")return null;a=a||{};let o=null;if(!a.rtl)o=i.match(a.includePrerelease?t[n.COERCEFULL]:t[n.COERCE]);else{const f=a.includePrerelease?t[n.COERCERTLFULL]:t[n.COERCERTL];let p;for(;(p=f.exec(i))&&(!o||o.index+o[0].length!==i.length);)(!o||p.index+p[0].length!==o.index+o[0].length)&&(o=p),f.lastIndex=p.index+p[1].length+p[2].length;f.lastIndex=-1}if(o===null)return null;const l=o[2],c=o[3]||"0",u=o[4]||"0",d=a.includePrerelease&&o[5]?`-${o[5]}`:"",h=a.includePrerelease&&o[6]?`+${o[6]}`:"";return e(`${l}.${c}.${u}${d}${h}`,a)},qp}var Hp,W0;function xF(){if(W0)return Hp;W0=1;class r{constructor(){this.max=1e3,this.map=new Map}get(t){const n=this.map.get(t);if(n!==void 0)return this.map.delete(t),this.map.set(t,n),n}delete(t){return this.map.delete(t)}set(t,n){if(!this.delete(t)&&n!==void 0){if(this.map.size>=this.max){const i=this.map.keys().next().value;this.delete(i)}this.map.set(t,n)}return this}}return Hp=r,Hp}var Wp,V0;function dr(){if(V0)return Wp;V0=1;const r=/\s+/g;class e{constructor(E,O){if(O=s(O),E instanceof e)return E.loose===!!O.loose&&E.includePrerelease===!!O.includePrerelease?E:new e(E.raw,O);if(E instanceof i)return this.raw=E.value,this.set=[[E]],this.formatted=void 0,this;if(this.options=O,this.loose=!!O.loose,this.includePrerelease=!!O.includePrerelease,this.raw=E.trim().replace(r," "),this.set=this.raw.split("||").map(I=>this.parseRange(I.trim())).filter(I=>I.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const I=this.set[0];if(this.set=this.set.filter(T=>!m(T[0])),this.set.length===0)this.set=[I];else if(this.set.length>1){for(const T of this.set)if(T.length===1&&g(T[0])){this.set=[T];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let E=0;E<this.set.length;E++){E>0&&(this.formatted+="||");const O=this.set[E];for(let I=0;I<O.length;I++)I>0&&(this.formatted+=" "),this.formatted+=O[I].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(E){const I=((this.options.includePrerelease&&f)|(this.options.loose&&p))+":"+E,T=n.get(I);if(T)return T;const L=this.options.loose,W=L?l[c.HYPHENRANGELOOSE]:l[c.HYPHENRANGE];E=E.replace(W,N(this.options.includePrerelease)),a("hyphen replace",E),E=E.replace(l[c.COMPARATORTRIM],u),a("comparator trim",E),E=E.replace(l[c.TILDETRIM],d),a("tilde trim",E),E=E.replace(l[c.CARETTRIM],h),a("caret trim",E);let ee=E.split(" ").map(G=>_(G,this.options)).join(" ").split(/\s+/).map(G=>M(G,this.options));L&&(ee=ee.filter(G=>(a("loose invalid filter",G,this.options),!!G.match(l[c.COMPARATORLOOSE])))),a("range list",ee);const Z=new Map,X=ee.map(G=>new i(G,this.options));for(const G of X){if(m(G))return[G];Z.set(G.value,G)}Z.size>1&&Z.has("")&&Z.delete("");const U=[...Z.values()];return n.set(I,U),U}intersects(E,O){if(!(E instanceof e))throw new TypeError("a Range is required");return this.set.some(I=>b(I,O)&&E.set.some(T=>b(T,O)&&I.every(L=>T.every(W=>L.intersects(W,O)))))}test(E){if(!E)return!1;if(typeof E=="string")try{E=new o(E,this.options)}catch{return!1}for(let O=0;O<this.set.length;O++)if(C(this.set[O],E,this.options))return!0;return!1}}Wp=e;const t=xF(),n=new t,s=T_(),i=Jh(),a=Gh(),o=un(),{safeRe:l,t:c,comparatorTrimReplace:u,tildeTrimReplace:d,caretTrimReplace:h}=Ic(),{FLAG_INCLUDE_PRERELEASE:f,FLAG_LOOSE:p}=Vh(),m=A=>A.value==="<0.0.0-0",g=A=>A.value==="",b=(A,E)=>{let O=!0;const I=A.slice();let T=I.pop();for(;O&&I.length;)O=I.every(L=>T.intersects(L,E)),T=I.pop();return O},_=(A,E)=>(a("comp",A,E),A=x(A,E),a("caret",A),A=w(A,E),a("tildes",A),A=S(A,E),a("xrange",A),A=D(A,E),a("stars",A),A),y=A=>!A||A.toLowerCase()==="x"||A==="*",w=(A,E)=>A.trim().split(/\s+/).map(O=>v(O,E)).join(" "),v=(A,E)=>{const O=E.loose?l[c.TILDELOOSE]:l[c.TILDE];return A.replace(O,(I,T,L,W,ee)=>{a("tilde",A,I,T,L,W,ee);let Z;return y(T)?Z="":y(L)?Z=`>=${T}.0.0 <${+T+1}.0.0-0`:y(W)?Z=`>=${T}.${L}.0 <${T}.${+L+1}.0-0`:ee?(a("replaceTilde pr",ee),Z=`>=${T}.${L}.${W}-${ee} <${T}.${+L+1}.0-0`):Z=`>=${T}.${L}.${W} <${T}.${+L+1}.0-0`,a("tilde return",Z),Z})},x=(A,E)=>A.trim().split(/\s+/).map(O=>k(O,E)).join(" "),k=(A,E)=>{a("caret",A,E);const O=E.loose?l[c.CARETLOOSE]:l[c.CARET],I=E.includePrerelease?"-0":"";return A.replace(O,(T,L,W,ee,Z)=>{a("caret",A,T,L,W,ee,Z);let X;return y(L)?X="":y(W)?X=`>=${L}.0.0${I} <${+L+1}.0.0-0`:y(ee)?L==="0"?X=`>=${L}.${W}.0${I} <${L}.${+W+1}.0-0`:X=`>=${L}.${W}.0${I} <${+L+1}.0.0-0`:Z?(a("replaceCaret pr",Z),L==="0"?W==="0"?X=`>=${L}.${W}.${ee}-${Z} <${L}.${W}.${+ee+1}-0`:X=`>=${L}.${W}.${ee}-${Z} <${L}.${+W+1}.0-0`:X=`>=${L}.${W}.${ee}-${Z} <${+L+1}.0.0-0`):(a("no pr"),L==="0"?W==="0"?X=`>=${L}.${W}.${ee}${I} <${L}.${W}.${+ee+1}-0`:X=`>=${L}.${W}.${ee}${I} <${L}.${+W+1}.0-0`:X=`>=${L}.${W}.${ee} <${+L+1}.0.0-0`),a("caret return",X),X})},S=(A,E)=>(a("replaceXRanges",A,E),A.split(/\s+/).map(O=>R(O,E)).join(" ")),R=(A,E)=>{A=A.trim();const O=E.loose?l[c.XRANGELOOSE]:l[c.XRANGE];return A.replace(O,(I,T,L,W,ee,Z)=>{a("xRange",A,I,T,L,W,ee,Z);const X=y(L),U=X||y(W),G=U||y(ee),le=G;return T==="="&&le&&(T=""),Z=E.includePrerelease?"-0":"",X?T===">"||T==="<"?I="<0.0.0-0":I="*":T&&le?(U&&(W=0),ee=0,T===">"?(T=">=",U?(L=+L+1,W=0,ee=0):(W=+W+1,ee=0)):T==="<="&&(T="<",U?L=+L+1:W=+W+1),T==="<"&&(Z="-0"),I=`${T+L}.${W}.${ee}${Z}`):U?I=`>=${L}.0.0${Z} <${+L+1}.0.0-0`:G&&(I=`>=${L}.${W}.0${Z} <${L}.${+W+1}.0-0`),a("xRange return",I),I})},D=(A,E)=>(a("replaceStars",A,E),A.trim().replace(l[c.STAR],"")),M=(A,E)=>(a("replaceGTE0",A,E),A.trim().replace(l[E.includePrerelease?c.GTE0PRE:c.GTE0],"")),N=A=>(E,O,I,T,L,W,ee,Z,X,U,G,le)=>(y(I)?O="":y(T)?O=`>=${I}.0.0${A?"-0":""}`:y(L)?O=`>=${I}.${T}.0${A?"-0":""}`:W?O=`>=${O}`:O=`>=${O}${A?"-0":""}`,y(X)?Z="":y(U)?Z=`<${+X+1}.0.0-0`:y(G)?Z=`<${X}.${+U+1}.0-0`:le?Z=`<=${X}.${U}.${G}-${le}`:A?Z=`<${X}.${U}.${+G+1}-0`:Z=`<=${Z}`,`${O} ${Z}`.trim()),C=(A,E,O)=>{for(let I=0;I<A.length;I++)if(!A[I].test(E))return!1;if(E.prerelease.length&&!O.includePrerelease){for(let I=0;I<A.length;I++)if(a(A[I].semver),A[I].semver!==i.ANY&&A[I].semver.prerelease.length>0){const T=A[I].semver;if(T.major===E.major&&T.minor===E.minor&&T.patch===E.patch)return!0}return!1}return!0};return Wp}var Vp,G0;function Jh(){if(G0)return Vp;G0=1;const r=Symbol("SemVer ANY");class e{static get ANY(){return r}constructor(u,d){if(d=t(d),u instanceof e){if(u.loose===!!d.loose)return u;u=u.value}u=u.trim().split(/\s+/).join(" "),a("comparator",u,d),this.options=d,this.loose=!!d.loose,this.parse(u),this.semver===r?this.value="":this.value=this.operator+this.semver.version,a("comp",this)}parse(u){const d=this.options.loose?n[s.COMPARATORLOOSE]:n[s.COMPARATOR],h=u.match(d);if(!h)throw new TypeError(`Invalid comparator: ${u}`);this.operator=h[1]!==void 0?h[1]:"",this.operator==="="&&(this.operator=""),h[2]?this.semver=new o(h[2],this.options.loose):this.semver=r}toString(){return this.value}test(u){if(a("Comparator.test",u,this.options.loose),this.semver===r||u===r)return!0;if(typeof u=="string")try{u=new o(u,this.options)}catch{return!1}return i(u,this.operator,this.semver,this.options)}intersects(u,d){if(!(u instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new l(u.value,d).test(this.value):u.operator===""?u.value===""?!0:new l(this.value,d).test(u.semver):(d=t(d),d.includePrerelease&&(this.value==="<0.0.0-0"||u.value==="<0.0.0-0")||!d.includePrerelease&&(this.value.startsWith("<0.0.0")||u.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&u.operator.startsWith(">")||this.operator.startsWith("<")&&u.operator.startsWith("<")||this.semver.version===u.semver.version&&this.operator.includes("=")&&u.operator.includes("=")||i(this.semver,"<",u.semver,d)&&this.operator.startsWith(">")&&u.operator.startsWith("<")||i(this.semver,">",u.semver,d)&&this.operator.startsWith("<")&&u.operator.startsWith(">")))}}Vp=e;const t=T_(),{safeRe:n,t:s}=Ic(),i=sA(),a=Gh(),o=un(),l=dr();return Vp}var Gp,Z0;function Kh(){if(Z0)return Gp;Z0=1;const r=dr();return Gp=(t,n,s)=>{try{n=new r(n,s)}catch{return!1}return n.test(t)},Gp}var Zp,J0;function kF(){if(J0)return Zp;J0=1;const r=dr();return Zp=(t,n)=>new r(t,n).set.map(s=>s.map(i=>i.value).join(" ").trim().split(" ")),Zp}var Jp,K0;function SF(){if(K0)return Jp;K0=1;const r=un(),e=dr();return Jp=(n,s,i)=>{let a=null,o=null,l=null;try{l=new e(s,i)}catch{return null}return n.forEach(c=>{l.test(c)&&(!a||o.compare(c)===-1)&&(a=c,o=new r(a,i))}),a},Jp}var Kp,X0;function PF(){if(X0)return Kp;X0=1;const r=un(),e=dr();return Kp=(n,s,i)=>{let a=null,o=null,l=null;try{l=new e(s,i)}catch{return null}return n.forEach(c=>{l.test(c)&&(!a||o.compare(c)===1)&&(a=c,o=new r(a,i))}),a},Kp}var Xp,Y0;function AF(){if(Y0)return Xp;Y0=1;const r=un(),e=dr(),t=Zh();return Xp=(s,i)=>{s=new e(s,i);let a=new r("0.0.0");if(s.test(a)||(a=new r("0.0.0-0"),s.test(a)))return a;a=null;for(let o=0;o<s.set.length;++o){const l=s.set[o];let c=null;l.forEach(u=>{const d=new r(u.semver.version);switch(u.operator){case">":d.prerelease.length===0?d.patch++:d.prerelease.push(0),d.raw=d.format();case"":case">=":(!c||t(d,c))&&(c=d);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${u.operator}`)}}),c&&(!a||t(a,c))&&(a=c)}return a&&s.test(a)?a:null},Xp}var Yp,Q0;function EF(){if(Q0)return Yp;Q0=1;const r=dr();return Yp=(t,n)=>{try{return new r(t,n).range||"*"}catch{return null}},Yp}var Qp,ex;function M_(){if(ex)return Qp;ex=1;const r=un(),e=Jh(),{ANY:t}=e,n=dr(),s=Kh(),i=Zh(),a=I_(),o=$_(),l=C_();return Qp=(u,d,h,f)=>{u=new r(u,f),d=new n(d,f);let p,m,g,b,_;switch(h){case">":p=i,m=o,g=a,b=">",_=">=";break;case"<":p=a,m=l,g=i,b="<",_="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(u,d,f))return!1;for(let y=0;y<d.set.length;++y){const w=d.set[y];let v=null,x=null;if(w.forEach(k=>{k.semver===t&&(k=new e(">=0.0.0")),v=v||k,x=x||k,p(k.semver,v.semver,f)?v=k:g(k.semver,x.semver,f)&&(x=k)}),v.operator===b||v.operator===_||(!x.operator||x.operator===b)&&m(u,x.semver))return!1;if(x.operator===_&&g(u,x.semver))return!1}return!0},Qp}var em,tx;function OF(){if(tx)return em;tx=1;const r=M_();return em=(t,n,s)=>r(t,n,">",s),em}var tm,nx;function TF(){if(nx)return tm;nx=1;const r=M_();return tm=(t,n,s)=>r(t,n,"<",s),tm}var nm,rx;function RF(){if(rx)return nm;rx=1;const r=dr();return nm=(t,n,s)=>(t=new r(t,s),n=new r(n,s),t.intersects(n,s)),nm}var rm,sx;function IF(){if(sx)return rm;sx=1;const r=Kh(),e=ur();return rm=(t,n,s)=>{const i=[];let a=null,o=null;const l=t.sort((h,f)=>e(h,f,s));for(const h of l)r(h,n,s)?(o=h,a||(a=h)):(o&&i.push([a,o]),o=null,a=null);a&&i.push([a,null]);const c=[];for(const[h,f]of i)h===f?c.push(h):!f&&h===l[0]?c.push("*"):f?h===l[0]?c.push(`<=${f}`):c.push(`${h} - ${f}`):c.push(`>=${h}`);const u=c.join(" || "),d=typeof n.raw=="string"?n.raw:String(n);return u.length<d.length?u:n},rm}var sm,ix;function CF(){if(ix)return sm;ix=1;const r=dr(),e=Jh(),{ANY:t}=e,n=Kh(),s=ur(),i=(d,h,f={})=>{if(d===h)return!0;d=new r(d,f),h=new r(h,f);let p=!1;e:for(const m of d.set){for(const g of h.set){const b=l(m,g,f);if(p=p||b!==null,b)continue e}if(p)return!1}return!0},a=[new e(">=0.0.0-0")],o=[new e(">=0.0.0")],l=(d,h,f)=>{if(d===h)return!0;if(d.length===1&&d[0].semver===t){if(h.length===1&&h[0].semver===t)return!0;f.includePrerelease?d=a:d=o}if(h.length===1&&h[0].semver===t){if(f.includePrerelease)return!0;h=o}const p=new Set;let m,g;for(const S of d)S.operator===">"||S.operator===">="?m=c(m,S,f):S.operator==="<"||S.operator==="<="?g=u(g,S,f):p.add(S.semver);if(p.size>1)return null;let b;if(m&&g){if(b=s(m.semver,g.semver,f),b>0)return null;if(b===0&&(m.operator!==">="||g.operator!=="<="))return null}for(const S of p){if(m&&!n(S,String(m),f)||g&&!n(S,String(g),f))return null;for(const R of h)if(!n(S,String(R),f))return!1;return!0}let _,y,w,v,x=g&&!f.includePrerelease&&g.semver.prerelease.length?g.semver:!1,k=m&&!f.includePrerelease&&m.semver.prerelease.length?m.semver:!1;x&&x.prerelease.length===1&&g.operator==="<"&&x.prerelease[0]===0&&(x=!1);for(const S of h){if(v=v||S.operator===">"||S.operator===">=",w=w||S.operator==="<"||S.operator==="<=",m){if(k&&S.semver.prerelease&&S.semver.prerelease.length&&S.semver.major===k.major&&S.semver.minor===k.minor&&S.semver.patch===k.patch&&(k=!1),S.operator===">"||S.operator===">="){if(_=c(m,S,f),_===S&&_!==m)return!1}else if(m.operator===">="&&!n(m.semver,String(S),f))return!1}if(g){if(x&&S.semver.prerelease&&S.semver.prerelease.length&&S.semver.major===x.major&&S.semver.minor===x.minor&&S.semver.patch===x.patch&&(x=!1),S.operator==="<"||S.operator==="<="){if(y=u(g,S,f),y===S&&y!==g)return!1}else if(g.operator==="<="&&!n(g.semver,String(S),f))return!1}if(!S.operator&&(g||m)&&b!==0)return!1}return!(m&&w&&!g&&b!==0||g&&v&&!m&&b!==0||k||x)},c=(d,h,f)=>{if(!d)return h;const p=s(d.semver,h.semver,f);return p>0?d:p<0||h.operator===">"&&d.operator===">="?h:d},u=(d,h,f)=>{if(!d)return h;const p=s(d.semver,h.semver,f);return p<0?d:p>0||h.operator==="<"&&d.operator==="<="?h:d};return sm=i,sm}var im,ax;function $F(){if(ax)return im;ax=1;const r=Ic(),e=Vh(),t=un(),n=tA(),s=Za(),i=cF(),a=uF(),o=dF(),l=hF(),c=fF(),u=pF(),d=mF(),h=gF(),f=ur(),p=bF(),m=_F(),g=R_(),b=yF(),_=wF(),y=Zh(),w=I_(),v=nA(),x=rA(),k=C_(),S=$_(),R=sA(),D=vF(),M=Jh(),N=dr(),C=Kh(),A=kF(),E=SF(),O=PF(),I=AF(),T=EF(),L=M_(),W=OF(),ee=TF(),Z=RF(),X=IF(),U=CF();return im={parse:s,valid:i,clean:a,inc:o,diff:l,major:c,minor:u,patch:d,prerelease:h,compare:f,rcompare:p,compareLoose:m,compareBuild:g,sort:b,rsort:_,gt:y,lt:w,eq:v,neq:x,gte:k,lte:S,cmp:R,coerce:D,Comparator:M,Range:N,satisfies:C,toComparators:A,maxSatisfying:E,minSatisfying:O,minVersion:I,validRange:T,outside:L,gtr:W,ltr:ee,intersects:Z,simplifyRange:X,subset:U,SemVer:t,re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:n.compareIdentifiers,rcompareIdentifiers:n.rcompareIdentifiers},im}$F();function ds(r){if(!r||r.split("/").length>2||r.startsWith("/")||r.endsWith("/")||r.split(":").length>2)throw new Error(`Invalid identifier format: ${r}`);const[e,t]=r.split(":"),n=t||"latest";if(e.includes("/")){const[s,i]=e.split("/",2);if(!s||!i)throw new Error(`Invalid identifier format: ${r}`);return[s,i,n]}else{if(!e)throw new Error(`Invalid identifier format: ${r}`);return["-",e,n]}}class MF extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}}async function Ie(r,e,t){let n;if(r.ok){t&&(n=await r.text());return}n=await r.text();const s=`Failed to ${e}. Received status [${r.status}]: ${r.statusText}. Server response: ${n}`;throw r.status===409?new MF(s):new Error(s)}var ox="[...]",NF={result:"[Circular]"},qd=[],na=[];const LF=new TextEncoder;function jF(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function Au(r){return LF.encode(r)}function kn(r,e,t,n){var s;try{const i=JSON.stringify(r,e,t);return Au(i)}catch(i){if(!((s=i.message)!=null&&s.includes("Converting circular structure to JSON")))return console.warn("[WARNING]: LangSmith received unserializable value."),Au("[Unserializable]");console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),typeof n>"u"&&(n=jF()),Wg(r,"",0,[],void 0,0,n);let a;try{na.length===0?a=JSON.stringify(r,e,t):a=JSON.stringify(r,DF(e),t)}catch{return Au("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;qd.length!==0;){const o=qd.pop();o.length===4?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}}return Au(a)}}function am(r,e,t,n){var s=Object.getOwnPropertyDescriptor(n,t);s.get!==void 0?s.configurable?(Object.defineProperty(n,t,{value:r}),qd.push([n,t,e,s])):na.push([e,t,r]):(n[t]=r,qd.push([n,t,e]))}function Wg(r,e,t,n,s,i,a){i+=1;var o;if(typeof r=="object"&&r!==null){for(o=0;o<n.length;o++)if(n[o]===r){am(NF,r,e,s);return}if(typeof a.depthLimit<"u"&&i>a.depthLimit){am(ox,r,e,s);return}if(typeof a.edgesLimit<"u"&&t+1>a.edgesLimit){am(ox,r,e,s);return}if(n.push(r),Array.isArray(r))for(o=0;o<r.length;o++)Wg(r[o],o,o,n,r,i,a);else{var l=Object.keys(r);for(o=0;o<l.length;o++){var c=l[o];Wg(r[c],c,o,n,r,i,a)}}n.pop()}}function DF(r){return r=typeof r<"u"?r:function(e,t){return t},function(e,t){if(na.length>0)for(var n=0;n<na.length;n++){var s=na[n];if(s[1]===e&&s[0]===t){t=s[2],na.splice(n,1);break}}return r.call(this,e,t)}}function lx(r){const e=oA(),t=XF(),n=r.extra??{},s=n.metadata;return r.extra={...n,runtime:{...e,...n==null?void 0:n.runtime},metadata:{...t,...t.revision_id||r.revision_id?{revision_id:r.revision_id??t.revision_id}:{},...s}},r}const FF=r=>{const e=(r==null?void 0:r.toString())??_s("TRACING_SAMPLING_RATE");if(e===void 0)return;const t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t},zF=r=>{const t=r.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};async function BF(r){const e=[];for await(const t of r)e.push(t);return e}function om(r){if(r!==void 0)return r.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const UF=async r=>{if((r==null?void 0:r.status)===429){const e=parseInt(r.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};function cx(r){return typeof r=="number"?Number(r.toFixed(4)):r}class qF{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;const n=new Promise(i=>{t=i}),s=kn(e.item).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:t,itemPromise:n,size:s}),this.sizeBytes+=s,n}pop(e){var s;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const t=[];let n=0;for(;n+(((s=this.peek())==null?void 0:s.size)??0)<e&&this.items.length>0;){const i=this.items.shift();i&&(t.push(i),n+=i.size,this.sizeBytes-=i.size)}if(t.length===0&&this.items.length>0){const i=this.items.shift();t.push(i),n+=i.size,this.sizeBytes-=i.size}return[t.map(i=>({action:i.action,item:i.payload})),()=>t.forEach(i=>i.itemPromiseResolve())]}}const HF=20971520,WF=2500;class Bl{constructor(e={}){var n;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new qF}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:fi("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1});const t=Bl.getDefaultClientConfig();if(this.tracingSampleRate=FF(e.tracingSamplingRate),this.apiUrl=om(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=om(e.apiKey??t.apiKey),this.webUrl=om(e.webUrl??t.webUrl),(n=this.webUrl)!=null&&n.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new h0(e.callerOptions??{}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.batchIngestCaller=new h0({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:UF}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode}static getDefaultClientConfig(){const e=_s("API_KEY"),t=_s("ENDPOINT")??"https://api.smith.langchain.com",n=_s("HIDE_INPUTS")==="true",s=_s("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:zF(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${iA}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const t={...e};return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){const n=(t==null?void 0:t.toString())??"",s=`${this.apiUrl}${e}?${n}`,i=await this.caller.call(he(),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(i,`Failed to fetch ${e}`),i}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,n){let s=Number(t.get("offset"))||0;const i=Number(t.get("limit"))||100;for(;;){t.set("offset",String(s)),t.set("limit",String(i));const a=`${this.apiUrl}${e}?${t}`,o=await this.caller.call(he(),a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(o,`Failed to fetch ${e}`);const l=n?n(await o.json()):await o.json();if(l.length===0||(yield l,l.length<i))break;s+=l.length}}async*_getCursorPaginatedList(e,t=null,n="POST",s="runs"){const i=t?{...t}:{};for(;;){const o=await(await this.caller.call(he(),`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(i)})).json();if(!o||!o[s])break;yield o[s];const l=o.cursors;if(!l||!l.next)break;i.cursor=l.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){const n=[];for(const s of e)this.filteredPostUuids.has(s.id)?this.filteredPostUuids.delete(s.id):n.push(s);return n}else{const n=[];for(const s of e){const i=s.trace_id??s.id;this.filteredPostUuids.has(i)||(s.id===i?this._shouldSample()?n.push(s):this.filteredPostUuids.add(i):n.push(s))}return n}}async _getBatchSizeLimitBytes(){var t;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((t=e.batch_ingest_config)==null?void 0:t.size_limit_bytes)??HF}async _getMultiPartSupport(){var t;return((t=(await this._ensureServerInfo()).instance_flags)==null?void 0:t.dataset_examples_multipart_enabled)??!1}drainAutoBatchQueue(e){const t=[];for(;this.autoBatchQueue.items.length>0;){const[n,s]=this.autoBatchQueue.pop(e);if(!n.length){s();break}const i=this._processBatch(n,s).catch(console.error);t.push(i)}return Promise.all(t)}async _processBatch(e,t){var n;if(!e.length){t();return}try{const s={runCreates:e.filter(a=>a.action==="create").map(a=>a.item),runUpdates:e.filter(a=>a.action==="update").map(a=>a.item)},i=await this._ensureServerInfo();(n=i==null?void 0:i.batch_ingest_config)!=null&&n.use_multipart_endpoint?await this.multipartIngestRuns(s):await this.batchIngestRuns(s)}finally{t()}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=lx(e.item));const t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;const n=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>n&&this.drainAutoBatchQueue(n),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(n)},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){const e=await he()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(WF),...this.fetchOptions});return await Ie(e,"get server info"),e.json()}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch{console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to batch operations and default limits.")}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},n=e.project_name;delete e.project_name;const s=this.prepareRunCreateOrUpdateInputs({session_name:n,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){this.processRunOperation({action:"create",item:s}).catch(console.error);return}const i=lx(s),a=await this.caller.call(he(),`${this.apiUrl}/runs`,{method:"POST",headers:t,body:kn(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(a,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let n=(e==null?void 0:e.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[],s=(t==null?void 0:t.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[];if(n.length>0&&s.length>0){const o=n.reduce((c,u)=>(u.id&&(c[u.id]=u),c),{}),l=[];for(const c of s)c.id!==void 0&&o[c.id]?o[c.id]={...o[c.id],...c}:l.push(c);n=Object.values(o),s=l}const i={post:n,patch:s};if(!i.post.length&&!i.patch.length)return;const a={post:[],patch:[]};for(const o of["post","patch"]){const l=o,c=i[l].reverse();let u=c.pop();for(;u!==void 0;)a[l].push(u),u=c.pop()}(a.post.length>0||a.patch.length>0)&&await this._postBatchIngestRuns(kn(a))}async _postBatchIngestRuns(e){const t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},n=await this.batchIngestCaller.call(he(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(n,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;const n={};let s=[];for(const u of e??[]){const d=this.prepareRunCreateOrUpdateInputs(u);d.id!==void 0&&d.attachments!==void 0&&(n[d.id]=d.attachments),delete d.attachments,s.push(d)}let i=[];for(const u of t??[])i.push(this.prepareRunCreateOrUpdateInputs(u));if(s.find(u=>u.trace_id===void 0||u.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(i.find(u=>u.trace_id===void 0||u.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(s.length>0&&i.length>0){const u=s.reduce((h,f)=>(f.id&&(h[f.id]=f),h),{}),d=[];for(const h of i)h.id!==void 0&&u[h.id]?u[h.id]={...u[h.id],...h}:d.push(h);s=Object.values(u),i=d}if(s.length===0&&i.length===0)return;const l=[],c=[];for(const[u,d]of[["post",s],["patch",i]])for(const h of d){const{inputs:f,outputs:p,events:m,attachments:g,...b}=h,_={inputs:f,outputs:p,events:m},y=kn(b);c.push({name:`${u}.${b.id}`,payload:new Blob([y],{type:`application/json; length=${y.length}`})});for(const[w,v]of Object.entries(_)){if(v===void 0)continue;const x=kn(v);c.push({name:`${u}.${b.id}.${w}`,payload:new Blob([x],{type:`application/json; length=${x.length}`})})}if(b.id!==void 0){const w=n[b.id];if(w){delete n[b.id];for(const[v,x]of Object.entries(w)){let k,S;if(Array.isArray(x)?[k,S]=x:(k=x.mimeType,S=x.data),v.includes(".")){console.warn(`Skipping attachment '${v}' for run ${b.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}c.push({name:`attachment.${b.id}.${v}`,payload:new Blob([S],{type:`${k}; length=${S.byteLength}`})})}}}l.push(`trace=${b.trace_id},id=${b.id}`)}await this._sendMultipartRequest(c,l.join("; "))}async _sendMultipartRequest(e,t){try{const n="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),s=[];for(const l of e)s.push(new Blob([`--${n}\r
`])),s.push(new Blob([`Content-Disposition: form-data; name="${l.name}"\r
`,`Content-Type: ${l.payload.type}\r
\r
`])),s.push(l.payload),s.push(new Blob([`\r
`]));s.push(new Blob([`--${n}--\r
`]));const a=await new Blob(s).arrayBuffer(),o=await this.batchIngestCaller.call(he(),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers,"Content-Type":`multipart/form-data; boundary=${n}`},body:a,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(o,"ingest multipart runs",!0)}catch(n){console.warn(`${n.message.trim()}

Context: ${t}`)}}async updateRun(e,t){Ee(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));const n={...t,id:e};if(!this._filterForSampling([n],!0).length)return;if(this.autoBatchTracing&&n.trace_id!==void 0&&n.dotted_order!==void 0){if(t.end_time!==void 0&&n.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:n}).catch(console.error);return}else this.processRunOperation({action:"update",item:n}).catch(console.error);return}const s={...this.headers,"Content-Type":"application/json"},i=await this.caller.call(he(),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:s,body:kn(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(i,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){Ee(e);let n=await this._get(`/runs/${e}`);return t&&n.child_run_ids&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:t,projectOpts:n}){if(t!==void 0){let s;t.session_id?s=t.session_id:n!=null&&n.projectName?s=(await this.readProject({projectName:n==null?void 0:n.projectName})).id:n!=null&&n.projectId?s=n==null?void 0:n.projectId:s=(await this.readProject({projectName:_s("PROJECT")||"default"})).id;const i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${s}/r/${t.id}?poll=true`}else if(e!==void 0){const s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await BF(this.listRuns({id:e.child_run_ids})),n={},s={};t.sort((i,a)=>((i==null?void 0:i.dotted_order)??"").localeCompare((a==null?void 0:a.dotted_order)??""));for(const i of t){if(i.parent_run_id===null||i.parent_run_id===void 0)throw new Error(`Child run ${i.id} has no parent`);i.parent_run_id in n||(n[i.parent_run_id]=[]),n[i.parent_run_id].push(i),s[i.id]=i}e.child_runs=n[e.id]||[];for(const i in n)i!==e.id&&(s[i].child_runs=n[i]);return e}async*listRuns(e){const{projectId:t,projectName:n,parentRunId:s,traceId:i,referenceExampleId:a,startTime:o,executionOrder:l,isRoot:c,runType:u,error:d,id:h,query:f,filter:p,traceFilter:m,treeFilter:g,limit:b,select:_}=e;let y=[];if(t&&(y=Array.isArray(t)?t:[t]),n){const k=Array.isArray(n)?n:[n],S=await Promise.all(k.map(R=>this.readProject({projectName:R}).then(D=>D.id)));y.push(...S)}const w=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],v={session:y.length?y:null,run_type:u,reference_example:a,query:f,filter:p,trace_filter:m,tree_filter:g,execution_order:l,parent_run:s,start_time:o?o.toISOString():null,error:d,id:h,limit:b,trace:i,select:_||w,is_root:c};let x=0;for await(const k of this._getCursorPaginatedList("/runs/query",v))if(b){if(x>=b)break;if(k.length+x>b){yield*k.slice(0,b-x);break}x+=k.length,yield*k}else yield*k}async getRunStats({id:e,trace:t,parentRun:n,runType:s,projectNames:i,projectIds:a,referenceExampleIds:o,startTime:l,endTime:c,error:u,query:d,filter:h,traceFilter:f,treeFilter:p,isRoot:m,dataSourceType:g}){let b=a||[];i&&(b=[...a||[],...await Promise.all(i.map(x=>this.readProject({projectName:x}).then(k=>k.id)))]);const y=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:n,run_type:s,session:b,reference_example:o,start_time:l,end_time:c,error:u,query:d,filter:h,trace_filter:f,tree_filter:p,is_root:m,data_source_type:g}).filter(([x,k])=>k!==void 0));return await(await this.caller.call(he(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(y),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:t}={}){const n={run_id:e,share_token:t||sn()};Ee(e);const i=await(await this.caller.call(he(),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(i===null||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){Ee(e);const t=await this.caller.call(he(),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(t,"unshare run",!0)}async readRunSharedLink(e){Ee(e);const n=await(await this.caller.call(he(),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(n===null||!("share_token"in n)))return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const n=new URLSearchParams({share_token:e});if(t!==void 0)for(const a of t)n.append("id",a);return Ee(e),await(await this.caller.call(he(),`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),Ee(e);const s=await(await this.caller.call(he(),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const n={dataset_id:e};Ee(e);const i=await(await this.caller.call(he(),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async unshareDataset(e){Ee(e);const t=await this.caller.call(he(),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(t,"unshare dataset",!0)}async readSharedDataset(e){return Ee(e),await(await this.caller.call(he(),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,t){const n={};t!=null&&t.exampleIds&&(n.id=t.exampleIds);const s=new URLSearchParams;Object.entries(n).forEach(([o,l])=>{Array.isArray(l)?l.forEach(c=>s.append(o,c)):s.append(o,l)});const i=await this.caller.call(he(),`${this.apiUrl}/public/${e}/examples?${s.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),a=await i.json();if(!i.ok)throw"detail"in a?new Error(`Failed to list shared examples.
Status: ${i.status}
Message: ${a.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${i.status} ${i.statusText}`);return a.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:n=null,upsert:s=!1,projectExtra:i=null,referenceDatasetId:a=null}){const o=s?"?upsert=true":"",l=`${this.apiUrl}/sessions${o}`,c=i||{};n&&(c.metadata=n);const u={name:e,extra:c,description:t};a!==null&&(u.reference_dataset_id=a);const d=await this.caller.call(he(),l,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(d,"create project"),await d.json()}async updateProject(e,{name:t=null,description:n=null,metadata:s=null,projectExtra:i=null,endTime:a=null}){const o=`${this.apiUrl}/sessions/${e}`;let l=i;s&&(l={...l||{},metadata:s});const c={name:t,extra:l,description:n,end_time:a?new Date(a).toISOString():null},u=await this.caller.call(he(),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(u,"update project"),await u.json()}async hasProject({projectId:e,projectName:t}){let n="/sessions";const s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Ee(e),n+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");const i=await this.caller.call(he(),`${this.apiUrl}${n}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const a=await i.json();return i.ok?Array.isArray(a)?a.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:n}){let s="/sessions";const i=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Ee(e),s+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide projectName or projectId");n!==void 0&&i.append("include_stats",n.toString());const a=await this._get(s,i);let o;if(Array.isArray(a)){if(a.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=a[0]}else o=a;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");const n=await this.readProject({projectId:e,projectName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${n.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");const n=await this.readDataset({datasetId:e,datasetName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${n.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:n,referenceDatasetId:s,referenceDatasetName:i,referenceFree:a,metadata:o}={}){const l=new URLSearchParams;if(e!==void 0)for(const c of e)l.append("id",c);if(t!==void 0&&l.append("name",t),n!==void 0&&l.append("name_contains",n),s!==void 0)l.append("reference_dataset",s);else if(i!==void 0){const c=await this.readDataset({datasetName:i});l.append("reference_dataset",c.id)}a!==void 0&&l.append("reference_free",a.toString()),o!==void 0&&l.append("metadata",JSON.stringify(o));for await(const c of this._getPaginated("/sessions",l))yield*c}async deleteProject({projectId:e,projectName:t}){let n;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?n=(await this.readProject({projectName:t})).id:n=e,Ee(n);const s=await this.caller.call(he(),`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(s,`delete session ${n} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:n,outputKeys:s,description:i,dataType:a,name:o}){const l=`${this.apiUrl}/datasets/upload`,c=new FormData;c.append("file",e,t),n.forEach(h=>{c.append("input_keys",h)}),s.forEach(h=>{c.append("output_keys",h)}),i&&c.append("description",i),a&&c.append("data_type",a),o&&c.append("name",o);const u=await this.caller.call(he(),l,{method:"POST",headers:this.headers,body:c,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(u,"upload CSV"),await u.json()}async createDataset(e,{description:t,dataType:n,inputsSchema:s,outputsSchema:i,metadata:a}={}){const o={name:e,description:t,extra:a?{metadata:a}:void 0};n&&(o.data_type=n),s&&(o.inputs_schema_definition=s),i&&(o.outputs_schema_definition=i);const l=await this.caller.call(he(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(l,"create dataset"),await l.json()}async readDataset({datasetId:e,datasetName:t}){let n="/datasets";const s=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)Ee(e),n+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");const i=await this._get(n,s);let a;if(Array.isArray(i)){if(i.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);a=i[0]}else a=i;return a}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(n){if(n instanceof Error&&n.message.toLocaleLowerCase().includes("not found"))return!1;throw n}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:n,toVersion:s}){let i=e;if(i===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(i!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");i===void 0&&(i=(await this.readDataset({datasetName:t})).id);const a=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${i}/versions/diff`,a)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const n="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${n}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:n,datasetName:s,datasetNameContains:i,metadata:a}={}){const o="/datasets",l=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(n!==void 0)for(const c of n)l.append("id",c);s!==void 0&&l.append("name",s),i!==void 0&&l.append("name_contains",i),a!==void 0&&l.append("metadata",JSON.stringify(a));for await(const c of this._getPaginated(o,l))yield*c}async updateDataset(e){const{datasetId:t,datasetName:n,...s}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");const i=t??(await this.readDataset({datasetName:n})).id;Ee(i);const a=await this.caller.call(he(),`${this.apiUrl}/datasets/${i}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(a,"update dataset"),await a.json()}async updateDatasetTag(e){const{datasetId:t,datasetName:n,asOf:s,tag:i}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");const a=t??(await this.readDataset({datasetName:n})).id;Ee(a);const o=await this.caller.call(he(),`${this.apiUrl}/datasets/${a}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:typeof s=="string"?s:s.toISOString(),tag:i}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(o,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:t}){let n="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(await this.readDataset({datasetName:t})).id),s!==void 0)Ee(s),n+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");const i=await this.caller.call(he(),this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(i,`delete ${n}`),await i.json()}async indexDataset({datasetId:e,datasetName:t,tag:n}){let s=e;if(!s&&!t)throw new Error("Must provide either datasetName or datasetId");if(s&&t)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(await this.readDataset({datasetName:t})).id),Ee(s);const i={tag:n},a=await this.caller.call(he(),`${this.apiUrl}/datasets/${s}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(a,"index dataset"),await a.json()}async similarExamples(e,t,n,{filter:s}={}){const i={limit:n,inputs:e};s!==void 0&&(i.filter=s),Ee(t);const a=await this.caller.call(he(),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(a,"fetch similar examples"),(await a.json()).examples}async createExample(e,t,n){var u;if(ux(e)&&(t!==void 0||n!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let s=t?n==null?void 0:n.datasetId:e.dataset_id;const i=t?n==null?void 0:n.datasetName:e.dataset_name;if(s===void 0&&i===void 0)throw new Error("Must provide either datasetName or datasetId");if(s!==void 0&&i!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");s===void 0&&(s=(await this.readDataset({datasetName:i})).id);const a=(t?n==null?void 0:n.createdAt:e.created_at)||new Date;let o;ux(e)?o=e:o={inputs:e,outputs:t,created_at:a==null?void 0:a.toISOString(),id:n==null?void 0:n.exampleId,metadata:n==null?void 0:n.metadata,split:n==null?void 0:n.split,source_run_id:n==null?void 0:n.sourceRunId,use_source_run_io:n==null?void 0:n.useSourceRunIO,use_source_run_attachments:n==null?void 0:n.useSourceRunAttachments,attachments:n==null?void 0:n.attachments};const l=await this._uploadExamplesMultipart(s,[o]);return await this.readExample(((u=l.example_ids)==null?void 0:u[0])??sn())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];const _=e;let y=_[0].dataset_id;const w=_[0].dataset_name;if(y===void 0&&w===void 0)throw new Error("Must provide either datasetName or datasetId");if(y!==void 0&&w!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");y===void 0&&(y=(await this.readDataset({datasetName:w})).id);const v=await this._uploadExamplesMultipart(y,_);return await Promise.all(v.example_ids.map(k=>this.readExample(k)))}const{inputs:t,outputs:n,metadata:s,splits:i,sourceRunIds:a,useSourceRunIOs:o,useSourceRunAttachments:l,attachments:c,exampleIds:u,datasetId:d,datasetName:h}=e;if(t===void 0)throw new Error("Must provide inputs when using legacy parameters");let f=d;const p=h;if(f===void 0&&p===void 0)throw new Error("Must provide either datasetName or datasetId");if(f!==void 0&&p!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");f===void 0&&(f=(await this.readDataset({datasetName:p})).id);const m=t.map((_,y)=>({dataset_id:f,inputs:_,outputs:n==null?void 0:n[y],metadata:s==null?void 0:s[y],split:i==null?void 0:i[y],id:u==null?void 0:u[y],attachments:c==null?void 0:c[y],source_run_id:a==null?void 0:a[y],use_source_run_io:o==null?void 0:o[y],use_source_run_attachments:l==null?void 0:l[y]})),g=await this._uploadExamplesMultipart(f,m);return await Promise.all(g.example_ids.map(_=>this.readExample(_)))}async createLLMExample(e,t,n){return this.createExample({input:e},{output:t},n)}async createChatExample(e,t,n){const s=e.map(a=>f0(a)?p0(a):a),i=f0(t)?p0(t):t;return this.createExample({input:s},{output:i},n)}async readExample(e){Ee(e);const t=`/examples/${e}`,n=await this._get(t),{attachment_urls:s,...i}=n,a=i;return s&&(a.attachments=Object.entries(s).reduce((o,[l,c])=>(o[l.slice(11)]={presigned_url:c.presigned_url,mime_type:c.mime_type},o),{})),a}async*listExamples({datasetId:e,datasetName:t,exampleIds:n,asOf:s,splits:i,inlineS3Urls:a,metadata:o,limit:l,offset:c,filter:u,includeAttachments:d}={}){let h;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)h=e;else if(t!==void 0)h=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const f=new URLSearchParams({dataset:h}),p=s?typeof s=="string"?s:s==null?void 0:s.toISOString():void 0;p&&f.append("as_of",p);const m=a??!0;if(f.append("inline_s3_urls",m.toString()),n!==void 0)for(const b of n)f.append("id",b);if(i!==void 0)for(const b of i)f.append("splits",b);if(o!==void 0){const b=JSON.stringify(o);f.append("metadata",b)}l!==void 0&&f.append("limit",l.toString()),c!==void 0&&f.append("offset",c.toString()),u!==void 0&&f.append("filter",u),d===!0&&["attachment_urls","outputs","metadata"].forEach(b=>f.append("select",b));let g=0;for await(const b of this._getPaginated("/examples",f)){for(const _ of b){const{attachment_urls:y,...w}=_,v=w;y&&(v.attachments=Object.entries(y).reduce((x,[k,S])=>(x[k.slice(11)]={presigned_url:S.presigned_url,mime_type:S.mime_type||void 0},x),{})),yield v,g++}if(l!==void 0&&g>=l)break}}async deleteExample(e){Ee(e);const t=`/examples/${e}`,n=await this.caller.call(he(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(n,`delete ${t}`),await n.json()}async updateExample(e,t){let n;t?n=e:n=e.id,Ee(n);let s;t?s={id:n,...t}:s=e;let i;return s.dataset_id!==void 0?i=s.dataset_id:i=(await this.readExample(n)).dataset_id,this._updateExamplesMultipart(i,[s])}async updateExamples(e){let t;return e[0].dataset_id===void 0?t=(await this.readExample(e[0].id)).dataset_id:t=e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:n,tag:s}){let i;if(e?i=e:i=(await this.readDataset({datasetName:t})).id,Ee(i),n&&s||!n&&!s)throw new Error("Exactly one of asOf and tag must be specified.");const a=new URLSearchParams;n!==void 0&&a.append("as_of",typeof n=="string"?n:n.toISOString()),s!==void 0&&a.append("tag",s);const o=await this.caller.call(he(),`${this.apiUrl}/datasets/${i}/version?${a.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(o,"read dataset version"),await o.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:n}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:t})).id:s=e,Ee(s);const i=new URLSearchParams,a=n?typeof n=="string"?n:n==null?void 0:n.toISOString():void 0;return a&&i.append("as_of",a),await this._get(`/datasets/${s}/splits`,i)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:n,exampleIds:s,remove:i=!1}){let a;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?a=(await this.readDataset({datasetName:t})).id:a=e,Ee(a);const o={split_name:n,examples:s.map(c=>(Ee(c),c)),remove:i},l=await this.caller.call(he(),`${this.apiUrl}/datasets/${a}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(l,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:n,loadChildRuns:s,referenceExample:i}={loadChildRuns:!1}){eA("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let a;if(typeof e=="string")a=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)a=e;else throw new Error(`Invalid run type: ${typeof e}`);a.reference_example_id!==null&&a.reference_example_id!==void 0&&(i=await this.readExample(a.reference_example_id));const o=await t.evaluateRun(a,i),[l,c]=await this._logEvaluationFeedback(o,a,n);return c[0]}async createFeedback(e,t,{score:n,value:s,correction:i,comment:a,sourceInfo:o,feedbackSourceType:l="api",sourceRunId:c,feedbackId:u,feedbackConfig:d,projectId:h,comparativeExperimentId:f}){var _;if(!e&&!h)throw new Error("One of runId or projectId must be provided");if(e&&h)throw new Error("Only one of runId or projectId can be provided");const p={type:l??"api",metadata:o??{}};c!==void 0&&(p==null?void 0:p.metadata)!==void 0&&!p.metadata.__run&&(p.metadata.__run={run_id:c}),(p==null?void 0:p.metadata)!==void 0&&((_=p.metadata.__run)==null?void 0:_.run_id)!==void 0&&Ee(p.metadata.__run.run_id);const m={id:u??sn(),run_id:e,key:t,score:cx(n),value:s,correction:i,comment:a,feedback_source:p,comparative_experiment_id:f,feedbackConfig:d,session_id:h},g=`${this.apiUrl}/feedback`,b=await this.caller.call(he(),g,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(m),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(b,"create feedback",!0),m}async updateFeedback(e,{score:t,value:n,correction:s,comment:i}){const a={};t!=null&&(a.score=cx(t)),n!=null&&(a.value=n),s!=null&&(a.correction=s),i!=null&&(a.comment=i),Ee(e);const o=await this.caller.call(he(),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(o,"update feedback",!0)}async readFeedback(e){Ee(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){Ee(e);const t=`/feedback/${e}`,n=await this.caller.call(he(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(n,`delete ${t}`),await n.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:n}={}){const s=new URLSearchParams;if(e&&s.append("run",e.join(",")),t)for(const i of t)s.append("key",i);if(n)for(const i of n)s.append("source",i);for await(const i of this._getPaginated("/feedback",s))yield*i}async createPresignedFeedbackToken(e,t,{expiration:n,feedbackConfig:s}={}){const i={run_id:e,feedback_key:t,feedback_config:s};return n?typeof n=="string"?i.expires_at=n:(n!=null&&n.hours||n!=null&&n.minutes||n!=null&&n.days)&&(i.expires_in=n):i.expires_in={hours:3},await(await this.caller.call(he(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:n,createdAt:s,description:i,metadata:a,id:o}){var u;if(t.length===0)throw new Error("At least one experiment is required");if(n||(n=(await this.readProject({projectId:t[0]})).reference_dataset_id),!n==null)throw new Error("A reference dataset is required");const l={id:o,name:e,experiment_ids:t,reference_dataset_id:n,description:i,created_at:(u=s??new Date)==null?void 0:u.toISOString(),extra:{}};return a&&(l.extra.metadata=a),await(await this.caller.call(he(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){Ee(e);const t=new URLSearchParams({run_id:e});for await(const n of this._getPaginated("/feedback/tokens",t))yield*n}_selectEvalResults(e){let t;return"results"in e?t=e.results:Array.isArray(e)?t=e:t=[e],t}async _logEvaluationFeedback(e,t,n){const s=this._selectEvalResults(e),i=[];for(const a of s){let o=n||{};a.evaluatorInfo&&(o={...a.evaluatorInfo,...o});let l=null;a.targetRunId?l=a.targetRunId:t&&(l=t.id),i.push(await this.createFeedback(l,a.key,{score:a.score,value:a.value,comment:a.comment,correction:a.correction,sourceInfo:o,sourceRunId:a.sourceRunId,feedbackConfig:a.feedbackConfig,feedbackSourceType:"model"}))}return[s,i]}async logEvaluationFeedback(e,t,n){const[s]=await this._logEvaluationFeedback(e,t,n);return s}async*listAnnotationQueues(e={}){const{queueIds:t,name:n,nameContains:s,limit:i}=e,a=new URLSearchParams;t&&t.forEach((l,c)=>{Ee(l,`queueIds[${c}]`),a.append("ids",l)}),n&&a.append("name",n),s&&a.append("name_contains",s),a.append("limit",(i!==void 0?Math.min(i,100):100).toString());let o=0;for await(const l of this._getPaginated("/annotation-queues",a))if(yield*l,o++,i!==void 0&&o>=i)break}async createAnnotationQueue(e){const{name:t,description:n,queueId:s}=e,i={name:t,description:n,id:s||sn()},a=await this.caller.call(he(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(i).filter(([l,c])=>c!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(a,"create annotation queue"),await a.json()}async readAnnotationQueue(e){const t=await this.listAnnotationQueues({queueIds:[e]}).next();if(t.done)throw new Error(`Annotation queue with ID ${e} not found`);return t.value}async updateAnnotationQueue(e,t){const{name:n,description:s}=t,i=await this.caller.call(he(),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:n,description:s}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(i,"update annotation queue")}async deleteAnnotationQueue(e){const t=await this.caller.call(he(),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){const n=await this.caller.call(he(),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((s,i)=>Ee(s,`runIds[${i}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(n,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){const n=`/annotation-queues/${Ee(e,"queueId")}/run`,s=await this.caller.call(he(),`${this.apiUrl}${n}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(s,"get run from annotation queue"),await s.json()}async deleteRunFromAnnotationQueue(e,t){const n=await this.caller.call(he(),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}/runs/${Ee(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(n,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){const t=await this.caller.call(he(),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(t,"get size from annotation queue"),await t.json()}async _currentTenantIsOwner(e){const t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){const n=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${n.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){const t=await this.caller.call(he(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await t.json();if(!t.ok){const s=typeof n.detail=="string"?n.detail:JSON.stringify(n.detail),i=new Error(`Error ${t.status}: ${t.statusText}
${s}`);throw i.statusCode=t.status,i}if(n.commits.length!==0)return n.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){const[n,s,i]=ds(e),a=await this.caller.call(he(),`${this.apiUrl}/likes/${n}/${s}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(a,`${t?"like":"unlike"} prompt`),await a.json()}async _getPromptUrl(e){const[t,n,s]=ds(e);if(await this._currentTenantIsOwner(t)){const i=await this._getSettings();return s!=="latest"?`${this.getHostUrl()}/prompts/${n}/${s.substring(0,8)}?organizationId=${i.id}`:`${this.getHostUrl()}/prompts/${n}?organizationId=${i.id}`}else return s!=="latest"?`${this.getHostUrl()}/hub/${t}/${n}/${s.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${n}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,n=>n.commits))yield*t}async*listPrompts(e){const t=new URLSearchParams;t.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&t.append("is_public",e.isPublic.toString()),e!=null&&e.query&&t.append("query",e.query);for await(const n of this._getPaginated("/repos",t,s=>s.repos))yield*n}async getPrompt(e){const[t,n,s]=ds(e),i=await this.caller.call(he(),`${this.apiUrl}/repos/${t}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(i.status===404)return null;await Ie(i,"get prompt");const a=await i.json();return a.repo?a.repo:null}async createPrompt(e,t){const n=await this._getSettings();if(t!=null&&t.isPublic&&!n.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[s,i,a]=ds(e);if(!await this._currentTenantIsOwner(s))throw await this._ownerConflictError("create a prompt",s);const o={repo_handle:i,...(t==null?void 0:t.description)&&{description:t.description},...(t==null?void 0:t.readme)&&{readme:t.readme},...(t==null?void 0:t.tags)&&{tags:t.tags},is_public:!!(t!=null&&t.isPublic)},l=await this.caller.call(he(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(l,"create prompt");const{repo:c}=await l.json();return c}async createCommit(e,t,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[s,i,a]=ds(e),o=(n==null?void 0:n.parentCommitHash)==="latest"||!(n!=null&&n.parentCommitHash)?await this._getLatestCommitHash(`${s}/${i}`):n==null?void 0:n.parentCommitHash,l={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},c=await this.caller.call(he(),`${this.apiUrl}/commits/${s}/${i}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(c,"create commit");const u=await c.json();return this._getPromptUrl(`${s}/${i}${u.commit_hash?`:${u.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){var o;if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const n=new FormData;for(const l of t){const c=l.id,u={...l.metadata&&{metadata:l.metadata},...l.split&&{split:l.split}},d=kn(u),h=new Blob([d],{type:"application/json"});if(n.append(c,h),l.inputs){const f=kn(l.inputs),p=new Blob([f],{type:"application/json"});n.append(`${c}.inputs`,p)}if(l.outputs){const f=kn(l.outputs),p=new Blob([f],{type:"application/json"});n.append(`${c}.outputs`,p)}if(l.attachments)for(const[f,p]of Object.entries(l.attachments)){let m,g;Array.isArray(p)?[m,g]=p:(m=p.mimeType,g=p.data);const b=new Blob([g],{type:`${m}; length=${g.byteLength}`});n.append(`${c}.attachment.${f}`,b)}if(l.attachments_operations){const f=kn(l.attachments_operations),p=new Blob([f],{type:"application/json"});n.append(`${c}.attachments_operations`,p)}}const s=e??((o=t[0])==null?void 0:o.dataset_id);return await(await this.caller.call(he(),`${this.apiUrl}/v1/platform/datasets/${s}/examples`,{method:"PATCH",headers:this.headers,body:n})).json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const n=new FormData;for(const a of t){const o=(a.id??sn()).toString(),l={created_at:a.created_at,...a.metadata&&{metadata:a.metadata},...a.split&&{split:a.split},...a.source_run_id&&{source_run_id:a.source_run_id},...a.use_source_run_io&&{use_source_run_io:a.use_source_run_io},...a.use_source_run_attachments&&{use_source_run_attachments:a.use_source_run_attachments}},c=kn(l),u=new Blob([c],{type:"application/json"});if(n.append(o,u),a.inputs){const d=kn(a.inputs),h=new Blob([d],{type:"application/json"});n.append(`${o}.inputs`,h)}if(a.outputs){const d=kn(a.outputs),h=new Blob([d],{type:"application/json"});n.append(`${o}.outputs`,h)}if(a.attachments)for(const[d,h]of Object.entries(a.attachments)){let f,p;Array.isArray(h)?[f,p]=h:(f=h.mimeType,p=h.data);const m=new Blob([p],{type:`${f}; length=${p.byteLength}`});n.append(`${o}.attachment.${d}`,m)}}const s=await this.caller.call(he(),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"POST",headers:this.headers,body:n});return await Ie(s,"upload examples"),await s.json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[n,s]=ds(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("update a prompt",n);const i={};if((t==null?void 0:t.description)!==void 0&&(i.description=t.description),(t==null?void 0:t.readme)!==void 0&&(i.readme=t.readme),(t==null?void 0:t.tags)!==void 0&&(i.tags=t.tags),(t==null?void 0:t.isPublic)!==void 0&&(i.is_public=t.isPublic),(t==null?void 0:t.isArchived)!==void 0&&(i.is_archived=t.isArchived),Object.keys(i).length===0)throw new Error("No valid update options provided");const a=await this.caller.call(he(),`${this.apiUrl}/repos/${n}/${s}`,{method:"PATCH",body:JSON.stringify(i),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ie(a,"update prompt"),a.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[t,n,s]=ds(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return await(await this.caller.call(he(),`${this.apiUrl}/repos/${t}/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,t){const[n,s,i]=ds(e),a=await this.caller.call(he(),`${this.apiUrl}/commits/${n}/${s}/${i}${t!=null&&t.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ie(a,"pull prompt commit");const o=await a.json();return{owner:n,repo:s,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,t){const n=await this.pullPromptCommit(e,{includeModel:t==null?void 0:t.includeModel});return JSON.stringify(n.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(s=>s!=="object")&&await this.updatePrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}):await this.createPrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}),t!=null&&t.object?await this.createCommit(e,t==null?void 0:t.object,{parentCommitHash:t==null?void 0:t.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){const{sourceApiUrl:n=this.apiUrl,datasetName:s}=t,[i,a]=this.parseTokenOrUrl(e,n),o=new Bl({apiUrl:i,apiKey:"placeholder"}),l=await o.readSharedDataset(a),c=s||l.name;try{if(await this.hasDataset({datasetId:c})){console.log(`Dataset ${c} already exists in your tenant. Skipping.`);return}}catch{}const u=await o.listSharedExamples(a),d=await this.createDataset(c,{description:l.description,dataType:l.data_type||"kv",inputsSchema:l.inputs_schema_definition??void 0,outputsSchema:l.outputs_schema_definition??void 0});try{await this.createExamples({inputs:u.map(h=>h.inputs),outputs:u.flatMap(h=>h.outputs?[h.outputs]:[]),datasetId:d.id})}catch(h){throw console.error(`An error occurred while creating dataset ${c}. You should delete it manually.`),h}}parseTokenOrUrl(e,t,n=2,s="dataset"){try{return Ee(e),[t,e]}catch{}try{const a=new URL(e).pathname.split("/").filter(o=>o!=="");if(a.length>=n){const o=a[a.length-n];return[t,o]}else throw new Error(`Invalid public ${s} URL: ${e}`)}catch{throw new Error(`Invalid public ${s} URL or token: ${e}`)}}awaitPendingTraceBatches(){return this.manualFlushMode?(console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve()):Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()])}}function ux(r){return"dataset_id"in r||"dataset_name"in r}const iA="0.3.18";var il={};let Nr;const VF=()=>typeof window<"u"&&typeof window.document<"u",GF=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",ZF=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),aA=()=>typeof Deno<"u",JF=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!aA(),KF=()=>Nr||(VF()?Nr="browser":JF()?Nr="node":GF()?Nr="webworker":ZF()?Nr="jsdom":aA()?Nr="deno":Nr="other",Nr);let lm;function oA(){if(lm===void 0){const r=KF(),e=QF();lm={library:"langsmith",runtime:r,sdk:"langsmith-js",sdk_version:iA,...e}}return lm}function XF(){const r=YF()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[n,s]of Object.entries(r))(n.startsWith("LANGCHAIN_")||n.startsWith("LANGSMITH_"))&&typeof s=="string"&&!t.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[n]=s);return e}function YF(){try{return typeof process<"u"&&il?Object.entries(il).reduce((r,[e,t])=>(r[e]=String(t),r),{}):void 0}catch{return}}function fi(r){try{return typeof process<"u"?il==null?void 0:il[r]:void 0}catch{return}}function _s(r){return fi(`LANGSMITH_${r}`)||fi(`LANGCHAIN_${r}`)}let cm;function QF(){if(cm!==void 0)return cm;const r=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of r){const n=fi(t);n!==void 0&&(e[t]=n)}return cm=e,e}const ez=r=>!!["TRACING_V2","TRACING"].find(t=>_s(t)==="true"),um=Symbol.for("lc:context_variables");function tz(r){return r.replace(/[-:.]/g,"")}function nz(r,e,t=1){const n=t.toFixed(0).slice(0,3).padStart(3,"0");return tz(`${new Date(r).toISOString().slice(0,-1)}${n}Z`)+e}class Hd{constructor(e,t,n){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=n}static fromHeader(e){const t=e.split(",");let n={},s=[],i;for(const a of t){const[o,l]=a.split("="),c=decodeURIComponent(l);o==="langsmith-metadata"?n=JSON.parse(c):o==="langsmith-tags"?s=c.split(","):o==="langsmith-project"&&(i=c)}return new Hd(n,s,i)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class On{constructor(e){var o;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),lA(e)){Object.assign(this,{...e});return}const t=On.getDefaultConfig(),{metadata:n,...s}=e,i=s.client??On.getSharedClient(),a={...n,...(o=s==null?void 0:s.extra)==null?void 0:o.metadata};if(s.extra={...s.extra,metadata:a},Object.assign(this,{...t,...s,client:i}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){const l=nz(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+l:this.dotted_order=l}}static getDefaultConfig(){return{id:sn(),run_type:"chain",project_name:_s("PROJECT")??fi("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:fi("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:fi("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return On.sharedClient||(On.sharedClient=new Bl),On.sharedClient}createChild(e){var l,c,u,d,h,f;const t=this.child_execution_order+1,n=new On({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});um in this&&(n[um]=this[um]);const s=Symbol.for("lc:child_config"),i=((l=e.extra)==null?void 0:l[s])??this.extra[s];if(sz(i)){const p={...i},m=rz(p.callbacks)?(u=(c=p.callbacks).copy)==null?void 0:u.call(c):void 0;m&&(Object.assign(m,{_parentRunId:n.id}),(f=(h=(d=m.handlers)==null?void 0:d.find(cA))==null?void 0:h.updateFromRunTree)==null||f.call(h,n),p.callbacks=m),n.extra[s]=p}const a=new Set;let o=this;for(;o!=null&&!a.has(o.id);)a.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(n),n}async end(e,t,n=Date.now(),s){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??n,s&&Object.keys(s).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...s}}:{metadata:s})}_convertToCreate(e,t,n=!0){var l;const s=e.extra??{};if(s.runtime||(s.runtime={}),t)for(const[c,u]of Object.entries(t))s.runtime[c]||(s.runtime[c]=u);let i,a;return n?(a=(l=e.parent_run)==null?void 0:l.id,i=[]):(i=e.child_runs.map(c=>this._convertToCreate(c,t,n)),a=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:s,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:i,parent_run_id:a,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments}}async postRun(e=!0){try{const t=oA(),n=await this._convertToCreate(this,t,!0);if(await this.client.createRun(n),!e){eA("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const s of this.child_runs)await s.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(){var e;try{const t={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:(e=this.parent_run)==null?void 0:e.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};await this.client.updateRun(this.id,t)}catch(t){console.error(`Error in patchRun for run ${this.id}`,t)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){var c,u,d,h;const n=e==null?void 0:e.callbacks;let s,i,a,o=ez();if(n){const f=((c=n==null?void 0:n.getParentRunId)==null?void 0:c.call(n))??"",p=(u=n==null?void 0:n.handlers)==null?void 0:u.find(m=>(m==null?void 0:m.name)=="langchain_tracer");s=(d=p==null?void 0:p.getRun)==null?void 0:d.call(p,f),i=p==null?void 0:p.projectName,a=p==null?void 0:p.client,o=o||!!p}return s?new On({name:s.name,id:s.id,trace_id:s.trace_id,dotted_order:s.dotted_order,client:a,tracingEnabled:o,project_name:i,tags:[...new Set(((s==null?void 0:s.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(h=s==null?void 0:s.extra)==null?void 0:h.metadata,...e==null?void 0:e.metadata}}}).createChild(t):new On({...t,client:a,tracingEnabled:o,project_name:i})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){var c;const n="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,s=n["langsmith-trace"];if(!s||typeof s!="string")return;const i=s.trim(),a=i.split(".").map(u=>{const[d,h]=u.split("Z");return{strTime:d,time:Date.parse(d+"Z"),uuid:h}}),o=a[0].uuid,l={...t,name:(t==null?void 0:t.name)??"parent",run_type:(t==null?void 0:t.run_type)??"chain",start_time:(t==null?void 0:t.start_time)??Date.now(),id:(c=a.at(-1))==null?void 0:c.uuid,trace_id:o,dotted_order:i};if(n.baggage&&typeof n.baggage=="string"){const u=Hd.fromHeader(n.baggage);l.metadata=u.metadata,l.tags=u.tags,l.project_name=u.project_name}return new On(l)}toHeaders(e){var n;const t={"langsmith-trace":this.dotted_order,baggage:new Hd((n=this.extra)==null?void 0:n.metadata,this.tags,this.project_name).toHeader()};if(e)for(const[s,i]of Object.entries(t))e.set(s,i);return t}}Object.defineProperty(On,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function lA(r){return r!==void 0&&typeof r.createChild=="function"&&typeof r.postRun=="function"}function cA(r){return typeof r=="object"&&r!=null&&typeof r.name=="string"&&r.name==="langchain_tracer"}function dx(r){return Array.isArray(r)&&r.some(e=>cA(e))}function rz(r){return typeof r=="object"&&r!=null&&Array.isArray(r.handlers)}function sz(r){var e;return r!==void 0&&typeof r.callbacks=="object"&&(dx((e=r.callbacks)==null?void 0:e.handlers)||dx(r.callbacks))}let iz=class{getStore(){}run(e,t){return t()}};const dm=Symbol.for("ls:tracing_async_local_storage"),az=new iz;let oz=class{getInstance(){return globalThis[dm]??az}initializeGlobalInstance(e){globalThis[dm]===void 0&&(globalThis[dm]=e)}};const lz=new oz,cz=()=>{const r=lz.getInstance().getStore();if(!lA(r))throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function and that tracing is enabled."].join(`
`));return r};function N_(r){return typeof r=="function"&&"langsmith:traceable"in r}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const uz=Object.prototype.hasOwnProperty;function Vg(r,e){return uz.call(r,e)}function Gg(r){if(Array.isArray(r)){const t=new Array(r.length);for(let n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(r);let e=[];for(let t in r)Vg(r,t)&&e.push(t);return e}function kr(r){switch(typeof r){case"object":return JSON.parse(JSON.stringify(r));case"undefined":return null;default:return r}}function Zg(r){let e=0;const t=r.length;let n;for(;e<t;){if(n=r.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function Ui(r){return r.indexOf("/")===-1&&r.indexOf("~")===-1?r:r.replace(/~/g,"~0").replace(/\//g,"~1")}function dz(r){return r.replace(/~1/g,"/").replace(/~0/g,"~")}function Jg(r){if(r===void 0)return!0;if(r){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(Jg(r[t]))return!0}else if(typeof r=="object"){const t=Gg(r),n=t.length;for(var e=0;e<n;e++)if(Jg(r[t[e]]))return!0}}return!1}function hx(r,e){const t=[r];for(const n in e){const s=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof s<"u"&&t.push(`${n}: ${s}`)}return t.join(`
`)}class hz extends Error{constructor(e,t,n,s,i){super(hx(e,{name:t,index:n,operation:s,tree:i})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.setPrototypeOf(this,new.target.prototype),this.message=hx(e,{name:t,index:n,operation:s,tree:i})}}const xt=hz,ra={add:function(r,e,t){return r[e]=this.value,{newDocument:t}},remove:function(r,e,t){var n=r[e];return delete r[e],{newDocument:t,removed:n}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:function(r,e,t){let n=Kg(t,this.path);n&&(n=kr(n));const s=al(t,{op:"remove",path:this.from}).removed;return al(t,{op:"add",path:this.path,value:s}),{newDocument:t,removed:n}},copy:function(r,e,t){const n=Kg(t,this.from);return al(t,{op:"add",path:this.path,value:kr(n)}),{newDocument:t}},test:function(r,e,t){return{newDocument:t,test:Vd(r[e],this.value)}},_get:function(r,e,t){return this.value=r[e],{newDocument:t}}};var fz={add:function(r,e,t){return Zg(e)?r.splice(e,0,this.value):r[e]=this.value,{newDocument:t,index:e}},remove:function(r,e,t){var n=r.splice(e,1);return{newDocument:t,removed:n[0]}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:ra.move,copy:ra.copy,test:ra.test,_get:ra._get};function Kg(r,e){if(e=="")return r;var t={op:"_get",path:e};return al(r,t),t.value}function al(r,e,t=!1,n=!0,s=!0,i=0){if(t&&(typeof t=="function"?t(e,0,r,e.path):Xg(e,0)),e.path===""){let a={newDocument:r};if(e.op==="add")return a.newDocument=e.value,a;if(e.op==="replace")return a.newDocument=e.value,a.removed=r,a;if(e.op==="move"||e.op==="copy")return a.newDocument=Kg(r,e.from),e.op==="move"&&(a.removed=r),a;if(e.op==="test"){if(a.test=Vd(r,e.value),a.test===!1)throw new xt("Test operation failed","TEST_OPERATION_FAILED",i,e,r);return a.newDocument=r,a}else{if(e.op==="remove")return a.removed=r,a.newDocument=null,a;if(e.op==="_get")return e.value=r,a;if(t)throw new xt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,e,r);return a}}else{n||(r=kr(r));const o=(e.path||"").split("/");let l=r,c=1,u=o.length,d,h,f;for(typeof t=="function"?f=t:f=Xg;;){if(h=o[c],h&&h.indexOf("~")!=-1&&(h=dz(h)),s&&(h=="__proto__"||h=="prototype"&&c>0&&o[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&d===void 0&&(l[h]===void 0?d=o.slice(0,c).join("/"):c==u-1&&(d=e.path),d!==void 0&&f(e,0,r,d)),c++,Array.isArray(l)){if(h==="-")h=l.length;else{if(t&&!Zg(h))throw new xt("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,e,r);Zg(h)&&(h=~~h)}if(c>=u){if(t&&e.op==="add"&&h>l.length)throw new xt("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,e,r);const p=fz[e.op].call(e,l,h,r);if(p.test===!1)throw new xt("Test operation failed","TEST_OPERATION_FAILED",i,e,r);return p}}else if(c>=u){const p=ra[e.op].call(e,l,h,r);if(p.test===!1)throw new xt("Test operation failed","TEST_OPERATION_FAILED",i,e,r);return p}if(l=l[h],t&&c<u&&(!l||typeof l!="object"))throw new xt("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,e,r)}}}function Wd(r,e,t,n=!0,s=!0){if(t&&!Array.isArray(e))throw new xt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(r=kr(r));const i=new Array(e.length);for(let a=0,o=e.length;a<o;a++)i[a]=al(r,e[a],t,!0,s,a),r=i[a].newDocument;return i.newDocument=r,i}function Xg(r,e,t,n){if(typeof r!="object"||r===null||Array.isArray(r))throw new xt("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,r,t);if(ra[r.op]){if(typeof r.path!="string")throw new xt("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,r,t);if(r.path.indexOf("/")!==0&&r.path.length>0)throw new xt('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,r,t);if((r.op==="move"||r.op==="copy")&&typeof r.from!="string")throw new xt("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&r.value===void 0)throw new xt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&Jg(r.value))throw new xt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,r,t);if(t){if(r.op=="add"){var s=r.path.split("/").length,i=n.split("/").length;if(s!==i+1&&s!==i)throw new xt("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,r,t)}else if(r.op==="replace"||r.op==="remove"||r.op==="_get"){if(r.path!==n)throw new xt("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,r,t)}else if(r.op==="move"||r.op==="copy"){var a={op:"_get",path:r.from,value:void 0},o=pz([a],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new xt("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,r,t)}}}else throw new xt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,r,t)}function pz(r,e,t){try{if(!Array.isArray(r))throw new xt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Wd(kr(e),kr(r),t||!0);else{t=t||Xg;for(var n=0;n<r.length;n++)t(r[n],n,e,void 0)}}catch(s){if(s instanceof xt)return s;throw s}}function Vd(r,e){if(r===e)return!0;if(r&&e&&typeof r=="object"&&typeof e=="object"){var t=Array.isArray(r),n=Array.isArray(e),s,i,a;if(t&&n){if(i=r.length,i!=e.length)return!1;for(s=i;s--!==0;)if(!Vd(r[s],e[s]))return!1;return!0}if(t!=n)return!1;var o=Object.keys(r);if(i=o.length,i!==Object.keys(e).length)return!1;for(s=i;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=i;s--!==0;)if(a=o[s],!Vd(r[a],e[a]))return!1;return!0}return r!==r&&e!==e}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2013-2021 Joachim Wester
 * MIT license
 */function uA(r,e,t,n,s){if(e!==r){typeof e.toJSON=="function"&&(e=e.toJSON());for(var i=Gg(e),a=Gg(r),o=!1,l=a.length-1;l>=0;l--){var c=a[l],u=r[c];if(Vg(e,c)&&!(e[c]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var d=e[c];typeof u=="object"&&u!=null&&typeof d=="object"&&d!=null&&Array.isArray(u)===Array.isArray(d)?uA(u,d,t,n+"/"+Ui(c),s):u!==d&&(s&&t.push({op:"test",path:n+"/"+Ui(c),value:kr(u)}),t.push({op:"replace",path:n+"/"+Ui(c),value:kr(d)}))}else Array.isArray(r)===Array.isArray(e)?(s&&t.push({op:"test",path:n+"/"+Ui(c),value:kr(u)}),t.push({op:"remove",path:n+"/"+Ui(c)}),o=!0):(s&&t.push({op:"test",path:n,value:r}),t.push({op:"replace",path:n,value:e}))}if(!(!o&&i.length==a.length))for(var l=0;l<i.length;l++){var c=i[l];!Vg(r,c)&&e[c]!==void 0&&t.push({op:"add",path:n+"/"+Ui(c),value:kr(e[c])})}}}function mz(r,e,t=!1){var n=[];return uA(r,e,n,"",t),n}var hm={};const gz=()=>typeof window<"u"&&typeof window.document<"u",bz=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",_z=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),L_=()=>typeof Deno<"u",yz=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!L_(),wz=()=>{let r;return gz()?r="browser":yz()?r="node":bz()?r="webworker":_z()?r="jsdom":L_()?r="deno":r="other",r};let fm;async function vz(){return fm===void 0&&(fm={library:"langchain-js",runtime:wz()}),fm}function _n(r){try{return typeof process<"u"?hm==null?void 0:hm[r]:L_()?Deno==null?void 0:Deno.env.get(r):void 0}catch{return}}class xz{}function kz(r){return"lc_prefer_streaming"in r&&r.lc_prefer_streaming}class Cc extends xz{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,BP(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:_n("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return bi.prototype.toJSON.call(this)}toJSONNotImplemented(){return bi.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends Cc{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:sn()}),Object.assign(this,e)}}return new t}}const Sz=r=>{const e=r;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"};function pm(r,e){return r&&!Array.isArray(r)&&typeof r=="object"?r:{[e]:r}}function Pz(r){return r.replace(/[-:.]/g,"")}function Az(r,e,t){const n=t.toFixed(0).slice(0,3).padStart(3,"0");return Pz(`${new Date(r).toISOString().slice(0,-1)}${n}Z`)+e}function go(r){return typeof r._addRunToRunMap=="function"}class $c extends Cc{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){const t=Az(e.start_time,e.id,e.execution_order),n={...e};if(n.parent_run_id!==void 0){const s=this.runMap.get(n.parent_run_id);s&&(this._addChildRun(s,n),s.child_execution_order=Math.max(s.child_execution_order,n.child_execution_order),n.trace_id=s.trace_id,s.dotted_order!==void 0&&(n.dotted_order=[s.dotted_order,t].join(".")))}else n.trace_id=n.id,n.dotted_order=t;return this.runMap.set(n.id,n),n}async _endTrace(e){var n;const t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await((n=this.onRunUpdate)==null?void 0:n.call(this,e))}_getExecutionOrder(e){const t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,n,s,i,a,o,l){const c=this._getExecutionOrder(s),u=Date.now(),d=o?{...i,metadata:o}:i,h={id:n,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:d??{},tags:a||[]};return this._addRunToRunMap(h)}async handleLLMStart(e,t,n,s,i,a,o,l){var u,d;const c=this.runMap.get(n)??this._createRunForLLMStart(e,t,n,s,i,a,o,l);return await((u=this.onRunCreate)==null?void 0:u.call(this,c)),await((d=this.onLLMStart)==null?void 0:d.call(this,c)),c}_createRunForChatModelStart(e,t,n,s,i,a,o,l){const c=this._getExecutionOrder(s),u=Date.now(),d=o?{...i,metadata:o}:i,h={id:n,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:d??{},tags:a||[]};return this._addRunToRunMap(h)}async handleChatModelStart(e,t,n,s,i,a,o,l){var u,d;const c=this.runMap.get(n)??this._createRunForChatModelStart(e,t,n,s,i,a,o,l);return await((u=this.onRunCreate)==null?void 0:u.call(this,c)),await((d=this.onLLMStart)==null?void 0:d.call(this,c)),c}async handleLLMEnd(e,t,n,s,i){var o;const a=this.runMap.get(t);if(!a||(a==null?void 0:a.run_type)!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.outputs=e,a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...i},await((o=this.onLLMEnd)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleLLMError(e,t,n,s,i){var o;const a=this.runMap.get(t);if(!a||(a==null?void 0:a.run_type)!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...i},await((o=this.onLLMError)==null?void 0:o.call(this,a)),await this._endTrace(a),a}_createRunForChainStart(e,t,n,s,i,a,o,l){const c=this._getExecutionOrder(s),u=Date.now(),d={id:n,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:t,execution_order:c,child_execution_order:c,run_type:o??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(d)}async handleChainStart(e,t,n,s,i,a,o,l){var u,d;const c=this.runMap.get(n)??this._createRunForChainStart(e,t,n,s,i,a,o,l);return await((u=this.onRunCreate)==null?void 0:u.call(this,c)),await((d=this.onChainStart)==null?void 0:d.call(this,c)),c}async handleChainEnd(e,t,n,s,i){var o;const a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=pm(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(a.inputs=pm(i.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleChainError(e,t,n,s,i){var o;const a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(a.inputs=pm(i.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,a)),await this._endTrace(a),a}_createRunForToolStart(e,t,n,s,i,a,o){const l=this._getExecutionOrder(s),c=Date.now(),u={id:n,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:t},execution_order:l,child_execution_order:l,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(u)}async handleToolStart(e,t,n,s,i,a,o){var c,u;const l=this.runMap.get(n)??this._createRunForToolStart(e,t,n,s,i,a,o);return await((c=this.onRunCreate)==null?void 0:c.call(this,l)),await((u=this.onToolStart)==null?void 0:u.call(this,l)),l}async handleToolEnd(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((s=this.onToolEnd)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleToolError(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((s=this.onToolError)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleAgentAction(e,t){var i;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="chain")return;const s=n;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((i=this.onAgentAction)==null?void 0:i.call(this,n))}async handleAgentEnd(e,t){var s;const n=this.runMap.get(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentEnd)==null?void 0:s.call(this,n)))}_createRunForRetrieverStart(e,t,n,s,i,a,o){const l=this._getExecutionOrder(s),c=Date.now(),u={id:n,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:t},execution_order:l,child_execution_order:l,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(u)}async handleRetrieverStart(e,t,n,s,i,a,o){var c,u;const l=this.runMap.get(n)??this._createRunForRetrieverStart(e,t,n,s,i,a,o);return await((c=this.onRunCreate)==null?void 0:c.call(this,l)),await((u=this.onRetrieverStart)==null?void 0:u.call(this,l)),l}async handleRetrieverEnd(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((s=this.onRetrieverEnd)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleRetrieverError(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((s=this.onRetrieverError)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleText(e,t){var s;const n=this.runMap.get(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((s=this.onText)==null?void 0:s.call(this,n)))}async handleLLMNewToken(e,t,n,s,i,a){var l;const o=this.runMap.get(n);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:a==null?void 0:a.chunk}}),await((l=this.onLLMNewToken)==null?void 0:l.call(this,o,e,{chunk:a==null?void 0:a.chunk})),o}}var gd={exports:{}};gd.exports;var fx;function Ez(){return fx||(fx=1,function(r){const t=(i=0)=>a=>`\x1B[${38+i};5;${a}m`,n=(i=0)=>(a,o,l)=>`\x1B[${38+i};2;${a};${o};${l}m`;function s(){const i=new Map,a={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};a.color.gray=a.color.blackBright,a.bgColor.bgGray=a.bgColor.bgBlackBright,a.color.grey=a.color.blackBright,a.bgColor.bgGrey=a.bgColor.bgBlackBright;for(const[o,l]of Object.entries(a)){for(const[c,u]of Object.entries(l))a[c]={open:`\x1B[${u[0]}m`,close:`\x1B[${u[1]}m`},l[c]=a[c],i.set(u[0],u[1]);Object.defineProperty(a,o,{value:l,enumerable:!1})}return Object.defineProperty(a,"codes",{value:i,enumerable:!1}),a.color.close="\x1B[39m",a.bgColor.close="\x1B[49m",a.color.ansi256=t(),a.color.ansi16m=n(),a.bgColor.ansi256=t(10),a.bgColor.ansi16m=n(10),Object.defineProperties(a,{rgbToAnsi256:{value:(o,l,c)=>o===l&&l===c?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(l/255*5)+Math.round(c/255*5),enumerable:!1},hexToRgb:{value:o=>{const l=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!l)return[0,0,0];let{colorString:c}=l.groups;c.length===3&&(c=c.split("").map(d=>d+d).join(""));const u=Number.parseInt(c,16);return[u>>16&255,u>>8&255,u&255]},enumerable:!1},hexToAnsi256:{value:o=>a.rgbToAnsi256(...a.hexToRgb(o)),enumerable:!1}}),a}Object.defineProperty(r,"exports",{enumerable:!0,get:s})}(gd)),gd.exports}var Oz=Ez();const dA=Pi(Oz);function en(r,e){return`${r.open}${e}${r.close}`}function jn(r,e){try{return JSON.stringify(r,null,2)}catch{return e}}function px(r){return typeof r=="string"?r.trim():r==null?r:jn(r,r.toString())}function hs(r){if(!r.end_time)return"";const e=r.end_time-r.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:fn}=dA;class mx extends $c{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let n=e;for(;n.parent_run_id;){const s=this.runMap.get(n.parent_run_id);if(s)t.push(s),n=s;else break}return t}getBreadcrumbs(e){const n=[...this.getParents(e).reverse(),e].map((s,i,a)=>{const o=`${s.execution_order}:${s.run_type}:${s.name}`;return i===a.length-1?en(dA.bold,o):o}).join(" > ");return en(fn.grey,n)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${en(fn.green,"[chain/start]")} [${t}] Entering Chain run with input: ${jn(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${en(fn.cyan,"[chain/end]")} [${t}] [${hs(e)}] Exiting Chain run with output: ${jn(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${en(fn.red,"[chain/error]")} [${t}] [${hs(e)}] Chain run errored with error: ${jn(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${en(fn.green,"[llm/start]")} [${t}] Entering LLM run with input: ${jn(n,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${en(fn.cyan,"[llm/end]")} [${t}] [${hs(e)}] Exiting LLM run with output: ${jn(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${en(fn.red,"[llm/error]")} [${t}] [${hs(e)}] LLM run errored with error: ${jn(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${en(fn.green,"[tool/start]")} [${t}] Entering Tool run with input: "${px(e.inputs.input)}"`)}onToolEnd(e){var n;const t=this.getBreadcrumbs(e);console.log(`${en(fn.cyan,"[tool/end]")} [${t}] [${hs(e)}] Exiting Tool run with output: "${px((n=e.outputs)==null?void 0:n.output)}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${en(fn.red,"[tool/error]")} [${t}] [${hs(e)}] Tool run errored with error: ${jn(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${en(fn.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${jn(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${en(fn.cyan,"[retriever/end]")} [${t}] [${hs(e)}] Exiting Retriever run with output: ${jn(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${en(fn.red,"[retriever/error]")} [${t}] [${hs(e)}] Retriever run errored with error: ${jn(e.error,"[error]")}`)}onAgentAction(e){const t=e,n=this.getBreadcrumbs(e);console.log(`${en(fn.blue,"[agent/action]")} [${n}] Agent selected action: ${jn(t.actions[t.actions.length-1],"[action]")}`)}}let mm;const Tz=()=>{if(mm===void 0){const r=_n("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};mm=new Bl(r)}return mm};class ol extends $c{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:n,client:s}=e;this.projectName=n??_n("LANGCHAIN_PROJECT")??_n("LANGCHAIN_SESSION"),this.exampleId=t,this.client=s??Tz();const i=ol.getTraceableRunTree();i&&this.updateFromRunTree(i)}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await vz()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id,extra:e.extra,session_name:this.projectName};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let t=e;const n=new Set;for(;t.parent_run&&!(n.has(t.id)||(n.add(t.id),!t.parent_run));)t=t.parent_run;n.clear();const s=[t];for(;s.length>0;){const i=s.shift();!i||n.has(i.id)||(n.add(i.id),this.runMap.set(i.id,i),i.child_runs&&s.push(...i.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){const t={},n=[];for(const[s,i]of this.runMap){const a=new On({...i,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});t[s]=a,n.push([s,i.dotted_order])}n.sort((s,i)=>!s[1]||!i[1]?0:s[1].localeCompare(i[1]));for(const[s]of n){const i=this.runMap.get(s),a=t[s];if(!(!i||!a)&&i.parent_run_id){const o=t[i.parent_run_id];o&&(o.child_runs.push(a),a.parent_run=o)}}return t[e]}static getTraceableRunTree(){try{return cz()}catch{return}}}const hA=Symbol.for("ls:tracing_async_local_storage"),bd=Symbol.for("lc:context_variables"),Rz=r=>{globalThis[hA]=r},Ul=()=>globalThis[hA];let ll;function Iz(){const r="default"in Qr?Qr.default:Qr;return new r({autoStart:!0,concurrency:1})}function Cz(){return typeof ll>"u"&&(ll=Iz()),ll}async function Et(r,e){if(e===!0){const t=Ul();t!==void 0?await t.run(void 0,async()=>r()):await r()}else ll=Cz(),ll.add(async()=>{const t=Ul();t!==void 0?await t.run(void 0,async()=>r()):await r()})}const $z=r=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>_n(t)==="true");function fA(r){var n;const e=Ul();if(e===void 0)return;const t=e.getStore();return(n=t==null?void 0:t[bd])==null?void 0:n[r]}const Mz=Symbol("lc:configure_hooks"),Nz=()=>fA(Mz)||[];function j_(r){return r?Array.isArray(r)||"name"in r?{callbacks:r}:r:{}}class Lz{setHandler(e){return this.setHandlers([e])}}class Xh{constructor(e,t,n,s,i,a,o,l){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:l})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>Et(async()=>{var n;try{await((n=t.handleText)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleCustomEvent(e,t,n,s,i){await Promise.all(this.handlers.map(a=>Et(async()=>{var o;try{await((o=a.handleCustomEvent)==null?void 0:o.call(a,e,t,this.runId,this.tags,this.metadata))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}}class jz extends Xh{getChild(e){const t=new an(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>Et(async()=>{var n;if(!t.ignoreRetriever)try{await((n=t.handleRetrieverEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw s}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>Et(async()=>{var n;if(!t.ignoreRetriever)try{await((n=t.handleRetrieverError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${s}`),t.raiseError)throw e}},t.awaitHandlers)))}}class gx extends Xh{async handleLLMNewToken(e,t,n,s,i,a){await Promise.all(this.handlers.map(o=>Et(async()=>{var l;if(!o.ignoreLLM)try{await((l=o.handleLLMNewToken)==null?void 0:l.call(o,e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a))}catch(c){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${c}`),o.raiseError)throw c}},o.awaitHandlers)))}async handleLLMError(e,t,n,s,i){await Promise.all(this.handlers.map(a=>Et(async()=>{var o;if(!a.ignoreLLM)try{await((o=a.handleLLMError)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMError: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}async handleLLMEnd(e,t,n,s,i){await Promise.all(this.handlers.map(a=>Et(async()=>{var o;if(!a.ignoreLLM)try{await((o=a.handleLLMEnd)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMEnd: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}}class Dz extends Xh{getChild(e){const t=new an(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,n,s,i){await Promise.all(this.handlers.map(a=>Et(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainError)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainError: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}async handleChainEnd(e,t,n,s,i){await Promise.all(this.handlers.map(a=>Et(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainEnd)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainEnd: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>Et(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleAgentAction)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>Et(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleAgentEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}}class Fz extends Xh{getChild(e){const t=new an(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>Et(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleToolError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>Et(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleToolEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}}class an extends Lz{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(t==null?void 0:t.handlers)??this.handlers,this.inheritableHandlers=(t==null?void 0:t.inheritableHandlers)??this.inheritableHandlers,this.tags=(t==null?void 0:t.tags)??this.tags,this.inheritableTags=(t==null?void 0:t.inheritableTags)??this.inheritableTags,this.metadata=(t==null?void 0:t.metadata)??this.metadata,this.inheritableMetadata=(t==null?void 0:t.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,n=void 0,s=void 0,i=void 0,a=void 0,o=void 0,l=void 0){return Promise.all(t.map(async(c,u)=>{const d=u===0&&n?n:sn();return await Promise.all(this.handlers.map(h=>{if(!h.ignoreLLM)return go(h)&&h._createRunForLLMStart(e,[c],d,this._parentRunId,i,this.tags,this.metadata,l),Et(async()=>{var f;try{await((f=h.handleLLMStart)==null?void 0:f.call(h,e,[c],d,this._parentRunId,i,this.tags,this.metadata,l))}catch(p){if((h.raiseError?console.error:console.warn)(`Error in handler ${h.constructor.name}, handleLLMStart: ${p}`),h.raiseError)throw p}},h.awaitHandlers)})),new gx(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,n=void 0,s=void 0,i=void 0,a=void 0,o=void 0,l=void 0){return Promise.all(t.map(async(c,u)=>{const d=u===0&&n?n:sn();return await Promise.all(this.handlers.map(h=>{if(!h.ignoreLLM)return go(h)&&h._createRunForChatModelStart(e,[c],d,this._parentRunId,i,this.tags,this.metadata,l),Et(async()=>{var f,p;try{if(h.handleChatModelStart)await((f=h.handleChatModelStart)==null?void 0:f.call(h,e,[c],d,this._parentRunId,i,this.tags,this.metadata,l));else if(h.handleLLMStart){const m=qP(c);await((p=h.handleLLMStart)==null?void 0:p.call(h,e,[m],d,this._parentRunId,i,this.tags,this.metadata,l))}}catch(m){if((h.raiseError?console.error:console.warn)(`Error in handler ${h.constructor.name}, handleLLMStart: ${m}`),h.raiseError)throw m}},h.awaitHandlers)})),new gx(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,n=sn(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreChain)return go(l)&&l._createRunForChainStart(e,t,n,this._parentRunId,this.tags,this.metadata,s,o),Et(async()=>{var c;try{await((c=l.handleChainStart)==null?void 0:c.call(l,e,t,n,this._parentRunId,this.tags,this.metadata,s,o))}catch(u){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleChainStart: ${u}`),l.raiseError)throw u}},l.awaitHandlers)})),new Dz(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,n=sn(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreAgent)return go(l)&&l._createRunForToolStart(e,t,n,this._parentRunId,this.tags,this.metadata,o),Et(async()=>{var c;try{await((c=l.handleToolStart)==null?void 0:c.call(l,e,t,n,this._parentRunId,this.tags,this.metadata,o))}catch(u){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleToolStart: ${u}`),l.raiseError)throw u}},l.awaitHandlers)})),new Fz(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,n=sn(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreRetriever)return go(l)&&l._createRunForRetrieverStart(e,t,n,this._parentRunId,this.tags,this.metadata,o),Et(async()=>{var c;try{await((c=l.handleRetrieverStart)==null?void 0:c.call(l,e,t,n,this._parentRunId,this.tags,this.metadata,o))}catch(u){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleRetrieverStart: ${u}`),l.raiseError)throw u}},l.awaitHandlers)})),new jz(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,n,s,i){await Promise.all(this.handlers.map(a=>Et(async()=>{var o;if(!a.ignoreCustomEvent)try{await((o=a.handleCustomEvent)==null?void 0:o.call(a,e,t,n,this.tags,this.metadata))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const n of e)this.addHandler(n,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const n=new an(this._parentRunId);for(const s of this.handlers){const i=this.inheritableHandlers.includes(s);n.addHandler(s,i)}for(const s of this.tags){const i=this.inheritableTags.includes(s);n.addTags([s],i)}for(const s of Object.keys(this.metadata)){const i=Object.keys(this.inheritableMetadata).includes(s);n.addMetadata({[s]:this.metadata[s]},i)}for(const s of e)n.handlers.filter(i=>i.name==="console_callback_handler").some(i=>i.name===s.name)||n.addHandler(s,t);return n}static fromHandlers(e){class t extends Cc{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:sn()}),Object.assign(this,e)}}const n=new this;return n.addHandler(new t),n}static configure(e,t,n,s,i,a,o){return this._configureSync(e,t,n,s,i,a,o)}static _configureSync(e,t,n,s,i,a,o){var h,f;let l;(e||t)&&(Array.isArray(e)||!e?(l=new an,l.setHandlers((e==null?void 0:e.map(Gd))??[],!0)):l=e,l=l.copy(Array.isArray(t)?t.map(Gd):t==null?void 0:t.handlers,!1));const c=_n("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),u=((h=ol.getTraceableRunTree())==null?void 0:h.tracingEnabled)||$z(),d=u||(_n("LANGCHAIN_TRACING")??!1);if(c||d){if(l||(l=new an),c&&!l.handlers.some(p=>p.name===mx.prototype.name)){const p=new mx;l.addHandler(p,!0)}if(d&&!l.handlers.some(p=>p.name==="langchain_tracer")&&u){const p=new ol;l.addHandler(p,!0),l._parentRunId=((f=ol.getTraceableRunTree())==null?void 0:f.id)??l._parentRunId}}for(const{contextVar:p,inheritable:m=!0,handlerClass:g,envVar:b}of Nz()){const _=b&&_n(b)==="true"&&g;let y;const w=p!==void 0?fA(p):void 0;w&&Sz(w)?y=w:_&&(y=new g({})),y!==void 0&&(l||(l=new an),l.handlers.some(v=>v.name===y.name)||l.addHandler(y,m))}return(n||s)&&l&&(l.addTags(n??[]),l.addTags(s??[],!1)),(i||a)&&l&&(l.addMetadata(i??{}),l.addMetadata(a??{},!1)),l}}function Gd(r){return"name"in r?r:Cc.fromMethods(r)}class zz{getStore(){}run(e,t){return t()}enterWith(e){}}const Bz=new zz,bx=Symbol.for("lc:child_config");class Uz{getInstance(){return Ul()??Bz}getRunnableConfig(){var t,n;return(n=(t=this.getInstance().getStore())==null?void 0:t.extra)==null?void 0:n[bx]}runWithConfig(e,t,n){var u;const s=an._configureSync(e==null?void 0:e.callbacks,void 0,e==null?void 0:e.tags,void 0,e==null?void 0:e.metadata),i=this.getInstance(),a=i.getStore(),o=s==null?void 0:s.getParentRunId(),l=(u=s==null?void 0:s.handlers)==null?void 0:u.find(d=>(d==null?void 0:d.name)==="langchain_tracer");let c;return l&&o?c=l.convertToRunTree(o):n||(c=new On({name:"<runnable_lambda>",tracingEnabled:!1})),c&&(c.extra={...c.extra,[bx]:e}),a!==void 0&&a[bd]!==void 0&&(c===void 0&&(c={}),c[bd]=a[bd]),i.run(c,t)}initializeGlobalInstance(e){Ul()===void 0&&Rz(e)}}const Tr=new Uz,gm=25;async function ir(r){return an._configureSync(r==null?void 0:r.callbacks,void 0,r==null?void 0:r.tags,void 0,r==null?void 0:r.metadata)}function _x(...r){const e={};for(const t of r.filter(n=>!!n))for(const n of Object.keys(t))if(n==="metadata")e[n]={...e[n],...t[n]};else if(n==="tags"){const s=e[n]??[];e[n]=[...new Set(s.concat(t[n]??[]))]}else if(n==="configurable")e[n]={...e[n],...t[n]};else if(n==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(n==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(n==="callbacks"){const s=e.callbacks,i=t.callbacks;if(Array.isArray(i))if(!s)e.callbacks=i;else if(Array.isArray(s))e.callbacks=s.concat(i);else{const a=s.copy();for(const o of i)a.addHandler(Gd(o),!0);e.callbacks=a}else if(i)if(!s)e.callbacks=i;else if(Array.isArray(s)){const a=i.copy();for(const o of s)a.addHandler(Gd(o),!0);e.callbacks=a}else e.callbacks=new an(i._parentRunId,{handlers:s.handlers.concat(i.handlers),inheritableHandlers:s.inheritableHandlers.concat(i.inheritableHandlers),tags:Array.from(new Set(s.tags.concat(i.tags))),inheritableTags:Array.from(new Set(s.inheritableTags.concat(i.inheritableTags))),metadata:{...s.metadata,...i.metadata}})}else{const s=n;e[s]=t[s]??e[s]}return e}const qz=new Set(["string","number","boolean"]);function We(r){var n;const e=Tr.getRunnableConfig();let t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:s,runName:i,...a}=e;t=Object.entries(a).reduce((o,[l,c])=>(c!==void 0&&(o[l]=c),o),t)}if(r&&(t=Object.entries(r).reduce((s,[i,a])=>(a!==void 0&&(s[i]=a),s),t)),t!=null&&t.configurable)for(const s of Object.keys(t.configurable))qz.has(typeof t.configurable[s])&&!((n=t.metadata)!=null&&n[s])&&(t.metadata||(t.metadata={}),t.metadata[s]=t.configurable[s]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");const s=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,s])):t.signal=s,delete t.timeout}return t}function Nt(r={},{callbacks:e,maxConcurrency:t,recursionLimit:n,runName:s,configurable:i,runId:a}={}){const o=We(r);return e!==void 0&&(delete o.runName,o.callbacks=e),n!==void 0&&(o.recursionLimit=n),t!==void 0&&(o.maxConcurrency=t),s!==void 0&&(o.runName=s),i!==void 0&&(o.configurable={...o.configurable,...i}),a!==void 0&&delete o.runId,o}function Ns(r){return r?{configurable:r.configurable,recursionLimit:r.recursionLimit,callbacks:r.callbacks,tags:r.tags,metadata:r.metadata,maxConcurrency:r.maxConcurrency,timeout:r.timeout,signal:r.signal}:void 0}async function Ls(r,e){if(e===void 0)return r;let t;return Promise.race([r.catch(n=>{if(!(e!=null&&e.aborted))throw n}),new Promise((n,s)=>{t=()=>{s(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&s(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))}class $n extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const t=e.getReader();return new $n({start(n){return s();function s(){return t.read().then(({done:i,value:a})=>{if(i){n.close();return}return n.enqueue(a),s()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new $n({async pull(t){const{value:n,done:s}=await e.next();s&&t.close(),t.enqueue(n)},async cancel(t){await e.return(t)}})}}function pA(r,e=2){const t=Array.from({length:e},()=>[]);return t.map(async function*(s){for(;;)if(s.length===0){const i=await r.next();for(const a of t)a.push(i)}else{if(s[0].done)return;yield s.shift().value}})}function ar(r,e){if(Array.isArray(r)&&Array.isArray(e))return r.concat(e);if(typeof r=="string"&&typeof e=="string")return r+e;if(typeof r=="number"&&typeof e=="number")return r+e;if("concat"in r&&typeof r.concat=="function")return r.concat(e);if(typeof r=="object"&&typeof e=="object"){const t={...r};for(const[n,s]of Object.entries(e))n in t&&!Array.isArray(t[n])?t[n]=ar(t[n],s):t[n]=s;return t}else throw new Error(`Cannot concat ${typeof r} and ${typeof e}`)}class Ja{constructor(e){var t;Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??((t=this.config)==null?void 0:t.signal),this.setup=new Promise((n,s)=>{Tr.runWithConfig(Ns(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(n,s):this.firstResult.then(i=>n(void 0),s)},!0)})}async next(...e){var t;return(t=this.signal)==null||t.throwIfAborted(),this.firstResultUsed?Tr.runWithConfig(Ns(this.config),this.signal?async()=>Ls(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}async function Hz(r,e,t,n,...s){const i=new Ja({generator:e,startSetup:t,signal:n}),a=await i.setup;return{output:r(i,a,...s),setup:a}}class bs{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),n=Wd({},t);return new ql({ops:t,state:n[n.length-1].newDocument})}}class ql extends bs{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),n=Wd(this.state,e.ops);return new ql({ops:t,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){const t=Wd({},e.ops);return new ql({ops:e.ops,state:t[t.length-1].newDocument})}}const Wz=r=>r.name==="log_stream_tracer";async function yx(r,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:t}=r;if(["retriever","llm","prompt"].includes(r.run_type))return t;if(!(Object.keys(t).length===1&&(t==null?void 0:t.input)===""))return t.input}async function wx(r,e){const{outputs:t}=r;return e==="original"||["retriever","llm","prompt"].includes(r.run_type)?t:t!==void 0&&Object.keys(t).length===1&&(t==null?void 0:t.output)!==void 0?t.output:t}function Vz(r){return r!==void 0&&r.message!==void 0}class vx extends $c{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=$n.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||t.find(s=>{var i;return(i=this.includeTags)==null?void 0:i.includes(s)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&t.every(s=>{var i;return!((i=this.excludeTags)!=null&&i.includes(s))})),n}async*tapOutputIterable(e,t){for await(const n of t){if(e!==this.rootId){const s=this.keyMapByRunId[e];s&&await this.writer.write(new bs({ops:[{op:"add",path:`/logs/${s}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){var s;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new bs({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;const n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=await yx(e,this._schemaFormat)),await this.writer.write(new bs({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(t===void 0)return;const n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${t}/inputs`,value:await yx(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${t}/final_output`,value:await wx(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const s=new bs({ops:n});await this.writer.write(s)}finally{if(e.id===this.rootId){const t=new bs({ops:[{op:"replace",path:"/final_output",value:await wx(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,n){const s=this.keyMapByRunId[e.id];if(s===void 0)return;const i=e.inputs.messages!==void 0;let a;i?Vz(n==null?void 0:n.chunk)?a=n==null?void 0:n.chunk:a=new mt({id:`run-${e.id}`,content:t}):a=t;const o=new bs({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${s}/streamed_output/-`,value:a}]});await this.writer.write(o)}}const xx="__run";class Na{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new Na({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class lr extends Na{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new lr({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}function Eu({name:r,serialized:e}){return r!==void 0?r:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const Gz=r=>r.name==="event_stream_tracer";class Zz extends $c{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=$n.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const t=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(n=n||t.find(s=>{var i;return(i=this.includeTags)==null?void 0:i.includes(s)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(n=n&&t.every(s=>{var i;return!((i=this.excludeTags)!=null&&i.includes(s))})),n}async*tapOutputIterable(e,t){const n=await t.next();if(n.done)return;const s=this.runInfoMap.get(e);if(s===void 0){yield n.value;return}function i(o,l){return o==="llm"&&typeof l=="string"?new Na({text:l}):l}let a=this.tappedPromises.get(e);if(a===void 0){let o;a=new Promise(l=>{o=l}),this.tappedPromises.set(e,a);try{const l={event:`on_${s.runType}_stream`,run_id:e,name:s.name,tags:s.tags,metadata:s.metadata,data:{}};await this.send({...l,data:{chunk:i(s.runType,n.value)}},s),yield n.value;for await(const c of t)s.runType!=="tool"&&s.runType!=="retriever"&&await this.send({...l,data:{chunk:i(s.runType,c)}},s),yield c}finally{o()}}else{yield n.value;for await(const o of t)yield o}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){const n=this.tappedPromises.get(e.run_id);n!==void 0?n.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){var a,o;const t=Eu(e),n=e.inputs.messages!==void 0?"chat_model":"llm",s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,s);const i=`on_${n}_start`;await this.send({event:i,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onLLMNewToken(e,t,n){const s=this.runInfoMap.get(e.id);let i,a;if(s===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(s.runType==="chat_model")a="on_chat_model_stream",(n==null?void 0:n.chunk)===void 0?i=new mt({content:t,id:`run-${e.id}`}):i=n.chunk.message;else if(s.runType==="llm")a="on_llm_stream",(n==null?void 0:n.chunk)===void 0?i=new Na({text:t}):i=n.chunk;else throw new Error(`Unexpected run type ${s.runType}`);await this.send({event:a,data:{chunk:i},run_id:e.id,name:s.name,tags:s.tags,metadata:s.metadata},s)}}async onLLMEnd(e){var a,o,l;const t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let n;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const s=(a=e.outputs)==null?void 0:a.generations;let i;if(t.runType==="chat_model"){for(const c of s??[]){if(i!==void 0)break;i=(o=c[0])==null?void 0:o.message}n="on_chat_model_end"}else if(t.runType==="llm")i={generations:s==null?void 0:s.map(c=>c.map(u=>({text:u.text,generationInfo:u.generationInfo}))),llmOutput:((l=e.outputs)==null?void 0:l.llmOutput)??{}},n="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:n,data:{output:i,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){var a,o;const t=Eu(e),n=e.run_type??"chain",s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:e.run_type};let i={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(i={},s.inputs={}):e.inputs.input!==void 0?(i.input=e.inputs.input,s.inputs=e.inputs.input):(i.input=e.inputs,s.inputs=e.inputs),this.runInfoMap.set(e.id,s),await this.send({event:`on_${n}_start`,data:i,name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onChainEnd(e){var o;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const n=`on_${e.run_type}_end`,s=e.inputs??t.inputs??{},a={output:((o=e.outputs)==null?void 0:o.output)??e.outputs,input:s};s.input&&Object.keys(s).length===1&&(a.input=s.input,t.inputs=s.input),await this.sendEndEvent({event:n,data:a,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){var s,i;const t=Eu(e),n={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{}},n)}async onToolEnd(e){var s;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const n=((s=e.outputs)==null?void 0:s.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:n,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){var i,a;const t=Eu(e),s={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,s),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:((a=e.extra)==null?void 0:a.metadata)??{}},s)}async onRetrieverEnd(e){var n;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((n=e.outputs)==null?void 0:n.documents)??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,n){const s=this.runInfoMap.get(n);if(s===void 0)throw new Error(`handleCustomEvent: Run ID ${n} not found in run map.`);await this.send({event:"on_custom_event",run_id:n,name:e,tags:s.tags,metadata:s.metadata,data:t},s)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const Jz=[400,401,402,403,404,405,406,407,409],Kz=r=>{var t,n;if(r.message.startsWith("Cancel")||r.message.startsWith("AbortError")||r.name==="AbortError"||(r==null?void 0:r.code)==="ECONNABORTED")throw r;const e=((t=r==null?void 0:r.response)==null?void 0:t.status)??(r==null?void 0:r.status);if(e&&Jz.includes(+e))throw r;if(((n=r==null?void 0:r.error)==null?void 0:n.code)==="insufficient_quota"){const s=new Error(r==null?void 0:r.message);throw s.name="InsufficientQuotaError",s}};class D_{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??Kz;const t="default"in Qr?Qr.default:Qr;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>Ud(()=>e(...t).catch(n=>{throw n instanceof Error?n:new Error(n)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}class mA extends $c{constructor({config:e,onStart:t,onEnd:n,onError:s}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=n,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function F_(r){return r?r.lc_runnable:!1}class Xz{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let n=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const s=e.tags??[];return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(t)),this.includeTags!==void 0&&(n=n||s.some(i=>{var a;return(a=this.includeTags)==null?void 0:a.includes(i)})),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(n=n&&s.every(i=>{var a;return!((a=this.excludeTags)!=null&&a.includes(i))})),n}}const Yz=Symbol("Let zodToJsonSchema decide on which parser to use"),Qz={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},eB=r=>({...Qz,...r}),tB=r=>{const e=eB(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function gA(r,e,t,n){n!=null&&n.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function Ke(r,e,t,n,s){r[e]=t,gA(r,e,n,s)}function nB(){return{}}function rB(r,e){var n,s,i;const t={type:"array"};return(n=r.type)!=null&&n._def&&((i=(s=r.type)==null?void 0:s._def)==null?void 0:i.typeName)!==j.ZodAny&&(t.items=Ge(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&Ke(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&Ke(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(Ke(t,"minItems",r.exactLength.value,r.exactLength.message,e),Ke(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function sB(r,e){const t={type:"integer",format:"int64"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?Ke(t,"minimum",n.value,n.message,e):Ke(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Ke(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Ke(t,"maximum",n.value,n.message,e):Ke(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Ke(t,"maximum",n.value,n.message,e));break;case"multipleOf":Ke(t,"multipleOf",n.value,n.message,e);break}return t}function iB(){return{type:"boolean"}}function bA(r,e){return Ge(r.type._def,e)}const aB=(r,e)=>Ge(r.innerType._def,e);function _A(r,e,t){const n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((s,i)=>_A(r,e,s))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return oB(r,e)}}const oB=(r,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const n of r.checks)switch(n.kind){case"min":Ke(t,"minimum",n.value,n.message,e);break;case"max":Ke(t,"maximum",n.value,n.message,e);break}return t};function lB(r,e){return{...Ge(r.innerType._def,e),default:r.defaultValue()}}function cB(r,e){return e.effectStrategy==="input"?Ge(r.schema._def,e):{}}function uB(r){return{type:"string",enum:Array.from(r.values)}}const dB=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function hB(r,e){const t=[Ge(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Ge(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(i=>{if(dB(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(n=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...l}=i;a=l}else n=void 0;s.push(a)}}),s.length?{allOf:s,...n}:void 0}function fB(r,e){const t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}let bm;const Un={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(bm===void 0&&(bm=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),bm),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function yA(r,e){const t={type:"string"};if(r.checks)for(const n of r.checks)switch(n.kind){case"min":Ke(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e);break;case"max":Ke(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":qn(t,"email",n.message,e);break;case"format:idn-email":qn(t,"idn-email",n.message,e);break;case"pattern:zod":tn(t,Un.email,n.message,e);break}break;case"url":qn(t,"uri",n.message,e);break;case"uuid":qn(t,"uuid",n.message,e);break;case"regex":tn(t,n.regex,n.message,e);break;case"cuid":tn(t,Un.cuid,n.message,e);break;case"cuid2":tn(t,Un.cuid2,n.message,e);break;case"startsWith":tn(t,RegExp(`^${_m(n.value,e)}`),n.message,e);break;case"endsWith":tn(t,RegExp(`${_m(n.value,e)}$`),n.message,e);break;case"datetime":qn(t,"date-time",n.message,e);break;case"date":qn(t,"date",n.message,e);break;case"time":qn(t,"time",n.message,e);break;case"duration":qn(t,"duration",n.message,e);break;case"length":Ke(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e),Ke(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"includes":{tn(t,RegExp(_m(n.value,e)),n.message,e);break}case"ip":{n.version!=="v6"&&qn(t,"ipv4",n.message,e),n.version!=="v4"&&qn(t,"ipv6",n.message,e);break}case"base64url":tn(t,Un.base64url,n.message,e);break;case"jwt":tn(t,Un.jwt,n.message,e);break;case"cidr":{n.version!=="v6"&&tn(t,Un.ipv4Cidr,n.message,e),n.version!=="v4"&&tn(t,Un.ipv6Cidr,n.message,e);break}case"emoji":tn(t,Un.emoji(),n.message,e);break;case"ulid":{tn(t,Un.ulid,n.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{qn(t,"binary",n.message,e);break}case"contentEncoding:base64":{Ke(t,"contentEncoding","base64",n.message,e);break}case"pattern:zod":{tn(t,Un.base64,n.message,e);break}}break}case"nanoid":tn(t,Un.nanoid,n.message,e)}return t}function _m(r,e){return e.patternStrategy==="escape"?mB(r):r}const pB=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function mB(r){let e="";for(let t=0;t<r.length;t++)pB.has(r[t])||(e+="\\"),e+=r[t];return e}function qn(r,e,t,n){var s;r.format||(s=r.anyOf)!=null&&s.some(i=>i.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):Ke(r,"format",e,t,n)}function tn(r,e,t,n){var s;r.pattern||(s=r.allOf)!=null&&s.some(i=>i.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:kx(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):Ke(r,"pattern",kx(e,n),t,n)}function kx(r,e){var l;if(!e.applyRegexFlags||!r.flags)return r.source;const t={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},n=t.i?r.source.toLowerCase():r.source;let s="",i=!1,a=!1,o=!1;for(let c=0;c<n.length;c++){if(i){s+=n[c],i=!1;continue}if(t.i){if(a){if(n[c].match(/[a-z]/)){o?(s+=n[c],s+=`${n[c-2]}-${n[c]}`.toUpperCase(),o=!1):n[c+1]==="-"&&((l=n[c+2])!=null&&l.match(/[a-z]/))?(s+=n[c],o=!0):s+=`${n[c]}${n[c].toUpperCase()}`;continue}}else if(n[c].match(/[a-z]/)){s+=`[${n[c]}${n[c].toUpperCase()}]`;continue}}if(t.m){if(n[c]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(n[c]==="$"){s+=`($|(?=[\r
]))`;continue}}if(t.s&&n[c]==="."){s+=a?`${n[c]}\r
`:`[${n[c]}\r
]`;continue}s+=n[c],n[c]==="\\"?i=!0:a&&n[c]==="]"?a=!1:!a&&n[c]==="["&&(a=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return s}function wA(r,e){var n,s,i,a,o,l;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((n=r.keyType)==null?void 0:n._def.typeName)===j.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((c,u)=>({...c,[u]:Ge(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",u]})??{}}),{}),additionalProperties:e.rejectedAdditionalProperties};const t={type:"object",additionalProperties:Ge(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(((s=r.keyType)==null?void 0:s._def.typeName)===j.ZodString&&((i=r.keyType._def.checks)!=null&&i.length)){const{type:c,...u}=yA(r.keyType._def,e);return{...t,propertyNames:u}}else{if(((a=r.keyType)==null?void 0:a._def.typeName)===j.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};if(((o=r.keyType)==null?void 0:o._def.typeName)===j.ZodBranded&&r.keyType._def.type._def.typeName===j.ZodString&&((l=r.keyType._def.type._def.checks)!=null&&l.length)){const{type:c,...u}=bA(r.keyType._def,e);return{...t,propertyNames:u}}}return t}function gB(r,e){if(e.mapStrategy==="record")return wA(r,e);const t=Ge(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=Ge(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function bB(r){const e=r.values,n=Object.keys(r.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(n.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function _B(){return{not:{}}}function yB(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Zd={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function wB(r,e){if(e.target==="openApi3")return Sx(r,e);const t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in Zd&&(!n._def.checks||!n._def.checks.length))){const n=t.reduce((s,i)=>{const a=Zd[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=t.reduce((s,i)=>{const a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===t.length){const s=n.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,s)=>[...n,...s._def.values.filter(i=>!n.includes(i))],[])};return Sx(r,e)}const Sx=(r,e)=>{const t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,s)=>Ge(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function vB(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"?{type:Zd[r.innerType._def.typeName],nullable:!0}:{type:[Zd[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=Ge(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const t=Ge(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function xB(r,e){const t={type:"number"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"int":t.type="integer",gA(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?Ke(t,"minimum",n.value,n.message,e):Ke(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Ke(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Ke(t,"maximum",n.value,n.message,e):Ke(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Ke(t,"maximum",n.value,n.message,e));break;case"multipleOf":Ke(t,"multipleOf",n.value,n.message,e);break}return t}function kB(r,e){const t=e.target==="openAi",n={type:"object",properties:{}},s=[],i=r.shape();for(const o in i){let l=i[o];if(l===void 0||l._def===void 0)continue;let c=PB(l);c&&t&&(l instanceof sr&&(l=l._def.innerType),l.isNullable()||(l=l.nullable()),c=!1);const u=Ge(l._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});u!==void 0&&(n.properties[o]=u,c||s.push(o))}s.length&&(n.required=s);const a=SB(r,e);return a!==void 0&&(n.additionalProperties=a),n}function SB(r,e){if(r.catchall._def.typeName!=="ZodNever")return Ge(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(r.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function PB(r){try{return r.isOptional()}catch{return!0}}const AB=(r,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return Ge(r.innerType._def,e);const t=Ge(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},EB=(r,e)=>{if(e.pipeStrategy==="input")return Ge(r.in._def,e);if(e.pipeStrategy==="output")return Ge(r.out._def,e);const t=Ge(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=Ge(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(s=>s!==void 0)}};function OB(r,e){return Ge(r.type._def,e)}function TB(r,e){const n={type:"array",uniqueItems:!0,items:Ge(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&Ke(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&Ke(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function RB(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>Ge(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:Ge(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>Ge(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function IB(){return{not:{}}}function CB(){return{}}const $B=(r,e)=>Ge(r.innerType._def,e),MB=(r,e,t)=>{switch(e){case j.ZodString:return yA(r,t);case j.ZodNumber:return xB(r,t);case j.ZodObject:return kB(r,t);case j.ZodBigInt:return sB(r,t);case j.ZodBoolean:return iB();case j.ZodDate:return _A(r,t);case j.ZodUndefined:return IB();case j.ZodNull:return yB(t);case j.ZodArray:return rB(r,t);case j.ZodUnion:case j.ZodDiscriminatedUnion:return wB(r,t);case j.ZodIntersection:return hB(r,t);case j.ZodTuple:return RB(r,t);case j.ZodRecord:return wA(r,t);case j.ZodLiteral:return fB(r,t);case j.ZodEnum:return uB(r);case j.ZodNativeEnum:return bB(r);case j.ZodNullable:return vB(r,t);case j.ZodOptional:return AB(r,t);case j.ZodMap:return gB(r,t);case j.ZodSet:return TB(r,t);case j.ZodLazy:return()=>r.getter()._def;case j.ZodPromise:return OB(r,t);case j.ZodNaN:case j.ZodNever:return _B();case j.ZodEffects:return cB(r,t);case j.ZodAny:return nB();case j.ZodUnknown:return CB();case j.ZodDefault:return lB(r,t);case j.ZodBranded:return bA(r,t);case j.ZodReadonly:return $B(r,t);case j.ZodCatch:return aB(r,t);case j.ZodPipeline:return EB(r,t);case j.ZodFunction:case j.ZodVoid:case j.ZodSymbol:return;default:return(n=>{})()}};function Ge(r,e,t=!1){var o;const n=e.seen.get(r);if(e.override){const l=(o=e.override)==null?void 0:o.call(e,r,e,n,t);if(l!==Yz)return l}if(n&&!t){const l=NB(n,e);if(l!==void 0)return l}const s={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,s);const i=MB(r,r.typeName,e),a=typeof i=="function"?Ge(i(),e):i;if(a&&jB(r,e,a),e.postProcess){const l=e.postProcess(a,r,e);return s.jsonSchema=a,l}return s.jsonSchema=a,a}const NB=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"relative":return{$ref:LB(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((t,n)=>e.currentPath[n]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},LB=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},jB=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t),js=(r,e)=>{const t=tB(e),n=void 0,s=e==null?void 0:e.name,i=Ge(r._def,t,!1)??{},a=s===void 0?n?{...i,[t.definitionPath]:n}:i:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...n,[s]:i}};return t.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in a||"oneOf"in a||"allOf"in a||"type"in a&&Array.isArray(a.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),a};function ym(r){return r.replace(/[^a-zA-Z-_0-9]/g,"_")}const DB=["*","_","`"];function FB(r){let e="";for(const[t,n]of Object.entries(r))e+=`	classDef ${t} ${n};
`;return e}function zB(r,e,t){const{firstNode:n,lastNode:s,nodeColors:i,withStyles:a=!0,curveStyle:o="linear",wrapLabelNWords:l=9}=t??{};let c=a?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(a){const f="default",p={[f]:"{0}({1})"};n!==void 0&&(p[n]="{0}([{1}]):::first"),s!==void 0&&(p[s]="{0}([{1}]):::last");for(const[m,g]of Object.entries(r)){const b=g.name.split(":").pop()??"";let y=DB.some(v=>b.startsWith(v)&&b.endsWith(v))?`<p>${b}</p>`:b;Object.keys(g.metadata??{}).length&&(y+=`<hr/><small><em>${Object.entries(g.metadata??{}).map(([v,x])=>`${v} = ${x}`).join(`
`)}</em></small>`);const w=(p[m]??p[f]).replace("{0}",ym(m)).replace("{1}",y);c+=`	${w}
`}}const u={};for(const f of e){const p=f.source.split(":"),m=f.target.split(":"),g=p.filter((b,_)=>b===m[_]).join(":");u[g]||(u[g]=[]),u[g].push(f)}const d=new Set;function h(f,p){const m=f.length===1&&f[0].source===f[0].target;if(p&&!m){const g=p.split(":").pop();if(d.has(g))throw new Error(`Found duplicate subgraph '${g}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(g),c+=`	subgraph ${g}
`}for(const g of f){const{source:b,target:_,data:y,conditional:w}=g;let v="";if(y!==void 0){let x=y;const k=x.split(" ");k.length>l&&(x=Array.from({length:Math.ceil(k.length/l)},(S,R)=>k.slice(R*l,(R+1)*l).join(" ")).join("&nbsp;<br>&nbsp;")),v=w?` -. &nbsp;${x}&nbsp; .-> `:` -- &nbsp;${x}&nbsp; --> `}else v=w?" -.-> ":" --> ";c+=`	${ym(b)}${v}${ym(_)};
`}for(const g in u)g.startsWith(`${p}:`)&&g!==p&&h(u[g],g);p&&!m&&(c+=`	end
`)}h(u[""]??[],"");for(const f in u)!f.includes(":")&&f!==""&&h(u[f],f);return a&&(c+=FB(i??{})),c}async function BB(r,e){let{backgroundColor:t="white"}=e??{};const n=btoa(r);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));const s=`https://mermaid.ink/img/${n}?bgColor=${t}`,i=await fetch(s);if(!i.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${i.status}`,`Status text: ${i.statusText}`].join(`
`));return await i.blob()}function UB(r,e){if(r!==void 0&&!sl(r))return r;if(F_(e))try{let t=e.getName();return t=t.startsWith("Runnable")?t.slice(8):t,t}catch{return e.getName()}else return e.name??"UnknownSchema"}function qB(r){return F_(r.data)?{type:"runnable",data:{id:r.data.lc_id,name:r.data.getName()}}:{type:"schema",data:{...js(r.data.schema),title:r.data.name}}}class Yh{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=(e==null?void 0:e.nodes)??this.nodes,this.edges=(e==null?void 0:e.edges)??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((t,n)=>{e[t.id]=sl(t.id)?n:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...qB(t)})),edges:this.edges.map(t=>{const n={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(n.data=t.data),typeof t.conditional<"u"&&(n.conditional=t.conditional),n})}}addNode(e,t,n){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);const s=t??sn(),i={id:s,data:e,name:UB(t,e),metadata:n};return this.nodes[s]=i,i}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,n,s){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);const i={source:e.id,target:t.id,data:n,conditional:s};return this.edges.push(i),i}firstNode(){return Px(this)}lastNode(){return Ax(this)}extend(e,t=""){let n=t;Object.values(e.nodes).map(c=>c.id).every(sl)&&(n="");const i=c=>n?`${n}:${c}`:c;Object.entries(e.nodes).forEach(([c,u])=>{this.nodes[i(c)]={...u,id:i(c)}});const a=e.edges.map(c=>({...c,source:i(c.source),target:i(c.target)}));this.edges=[...this.edges,...a];const o=e.firstNode(),l=e.lastNode();return[o?{id:i(o.id),data:o.data}:void 0,l?{id:i(l.id),data:l.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&Px(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&Ax(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(s=>[s.id,s.name])),t=new Map;Object.values(e).forEach(s=>{t.set(s,(t.get(s)||0)+1)});const n=s=>{const i=e[s];return sl(s)&&t.get(i)===1?i:s};return new Yh({nodes:Object.fromEntries(Object.entries(this.nodes).map(([s,i])=>[n(s),{...i,id:n(s)}])),edges:this.edges.map(s=>({...s,source:n(s.source),target:n(s.target)}))})}drawMermaid(e){const{withStyles:t,curveStyle:n,nodeColors:s={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:i}=e??{},a=this.reid(),o=a.firstNode(),l=a.lastNode();return zB(a.nodes,a.edges,{firstNode:o==null?void 0:o.id,lastNode:l==null?void 0:l.id,withStyles:t,curveStyle:n,nodeColors:s,wrapLabelNWords:i})}async drawMermaidPng(e){const t=this.drawMermaid(e);return BB(t,{backgroundColor:e==null?void 0:e.backgroundColor})}}function Px(r,e=[]){const t=new Set(r.edges.filter(s=>!e.includes(s.source)).map(s=>s.target)),n=[];for(const s of Object.values(r.nodes))!e.includes(s.id)&&!t.has(s.id)&&n.push(s);return n.length===1?n[0]:void 0}function Ax(r,e=[]){const t=new Set(r.edges.filter(s=>!e.includes(s.target)).map(s=>s.source)),n=[];for(const s of Object.values(r.nodes))!e.includes(s.id)&&!t.has(s.id)&&n.push(s);return n.length===1?n[0]:void 0}function HB(r){const e=new TextEncoder,t=new ReadableStream({async start(n){for await(const s of r)n.enqueue(e.encode(`event: data
data: ${JSON.stringify(s)}

`));n.enqueue(e.encode(`event: end

`)),n.close()}});return $n.fromReadableStream(t)}function Ex(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.iterator]=="function"&&typeof r.next=="function"}const WB=r=>r!=null&&typeof r=="object"&&"next"in r&&typeof r.next=="function";function Yg(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.asyncIterator]=="function"}function*Ox(r,e){for(;;){const{value:t,done:n}=Tr.runWithConfig(Ns(r),e.next.bind(e),!0);if(n)break;yield t}}async function*Qg(r,e){const t=e[Symbol.asyncIterator]();for(;;){const{value:n,done:s}=await Tr.runWithConfig(Ns(r),t.next.bind(e),!0);if(s)break;yield n}}function Mt(r,e){return r&&!Array.isArray(r)&&!(r instanceof Date)&&typeof r=="object"?r:{[e]:r}}class jt extends bi{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new pi({bound:this,kwargs:e,config:{}})}map(){return new Jd({bound:this})}withRetry(e){return new VB({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new pi({bound:this,config:e,kwargs:{}})}withFallbacks(e){const t=Array.isArray(e)?e:e.fallbacks;return new ZB({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(We);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const n=Object.fromEntries(Object.entries(e).filter(([s])=>s!=="runId"));return Array.from({length:t},(s,i)=>We(i===0?e:n))}return Array.from({length:t},()=>We(e))}async batch(e,t,n){var l;const s=this._getOptionsList(t??{},e.length),i=((l=s[0])==null?void 0:l.maxConcurrency)??(n==null?void 0:n.maxConcurrency),a=new D_({maxConcurrency:i,onFailedAttempt:c=>{throw c}}),o=e.map((c,u)=>a.call(async()=>{try{return await this.invoke(c,s[u])}catch(d){if(n!=null&&n.returnExceptions)return d;throw d}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const n=We(t),s=new Ja({generator:this._streamIterator(e,n),config:n});return await s.setup,$n.fromAsyncGenerator(s)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=We(e):t=We({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,delete n.timeout,delete n.signal,[t,n]}async _callWithConfig(e,t,n){const s=We(n),i=await ir(s),a=await(i==null?void 0:i.handleChainStart(this.toJSON(),Mt(t,"input"),s.runId,s==null?void 0:s.runType,void 0,void 0,(s==null?void 0:s.runName)??this.getName()));delete s.runId;let o;try{const l=e.call(this,t,s,a);o=await Ls(l,n==null?void 0:n.signal)}catch(l){throw await(a==null?void 0:a.handleChainError(l)),l}return await(a==null?void 0:a.handleChainEnd(Mt(o,"output"))),o}async _batchWithConfig(e,t,n,s){var c;const i=this._getOptionsList(n??{},t.length),a=await Promise.all(i.map(ir)),o=await Promise.all(a.map(async(u,d)=>{const h=await(u==null?void 0:u.handleChainStart(this.toJSON(),Mt(t[d],"input"),i[d].runId,i[d].runType,void 0,void 0,i[d].runName??this.getName()));return delete i[d].runId,h}));let l;try{const u=e.call(this,t,i,o,s);l=await Ls(u,(c=i==null?void 0:i[0])==null?void 0:c.signal)}catch(u){throw await Promise.all(o.map(d=>d==null?void 0:d.handleChainError(u))),u}return await Promise.all(o.map(u=>u==null?void 0:u.handleChainEnd(Mt(l,"output")))),l}async*_transformStreamWithConfig(e,t,n){let s,i=!0,a,o=!0;const l=We(n),c=await ir(l);async function*u(){for await(const h of e){if(i)if(s===void 0)s=h;else try{s=ar(s,h)}catch{s=void 0,i=!1}yield h}}let d;try{const h=await Hz(t.bind(this),u(),async()=>c==null?void 0:c.handleChainStart(this.toJSON(),{input:""},l.runId,l.runType,void 0,void 0,l.runName??this.getName()),n==null?void 0:n.signal,l);delete l.runId,d=h.setup;const f=d==null?void 0:d.handlers.find(Gz);let p=h.output;f!==void 0&&d!==void 0&&(p=f.tapOutputIterable(d.runId,p));const m=d==null?void 0:d.handlers.find(Wz);m!==void 0&&d!==void 0&&(p=m.tapOutputIterable(d.runId,p));for await(const g of p)if(yield g,o)if(a===void 0)a=g;else try{a=ar(a,g)}catch{a=void 0,o=!1}}catch(h){throw await(d==null?void 0:d.handleChainError(h,void 0,void 0,void 0,{inputs:Mt(s,"input")})),h}await(d==null?void 0:d.handleChainEnd(a??{},void 0,void 0,void 0,{inputs:Mt(s,"input")}))}getGraph(e){const t=new Yh,n=t.addNode({name:`${this.getName()}Input`,schema:He.any()}),s=t.addNode(this),i=t.addNode({name:`${this.getName()}Output`,schema:He.any()});return t.addEdge(n,s),t.addEdge(s,i),t}pipe(e){return new er({first:this,last:ai(e)})}pick(e){return this.pipe(new JB(e))}assign(e){return this.pipe(new vA(new Ka({steps:e})))}async*transform(e,t){let n;for await(const s of e)n===void 0?n=s:n=ar(n,s);yield*this._streamIterator(n,We(t))}async*streamLog(e,t,n){const s=new vx({...n,autoClose:!1,_schemaFormat:"original"}),i=We(t);yield*this._streamLog(e,s,i)}async*_streamLog(e,t,n){const{callbacks:s}=n;if(s===void 0)n.callbacks=[t];else if(Array.isArray(s))n.callbacks=s.concat([t]);else{const l=s.copy();l.addHandler(t,!0),n.callbacks=l}const i=this.stream(e,n);async function a(){try{const l=await i;for await(const c of l){const u=new bs({ops:[{op:"add",path:"/streamed_output/-",value:c}]});await t.writer.write(u)}}finally{await t.writer.close()}}const o=a();try{for await(const l of t)yield l}finally{await o}}streamEvents(e,t,n){let s;if(t.version==="v1")s=this._streamEventsV1(e,t,n);else if(t.version==="v2")s=this._streamEventsV2(e,t,n);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?HB(s):$n.fromAsyncGenerator(s)}async*_streamEventsV2(e,t,n){var p;const s=new Zz({...n,autoClose:!1}),i=We(t),a=i.runId??sn();i.runId=a;const o=i.callbacks;if(o===void 0)i.callbacks=[s];else if(Array.isArray(o))i.callbacks=o.concat(s);else{const m=o.copy();m.addHandler(s,!0),i.callbacks=m}const l=new AbortController,c=this;async function u(){try{let m;t!=null&&t.signal?"any"in AbortSignal?m=AbortSignal.any([l.signal,t.signal]):(m=t.signal,t.signal.addEventListener("abort",()=>{l.abort()},{once:!0})):m=l.signal;const g=await c.stream(e,{...i,signal:m}),b=s.tapOutputIterable(a,g);for await(const _ of b)if(l.signal.aborted)break}finally{await s.finish()}}const d=u();let h=!1,f;try{for await(const m of s){if(!h){m.data.input=e,h=!0,f=m.run_id,yield m;continue}m.run_id===f&&m.event.endsWith("_end")&&(p=m.data)!=null&&p.input&&delete m.data.input,yield m}}finally{l.abort(),await d}}async*_streamEventsV1(e,t,n){let s,i=!1;const a=We(t),o=a.tags??[],l=a.metadata??{},c=a.runName??this.getName(),u=new vx({...n,autoClose:!1,_schemaFormat:"streaming_events"}),d=new Xz({...n}),h=this._streamLog(e,u,a);for await(const p of h){if(s?s=s.concat(p):s=ql.fromRunLogPatch(p),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!i){i=!0;const _={...s.state},y={run_id:_.id,event:`on_${_.type}_start`,name:c,tags:o,metadata:l,data:{input:e}};d.includeEvent(y,_.type)&&(yield y)}const m=p.ops.filter(_=>_.path.startsWith("/logs/")).map(_=>_.path.split("/")[2]),g=[...new Set(m)];for(const _ of g){let y,w={};const v=s.state.logs[_];if(v.end_time===void 0?v.streamed_output.length>0?y="stream":y="start":y="end",y==="start")v.inputs!==void 0&&(w.input=v.inputs);else if(y==="end")v.inputs!==void 0&&(w.input=v.inputs),w.output=v.final_output;else if(y==="stream"){const x=v.streamed_output.length;if(x!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${x} instead. Encountered in: "${v.name}"`);w={chunk:v.streamed_output[0]},v.streamed_output=[]}yield{event:`on_${v.type}_${y}`,name:v.name,run_id:v.id,tags:v.tags,metadata:v.metadata,data:w}}const{state:b}=s;if(b.streamed_output.length>0){const _=b.streamed_output.length;if(_!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${_} instead. Encountered in: "${b.name}"`);const y={chunk:b.streamed_output[0]};b.streamed_output=[];const w={event:`on_${b.type}_stream`,run_id:b.id,tags:o,metadata:l,name:c,data:y};d.includeEvent(w,b.type)&&(yield w)}}const f=s==null?void 0:s.state;if(f!==void 0){const p={event:`on_${f.type}_end`,name:c,run_id:f.id,tags:o,metadata:l,data:{output:f.final_output}};d.includeEvent(p,f.type)&&(yield p)}}static isRunnable(e){return F_(e)}withListeners({onStart:e,onEnd:t,onError:n}){return new pi({bound:this,config:{},configFactories:[s=>({callbacks:[new mA({config:s,onStart:e,onEnd:t,onError:n})]})]})}asTool(e){return KB(this,e)}}class pi extends jt{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=_x(this.config,...e);return _x(t,...this.configFactories?await Promise.all(this.configFactories.map(async n=>await n(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(We(t),this.kwargs))}async batch(e,t,n){const s=Array.isArray(t)?await Promise.all(t.map(async i=>this._mergeConfig(We(i),this.kwargs))):await this._mergeConfig(We(t),this.kwargs);return this.bound.batch(e,s,n)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(We(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(We(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(We(t),this.kwargs))}streamEvents(e,t,n){const s=this,i=async function*(){yield*s.bound.streamEvents(e,{...await s._mergeConfig(We(t),s.kwargs),version:t.version},n)};return $n.fromAsyncGenerator(i())}static isRunnableBinding(e){return e.bound&&jt.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:n}){return new pi({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new mA({config:s,onStart:e,onEnd:t,onError:n})]})]})}}class Jd extends jt{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new Jd({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,n){return this.bound.batch(e,Nt(t,{callbacks:n==null?void 0:n.getChild()}))}withListeners({onStart:e,onEnd:t,onError:n}){return new Jd({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:n})})}}class VB extends pi{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,n){const s=e>1?`retry:attempt:${e}`:void 0;return Nt(t,{callbacks:n==null?void 0:n.getChild(s)})}async _invoke(e,t,n){return Ud(s=>super.invoke(e,this._patchConfigForRetry(s,t,n)),{onFailedAttempt:s=>this.onFailedAttempt(s,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,n,s){const i={};try{await Ud(async a=>{const o=e.map((h,f)=>f).filter(h=>i[h.toString()]===void 0||i[h.toString()]instanceof Error),l=o.map(h=>e[h]),c=o.map(h=>this._patchConfigForRetry(a,t==null?void 0:t[h],n==null?void 0:n[h])),u=await super.batch(l,c,{...s,returnExceptions:!0});let d;for(let h=0;h<u.length;h+=1){const f=u[h],p=o[h];f instanceof Error&&d===void 0&&(d=f,d.input=l[h]),i[p.toString()]=f}if(d)throw d;return u},{onFailedAttempt:a=>this.onFailedAttempt(a,a.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(a){if((s==null?void 0:s.returnExceptions)!==!0)throw a}return Object.keys(i).sort((a,o)=>parseInt(a,10)-parseInt(o,10)).map(a=>i[parseInt(a,10)])}async batch(e,t,n){return this._batchWithConfig(this._batch.bind(this),e,t,n)}}class er extends jt{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){var l;const n=We(t),s=await ir(n),i=await(s==null?void 0:s.handleChainStart(this.toJSON(),Mt(e,"input"),n.runId,void 0,void 0,void 0,n==null?void 0:n.runName));delete n.runId;let a=e,o;try{const c=[this.first,...this.middle];for(let u=0;u<c.length;u+=1){const h=c[u].invoke(a,Nt(n,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${u+1}`)}));a=await Ls(h,t==null?void 0:t.signal)}if((l=t==null?void 0:t.signal)!=null&&l.aborted)throw new Error("Aborted");o=await this.last.invoke(a,Nt(n,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(c){throw await(i==null?void 0:i.handleChainError(c)),c}return await(i==null?void 0:i.handleChainEnd(Mt(o,"output"))),o}async batch(e,t,n){var l;const s=this._getOptionsList(t??{},e.length),i=await Promise.all(s.map(ir)),a=await Promise.all(i.map(async(c,u)=>{const d=await(c==null?void 0:c.handleChainStart(this.toJSON(),Mt(e[u],"input"),s[u].runId,void 0,void 0,void 0,s[u].runName));return delete s[u].runId,d}));let o=e;try{for(let c=0;c<this.steps.length;c+=1){const d=this.steps[c].batch(o,a.map((h,f)=>{const p=h==null?void 0:h.getChild(this.omitSequenceTags?void 0:`seq:step:${c+1}`);return Nt(s[f],{callbacks:p})}),n);o=await Ls(d,(l=s[0])==null?void 0:l.signal)}}catch(c){throw await Promise.all(a.map(u=>u==null?void 0:u.handleChainError(c))),c}return await Promise.all(a.map(c=>c==null?void 0:c.handleChainEnd(Mt(o,"output")))),o}async*_streamIterator(e,t){var d;const n=await ir(t),{runId:s,...i}=t??{},a=await(n==null?void 0:n.handleChainStart(this.toJSON(),Mt(e,"input"),s,void 0,void 0,void 0,i==null?void 0:i.runName)),o=[this.first,...this.middle,this.last];let l=!0,c;async function*u(){yield e}try{let h=o[0].transform(u(),Nt(i,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let f=1;f<o.length;f+=1)h=await o[f].transform(h,Nt(i,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:`seq:step:${f+1}`)}));for await(const f of h)if((d=t==null?void 0:t.signal)==null||d.throwIfAborted(),yield f,l)if(c===void 0)c=f;else try{c=ar(c,f)}catch{c=void 0,l=!1}}catch(h){throw await(a==null?void 0:a.handleChainError(h)),h}await(a==null?void 0:a.handleChainEnd(Mt(c,"output")))}getGraph(e){const t=new Yh;let n=null;return this.steps.forEach((s,i)=>{const a=s.getGraph(e);i!==0&&a.trimFirstNode(),i!==this.steps.length-1&&a.trimLastNode(),t.extend(a);const o=a.firstNode();if(!o)throw new Error(`Runnable ${s} has no first node`);n&&t.addEdge(n,o),n=a.lastNode()}),t}pipe(e){return er.isRunnableSequence(e)?new er({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new er({first:this.first,middle:[...this.middle,this.last],last:ai(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&jt.isRunnable(e)}static from([e,...t],n){let s={};return typeof n=="string"?s.name=n:n!==void 0&&(s=n),new er({...s,first:ai(e),middle:t.slice(0,-1).map(ai),last:ai(t[t.length-1])})}}class Ka extends jt{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,n]of Object.entries(e.steps))this.steps[t]=ai(n)}static from(e){return new Ka({steps:e})}async invoke(e,t){const n=We(t),s=await ir(n),i=await(s==null?void 0:s.handleChainStart(this.toJSON(),{input:e},n.runId,void 0,void 0,void 0,n==null?void 0:n.runName));delete n.runId;const a={};try{const o=Object.entries(this.steps).map(async([l,c])=>{a[l]=await c.invoke(e,Nt(n,{callbacks:i==null?void 0:i.getChild(`map:key:${l}`)}))});await Ls(Promise.all(o),t==null?void 0:t.signal)}catch(o){throw await(i==null?void 0:i.handleChainError(o)),o}return await(i==null?void 0:i.handleChainEnd(a)),a}async*_transform(e,t,n){const s={...this.steps},i=pA(e,Object.keys(s).length),a=new Map(Object.entries(s).map(([o,l],c)=>{const u=l.transform(i[c],Nt(n,{callbacks:t==null?void 0:t.getChild(`map:key:${o}`)}));return[o,u.next().then(d=>({key:o,gen:u,result:d}))]}));for(;a.size;){const o=Promise.race(a.values()),{key:l,result:c,gen:u}=await Ls(o,n==null?void 0:n.signal);a.delete(l),c.done||(yield{[l]:c.value},a.set(l,u.next().then(d=>({key:l,gen:u,result:d}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=We(t),i=new Ja({generator:this.transform(n(),s),config:s});return await i.setup,$n.fromAsyncGenerator(i)}}class z_ extends jt{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!N_(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){const[n]=this._getOptionsList(t??{},1),s=await ir(n),i=this.func(Nt(n,{callbacks:s}),e);return Ls(i,n==null?void 0:n.signal)}async*_streamIterator(e,t){var i,a;const[n]=this._getOptionsList(t??{},1),s=await this.invoke(e,t);if(Yg(s)){for await(const o of s)(i=n==null?void 0:n.signal)==null||i.throwIfAborted(),yield o;return}if(WB(s)){for(;;){(a=n==null?void 0:n.signal)==null||a.throwIfAborted();const o=s.next();if(o.done)break;yield o.value}return}yield s}static from(e){return new z_({func:e})}}function GB(r){if(N_(r))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}class Ri extends jt{static lc_name(){return"RunnableLambda"}constructor(e){if(N_(e.func))return z_.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),GB(e.func),this.func=e.func}static from(e){return new Ri({func:e})}async _invoke(e,t,n){return new Promise((s,i)=>{const a=Nt(t,{callbacks:n==null?void 0:n.getChild(),recursionLimit:((t==null?void 0:t.recursionLimit)??gm)-1});Tr.runWithConfig(Ns(a),async()=>{var o,l;try{let c=await this.func(e,{...a});if(c&&jt.isRunnable(c)){if((t==null?void 0:t.recursionLimit)===0)throw new Error("Recursion limit reached.");c=await c.invoke(e,{...a,recursionLimit:(a.recursionLimit??gm)-1})}else if(Yg(c)){let u;for await(const d of Qg(a,c))if((o=t==null?void 0:t.signal)==null||o.throwIfAborted(),u===void 0)u=d;else try{u=ar(u,d)}catch{u=d}c=u}else if(Ex(c)){let u;for(const d of Ox(a,c))if((l=t==null?void 0:t.signal)==null||l.throwIfAborted(),u===void 0)u=d;else try{u=ar(u,d)}catch{u=d}c=u}s(c)}catch(c){i(c)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async*_transform(e,t,n){var o,l;let s;for await(const c of e)if(s===void 0)s=c;else try{s=ar(s,c)}catch{s=c}const i=Nt(n,{callbacks:t==null?void 0:t.getChild(),recursionLimit:((n==null?void 0:n.recursionLimit)??gm)-1}),a=await new Promise((c,u)=>{Tr.runWithConfig(Ns(i),async()=>{try{const d=await this.func(s,{...i,config:i});c(d)}catch(d){u(d)}})});if(a&&jt.isRunnable(a)){if((n==null?void 0:n.recursionLimit)===0)throw new Error("Recursion limit reached.");const c=await a.stream(s,i);for await(const u of c)yield u}else if(Yg(a))for await(const c of Qg(i,a))(o=n==null?void 0:n.signal)==null||o.throwIfAborted(),yield c;else if(Ex(a))for(const c of Ox(i,a))(l=n==null?void 0:n.signal)==null||l.throwIfAborted(),yield c;else yield a}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=We(t),i=new Ja({generator:this.transform(n(),s),config:s});return await i.setup,$n.fromAsyncGenerator(i)}}class ZB extends jt{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const n=We(t),s=await ir(n),{runId:i,...a}=n,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),Mt(e,"input"),i,void 0,void 0,void 0,a==null?void 0:a.runName)),l=Nt(a,{callbacks:o==null?void 0:o.getChild()});return await Tr.runWithConfig(l,async()=>{var d;let u;for(const h of this.runnables()){(d=n==null?void 0:n.signal)==null||d.throwIfAborted();try{const f=await h.invoke(e,l);return await(o==null?void 0:o.handleChainEnd(Mt(f,"output"))),f}catch(f){u===void 0&&(u=f)}}throw u===void 0?new Error("No error stored at end of fallback."):(await(o==null?void 0:o.handleChainError(u)),u)})}async*_streamIterator(e,t){var d;const n=We(t),s=await ir(n),{runId:i,...a}=n,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),Mt(e,"input"),i,void 0,void 0,void 0,a==null?void 0:a.runName));let l,c;for(const h of this.runnables()){(d=n==null?void 0:n.signal)==null||d.throwIfAborted();const f=Nt(a,{callbacks:o==null?void 0:o.getChild()});try{const p=await h.stream(e,f);c=Qg(f,p);break}catch(p){l===void 0&&(l=p)}}if(c===void 0){const h=l??new Error("No error stored at end of fallback.");throw await(o==null?void 0:o.handleChainError(h)),h}let u;try{for await(const h of c){yield h;try{u=u===void 0?u:ar(u,h)}catch{u=void 0}}}catch(h){throw await(o==null?void 0:o.handleChainError(h)),h}await(o==null?void 0:o.handleChainEnd(Mt(u,"output")))}async batch(e,t,n){var l;if(n!=null&&n.returnExceptions)throw new Error("Not implemented.");const s=this._getOptionsList(t??{},e.length),i=await Promise.all(s.map(c=>ir(c))),a=await Promise.all(i.map(async(c,u)=>{const d=await(c==null?void 0:c.handleChainStart(this.toJSON(),Mt(e[u],"input"),s[u].runId,void 0,void 0,void 0,s[u].runName));return delete s[u].runId,d}));let o;for(const c of this.runnables()){(l=s[0].signal)==null||l.throwIfAborted();try{const u=await c.batch(e,a.map((d,h)=>Nt(s[h],{callbacks:d==null?void 0:d.getChild()})),n);return await Promise.all(a.map((d,h)=>d==null?void 0:d.handleChainEnd(Mt(u[h],"output")))),u}catch(u){o===void 0&&(o=u)}}throw o?(await Promise.all(a.map(c=>c==null?void 0:c.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function ai(r){if(typeof r=="function")return new Ri({func:r});if(jt.isRunnable(r))return r;if(!Array.isArray(r)&&typeof r=="object"){const e={};for(const[t,n]of Object.entries(r))e[t]=ai(n);return new Ka({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class vA extends jt{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof Ka&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const n=await this.mapper.invoke(e,t);return{...e,...n}}async*_transform(e,t,n){const s=this.mapper.getStepsKeys(),[i,a]=pA(e),o=this.mapper.transform(a,Nt(n,{callbacks:t==null?void 0:t.getChild()})),l=o.next();for await(const c of i){if(typeof c!="object"||Array.isArray(c))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof c}`);const u=Object.fromEntries(Object.entries(c).filter(([d])=>!s.includes(d)));Object.keys(u).length>0&&(yield u)}yield(await l).value;for await(const c of o)yield c}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=We(t),i=new Ja({generator:this.transform(n(),s),config:s});return await i.setup,$n.fromAsyncGenerator(i)}}class JB extends jt{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const t=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const n=await this._pick(t);n!==void 0&&(yield n)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=We(t),i=new Ja({generator:this.transform(n(),s),config:s});return await i.setup,$n.fromAsyncGenerator(i)}}class Tx extends pi{constructor(e){const t=er.from([Ri.from(async n=>{let s;if(E_(n))try{s=await this.schema.parseAsync(n.args)}catch{throw new zg("Received tool input did not match expected schema",JSON.stringify(n.args))}else s=n;return s}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}function KB(r,e){var s;const t=e.name??r.getName(),n=e.description??((s=e.schema)==null?void 0:s.description);return e.schema.constructor===He.ZodString?new Tx({name:t,description:n,schema:He.object({input:He.string()}).transform(i=>i.input),bound:r}):new Tx({name:t,description:n,schema:e.schema,bound:r})}/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var XB=typeof window=="object"?window:{},Oe="0123456789abcdef".split(""),YB=[-2147483648,8388608,32768,128],Hn=[24,16,8,0],Ct=[];function cr(r){r?(Ct[0]=Ct[16]=Ct[1]=Ct[2]=Ct[3]=Ct[4]=Ct[5]=Ct[6]=Ct[7]=Ct[8]=Ct[9]=Ct[10]=Ct[11]=Ct[12]=Ct[13]=Ct[14]=Ct[15]=0,this.blocks=Ct):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}cr.prototype.update=function(r){if(!this.finalized){var e=typeof r!="string";e&&r.constructor===XB.ArrayBuffer&&(r=new Uint8Array(r));for(var t,n=0,s,i=r.length||0,a=this.blocks;n<i;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),e)for(s=this.start;n<i&&s<64;++n)a[s>>2]|=r[n]<<Hn[s++&3];else for(s=this.start;n<i&&s<64;++n)t=r.charCodeAt(n),t<128?a[s>>2]|=t<<Hn[s++&3]:t<2048?(a[s>>2]|=(192|t>>6)<<Hn[s++&3],a[s>>2]|=(128|t&63)<<Hn[s++&3]):t<55296||t>=57344?(a[s>>2]|=(224|t>>12)<<Hn[s++&3],a[s>>2]|=(128|t>>6&63)<<Hn[s++&3],a[s>>2]|=(128|t&63)<<Hn[s++&3]):(t=65536+((t&1023)<<10|r.charCodeAt(++n)&1023),a[s>>2]|=(240|t>>18)<<Hn[s++&3],a[s>>2]|=(128|t>>12&63)<<Hn[s++&3],a[s>>2]|=(128|t>>6&63)<<Hn[s++&3],a[s>>2]|=(128|t&63)<<Hn[s++&3]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=a[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};cr.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var r=this.blocks,e=this.lastByteIndex;r[16]=this.block,r[e>>2]|=YB[e&3],this.block=r[16],e>=56&&(this.hashed||this.hash(),r[0]=this.block,r[16]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=r[9]=r[10]=r[11]=r[12]=r[13]=r[14]=r[15]=0),r[14]=this.hBytes<<3|this.bytes>>>29,r[15]=this.bytes<<3,this.hash()}};cr.prototype.hash=function(){var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4,i,a,o,l=this.blocks;for(a=16;a<80;++a)o=l[a-3]^l[a-8]^l[a-14]^l[a-16],l[a]=o<<1|o>>>31;for(a=0;a<20;a+=5)i=e&t|~e&n,o=r<<5|r>>>27,s=o+i+s+1518500249+l[a]<<0,e=e<<30|e>>>2,i=r&e|~r&t,o=s<<5|s>>>27,n=o+i+n+1518500249+l[a+1]<<0,r=r<<30|r>>>2,i=s&r|~s&e,o=n<<5|n>>>27,t=o+i+t+1518500249+l[a+2]<<0,s=s<<30|s>>>2,i=n&s|~n&r,o=t<<5|t>>>27,e=o+i+e+1518500249+l[a+3]<<0,n=n<<30|n>>>2,i=t&n|~t&s,o=e<<5|e>>>27,r=o+i+r+1518500249+l[a+4]<<0,t=t<<30|t>>>2;for(;a<40;a+=5)i=e^t^n,o=r<<5|r>>>27,s=o+i+s+1859775393+l[a]<<0,e=e<<30|e>>>2,i=r^e^t,o=s<<5|s>>>27,n=o+i+n+1859775393+l[a+1]<<0,r=r<<30|r>>>2,i=s^r^e,o=n<<5|n>>>27,t=o+i+t+1859775393+l[a+2]<<0,s=s<<30|s>>>2,i=n^s^r,o=t<<5|t>>>27,e=o+i+e+1859775393+l[a+3]<<0,n=n<<30|n>>>2,i=t^n^s,o=e<<5|e>>>27,r=o+i+r+1859775393+l[a+4]<<0,t=t<<30|t>>>2;for(;a<60;a+=5)i=e&t|e&n|t&n,o=r<<5|r>>>27,s=o+i+s-1894007588+l[a]<<0,e=e<<30|e>>>2,i=r&e|r&t|e&t,o=s<<5|s>>>27,n=o+i+n-1894007588+l[a+1]<<0,r=r<<30|r>>>2,i=s&r|s&e|r&e,o=n<<5|n>>>27,t=o+i+t-1894007588+l[a+2]<<0,s=s<<30|s>>>2,i=n&s|n&r|s&r,o=t<<5|t>>>27,e=o+i+e-1894007588+l[a+3]<<0,n=n<<30|n>>>2,i=t&n|t&s|n&s,o=e<<5|e>>>27,r=o+i+r-1894007588+l[a+4]<<0,t=t<<30|t>>>2;for(;a<80;a+=5)i=e^t^n,o=r<<5|r>>>27,s=o+i+s-899497514+l[a]<<0,e=e<<30|e>>>2,i=r^e^t,o=s<<5|s>>>27,n=o+i+n-899497514+l[a+1]<<0,r=r<<30|r>>>2,i=s^r^e,o=n<<5|n>>>27,t=o+i+t-899497514+l[a+2]<<0,s=s<<30|s>>>2,i=n^s^r,o=t<<5|t>>>27,e=o+i+e-899497514+l[a+3]<<0,n=n<<30|n>>>2,i=t^n^s,o=e<<5|e>>>27,r=o+i+r-899497514+l[a+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+r<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+n<<0,this.h4=this.h4+s<<0};cr.prototype.hex=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4;return Oe[r>>28&15]+Oe[r>>24&15]+Oe[r>>20&15]+Oe[r>>16&15]+Oe[r>>12&15]+Oe[r>>8&15]+Oe[r>>4&15]+Oe[r&15]+Oe[e>>28&15]+Oe[e>>24&15]+Oe[e>>20&15]+Oe[e>>16&15]+Oe[e>>12&15]+Oe[e>>8&15]+Oe[e>>4&15]+Oe[e&15]+Oe[t>>28&15]+Oe[t>>24&15]+Oe[t>>20&15]+Oe[t>>16&15]+Oe[t>>12&15]+Oe[t>>8&15]+Oe[t>>4&15]+Oe[t&15]+Oe[n>>28&15]+Oe[n>>24&15]+Oe[n>>20&15]+Oe[n>>16&15]+Oe[n>>12&15]+Oe[n>>8&15]+Oe[n>>4&15]+Oe[n&15]+Oe[s>>28&15]+Oe[s>>24&15]+Oe[s>>20&15]+Oe[s>>16&15]+Oe[s>>12&15]+Oe[s>>8&15]+Oe[s>>4&15]+Oe[s&15]};cr.prototype.toString=cr.prototype.hex;cr.prototype.digest=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4;return[r>>24&255,r>>16&255,r>>8&255,r&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,n>>24&255,n>>16&255,n>>8&255,n&255,s>>24&255,s>>16&255,s>>8&255,s&255]};cr.prototype.array=cr.prototype.digest;cr.prototype.arrayBuffer=function(){this.finalize();var r=new ArrayBuffer(20),e=new DataView(r);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),r};const QB=r=>new cr(!0).update(r).hex(),Rx=(...r)=>QB(r.join("_"));class e4{}const t4=new Map;class B_ extends e4{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(Rx(e,t))??null)}async update(e,t,n){this.cache.set(Rx(e,t),n)}static global(){return new B_(t4)}}class xA extends bi{}class n4 extends xA{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new _i(this.value)]}}class r4 extends xA{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return qP(this.messages)}toChatMessages(){return this.messages}}var bo={},Ix;function s4(){if(Ix)return bo;Ix=1,bo.byteLength=o,bo.toByteArray=c,bo.fromByteArray=h;for(var r=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,i=n.length;s<i;++s)r[s]=n[s],e[n.charCodeAt(s)]=s;e[45]=62,e[95]=63;function a(f){var p=f.length;if(p%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var m=f.indexOf("=");m===-1&&(m=p);var g=m===p?0:4-m%4;return[m,g]}function o(f){var p=a(f),m=p[0],g=p[1];return(m+g)*3/4-g}function l(f,p,m){return(p+m)*3/4-m}function c(f){var p,m=a(f),g=m[0],b=m[1],_=new t(l(f,g,b)),y=0,w=b>0?g-4:g,v;for(v=0;v<w;v+=4)p=e[f.charCodeAt(v)]<<18|e[f.charCodeAt(v+1)]<<12|e[f.charCodeAt(v+2)]<<6|e[f.charCodeAt(v+3)],_[y++]=p>>16&255,_[y++]=p>>8&255,_[y++]=p&255;return b===2&&(p=e[f.charCodeAt(v)]<<2|e[f.charCodeAt(v+1)]>>4,_[y++]=p&255),b===1&&(p=e[f.charCodeAt(v)]<<10|e[f.charCodeAt(v+1)]<<4|e[f.charCodeAt(v+2)]>>2,_[y++]=p>>8&255,_[y++]=p&255),_}function u(f){return r[f>>18&63]+r[f>>12&63]+r[f>>6&63]+r[f&63]}function d(f,p,m){for(var g,b=[],_=p;_<m;_+=3)g=(f[_]<<16&16711680)+(f[_+1]<<8&65280)+(f[_+2]&255),b.push(u(g));return b.join("")}function h(f){for(var p,m=f.length,g=m%3,b=[],_=16383,y=0,w=m-g;y<w;y+=_)b.push(d(f,y,y+_>w?w:y+_));return g===1?(p=f[m-1],b.push(r[p>>2]+r[p<<4&63]+"==")):g===2&&(p=(f[m-2]<<8)+f[m-1],b.push(r[p>>10]+r[p>>4&63]+r[p<<2&63]+"=")),b.join("")}return bo}var i4=s4();const a4=Pi(i4);var o4=Object.defineProperty,l4=(r,e,t)=>e in r?o4(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,c4=(r,e,t)=>(l4(r,e+"",t),t);function u4(r,e){let t=Array.from({length:r.length},(n,s)=>({start:s,end:s+1}));for(;t.length>1;){let n=null;for(let s=0;s<t.length-1;s++){const i=r.slice(t[s].start,t[s+1].end),a=e.get(i.join(","));a!=null&&(n==null||a<n[0])&&(n=[a,s])}if(n!=null){const s=n[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function d4(r,e){return r.length===1?[e.get(r.join(","))]:u4(r,e).map(t=>e.get(r.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function h4(r){return r.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var eb=class{constructor(r,e){$(this,"specialTokens");$(this,"inverseSpecialTokens");$(this,"patStr");$(this,"textEncoder",new TextEncoder);$(this,"textDecoder",new TextDecoder("utf-8"));$(this,"rankMap",new Map);$(this,"textMap",new Map);this.patStr=r.pat_str;const t=r.bpe_ranks.split(`
`).filter(Boolean).reduce((n,s)=>{const[i,a,...o]=s.split(" "),l=Number.parseInt(a,10);return o.forEach((c,u)=>n[c]=l+u),n},{});for(const[n,s]of Object.entries(t)){const i=a4.toByteArray(n);this.rankMap.set(i.join(","),s),this.textMap.set(s,i)}this.specialTokens={...r.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[s,i])=>(n[i]=this.textEncoder.encode(s),n),{})}encode(r,e=[],t="all"){const n=new RegExp(this.patStr,"ug"),s=eb.specialTokenRegex(Object.keys(this.specialTokens)),i=[],a=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(c=>!a.has(c)):t);if(o.size>0){const c=eb.specialTokenRegex([...o]),u=r.match(c);if(u!=null)throw new Error(`The text contains a special token that is not allowed: ${u[0]}`)}let l=0;for(;;){let c=null,u=l;for(;s.lastIndex=u,c=s.exec(r),!(c==null||a.has(c[0]));)u=c.index+1;const d=(c==null?void 0:c.index)??r.length;for(const f of r.substring(l,d).matchAll(n)){const p=this.textEncoder.encode(f[0]),m=this.rankMap.get(p.join(","));if(m!=null){i.push(m);continue}i.push(...d4(p,this.rankMap))}if(c==null)break;let h=this.specialTokens[c[0]];i.push(h),l=c.index+c[0].length}return i}decode(r){const e=[];let t=0;for(let i=0;i<r.length;++i){const a=r[i],o=this.textMap.get(a)??this.inverseSpecialTokens[a];o!=null&&(e.push(o),t+=o.length)}const n=new Uint8Array(t);let s=0;for(const i of e)n.set(i,s),s+=i.length;return this.textDecoder.decode(n)}},kA=eb;c4(kA,"specialTokenRegex",r=>new RegExp(r.map(e=>h4(e)).join("|"),"g"));function f4(r){switch(r){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-preview":case"o1-preview-2024-09-12":case"o1-mini-2024-09-12":case"o3-mini":case"o3-mini-2025-01-31":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":return"o200k_base";default:throw new Error("Unknown model")}}const Ou={},p4=new D_({});async function m4(r){return r in Ou||(Ou[r]=p4.fetch(`https://tiktoken.pages.dev/js/${r}.json`).then(e=>e.json()).then(e=>new kA(e)).catch(e=>{throw delete Ou[r],e})),await Ou[r]}async function g4(r){return m4(f4(r))}const b4=r=>r.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":r.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":r.startsWith("gpt-4-32k")?"gpt-4-32k":r.startsWith("gpt-4-")?"gpt-4":r.startsWith("gpt-4o")?"gpt-4o":r;function Mc(r){return typeof r!="object"||!r?!1:!!("type"in r&&r.type==="function"&&"function"in r&&typeof r.function=="object"&&r.function&&"name"in r.function&&"parameters"in r.function)}const _4=()=>!1;class SA extends jt{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??_4(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class y4 extends SA{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...n}){const{cache:s,...i}=n;super({callbacks:e??t,...i}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof s=="object"?this.cache=s:s?this.cache=B_.global():this.cache=void 0,this.caller=new D_(n??{})}async getNumTokens(e){if(typeof e!="string")return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await g4("modelName"in this?b4(this.modelName):"gpt2")}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}return t}static _convertInputToPromptValue(e){return typeof e=="string"?new n4(e):Array.isArray(e)?new r4(e.map(Vo)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const n={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(n).filter(([a,o])=>o!==void 0).map(([a,o])=>`${a}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}class Ds extends jt{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){const n=We(t);return this.func&&await this.func(e,n),this._callWithConfig(s=>Promise.resolve(s),e,n)}async*transform(e,t){const n=We(t);let s,i=!0;for await(const a of this._transformStreamWithConfig(e,o=>o,n))if(yield a,i)if(s===void 0)s=a;else try{s=ar(s,a)}catch{s=void 0,i=!1}this.func&&s!==void 0&&await this.func(s,n)}static assign(e){return new vA(new Ka({steps:e}))}}function ki(r){var n;if(!r||typeof r!="object"||Array.isArray(r))return!1;const e=r;return e._def||Object.values(He.ZodFirstPartyTypeKind).includes(((n=e.constructor)==null?void 0:n.name)??"NOT_INCLUDED")?!0:typeof e.parse=="function"&&typeof e.parseAsync=="function"&&typeof e.safeParse=="function"&&typeof e.safeParseAsync=="function"}class vr extends y4{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]}),Object.defineProperty(this,"disableStreaming",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_separateRunnableConfigFromCallOptionsCompat(e){const[t,n]=super._separateRunnableConfigFromCallOptions(e);return n.signal=t.signal,[t,n]}async invoke(e,t){const n=vr._convertInputToPromptValue(e);return(await this.generatePrompt([n],t,t==null?void 0:t.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,n){throw new Error("Not implemented.")}async*_streamIterator(e,t){var n;if(this._streamResponseChunks===vr.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(e,t);else{const i=vr._convertInputToPromptValue(e).toChatMessages(),[a,o]=this._separateRunnableConfigFromCallOptionsCompat(t),l={...a.metadata,...this.getLsParams(o)},c=await an.configure(a.callbacks,this.callbacks,a.tags,this.tags,l,this.metadata,{verbose:this.verbose}),u={options:o,invocation_params:this==null?void 0:this.invocationParams(o),batch_size:1},d=await(c==null?void 0:c.handleChatModelStart(this.toJSON(),[i],a.runId,void 0,u,void 0,void 0,a.runName));let h,f;try{for await(const p of this._streamResponseChunks(i,o,d==null?void 0:d[0])){if(p.message.id==null){const m=(n=d==null?void 0:d.at(0))==null?void 0:n.runId;m!=null&&p.message._updateId(`run-${m}`)}p.message.response_metadata={...p.generationInfo,...p.message.response_metadata},yield p.message,h?h=h.concat(p):h=p,Xv(p.message)&&p.message.usage_metadata!==void 0&&(f={tokenUsage:{promptTokens:p.message.usage_metadata.input_tokens,completionTokens:p.message.usage_metadata.output_tokens,totalTokens:p.message.usage_metadata.total_tokens}})}}catch(p){throw await Promise.all((d??[]).map(m=>m==null?void 0:m.handleLLMError(p))),p}await Promise.all((d??[]).map(p=>p==null?void 0:p.handleLLMEnd({generations:[[h]],llmOutput:f})))}}getLsParams(e){const t=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:t}}async _generateUncached(e,t,n,s){var d,h;const i=e.map(f=>f.map(Vo));let a;if(s!==void 0&&s.length===i.length)a=s;else{const f={...n.metadata,...this.getLsParams(t)},p=await an.configure(n.callbacks,this.callbacks,n.tags,this.tags,f,this.metadata,{verbose:this.verbose}),m={options:t,invocation_params:this==null?void 0:this.invocationParams(t),batch_size:1};a=await(p==null?void 0:p.handleChatModelStart(this.toJSON(),i,n.runId,void 0,m,void 0,void 0,n.runName))}const o=[],l=[];if(!!(a!=null&&a[0].handlers.find(kz))&&!this.disableStreaming&&i.length===1&&this._streamResponseChunks!==vr.prototype._streamResponseChunks)try{const f=await this._streamResponseChunks(i[0],t,a==null?void 0:a[0]);let p,m;for await(const g of f){if(g.message.id==null){const b=(d=a==null?void 0:a.at(0))==null?void 0:d.runId;b!=null&&g.message._updateId(`run-${b}`)}p===void 0?p=g:p=ar(p,g),Xv(g.message)&&g.message.usage_metadata!==void 0&&(m={tokenUsage:{promptTokens:g.message.usage_metadata.input_tokens,completionTokens:g.message.usage_metadata.output_tokens,totalTokens:g.message.usage_metadata.total_tokens}})}if(p===void 0)throw new Error("Received empty response from chat model call.");o.push([p]),await(a==null?void 0:a[0].handleLLMEnd({generations:o,llmOutput:m}))}catch(f){throw await(a==null?void 0:a[0].handleLLMError(f)),f}else{const f=await Promise.allSettled(i.map((p,m)=>this._generate(p,{...t,promptIndex:m},a==null?void 0:a[m])));await Promise.all(f.map(async(p,m)=>{var g,b,_;if(p.status==="fulfilled"){const y=p.value;for(const w of y.generations){if(w.message.id==null){const v=(g=a==null?void 0:a.at(0))==null?void 0:g.runId;v!=null&&w.message._updateId(`run-${v}`)}w.message.response_metadata={...w.generationInfo,...w.message.response_metadata}}return y.generations.length===1&&(y.generations[0].message.response_metadata={...y.llmOutput,...y.generations[0].message.response_metadata}),o[m]=y.generations,l[m]=y.llmOutput,(b=a==null?void 0:a[m])==null?void 0:b.handleLLMEnd({generations:[y.generations],llmOutput:y.llmOutput})}else return await((_=a==null?void 0:a[m])==null?void 0:_.handleLLMError(p.reason)),Promise.reject(p.reason)}))}const u={generations:o,llmOutput:l.length?(h=this._combineLLMOutput)==null?void 0:h.call(this,...l):void 0};return Object.defineProperty(u,xx,{value:a?{runIds:a==null?void 0:a.map(f=>f.runId)}:void 0,configurable:!0}),u}async _generateCached({messages:e,cache:t,llmStringKey:n,parsedOptions:s,handledOptions:i}){const a=e.map(g=>g.map(Vo)),o={...i.metadata,...this.getLsParams(s)},l=await an.configure(i.callbacks,this.callbacks,i.tags,this.tags,o,this.metadata,{verbose:this.verbose}),c={options:s,invocation_params:this==null?void 0:this.invocationParams(s),batch_size:1},u=await(l==null?void 0:l.handleChatModelStart(this.toJSON(),a,i.runId,void 0,c,void 0,void 0,i.runName)),d=[],f=(await Promise.allSettled(a.map(async(g,b)=>{const _=vr._convertInputToPromptValue(g).toString(),y=await t.lookup(_,n);return y==null&&d.push(b),y}))).map((g,b)=>({result:g,runManager:u==null?void 0:u[b]})).filter(({result:g})=>g.status==="fulfilled"&&g.value!=null||g.status==="rejected"),p=[];await Promise.all(f.map(async({result:g,runManager:b},_)=>{if(g.status==="fulfilled"){const y=g.value;return p[_]=y.map(w=>("message"in w&&qh(w.message)&&rs(w.message)&&(w.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0}),w.generationInfo={...w.generationInfo,tokenUsage:{}},w)),y.length&&await(b==null?void 0:b.handleLLMNewToken(y[0].text)),b==null?void 0:b.handleLLMEnd({generations:[y]},void 0,void 0,void 0,{cached:!0})}else return await(b==null?void 0:b.handleLLMError(g.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(g.reason)}));const m={generations:p,missingPromptIndices:d,startedRunManagers:u};return Object.defineProperty(m,xx,{value:u?{runIds:u==null?void 0:u.map(g=>g.runId)}:void 0,configurable:!0}),m}async generate(e,t,n){let s;Array.isArray(t)?s={stop:t}:s=t;const i=e.map(p=>p.map(Vo)),[a,o]=this._separateRunnableConfigFromCallOptionsCompat(s);if(a.callbacks=a.callbacks??n,!this.cache)return this._generateUncached(i,o,a);const{cache:l}=this,c=this._getSerializedCacheKeyParametersForCall(o),{generations:u,missingPromptIndices:d,startedRunManagers:h}=await this._generateCached({messages:i,cache:l,llmStringKey:c,parsedOptions:o,handledOptions:a});let f={};if(d.length>0){const p=await this._generateUncached(d.map(m=>i[m]),o,a,h!==void 0?d.map(m=>h==null?void 0:h[m]):void 0);await Promise.all(p.generations.map(async(m,g)=>{const b=d[g];u[b]=m;const _=vr._convertInputToPromptValue(i[b]).toString();return l.update(_,c,m)})),f=p.llmOutput??{}}return{generations:u,llmOutput:f}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,n){const s=e.map(i=>i.toChatMessages());return this.generate(s,t,n)}async call(e,t,n){return(await this.generate([e.map(Vo)],t,n)).generations[0][0].message}async callPrompt(e,t,n){const s=e.toChatMessages();return this.call(s,t,n)}async predictMessages(e,t,n){return this.call(e,t,n)}async predict(e,t,n){const s=new _i(e),i=await this.call([s],t,n);if(typeof i.content!="string")throw new Error("Cannot use predict when output is not a string.");return i.content}withStructuredOutput(e,t){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(t!=null&&t.strict)throw new Error('"strict" mode is not supported for this model by default.');const n=e,s=t==null?void 0:t.name,i=n.description??"A function available to call.",a=t==null?void 0:t.method,o=t==null?void 0:t.includeRaw;if(a==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let l=s??"extract",c;ki(n)?c=[{type:"function",function:{name:l,description:i,parameters:js(n)}}]:("name"in n&&(l=n.name),c=[{type:"function",function:{name:l,description:i,parameters:n}}]);const u=this.bindTools(c),d=Ri.from(m=>{if(!m.tool_calls||m.tool_calls.length===0)throw new Error("No tool calls found in the response.");const g=m.tool_calls.find(b=>b.name===l);if(!g)throw new Error(`No tool call found with name ${l}.`);return g.args});if(!o)return u.pipe(d).withConfig({runName:"StructuredOutput"});const h=Ds.assign({parsed:(m,g)=>d.invoke(m.raw,g)}),f=Ds.assign({parsed:()=>null}),p=h.withFallbacks({fallbacks:[f]});return er.from([{raw:u},p]).withConfig({runName:"StructuredOutputRunnable"})}}class PA extends jt{parseResultWithPrompt(e,t,n){return this.parseResult(e,n)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(n,s)=>this.parseResult([{text:n}],s==null?void 0:s.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(n,s)=>this.parseResult([{message:n,text:this._baseMessageToString(n)}],s==null?void 0:s.callbacks),e,{...t,runType:"parser"})}}class AA extends PA{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,n){return this.parse(e,n)}_type(){throw new Error("_type not implemented")}}class Hl extends Error{constructor(e,t,n,s=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=n,this.sendToLLM=s,s&&(n===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");UP(this,"OUTPUT_PARSING_FAILURE")}}function pa(r,e){const t=typeof r;if(t!==typeof e)return!1;if(Array.isArray(r)){if(!Array.isArray(e))return!1;const n=r.length;if(n!==e.length)return!1;for(let s=0;s<n;s++)if(!pa(r[s],e[s]))return!1;return!0}if(t==="object"){if(!r||!e)return r===e;const n=Object.keys(r),s=Object.keys(e);if(n.length!==s.length)return!1;for(const a of n)if(!pa(r[a],e[a]))return!1;return!0}return r===e}function Zn(r){return encodeURI(w4(r))}function w4(r){return r.replace(/~/g,"~0").replace(/\//g,"~1")}const v4={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},x4={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},k4={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};let S4=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function sa(r,e=Object.create(null),t=S4,n=""){if(r&&typeof r=="object"&&!Array.isArray(r)){const i=r.$id||r.id;if(i){const a=new URL(i,t.href);a.hash.length>1?e[a.href]=r:(a.hash="",n===""?t=a:sa(r,e,t))}}else if(r!==!0&&r!==!1)return e;const s=t.href+(n?"#"+n:"");if(e[s]!==void 0)throw new Error(`Duplicate schema URI "${s}".`);if(e[s]=r,r===!0||r===!1)return e;if(r.__absolute_uri__===void 0&&Object.defineProperty(r,"__absolute_uri__",{enumerable:!1,value:s}),r.$ref&&r.__absolute_ref__===void 0){const i=new URL(r.$ref,t.href);i.hash=i.hash,Object.defineProperty(r,"__absolute_ref__",{enumerable:!1,value:i.href})}if(r.$recursiveRef&&r.__absolute_recursive_ref__===void 0){const i=new URL(r.$recursiveRef,t.href);i.hash=i.hash,Object.defineProperty(r,"__absolute_recursive_ref__",{enumerable:!1,value:i.href})}if(r.$anchor){const i=new URL("#"+r.$anchor,t.href);e[i.href]=r}for(let i in r){if(k4[i])continue;const a=`${n}/${Zn(i)}`,o=r[i];if(Array.isArray(o)){if(v4[i]){const l=o.length;for(let c=0;c<l;c++)sa(o[c],e,t,`${a}/${c}`)}}else if(x4[i])for(let l in o)sa(o[l],e,t,`${a}/${Zn(l)}`);else sa(o,e,t,a)}return e}const P4=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,A4=[0,31,28,31,30,31,30,31,31,30,31,30,31],E4=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,O4=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,T4=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,R4=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,I4=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,C4=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,$4=/^(?:\/(?:[^~/]|~0|~1)*)*$/,M4=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,N4=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,L4=r=>{if(r[0]==='"')return!1;const[e,t,...n]=r.split("@");return!e||!t||n.length!==0||e.length>64||t.length>253||e[0]==="."||e.endsWith(".")||e.includes("..")||!/^[a-z0-9.-]+$/i.test(t)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(e)?!1:t.split(".").every(s=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(s))},j4=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,D4=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,F4=r=>r.length>1&&r.length<80&&(/^P\d+([.,]\d+)?W$/.test(r)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(r)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(r));function fr(r){return r.test.bind(r)}const Cx={date:EA,time:OA.bind(void 0,!1),"date-time":U4,duration:F4,uri:W4,"uri-reference":fr(T4),"uri-template":fr(R4),url:fr(I4),email:L4,hostname:fr(O4),ipv4:fr(j4),ipv6:fr(D4),regex:G4,uuid:fr(C4),"json-pointer":fr($4),"json-pointer-uri-fragment":fr(M4),"relative-json-pointer":fr(N4)};function z4(r){return r%4===0&&(r%100!==0||r%400===0)}function EA(r){const e=r.match(P4);if(!e)return!1;const t=+e[1],n=+e[2],s=+e[3];return n>=1&&n<=12&&s>=1&&s<=(n==2&&z4(t)?29:A4[n])}function OA(r,e){const t=e.match(E4);if(!t)return!1;const n=+t[1],s=+t[2],i=+t[3],a=!!t[5];return(n<=23&&s<=59&&i<=59||n==23&&s==59&&i==60)&&(!r||a)}const B4=/t|\s/i;function U4(r){const e=r.split(B4);return e.length==2&&EA(e[0])&&OA(!0,e[1])}const q4=/\/|:/,H4=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function W4(r){return q4.test(r)&&H4.test(r)}const V4=/[^\\]\\Z/;function G4(r){if(V4.test(r))return!1;try{return new RegExp(r,"u"),!0}catch{return!1}}function Z4(r){let e=0,t=r.length,n=0,s;for(;n<t;)e++,s=r.charCodeAt(n++),s>=55296&&s<=56319&&n<t&&(s=r.charCodeAt(n),(s&64512)==56320&&n++);return e}function ft(r,e,t="2019-09",n=sa(e),s=!0,i=null,a="#",o="#",l=Object.create(null)){if(e===!0)return{valid:!0,errors:[]};if(e===!1)return{valid:!1,errors:[{instanceLocation:a,keyword:"false",keywordLocation:a,error:"False boolean schema."}]};const c=typeof r;let u;switch(c){case"boolean":case"number":case"string":u=c;break;case"object":r===null?u="null":Array.isArray(r)?u="array":u="object";break;default:throw new Error(`Instances of "${c}" type are not supported.`)}const{$ref:d,$recursiveRef:h,$recursiveAnchor:f,type:p,const:m,enum:g,required:b,not:_,anyOf:y,allOf:w,oneOf:v,if:x,then:k,else:S,format:R,properties:D,patternProperties:M,additionalProperties:N,unevaluatedProperties:C,minProperties:A,maxProperties:E,propertyNames:O,dependentRequired:I,dependentSchemas:T,dependencies:L,prefixItems:W,items:ee,additionalItems:Z,unevaluatedItems:X,contains:U,minContains:G,maxContains:le,minItems:me,maxItems:Rt,uniqueItems:vt,minimum:ut,maximum:_t,exclusiveMinimum:Ut,exclusiveMaximum:qt,multipleOf:dn,minLength:wn,maxLength:Ir,pattern:Fc,__absolute_ref__:ss,__absolute_recursive_ref__:zc}=e,Y=[];if(f===!0&&i===null&&(i=e),h==="#"){const ge=i===null?n[zc]:i,ce=`${o}/$recursiveRef`,we=ft(r,i===null?e:i,t,n,s,ge,a,ce,l);we.valid||Y.push({instanceLocation:a,keyword:"$recursiveRef",keywordLocation:ce,error:"A subschema had errors."},...we.errors)}if(d!==void 0){const ce=n[ss||d];if(ce===void 0){let J=`Unresolved $ref "${d}".`;throw ss&&ss!==d&&(J+=`  Absolute URI "${ss}".`),J+=`
Known schemas:
- ${Object.keys(n).join(`
- `)}`,new Error(J)}const we=`${o}/$ref`,te=ft(r,ce,t,n,s,i,a,we,l);if(te.valid||Y.push({instanceLocation:a,keyword:"$ref",keywordLocation:we,error:"A subschema had errors."},...te.errors),t==="4"||t==="7")return{valid:Y.length===0,errors:Y}}if(Array.isArray(p)){let ge=p.length,ce=!1;for(let we=0;we<ge;we++)if(u===p[we]||p[we]==="integer"&&u==="number"&&r%1===0&&r===r){ce=!0;break}ce||Y.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${p.join('", "')}".`})}else p==="integer"?(u!=="number"||r%1||r!==r)&&Y.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${p}".`}):p!==void 0&&u!==p&&Y.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${p}".`});if(m!==void 0&&(u==="object"||u==="array"?pa(r,m)||Y.push({instanceLocation:a,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(m)}.`}):r!==m&&Y.push({instanceLocation:a,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(m)}.`})),g!==void 0&&(u==="object"||u==="array"?g.some(ge=>pa(r,ge))||Y.push({instanceLocation:a,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`}):g.some(ge=>r===ge)||Y.push({instanceLocation:a,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`})),_!==void 0){const ge=`${o}/not`;ft(r,_,t,n,s,i,a,ge).valid&&Y.push({instanceLocation:a,keyword:"not",keywordLocation:ge,error:'Instance matched "not" schema.'})}let is=[];if(y!==void 0){const ge=`${o}/anyOf`,ce=Y.length;let we=!1;for(let te=0;te<y.length;te++){const J=y[te],be=Object.create(l),_e=ft(r,J,t,n,s,f===!0?i:null,a,`${ge}/${te}`,be);Y.push(..._e.errors),we=we||_e.valid,_e.valid&&is.push(be)}we?Y.length=ce:Y.splice(ce,0,{instanceLocation:a,keyword:"anyOf",keywordLocation:ge,error:"Instance does not match any subschemas."})}if(w!==void 0){const ge=`${o}/allOf`,ce=Y.length;let we=!0;for(let te=0;te<w.length;te++){const J=w[te],be=Object.create(l),_e=ft(r,J,t,n,s,f===!0?i:null,a,`${ge}/${te}`,be);Y.push(..._e.errors),we=we&&_e.valid,_e.valid&&is.push(be)}we?Y.length=ce:Y.splice(ce,0,{instanceLocation:a,keyword:"allOf",keywordLocation:ge,error:"Instance does not match every subschema."})}if(v!==void 0){const ge=`${o}/oneOf`,ce=Y.length,we=v.filter((te,J)=>{const be=Object.create(l),_e=ft(r,te,t,n,s,f===!0?i:null,a,`${ge}/${J}`,be);return Y.push(..._e.errors),_e.valid&&is.push(be),_e.valid}).length;we===1?Y.length=ce:Y.splice(ce,0,{instanceLocation:a,keyword:"oneOf",keywordLocation:ge,error:`Instance does not match exactly one subschema (${we} matches).`})}if((u==="object"||u==="array")&&Object.assign(l,...is),x!==void 0){const ge=`${o}/if`;if(ft(r,x,t,n,s,i,a,ge,l).valid){if(k!==void 0){const we=ft(r,k,t,n,s,i,a,`${o}/then`,l);we.valid||Y.push({instanceLocation:a,keyword:"if",keywordLocation:ge,error:'Instance does not match "then" schema.'},...we.errors)}}else if(S!==void 0){const we=ft(r,S,t,n,s,i,a,`${o}/else`,l);we.valid||Y.push({instanceLocation:a,keyword:"if",keywordLocation:ge,error:'Instance does not match "else" schema.'},...we.errors)}}if(u==="object"){if(b!==void 0)for(const te of b)te in r||Y.push({instanceLocation:a,keyword:"required",keywordLocation:`${o}/required`,error:`Instance does not have required property "${te}".`});const ge=Object.keys(r);if(A!==void 0&&ge.length<A&&Y.push({instanceLocation:a,keyword:"minProperties",keywordLocation:`${o}/minProperties`,error:`Instance does not have at least ${A} properties.`}),E!==void 0&&ge.length>E&&Y.push({instanceLocation:a,keyword:"maxProperties",keywordLocation:`${o}/maxProperties`,error:`Instance does not have at least ${E} properties.`}),O!==void 0){const te=`${o}/propertyNames`;for(const J in r){const be=`${a}/${Zn(J)}`,_e=ft(J,O,t,n,s,i,be,te);_e.valid||Y.push({instanceLocation:a,keyword:"propertyNames",keywordLocation:te,error:`Property name "${J}" does not match schema.`},..._e.errors)}}if(I!==void 0){const te=`${o}/dependantRequired`;for(const J in I)if(J in r){const be=I[J];for(const _e of be)_e in r||Y.push({instanceLocation:a,keyword:"dependentRequired",keywordLocation:te,error:`Instance has "${J}" but does not have "${_e}".`})}}if(T!==void 0)for(const te in T){const J=`${o}/dependentSchemas`;if(te in r){const be=ft(r,T[te],t,n,s,i,a,`${J}/${Zn(te)}`,l);be.valid||Y.push({instanceLocation:a,keyword:"dependentSchemas",keywordLocation:J,error:`Instance has "${te}" but does not match dependant schema.`},...be.errors)}}if(L!==void 0){const te=`${o}/dependencies`;for(const J in L)if(J in r){const be=L[J];if(Array.isArray(be))for(const _e of be)_e in r||Y.push({instanceLocation:a,keyword:"dependencies",keywordLocation:te,error:`Instance has "${J}" but does not have "${_e}".`});else{const _e=ft(r,be,t,n,s,i,a,`${te}/${Zn(J)}`);_e.valid||Y.push({instanceLocation:a,keyword:"dependencies",keywordLocation:te,error:`Instance has "${J}" but does not match dependant schema.`},..._e.errors)}}}const ce=Object.create(null);let we=!1;if(D!==void 0){const te=`${o}/properties`;for(const J in D){if(!(J in r))continue;const be=`${a}/${Zn(J)}`,_e=ft(r[J],D[J],t,n,s,i,be,`${te}/${Zn(J)}`);if(_e.valid)l[J]=ce[J]=!0;else if(we=s,Y.push({instanceLocation:a,keyword:"properties",keywordLocation:te,error:`Property "${J}" does not match schema.`},..._e.errors),we)break}}if(!we&&M!==void 0){const te=`${o}/patternProperties`;for(const J in M){const be=new RegExp(J,"u"),_e=M[J];for(const Ht in r){if(!be.test(Ht))continue;const Bc=`${a}/${Zn(Ht)}`,Uc=ft(r[Ht],_e,t,n,s,i,Bc,`${te}/${Zn(J)}`);Uc.valid?l[Ht]=ce[Ht]=!0:(we=s,Y.push({instanceLocation:a,keyword:"patternProperties",keywordLocation:te,error:`Property "${Ht}" matches pattern "${J}" but does not match associated schema.`},...Uc.errors))}}}if(!we&&N!==void 0){const te=`${o}/additionalProperties`;for(const J in r){if(ce[J])continue;const be=`${a}/${Zn(J)}`,_e=ft(r[J],N,t,n,s,i,be,te);_e.valid?l[J]=!0:(we=s,Y.push({instanceLocation:a,keyword:"additionalProperties",keywordLocation:te,error:`Property "${J}" does not match additional properties schema.`},..._e.errors))}}else if(!we&&C!==void 0){const te=`${o}/unevaluatedProperties`;for(const J in r)if(!l[J]){const be=`${a}/${Zn(J)}`,_e=ft(r[J],C,t,n,s,i,be,te);_e.valid?l[J]=!0:Y.push({instanceLocation:a,keyword:"unevaluatedProperties",keywordLocation:te,error:`Property "${J}" does not match unevaluated properties schema.`},..._e.errors)}}}else if(u==="array"){Rt!==void 0&&r.length>Rt&&Y.push({instanceLocation:a,keyword:"maxItems",keywordLocation:`${o}/maxItems`,error:`Array has too many items (${r.length} > ${Rt}).`}),me!==void 0&&r.length<me&&Y.push({instanceLocation:a,keyword:"minItems",keywordLocation:`${o}/minItems`,error:`Array has too few items (${r.length} < ${me}).`});const ge=r.length;let ce=0,we=!1;if(W!==void 0){const te=`${o}/prefixItems`,J=Math.min(W.length,ge);for(;ce<J;ce++){const be=ft(r[ce],W[ce],t,n,s,i,`${a}/${ce}`,`${te}/${ce}`);if(l[ce]=!0,!be.valid&&(we=s,Y.push({instanceLocation:a,keyword:"prefixItems",keywordLocation:te,error:"Items did not match schema."},...be.errors),we))break}}if(ee!==void 0){const te=`${o}/items`;if(Array.isArray(ee)){const J=Math.min(ee.length,ge);for(;ce<J;ce++){const be=ft(r[ce],ee[ce],t,n,s,i,`${a}/${ce}`,`${te}/${ce}`);if(l[ce]=!0,!be.valid&&(we=s,Y.push({instanceLocation:a,keyword:"items",keywordLocation:te,error:"Items did not match schema."},...be.errors),we))break}}else for(;ce<ge;ce++){const J=ft(r[ce],ee,t,n,s,i,`${a}/${ce}`,te);if(l[ce]=!0,!J.valid&&(we=s,Y.push({instanceLocation:a,keyword:"items",keywordLocation:te,error:"Items did not match schema."},...J.errors),we))break}if(!we&&Z!==void 0){const J=`${o}/additionalItems`;for(;ce<ge;ce++){const be=ft(r[ce],Z,t,n,s,i,`${a}/${ce}`,J);l[ce]=!0,be.valid||(we=s,Y.push({instanceLocation:a,keyword:"additionalItems",keywordLocation:J,error:"Items did not match additional items schema."},...be.errors))}}}if(U!==void 0)if(ge===0&&G===void 0)Y.push({instanceLocation:a,keyword:"contains",keywordLocation:`${o}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(G!==void 0&&ge<G)Y.push({instanceLocation:a,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array has less items (${ge}) than minContains (${G}).`});else{const te=`${o}/contains`,J=Y.length;let be=0;for(let _e=0;_e<ge;_e++){const Ht=ft(r[_e],U,t,n,s,i,`${a}/${_e}`,te);Ht.valid?(l[_e]=!0,be++):Y.push(...Ht.errors)}be>=(G||0)&&(Y.length=J),G===void 0&&le===void 0&&be===0?Y.splice(J,0,{instanceLocation:a,keyword:"contains",keywordLocation:te,error:"Array does not contain item matching schema."}):G!==void 0&&be<G?Y.push({instanceLocation:a,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array must contain at least ${G} items matching schema. Only ${be} items were found.`}):le!==void 0&&be>le&&Y.push({instanceLocation:a,keyword:"maxContains",keywordLocation:`${o}/maxContains`,error:`Array may contain at most ${le} items matching schema. ${be} items were found.`})}if(!we&&X!==void 0){const te=`${o}/unevaluatedItems`;for(ce;ce<ge;ce++){if(l[ce])continue;const J=ft(r[ce],X,t,n,s,i,`${a}/${ce}`,te);l[ce]=!0,J.valid||Y.push({instanceLocation:a,keyword:"unevaluatedItems",keywordLocation:te,error:"Items did not match unevaluated items schema."},...J.errors)}}if(vt)for(let te=0;te<ge;te++){const J=r[te],be=typeof J=="object"&&J!==null;for(let _e=0;_e<ge;_e++){if(te===_e)continue;const Ht=r[_e];(J===Ht||be&&(typeof Ht=="object"&&Ht!==null)&&pa(J,Ht))&&(Y.push({instanceLocation:a,keyword:"uniqueItems",keywordLocation:`${o}/uniqueItems`,error:`Duplicate items at indexes ${te} and ${_e}.`}),te=Number.MAX_SAFE_INTEGER,_e=Number.MAX_SAFE_INTEGER)}}}else if(u==="number"){if(t==="4"?(ut!==void 0&&(Ut===!0&&r<=ut||r<ut)&&Y.push({instanceLocation:a,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${r} is less than ${Ut?"or equal to ":""} ${ut}.`}),_t!==void 0&&(qt===!0&&r>=_t||r>_t)&&Y.push({instanceLocation:a,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${r} is greater than ${qt?"or equal to ":""} ${_t}.`})):(ut!==void 0&&r<ut&&Y.push({instanceLocation:a,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${r} is less than ${ut}.`}),_t!==void 0&&r>_t&&Y.push({instanceLocation:a,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${r} is greater than ${_t}.`}),Ut!==void 0&&r<=Ut&&Y.push({instanceLocation:a,keyword:"exclusiveMinimum",keywordLocation:`${o}/exclusiveMinimum`,error:`${r} is less than ${Ut}.`}),qt!==void 0&&r>=qt&&Y.push({instanceLocation:a,keyword:"exclusiveMaximum",keywordLocation:`${o}/exclusiveMaximum`,error:`${r} is greater than or equal to ${qt}.`})),dn!==void 0){const ge=r%dn;Math.abs(0-ge)>=11920929e-14&&Math.abs(dn-ge)>=11920929e-14&&Y.push({instanceLocation:a,keyword:"multipleOf",keywordLocation:`${o}/multipleOf`,error:`${r} is not a multiple of ${dn}.`})}}else if(u==="string"){const ge=wn===void 0&&Ir===void 0?0:Z4(r);wn!==void 0&&ge<wn&&Y.push({instanceLocation:a,keyword:"minLength",keywordLocation:`${o}/minLength`,error:`String is too short (${ge} < ${wn}).`}),Ir!==void 0&&ge>Ir&&Y.push({instanceLocation:a,keyword:"maxLength",keywordLocation:`${o}/maxLength`,error:`String is too long (${ge} > ${Ir}).`}),Fc!==void 0&&!new RegExp(Fc,"u").test(r)&&Y.push({instanceLocation:a,keyword:"pattern",keywordLocation:`${o}/pattern`,error:"String does not match pattern."}),R!==void 0&&Cx[R]&&!Cx[R](r)&&Y.push({instanceLocation:a,keyword:"format",keywordLocation:`${o}/format`,error:`String does not match format "${R}".`})}return{valid:Y.length===0,errors:Y}}class J4 extends AA{async*_transform(e){for await(const t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}class TA extends J4{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=(e==null?void 0:e.diff)??this.diff}async*_transform(e){let t,n;for await(const s of e){if(typeof s!="string"&&typeof s.content!="string")throw new Error("Cannot handle non-string output.");let i;if(Oj(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new lr({message:s,text:s.content})}else if(qh(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new lr({message:$j(s),text:s.content})}else i=new Na({text:s});n===void 0?n=i:n=n.concat(i);const a=await this.parsePartialResult([n]);a!=null&&!pa(a,t)&&(this.diff?yield this._diff(t,a):yield a,t=a)}}getFormatInstructions(){return""}}class Kd extends AA{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const t=He.object(Object.fromEntries(Object.entries(e).map(([n,s])=>[n,He.string().describe(s)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(js(this.schema))}
\`\`\`
`}async parse(e){try{const n=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(s,i)=>`"${i.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await this.schema.parseAsync(JSON.parse(n))}catch(t){throw new Hl(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}}class Xd extends TA{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,t){if(t)return e?mz(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return Gv(e[0].text)}async parse(e){return Gv(e,JSON.parse)}getFormatInstructions(){return""}}function Nc(r,e){if(r.function===void 0)return;let t;if(e!=null&&e.partial)try{t=A_(r.function.arguments??"{}")}catch{return}else try{t=JSON.parse(r.function.arguments)}catch(s){throw new Hl([`Function "${r.function.name}" arguments:`,"",r.function.arguments,"","are not valid JSON.",`Error: ${s.message}`].join(`
`))}const n={name:r.function.name,args:t,type:"tool_call"};return e!=null&&e.returnId&&(n.id=r.id),n}function RA(r){if(r.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:r.id,type:"function",function:{name:r.name,arguments:JSON.stringify(r.args)}}}function Qh(r,e){var t,n;return{name:(t=r.function)==null?void 0:t.name,args:(n=r.function)==null?void 0:n.arguments,id:r.id,error:e,type:"invalid_tool_call"}}class K4 extends TA{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=(e==null?void 0:e.returnId)??this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){var a;const n=e[0].message;let s;if(rs(n)&&((a=n.tool_calls)!=null&&a.length)?s=n.tool_calls.map(o=>{const{id:l,...c}=o;return this.returnId?{id:l,...c}:c}):n.additional_kwargs.tool_calls!==void 0&&(s=JSON.parse(JSON.stringify(n.additional_kwargs.tool_calls)).map(l=>Nc(l,{returnId:this.returnId,partial:t}))),!s)return[];const i=[];for(const o of s)if(o!==void 0){const l={type:o.name,args:o.args,id:o.id};i.push(l)}return i}}class Yd extends K4{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;const t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new Hl(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){const n=(await super.parsePartialResult(e)).filter(i=>i.type===this.keyName);let s=n;if(n.length)return this.returnId||(s=n.map(i=>i.args)),this.returnSingle?s[0]:s}async parseResult(e){const n=(await super.parsePartialResult(e,!1)).filter(a=>a.type===this.keyName);let s=n;return n.length?(this.returnId||(s=n.map(a=>a.args)),this.returnSingle?this._validateResult(s[0]):await Promise.all(s.map(a=>this._validateResult(a)))):void 0}}const X4=Symbol("Let zodToJsonSchema decide on which parser to use"),$x={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Y4=r=>typeof r=="string"?{...$x,basePath:["#"],definitions:{},name:r}:{...$x,basePath:["#"],definitions:{},...r},tb=r=>"_def"in r?r._def:r;function Q4(r){if(!r)return!0;for(const e in r)return!1;return!0}const eU=r=>{const e=Y4(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[tb(s),{def:tb(s),path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function IA(r,e,t,n){n!=null&&n.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function Xe(r,e,t,n,s){r[e]=t,IA(r,e,n,s)}function tU(){return{}}function nU(r,e){var n,s;const t={type:"array"};return((s=(n=r.type)==null?void 0:n._def)==null?void 0:s.typeName)!==j.ZodAny&&(t.items=qe(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&Xe(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&Xe(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(Xe(t,"minItems",r.exactLength.value,r.exactLength.message,e),Xe(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function rU(r,e){const t={type:"integer",format:"int64"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?Xe(t,"minimum",n.value,n.message,e):Xe(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Xe(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Xe(t,"maximum",n.value,n.message,e):Xe(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Xe(t,"maximum",n.value,n.message,e));break;case"multipleOf":Xe(t,"multipleOf",n.value,n.message,e);break}return t}function sU(){return{type:"boolean"}}function iU(r,e){return qe(r.type._def,e)}const aU=(r,e)=>qe(r.innerType._def,e);function CA(r,e,t){const n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((s,i)=>CA(r,e,s))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return oU(r,e)}}const oU=(r,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const n of r.checks)switch(n.kind){case"min":Xe(t,"minimum",n.value,n.message,e);break;case"max":Xe(t,"maximum",n.value,n.message,e);break}return t};function lU(r,e){return{...qe(r.innerType._def,e),default:r.defaultValue()}}function cU(r,e,t){return e.effectStrategy==="input"?qe(r.schema._def,e,t):{}}function uU(r){return{type:"string",enum:[...r.values]}}const dU=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function hU(r,e){const t=[qe(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),qe(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(i=>{if(dU(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(n=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...l}=i;a=l}else n=void 0;s.push(a)}}),s.length?{allOf:s,...n}:void 0}function fU(r,e){const t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}let wm;const Xs={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(wm===void 0&&(wm=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),wm),base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function $A(r,e){const t={type:"string"};function n(s){return e.patternStrategy==="escape"?pU(s):s}if(r.checks)for(const s of r.checks)switch(s.kind){case"min":Xe(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e);break;case"max":Xe(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Wn(t,"email",s.message,e);break;case"format:idn-email":Wn(t,"idn-email",s.message,e);break;case"pattern:zod":Vn(t,Xs.email,s.message,e);break}break;case"url":Wn(t,"uri",s.message,e);break;case"uuid":Wn(t,"uuid",s.message,e);break;case"regex":Vn(t,s.regex,s.message,e);break;case"cuid":Vn(t,Xs.cuid,s.message,e);break;case"cuid2":Vn(t,Xs.cuid2,s.message,e);break;case"startsWith":Vn(t,RegExp(`^${n(s.value)}`),s.message,e);break;case"endsWith":Vn(t,RegExp(`${n(s.value)}$`),s.message,e);break;case"datetime":Wn(t,"date-time",s.message,e);break;case"date":Wn(t,"date",s.message,e);break;case"time":Wn(t,"time",s.message,e);break;case"duration":Wn(t,"duration",s.message,e);break;case"length":Xe(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e),Xe(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"includes":{Vn(t,RegExp(n(s.value)),s.message,e);break}case"ip":{s.version!=="v6"&&Wn(t,"ipv4",s.message,e),s.version!=="v4"&&Wn(t,"ipv6",s.message,e);break}case"emoji":Vn(t,Xs.emoji,s.message,e);break;case"ulid":{Vn(t,Xs.ulid,s.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Wn(t,"binary",s.message,e);break}case"contentEncoding:base64":{Xe(t,"contentEncoding","base64",s.message,e);break}case"pattern:zod":{Vn(t,Xs.base64,s.message,e);break}}break}case"nanoid":Vn(t,Xs.nanoid,s.message,e)}return t}const pU=r=>Array.from(r).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),Wn=(r,e,t,n)=>{var s;r.format||(s=r.anyOf)!=null&&s.some(i=>i.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):Xe(r,"format",e,t,n)},Vn=(r,e,t,n)=>{var s;r.pattern||(s=r.allOf)!=null&&s.some(i=>i.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:Mx(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):Xe(r,"pattern",Mx(e,n),t,n)},Mx=(r,e)=>{var c;const t=typeof r=="function"?r():r;if(!e.applyRegexFlags||!t.flags)return t.source;const n={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},s=n.i?t.source.toLowerCase():t.source;let i="",a=!1,o=!1,l=!1;for(let u=0;u<s.length;u++){if(a){i+=s[u],a=!1;continue}if(n.i){if(o){if(s[u].match(/[a-z]/)){l?(i+=s[u],i+=`${s[u-2]}-${s[u]}`.toUpperCase(),l=!1):s[u+1]==="-"&&((c=s[u+2])!=null&&c.match(/[a-z]/))?(i+=s[u],l=!0):i+=`${s[u]}${s[u].toUpperCase()}`;continue}}else if(s[u].match(/[a-z]/)){i+=`[${s[u]}${s[u].toUpperCase()}]`;continue}}if(n.m){if(s[u]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(s[u]==="$"){i+=`($|(?=[\r
]))`;continue}}if(n.s&&s[u]==="."){i+=o?`${s[u]}\r
`:`[${s[u]}\r
]`;continue}i+=s[u],s[u]==="\\"?a=!0:o&&s[u]==="]"?o=!1:!o&&s[u]==="["&&(o=!0)}try{const u=new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return i};function MA(r,e){var n,s,i,a;if(e.target==="openApi3"&&((n=r.keyType)==null?void 0:n._def.typeName)===j.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((o,l)=>({...o,[l]:qe(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",l]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:qe(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((s=r.keyType)==null?void 0:s._def.typeName)===j.ZodString&&((i=r.keyType._def.checks)!=null&&i.length)){const o=Object.entries($A(r.keyType._def,e)).reduce((l,[c,u])=>c==="type"?l:{...l,[c]:u},{});return{...t,propertyNames:o}}else if(((a=r.keyType)==null?void 0:a._def.typeName)===j.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};return t}function mU(r,e){if(e.mapStrategy==="record")return MA(r,e);const t=qe(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=qe(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function gU(r){const e=r.values,n=Object.keys(r.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(n.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function bU(){return{not:{}}}function _U(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Qd={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function yU(r,e){if(e.target==="openApi3")return Nx(r,e);const t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in Qd&&(!n._def.checks||!n._def.checks.length))){const n=t.reduce((s,i)=>{const a=Qd[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=t.reduce((s,i)=>{const a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===t.length){const s=n.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,s)=>[...n,...s._def.values.filter(i=>!n.includes(i))],[])};return Nx(r,e)}const Nx=(r,e)=>{const t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,s)=>qe(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function wU(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:Qd[r.innerType._def.typeName],nullable:!0}:{type:[Qd[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=qe(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const t=qe(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function vU(r,e){const t={type:"number"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"int":t.type="integer",IA(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?Xe(t,"minimum",n.value,n.message,e):Xe(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Xe(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Xe(t,"maximum",n.value,n.message,e):Xe(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Xe(t,"maximum",n.value,n.message,e));break;case"multipleOf":Xe(t,"multipleOf",n.value,n.message,e);break}return t}function xU(r,e){return e.removeAdditionalStrategy==="strict"?r.catchall._def.typeName==="ZodNever"?r.unknownKeys!=="strict":qe(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":qe(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function kU(r,e){const t={type:"object",...Object.entries(r.shape()).reduce((n,[s,i])=>{if(i===void 0||i._def===void 0)return n;const a=qe(i._def,{...e,currentPath:[...e.currentPath,"properties",s],propertyPath:[...e.currentPath,"properties",s]});return a===void 0?n:{properties:{...n.properties,[s]:a},required:i.isOptional()&&!e.openaiStrictMode?n.required:[...n.required,s]}},{properties:{},required:[]}),additionalProperties:xU(r,e)};return t.required.length||delete t.required,t}const SU=(r,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return qe(r.innerType._def,e);const t=qe(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},PU=(r,e)=>{if(e.pipeStrategy==="input")return qe(r.in._def,e);if(e.pipeStrategy==="output")return qe(r.out._def,e);const t=qe(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=qe(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(s=>s!==void 0)}};function AU(r,e){return qe(r.type._def,e)}function EU(r,e){const n={type:"array",uniqueItems:!0,items:qe(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&Xe(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&Xe(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function OU(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>qe(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:qe(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>qe(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function TU(){return{not:{}}}function RU(){return{}}const IU=(r,e)=>qe(r.innerType._def,e);function qe(r,e,t=!1){var a;const n=e.seen.get(r);if(e.override){const o=(a=e.override)==null?void 0:a.call(e,r,e,n,t);if(o!==X4)return o}if(n&&!t){const o=CU(n,e);if(o!==void 0)return"$ref"in o&&e.seenRefs.add(o.$ref),o}const s={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,s);const i=MU(r,r.typeName,e,t);return i&&NU(r,e,i),s.jsonSchema=i,i}const CU=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"extract-to-root":const t=r.path.slice(e.basePath.length+1).join("_");return t!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[t]=r.def),{$ref:[...e.basePath,e.definitionPath,t].join("/")};case"relative":return{$ref:$U(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((n,s)=>e.currentPath[s]===n)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},$U=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},MU=(r,e,t,n)=>{switch(e){case j.ZodString:return $A(r,t);case j.ZodNumber:return vU(r,t);case j.ZodObject:return kU(r,t);case j.ZodBigInt:return rU(r,t);case j.ZodBoolean:return sU();case j.ZodDate:return CA(r,t);case j.ZodUndefined:return TU();case j.ZodNull:return _U(t);case j.ZodArray:return nU(r,t);case j.ZodUnion:case j.ZodDiscriminatedUnion:return yU(r,t);case j.ZodIntersection:return hU(r,t);case j.ZodTuple:return OU(r,t);case j.ZodRecord:return MA(r,t);case j.ZodLiteral:return fU(r,t);case j.ZodEnum:return uU(r);case j.ZodNativeEnum:return gU(r);case j.ZodNullable:return wU(r,t);case j.ZodOptional:return SU(r,t);case j.ZodMap:return mU(r,t);case j.ZodSet:return EU(r,t);case j.ZodLazy:return qe(r.getter()._def,t);case j.ZodPromise:return AU(r,t);case j.ZodNaN:case j.ZodNever:return bU();case j.ZodEffects:return cU(r,t,n);case j.ZodAny:return tU();case j.ZodUnknown:return RU();case j.ZodDefault:return lU(r,t);case j.ZodBranded:return iU(r,t);case j.ZodReadonly:return IU(r,t);case j.ZodCatch:return aU(r,t);case j.ZodPipeline:return PU(r,t);case j.ZodFunction:case j.ZodVoid:case j.ZodSymbol:return;default:return(s=>{})()}},NU=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t),LU=(r,e)=>{const t=eU(e),n=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,s=qe(r._def,n===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,n]},!1)??{},i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(s.title=i);const a=(()=>{if(Q4(t.definitions))return;const l={},c=new Set;for(let u=0;u<500;u++){const d=Object.entries(t.definitions).filter(([h])=>!c.has(h));if(d.length===0)break;for(const[h,f]of d)l[h]=qe(tb(f),{...t,currentPath:[...t.basePath,t.definitionPath,h]},!0)??{},c.add(h)}return l})(),o=n===void 0?a?{...s,[t.definitionPath]:a}:s:t.nameStrategy==="duplicate-ref"?{...s,...a||t.seenRefs.size?{[t.definitionPath]:{...a,...t.seenRefs.size?{[n]:s}:void 0}}:void 0}:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,n].join("/"),[t.definitionPath]:{...a,[n]:s}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function NA(r,e){return LU(r,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function LA(r,e,t){return J2({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:NA(r,{name:e})}},n=>r.parse(JSON.parse(n)))}function jU(r){return K2({type:"function",function:{name:r.name,parameters:NA(r.parameters,{name:r.name}),strict:!0,...r.description?{description:r.description}:void 0}},{callback:r.function,parser:e=>r.parameters.parse(JSON.parse(e))})}function DU(r){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:n,azureOpenAIBasePath:s,baseURL:i,azureADTokenProvider:a,azureOpenAIEndpoint:o}=r;if((n||a)&&s&&e)return`${s}/${e}`;if((n||a)&&o&&e)return`${o}/openai/deployments/${e}`;if(n||a){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return i}function FU(r){return r!==void 0&&Array.isArray(r.lc_namespace)}function zU(r){return r!==void 0&&jt.isRunnable(r)&&"lc_name"in r.constructor&&typeof r.constructor.lc_name=="function"&&r.constructor.lc_name()==="RunnableToolLike"}function BU(r){return!!r&&typeof r=="object"&&"name"in r&&"schema"in r&&ki(r.schema)}function ef(r){return BU(r)||zU(r)||FU(r)}function UU(r){return ki(r)?js(r):r}function _d(r){if(!r||typeof r!="object"||Object.keys(r).length===0||Array.isArray(r))return!1;if("type"in r)return typeof r.type=="string"?r.type==="string":Array.isArray(r.type)?r.type.every(e=>e==="string"):!1;if("enum"in r)return Array.isArray(r.enum)&&r.enum.length>0&&r.enum.every(e=>typeof e=="string");if("const"in r)return typeof r.const=="string";if("allOf"in r&&Array.isArray(r.allOf))return r.allOf.some(e=>_d(e));if("anyOf"in r&&Array.isArray(r.anyOf)||"oneOf"in r&&Array.isArray(r.oneOf)){const e="anyOf"in r?r.anyOf:r.oneOf;return e.length>0&&e.every(t=>_d(t))}if("not"in r)return!1;if("$ref"in r&&typeof r.$ref=="string"){const e=r.$ref,t=sa(r);return t[e]?_d(t[e]):!1}return!1}function jA(r,e){const t=typeof e=="number"?void 0:e;return{name:r.name,description:r.description,parameters:UU(r.schema),...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}}function qU(r,e){let t;return ef(r)?t={type:"function",function:jA(r)}:t=r,t}function Tu(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function vm(r){let e;return r.constructor.name===wc.name?(e=new Error(r.message),e.name="TimeoutError"):r.constructor.name===bn.name?(e=new Error(r.message),e.name="AbortError"):r.status===400&&r.message.includes("tool_calls")?e=Tu(r,"INVALID_TOOL_RESULTS"):r.status===401?e=Tu(r,"MODEL_AUTHENTICATION"):r.status===429?e=Tu(r,"MODEL_RATE_LIMIT"):r.status===404?e=Tu(r,"MODEL_NOT_FOUND"):e=r,e}function Lx(r){if(r)return r==="any"||r==="required"?"required":r==="auto"?"auto":r==="none"?"none":typeof r=="string"?{type:"function",function:{name:r}}:r}function HU(r){return r.anyOf!==void 0&&Array.isArray(r.anyOf)}function WU(r){const e=["namespace functions {",""];for(const t of r)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(DA(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function DA(r,e){var n;const t=[];for(const[s,i]of Object.entries(r.properties??{}))i.description&&e<2&&t.push(`// ${i.description}`),(n=r.required)!=null&&n.includes(s)?t.push(`${s}: ${eh(i,e)},`):t.push(`${s}?: ${eh(i,e)},`);return t.map(s=>" ".repeat(e)+s).join(`
`)}function eh(r,e){if(HU(r))return r.anyOf.map(t=>eh(t,e)).join(" | ");switch(r.type){case"string":return r.enum?r.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",DA(r,e+2),"}"].join(`
`);case"array":return r.items?`${eh(r.items,e)}[]`:"any[]";default:return""}}function VU(r,e){let t;return ef(r)?t=qU(r):t=r,(e==null?void 0:e.strict)!==void 0&&(t.function.strict=e.strict),t}function GU(r){return r.role!=="system"&&r.role!=="developer"&&r.role!=="assistant"&&r.role!=="user"&&r.role!=="function"&&r.role!=="tool"&&console.warn(`Unknown message role: ${r.role}`),r.role}function U_(r){const e=r._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!Ti.isInstance(r))throw new Error("Invalid generic chat message");return GU(r)}default:throw new Error(`Unknown message type: ${e}`)}}function jx(r,e){return r.flatMap(t=>{var i;let n=U_(t);n==="system"&&q_(e)&&(n="developer");const s={role:n,content:t.content};if(t.name!=null&&(s.name=t.name),t.additional_kwargs.function_call!=null&&(s.function_call=t.additional_kwargs.function_call,s.content=""),rs(t)&&((i=t.tool_calls)!=null&&i.length)?(s.tool_calls=t.tool_calls.map(RA),s.content=""):(t.additional_kwargs.tool_calls!=null&&(s.tool_calls=t.additional_kwargs.tool_calls),t.tool_call_id!=null&&(s.tool_call_id=t.tool_call_id)),t.additional_kwargs.audio&&typeof t.additional_kwargs.audio=="object"&&"id"in t.additional_kwargs.audio){const a={role:"assistant",audio:{id:t.additional_kwargs.audio.id}};return[s,a]}return s})}const ia="__openai_function_call_ids__";function Dx(r,e){return r.flatMap(t=>{var i,a,o;let n=U_(t);if(n==="system"&&q_(e)&&(n="developer"),n==="function")throw new Error("Function messages are not supported in Responses API");if(n==="tool"){const l=t;return((i=l.additional_kwargs)==null?void 0:i.type)==="computer_call_output"?{type:"computer_call_output",output:(()=>{if(typeof l.content=="string")return{type:"computer_screenshot",image_url:l.content};if(Array.isArray(l.content)){const u=l.content.find(h=>h.type==="computer_screenshot");if(u)return u;const d=l.content.find(h=>h.type==="image_url");if(d)return{type:"computer_screenshot",image_url:typeof d.image_url=="string"?d.image_url:d.image_url.url}}throw new Error("Invalid computer call output")})(),call_id:l.tool_call_id}:{type:"function_call_output",call_id:l.tool_call_id,id:l.id,output:typeof l.content!="string"?JSON.stringify(l.content):l.content}}if(n==="assistant"){const l=[];t.additional_kwargs.reasoning!=null&&(f=>typeof f=="object"&&f!=null&&"type"in f&&f.type==="reasoning")(t.additional_kwargs.reasoning)&&l.push(t.additional_kwargs.reasoning);let{content:c}=t;t.additional_kwargs.refusal!=null&&(typeof c=="string"&&(c=[{type:"output_text",text:c,annotations:[]}]),c=[...c,{type:"refusal",refusal:t.additional_kwargs.refusal}]),l.push({type:"message",role:"assistant",content:typeof c=="string"?c:c.flatMap(h=>h.type==="text"?{type:"output_text",text:h.text,annotations:h.annotations??[]}:h.type==="output_text"||h.type==="refusal"?h:[])});const u=t.additional_kwargs[ia];rs(t)&&((a=t.tool_calls)!=null&&a.length)?l.push(...t.tool_calls.map(h=>({type:"function_call",name:h.name,arguments:JSON.stringify(h.args),call_id:h.id,id:u==null?void 0:u[h.id]}))):t.additional_kwargs.tool_calls!=null&&l.push(...t.additional_kwargs.tool_calls.map(h=>({type:"function_call",name:h.function.name,call_id:h.id,id:u==null?void 0:u[h.id],arguments:h.function.arguments})));const d=(o=t.response_metadata.output)!=null&&o.length?t.response_metadata.output:t.additional_kwargs.tool_outputs;if(d!=null){const h=d,f=h==null?void 0:h.filter(m=>m.type==="reasoning"),p=h==null?void 0:h.filter(m=>m.type==="computer_call");f.length>0&&p.length>0&&l.push(...f),p.length>0&&l.push(...p)}return l}const s=typeof t.content=="string"?t.content:t.content.flatMap(l=>{if(l.type==="text")return{type:"input_text",text:l.text};if(l.type==="image_url"){const c=typeof l.image_url=="string"?l.image_url:l.image_url.url,u=typeof l.image_url=="string"?"auto":l.image_url.detail;return{type:"input_image",image_url:c,detail:u}}return l.type==="input_text"||l.type==="input_image"||l.type==="input_file"?l:[]});return n==="user"||n==="system"||n==="developer"?{type:"message",role:n,content:s}:(console.warn(`Unsupported role found when converting to OpenAI Responses API: ${n}`),[])})}function FA(r){if(r.error){const a=new Error(r.error.message);throw a.name=r.error.code,a}const e=[],t=[],n=[],s={model:r.model,created_at:r.created_at,id:r.id,incomplete_details:r.incomplete_details,metadata:r.metadata,object:r.object,status:r.status,user:r.user,model_name:r.model},i={};for(const a of r.output)if(a.type==="message")e.push(...a.content.flatMap(o=>o.type==="output_text"?("parsed"in o&&o.parsed!=null&&(i.parsed=o.parsed),{type:"text",text:o.text,annotations:o.annotations}):o.type==="refusal"?(i.refusal=o.refusal,[]):o));else if(a.type==="function_call"){const o={function:{name:a.name,arguments:a.arguments},id:a.call_id};try{t.push(Nc(o,{returnId:!0}))}catch(l){let c;typeof l=="object"&&l!=null&&"message"in l&&typeof l.message=="string"&&(c=l.message),n.push(Qh(o,c))}i[ia]??(i[ia]={}),i[ia][a.call_id]=a.id}else a.type==="reasoning"?i.reasoning=a:(i.tool_outputs??(i.tool_outputs=[]),i.tool_outputs.push(a));return new Cn({id:r.id,content:e,tool_calls:t,invalid_tool_calls:n,usage_metadata:r.usage,additional_kwargs:i,response_metadata:s})}function ZU(r){var l,c;const e=[];let t={},n;const s=[],i={},a={};let o;if(r.type==="response.output_text.delta")e.push({type:"text",text:r.delta,index:r.content_index});else if(r.type==="response.output_text.annotation.added")e.push({type:"text",text:"",annotations:[r.annotation],index:r.content_index});else if(r.type==="response.output_item.added"&&r.item.type==="message")o=r.item.id;else if(r.type==="response.output_item.added"&&r.item.type==="function_call")s.push({type:"tool_call_chunk",name:r.item.name,args:r.item.arguments,id:r.item.id,index:r.output_index}),a[ia]={[r.item.call_id]:r.item.id};else if(r.type==="response.output_item.done"&&(r.item.type==="web_search_call"||r.item.type==="file_search_call"||r.item.type==="computer_call"))a.tool_outputs=[r.item];else if(r.type==="response.created")i.id=r.response.id,i.model_name=r.response.model,i.model=r.response.model;else if(r.type==="response.completed"){const u=FA(r.response);n=r.response.usage,((c=(l=r.response.text)==null?void 0:l.format)==null?void 0:c.type)==="json_schema"&&(a.parsed??(a.parsed=JSON.parse(u.text)));for(const[d,h]of Object.entries(r.response))d!=="id"&&(i[d]=h)}else if(r.type==="response.function_call_arguments.delta")s.push({type:"tool_call_chunk",args:r.delta,index:r.output_index});else if(r.type==="response.web_search_call.completed"||r.type==="response.file_search_call.completed")t={tool_outputs:{id:r.item_id,type:r.type.replace("response.","").replace(".completed",""),status:"completed"}};else if(r.type==="response.refusal.done")a.refusal=r.refusal;else return null;return new lr({text:e.map(u=>u.text).join(""),message:new mt({id:o,content:e,tool_call_chunks:s,usage_metadata:n,additional_kwargs:a,response_metadata:i}),generationInfo:t})}function xm(r){return"type"in r&&r.type!=="function"}function JU(r){return r!=null&&typeof r=="object"&&"type"in r&&r.type!=="function"}function Fx(r,e){return Mc(r)?(e==null?void 0:e.strict)!==void 0?{...r,function:{...r.function,strict:e.strict}}:r:VU(r,e)}function q_(r){return(r==null?void 0:r.startsWith("o1"))||(r==null?void 0:r.startsWith("o3"))}let zx=class extends vr{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","reasoningEffort","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","modelName","model","modelKwargs","stop","stopSequences","timeout","openAIApiKey","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming"]}constructor(e){var t,n;super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useResponsesApi",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.openAIApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.openAIApiKey)??((t=e==null?void 0:e.configuration)==null?void 0:t.apiKey)??_n("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.organization=((n=e==null?void 0:e.configuration)==null?void 0:n.organization)??_n("OPENAI_ORGANIZATION"),this.model=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.modelName=this.model,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this.stop,this.user=e==null?void 0:e.user,this.__includeRawResponse=e==null?void 0:e.__includeRawResponse,this.audio=e==null?void 0:e.audio,this.modalities=e==null?void 0:e.modalities,this.reasoningEffort=e==null?void 0:e.reasoningEffort,this.maxTokens=(e==null?void 0:e.maxCompletionTokens)??(e==null?void 0:e.maxTokens),this.useResponsesApi=(e==null?void 0:e.useResponsesApi)??this.useResponsesApi,this.disableStreaming=(e==null?void 0:e.disableStreaming)??this.disableStreaming,this.model==="o1"&&(this.disableStreaming=!0),this.streaming=(e==null?void 0:e.streaming)??!1,this.disableStreaming&&(this.streaming=!1),this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.disableStreaming&&(this.streamUsage=!1),this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e==null?void 0:e.configuration},(e==null?void 0:e.supportsStrictToolCalling)!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling)}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){let n;return(t==null?void 0:t.strict)!==void 0?n=t.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this.bind({tools:e.map(s=>xm(s)?s:Fx(s,{strict:n})),...t})}createResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&Ru(e.json_schema.schema)?LA(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}invocationParams(e,t){var o,l;let n;if((e==null?void 0:e.strict)!==void 0?n=e.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this._useResponseApi(e)){const c={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:e==null?void 0:e.previous_response_id,truncation:e==null?void 0:e.truncation,include:e==null?void 0:e.include,tools:(o=e==null?void 0:e.tools)!=null&&o.length?e.tools.map(d=>xm(d)?d:Mc(d)?{type:"function",name:d.function.name,parameters:d.function.parameters,description:d.function.description,strict:n}:null).filter(d=>d!==null):void 0,tool_choice:JU(e==null?void 0:e.tool_choice)?e==null?void 0:e.tool_choice:(()=>{const d=Lx(e==null?void 0:e.tool_choice);if(typeof d=="object"&&"type"in d)return{type:"function",name:d.function.name}})(),text:(()=>{if(e!=null&&e.text)return e.text;const d=this.createResponseFormat(e==null?void 0:e.response_format);return(d==null?void 0:d.type)==="json_schema"?d.json_schema.schema!=null?{format:{type:"json_schema",schema:d.json_schema.schema,description:d.json_schema.description,name:d.json_schema.name,strict:d.json_schema.strict}}:void 0:{format:d}})(),parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,max_output_tokens:this.maxTokens===-1?void 0:this.maxTokens,...this.modelKwargs},u=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return u!==void 0&&(c.reasoning={effort:u}),c}let s={};(e==null?void 0:e.stream_options)!==void 0?s={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t!=null&&t.streaming)&&(s={stream_options:{include_usage:!0}});const i={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:(l=e==null?void 0:e.tools)!=null&&l.length?e.tools.map(c=>Fx(c,{strict:n})):void 0,tool_choice:Lx(e==null?void 0:e.tool_choice),response_format:this.createResponseFormat(e==null?void 0:e.response_format),seed:e==null?void 0:e.seed,...s,parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,...this.audio||e!=null&&e.audio?{audio:this.audio||(e==null?void 0:e.audio)}:{},...this.modalities||e!=null&&e.modalities?{modalities:this.modalities||(e==null?void 0:e.modalities)}:{},...this.modelKwargs};(e==null?void 0:e.prediction)!==void 0&&(i.prediction=e.prediction);const a=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return a!==void 0&&(i.reasoning_effort=a),q_(i.model)?i.max_completion_tokens=this.maxTokens===-1?void 0:this.maxTokens:i.max_tokens=this.maxTokens===-1?void 0:this.maxTokens,i}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){const n=e.tool_calls;switch(e.role){case"assistant":{const s=[],i=[];for(const l of n??[])try{s.push(Nc(l,{returnId:!0}))}catch(c){i.push(Qh(l,c.message))}const a={function_call:e.function_call,tool_calls:n};this.__includeRawResponse!==void 0&&(a.__raw_response=t);const o={model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};return e.audio&&(a.audio=e.audio),new Cn({content:e.content||"",tool_calls:s,invalid_tool_calls:i,additional_kwargs:a,response_metadata:o,id:t.id})}default:return new Ti(e.content||"",e.role??"unknown")}}_convertOpenAIDeltaToBaseMessageChunk(e,t,n){var l,c;const s=e.role??n,i=e.content??"";let a;e.function_call?a={function_call:e.function_call}:e.tool_calls?a={tool_calls:e.tool_calls}:a={},this.__includeRawResponse&&(a.__raw_response=t),e.audio&&(a.audio={...e.audio,index:t.choices[0].index});const o={usage:{...t.usage}};if(s==="user")return new Tc({content:i,response_metadata:o});if(s==="assistant"){const u=[];if(Array.isArray(e.tool_calls))for(const d of e.tool_calls)u.push({name:(l=d.function)==null?void 0:l.name,args:(c=d.function)==null?void 0:c.arguments,id:d.id,index:d.index,type:"tool_call_chunk"});return new mt({content:i,tool_call_chunks:u,additional_kwargs:a,id:t.id,response_metadata:o})}else return s==="system"?new yi({content:i,response_metadata:o}):s==="developer"?new yi({content:i,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}}):s==="function"?new Oc({content:i,additional_kwargs:a,name:e.name,response_metadata:o}):s==="tool"?new Hh({content:i,additional_kwargs:a,tool_call_id:e.tool_call_id,response_metadata:o}):new Ec({content:i,role:s,response_metadata:o})}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,n){var c,u,d,h,f,p,m,g,b,_;if(this._useResponseApi(t)){const y=await this.responseApiWithRetry({...this.invocationParams(t,{streaming:!0}),input:Dx(e,this.model),stream:!0},t);for await(const w of y){const v=ZU(w);v!=null&&(yield v)}return}const s=jx(e,this.model),i={...this.invocationParams(t,{streaming:!0}),messages:s,stream:!0};let a;const o=await this.completionWithRetry(i,t);let l;for await(const y of o){const w=(c=y==null?void 0:y.choices)==null?void 0:c[0];if(y.usage&&(l=y.usage),!w)continue;const{delta:v}=w;if(!v)continue;const x=this._convertOpenAIDeltaToBaseMessageChunk(v,y,a);a=v.role??a;const k={prompt:t.promptIndex??0,completion:w.index??0};if(typeof x.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const S={...k};w.finish_reason!=null&&(S.finish_reason=w.finish_reason,S.system_fingerprint=y.system_fingerprint,S.model_name=y.model),this.logprobs&&(S.logprobs=w.logprobs);const R=new lr({message:x,text:x.content,generationInfo:S});yield R,await(n==null?void 0:n.handleLLMNewToken(R.text??"",k,void 0,void 0,void 0,{chunk:R}))}if(l){const y={...((u=l.prompt_tokens_details)==null?void 0:u.audio_tokens)!==null&&{audio:(d=l.prompt_tokens_details)==null?void 0:d.audio_tokens},...((h=l.prompt_tokens_details)==null?void 0:h.cached_tokens)!==null&&{cache_read:(f=l.prompt_tokens_details)==null?void 0:f.cached_tokens}},w={...((p=l.completion_tokens_details)==null?void 0:p.audio_tokens)!==null&&{audio:(m=l.completion_tokens_details)==null?void 0:m.audio_tokens},...((g=l.completion_tokens_details)==null?void 0:g.reasoning_tokens)!==null&&{reasoning:(b=l.completion_tokens_details)==null?void 0:b.reasoning_tokens}};yield new lr({message:new mt({content:"",response_metadata:{usage:{...l}},usage_metadata:{input_tokens:l.prompt_tokens,output_tokens:l.completion_tokens,total_tokens:l.total_tokens,...Object.keys(y).length>0&&{input_token_details:y},...Object.keys(w).length>0&&{output_token_details:w}}}),text:""})}if((_=t.signal)!=null&&_.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _responseApiGenerate(e,t,n){var o;const s=this.invocationParams(t);if(s.stream){const l=this._streamResponseChunks(e,t,n);let c;for await(const u of l)u.message.response_metadata={...u.generationInfo,...u.message.response_metadata},c=(c==null?void 0:c.concat(u))??u;return{generations:c?[c]:[],llmOutput:{estimatedTokenUsage:(o=c==null?void 0:c.message)==null?void 0:o.usage_metadata}}}const i=Dx(e,this.model),a=await this.responseApiWithRetry({input:i,...s},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});return{generations:[{text:a.output_text,message:FA(a)}],llmOutput:{id:a.id,estimatedTokenUsage:a.usage?{promptTokens:a.usage.input_tokens,completionTokens:a.usage.output_tokens,totalTokens:a.usage.total_tokens}:void 0}}}_useResponseApi(e){var s;const t=(s=e==null?void 0:e.tools)==null?void 0:s.some(xm),n=(e==null?void 0:e.previous_response_id)!=null||(e==null?void 0:e.text)!=null||(e==null?void 0:e.truncation)!=null||(e==null?void 0:e.include)!=null;return this.useResponsesApi||t||n}async _generate(e,t,n){var o,l;if(this._useResponseApi(t))return this._responseApiGenerate(e,t,n);const s={},i=this.invocationParams(t),a=jx(e,this.model);if(i.stream){const c=this._streamResponseChunks(e,t,n),u={};for await(const g of c){g.message.response_metadata={...g.generationInfo,...g.message.response_metadata};const b=((o=g.generationInfo)==null?void 0:o.completion)??0;u[b]===void 0?u[b]=g:u[b]=u[b].concat(g)}const d=Object.entries(u).sort(([g],[b])=>parseInt(g,10)-parseInt(b,10)).map(([g,b])=>b),{functions:h,function_call:f}=this.invocationParams(t),p=await this.getEstimatedTokenCountFromPrompt(e,h,f),m=await this.getNumTokensFromGenerations(d);return s.input_tokens=p,s.output_tokens=m,s.total_tokens=p+m,{generations:d,llmOutput:{estimatedTokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}else{let c;t.response_format&&t.response_format.type==="json_schema"?c=await this.betaParsedCompletionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}):c=await this.completionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});const{completion_tokens:u,prompt_tokens:d,total_tokens:h,prompt_tokens_details:f,completion_tokens_details:p}=(c==null?void 0:c.usage)??{};u&&(s.output_tokens=(s.output_tokens??0)+u),d&&(s.input_tokens=(s.input_tokens??0)+d),h&&(s.total_tokens=(s.total_tokens??0)+h),((f==null?void 0:f.audio_tokens)!==null||(f==null?void 0:f.cached_tokens)!==null)&&(s.input_token_details={...(f==null?void 0:f.audio_tokens)!==null&&{audio:f==null?void 0:f.audio_tokens},...(f==null?void 0:f.cached_tokens)!==null&&{cache_read:f==null?void 0:f.cached_tokens}}),((p==null?void 0:p.audio_tokens)!==null||(p==null?void 0:p.reasoning_tokens)!==null)&&(s.output_token_details={...(p==null?void 0:p.audio_tokens)!==null&&{audio:p==null?void 0:p.audio_tokens},...(p==null?void 0:p.reasoning_tokens)!==null&&{reasoning:p==null?void 0:p.reasoning_tokens}});const m=[];for(const g of(c==null?void 0:c.choices)??[]){const _={text:((l=g.message)==null?void 0:l.content)??"",message:this._convertOpenAIChatCompletionMessageToBaseMessage(g.message??{role:"assistant"},c)};_.generationInfo={...g.finish_reason?{finish_reason:g.finish_reason}:{},...g.logprobs?{logprobs:g.logprobs}:{}},rs(_.message)&&(_.message.usage_metadata=s),_.message=new Cn(Object.fromEntries(Object.entries(_.message).filter(([y])=>!y.startsWith("lc_")))),m.push(_)}return{generations:m,llmOutput:{tokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,t,n){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&n!=="auto"){const i=WU(t);s+=await this.getNumTokens(i),s+=9}return t&&e.find(i=>i._getType()==="system")&&(s-=4),n==="none"?s+=1:typeof n=="object"&&(s+=await this.getNumTokens(n.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async n=>{var s;return(s=n.message.additional_kwargs)!=null&&s.function_call?(await this.getNumTokensFromMessages([n.message])).countPerMessage[0]:await this.getNumTokens(n.message.content)}))).reduce((n,s)=>n+s,0)}async getNumTokensFromMessages(e){let t=0,n=0,s=0;this.model==="gpt-3.5-turbo-0301"?(n=4,s=-1):(n=3,s=1);const i=await Promise.all(e.map(async a=>{var h,f,p,m,g,b;const o=await this.getNumTokens(a.content),l=await this.getNumTokens(U_(a)),c=a.name!==void 0?s+await this.getNumTokens(a.name):0;let u=o+n+l+c;const d=a;if(d._getType()==="function"&&(u-=2),(h=d.additional_kwargs)!=null&&h.function_call&&(u+=3),(f=d==null?void 0:d.additional_kwargs.function_call)!=null&&f.name&&(u+=await this.getNumTokens((p=d.additional_kwargs.function_call)==null?void 0:p.name)),(m=d.additional_kwargs.function_call)!=null&&m.arguments)try{u+=await this.getNumTokens(JSON.stringify(JSON.parse((g=d.additional_kwargs.function_call)==null?void 0:g.arguments)))}catch(_){console.error("Error parsing function arguments",_,JSON.stringify(d.additional_kwargs.function_call)),u+=await this.getNumTokens((b=d.additional_kwargs.function_call)==null?void 0:b.arguments)}return t+=u,u}));return t+=3,{totalCount:t,countPerMessage:i}}async completionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,n)}catch(s){throw vm(s)}})}async responseApiWithRetry(e,t){return this.caller.call(async()=>{var s,i;const n=this._getClientOptions(t);try{return((i=(s=e.text)==null?void 0:s.format)==null?void 0:i.type)==="json_schema"&&!e.stream?await this.client.responses.parse(e,n):await this.client.responses.create(e,n)}catch(a){throw vm(a)}})}async betaParsedCompletionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.beta.chat.completions.parse(e,n)}catch(s){throw vm(s)}})}_getClientOptions(e){if(!this.client){const n={baseURL:this.clientConfig.baseURL},s=DU(n),i={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new Ae(i)}return{...this.clientConfig,...e}}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,n)=>(n&&n.tokenUsage&&(t.tokenUsage.completionTokens+=n.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=n.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=n.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let n,s,i,a;KU(e)?(n=e.schema,s=e.name,i=e.method,a=e.includeRaw):(n=e,s=t==null?void 0:t.name,i=t==null?void 0:t.method,a=t==null?void 0:t.includeRaw);let o,l;if((t==null?void 0:t.strict)!==void 0&&i==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"?i===void 0&&(i="jsonSchema"):i==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`),i==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),Ru(n)?l=Kd.fromZodSchema(n):l=new Xd;else if(i==="jsonSchema")if(o=this.bind({response_format:{type:"json_schema",json_schema:{name:s??"extract",description:n.description,schema:n,strict:t==null?void 0:t.strict}}}),Ru(n)){const h=Kd.fromZodSchema(n);l=Ri.from(f=>"parsed"in f.additional_kwargs?f.additional_kwargs.parsed:h)}else l=new Xd;else{let h=s??"extract";if(Ru(n)){const f=js(n);o=this.bind({tools:[{type:"function",function:{name:h,description:f.description,parameters:f}}],tool_choice:{type:"function",function:{name:h}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),l=new Yd({returnSingle:!0,keyName:h,zodSchema:n})}else{let f;typeof n.name=="string"&&typeof n.parameters=="object"&&n.parameters!=null?(f=n,h=n.name):(h=n.title??h,f={name:h,description:n.description??"",parameters:n}),o=this.bind({tools:[{type:"function",function:f}],tool_choice:{type:"function",function:{name:h}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),l=new Yd({returnSingle:!0,keyName:h})}}if(!a)return o.pipe(l);const c=Ds.assign({parsed:(h,f)=>l.invoke(h.raw,f)}),u=Ds.assign({parsed:()=>null}),d=c.withFallbacks({fallbacks:[u]});return er.from([{raw:o},d])}};function Ru(r){return typeof(r==null?void 0:r.parse)=="function"}function KU(r){return r!==void 0&&typeof r.schema=="object"}class zA extends SA{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"verboseParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"content"}),this.verboseParsingErrors=(e==null?void 0:e.verboseParsingErrors)??this.verboseParsingErrors,this.responseFormat=(e==null?void 0:e.responseFormat)??this.responseFormat}async invoke(e,t){let n,s,i=We(t);return E_(e)?(n=e.id,s=e.args,i={...i,toolCall:e,configurable:{...i.configurable,tool_call_id:n}}):s=e,this.call(s,i)}async call(e,t,n){let s=e;if(ki(this.schema))try{s=await this.schema.parseAsync(e)}catch(f){let p="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(p=`${p}
Details: ${f.message}`),new zg(p,JSON.stringify(e))}else{const f=ft(e,this.schema);if(!f.valid){let p="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(p=`${p}
Details: ${f.errors.map(m=>`${m.keywordLocation}: ${m.error}`).join(`
`)}`),new zg(p,JSON.stringify(e))}}const i=j_(t),a=an.configure(i.callbacks,this.callbacks,i.tags||n,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),o=await(a==null?void 0:a.handleToolStart(this.toJSON(),typeof s=="string"?s:JSON.stringify(s),i.runId,void 0,void 0,void 0,i.runName));delete i.runId;let l;try{l=await this._call(s,o,i)}catch(f){throw await(o==null?void 0:o.handleToolError(f)),f}let c,u;if(this.responseFormat==="content_and_artifact")if(Array.isArray(l)&&l.length===2)[c,u]=l;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(l)}`);else c=l;let d;i&&"configurable"in i&&(d=i.configurable.tool_call_id);const h=e3({content:c,artifact:u,toolCallId:d,name:this.name});return await(o==null?void 0:o.handleToolEnd(h)),h}}class XU extends zA{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:He.object({input:He.string().optional()}).transform(t=>t.input)})}call(e,t){return super.call(typeof e=="string"||!e?{input:e}:e,t)}}class YU extends XU{static lc_name(){return"DynamicTool"}constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect}async call(e,t){const n=j_(t);return n.runName===void 0&&(n.runName=this.name),super.call(e,n)}async _call(e,t,n){return this.func(e,t,n)}}class QU extends zA{static lc_name(){return"DynamicStructuredTool"}constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect,this.schema=e.schema}async call(e,t,n){const s=j_(t);return s.runName===void 0&&(s.runName=this.name),super.call(e,s,n)}_call(e,t,n){return this.func(e,t,n)}}function _o(r,e){var a;const t=e.schema&&ki(e.schema)&&(!("shape"in e.schema)||!e.schema.shape),n=_d(e.schema);if(!e.schema||t||n)return new YU({...e,description:e.description??((a=e.schema)==null?void 0:a.description)??`${e.name} tool`,func:async(o,l,c)=>new Promise((u,d)=>{const h=Nt(c,{callbacks:l==null?void 0:l.getChild()});Tr.runWithConfig(Ns(h),async()=>{try{u(r(o,h))}catch(f){d(f)}})})});const s=e.schema,i=e.description??e.schema.description??`${e.name} tool`;return new QU({...e,description:i,schema:s,func:async(o,l,c)=>new Promise((u,d)=>{const h=Nt(c,{callbacks:l==null?void 0:l.getChild()});Tr.runWithConfig(Ns(h),async()=>{try{u(r(o,h))}catch(f){d(f)}})})})}function e3(r){const{content:e,artifact:t,toolCallId:n}=r;return n&&!Tj(e)?typeof e=="string"||Array.isArray(e)&&e.every(s=>typeof s=="object")?new Dg({content:e,artifact:t,tool_call_id:n,name:r.name}):new Dg({content:t3(e),artifact:t,tool_call_id:n,name:r.name}):e}function t3(r){try{return JSON.stringify(r,null,2)}catch{return`${r}`}}const Ki="0.37.0";let Bx=!1,cl,BA,nb,UA,qA,HA;function n3(r,e={auto:!1}){if(Bx)throw new Error(`you must \`import '@anthropic-ai/sdk/shims/${r.kind}'\` before importing anything else from @anthropic-ai/sdk`);if(cl)throw new Error(`can't \`import '@anthropic-ai/sdk/shims/${r.kind}'\` after \`import '@anthropic-ai/sdk/shims/${cl}'\``);Bx=e.auto,cl=r.kind,BA=r.fetch,nb=r.File,UA=r.ReadableStream,qA=r.getDefaultAgent,HA=r.fileFromPath}class r3{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function s3({manuallyImported:r}={}){const e=r?"You may need to use polyfills":"Add one of these imports before your first `import â¦ from '@anthropic-ai/sdk'`:\n- `import '@anthropic-ai/sdk/shims/node'` (if you're running on Node)\n- `import '@anthropic-ai/sdk/shims/web'` (otherwise)\n";let t,n,s,i;try{t=fetch,n=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new r3(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/anthropics/anthropic-sdk-typescript#file-uploads")},isFsReadStream:a=>!1}}cl||n3(s3(),{auto:!0});class Fe extends Error{}class Qt extends Fe{constructor(e,t,n,s){super(`${Qt.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["request-id"],this.error=t}static makeMessage(e,t,n){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e||!s)return new tf({message:n,cause:rb(t)});const i=t;return e===400?new VA(e,i,n,s):e===401?new GA(e,i,n,s):e===403?new ZA(e,i,n,s):e===404?new JA(e,i,n,s):e===409?new KA(e,i,n,s):e===422?new XA(e,i,n,s):e===429?new YA(e,i,n,s):e>=500?new QA(e,i,n,s):new Qt(e,i,n,s)}}class tr extends Qt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class tf extends Qt{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class WA extends tf{constructor({message:e}={}){super({message:e??"Request timed out."})}}class VA extends Qt{}class GA extends Qt{}class ZA extends Qt{}class JA extends Qt{}class KA extends Qt{}class XA extends Qt{}class YA extends Qt{}class QA extends Qt{}var Iu=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Ys=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Sn;class Lc{constructor(){Sn.set(this,void 0),this.buffer=new Uint8Array,Iu(this,Sn,null,"f")}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e;let n=new Uint8Array(this.buffer.length+t.length);n.set(this.buffer),n.set(t,this.buffer.length),this.buffer=n;const s=[];let i;for(;(i=i3(this.buffer,Ys(this,Sn,"f")))!=null;){if(i.carriage&&Ys(this,Sn,"f")==null){Iu(this,Sn,i.index,"f");continue}if(Ys(this,Sn,"f")!=null&&(i.index!==Ys(this,Sn,"f")+1||i.carriage)){s.push(this.decodeText(this.buffer.slice(0,Ys(this,Sn,"f")-1))),this.buffer=this.buffer.slice(Ys(this,Sn,"f")),Iu(this,Sn,null,"f");continue}const a=Ys(this,Sn,"f")!==null?i.preceding-1:i.preceding,o=this.decodeText(this.buffer.slice(0,a));s.push(o),this.buffer=this.buffer.slice(i.index),Iu(this,Sn,null,"f")}return s}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new Fe(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new Fe(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new Fe("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}}Sn=new WeakMap;Lc.NEWLINE_CHARS=new Set([`
`,"\r"]);Lc.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function i3(r,e){for(let s=e??0;s<r.length;s++){if(r[s]===10)return{preceding:s,index:s+1,carriage:!1};if(r[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function a3(r){for(let n=0;n<r.length-1;n++){if(r[n]===10&&r[n+1]===10||r[n]===13&&r[n+1]===13)return n+2;if(r[n]===13&&r[n+1]===10&&n+3<r.length&&r[n+2]===13&&r[n+3]===10)return n+4}return-1}function H_(r){if(r[Symbol.asyncIterator])return r;const e=r.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class Sr{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;async function*s(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(const a of o3(e,t)){if(a.event==="completion")try{yield JSON.parse(a.data)}catch(o){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),o}if(a.event==="message_start"||a.event==="message_delta"||a.event==="message_stop"||a.event==="content_block_start"||a.event==="content_block_delta"||a.event==="content_block_stop")try{yield JSON.parse(a.data)}catch(o){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),o}if(a.event!=="ping"&&a.event==="error")throw Qt.generate(void 0,`SSE Error: ${a.data}`,a.data,nE(e.headers))}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new Sr(s,t)}static fromReadableStream(e,t){let n=!1;async function*s(){const a=new Lc,o=H_(e);for await(const l of o)for(const c of a.decode(l))yield c;for(const l of a.flush())yield l}async function*i(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(const o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new Sr(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=n.next();e.push(a),t.push(a)}return i.shift()}});return[new Sr(()=>s(e),this.controller),new Sr(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new UA({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:a}=await t.next();if(a)return s.close();const o=n.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}}async function*o3(r,e){if(!r.body)throw e.abort(),new Fe("Attempted to iterate over a response with no body");const t=new c3,n=new Lc,s=H_(r.body);for await(const i of l3(s))for(const a of n.decode(i)){const o=t.decode(a);o&&(yield o)}for(const i of n.flush()){const a=t.decode(i);a&&(yield a)}}async function*l3(r){let e=new Uint8Array;for await(const t of r){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+n.length);s.set(e),s.set(n,e.length),e=s;let i;for(;(i=a3(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}class c3{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=u3(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}function u3(r,e){const t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}const d3=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function",h3=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&nf(r),nf=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function";async function f3(r,e,t){var s;if(r=await r,h3(r))return r;if(d3(r)){const i=await r.blob();e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=nf(i)?[await i.arrayBuffer()]:[i];return new nb(a,e,t)}const n=await p3(r);if(e||(e=g3(r)??"unknown_file"),!(t!=null&&t.type)){const i=(s=n[0])==null?void 0:s.type;typeof i=="string"&&(t={...t,type:i})}return new nb(n,e,t)}async function p3(r){var t;let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(nf(r))e.push(await r.arrayBuffer());else if(b3(r))for await(const n of r)e.push(n);else throw new Error(`Unexpected data type: ${typeof r}; constructor: ${(t=r==null?void 0:r.constructor)==null?void 0:t.name}; props: ${m3(r)}`);return e}function m3(r){return`[${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}function g3(r){var e;return km(r.name)||km(r.filename)||((e=km(r.path))==null?void 0:e.split(/[\\/]/).pop())}const km=r=>{if(typeof r=="string")return r;if(typeof Buffer<"u"&&r instanceof Buffer)return String(r)},b3=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",Ux=r=>r&&typeof r=="object"&&r.body&&r[Symbol.toStringTag]==="MultipartBody";var ma={},_3=function(r,e,t,n,s){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t},y3=function(r,e,t,n){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Cu;async function eE(r){const{response:e}=r;if(r.options.stream)return ga("response",e.status,e.url,e.headers,e.body),r.options.__streamClass?r.options.__streamClass.fromSSEResponse(e,r.controller):Sr.fromSSEResponse(e,r.controller);if(e.status===204)return null;if(r.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const i=await e.json();return ga("response",e.status,e.url,e.headers,i),tE(i,e)}const s=await e.text();return ga("response",e.status,e.url,e.headers,s),s}function tE(r,e){return!r||typeof r!="object"||Array.isArray(r)?r:Object.defineProperty(r,"_request_id",{value:e.headers.get("request-id"),enumerable:!1})}class rf extends Promise{constructor(e,t=eE){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new rf(this.responsePromise,async t=>tE(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class w3{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=Sm("maxRetries",t),this.timeout=Sm("timeout",n),this.httpAgent=s,this.fetch=i??BA}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...A3(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${I3()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(async s=>{const i=s&&nf(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var p;e={...e};const{method:n,path:s,query:i,headers:a={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:Ux(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,l=this.calculateContentLength(o),c=this.buildURL(s,i);"timeout"in e&&Sm("timeout",e.timeout),e.timeout=e.timeout??this.timeout;const u=e.httpAgent??this.httpAgent??qA(c),d=e.timeout+1e3;typeof((p=u==null?void 0:u.options)==null?void 0:p.timeout)=="number"&&d>(u.options.timeout??0)&&(u.options.timeout=d),this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const h=this.buildHeaders({options:e,headers:a,contentLength:l,retryCount:t});return{req:{method:n,...o&&{body:o},headers:h,...u&&{agent:u},signal:e.signal??null},url:c,timeout:e.timeout}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:s}){const i={};n&&(i["content-length"]=n);const a=this.defaultHeaders(e);return Vx(i,a),Vx(i,t),Ux(e.body)&&cl!=="node"&&delete i["content-type"],$u(a,"x-stainless-retry-count")===void 0&&$u(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),$u(a,"x-stainless-timeout")===void 0&&$u(t,"x-stainless-timeout")===void 0&&e.timeout&&(i["x-stainless-timeout"]=String(e.timeout)),this.validateHeaders(i,t),i}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new Fe("Streaming is strongly recommended for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-python#streaming-responses for more details");return 600*1e3}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,s){return Qt.generate(e,t,n,s)}request(e,t=null){return new rf(this.makeRequest(e,t))}async makeRequest(e,t){var d,h;const n=await e,s=n.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(n);const{req:i,url:a,timeout:o}=this.buildRequest(n,{retryCount:s-t});if(await this.prepareRequest(i,{url:a,options:n}),ga("request",a,n,i.headers),(d=n.signal)!=null&&d.aborted)throw new tr;const l=new AbortController,c=await this.fetchWithTimeout(a,i,o,l).catch(rb);if(c instanceof Error){if((h=n.signal)!=null&&h.aborted)throw new tr;if(t)return this.retryRequest(n,t);throw c.name==="AbortError"?new WA:new tf({cause:c})}const u=nE(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){const _=`retrying, ${t} attempts remaining`;return ga(`response (error; ${_})`,c.status,a,u),this.retryRequest(n,t,u)}const f=await c.text().catch(_=>rb(_).message),p=E3(f),m=p?void 0:f;throw ga(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,a,u,m),this.makeStatusError(c.status,p,m,u)}return{response:c,options:n,controller:l}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new x3(this,n,e)}buildURL(e,t){const n=T3(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return th(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new Fe(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,s){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),n),l={signal:s.signal,...a};l.method&&(l.method=l.method.toUpperCase());const c=60*1e3,u=setTimeout(()=>{var d,h;if(l&&((d=l==null?void 0:l.agent)!=null&&d.sockets))for(const f of Object.values((h=l==null?void 0:l.agent)==null?void 0:h.sockets).flat())f!=null&&f.setKeepAlive&&f.setKeepAlive(!0,c)},c);return this.fetch.call(void 0,e,l).finally(()=>{clearTimeout(o),clearTimeout(u)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){let s;const i=n==null?void 0:n["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(s=o)}const a=n==null?void 0:n["retry-after"];if(a&&!s){const o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await R3(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Ki}`}}class v3{constructor(e,t,n,s){Cu.set(this,void 0),_3(this,Cu,e),this.options=s,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new Fe("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of n)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await y3(this,Cu,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Cu=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class x3 extends rf{constructor(e,t,n){super(t,async s=>new n(e,s.response,await eE(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const nE=r=>new Proxy(Object.fromEntries(r.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),k3={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},ys=r=>typeof r=="object"&&r!==null&&!th(r)&&Object.keys(r).every(e=>rE(k3,e)),S3=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ki,"X-Stainless-OS":Hx(Deno.build.os),"X-Stainless-Arch":qx(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ki,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ki,"X-Stainless-OS":Hx(process.platform),"X-Stainless-Arch":qx(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const r=P3();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ki,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ki,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function P3(){if(typeof navigator>"u"||!navigator)return null;const r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of r){const n=t.exec(navigator.userAgent);if(n){const s=n[1]||0,i=n[2]||0,a=n[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const qx=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",Hx=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown");let Wx;const A3=()=>Wx??(Wx=S3()),E3=r=>{try{return JSON.parse(r)}catch{return}},O3=/^[a-z][a-z0-9+.-]*:/i,T3=r=>O3.test(r),R3=r=>new Promise(e=>setTimeout(e,r)),Sm=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Fe(`${r} must be an integer`);if(e<0)throw new Fe(`${r} must be a positive integer`);return e},rb=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null)try{return new Error(JSON.stringify(r))}catch{}return new Error(String(r))},Pm=r=>{var e,t,n,s;if(typeof process<"u")return((e=ma==null?void 0:ma[r])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(s=(n=(t=Deno.env)==null?void 0:t.get)==null?void 0:n.call(t,r))==null?void 0:s.trim()};function th(r){if(!r)return!0;for(const e in r)return!1;return!0}function rE(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function Vx(r,e){for(const t in e){if(!rE(e,t))continue;const n=t.toLowerCase();if(!n)continue;const s=e[t];s===null?delete r[n]:s!==void 0&&(r[n]=s)}}function ga(r,...e){typeof process<"u"&&(ma==null?void 0:ma.DEBUG)==="true"&&console.log(`Anthropic:DEBUG:${r}`,...e)}const I3=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)}),C3=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",$3=r=>typeof(r==null?void 0:r.get)=="function",$u=(r,e)=>{var n;const t=e.toLowerCase();if($3(r)){const s=((n=e[0])==null?void 0:n.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,a,o)=>a+o.toUpperCase());for(const i of[e,t,e.toUpperCase(),s]){const a=r.get(i);if(a)return a}}for(const[s,i]of Object.entries(r))if(s.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i};class sf extends v3{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.has_more=n.has_more||!1,this.first_id=n.first_id||null,this.last_id=n.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var t;if((t=this.options.query)!=null&&t.before_id){const n=this.first_id;return n?{params:{before_id:n}}:null}const e=this.last_id;return e?{params:{after_id:e}}:null}}class Bs{constructor(e){this._client=e}}let W_=class extends Bs{retrieve(e,t){return this._client.get(`/v1/models/${e}?beta=true`,t)}list(e={},t){return ys(e)?this.list({},e):this._client.getAPIList("/v1/models?beta=true",V_,{query:e,...t})}};class V_ extends sf{}W_.BetaModelInfosPage=V_;class af{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){const e=new Lc;for await(const t of this.iterator)for(const n of e.decode(t))yield JSON.parse(n);for(const t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body)throw t.abort(),new Fe("Attempted to iterate over a response with no body");return new af(H_(e.body),t)}}let G_=class extends Bs{create(e,t){const{betas:n,...s}=e;return this._client.post("/v1/messages/batches?beta=true",{body:s,...t,headers:{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString(),...t==null?void 0:t.headers}})}retrieve(e,t={},n){if(ys(t))return this.retrieve(e,{},t);const{betas:s}=t;return this._client.get(`/v1/messages/batches/${e}?beta=true`,{...n,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...n==null?void 0:n.headers}})}list(e={},t){if(ys(e))return this.list({},e);const{betas:n,...s}=e;return this._client.getAPIList("/v1/messages/batches?beta=true",Z_,{query:s,...t,headers:{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString(),...t==null?void 0:t.headers}})}delete(e,t={},n){if(ys(t))return this.delete(e,{},t);const{betas:s}=t;return this._client.delete(`/v1/messages/batches/${e}?beta=true`,{...n,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...n==null?void 0:n.headers}})}cancel(e,t={},n){if(ys(t))return this.cancel(e,{},t);const{betas:s}=t;return this._client.post(`/v1/messages/batches/${e}/cancel?beta=true`,{...n,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...n==null?void 0:n.headers}})}async results(e,t={},n){if(ys(t))return this.results(e,{},t);const s=await this.retrieve(e);if(!s.results_url)throw new Fe(`No batch \`results_url\`; Has it finished processing? ${s.processing_status} - ${s.id}`);const{betas:i}=t;return this._client.get(s.results_url,{...n,headers:{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary",...n==null?void 0:n.headers},__binaryResponse:!0})._thenUnwrap((a,o)=>af.fromResponse(o.response,o.controller))}};class Z_ extends sf{}G_.BetaMessageBatchesPage=Z_;const M3=r=>{let e=0,t=[];for(;e<r.length;){let n=r[e];if(n==="\\"){e++;continue}if(n==="{"){t.push({type:"brace",value:"{"}),e++;continue}if(n==="}"){t.push({type:"brace",value:"}"}),e++;continue}if(n==="["){t.push({type:"paren",value:"["}),e++;continue}if(n==="]"){t.push({type:"paren",value:"]"}),e++;continue}if(n===":"){t.push({type:"separator",value:":"}),e++;continue}if(n===","){t.push({type:"delimiter",value:","}),e++;continue}if(n==='"'){let o="",l=!1;for(n=r[++e];n!=='"';){if(e===r.length){l=!0;break}if(n==="\\"){if(e++,e===r.length){l=!0;break}o+=n+r[e],n=r[++e]}else o+=n,n=r[++e]}n=r[++e],l||t.push({type:"string",value:o});continue}if(n&&/\s/.test(n)){e++;continue}let i=/[0-9]/;if(n&&i.test(n)||n==="-"||n==="."){let o="";for(n==="-"&&(o+=n,n=r[++e]);n&&i.test(n)||n===".";)o+=n,n=r[++e];t.push({type:"number",value:o});continue}let a=/[a-z]/i;if(n&&a.test(n)){let o="";for(;n&&a.test(n)&&e!==r.length;)o+=n,n=r[++e];if(o=="true"||o=="false"||o==="null")t.push({type:"name",value:o});else{e++;continue}continue}e++}return t},Xi=r=>{if(r.length===0)return r;let e=r[r.length-1];switch(e.type){case"separator":return r=r.slice(0,r.length-1),Xi(r);case"number":let t=e.value[e.value.length-1];if(t==="."||t==="-")return r=r.slice(0,r.length-1),Xi(r);case"string":let n=r[r.length-2];if((n==null?void 0:n.type)==="delimiter")return r=r.slice(0,r.length-1),Xi(r);if((n==null?void 0:n.type)==="brace"&&n.value==="{")return r=r.slice(0,r.length-1),Xi(r);break;case"delimiter":return r=r.slice(0,r.length-1),Xi(r)}return r},N3=r=>{let e=[];return r.map(t=>{t.type==="brace"&&(t.value==="{"?e.push("}"):e.splice(e.lastIndexOf("}"),1)),t.type==="paren"&&(t.value==="["?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(t=>{t==="}"?r.push({type:"brace",value:"}"}):t==="]"&&r.push({type:"paren",value:"]"})}),r},L3=r=>{let e="";return r.map(t=>{switch(t.type){case"string":e+='"'+t.value+'"';break;default:e+=t.value;break}}),e},sE=r=>JSON.parse(L3(N3(Xi(M3(r)))));var Wt=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Ce=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Nn,fs,yo,Mu,wo,vo,Nu,xo,Lr,ko,Lu,ju,qi,Du,Fu,Am,Gx,Em,Om,Tm,Rm,Zx;const Jx="__json_buf";class nh{constructor(){Nn.add(this),this.messages=[],this.receivedMessages=[],fs.set(this,void 0),this.controller=new AbortController,yo.set(this,void 0),Mu.set(this,()=>{}),wo.set(this,()=>{}),vo.set(this,void 0),Nu.set(this,()=>{}),xo.set(this,()=>{}),Lr.set(this,{}),ko.set(this,!1),Lu.set(this,!1),ju.set(this,!1),qi.set(this,!1),Du.set(this,void 0),Fu.set(this,void 0),Em.set(this,e=>{if(Wt(this,Lu,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new tr),e instanceof tr)return Wt(this,ju,!0,"f"),this._emit("abort",e);if(e instanceof Fe)return this._emit("error",e);if(e instanceof Error){const t=new Fe(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new Fe(String(e)))}),Wt(this,yo,new Promise((e,t)=>{Wt(this,Mu,e,"f"),Wt(this,wo,t,"f")}),"f"),Wt(this,vo,new Promise((e,t)=>{Wt(this,Nu,e,"f"),Wt(this,xo,t,"f")}),"f"),Ce(this,yo,"f").catch(()=>{}),Ce(this,vo,"f").catch(()=>{})}get response(){return Ce(this,Du,"f")}get request_id(){return Ce(this,Fu,"f")}async withResponse(){const e=await Ce(this,yo,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new nh;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,n){const s=new nh;for(const i of t.messages)s._addMessageParam(i);return s._run(()=>s._createMessage(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},Ce(this,Em,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,n){var o;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Ce(this,Nn,"m",Om).call(this);const{response:i,data:a}=await e.create({...t,stream:!0},{...n,signal:this.controller.signal}).withResponse();this._connected(i);for await(const l of a)Ce(this,Nn,"m",Tm).call(this,l);if((o=a.controller.signal)!=null&&o.aborted)throw new tr;Ce(this,Nn,"m",Rm).call(this)}_connected(e){this.ended||(Wt(this,Du,e,"f"),Wt(this,Fu,e==null?void 0:e.headers.get("request-id"),"f"),Ce(this,Mu,"f").call(this,e),this._emit("connect"))}get ended(){return Ce(this,ko,"f")}get errored(){return Ce(this,Lu,"f")}get aborted(){return Ce(this,ju,"f")}abort(){this.controller.abort()}on(e,t){return(Ce(this,Lr,"f")[e]||(Ce(this,Lr,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=Ce(this,Lr,"f")[e];if(!n)return this;const s=n.findIndex(i=>i.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(Ce(this,Lr,"f")[e]||(Ce(this,Lr,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{Wt(this,qi,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){Wt(this,qi,!0,"f"),await Ce(this,vo,"f")}get currentMessage(){return Ce(this,fs,"f")}async finalMessage(){return await this.done(),Ce(this,Nn,"m",Am).call(this)}async finalText(){return await this.done(),Ce(this,Nn,"m",Gx).call(this)}_emit(e,...t){if(Ce(this,ko,"f"))return;e==="end"&&(Wt(this,ko,!0,"f"),Ce(this,Nu,"f").call(this));const n=Ce(this,Lr,"f")[e];if(n&&(Ce(this,Lr,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!Ce(this,qi,"f")&&!(n!=null&&n.length)&&Promise.reject(s),Ce(this,wo,"f").call(this,s),Ce(this,xo,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!Ce(this,qi,"f")&&!(n!=null&&n.length)&&Promise.reject(s),Ce(this,wo,"f").call(this,s),Ce(this,xo,"f").call(this,s),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",Ce(this,Nn,"m",Am).call(this))}async _fromReadableStream(e,t){var i;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),Ce(this,Nn,"m",Om).call(this),this._connected(null);const s=Sr.fromReadableStream(e,this.controller);for await(const a of s)Ce(this,Nn,"m",Tm).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new tr;Ce(this,Nn,"m",Rm).call(this)}[(fs=new WeakMap,yo=new WeakMap,Mu=new WeakMap,wo=new WeakMap,vo=new WeakMap,Nu=new WeakMap,xo=new WeakMap,Lr=new WeakMap,ko=new WeakMap,Lu=new WeakMap,ju=new WeakMap,qi=new WeakMap,Du=new WeakMap,Fu=new WeakMap,Em=new WeakMap,Nn=new WeakSet,Am=function(){if(this.receivedMessages.length===0)throw new Fe("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},Gx=function(){if(this.receivedMessages.length===0)throw new Fe("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(n=>n.type==="text").map(n=>n.text);if(t.length===0)throw new Fe("stream ended without producing a content block with type=text");return t.join(" ")},Om=function(){this.ended||Wt(this,fs,void 0,"f")},Tm=function(t){if(this.ended)return;const n=Ce(this,Nn,"m",Zx).call(this,t);switch(this._emit("streamEvent",t,n),t.type){case"content_block_delta":{const s=n.content.at(-1);switch(t.delta.type){case"text_delta":{s.type==="text"&&this._emit("text",t.delta.text,s.text||"");break}case"citations_delta":{s.type==="text"&&this._emit("citation",t.delta.citation,s.citations??[]);break}case"input_json_delta":{s.type==="tool_use"&&s.input&&this._emit("inputJson",t.delta.partial_json,s.input);break}case"thinking_delta":{s.type==="thinking"&&this._emit("thinking",t.delta.thinking,s.thinking);break}case"signature_delta":{s.type==="thinking"&&this._emit("signature",s.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(n),this._addMessage(n,!0);break}case"content_block_stop":{this._emit("contentBlock",n.content.at(-1));break}case"message_start":{Wt(this,fs,n,"f");break}}},Rm=function(){if(this.ended)throw new Fe("stream has ended, this shouldn't happen");const t=Ce(this,fs,"f");if(!t)throw new Fe("request ended without sending any chunks");return Wt(this,fs,void 0,"f"),t},Zx=function(t){let n=Ce(this,fs,"f");if(t.type==="message_start"){if(n)throw new Fe(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!n)throw new Fe(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return n;case"message_delta":return n.stop_reason=t.delta.stop_reason,n.stop_sequence=t.delta.stop_sequence,n.usage.output_tokens=t.usage.output_tokens,n;case"content_block_start":return n.content.push(t.content_block),n;case"content_block_delta":{const s=n.content.at(t.index);switch(t.delta.type){case"text_delta":{(s==null?void 0:s.type)==="text"&&(s.text+=t.delta.text);break}case"citations_delta":{(s==null?void 0:s.type)==="text"&&(s.citations??(s.citations=[]),s.citations.push(t.delta.citation));break}case"input_json_delta":{if((s==null?void 0:s.type)==="tool_use"){let i=s[Jx]||"";i+=t.delta.partial_json,Object.defineProperty(s,Jx,{value:i,enumerable:!1,writable:!0}),i&&(s.input=sE(i))}break}case"thinking_delta":{(s==null?void 0:s.type)==="thinking"&&(s.thinking+=t.delta.thinking);break}case"signature_delta":{(s==null?void 0:s.type)==="thinking"&&(s.signature=t.delta.signature);break}default:t.delta}return n}case"content_block_stop":return n}},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("streamEvent",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Sr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}const Kx={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"};let of=class extends Bs{constructor(){super(...arguments),this.batches=new G_(this._client)}create(e,t){const{betas:n,...s}=e;return s.model in Kx&&console.warn(`The model '${s.model}' is deprecated and will reach end-of-life on ${Kx[s.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`),this._client.post("/v1/messages?beta=true",{body:s,timeout:this._client._options.timeout??(s.stream?6e5:this._client._calculateNonstreamingTimeout(s.max_tokens)),...t,headers:{...(n==null?void 0:n.toString())!=null?{"anthropic-beta":n==null?void 0:n.toString()}:void 0,...t==null?void 0:t.headers},stream:e.stream??!1})}stream(e,t){return nh.createMessage(this,e,t)}countTokens(e,t){const{betas:n,...s}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:s,...t,headers:{"anthropic-beta":[...n??[],"token-counting-2024-11-01"].toString(),...t==null?void 0:t.headers}})}};of.Batches=G_;of.BetaMessageBatchesPage=Z_;class jc extends Bs{constructor(){super(...arguments),this.models=new W_(this._client),this.messages=new of(this._client)}}jc.Models=W_;jc.BetaModelInfosPage=V_;jc.Messages=of;class iE extends Bs{create(e,t){return this._client.post("/v1/complete",{body:e,timeout:this._client._options.timeout??6e5,...t,stream:e.stream??!1})}}class J_ extends Bs{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/v1/messages/batches/${e}`,t)}list(e={},t){return ys(e)?this.list({},e):this._client.getAPIList("/v1/messages/batches",K_,{query:e,...t})}delete(e,t){return this._client.delete(`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post(`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){const n=await this.retrieve(e);if(!n.results_url)throw new Fe(`No batch \`results_url\`; Has it finished processing? ${n.processing_status} - ${n.id}`);return this._client.get(n.results_url,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})._thenUnwrap((s,i)=>af.fromResponse(i.response,i.controller))}}class K_ extends sf{}J_.MessageBatchesPage=K_;var Vt=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},$e=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Ln,ps,So,zu,Po,Ao,Bu,Eo,jr,Oo,Uu,qu,Hi,Hu,Wu,Im,Xx,Cm,$m,Mm,Nm,Yx;const Qx="__json_buf";class rh{constructor(){Ln.add(this),this.messages=[],this.receivedMessages=[],ps.set(this,void 0),this.controller=new AbortController,So.set(this,void 0),zu.set(this,()=>{}),Po.set(this,()=>{}),Ao.set(this,void 0),Bu.set(this,()=>{}),Eo.set(this,()=>{}),jr.set(this,{}),Oo.set(this,!1),Uu.set(this,!1),qu.set(this,!1),Hi.set(this,!1),Hu.set(this,void 0),Wu.set(this,void 0),Cm.set(this,e=>{if(Vt(this,Uu,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new tr),e instanceof tr)return Vt(this,qu,!0,"f"),this._emit("abort",e);if(e instanceof Fe)return this._emit("error",e);if(e instanceof Error){const t=new Fe(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new Fe(String(e)))}),Vt(this,So,new Promise((e,t)=>{Vt(this,zu,e,"f"),Vt(this,Po,t,"f")}),"f"),Vt(this,Ao,new Promise((e,t)=>{Vt(this,Bu,e,"f"),Vt(this,Eo,t,"f")}),"f"),$e(this,So,"f").catch(()=>{}),$e(this,Ao,"f").catch(()=>{})}get response(){return $e(this,Hu,"f")}get request_id(){return $e(this,Wu,"f")}async withResponse(){const e=await $e(this,So,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new rh;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,n){const s=new rh;for(const i of t.messages)s._addMessageParam(i);return s._run(()=>s._createMessage(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},$e(this,Cm,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,n){var o;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),$e(this,Ln,"m",$m).call(this);const{response:i,data:a}=await e.create({...t,stream:!0},{...n,signal:this.controller.signal}).withResponse();this._connected(i);for await(const l of a)$e(this,Ln,"m",Mm).call(this,l);if((o=a.controller.signal)!=null&&o.aborted)throw new tr;$e(this,Ln,"m",Nm).call(this)}_connected(e){this.ended||(Vt(this,Hu,e,"f"),Vt(this,Wu,e==null?void 0:e.headers.get("request-id"),"f"),$e(this,zu,"f").call(this,e),this._emit("connect"))}get ended(){return $e(this,Oo,"f")}get errored(){return $e(this,Uu,"f")}get aborted(){return $e(this,qu,"f")}abort(){this.controller.abort()}on(e,t){return($e(this,jr,"f")[e]||($e(this,jr,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=$e(this,jr,"f")[e];if(!n)return this;const s=n.findIndex(i=>i.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return($e(this,jr,"f")[e]||($e(this,jr,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{Vt(this,Hi,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){Vt(this,Hi,!0,"f"),await $e(this,Ao,"f")}get currentMessage(){return $e(this,ps,"f")}async finalMessage(){return await this.done(),$e(this,Ln,"m",Im).call(this)}async finalText(){return await this.done(),$e(this,Ln,"m",Xx).call(this)}_emit(e,...t){if($e(this,Oo,"f"))return;e==="end"&&(Vt(this,Oo,!0,"f"),$e(this,Bu,"f").call(this));const n=$e(this,jr,"f")[e];if(n&&($e(this,jr,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!$e(this,Hi,"f")&&!(n!=null&&n.length)&&Promise.reject(s),$e(this,Po,"f").call(this,s),$e(this,Eo,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!$e(this,Hi,"f")&&!(n!=null&&n.length)&&Promise.reject(s),$e(this,Po,"f").call(this,s),$e(this,Eo,"f").call(this,s),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",$e(this,Ln,"m",Im).call(this))}async _fromReadableStream(e,t){var i;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),$e(this,Ln,"m",$m).call(this),this._connected(null);const s=Sr.fromReadableStream(e,this.controller);for await(const a of s)$e(this,Ln,"m",Mm).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new tr;$e(this,Ln,"m",Nm).call(this)}[(ps=new WeakMap,So=new WeakMap,zu=new WeakMap,Po=new WeakMap,Ao=new WeakMap,Bu=new WeakMap,Eo=new WeakMap,jr=new WeakMap,Oo=new WeakMap,Uu=new WeakMap,qu=new WeakMap,Hi=new WeakMap,Hu=new WeakMap,Wu=new WeakMap,Cm=new WeakMap,Ln=new WeakSet,Im=function(){if(this.receivedMessages.length===0)throw new Fe("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},Xx=function(){if(this.receivedMessages.length===0)throw new Fe("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(n=>n.type==="text").map(n=>n.text);if(t.length===0)throw new Fe("stream ended without producing a content block with type=text");return t.join(" ")},$m=function(){this.ended||Vt(this,ps,void 0,"f")},Mm=function(t){if(this.ended)return;const n=$e(this,Ln,"m",Yx).call(this,t);switch(this._emit("streamEvent",t,n),t.type){case"content_block_delta":{const s=n.content.at(-1);switch(t.delta.type){case"text_delta":{s.type==="text"&&this._emit("text",t.delta.text,s.text||"");break}case"citations_delta":{s.type==="text"&&this._emit("citation",t.delta.citation,s.citations??[]);break}case"input_json_delta":{s.type==="tool_use"&&s.input&&this._emit("inputJson",t.delta.partial_json,s.input);break}case"thinking_delta":{s.type==="thinking"&&this._emit("thinking",t.delta.thinking,s.thinking);break}case"signature_delta":{s.type==="thinking"&&this._emit("signature",s.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(n),this._addMessage(n,!0);break}case"content_block_stop":{this._emit("contentBlock",n.content.at(-1));break}case"message_start":{Vt(this,ps,n,"f");break}}},Nm=function(){if(this.ended)throw new Fe("stream has ended, this shouldn't happen");const t=$e(this,ps,"f");if(!t)throw new Fe("request ended without sending any chunks");return Vt(this,ps,void 0,"f"),t},Yx=function(t){let n=$e(this,ps,"f");if(t.type==="message_start"){if(n)throw new Fe(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!n)throw new Fe(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return n;case"message_delta":return n.stop_reason=t.delta.stop_reason,n.stop_sequence=t.delta.stop_sequence,n.usage.output_tokens=t.usage.output_tokens,n;case"content_block_start":return n.content.push(t.content_block),n;case"content_block_delta":{const s=n.content.at(t.index);switch(t.delta.type){case"text_delta":{(s==null?void 0:s.type)==="text"&&(s.text+=t.delta.text);break}case"citations_delta":{(s==null?void 0:s.type)==="text"&&(s.citations??(s.citations=[]),s.citations.push(t.delta.citation));break}case"input_json_delta":{if((s==null?void 0:s.type)==="tool_use"){let i=s[Qx]||"";i+=t.delta.partial_json,Object.defineProperty(s,Qx,{value:i,enumerable:!1,writable:!0}),i&&(s.input=sE(i))}break}case"thinking_delta":{(s==null?void 0:s.type)==="thinking"&&(s.thinking+=t.delta.thinking);break}case"signature_delta":{(s==null?void 0:s.type)==="thinking"&&(s.signature=t.delta.signature);break}default:t.delta}return n}case"content_block_stop":return n}},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("streamEvent",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Sr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class lf extends Bs{constructor(){super(...arguments),this.batches=new J_(this._client)}create(e,t){return e.model in ek&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${ek[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`),this._client.post("/v1/messages",{body:e,timeout:this._client._options.timeout??(e.stream?6e5:this._client._calculateNonstreamingTimeout(e.max_tokens)),...t,stream:e.stream??!1})}stream(e,t){return rh.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}}const ek={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"};lf.Batches=J_;lf.MessageBatchesPage=K_;class X_ extends Bs{retrieve(e,t){return this._client.get(`/v1/models/${e}`,t)}list(e={},t){return ys(e)?this.list({},e):this._client.getAPIList("/v1/models",Y_,{query:e,...t})}}class Y_ extends sf{}X_.ModelInfosPage=Y_;var aE;class tt extends w3{constructor({baseURL:e=Pm("ANTHROPIC_BASE_URL"),apiKey:t=Pm("ANTHROPIC_API_KEY")??null,authToken:n=Pm("ANTHROPIC_AUTH_TOKEN")??null,...s}={}){const i={apiKey:t,authToken:n,...s,baseURL:e||"https://api.anthropic.com"};if(!i.dangerouslyAllowBrowser&&C3())throw new Fe(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new iE(this),this.messages=new lf(this),this.models=new X_(this),this.beta=new jc(this),this._options=i,this.apiKey=t,this.authToken=n}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01",...this._options.defaultHeaders}}validateHeaders(e,t){if(!(this.apiKey&&e["x-api-key"])&&t["x-api-key"]!==null&&!(this.authToken&&e.authorization)&&t.authorization!==null)throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}authHeaders(e){const t=this.apiKeyAuth(e),n=this.bearerAuth(e);return t!=null&&!th(t)?t:n!=null&&!th(n)?n:{}}apiKeyAuth(e){return this.apiKey==null?{}:{"X-Api-Key":this.apiKey}}bearerAuth(e){return this.authToken==null?{}:{Authorization:`Bearer ${this.authToken}`}}}aE=tt;tt.Anthropic=aE;tt.HUMAN_PROMPT=`

Human:`;tt.AI_PROMPT=`

Assistant:`;tt.DEFAULT_TIMEOUT=6e5;tt.AnthropicError=Fe;tt.APIError=Qt;tt.APIConnectionError=tf;tt.APIConnectionTimeoutError=WA;tt.APIUserAbortError=tr;tt.NotFoundError=JA;tt.ConflictError=KA;tt.RateLimitError=YA;tt.BadRequestError=VA;tt.AuthenticationError=GA;tt.InternalServerError=QA;tt.PermissionDeniedError=ZA;tt.UnprocessableEntityError=XA;tt.toFile=f3;tt.fileFromPath=HA;tt.Completions=iE;tt.Messages=lf;tt.Models=X_;tt.ModelInfosPage=Y_;tt.Beta=jc;const{HUMAN_PROMPT:hH,AI_PROMPT:fH}=tt;class tk extends PA{static lc_name(){return"AnthropicToolsOutputParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","anthropic","output_parsers"]}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){let t=e;if(typeof e=="string")try{t=JSON.parse(e)}catch(s){throw new Hl(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(s.message)}`,e)}else t=e;if(this.zodSchema===void 0)return t;const n=await this.zodSchema.safeParseAsync(t);if(n.success)return n.data;throw new Hl(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(n.error.errors)}`,JSON.stringify(t,null,2))}async parseResult(e){const t=e.flatMap(i=>{const{message:a}=i;return Array.isArray(a.content)?oE(a.content)[0]:[]});if(t[0]===void 0)throw new Error("No parseable tool calls provided to AnthropicToolsOutputParser.");const[n]=t;return await this._validateResult(n.args)}}function oE(r){const e=[];for(const t of r)t.type==="tool_use"&&e.push({name:t.name,args:t.input,id:t.id,type:"tool_call"});return e}function j3(r){if(r)return r==="any"?{type:"any"}:r==="auto"?{type:"auto"}:typeof r=="string"?{type:"tool",name:r}:r}function nk(r){const e=/^data:(image\/.+);base64,(.+)$/,t=r.match(e);if(t===null)throw new Error(["Anthropic only supports base64-encoded images currently.","Example: data:image/png;base64,/9j/4AAQSk..."].join(`

`));return{type:"base64",media_type:t[1]??"",data:t[2]??""}}function D3(r){const e=[];for(const t of r)if(t._getType()==="tool")if(typeof t.content=="string"){const n=e[e.length-1];(n==null?void 0:n._getType())==="human"&&Array.isArray(n.content)&&"type"in n.content[0]&&n.content[0].type==="tool_result"?n.content.push({type:"tool_result",content:t.content,tool_use_id:t.tool_call_id}):e.push(new _i({content:[{type:"tool_result",content:t.content,tool_use_id:t.tool_call_id}]}))}else e.push(new _i({content:[{type:"tool_result",content:sb(t.content),tool_use_id:t.tool_call_id}]}));else e.push(t);return e}function rk(r){if(r.id===void 0)throw new Error('Anthropic requires all tool calls to have an "id".');return{type:"tool_use",id:r.id,name:r.name,input:r.args}}function sb(r){const e=["tool_use","tool_result","input_json_delta"],t=["text","text_delta"];return typeof r=="string"?r:r.map(s=>{const i="cache_control"in s?s.cache_control:void 0;if(s.type==="image_url"){let a;return typeof s.image_url=="string"?a=nk(s.image_url):a=nk(s.image_url.url),{type:"image",source:a,...i?{cache_control:i}:{}}}else{if(s.type==="document")return{...s,...i?{cache_control:i}:{}};if(s.type==="thinking")return{type:"thinking",thinking:s.thinking,signature:s.signature,...i?{cache_control:i}:{}};if(s.type==="redacted_thinking")return{type:"redacted_thinking",data:s.data,...i?{cache_control:i}:{}};if(t.find(a=>a===s.type)&&"text"in s)return{type:"text",text:s.text,...i?{cache_control:i}:{}};if(e.find(a=>a===s.type)){const a={...s};if("index"in a&&delete a.index,a.type==="input_json_delta"&&(a.type="tool_use"),"input"in a&&typeof a.input=="string")try{a.input=JSON.parse(a.input)}catch{a.input={}}return{...a,...i?{cache_control:i}:{}}}else throw new Error("Unsupported message content format")}})}function sk(r){const e=D3(r);let t;e.length>0&&e[0]._getType()==="system"&&(t=r[0].content);const s=(t!==void 0?e.slice(1):e).map(i=>{var o;let a;if(i._getType()==="human")a="user";else if(i._getType()==="ai")a="assistant";else if(i._getType()==="tool")a="user";else throw i._getType()==="system"?new Error("System messages are only permitted as the first passed message."):new Error(`Message type "${i._getType()}" is not supported.`);if(rs(i)&&((o=i.tool_calls)!=null&&o.length)){if(typeof i.content=="string")return i.content===""?{role:a,content:i.tool_calls.map(rk)}:{role:a,content:[{type:"text",text:i.content},...i.tool_calls.map(rk)]};{const{content:l}=i;return!i.tool_calls.every(u=>l.find(d=>(d.type==="tool_use"||d.type==="input_json_delta")&&d.id===u.id))&&console.warn('The "tool_calls" field on a message is only respected if content is a string.'),{role:a,content:sb(i.content)}}}else return{role:a,content:sb(i.content)}});return{messages:F3(s),system:t}}function F3(r){if(!r||r.length<=1)return r;const e=[];let t=r[0];const n=i=>typeof i=="string"?[{type:"text",text:i}]:i,s=i=>i.role!=="user"||typeof i.content=="string"?!1:Array.isArray(i.content)&&i.content.every(a=>a.type==="tool_result");for(let i=1;i<r.length;i+=1){const a=r[i];s(t)&&s(a)?t={...t,content:[...n(t.content),...n(a.content)]}:(e.push(t),t=a)}return e.push(t),e}function z3(r,e){var t;if(r.type==="message_start"){const{content:n,usage:s,...i}=r.message,a={};for(const[d,h]of Object.entries(i))h!=null&&(a[d]=h);const{input_tokens:o,output_tokens:l,...c}=s??{},u={input_tokens:o,output_tokens:l,total_tokens:o+l,input_token_details:{cache_creation:c.cache_creation_input_tokens,cache_read:c.cache_read_input_tokens}};return{chunk:new mt({content:e.coerceContentToString?"":[],additional_kwargs:a,usage_metadata:e.streamUsage?u:void 0,response_metadata:{usage:{...c}},id:r.message.id})}}else if(r.type==="message_delta"){const n={input_tokens:0,output_tokens:r.usage.output_tokens,total_tokens:r.usage.output_tokens,input_token_details:{cache_creation:r.usage.cache_creation_input_tokens,cache_read:r.usage.cache_read_input_tokens}};return{chunk:new mt({content:e.coerceContentToString?"":[],additional_kwargs:{...r.delta},usage_metadata:e.streamUsage?n:void 0})}}else if(r.type==="content_block_start"&&["tool_use","document"].includes(r.content_block.type)){const n=r.content_block;let s;return n.type==="tool_use"?s=[{id:n.id,index:r.index,name:n.name,args:""}]:s=[],{chunk:new mt({content:e.coerceContentToString?"":[{index:r.index,...r.content_block,input:""}],additional_kwargs:{},tool_call_chunks:s})}}else if(r.type==="content_block_delta"&&["text_delta","citations_delta","thinking_delta","signature_delta"].includes(r.delta.type)){if(e.coerceContentToString&&"text"in r.delta)return{chunk:new mt({content:r.delta.text})};{const n=r.delta;return"citation"in n&&(n.citations=[n.citation],delete n.citation),n.type==="thinking_delta"||n.type==="signature_delta"?{chunk:new mt({content:[{index:r.index,...n,type:"thinking"}]})}:{chunk:new mt({content:[{index:r.index,...n,type:"text"}]})}}}else{if(r.type==="content_block_delta"&&r.delta.type==="input_json_delta")return{chunk:new mt({content:e.coerceContentToString?"":[{index:r.index,input:r.delta.partial_json,type:r.delta.type}],additional_kwargs:{},tool_call_chunks:[{index:r.index,args:r.delta.partial_json}]})};if(r.type==="content_block_start"&&r.content_block.type==="text"){const n=(t=r.content_block)==null?void 0:t.text;if(n!==void 0)return{chunk:new mt({content:e.coerceContentToString?n:[{index:r.index,...r.content_block}],additional_kwargs:{}})}}else{if(r.type==="content_block_start"&&r.content_block.type==="redacted_thinking")return{chunk:new mt({content:e.coerceContentToString?"":[{index:r.index,...r.content_block}]})};if(r.type==="content_block_start"&&r.content_block.type==="thinking"){const n=r.content_block.thinking;return{chunk:new mt({content:e.coerceContentToString?n:[{index:r.index,...r.content_block}]})}}}}return null}function B3(r,e){const t=e.usage,n=t!=null?{input_tokens:t.input_tokens??0,output_tokens:t.output_tokens??0,total_tokens:(t.input_tokens??0)+(t.output_tokens??0),input_token_details:{cache_creation:t.cache_creation_input_tokens,cache_read:t.cache_read_input_tokens}}:void 0;if(r.length===1&&r[0].type==="text")return[{text:r[0].text,message:new Cn({content:r[0].text,additional_kwargs:e,usage_metadata:n,response_metadata:e,id:e.id})}];{const s=oE(r);return[{text:"",message:new Cn({content:r,additional_kwargs:e,tool_calls:s,usage_metadata:n,response_metadata:e,id:e.id})}]}}function Vu(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function ik(r){let e;return r.status===400&&r.message.includes("tool")?e=Vu(r,"INVALID_TOOL_RESULTS"):r.status===401?e=Vu(r,"MODEL_AUTHENTICATION"):r.status===404?e=Vu(r,"MODEL_NOT_FOUND"):r.status===429?e=Vu(r,"MODEL_RATE_LIMIT"):e=r,e}function U3(r){return!!(r.tools&&r.tools.length>0)}function q3(r){for(const e of r.messages??[])if(typeof e.content!="string"){for(const t of e.content??[])if(typeof t=="object"&&t!=null&&t.type==="document"&&typeof t.citations=="object"&&t.citations.enabled)return!0}return!1}function H3(r){return!!(r.thinking&&r.thinking.type==="enabled")}function W3(r){return"input_schema"in r}function V3(r){if(typeof r.content=="string")return r.content;if(Array.isArray(r.content)&&r.content.length>=1&&"input"in r.content[0])return typeof r.content[0].input=="string"?r.content[0].input:JSON.stringify(r.content[0].input);if(Array.isArray(r.content)&&r.content.length>=1&&"text"in r.content[0])return r.content[0].text}class G3 extends vr{static lc_name(){return"ChatAnthropic"}get lc_secrets(){return{anthropicApiKey:"ANTHROPIC_API_KEY",apiKey:"ANTHROPIC_API_KEY"}}get lc_aliases(){return{modelName:"model"}}constructor(e){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"anthropicApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:2048}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"claude-2.1"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"claude-2.1"}),Object.defineProperty(this,"invocationKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"clientOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"thinking",{enumerable:!0,configurable:!0,writable:!0,value:{type:"disabled"}}),Object.defineProperty(this,"batchClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamingClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"createClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.anthropicApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.anthropicApiKey)??_n("ANTHROPIC_API_KEY"),!this.anthropicApiKey&&!(e!=null&&e.createClient))throw new Error("Anthropic API key not found");this.clientOptions=(e==null?void 0:e.clientOptions)??{},this.apiKey=this.anthropicApiKey,this.apiUrl=e==null?void 0:e.anthropicApiUrl,this.modelName=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.model=this.modelName,this.invocationKwargs=(e==null?void 0:e.invocationKwargs)??{},this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topK=(e==null?void 0:e.topK)??this.topK,this.topP=(e==null?void 0:e.topP)??this.topP,this.maxTokens=(e==null?void 0:e.maxTokensToSample)??(e==null?void 0:e.maxTokens)??this.maxTokens,this.stopSequences=(e==null?void 0:e.stopSequences)??this.stopSequences,this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.thinking=(e==null?void 0:e.thinking)??this.thinking,this.createClient=(e==null?void 0:e.createClient)??(t=>new tt(t))}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"anthropic",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}formatStructuredToolToAnthropic(e){if(!(!e||!e.length))return e.map(t=>{if(W3(t))return t;if(Mc(t))return{name:t.function.name,description:t.function.description,input_schema:t.function.parameters};if(ef(t))return{name:t.name,description:t.description,input_schema:ki(t.schema)?js(t.schema):t.schema};throw new Error(`Unknown tool type passed to ChatAnthropic: ${JSON.stringify(t,null,2)}`)})}bindTools(e,t){return this.bind({tools:this.formatStructuredToolToAnthropic(e),...t})}invocationParams(e){const t=j3(e==null?void 0:e.tool_choice);if(this.thinking.type==="enabled"){if(this.topK!==-1)throw new Error("topK is not supported when thinking is enabled");if(this.topP!==-1)throw new Error("topP is not supported when thinking is enabled");if(this.temperature!==1)throw new Error("temperature is not supported when thinking is enabled");return{model:this.model,stop_sequences:(e==null?void 0:e.stop)??this.stopSequences,stream:this.streaming,max_tokens:this.maxTokens,tools:this.formatStructuredToolToAnthropic(e==null?void 0:e.tools),tool_choice:t,thinking:this.thinking,...this.invocationKwargs}}return{model:this.model,temperature:this.temperature,top_k:this.topK,top_p:this.topP,stop_sequences:(e==null?void 0:e.stop)??this.stopSequences,stream:this.streaming,max_tokens:this.maxTokens,tools:this.formatStructuredToolToAnthropic(e==null?void 0:e.tools),tool_choice:t,thinking:this.thinking,...this.invocationKwargs}}_identifyingParams(){return{model_name:this.model,...this.invocationParams()}}identifyingParams(){return{model_name:this.model,...this.invocationParams()}}async*_streamResponseChunks(e,t,n){var c;const s=this.invocationParams(t),i=sk(e),a={...s,...i,stream:!0},o=!U3(a)&&!q3(a)&&!H3(a),l=await this.createStreamWithRetry(a,{headers:t.headers});for await(const u of l){if((c=t.signal)!=null&&c.aborted)throw l.controller.abort(),new Error("AbortError: User aborted the request.");const d=this.streamUsage??t.streamUsage,h=z3(u,{streamUsage:d,coerceContentToString:o});if(!h)continue;const{chunk:f}=h,p=V3(f),m=new lr({message:new mt({content:f.content,additional_kwargs:f.additional_kwargs,tool_call_chunks:f.tool_call_chunks,usage_metadata:d?f.usage_metadata:void 0,response_metadata:f.response_metadata,id:f.id}),text:p??""});yield m,await(n==null?void 0:n.handleLLMNewToken(p??"",void 0,void 0,void 0,void 0,{chunk:m}))}}async _generateNonStreaming(e,t,n){const s=await this.completionWithRetry({...t,stream:!1,...sk(e)},n),{content:i,...a}=s,o=B3(i,a),{role:l,type:c,...u}=a;return{generations:o,llmOutput:u}}async _generate(e,t,n){if(this.stopSequences&&t.stop)throw new Error('"stopSequence" parameter found in input and default params');const s=this.invocationParams(t);if(s.stream){let i;const a=this._streamResponseChunks(e,t,n);for await(const o of a)i===void 0?i=o:i=i.concat(o);if(i===void 0)throw new Error("No chunks returned from Anthropic API.");return{generations:[{text:i.text,message:i.message}]}}else return this._generateNonStreaming(e,s,{signal:t.signal,headers:t.headers})}async createStreamWithRetry(e,t){if(!this.streamingClient){const s=this.apiUrl?{baseURL:this.apiUrl}:void 0;this.streamingClient=this.createClient({dangerouslyAllowBrowser:!0,...this.clientOptions,...s,apiKey:this.apiKey,maxRetries:0})}const n=async()=>{try{return await this.streamingClient.messages.create({...e,...this.invocationKwargs,stream:!0},t)}catch(s){throw ik(s)}};return this.caller.call(n)}async completionWithRetry(e,t){if(!this.batchClient){const s=this.apiUrl?{baseURL:this.apiUrl}:void 0;this.batchClient=this.createClient({dangerouslyAllowBrowser:!0,...this.clientOptions,...s,apiKey:this.apiKey,maxRetries:0})}const n=async()=>{try{return await this.batchClient.messages.create({...e,...this.invocationKwargs},t)}catch(s){throw ik(s)}};return this.caller.callWithOptions({signal:t.signal??void 0},n)}_llmType(){return"anthropic"}withStructuredOutput(e,t){var p;const n=e,s=t==null?void 0:t.name,i=t==null?void 0:t.method,a=t==null?void 0:t.includeRaw;if(i==="jsonMode")throw new Error('Anthropic only supports "functionCalling" as a method.');let o=s??"extract",l,c;if(ki(n)){const m=js(n);c=[{name:o,description:m.description??"A function available to call.",input_schema:m}],l=new tk({returnSingle:!0,keyName:o,zodSchema:n})}else{let m;typeof n.name=="string"&&typeof n.description=="string"&&typeof n.input_schema=="object"&&n.input_schema!=null?(m=n,o=n.name):m={name:o,description:n.description??"",input_schema:n},c=[m],l=new tk({returnSingle:!0,keyName:o})}let u;if(((p=this.thinking)==null?void 0:p.type)==="enabled"){const m="Anthropic structured output relies on forced tool calling, which is not supported when `thinking` is enabled. This method will raise OutputParserException if tool calls are not generated. Consider disabling `thinking` or adjust your prompt to ensure the tool is called.";console.warn(m),u=this.bind({tools:c});const g=b=>{if(!b.tool_calls||b.tool_calls.length===0)throw new Error(m);return b};u=u.pipe(g)}else u=this.bind({tools:c,tool_choice:{type:"tool",name:o}});if(!a)return u.pipe(l).withConfig({runName:"ChatAnthropicStructuredOutput"});const d=Ds.assign({parsed:(m,g)=>l.invoke(m.raw,g)}),h=Ds.assign({parsed:()=>null}),f=d.withFallbacks({fallbacks:[h]});return er.from([{raw:u},f]).withConfig({runName:"StructuredOutputRunnable"})}}class Z3 extends G3{}function J3(r){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:n,azureOpenAIBasePath:s,baseURL:i,azureADTokenProvider:a,azureOpenAIEndpoint:o}=r;if((n||a)&&s&&e)return`${s}/${e}`;if((n||a)&&o&&e)return`${o}/openai/deployments/${e}`;if(n||a){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return i}function Gu(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function Lm(r){let e;return r.constructor.name===wc.name?(e=new Error(r.message),e.name="TimeoutError"):r.constructor.name===bn.name?(e=new Error(r.message),e.name="AbortError"):r.status===400&&r.message.includes("tool_calls")?e=Gu(r,"INVALID_TOOL_RESULTS"):r.status===401?e=Gu(r,"MODEL_AUTHENTICATION"):r.status===429?e=Gu(r,"MODEL_RATE_LIMIT"):r.status===404?e=Gu(r,"MODEL_NOT_FOUND"):e=r,e}function ak(r){if(r)return r==="any"||r==="required"?"required":r==="auto"?"auto":r==="none"?"none":typeof r=="string"?{type:"function",function:{name:r}}:r}function K3(r){return r.anyOf!==void 0&&Array.isArray(r.anyOf)}function X3(r){const e=["namespace functions {",""];for(const t of r)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(lE(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function lE(r,e){var n;const t=[];for(const[s,i]of Object.entries(r.properties??{}))i.description&&e<2&&t.push(`// ${i.description}`),(n=r.required)!=null&&n.includes(s)?t.push(`${s}: ${sh(i,e)},`):t.push(`${s}?: ${sh(i,e)},`);return t.map(s=>" ".repeat(e)+s).join(`
`)}function sh(r,e){if(K3(r))return r.anyOf.map(t=>sh(t,e)).join(" | ");switch(r.type){case"string":return r.enum?r.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",lE(r,e+2),"}"].join(`
`);case"array":return r.items?`${sh(r.items,e)}[]`:"any[]";default:return""}}function Y3(r,e){let t;if(ef(r)){const n=jU({name:r.name,parameters:r.schema,description:r.description});n.function.parameters?t={type:n.type,function:{name:n.function.name,description:n.function.description,parameters:n.function.parameters,...(e==null?void 0:e.strict)!==void 0?{strict:e.strict}:{}}}:t={type:"function",function:jA(r,e)}}else t=r;return(e==null?void 0:e.strict)!==void 0&&(t.function.strict=e.strict),t}function Q3(r){return r.role!=="system"&&r.role!=="developer"&&r.role!=="assistant"&&r.role!=="user"&&r.role!=="function"&&r.role!=="tool"&&console.warn(`Unknown message role: ${r.role}`),r.role}function Q_(r){const e=r._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!Ti.isInstance(r))throw new Error("Invalid generic chat message");return Q3(r)}default:throw new Error(`Unknown message type: ${e}`)}}function ok(r,e){return r.flatMap(t=>{var i;let n=Q_(t);n==="system"&&ey(e)&&(n="developer");const s={role:n,content:t.content};if(t.name!=null&&(s.name=t.name),t.additional_kwargs.function_call!=null&&(s.function_call=t.additional_kwargs.function_call,s.content=""),rs(t)&&((i=t.tool_calls)!=null&&i.length)?(s.tool_calls=t.tool_calls.map(RA),s.content=""):(t.additional_kwargs.tool_calls!=null&&(s.tool_calls=t.additional_kwargs.tool_calls),t.tool_call_id!=null&&(s.tool_call_id=t.tool_call_id)),t.additional_kwargs.audio&&typeof t.additional_kwargs.audio=="object"&&"id"in t.additional_kwargs.audio){const a={role:"assistant",audio:{id:t.additional_kwargs.audio.id}};return[s,a]}return s})}const aa="__openai_function_call_ids__";function lk(r,e){return r.flatMap(t=>{var s,i;let n=Q_(t);if(n==="system"&&ey(e)&&(n="developer"),n==="function")throw new Error("Function messages are not supported in Responses API");if(n==="tool"){const a=t;return((s=a.additional_kwargs)==null?void 0:s.type)==="computer_call_output"?{type:"computer_call_output",output:(()=>{if(typeof a.content=="string")return{type:"computer_screenshot",image_url:a.content};if(Array.isArray(a.content)){const l=a.content.find(u=>u.type==="computer_screenshot");if(l)return l;const c=a.content.find(u=>u.type==="image_url");if(c)return{type:"computer_screenshot",image_url:typeof c.image_url=="string"?c.image_url:c.image_url.url}}throw new Error("Invalid computer call output")})(),call_id:a.tool_call_id}:{type:"function_call_output",call_id:a.tool_call_id,id:a.id,output:typeof a.content!="string"?JSON.stringify(a.content):a.content}}if(n==="assistant"){const a=[];t.additional_kwargs.reasoning!=null&&(u=>typeof u=="object"&&u!=null&&"type"in u&&u.type==="reasoning")(t.additional_kwargs.reasoning)&&a.push(t.additional_kwargs.reasoning);let{content:o}=t;t.additional_kwargs.refusal!=null&&(typeof o=="string"&&(o=[{type:"output_text",text:o,annotations:[]}]),o=[...o,{type:"refusal",refusal:t.additional_kwargs.refusal}]),a.push({type:"message",role:"assistant",content:typeof o=="string"?o:o.flatMap(c=>c.type==="text"?{type:"output_text",text:c.text,annotations:c.annotations??[]}:c.type==="output_text"||c.type==="refusal"?c:[])});const l=t.additional_kwargs[aa];if(rs(t)&&((i=t.tool_calls)!=null&&i.length)?a.push(...t.tool_calls.map(c=>({type:"function_call",name:c.name,arguments:JSON.stringify(c.args),call_id:c.id,id:l==null?void 0:l[c.id]}))):t.additional_kwargs.tool_calls!=null&&a.push(...t.additional_kwargs.tool_calls.map(c=>({type:"function_call",name:c.function.name,call_id:c.id,id:l==null?void 0:l[c.id],arguments:c.function.arguments}))),t.additional_kwargs.tool_outputs!=null){const c=t.additional_kwargs.tool_outputs,u=c==null?void 0:c.filter(d=>d.type==="computer_call");u.length>0&&a.push(...u)}return a}return n==="user"?{type:"message",role:"user",content:typeof t.content=="string"?t.content:t.content.flatMap(a=>{if(a.type==="text")return{type:"input_text",text:a.text};if(a.type==="image_url"){const o=typeof a.image_url=="string"?a.image_url:a.image_url.url,l=typeof a.image_url=="string"?"auto":a.image_url.detail;return{type:"input_image",image_url:o,detail:l}}return a.type==="input_text"||a.type==="input_image"||a.type==="input_file"?a:[]})}:[]})}function cE(r){if(r.error){const a=new Error(r.error.message);throw a.name=r.error.code,a}const e=[],t=[],n=[],s={model:r.model,created_at:r.created_at,id:r.id,incomplete_details:r.incomplete_details,metadata:r.metadata,object:r.object,status:r.status,user:r.user,model_name:r.model},i={};for(const a of r.output)if(a.type==="message")e.push(...a.content.flatMap(o=>o.type==="output_text"?("parsed"in o&&o.parsed!=null&&(i.parsed=o.parsed),{type:"text",text:o.text,annotations:o.annotations}):o.type==="refusal"?(i.refusal=o.refusal,[]):o));else if(a.type==="function_call"){const o={function:{name:a.name,arguments:a.arguments},id:a.call_id};try{t.push(Nc(o,{returnId:!0}))}catch(l){let c;typeof l=="object"&&l!=null&&"message"in l&&typeof l.message=="string"&&(c=l.message),n.push(Qh(o,c))}i[aa]??(i[aa]={}),i[aa][a.call_id]=a.id}else a.type==="reasoning"?i.reasoning=a:(i.tool_outputs??(i.tool_outputs=[]),i.tool_outputs.push(a));return new Cn({id:r.id,content:e,tool_calls:t,invalid_tool_calls:n,usage_metadata:r.usage,additional_kwargs:i,response_metadata:s})}function e9(r){var l,c;const e=[];let t={},n;const s=[],i={},a={};let o;if(r.type==="response.output_text.delta")e.push({type:"text",text:r.delta,index:r.content_index});else if(r.type==="response.output_text.annotation.added")e.push({type:"text",text:"",annotations:[r.annotation],index:r.content_index});else if(r.type==="response.output_item.added"&&r.item.type==="message")o=r.item.id;else if(r.type==="response.output_item.added"&&r.item.type==="function_call")s.push({type:"tool_call_chunk",name:r.item.name,args:r.item.arguments,id:r.item.id,index:r.output_index}),a[aa]={[r.item.call_id]:r.item.id};else if(r.type==="response.output_item.done"&&(r.item.type==="web_search_call"||r.item.type==="file_search_call"||r.item.type==="computer_call"))a.tool_outputs=[r.item];else if(r.type==="response.created")i.id=r.response.id,i.model_name=r.response.model,i.model=r.response.model;else if(r.type==="response.completed"){const u=cE(r.response);n=r.response.usage,((c=(l=r.response.text)==null?void 0:l.format)==null?void 0:c.type)==="json_schema"&&(a.parsed??(a.parsed=JSON.parse(u.text)));for(const[d,h]of Object.entries(r.response))d!=="id"&&(i[d]=h)}else if(r.type==="response.function_call_arguments.delta")s.push({type:"tool_call_chunk",args:r.delta,index:r.output_index});else if(r.type==="response.web_search_call.completed"||r.type==="response.file_search_call.completed")t={tool_outputs:{id:r.item_id,type:r.type.replace("response.","").replace(".completed",""),status:"completed"}};else if(r.type==="response.refusal.done")a.refusal=r.refusal;else return null;return new lr({text:e.map(u=>u.text).join(""),message:new mt({id:o,content:e,tool_call_chunks:s,usage_metadata:n,additional_kwargs:a,response_metadata:i}),generationInfo:t})}function jm(r){return"type"in r&&r.type!=="function"}function t9(r){return r!=null&&typeof r=="object"&&"type"in r&&r.type!=="function"}function ck(r,e){return Mc(r)?(e==null?void 0:e.strict)!==void 0?{...r,function:{...r.function,strict:e.strict}}:r:Y3(r,e)}function ey(r){return(r==null?void 0:r.startsWith("o1"))||(r==null?void 0:r.startsWith("o3"))}class n9 extends vr{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","reasoningEffort","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","modelName","model","modelKwargs","stop","stopSequences","timeout","openAIApiKey","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming"]}constructor(e){var t,n;super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useResponsesApi",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.openAIApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.openAIApiKey)??((t=e==null?void 0:e.configuration)==null?void 0:t.apiKey)??_n("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.organization=((n=e==null?void 0:e.configuration)==null?void 0:n.organization)??_n("OPENAI_ORGANIZATION"),this.model=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.modelName=this.model,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this.stop,this.user=e==null?void 0:e.user,this.__includeRawResponse=e==null?void 0:e.__includeRawResponse,this.audio=e==null?void 0:e.audio,this.modalities=e==null?void 0:e.modalities,this.reasoningEffort=e==null?void 0:e.reasoningEffort,this.maxTokens=(e==null?void 0:e.maxCompletionTokens)??(e==null?void 0:e.maxTokens),this.useResponsesApi=(e==null?void 0:e.useResponsesApi)??this.useResponsesApi,this.model==="o1"&&(this.disableStreaming=!0),this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e==null?void 0:e.configuration},(e==null?void 0:e.supportsStrictToolCalling)!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling)}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){let n;return(t==null?void 0:t.strict)!==void 0?n=t.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this.bind({tools:e.map(s=>jm(s)?s:ck(s,{strict:n})),...t})}createResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&Zu(e.json_schema.schema)?LA(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}invocationParams(e,t){var o,l;let n;if((e==null?void 0:e.strict)!==void 0?n=e.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this._useResponseApi(e)){const c={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:e==null?void 0:e.previous_response_id,truncation:e==null?void 0:e.truncation,include:e==null?void 0:e.include,tools:(o=e==null?void 0:e.tools)!=null&&o.length?e.tools.map(d=>jm(d)?d:Mc(d)?{type:"function",name:d.function.name,parameters:d.function.parameters,description:d.function.description,strict:n}:null).filter(d=>d!==null):void 0,tool_choice:t9(e==null?void 0:e.tool_choice)?e==null?void 0:e.tool_choice:(()=>{const d=ak(e==null?void 0:e.tool_choice);if(typeof d=="object"&&"type"in d)return{type:"function",name:d.function.name}})(),text:(()=>{if(e!=null&&e.text)return e.text;const d=this.createResponseFormat(e==null?void 0:e.response_format);return(d==null?void 0:d.type)==="json_schema"?d.json_schema.schema!=null?{format:{type:"json_schema",schema:d.json_schema.schema,description:d.json_schema.description,name:d.json_schema.name,strict:d.json_schema.strict}}:void 0:{format:d}})(),parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,max_output_tokens:this.maxTokens===-1?void 0:this.maxTokens,...this.modelKwargs},u=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return u!==void 0&&(c.reasoning={effort:u}),c}let s={};(e==null?void 0:e.stream_options)!==void 0?s={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t!=null&&t.streaming)&&(s={stream_options:{include_usage:!0}});const i={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:(l=e==null?void 0:e.tools)!=null&&l.length?e.tools.map(c=>ck(c,{strict:n})):void 0,tool_choice:ak(e==null?void 0:e.tool_choice),response_format:this.createResponseFormat(e==null?void 0:e.response_format),seed:e==null?void 0:e.seed,...s,parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,...this.audio||e!=null&&e.audio?{audio:this.audio||(e==null?void 0:e.audio)}:{},...this.modalities||e!=null&&e.modalities?{modalities:this.modalities||(e==null?void 0:e.modalities)}:{},...this.modelKwargs};(e==null?void 0:e.prediction)!==void 0&&(i.prediction=e.prediction);const a=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return a!==void 0&&(i.reasoning_effort=a),ey(i.model)?i.max_completion_tokens=this.maxTokens===-1?void 0:this.maxTokens:i.max_tokens=this.maxTokens===-1?void 0:this.maxTokens,i}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){const n=e.tool_calls;switch(e.role){case"assistant":{const s=[],i=[];for(const l of n??[])try{s.push(Nc(l,{returnId:!0}))}catch(c){i.push(Qh(l,c.message))}const a={function_call:e.function_call,tool_calls:n};this.__includeRawResponse!==void 0&&(a.__raw_response=t);const o={model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};return e.audio&&(a.audio=e.audio),new Cn({content:e.content||"",tool_calls:s,invalid_tool_calls:i,additional_kwargs:a,response_metadata:o,id:t.id})}default:return new Ti(e.content||"",e.role??"unknown")}}_convertOpenAIDeltaToBaseMessageChunk(e,t,n){var l,c;const s=e.role??n,i=e.content??"";let a;e.function_call?a={function_call:e.function_call}:e.tool_calls?a={tool_calls:e.tool_calls}:a={},this.__includeRawResponse&&(a.__raw_response=t),e.audio&&(a.audio={...e.audio,index:t.choices[0].index});const o={usage:{...t.usage}};if(s==="user")return new Tc({content:i,response_metadata:o});if(s==="assistant"){const u=[];if(Array.isArray(e.tool_calls))for(const d of e.tool_calls)u.push({name:(l=d.function)==null?void 0:l.name,args:(c=d.function)==null?void 0:c.arguments,id:d.id,index:d.index,type:"tool_call_chunk"});return new mt({content:i,tool_call_chunks:u,additional_kwargs:a,id:t.id,response_metadata:o})}else return s==="system"?new yi({content:i,response_metadata:o}):s==="developer"?new yi({content:i,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}}):s==="function"?new Oc({content:i,additional_kwargs:a,name:e.name,response_metadata:o}):s==="tool"?new Hh({content:i,additional_kwargs:a,tool_call_id:e.tool_call_id,response_metadata:o}):new Ec({content:i,role:s,response_metadata:o})}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,n){var c,u,d,h,f,p,m,g,b,_;if(this._useResponseApi(t)){const y=await this.responseApiWithRetry({...this.invocationParams(t,{streaming:!0}),input:lk(e,this.model),stream:!0},t);for await(const w of y){const v=e9(w);v!=null&&(yield v)}return}const s=ok(e,this.model),i={...this.invocationParams(t,{streaming:!0}),messages:s,stream:!0};let a;const o=await this.completionWithRetry(i,t);let l;for await(const y of o){const w=(c=y==null?void 0:y.choices)==null?void 0:c[0];if(y.usage&&(l=y.usage),!w)continue;const{delta:v}=w;if(!v)continue;const x=this._convertOpenAIDeltaToBaseMessageChunk(v,y,a);a=v.role??a;const k={prompt:t.promptIndex??0,completion:w.index??0};if(typeof x.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const S={...k};w.finish_reason!=null&&(S.finish_reason=w.finish_reason,S.system_fingerprint=y.system_fingerprint,S.model_name=y.model),this.logprobs&&(S.logprobs=w.logprobs);const R=new lr({message:x,text:x.content,generationInfo:S});yield R,await(n==null?void 0:n.handleLLMNewToken(R.text??"",k,void 0,void 0,void 0,{chunk:R}))}if(l){const y={...((u=l.prompt_tokens_details)==null?void 0:u.audio_tokens)!==null&&{audio:(d=l.prompt_tokens_details)==null?void 0:d.audio_tokens},...((h=l.prompt_tokens_details)==null?void 0:h.cached_tokens)!==null&&{cache_read:(f=l.prompt_tokens_details)==null?void 0:f.cached_tokens}},w={...((p=l.completion_tokens_details)==null?void 0:p.audio_tokens)!==null&&{audio:(m=l.completion_tokens_details)==null?void 0:m.audio_tokens},...((g=l.completion_tokens_details)==null?void 0:g.reasoning_tokens)!==null&&{reasoning:(b=l.completion_tokens_details)==null?void 0:b.reasoning_tokens}};yield new lr({message:new mt({content:"",response_metadata:{usage:{...l}},usage_metadata:{input_tokens:l.prompt_tokens,output_tokens:l.completion_tokens,total_tokens:l.total_tokens,...Object.keys(y).length>0&&{input_token_details:y},...Object.keys(w).length>0&&{output_token_details:w}}}),text:""})}if((_=t.signal)!=null&&_.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _responseApiGenerate(e,t,n){var o;const s=this.invocationParams(t);if(s.stream){const l=this._streamResponseChunks(e,t,n);let c;for await(const u of l)u.message.response_metadata={...u.generationInfo,...u.message.response_metadata},c=(c==null?void 0:c.concat(u))??u;return{generations:c?[c]:[],llmOutput:{estimatedTokenUsage:(o=c==null?void 0:c.message)==null?void 0:o.usage_metadata}}}const i=lk(e,this.model),a=await this.responseApiWithRetry({input:i,...s},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});return{generations:[{text:a.output_text,message:cE(a)}],llmOutput:{id:a.id,estimatedTokenUsage:a.usage?{promptTokens:a.usage.input_tokens,completionTokens:a.usage.output_tokens,totalTokens:a.usage.total_tokens}:void 0}}}_useResponseApi(e){var s;const t=(s=e==null?void 0:e.tools)==null?void 0:s.some(jm),n=(e==null?void 0:e.previous_response_id)!=null||(e==null?void 0:e.text)!=null||(e==null?void 0:e.truncation)!=null||(e==null?void 0:e.include)!=null;return this.useResponsesApi||t||n}async _generate(e,t,n){var o,l;if(this._useResponseApi(t))return this._responseApiGenerate(e,t,n);const s={},i=this.invocationParams(t),a=ok(e,this.model);if(i.stream){const c=this._streamResponseChunks(e,t,n),u={};for await(const g of c){g.message.response_metadata={...g.generationInfo,...g.message.response_metadata};const b=((o=g.generationInfo)==null?void 0:o.completion)??0;u[b]===void 0?u[b]=g:u[b]=u[b].concat(g)}const d=Object.entries(u).sort(([g],[b])=>parseInt(g,10)-parseInt(b,10)).map(([g,b])=>b),{functions:h,function_call:f}=this.invocationParams(t),p=await this.getEstimatedTokenCountFromPrompt(e,h,f),m=await this.getNumTokensFromGenerations(d);return s.input_tokens=p,s.output_tokens=m,s.total_tokens=p+m,{generations:d,llmOutput:{estimatedTokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}else{let c;t.response_format&&t.response_format.type==="json_schema"?c=await this.betaParsedCompletionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}):c=await this.completionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});const{completion_tokens:u,prompt_tokens:d,total_tokens:h,prompt_tokens_details:f,completion_tokens_details:p}=(c==null?void 0:c.usage)??{};u&&(s.output_tokens=(s.output_tokens??0)+u),d&&(s.input_tokens=(s.input_tokens??0)+d),h&&(s.total_tokens=(s.total_tokens??0)+h),((f==null?void 0:f.audio_tokens)!==null||(f==null?void 0:f.cached_tokens)!==null)&&(s.input_token_details={...(f==null?void 0:f.audio_tokens)!==null&&{audio:f==null?void 0:f.audio_tokens},...(f==null?void 0:f.cached_tokens)!==null&&{cache_read:f==null?void 0:f.cached_tokens}}),((p==null?void 0:p.audio_tokens)!==null||(p==null?void 0:p.reasoning_tokens)!==null)&&(s.output_token_details={...(p==null?void 0:p.audio_tokens)!==null&&{audio:p==null?void 0:p.audio_tokens},...(p==null?void 0:p.reasoning_tokens)!==null&&{reasoning:p==null?void 0:p.reasoning_tokens}});const m=[];for(const g of(c==null?void 0:c.choices)??[]){const _={text:((l=g.message)==null?void 0:l.content)??"",message:this._convertOpenAIChatCompletionMessageToBaseMessage(g.message??{role:"assistant"},c)};_.generationInfo={...g.finish_reason?{finish_reason:g.finish_reason}:{},...g.logprobs?{logprobs:g.logprobs}:{}},rs(_.message)&&(_.message.usage_metadata=s),_.message=new Cn(Object.fromEntries(Object.entries(_.message).filter(([y])=>!y.startsWith("lc_")))),m.push(_)}return{generations:m,llmOutput:{tokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,t,n){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&n!=="auto"){const i=X3(t);s+=await this.getNumTokens(i),s+=9}return t&&e.find(i=>i._getType()==="system")&&(s-=4),n==="none"?s+=1:typeof n=="object"&&(s+=await this.getNumTokens(n.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async n=>{var s;return(s=n.message.additional_kwargs)!=null&&s.function_call?(await this.getNumTokensFromMessages([n.message])).countPerMessage[0]:await this.getNumTokens(n.message.content)}))).reduce((n,s)=>n+s,0)}async getNumTokensFromMessages(e){let t=0,n=0,s=0;this.model==="gpt-3.5-turbo-0301"?(n=4,s=-1):(n=3,s=1);const i=await Promise.all(e.map(async a=>{var h,f,p,m,g,b;const o=await this.getNumTokens(a.content),l=await this.getNumTokens(Q_(a)),c=a.name!==void 0?s+await this.getNumTokens(a.name):0;let u=o+n+l+c;const d=a;if(d._getType()==="function"&&(u-=2),(h=d.additional_kwargs)!=null&&h.function_call&&(u+=3),(f=d==null?void 0:d.additional_kwargs.function_call)!=null&&f.name&&(u+=await this.getNumTokens((p=d.additional_kwargs.function_call)==null?void 0:p.name)),(m=d.additional_kwargs.function_call)!=null&&m.arguments)try{u+=await this.getNumTokens(JSON.stringify(JSON.parse((g=d.additional_kwargs.function_call)==null?void 0:g.arguments)))}catch(_){console.error("Error parsing function arguments",_,JSON.stringify(d.additional_kwargs.function_call)),u+=await this.getNumTokens((b=d.additional_kwargs.function_call)==null?void 0:b.arguments)}return t+=u,u}));return t+=3,{totalCount:t,countPerMessage:i}}async completionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,n)}catch(s){throw Lm(s)}})}async responseApiWithRetry(e,t){return this.caller.call(async()=>{var s,i;const n=this._getClientOptions(t);try{return((i=(s=e.text)==null?void 0:s.format)==null?void 0:i.type)==="json_schema"&&!e.stream?await this.client.responses.parse(e,n):await this.client.responses.create(e,n)}catch(a){throw Lm(a)}})}async betaParsedCompletionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.beta.chat.completions.parse(e,n)}catch(s){throw Lm(s)}})}_getClientOptions(e){if(!this.client){const n={baseURL:this.clientConfig.baseURL},s=J3(n),i={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new Ae(i)}return{...this.clientConfig,...e}}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,n)=>(n&&n.tokenUsage&&(t.tokenUsage.completionTokens+=n.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=n.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=n.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let n,s,i,a;r9(e)?(n=e.schema,s=e.name,i=e.method,a=e.includeRaw):(n=e,s=t==null?void 0:t.name,i=t==null?void 0:t.method,a=t==null?void 0:t.includeRaw);let o,l;if((t==null?void 0:t.strict)!==void 0&&i==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"?i===void 0&&(i="jsonSchema"):i==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`),i==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),Zu(n)?l=Kd.fromZodSchema(n):l=new Xd;else if(i==="jsonSchema")if(o=this.bind({response_format:{type:"json_schema",json_schema:{name:s??"extract",description:n.description,schema:n,strict:t==null?void 0:t.strict}}}),Zu(n)){const h=Kd.fromZodSchema(n);l=Ri.from(f=>"parsed"in f.additional_kwargs?f.additional_kwargs.parsed:h)}else l=new Xd;else{let h=s??"extract";if(Zu(n)){const f=js(n);o=this.bind({tools:[{type:"function",function:{name:h,description:f.description,parameters:f}}],tool_choice:{type:"function",function:{name:h}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),l=new Yd({returnSingle:!0,keyName:h,zodSchema:n})}else{let f;typeof n.name=="string"&&typeof n.parameters=="object"&&n.parameters!=null?(f=n,h=n.name):(h=n.title??h,f={name:h,description:n.description??"",parameters:n}),o=this.bind({tools:[{type:"function",function:f}],tool_choice:{type:"function",function:{name:h}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),l=new Yd({returnSingle:!0,keyName:h})}}if(!a)return o.pipe(l);const c=Ds.assign({parsed:(h,f)=>l.invoke(h.raw,f)}),u=Ds.assign({parsed:()=>null}),d=c.withFallbacks({fallbacks:[u]});return er.from([{raw:o},d])}}function Zu(r){return typeof(r==null?void 0:r.parse)=="function"}function r9(r){return r!==void 0&&typeof r.schema=="object"}class s9 extends n9{static lc_name(){return"ChatDeepSeek"}_llmType(){return"deepseek"}get lc_secrets(){return{apiKey:"DEEPSEEK_API_KEY"}}constructor(e){const t=(e==null?void 0:e.apiKey)||_n("DEEPSEEK_API_KEY");if(!t)throw new Error('Deepseek API key not found. Please set the DEEPSEEK_API_KEY environment variable or pass the key into "apiKey" field.');super({...e,apiKey:t,configuration:{baseURL:"https://api.deepseek.com",...e==null?void 0:e.configuration}}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models","deepseek"]})}_convertOpenAIDeltaToBaseMessageChunk(e,t,n){const s=super._convertOpenAIDeltaToBaseMessageChunk(e,t,n);return s.additional_kwargs.reasoning_content=e.reasoning_content,s}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){const n=super._convertOpenAIChatCompletionMessageToBaseMessage(e,t);return n.additional_kwargs.reasoning_content=e.reasoning_content,n}withStructuredOutput(e,t){const n={...t};return(n==null?void 0:n.method)===void 0&&(n.method="functionCalling"),super.withStructuredOutput(e,n)}}var Dm={local:{},session:{}};function i9(r){return r==="local"?localStorage:sessionStorage}function a9(r,e,t){var n,s,i,a,o,l,c,u;const d=(n=void 0)!=null?n:JSON,h=(s=void 0)!=null?s:"local",f=(i=void 0)!=null?i:!0,p=(o=(a=void 0)!=null?a:void 0)!=null?o:x=>console.error(`Error when writing value from persisted store "${r}" to ${h}`,x),m=(l=void 0)!=null?l:(x,k)=>console.error(`Error when parsing ${x?'"'+x+'"':"value"} from persisted store "${r}"`,k),g=(c=void 0)!=null?c:x=>x,b=(u=void 0)!=null?u:x=>x,_=typeof window<"u"&&typeof document<"u",y=_?i9(h):null;function w(x,k){const S=b(k);try{y==null||y.setItem(x,d.stringify(S))}catch(R){p(R)}}function v(){function x(D){try{return d.parse(D)}catch(M){m(D,M)}}const k=y==null?void 0:y.getItem(r);if(k==null)return e;const S=x(k);return S==null?e:g(S)}if(!Dm[h][r]){const x=v(),k=Pk(x,D=>{if(_&&h=="local"&&f){const M=N=>{if(N.key===r&&N.newValue){let C;try{C=d.parse(N.newValue)}catch(E){m(N.newValue,E);return}const A=g(C);D(A)}};return window.addEventListener("storage",M),()=>window.removeEventListener("storage",M)}}),{subscribe:S,set:R}=k;Dm[h][r]={set(D){R(D),w(r,D)},update(D){return k.update(M=>{const N=D(M);return w(r,N),N})},reset(){this.set(e)},subscribe:S}}return Dm[h][r]}const uE={provider:"openai",model:"gpt-3.5-turbo",apiKey:"",temperature:.7,maxTokens:4096,baseUrl:""},ib=a9("llm-assist-signal-app::llm_config",uE),dE=[new Fg(`You are a signal processing assistant that can help users generate and process signals. You can use the following tools:

1. generate_signal - Generate a new signal channel
2. process_signal - Process an existing signal and create a new channel
3. list_channels - List all available signal channels
4. get_channel_info - Get detailed information about a specific signal channel

When a user requests to generate or process signals, please use the appropriate tool instead of answering directly. For example, if a user asks to generate a sine wave, call the generate_signal tool.

You will be called repeatedly to complete tasks. Follow these rules:  

1. Perform tasks step-by-step. If unable to finish in one response, persist until done, but always try to combine tool calls or task in one response.  
2. After completing the task (or a subtask requiring user input), always call the await_user_input tool before ending.  
3. Stay aware of prior contextâyou may be recalled to continue.  

Always call the await_user_input tool when the task requires further user interaction.

Always call the await_user_input tool after completing a task or response. This signals the system to pause and wait for further user input before proceeding.

If current response will end the task or require user input, call the await_user_input tool at the end of response.`)],ba=pc({data:[...dE]});function Yi(...r){ba.data.push(...r)}function o9(){ba.data=[...dE]}const hE=[_o(async r=>{const{name:e,signal_type:t,length:n=1e3,sample_rate:s=1e3,amplitude:i=1,frequency:a=10,phase:o=0,duty_cycle:l=.5,pulse_position:c=500,pulse_width:u=10}=r;let d=[];switch(t){case"sine":d=Hm(n,a,i,s,o);break;case"square":d=Wm(n,a,i,s,l);break;case"triangle":d=Vm(n,a,i,s);break;case"sawtooth":d=Gm(n,a,i,s);break;case"noise":d=Zm(n,i);break;case"pulse":d=Jm(n,c,u,i);break;default:throw new Error(`ä¸æ¯æçä¿¡å·ç±»å: ${t}`)}const h=wb(e,d,s);return{channel_id:h.id,name:h.name,length:d.length,sample_rate:s,signal_type:t,message:`æåçæ${e}ä¿¡å·ééï¼ID: ${h.id}`}},{name:"generate_signal",description:"çæä¸ä¸ªæ°çä¿¡å·éé",schema:He.object({name:He.string().describe("ä¿¡å·ééçåç§°"),signal_type:He.enum(["sine","square","triangle","sawtooth","noise","pulse"]).describe("ä¿¡å·ç±»åï¼æ­£å¼¦æ³¢(sine)ãæ¹æ³¢(square)ãä¸è§æ³¢(triangle)ãé¯é½¿æ³¢(sawtooth)ãåªå£°(noise)ãèå²(pulse)"),length:He.number().int().default(1e3).describe("ä¿¡å·é¿åº¦ï¼æ ·æ¬æ°ï¼"),sample_rate:He.number().int().default(1e3).describe("éæ ·çï¼Hzï¼"),amplitude:He.number().default(1).describe("ä¿¡å·å¹åº¦"),frequency:He.number().default(10).describe("ä¿¡å·é¢çï¼Hzï¼ï¼ä»éç¨äºå¨ææ§ä¿¡å·"),phase:He.number().default(0).describe("ç¸ä½ï¼å¼§åº¦ï¼ï¼ä»éç¨äºæ­£å¼¦æ³¢"),duty_cycle:He.number().default(.5).describe("å ç©ºæ¯ï¼0-1ï¼ï¼ä»éç¨äºæ¹æ³¢"),pulse_position:He.number().int().default(500).describe("èå²ä½ç½®ï¼æ ·æ¬ç´¢å¼ï¼ï¼ä»éç¨äºèå²ä¿¡å·"),pulse_width:He.number().int().default(10).describe("èå²å®½åº¦ï¼æ ·æ¬æ°ï¼ï¼ä»éç¨äºèå²ä¿¡å·")})}),_o(async r=>{const{source_channel_id:e,new_channel_name:t,processor_type:n,window_size:s=10,cutoff_frequency:i=50}=r,a=qm(e);if(!a)throw new Error(`æ¾ä¸å°IDä¸º${e}çä¿¡å·éé`);let o,l={};switch(n){case"moving_average":o=lS,l={windowSize:s};break;case"low_pass":o=cS,l={cutoffFrequency:i,sampleRate:a.sampleRate};break;case"high_pass":o=uS,l={cutoffFrequency:i,sampleRate:a.sampleRate};break;case"fft":o=Ab;break;case"differentiate":o=dS,l={sampleRate:a.sampleRate};break;case"integrate":o=hS,l={sampleRate:a.sampleRate};break;default:throw new Error(`ä¸æ¯æçå¤çå¨ç±»å: ${n}`)}const c=Lk(e,o,t,l);return{channel_id:c.id,name:c.name,source_channel_id:e,processor_type:n,length:c.data.length,message:`æåå¤çä¿¡å·å¹¶åå»ºæ°éé${t}ï¼ID: ${c.id}`}},{name:"process_signal",description:"å¤çç°æä¿¡å·å¹¶åå»ºæ°çä¿¡å·éé",schema:He.object({source_channel_id:He.string().describe("æºä¿¡å·ééçID"),new_channel_name:He.string().describe("æ°ä¿¡å·ééçåç§°"),processor_type:He.enum(["moving_average","low_pass","high_pass","fft","differentiate","integrate"]).describe("å¤çå¨ç±»åï¼ç§»å¨å¹³å(moving_average)ãä½éæ»¤æ³¢(low_pass)ãé«éæ»¤æ³¢(high_pass)ãFFT(fft)ãå¾®å(differentiate)ãç§¯å(integrate)"),window_size:He.number().int().default(10).describe("ç§»å¨å¹³åçªå£å¤§å°ï¼ä»éç¨äºç§»å¨å¹³åå¤çå¨"),cutoff_frequency:He.number().default(50).describe("æªæ­¢é¢çï¼Hzï¼ï¼ä»éç¨äºä½éåé«éæ»¤æ³¢å¨")})}),_o(async()=>{const r=Ek(La);return{channels:r.map(e=>({id:e.id,name:e.name,length:e.data.length,sample_rate:e.sampleRate,created_at:e.createdAt,processing_method:e.processingMethod,stats:e.getStats()})),count:r.length,message:`æ¾å°${r.length}ä¸ªä¿¡å·éé`}},{name:"list_channels",description:"ååºææå¯ç¨çä¿¡å·éé",schema:He.object({}).describe("æ éåæ°")}),_o(async r=>{const{channel_id:e}=r,t=qm(e);if(!t)throw new Error(`æ¾ä¸å°IDä¸º${e}çä¿¡å·éé`);const n=t.getStats();return{id:t.id,name:t.name,length:t.data.length,sample_rate:t.sampleRate,created_at:t.createdAt,updated_at:t.updatedAt,processing_method:t.processingMethod,source_channel_ids:t.sourceChannelIds,stats:n,message:`æåè·åéé${t.name}çä¿¡æ¯`}},{name:"get_channel_info",description:"è·åç¹å®ä¿¡å·ééçè¯¦ç»ä¿¡æ¯",schema:He.object({channel_id:He.string().describe("ä¿¡å·ééçID")})}),_o(async()=>"æ­£å¨ç­å¾ç¨æ·è¾å¥",{name:"await_user_input",description:"ç­å¾ç¨æ·è¾å¥",schema:He.void()})];function l9(){const r=Ek(ib),e={openai:zx,anthropic:Z3,deepseek:s9,openrouter:zx};return new e[r.provider]({apiKey:r.apiKey,modelName:r.model,temperature:r.temperature,maxTokens:r.maxTokens,configuration:{...h9[r.provider]??(r.baseUrl?{baseURL:r.baseUrl}:{})}}).bindTools(hE)}async function c9(r){var e;try{const t=l9();Yi(new _i(r));e:for(;;){const n=await t.streamEvents(ba.data,{version:"v1"});let s=[];Yi(new Cn(""));let i="";for await(const a of n)a.event==="on_llm_stream"?(i+=((e=a.data.chunk)==null?void 0:e.content)??"",ba.data.pop(),Yi(new Cn(i))):a.event==="on_llm_end"&&(ba.data.pop(),s=a.data.output.generations.flat().map(o=>o.message));Yi(...s);for(const a of s)if(a.tool_calls&&a.tool_calls.length>0)for(const o of a.tool_calls){const{name:l}=o,u=await hE.find(d=>d.name===l).invoke(o);if(Yi(u),l==="await_user_input")break e}}}catch(t){throw console.error("Error sending message to LLM:",t),t}}function u9(r){switch(r.provider){case"openai":return["gpt-3.5-turbo","gpt-4","gpt-4-turbo"];case"anthropic":return["claude-3-opus-20240229","claude-3-sonnet-20240229","claude-3-haiku-20240307"];case"deepseek":return["deepseek-reasoner","deepseek-chat","deepseek-coder"];case"openrouter":return["mistralai/mistral-small-3.1-24b-instruct:free"];default:return[]}}function d9(){return[{id:"openai",name:"OpenAI"},{id:"anthropic",name:"Anthropic"},{id:"deepseek",name:"Deepseek"},{id:"openrouter",name:"Open Router"}]}const h9={openrouter:{baseURL:"https://openrouter.ai/api/v1"}};var f9=fe("<div><!></div>");function p9(r,e){at(e,!0);let t=se(e,"ref",15,null),n=Tt(e,["$$slots","$$events","$$legacy","ref","class","children"]);var s=f9();let i;var a=B(s);kt(a,()=>e.children??In),z(s),es(s,o=>t(o),()=>t()),Ue(o=>i=Dt(s,i,{class:o,...n}),[()=>Bn("bg-card text-card-foreground rounded-lg border shadow-sm",e.class)]),q(r,s),ot()}var m9=fe("<div><!></div>");function g9(r,e){at(e,!0);let t=se(e,"ref",15,null),n=Tt(e,["$$slots","$$events","$$legacy","ref","class","children"]);var s=m9();let i;var a=B(s);kt(a,()=>e.children??In),z(s),es(s,o=>t(o),()=>t()),Ue(o=>i=Dt(s,i,{class:o,...n}),[()=>Bn("p-6",e.class)]),q(r,s),ot()}/**
 * @license lucide-svelte v0.488.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const b9={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var _9=mk("<svg><!><!></svg>");function cf(r,e){const t=Ea(e,["children","$$slots","$$events","$$legacy"]),n=Ea(t,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);at(e,!1);let s=se(e,"name",8,void 0),i=se(e,"color",8,"currentColor"),a=se(e,"size",8,24),o=se(e,"strokeWidth",8,2),l=se(e,"absoluteStrokeWidth",8,!1),c=se(e,"iconNode",24,()=>[]);const u=(...m)=>m.filter((g,b,_)=>!!g&&_.indexOf(g)===b).join(" ");kh();var d=_9();let h;var f=B(d);Dn(f,1,c,Ar,(m,g)=>{let b=()=>P(g)[0],_=()=>P(g)[1];var y=ze(),w=ke(y);Tk(w,b,!0,(v,x)=>{let k;Ue(()=>k=Dt(v,k,{..._()}))}),q(m,y)});var p=V(f);gc(p,e,"default",{}),z(d),Ue((m,g)=>h=Dt(d,h,{...b9,...n,width:a(),height:a(),stroke:i(),"stroke-width":m,class:g}),[()=>l()?Number(o())*24/Number(a()):o(),()=>u("lucide-icon","lucide",s()?`lucide-${s()}`:"",t.class)],fc),q(r,d),ot()}function y9(r,e){const t=Ea(e,["children","$$slots","$$events","$$legacy"]);cf(r,Rr({name:"loader-circle"},()=>t,{iconNode:[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56"}]],children:(s,i)=>{var a=ze(),o=ke(a);gc(o,e,"default",{}),q(s,a)},$$slots:{default:!0}}))}function w9(r,e){const t=Ea(e,["children","$$slots","$$events","$$legacy"]);cf(r,Rr({name:"rotate-ccw"},()=>t,{iconNode:[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}]],children:(s,i)=>{var a=ze(),o=ke(a);gc(o,e,"default",{}),q(s,a)},$$slots:{default:!0}}))}function v9(r,e){const t=Ea(e,["children","$$slots","$$events","$$legacy"]);cf(r,Rr({name:"send"},()=>t,{iconNode:[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]],children:(s,i)=>{var a=ze(),o=ke(a);gc(o,e,"default",{}),q(s,a)},$$slots:{default:!0}}))}function x9(r,e){const t=Ea(e,["children","$$slots","$$events","$$legacy"]);cf(r,Rr({name:"trash-2"},()=>t,{iconNode:[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]],children:(s,i)=>{var a=ze(),o=ke(a);gc(o,e,"default",{}),q(s,a)},$$slots:{default:!0}}))}function ty(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let Ii=ty();function fE(r){Ii=r}const ul={exec:()=>null};function Ze(r,e=""){let t=typeof r=="string"?r:r.source;const n={replace:(s,i)=>{let a=typeof i=="string"?i:i.source;return a=a.replace(on.caret,"$1"),t=t.replace(s,a),n},getRegex:()=>new RegExp(t,e)};return n}const on={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:r=>new RegExp(`^( {0,3}${r})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}#`),htmlBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}<(?:[a-z].*>|!--)`,"i")},k9=/^(?:[ \t]*(?:\n|$))+/,S9=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,P9=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Dc=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,A9=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,ny=/(?:[*+-]|\d{1,9}[.)])/,pE=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,mE=Ze(pE).replace(/bull/g,ny).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),E9=Ze(pE).replace(/bull/g,ny).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),ry=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,O9=/^[^\n]+/,sy=/(?!\s*\])(?:\\.|[^\[\]\\])+/,T9=Ze(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",sy).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),R9=Ze(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,ny).getRegex(),uf="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",iy=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,I9=Ze("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",iy).replace("tag",uf).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),gE=Ze(ry).replace("hr",Dc).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",uf).getRegex(),C9=Ze(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",gE).getRegex(),ay={blockquote:C9,code:S9,def:T9,fences:P9,heading:A9,hr:Dc,html:I9,lheading:mE,list:R9,newline:k9,paragraph:gE,table:ul,text:O9},uk=Ze("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Dc).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",uf).getRegex(),$9={...ay,lheading:E9,table:uk,paragraph:Ze(ry).replace("hr",Dc).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",uk).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",uf).getRegex()},M9={...ay,html:Ze(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",iy).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:ul,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Ze(ry).replace("hr",Dc).replace("heading",` *#{1,6} *[^
]`).replace("lheading",mE).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},N9=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,L9=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,bE=/^( {2,}|\\)\n(?!\s*$)/,j9=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,df=/[\p{P}\p{S}]/u,oy=/[\s\p{P}\p{S}]/u,_E=/[^\s\p{P}\p{S}]/u,D9=Ze(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,oy).getRegex(),yE=/(?!~)[\p{P}\p{S}]/u,F9=/(?!~)[\s\p{P}\p{S}]/u,z9=/(?:[^\s\p{P}\p{S}]|~)/u,B9=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,wE=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,U9=Ze(wE,"u").replace(/punct/g,df).getRegex(),q9=Ze(wE,"u").replace(/punct/g,yE).getRegex(),vE="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",H9=Ze(vE,"gu").replace(/notPunctSpace/g,_E).replace(/punctSpace/g,oy).replace(/punct/g,df).getRegex(),W9=Ze(vE,"gu").replace(/notPunctSpace/g,z9).replace(/punctSpace/g,F9).replace(/punct/g,yE).getRegex(),V9=Ze("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,_E).replace(/punctSpace/g,oy).replace(/punct/g,df).getRegex(),G9=Ze(/\\(punct)/,"gu").replace(/punct/g,df).getRegex(),Z9=Ze(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),J9=Ze(iy).replace("(?:-->|$)","-->").getRegex(),K9=Ze("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",J9).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),ih=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,X9=Ze(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",ih).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),xE=Ze(/^!?\[(label)\]\[(ref)\]/).replace("label",ih).replace("ref",sy).getRegex(),kE=Ze(/^!?\[(ref)\](?:\[\])?/).replace("ref",sy).getRegex(),Y9=Ze("reflink|nolink(?!\\()","g").replace("reflink",xE).replace("nolink",kE).getRegex(),ly={_backpedal:ul,anyPunctuation:G9,autolink:Z9,blockSkip:B9,br:bE,code:L9,del:ul,emStrongLDelim:U9,emStrongRDelimAst:H9,emStrongRDelimUnd:V9,escape:N9,link:X9,nolink:kE,punctuation:D9,reflink:xE,reflinkSearch:Y9,tag:K9,text:j9,url:ul},Q9={...ly,link:Ze(/^!?\[(label)\]\((.*?)\)/).replace("label",ih).getRegex(),reflink:Ze(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",ih).getRegex()},ab={...ly,emStrongRDelimAst:W9,emStrongLDelim:q9,url:Ze(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},e5={...ab,br:Ze(bE).replace("{2,}","*").getRegex(),text:Ze(ab.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Ju={normal:ay,gfm:$9,pedantic:M9},To={normal:ly,gfm:ab,breaks:e5,pedantic:Q9},t5={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},dk=r=>t5[r];function mr(r,e){if(e){if(on.escapeTest.test(r))return r.replace(on.escapeReplace,dk)}else if(on.escapeTestNoEncode.test(r))return r.replace(on.escapeReplaceNoEncode,dk);return r}function hk(r){try{r=encodeURI(r).replace(on.percentDecode,"%")}catch{return null}return r}function fk(r,e){var i;const t=r.replace(on.findPipe,(a,o,l)=>{let c=!1,u=o;for(;--u>=0&&l[u]==="\\";)c=!c;return c?"|":" |"}),n=t.split(on.splitPipe);let s=0;if(n[0].trim()||n.shift(),n.length>0&&!((i=n.at(-1))!=null&&i.trim())&&n.pop(),e)if(n.length>e)n.splice(e);else for(;n.length<e;)n.push("");for(;s<n.length;s++)n[s]=n[s].trim().replace(on.slashPipe,"|");return n}function Ro(r,e,t){const n=r.length;if(n===0)return"";let s=0;for(;s<n&&r.charAt(n-s-1)===e;)s++;return r.slice(0,n-s)}function n5(r,e){if(r.indexOf(e[1])===-1)return-1;let t=0;for(let n=0;n<r.length;n++)if(r[n]==="\\")n++;else if(r[n]===e[0])t++;else if(r[n]===e[1]&&(t--,t<0))return n;return-1}function pk(r,e,t,n,s){const i=e.href,a=e.title||null,o=r[1].replace(s.other.outputLinkReplace,"$1");if(r[0].charAt(0)!=="!"){n.state.inLink=!0;const l={type:"link",raw:t,href:i,title:a,text:o,tokens:n.inlineTokens(o)};return n.state.inLink=!1,l}return{type:"image",raw:t,href:i,title:a,text:o}}function r5(r,e,t){const n=r.match(t.other.indentCodeCompensation);if(n===null)return e;const s=n[1];return e.split(`
`).map(i=>{const a=i.match(t.other.beginningSpace);if(a===null)return i;const[o]=a;return o.length>=s.length?i.slice(s.length):i}).join(`
`)}class ah{constructor(e){$(this,"options");$(this,"rules");$(this,"lexer");this.options=e||Ii}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const n=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?n:Ro(n,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const n=t[0],s=r5(n,t[3]||"",this.rules);return{type:"code",raw:n,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:s}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let n=t[2].trim();if(this.rules.other.endingHash.test(n)){const s=Ro(n,"#");(this.options.pedantic||!s||this.rules.other.endingSpaceChar.test(s))&&(n=s.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:Ro(t[0],`
`)}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){let n=Ro(t[0],`
`).split(`
`),s="",i="";const a=[];for(;n.length>0;){let o=!1;const l=[];let c;for(c=0;c<n.length;c++)if(this.rules.other.blockquoteStart.test(n[c]))l.push(n[c]),o=!0;else if(!o)l.push(n[c]);else break;n=n.slice(c);const u=l.join(`
`),d=u.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");s=s?`${s}
${u}`:u,i=i?`${i}
${d}`:d;const h=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(d,a,!0),this.lexer.state.top=h,n.length===0)break;const f=a.at(-1);if((f==null?void 0:f.type)==="code")break;if((f==null?void 0:f.type)==="blockquote"){const p=f,m=p.raw+`
`+n.join(`
`),g=this.blockquote(m);a[a.length-1]=g,s=s.substring(0,s.length-p.raw.length)+g.raw,i=i.substring(0,i.length-p.text.length)+g.text;break}else if((f==null?void 0:f.type)==="list"){const p=f,m=p.raw+`
`+n.join(`
`),g=this.list(m);a[a.length-1]=g,s=s.substring(0,s.length-f.raw.length)+g.raw,i=i.substring(0,i.length-p.raw.length)+g.raw,n=m.substring(a.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:s,tokens:a,text:i}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n=t[1].trim();const s=n.length>1,i={type:"list",raw:"",ordered:s,start:s?+n.slice(0,-1):"",loose:!1,items:[]};n=s?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=s?n:"[*+-]");const a=this.rules.other.listItemRegex(n);let o=!1;for(;e;){let c=!1,u="",d="";if(!(t=a.exec(e))||this.rules.block.hr.test(e))break;u=t[0],e=e.substring(u.length);let h=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,_=>" ".repeat(3*_.length)),f=e.split(`
`,1)[0],p=!h.trim(),m=0;if(this.options.pedantic?(m=2,d=h.trimStart()):p?m=t[1].length+1:(m=t[2].search(this.rules.other.nonSpaceChar),m=m>4?1:m,d=h.slice(m),m+=t[1].length),p&&this.rules.other.blankLine.test(f)&&(u+=f+`
`,e=e.substring(f.length+1),c=!0),!c){const _=this.rules.other.nextBulletRegex(m),y=this.rules.other.hrRegex(m),w=this.rules.other.fencesBeginRegex(m),v=this.rules.other.headingBeginRegex(m),x=this.rules.other.htmlBeginRegex(m);for(;e;){const k=e.split(`
`,1)[0];let S;if(f=k,this.options.pedantic?(f=f.replace(this.rules.other.listReplaceNesting,"  "),S=f):S=f.replace(this.rules.other.tabCharGlobal,"    "),w.test(f)||v.test(f)||x.test(f)||_.test(f)||y.test(f))break;if(S.search(this.rules.other.nonSpaceChar)>=m||!f.trim())d+=`
`+S.slice(m);else{if(p||h.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||w.test(h)||v.test(h)||y.test(h))break;d+=`
`+f}!p&&!f.trim()&&(p=!0),u+=k+`
`,e=e.substring(k.length+1),h=S.slice(m)}}i.loose||(o?i.loose=!0:this.rules.other.doubleBlankLine.test(u)&&(o=!0));let g=null,b;this.options.gfm&&(g=this.rules.other.listIsTask.exec(d),g&&(b=g[0]!=="[ ] ",d=d.replace(this.rules.other.listReplaceTask,""))),i.items.push({type:"list_item",raw:u,task:!!g,checked:b,loose:!1,text:d,tokens:[]}),i.raw+=u}const l=i.items.at(-1);if(l)l.raw=l.raw.trimEnd(),l.text=l.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let c=0;c<i.items.length;c++)if(this.lexer.state.top=!1,i.items[c].tokens=this.lexer.blockTokens(i.items[c].text,[]),!i.loose){const u=i.items[c].tokens.filter(h=>h.type==="space"),d=u.length>0&&u.some(h=>this.rules.other.anyLine.test(h.raw));i.loose=d}if(i.loose)for(let c=0;c<i.items.length;c++)i.items[c].loose=!0;return i}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){const t=this.rules.block.def.exec(e);if(t){const n=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),s=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:n,raw:t[0],href:s,title:i}}}table(e){var o;const t=this.rules.block.table.exec(e);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;const n=fk(t[1]),s=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=(o=t[3])!=null&&o.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],a={type:"table",raw:t[0],header:[],align:[],rows:[]};if(n.length===s.length){for(const l of s)this.rules.other.tableAlignRight.test(l)?a.align.push("right"):this.rules.other.tableAlignCenter.test(l)?a.align.push("center"):this.rules.other.tableAlignLeft.test(l)?a.align.push("left"):a.align.push(null);for(let l=0;l<n.length;l++)a.header.push({text:n[l],tokens:this.lexer.inline(n[l]),header:!0,align:a.align[l]});for(const l of i)a.rows.push(fk(l,a.header.length).map((c,u)=>({text:c,tokens:this.lexer.inline(c),header:!1,align:a.align[u]})));return a}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const n=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:n,tokens:this.lexer.inline(n)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const n=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;const a=Ro(n.slice(0,-1),"\\");if((n.length-a.length)%2===0)return}else{const a=n5(t[2],"()");if(a>-1){const l=(t[0].indexOf("!")===0?5:4)+t[1].length+a;t[2]=t[2].substring(0,a),t[0]=t[0].substring(0,l).trim(),t[3]=""}}let s=t[2],i="";if(this.options.pedantic){const a=this.rules.other.pedanticHrefTitle.exec(s);a&&(s=a[1],i=a[3])}else i=t[3]?t[3].slice(1,-1):"";return s=s.trim(),this.rules.other.startAngleBracket.test(s)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?s=s.slice(1):s=s.slice(1,-1)),pk(t,{href:s&&s.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){const s=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=t[s.toLowerCase()];if(!i){const a=n[0].charAt(0);return{type:"text",raw:a,text:a}}return pk(n,i,n[0],this.lexer,this.rules)}}emStrong(e,t,n=""){let s=this.rules.inline.emStrongLDelim.exec(e);if(!s||s[3]&&n.match(this.rules.other.unicodeAlphaNumeric))return;if(!(s[1]||s[2]||"")||!n||this.rules.inline.punctuation.exec(n)){const a=[...s[0]].length-1;let o,l,c=a,u=0;const d=s[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(d.lastIndex=0,t=t.slice(-1*e.length+a);(s=d.exec(t))!=null;){if(o=s[1]||s[2]||s[3]||s[4]||s[5]||s[6],!o)continue;if(l=[...o].length,s[3]||s[4]){c+=l;continue}else if((s[5]||s[6])&&a%3&&!((a+l)%3)){u+=l;continue}if(c-=l,c>0)continue;l=Math.min(l,l+c+u);const h=[...s[0]][0].length,f=e.slice(0,a+s.index+h+l);if(Math.min(a,l)%2){const m=f.slice(1,-1);return{type:"em",raw:f,text:m,tokens:this.lexer.inlineTokens(m)}}const p=f.slice(2,-2);return{type:"strong",raw:f,text:p,tokens:this.lexer.inlineTokens(p)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let n=t[2].replace(this.rules.other.newLineCharGlobal," ");const s=this.rules.other.nonSpaceChar.test(n),i=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return s&&i&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:t[0],text:n}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let n,s;return t[2]==="@"?(n=t[1],s="mailto:"+n):(n=t[1],s=n),{type:"link",raw:t[0],text:n,href:s,tokens:[{type:"text",raw:n,text:n}]}}}url(e){var n;let t;if(t=this.rules.inline.url.exec(e)){let s,i;if(t[2]==="@")s=t[0],i="mailto:"+s;else{let a;do a=t[0],t[0]=((n=this.rules.inline._backpedal.exec(t[0]))==null?void 0:n[0])??"";while(a!==t[0]);s=t[0],t[1]==="www."?i="http://"+t[0]:i=t[0]}return{type:"link",raw:t[0],text:s,href:i,tokens:[{type:"text",raw:s,text:s}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){const n=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:n}}}}class Fn{constructor(e){$(this,"tokens");$(this,"options");$(this,"state");$(this,"tokenizer");$(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Ii,this.options.tokenizer=this.options.tokenizer||new ah,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={other:on,block:Ju.normal,inline:To.normal};this.options.pedantic?(t.block=Ju.pedantic,t.inline=To.pedantic):this.options.gfm&&(t.block=Ju.gfm,this.options.breaks?t.inline=To.breaks:t.inline=To.gfm),this.tokenizer.rules=t}static get rules(){return{block:Ju,inline:To}}static lex(e,t){return new Fn(t).lex(e)}static lexInline(e,t){return new Fn(t).inlineTokens(e)}lex(e){e=e.replace(on.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){const n=this.inlineQueue[t];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],n=!1){var s,i,a;for(this.options.pedantic&&(e=e.replace(on.tabCharGlobal,"    ").replace(on.spaceLine,""));e;){let o;if((i=(s=this.options.extensions)==null?void 0:s.block)!=null&&i.some(c=>(o=c.call({lexer:this},e,t))?(e=e.substring(o.raw.length),t.push(o),!0):!1))continue;if(o=this.tokenizer.space(e)){e=e.substring(o.raw.length);const c=t.at(-1);o.raw.length===1&&c!==void 0?c.raw+=`
`:t.push(o);continue}if(o=this.tokenizer.code(e)){e=e.substring(o.raw.length);const c=t.at(-1);(c==null?void 0:c.type)==="paragraph"||(c==null?void 0:c.type)==="text"?(c.raw+=`
`+o.raw,c.text+=`
`+o.text,this.inlineQueue.at(-1).src=c.text):t.push(o);continue}if(o=this.tokenizer.fences(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.heading(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.hr(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.blockquote(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.list(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.html(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.def(e)){e=e.substring(o.raw.length);const c=t.at(-1);(c==null?void 0:c.type)==="paragraph"||(c==null?void 0:c.type)==="text"?(c.raw+=`
`+o.raw,c.text+=`
`+o.raw,this.inlineQueue.at(-1).src=c.text):this.tokens.links[o.tag]||(this.tokens.links[o.tag]={href:o.href,title:o.title});continue}if(o=this.tokenizer.table(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.lheading(e)){e=e.substring(o.raw.length),t.push(o);continue}let l=e;if((a=this.options.extensions)!=null&&a.startBlock){let c=1/0;const u=e.slice(1);let d;this.options.extensions.startBlock.forEach(h=>{d=h.call({lexer:this},u),typeof d=="number"&&d>=0&&(c=Math.min(c,d))}),c<1/0&&c>=0&&(l=e.substring(0,c+1))}if(this.state.top&&(o=this.tokenizer.paragraph(l))){const c=t.at(-1);n&&(c==null?void 0:c.type)==="paragraph"?(c.raw+=`
`+o.raw,c.text+=`
`+o.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=c.text):t.push(o),n=l.length!==e.length,e=e.substring(o.raw.length);continue}if(o=this.tokenizer.text(e)){e=e.substring(o.raw.length);const c=t.at(-1);(c==null?void 0:c.type)==="text"?(c.raw+=`
`+o.raw,c.text+=`
`+o.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=c.text):t.push(o);continue}if(e){const c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){var o,l,c;let n=e,s=null;if(this.tokens.links){const u=Object.keys(this.tokens.links);if(u.length>0)for(;(s=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)u.includes(s[0].slice(s[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(s=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,s.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(s=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)n=n.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let i=!1,a="";for(;e;){i||(a=""),i=!1;let u;if((l=(o=this.options.extensions)==null?void 0:o.inline)!=null&&l.some(h=>(u=h.call({lexer:this},e,t))?(e=e.substring(u.raw.length),t.push(u),!0):!1))continue;if(u=this.tokenizer.escape(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.tag(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.link(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(u.raw.length);const h=t.at(-1);u.type==="text"&&(h==null?void 0:h.type)==="text"?(h.raw+=u.raw,h.text+=u.text):t.push(u);continue}if(u=this.tokenizer.emStrong(e,n,a)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.codespan(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.br(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.del(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.autolink(e)){e=e.substring(u.raw.length),t.push(u);continue}if(!this.state.inLink&&(u=this.tokenizer.url(e))){e=e.substring(u.raw.length),t.push(u);continue}let d=e;if((c=this.options.extensions)!=null&&c.startInline){let h=1/0;const f=e.slice(1);let p;this.options.extensions.startInline.forEach(m=>{p=m.call({lexer:this},f),typeof p=="number"&&p>=0&&(h=Math.min(h,p))}),h<1/0&&h>=0&&(d=e.substring(0,h+1))}if(u=this.tokenizer.inlineText(d)){e=e.substring(u.raw.length),u.raw.slice(-1)!=="_"&&(a=u.raw.slice(-1)),i=!0;const h=t.at(-1);(h==null?void 0:h.type)==="text"?(h.raw+=u.raw,h.text+=u.text):t.push(u);continue}if(e){const h="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(h);break}else throw new Error(h)}}return t}}class oh{constructor(e){$(this,"options");$(this,"parser");this.options=e||Ii}space(e){return""}code({text:e,lang:t,escaped:n}){var a;const s=(a=(t||"").match(on.notSpaceStart))==null?void 0:a[0],i=e.replace(on.endingNewline,"")+`
`;return s?'<pre><code class="language-'+mr(s)+'">'+(n?i:mr(i,!0))+`</code></pre>
`:"<pre><code>"+(n?i:mr(i,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){const t=e.ordered,n=e.start;let s="";for(let o=0;o<e.items.length;o++){const l=e.items[o];s+=this.listitem(l)}const i=t?"ol":"ul",a=t&&n!==1?' start="'+n+'"':"";return"<"+i+a+`>
`+s+"</"+i+`>
`}listitem(e){var n;let t="";if(e.task){const s=this.checkbox({checked:!!e.checked});e.loose?((n=e.tokens[0])==null?void 0:n.type)==="paragraph"?(e.tokens[0].text=s+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=s+" "+mr(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:s+" ",text:s+" ",escaped:!0}):t+=s+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",n="";for(let i=0;i<e.header.length;i++)n+=this.tablecell(e.header[i]);t+=this.tablerow({text:n});let s="";for(let i=0;i<e.rows.length;i++){const a=e.rows[i];n="";for(let o=0;o<a.length;o++)n+=this.tablecell(a[o]);s+=this.tablerow({text:n})}return s&&(s=`<tbody>${s}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+s+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){const t=this.parser.parseInline(e.tokens),n=e.header?"th":"td";return(e.align?`<${n} align="${e.align}">`:`<${n}>`)+t+`</${n}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${mr(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:n}){const s=this.parser.parseInline(n),i=hk(e);if(i===null)return s;e=i;let a='<a href="'+e+'"';return t&&(a+=' title="'+mr(t)+'"'),a+=">"+s+"</a>",a}image({href:e,title:t,text:n}){const s=hk(e);if(s===null)return mr(n);e=s;let i=`<img src="${e}" alt="${n}"`;return t&&(i+=` title="${mr(t)}"`),i+=">",i}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:mr(e.text)}}class cy{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}}class zn{constructor(e){$(this,"options");$(this,"renderer");$(this,"textRenderer");this.options=e||Ii,this.options.renderer=this.options.renderer||new oh,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new cy}static parse(e,t){return new zn(t).parse(e)}static parseInline(e,t){return new zn(t).parseInline(e)}parse(e,t=!0){var s,i;let n="";for(let a=0;a<e.length;a++){const o=e[a];if((i=(s=this.options.extensions)==null?void 0:s.renderers)!=null&&i[o.type]){const c=o,u=this.options.extensions.renderers[c.type].call({parser:this},c);if(u!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(c.type)){n+=u||"";continue}}const l=o;switch(l.type){case"space":{n+=this.renderer.space(l);continue}case"hr":{n+=this.renderer.hr(l);continue}case"heading":{n+=this.renderer.heading(l);continue}case"code":{n+=this.renderer.code(l);continue}case"table":{n+=this.renderer.table(l);continue}case"blockquote":{n+=this.renderer.blockquote(l);continue}case"list":{n+=this.renderer.list(l);continue}case"html":{n+=this.renderer.html(l);continue}case"paragraph":{n+=this.renderer.paragraph(l);continue}case"text":{let c=l,u=this.renderer.text(c);for(;a+1<e.length&&e[a+1].type==="text";)c=e[++a],u+=`
`+this.renderer.text(c);t?n+=this.renderer.paragraph({type:"paragraph",raw:u,text:u,tokens:[{type:"text",raw:u,text:u,escaped:!0}]}):n+=u;continue}default:{const c='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(c),"";throw new Error(c)}}}return n}parseInline(e,t=this.renderer){var s,i;let n="";for(let a=0;a<e.length;a++){const o=e[a];if((i=(s=this.options.extensions)==null?void 0:s.renderers)!=null&&i[o.type]){const c=this.options.extensions.renderers[o.type].call({parser:this},o);if(c!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){n+=c||"";continue}}const l=o;switch(l.type){case"escape":{n+=t.text(l);break}case"html":{n+=t.html(l);break}case"link":{n+=t.link(l);break}case"image":{n+=t.image(l);break}case"strong":{n+=t.strong(l);break}case"em":{n+=t.em(l);break}case"codespan":{n+=t.codespan(l);break}case"br":{n+=t.br(l);break}case"del":{n+=t.del(l);break}case"text":{n+=t.text(l);break}default:{const c='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(c),"";throw new Error(c)}}}return n}}class dl{constructor(e){$(this,"options");$(this,"block");this.options=e||Ii}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?Fn.lex:Fn.lexInline}provideParser(){return this.block?zn.parse:zn.parseInline}}$(dl,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));class s5{constructor(...e){$(this,"defaults",ty());$(this,"options",this.setOptions);$(this,"parse",this.parseMarkdown(!0));$(this,"parseInline",this.parseMarkdown(!1));$(this,"Parser",zn);$(this,"Renderer",oh);$(this,"TextRenderer",cy);$(this,"Lexer",Fn);$(this,"Tokenizer",ah);$(this,"Hooks",dl);this.use(...e)}walkTokens(e,t){var s,i;let n=[];for(const a of e)switch(n=n.concat(t.call(this,a)),a.type){case"table":{const o=a;for(const l of o.header)n=n.concat(this.walkTokens(l.tokens,t));for(const l of o.rows)for(const c of l)n=n.concat(this.walkTokens(c.tokens,t));break}case"list":{const o=a;n=n.concat(this.walkTokens(o.items,t));break}default:{const o=a;(i=(s=this.defaults.extensions)==null?void 0:s.childTokens)!=null&&i[o.type]?this.defaults.extensions.childTokens[o.type].forEach(l=>{const c=o[l].flat(1/0);n=n.concat(this.walkTokens(c,t))}):o.tokens&&(n=n.concat(this.walkTokens(o.tokens,t)))}}return n}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(n=>{const s={...n};if(s.async=this.defaults.async||s.async||!1,n.extensions&&(n.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){const a=t.renderers[i.name];a?t.renderers[i.name]=function(...o){let l=i.renderer.apply(this,o);return l===!1&&(l=a.apply(this,o)),l}:t.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const a=t[i.level];a?a.unshift(i.tokenizer):t[i.level]=[i.tokenizer],i.start&&(i.level==="block"?t.startBlock?t.startBlock.push(i.start):t.startBlock=[i.start]:i.level==="inline"&&(t.startInline?t.startInline.push(i.start):t.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(t.childTokens[i.name]=i.childTokens)}),s.extensions=t),n.renderer){const i=this.defaults.renderer||new oh(this.defaults);for(const a in n.renderer){if(!(a in i))throw new Error(`renderer '${a}' does not exist`);if(["options","parser"].includes(a))continue;const o=a,l=n.renderer[o],c=i[o];i[o]=(...u)=>{let d=l.apply(i,u);return d===!1&&(d=c.apply(i,u)),d||""}}s.renderer=i}if(n.tokenizer){const i=this.defaults.tokenizer||new ah(this.defaults);for(const a in n.tokenizer){if(!(a in i))throw new Error(`tokenizer '${a}' does not exist`);if(["options","rules","lexer"].includes(a))continue;const o=a,l=n.tokenizer[o],c=i[o];i[o]=(...u)=>{let d=l.apply(i,u);return d===!1&&(d=c.apply(i,u)),d}}s.tokenizer=i}if(n.hooks){const i=this.defaults.hooks||new dl;for(const a in n.hooks){if(!(a in i))throw new Error(`hook '${a}' does not exist`);if(["options","block"].includes(a))continue;const o=a,l=n.hooks[o],c=i[o];dl.passThroughHooks.has(a)?i[o]=u=>{if(this.defaults.async)return Promise.resolve(l.call(i,u)).then(h=>c.call(i,h));const d=l.call(i,u);return c.call(i,d)}:i[o]=(...u)=>{let d=l.apply(i,u);return d===!1&&(d=c.apply(i,u)),d}}s.hooks=i}if(n.walkTokens){const i=this.defaults.walkTokens,a=n.walkTokens;s.walkTokens=function(o){let l=[];return l.push(a.call(this,o)),i&&(l=l.concat(i.call(this,o))),l}}this.defaults={...this.defaults,...s}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return Fn.lex(e,t??this.defaults)}parser(e,t){return zn.parse(e,t??this.defaults)}parseMarkdown(e){return(n,s)=>{const i={...s},a={...this.defaults,...i},o=this.onError(!!a.silent,!!a.async);if(this.defaults.async===!0&&i.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof n>"u"||n===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof n!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(n)+", string expected"));a.hooks&&(a.hooks.options=a,a.hooks.block=e);const l=a.hooks?a.hooks.provideLexer():e?Fn.lex:Fn.lexInline,c=a.hooks?a.hooks.provideParser():e?zn.parse:zn.parseInline;if(a.async)return Promise.resolve(a.hooks?a.hooks.preprocess(n):n).then(u=>l(u,a)).then(u=>a.hooks?a.hooks.processAllTokens(u):u).then(u=>a.walkTokens?Promise.all(this.walkTokens(u,a.walkTokens)).then(()=>u):u).then(u=>c(u,a)).then(u=>a.hooks?a.hooks.postprocess(u):u).catch(o);try{a.hooks&&(n=a.hooks.preprocess(n));let u=l(n,a);a.hooks&&(u=a.hooks.processAllTokens(u)),a.walkTokens&&this.walkTokens(u,a.walkTokens);let d=c(u,a);return a.hooks&&(d=a.hooks.postprocess(d)),d}catch(u){return o(u)}}}onError(e,t){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,e){const s="<p>An error occurred:</p><pre>"+mr(n.message+"",!0)+"</pre>";return t?Promise.resolve(s):s}if(t)return Promise.reject(n);throw n}}}const Si=new s5;function Ve(r,e){return Si.parse(r,e)}Ve.options=Ve.setOptions=function(r){return Si.setOptions(r),Ve.defaults=Si.defaults,fE(Ve.defaults),Ve};Ve.getDefaults=ty;Ve.defaults=Ii;Ve.use=function(...r){return Si.use(...r),Ve.defaults=Si.defaults,fE(Ve.defaults),Ve};Ve.walkTokens=function(r,e){return Si.walkTokens(r,e)};Ve.parseInline=Si.parseInline;Ve.Parser=zn;Ve.parser=zn.parse;Ve.Renderer=oh;Ve.TextRenderer=cy;Ve.Lexer=Fn;Ve.lexer=Fn.lex;Ve.Tokenizer=ah;Ve.Hooks=dl;Ve.parse=Ve;Ve.options;Ve.setOptions;Ve.use;Ve.walkTokens;Ve.parseInline;zn.parse;Fn.lex;var i5=fe("<textarea></textarea>");function a5(r,e){at(e,!0);let t=se(e,"ref",15,null),n=se(e,"value",15),s=Tt(e,["$$slots","$$events","$$legacy","ref","value","class"]);var i=i5();_O(i);let a;es(i,o=>t(o),()=>t()),Ue(o=>a=Dt(i,a,{class:o,...s}),[()=>Bn("border-input bg-background ring-offset-background placeholder:text-muted-foreground focus-visible:ring-ring flex min-h-[80px] w-full rounded-md border px-3 py-2 text-base focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e.class)]),Um(i,n),q(r,i),ot()}var o5=fe('<div class="box items-center justify-center h-full text-muted-foreground space-y-4 p-4"><p class="text-lg font-medium">å¼å§ä¸ AI å©æå¯¹è¯</p> <div class="max-w-md bg-teal-50 p-4 rounded-lg border border-teal-200"><p class="text-sm text-teal-800 font-medium mb-2">æç¤ºï¼</p> <p class="text-sm text-teal-700">ä½ å¯ä»¥è®©AIå©æå¸®ä½ çæåå¤çä¿¡å·ï¼ä¾å¦ï¼</p> <ul class="list-disc pl-5 text-sm text-teal-700 mt-2 space-y-1"><li>çæä¸ä¸ªé¢çä¸º50Hzçæ­£å¼¦æ³¢ä¿¡å·</li> <li>å¯¹IDä¸ºxxxçä¿¡å·è¿è¡ä½éæ»¤æ³¢</li> <li>ååºææå¯ç¨çä¿¡å·éé</li> <li>è·åIDä¸ºxxxçä¿¡å·ééçè¯¦ç»ä¿¡æ¯</li></ul></div></div>'),l5=fe('<div class="flex-1 box justify-center"><div class="markdown-content break-words overflow-wrap-anywhere"><!></div></div>'),c5=fe('<div class="text-muted-foreground"> </div>'),u5=fe('<div class="flex items-center gap-2"><div> </div> <div class="box gap-2"><!> <!></div></div>'),d5=fe('<div class="flex-1 self-center box justify-center"><div class="text-muted-foreground"> </div></div>'),h5=fe('<div class="flex-1 self-center box justify-center"><div class="flex items-center gap-2 text-muted-foreground"><!> <span>åå¤ä¸­...</span></div></div>'),f5=fe('<div class="box gap-4 text-sm"><!> <!></div>'),p5=fe("<!> åé",1),m5=fe("<!> æ¸ç©º",1),g5=fe('<div class="box-fill"><div class="box-scroll overflow-y-auto overflow-x-hidden p-4"><!></div> <div class="border-t p-2"><form class="flex gap-2"><div class="flex-1 relative"><!></div> <div class="box gap-2"><!> <!></div></form></div></div>');function b5(r,e){at(e,!0);let t=rn(""),n=rn(!1),s,i=Ne(()=>ba.data);Os(()=>{P(i).length,s&&setTimeout(()=>{s.scrollTo({top:s.scrollHeight,behavior:"smooth"})},50)});async function a(){if(!P(t).trim()||P(n))return;const k=P(t).trim();de(t,"");try{de(n,!0),await c9(k)}catch(S){console.error("Error in chat:",S),Yi(new Cn(`Error: ${S.message}`))}finally{de(n,!1)}}function o(k){try{return Ve.setOptions({gfm:!0,breaks:!0}),Ve.parse(k)}catch(S){return console.error("Error parsing markdown:",S),k}}var l=g5(),c=B(l),u=B(c);{var d=k=>{var S=o5();q(k,S)},h=k=>{var S=f5(),R=B(S);Dn(R,17,()=>P(i),Ar,(N,C)=>{var A=ze();const E=Ne(()=>P(C).getType());var O=ke(A);{var I=L=>{const W=Ne(()=>P(E)==="human"?"bg-muted":"bg-card");p9(L,{get class(){return P(W)},children:(ee,Z)=>{g9(ee,{class:"p-2",children:(X,U)=>{var G=u5(),le=B(G),me=B(le,!0);z(le);var Rt=V(le,2),vt=B(Rt);{var ut=qt=>{var dn=l5(),wn=B(dn),Ir=B(wn);AO(Ir,()=>o(P(C).content)),z(wn),z(dn),q(qt,dn)};Qe(vt,qt=>{P(C).content&&qt(ut)})}var _t=V(vt,2);{var Ut=qt=>{var dn=c5(),wn=B(dn,!0);z(dn),Ue(()=>yt(wn,P(C).tool_calls[0].name==="await_user_input"?"è¯·æ±ç¨æ·è¾å¥":"è¯·æ±è°ç¨å·¥å·")),q(qt,dn)};Qe(_t,qt=>{P(C).tool_calls&&P(C).tool_calls.length>0&&qt(Ut)})}z(Rt),z(G),Ue(()=>{yb(le,1,`
                      self-start shrink-0 w-6 h-6 rounded-full flex items-center justify-center text-xs text-primary-foreground
                      ${P(E)==="human"?"bg-primary":"bg-blue-600"}`),yt(me,P(E)==="human"?"æ":"AI")}),q(X,G)},$$slots:{default:!0}})},$$slots:{default:!0}})},T=(L,W)=>{{var ee=Z=>{var X=d5(),U=B(X),G=B(U,!0);z(U),z(X),Ue(()=>yt(G,P(C).name==="await_user_input"?"ç­å¾ç¨æ·è¾å¥":"å·¥å·è°ç¨ç»æ")),q(Z,X)};Qe(L,Z=>{["tool"].includes(P(E))&&Z(ee)},W)}};Qe(O,L=>{["human","ai"].includes(P(E))?L(I):L(T,!1)})}q(N,A)});var D=V(R,2);{var M=N=>{var C=h5(),A=B(C),E=B(A);y9(E,{class:"h-4 w-4 animate-spin"}),Kn(2),z(A),z(C),q(N,C)};Qe(D,N=>{P(n)&&N(M)})}z(S),q(k,S)};Qe(u,k=>{P(i).length<=1?k(d):k(h,!1)})}z(c),es(c,k=>s=k,()=>s);var f=V(c,2),p=B(f),m=B(p),g=B(m);a5(g,{class:"h-full min-h-full whitespace-pre-wrap break-words overflow-wrap-anywhere",placeholder:"è¾å¥æ¶æ¯...",onkeydown:k=>{k.key==="Enter"&&!k.shiftKey&&(k.preventDefault(),a())},get value(){return P(t)},set value(k){de(t,k,!0)}}),z(m);var b=V(m,2),_=B(b);const y=Ne(()=>P(n)||!P(t).trim()),w=Ne(()=>!P(n));pl(_,{type:"submit",get disabled(){return P(y)},get enabled(){return P(w)},children:(k,S)=>{var R=p5(),D=ke(R);v9(D,{class:"h-4 w-4 mr-2"}),Kn(),q(k,R)},$$slots:{default:!0}});var v=V(_,2);const x=Ne(()=>!P(n));pl(v,{type:"button",variant:"outline",onclick:o9,get enabled(){return P(x)},children:(k,S)=>{var R=m5(),D=ke(R);x9(D,{class:"h-4 w-4 mr-2"}),Kn(),q(k,R)},$$slots:{default:!0}}),z(b),z(p),z(f),z(l),la("submit",p,k=>{k.preventDefault(),a()}),q(r,l),ot()}var _5=fe("<option> </option>"),y5=fe("<option> </option>"),w5=fe("<!> éç½®",1),v5=fe('<div class="box gap-4"><div class="box gap-2"><h2 class="text-xl font-semibold">LLM éç½®</h2> <p class="text-sm text-muted-foreground">éç½® LLM æä¾ååæ¨¡åè®¾ç½®</p></div> <div class="box gap-4"><div class="box gap-2"><label for="provider" class="text-sm font-medium">æä¾å</label> <select id="provider" class="w-full p-2 border rounded-md"></select></div> <div class="box gap-2"><label for="model" class="text-sm font-medium">æ¨¡å</label> <select id="model" class="w-full p-2 border rounded-md"></select></div> <div class="box gap-2"><label for="apiKey" class="text-sm font-medium">API å¯é¥</label> <!></div> <div class="box gap-2"><label for="temperature" class="text-sm font-medium"> </label> <!></div> <div class="box gap-2"><label for="maxTokens" class="text-sm font-medium">æå¤§ Token æ°</label> <!></div> <div class="box gap-2"><label for="baseUrl" class="text-sm font-medium">èªå®ä¹ API ç«¯ç¹ (å¯é)</label> <!></div></div> <div class="flex justify-between"><!></div></div>');function x5(r,e){at(e,!0);const[t,n]=bb();let i=rn(pc(_b(ib,"$llmConfig",t)));const a=d9();let o=Ne(()=>u9(P(i)));function l(){de(i,uE,!0)}Os(()=>{yO(ib,P(i)),P(o).includes(P(i).model)||(P(i).model=P(o)[0])});var c=v5(),u=V(B(c),2),d=B(u),h=V(B(d),2);Dn(h,21,()=>a,Ar,(M,N)=>{var C=_5(),A={},E=B(C,!0);z(C),Ue(()=>{A!==(A=P(N).id)&&(C.value=(C.__value=P(N).id)??""),yt(E,P(N).name)}),q(M,C)}),z(h),z(d);var f=V(d,2),p=V(B(f),2);Dn(p,21,()=>P(o),Ar,(M,N)=>{var C=y5(),A={},E=B(C,!0);z(C),Ue(()=>{A!==(A=P(N))&&(C.value=(C.__value=P(N))??""),yt(E,P(N))}),q(M,C)}),z(p),z(f);var m=V(f,2),g=V(B(m),2);Jt(g,{id:"apiKey",type:"password",placeholder:"è¾å¥ API å¯é¥",get value(){return P(i).apiKey},set value(M){P(i).apiKey=M}}),z(m);var b=V(m,2),_=B(b),y=B(_);z(_);var w=V(_,2);Jt(w,{id:"temperature",type:"range",min:"0",max:"1",step:"0.1",get value(){return P(i).temperature},set value(M){P(i).temperature=M}}),z(b);var v=V(b,2),x=V(B(v),2);Jt(x,{id:"maxTokens",type:"number",min:"1",max:"8000",get value(){return P(i).maxTokens},set value(M){P(i).maxTokens=M}}),z(v);var k=V(v,2),S=V(B(k),2);Jt(S,{id:"baseUrl",type:"text",placeholder:"https://api.example.com/v1",get value(){return P(i).baseUrl},set value(M){P(i).baseUrl=M}}),z(k),z(u);var R=V(u,2),D=B(R);pl(D,{variant:"outline",$$events:{click:l},children:(M,N)=>{var C=w5(),A=ke(C);w9(A,{class:"h-4 w-4 mr-2"}),Kn(),q(M,C)},$$slots:{default:!0}}),z(R),z(c),Ue(()=>yt(y,`æ¸©åº¦ (${P(i).temperature??""})`)),hl(h,()=>P(i).provider,M=>P(i).provider=M),hl(p,()=>P(i).model,M=>P(i).model=M),q(r,c),ot(),n()}function SE(r){return r?"":void 0}function k5(r){return r?"true":"false"}function S5(r){return r?!0:void 0}function P5(r){return r?!0:void 0}const ob="ArrowDown",uy="ArrowLeft",dy="ArrowRight",lb="ArrowUp",A5="End",E5="Enter",O5="Home",T5=" ";function R5(r){return window.getComputedStyle(r).getPropertyValue("direction")}function I5(r="ltr",e="horizontal"){return{horizontal:r==="rtl"?uy:dy,vertical:ob}[e]}function C5(r="ltr",e="horizontal"){return{horizontal:r==="rtl"?dy:uy,vertical:lb}[e]}function $5(r="ltr",e="horizontal"){return["ltr","rtl"].includes(r)||(r="ltr"),["horizontal","vertical"].includes(e)||(e="horizontal"),{nextKey:I5(r,e),prevKey:C5(r,e)}}const M5=typeof document<"u";function N5(r){const e=pe(null);function t(){if(!M5)return[];const a=document.getElementById(r.rootNodeId.current);return a?r.candidateSelector?Array.from(a.querySelectorAll(r.candidateSelector)):Array.from(a.querySelectorAll(`[${r.candidateAttr}]:not([data-disabled])`)):[]}function n(){var o;const a=t();a.length&&((o=a[0])==null||o.focus())}function s(a,o,l=!1){var y;const c=document.getElementById(r.rootNodeId.current);if(!c||!a)return;const u=t();if(!u.length)return;const d=u.indexOf(a),h=R5(c),{nextKey:f,prevKey:p}=$5(h,r.orientation.current),m=r.loop.current,g={[f]:d+1,[p]:d-1,[O5]:0,[A5]:u.length-1};if(l){const w=f===ob?dy:ob,v=p===lb?uy:lb;g[w]=d+1,g[v]=d-1}let b=g[o.key];if(b===void 0)return;o.preventDefault(),b<0&&m?b=u.length-1:b===u.length&&m&&(b=0);const _=u[b];if(_)return _.focus(),e.current=_.id,(y=r.onCandidateFocus)==null||y.call(r,_),_}function i(a){const o=t(),l=e.current!==null;return a&&!l&&o[0]===a?(e.current=a.id,0):(a==null?void 0:a.id)===e.current?0:-1}return{setCurrentTabStopId(a){e.current=a},getTabIndex:i,handleKeydown:s,focusFirstCandidate:n,currentTabStopId:e}}globalThis.bitsIdCounter??(globalThis.bitsIdCounter={current:0});function hf(r="bits"){return globalThis.bitsIdCounter.current++,`${r}-${globalThis.bitsIdCounter.current}`}function L5(){}const j5="data-tabs-root",D5="data-tabs-list",PE="data-tabs-trigger",F5="data-tabs-content";var oc,lc;class z5{constructor(e){$(this,"opts");$(this,"rovingFocusGroup");ye(this,oc,rn(pc([])));$(this,"valueToTriggerId",new Od);$(this,"valueToContentId",new Od);ye(this,lc,Ne(()=>({id:this.opts.id.current,"data-orientation":this.opts.orientation.current,[j5]:""})));this.opts=e,Oi(e),this.rovingFocusGroup=N5({candidateAttr:PE,rootNodeId:this.opts.id,loop:this.opts.loop,orientation:this.opts.orientation})}get triggerIds(){return P(F(this,oc))}set triggerIds(e){de(F(this,oc),e,!0)}registerTrigger(e,t){return this.triggerIds.push(e),this.valueToTriggerId.set(t,e),()=>{this.triggerIds=this.triggerIds.filter(n=>n!==e),this.valueToTriggerId.delete(t)}}registerContent(e,t){return this.valueToContentId.set(t,e),()=>{this.valueToContentId.delete(t)}}setValue(e){this.opts.value.current=e}get props(){return P(F(this,lc))}set props(e){de(F(this,lc),e)}}oc=new WeakMap,lc=new WeakMap;var _h,cc;class B5{constructor(e,t){$(this,"opts");$(this,"root");ye(this,_h,Ne(()=>this.root.opts.disabled.current));ye(this,cc,Ne(()=>({id:this.opts.id.current,role:"tablist","aria-orientation":this.root.opts.orientation.current,"data-orientation":this.root.opts.orientation.current,[D5]:"","data-disabled":SE(P(F(this,_h)))})));this.opts=e,this.root=t,Oi(e)}get props(){return P(F(this,cc))}set props(e){de(F(this,cc),e)}}_h=new WeakMap,cc=new WeakMap;var ka,ws,Sa,yh,Pa,yd,uc;class U5{constructor(e,t){ye(this,Pa);$(this,"opts");$(this,"root");ye(this,ka,Ne(()=>this.root.opts.value.current===this.opts.value.current));ye(this,ws,Ne(()=>this.opts.disabled.current||this.root.opts.disabled.current));ye(this,Sa,rn(0));ye(this,yh,Ne(()=>this.root.valueToContentId.get(this.opts.value.current)));ye(this,uc,Ne(()=>({id:this.opts.id.current,role:"tab","data-state":AE(P(F(this,ka))),"data-value":this.opts.value.current,"data-orientation":this.root.opts.orientation.current,"data-disabled":SE(P(F(this,ws))),"aria-selected":k5(P(F(this,ka))),"aria-controls":P(F(this,yh)),[PE]:"",disabled:P5(P(F(this,ws))),tabindex:P(F(this,Sa)),onclick:this.onclick,onfocus:this.onfocus,onkeydown:this.onkeydown})));this.opts=e,this.root=t,Oi(e),As([()=>this.opts.id.current,()=>this.opts.value.current],([n,s])=>this.root.registerTrigger(n,s)),Os(()=>{this.root.triggerIds.length,P(F(this,ka))||!this.root.opts.value.current?de(F(this,Sa),0):de(F(this,Sa),-1)}),this.onfocus=this.onfocus.bind(this),this.onclick=this.onclick.bind(this),this.onkeydown=this.onkeydown.bind(this)}onfocus(e){this.root.opts.activationMode.current!=="automatic"||P(F(this,ws))||Us(this,Pa,yd).call(this)}onclick(e){P(F(this,ws))||Us(this,Pa,yd).call(this)}onkeydown(e){if(!P(F(this,ws))){if(e.key===T5||e.key===E5){e.preventDefault(),Us(this,Pa,yd).call(this);return}this.root.rovingFocusGroup.handleKeydown(this.opts.ref.current,e)}}get props(){return P(F(this,uc))}set props(e){de(F(this,uc),e)}}ka=new WeakMap,ws=new WeakMap,Sa=new WeakMap,yh=new WeakMap,Pa=new WeakSet,yd=function(){this.root.opts.value.current!==this.opts.value.current&&this.root.setValue(this.opts.value.current)},uc=new WeakMap;var dc,wh,hc;class q5{constructor(e,t){$(this,"opts");$(this,"root");ye(this,dc,Ne(()=>this.root.opts.value.current===this.opts.value.current));ye(this,wh,Ne(()=>this.root.valueToTriggerId.get(this.opts.value.current)));ye(this,hc,Ne(()=>({id:this.opts.id.current,role:"tabpanel",hidden:S5(!P(F(this,dc))),tabindex:0,"data-value":this.opts.value.current,"data-state":AE(P(F(this,dc))),"aria-labelledby":P(F(this,wh)),[F5]:""})));this.opts=e,this.root=t,Oi(e),As([()=>this.opts.id.current,()=>this.opts.value.current],([n,s])=>this.root.registerContent(n,s))}get props(){return P(F(this,hc))}set props(e){de(F(this,hc),e)}}dc=new WeakMap,wh=new WeakMap,hc=new WeakMap;const ff=new p1("Tabs.Root");function H5(r){return ff.set(new z5(r))}function W5(r){return new U5(r,ff.get())}function V5(r){return new B5(r,ff.get())}function G5(r){return new q5(r,ff.get())}function AE(r){return r?"active":"inactive"}var Z5=fe("<div><!></div>");function J5(r,e){at(e,!0);let t=se(e,"id",19,hf),n=se(e,"ref",15,null),s=se(e,"value",15,""),i=se(e,"onValueChange",3,L5),a=se(e,"orientation",3,"horizontal"),o=se(e,"loop",3,!0),l=se(e,"activationMode",3,"automatic"),c=se(e,"disabled",3,!1),u=Tt(e,["$$slots","$$events","$$legacy","id","ref","value","onValueChange","orientation","loop","activationMode","disabled","children","child"]);const d=H5({id:pe.with(()=>t()),value:pe.with(()=>s(),b=>{s(b),i()(b)}),orientation:pe.with(()=>a()),loop:pe.with(()=>o()),activationMode:pe.with(()=>l()),disabled:pe.with(()=>c()),ref:pe.with(()=>n(),b=>n(b))}),h=Ne(()=>Ei(u,d.props));var f=ze(),p=ke(f);{var m=b=>{var _=ze(),y=ke(_);kt(y,()=>e.child,()=>({props:P(h)})),q(b,_)},g=b=>{var _=Z5();let y;var w=B(_);kt(w,()=>e.children??In),z(_),Ue(()=>y=Dt(_,y,{...P(h)})),q(b,_)};Qe(p,b=>{e.child?b(m):b(g,!1)})}q(r,f),ot()}var K5=fe("<div><!></div>");function X5(r,e){at(e,!0);let t=se(e,"id",19,hf),n=se(e,"ref",15,null),s=Tt(e,["$$slots","$$events","$$legacy","children","child","id","ref","value"]);const i=G5({value:pe.with(()=>e.value),id:pe.with(()=>t()),ref:pe.with(()=>n(),d=>n(d))}),a=Ne(()=>Ei(s,i.props));var o=ze(),l=ke(o);{var c=d=>{var h=ze(),f=ke(h);kt(f,()=>e.child,()=>({props:P(a)})),q(d,h)},u=d=>{var h=K5();let f;var p=B(h);kt(p,()=>e.children??In),z(h),Ue(()=>f=Dt(h,f,{...P(a)})),q(d,h)};Qe(l,d=>{e.child?d(c):d(u,!1)})}q(r,o),ot()}var Y5=fe("<div><!></div>");function Q5(r,e){at(e,!0);let t=se(e,"id",19,hf),n=se(e,"ref",15,null),s=Tt(e,["$$slots","$$events","$$legacy","child","children","id","ref"]);const i=V5({id:pe.with(()=>t()),ref:pe.with(()=>n(),d=>n(d))}),a=Ne(()=>Ei(s,i.props));var o=ze(),l=ke(o);{var c=d=>{var h=ze(),f=ke(h);kt(f,()=>e.child,()=>({props:P(a)})),q(d,h)},u=d=>{var h=Y5();let f;var p=B(h);kt(p,()=>e.children??In),z(h),Ue(()=>f=Dt(h,f,{...P(a)})),q(d,h)};Qe(l,d=>{e.child?d(c):d(u,!1)})}q(r,o),ot()}var eq=fe("<button><!></button>");function tq(r,e){at(e,!0);let t=se(e,"disabled",3,!1),n=se(e,"id",19,hf),s=se(e,"type",3,"button"),i=se(e,"ref",15,null),a=Tt(e,["$$slots","$$events","$$legacy","child","children","disabled","id","type","value","ref"]);const o=W5({id:pe.with(()=>n()),disabled:pe.with(()=>t()??!1),value:pe.with(()=>e.value),ref:pe.with(()=>i(),f=>i(f))}),l=Ne(()=>Ei(a,o.props,{type:s()}));var c=ze(),u=ke(c);{var d=f=>{var p=ze(),m=ke(p);kt(m,()=>e.child,()=>({props:P(l)})),q(f,p)},h=f=>{var p=eq();let m;var g=B(p);kt(g,()=>e.children??In),z(p),Ue(()=>m=Dt(p,m,{...P(l)})),q(f,p)};Qe(u,f=>{e.child?f(d):f(h,!1)})}q(r,c),ot()}function Ku(r,e){at(e,!0);let t=se(e,"ref",15,null),n=Tt(e,["$$slots","$$events","$$legacy","ref","class"]);var s=ze(),i=ke(s);const a=Ne(()=>Bn("ring-offset-background focus-visible:ring-ring mt-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2",e.class));mc(i,()=>X5,(o,l)=>{l(o,Rr({get class(){return P(a)}},()=>n,{get ref(){return t()},set ref(c){t(c)}}))}),q(r,s),ot()}function nq(r,e){at(e,!0);let t=se(e,"ref",15,null),n=Tt(e,["$$slots","$$events","$$legacy","ref","class"]);var s=ze(),i=ke(s);const a=Ne(()=>Bn("bg-muted text-muted-foreground inline-flex h-10 items-center justify-center rounded-md p-1",e.class));mc(i,()=>Q5,(o,l)=>{l(o,Rr({get class(){return P(a)}},()=>n,{get ref(){return t()},set ref(c){t(c)}}))}),q(r,s),ot()}function Xu(r,e){at(e,!0);let t=se(e,"ref",15,null),n=Tt(e,["$$slots","$$events","$$legacy","ref","class"]);var s=ze(),i=ke(s);const a=Ne(()=>Bn("ring-offset-background focus-visible:ring-ring data-[state=active]:bg-background data-[state=active]:text-foreground inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm",e.class));mc(i,()=>tq,(o,l)=>{l(o,Rr({get class(){return P(a)}},()=>n,{get ref(){return t()},set ref(c){t(c)}}))}),q(r,s),ot()}const rq=J5;var sq=fe('<div class="border-b p-4 flex-none"><h2 class="text-xl font-semibold">éé</h2> <p class="text-sm text-muted-foreground">æ¥çåç®¡çä¿¡å·éé</p></div> <div class="flex-1 min-h-0 overflow-hidden flex"><!></div>',1),iq=fe("<!> <!> <!> <!>",1),aq=fe("<!> <!> <!> <!> <!>",1),oq=fe('<div class="border-b p-4 flex-none"><h2 class="text-xl font-semibold">ä¿¡å·æä½</h2> <p class="text-sm text-muted-foreground">çæåå¤çä¿¡å·</p></div> <div class="box-fill"><!></div>',1),lq=fe("<!> <!> <!>",1),cq=fe('<div class="h-screen bg-background box-fill"><header class="border-b flex-none"><div class="container py-4"><h1 class="text-3xl font-bold tracking-tight">ä¿¡å·åæå¨</h1> <p class="text-muted-foreground">çæãå¤çååæä¿¡å·</p></div></header> <main class="box-fill"><div class="box-fill"><!></div></main></div>');function pH(r){let e=rn(void 0);var t=cq(),n=V(B(t),2),s=B(n),i=B(s);P1(i,{direction:"horizontal",class:"box-fill",children:(a,o)=>{var l=lq(),c=ke(l);Rd(c,{class:"h-full box-fill",minSize:50,defaultSize:65,children:(h,f)=>{var p=sq(),m=V(ke(p),2),g=B(m);o2(g,{get selectedChannelId(){return P(e)},set selectedChannelId(b){de(e,b,!0)}}),z(m),q(h,p)},$$slots:{default:!0}});var u=V(c,2);S1(u,{withHandle:!0});var d=V(u,2);Rd(d,{class:"h-full box-fill",minSize:20,children:(h,f)=>{var p=oq(),m=V(ke(p),2),g=B(m);rq(g,{value:"generate",class:"box-fill",children:(b,_)=>{var y=aq(),w=ke(y);nq(w,{class:"m-4 mb-2 grid grid-cols-4",children:(R,D)=>{var M=iq(),N=ke(M);Xu(N,{value:"generate",children:(O,I)=>{Kn();var T=ni("çæä¿¡å·");q(O,T)},$$slots:{default:!0}});var C=V(N,2);Xu(C,{value:"process",children:(O,I)=>{Kn();var T=ni("å¤çä¿¡å·");q(O,T)},$$slots:{default:!0}});var A=V(C,2);Xu(A,{value:"chat",children:(O,I)=>{Kn();var T=ni("AI å©æ");q(O,T)},$$slots:{default:!0}});var E=V(A,2);Xu(E,{value:"config",children:(O,I)=>{Kn();var T=ni("LLM éç½®");q(O,T)},$$slots:{default:!0}}),q(R,M)},$$slots:{default:!0}});var v=V(w,2);Ku(v,{value:"generate",class:"box-scroll border-t p-4",children:(R,D)=>{_R(R,{})},$$slots:{default:!0}});var x=V(v,2);Ku(x,{value:"process",class:"box-scroll border-t p-4",children:(R,D)=>{RR(R,{get selectedChannelId(){return P(e)},set selectedChannelId(M){de(e,M,!0)}})},$$slots:{default:!0}});var k=V(x,2);Ku(k,{value:"chat",class:"box-fill border-t",children:(R,D)=>{b5(R,{})},$$slots:{default:!0}});var S=V(k,2);Ku(S,{value:"config",class:"box-scroll border-t p-4",children:(R,D)=>{x5(R,{})},$$slots:{default:!0}}),q(b,y)},$$slots:{default:!0}}),z(m),q(h,p)},$$slots:{default:!0}}),q(a,l)},$$slots:{default:!0}}),z(s),z(n),z(t),q(r,t)}export{pH as component};
